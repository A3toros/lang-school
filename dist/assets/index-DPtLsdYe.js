var eL=Object.defineProperty;var lE=s=>{throw TypeError(s)};var tL=(s,e,t)=>e in s?eL(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var re=(s,e,t)=>tL(s,typeof e!="symbol"?e+"":e,t),Tv=(s,e,t)=>e.has(s)||lE("Cannot "+t);var d=(s,e,t)=>(Tv(s,e,"read from private field"),t?t.call(s):e.get(s)),A=(s,e,t)=>e.has(s)?lE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),S=(s,e,t,n)=>(Tv(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),k=(s,e,t)=>(Tv(s,e,"access private method"),t);var Ks=(s,e,t,n)=>({set _(r){S(s,e,r,t)},get _(){return d(s,e,n)}});function sL(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var br=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function Ik(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function nL(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var r=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return s[n]}})}),t}var Ok={exports:{}},My={},Fk={exports:{}},ze={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pm=Symbol.for("react.element"),rL=Symbol.for("react.portal"),iL=Symbol.for("react.fragment"),aL=Symbol.for("react.strict_mode"),oL=Symbol.for("react.profiler"),lL=Symbol.for("react.provider"),cL=Symbol.for("react.context"),uL=Symbol.for("react.forward_ref"),dL=Symbol.for("react.suspense"),hL=Symbol.for("react.memo"),fL=Symbol.for("react.lazy"),cE=Symbol.iterator;function pL(s){return s===null||typeof s!="object"?null:(s=cE&&s[cE]||s["@@iterator"],typeof s=="function"?s:null)}var $k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Uk=Object.assign,Bk={};function dh(s,e,t){this.props=s,this.context=e,this.refs=Bk,this.updater=t||$k}dh.prototype.isReactComponent={};dh.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};dh.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function Hk(){}Hk.prototype=dh.prototype;function fS(s,e,t){this.props=s,this.context=e,this.refs=Bk,this.updater=t||$k}var pS=fS.prototype=new Hk;pS.constructor=fS;Uk(pS,dh.prototype);pS.isPureReactComponent=!0;var uE=Array.isArray,Vk=Object.prototype.hasOwnProperty,mS={current:null},zk={key:!0,ref:!0,__self:!0,__source:!0};function Wk(s,e,t){var n,r={},i=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)Vk.call(e,n)&&!zk.hasOwnProperty(n)&&(r[n]=e[n]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];r.children=l}if(s&&s.defaultProps)for(n in o=s.defaultProps,o)r[n]===void 0&&(r[n]=o[n]);return{$$typeof:Pm,type:s,key:i,ref:a,props:r,_owner:mS.current}}function mL(s,e){return{$$typeof:Pm,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function gS(s){return typeof s=="object"&&s!==null&&s.$$typeof===Pm}function gL(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var dE=/\/+/g;function Cv(s,e){return typeof s=="object"&&s!==null&&s.key!=null?gL(""+s.key):e.toString(36)}function Mg(s,e,t,n,r){var i=typeof s;(i==="undefined"||i==="boolean")&&(s=null);var a=!1;if(s===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(s.$$typeof){case Pm:case rL:a=!0}}if(a)return a=s,r=r(a),s=n===""?"."+Cv(a,0):n,uE(r)?(t="",s!=null&&(t=s.replace(dE,"$&/")+"/"),Mg(r,e,t,"",function(u){return u})):r!=null&&(gS(r)&&(r=mL(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(dE,"$&/")+"/")+s)),e.push(r)),1;if(a=0,n=n===""?".":n+":",uE(s))for(var o=0;o<s.length;o++){i=s[o];var l=n+Cv(i,o);a+=Mg(i,e,t,l,r)}else if(l=pL(s),typeof l=="function")for(s=l.call(s),o=0;!(i=s.next()).done;)i=i.value,l=n+Cv(i,o++),a+=Mg(i,e,t,l,r);else if(i==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function eg(s,e,t){if(s==null)return s;var n=[],r=0;return Mg(s,n,"","",function(i){return e.call(t,i,r++)}),n}function yL(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var un={current:null},Ig={transition:null},vL={ReactCurrentDispatcher:un,ReactCurrentBatchConfig:Ig,ReactCurrentOwner:mS};function Gk(){throw Error("act(...) is not supported in production builds of React.")}ze.Children={map:eg,forEach:function(s,e,t){eg(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return eg(s,function(){e++}),e},toArray:function(s){return eg(s,function(e){return e})||[]},only:function(s){if(!gS(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};ze.Component=dh;ze.Fragment=iL;ze.Profiler=oL;ze.PureComponent=fS;ze.StrictMode=aL;ze.Suspense=dL;ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vL;ze.act=Gk;ze.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var n=Uk({},s.props),r=s.key,i=s.ref,a=s._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=mS.current),e.key!==void 0&&(r=""+e.key),s.type&&s.type.defaultProps)var o=s.type.defaultProps;for(l in e)Vk.call(e,l)&&!zk.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];n.children=o}return{$$typeof:Pm,type:s.type,key:r,ref:i,props:n,_owner:a}};ze.createContext=function(s){return s={$$typeof:cL,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:lL,_context:s},s.Consumer=s};ze.createElement=Wk;ze.createFactory=function(s){var e=Wk.bind(null,s);return e.type=s,e};ze.createRef=function(){return{current:null}};ze.forwardRef=function(s){return{$$typeof:uL,render:s}};ze.isValidElement=gS;ze.lazy=function(s){return{$$typeof:fL,_payload:{_status:-1,_result:s},_init:yL}};ze.memo=function(s,e){return{$$typeof:hL,type:s,compare:e===void 0?null:e}};ze.startTransition=function(s){var e=Ig.transition;Ig.transition={};try{s()}finally{Ig.transition=e}};ze.unstable_act=Gk;ze.useCallback=function(s,e){return un.current.useCallback(s,e)};ze.useContext=function(s){return un.current.useContext(s)};ze.useDebugValue=function(){};ze.useDeferredValue=function(s){return un.current.useDeferredValue(s)};ze.useEffect=function(s,e){return un.current.useEffect(s,e)};ze.useId=function(){return un.current.useId()};ze.useImperativeHandle=function(s,e,t){return un.current.useImperativeHandle(s,e,t)};ze.useInsertionEffect=function(s,e){return un.current.useInsertionEffect(s,e)};ze.useLayoutEffect=function(s,e){return un.current.useLayoutEffect(s,e)};ze.useMemo=function(s,e){return un.current.useMemo(s,e)};ze.useReducer=function(s,e,t){return un.current.useReducer(s,e,t)};ze.useRef=function(s){return un.current.useRef(s)};ze.useState=function(s){return un.current.useState(s)};ze.useSyncExternalStore=function(s,e,t){return un.current.useSyncExternalStore(s,e,t)};ze.useTransition=function(){return un.current.useTransition()};ze.version="18.3.1";Fk.exports=ze;var _=Fk.exports;const Iy=Ik(_),xL=sL({__proto__:null,default:Iy},[_]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wL=_,bL=Symbol.for("react.element"),SL=Symbol.for("react.fragment"),_L=Object.prototype.hasOwnProperty,EL=wL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,AL={key:!0,ref:!0,__self:!0,__source:!0};function qk(s,e,t){var n,r={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)_L.call(e,n)&&!AL.hasOwnProperty(n)&&(r[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:bL,type:s,key:i,ref:a,props:r,_owner:EL.current}}My.Fragment=SL;My.jsx=qk;My.jsxs=qk;Ok.exports=My;var c=Ok.exports,Kk={exports:{}},Zn={},Xk={exports:{}},Yk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(D,F){var q=D.length;D.push(F);e:for(;0<q;){var J=q-1>>>1,ee=D[J];if(0<r(ee,F))D[J]=F,D[q]=ee,q=J;else break e}}function t(D){return D.length===0?null:D[0]}function n(D){if(D.length===0)return null;var F=D[0],q=D.pop();if(q!==F){D[0]=q;e:for(var J=0,ee=D.length,de=ee>>>1;J<de;){var ge=2*(J+1)-1,Ce=D[ge],B=ge+1,K=D[B];if(0>r(Ce,q))B<ee&&0>r(K,Ce)?(D[J]=K,D[B]=q,J=B):(D[J]=Ce,D[ge]=q,J=ge);else if(B<ee&&0>r(K,q))D[J]=K,D[B]=q,J=B;else break e}}return F}function r(D,F){var q=D.sortIndex-F.sortIndex;return q!==0?q:D.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,f=null,p=3,m=!1,g=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(D){for(var F=t(u);F!==null;){if(F.callback===null)n(u);else if(F.startTime<=D)n(u),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(u)}}function E(D){if(y=!1,w(D),!g)if(t(l)!==null)g=!0,$(T);else{var F=t(u);F!==null&&H(E,F.startTime-D)}}function T(D,F){g=!1,y&&(y=!1,v(j),j=-1),m=!0;var q=p;try{for(w(F),f=t(l);f!==null&&(!(f.expirationTime>F)||D&&!V());){var J=f.callback;if(typeof J=="function"){f.callback=null,p=f.priorityLevel;var ee=J(f.expirationTime<=F);F=s.unstable_now(),typeof ee=="function"?f.callback=ee:f===t(l)&&n(l),w(F)}else n(l);f=t(l)}if(f!==null)var de=!0;else{var ge=t(u);ge!==null&&H(E,ge.startTime-F),de=!1}return de}finally{f=null,p=q,m=!1}}var C=!1,N=null,j=-1,P=5,M=-1;function V(){return!(s.unstable_now()-M<P)}function L(){if(N!==null){var D=s.unstable_now();M=D;var F=!0;try{F=N(!0,D)}finally{F?I():(C=!1,N=null)}}else C=!1}var I;if(typeof x=="function")I=function(){x(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,X=O.port2;O.port1.onmessage=L,I=function(){X.postMessage(null)}}else I=function(){b(L,0)};function $(D){N=D,C||(C=!0,I())}function H(D,F){j=b(function(){D(s.unstable_now())},F)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(D){D.callback=null},s.unstable_continueExecution=function(){g||m||(g=!0,$(T))},s.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<D?Math.floor(1e3/D):5},s.unstable_getCurrentPriorityLevel=function(){return p},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(D){switch(p){case 1:case 2:case 3:var F=3;break;default:F=p}var q=p;p=F;try{return D()}finally{p=q}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(D,F){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var q=p;p=D;try{return F()}finally{p=q}},s.unstable_scheduleCallback=function(D,F,q){var J=s.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?J+q:J):q=J,D){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=q+ee,D={id:h++,callback:F,priorityLevel:D,startTime:q,expirationTime:ee,sortIndex:-1},q>J?(D.sortIndex=q,e(u,D),t(l)===null&&D===t(u)&&(y?(v(j),j=-1):y=!0,H(E,q-J))):(D.sortIndex=ee,e(l,D),g||m||(g=!0,$(T))),D},s.unstable_shouldYield=V,s.unstable_wrapCallback=function(D){var F=p;return function(){var q=p;p=F;try{return D.apply(this,arguments)}finally{p=q}}}})(Yk);Xk.exports=Yk;var kL=Xk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TL=_,Jn=kL;function ne(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Jk=new Set,Tf={};function qc(s,e){Zd(s,e),Zd(s+"Capture",e)}function Zd(s,e){for(Tf[s]=e,s=0;s<e.length;s++)Jk.add(e[s])}var Na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dx=Object.prototype.hasOwnProperty,CL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hE={},fE={};function NL(s){return Dx.call(fE,s)?!0:Dx.call(hE,s)?!1:CL.test(s)?fE[s]=!0:(hE[s]=!0,!1)}function jL(s,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function PL(s,e,t,n){if(e===null||typeof e>"u"||jL(s,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function dn(s,e,t,n,r,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var js={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){js[s]=new dn(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];js[e]=new dn(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){js[s]=new dn(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){js[s]=new dn(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){js[s]=new dn(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){js[s]=new dn(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){js[s]=new dn(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){js[s]=new dn(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){js[s]=new dn(s,5,!1,s.toLowerCase(),null,!1,!1)});var yS=/[\-:]([a-z])/g;function vS(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(yS,vS);js[e]=new dn(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(yS,vS);js[e]=new dn(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(yS,vS);js[e]=new dn(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){js[s]=new dn(s,1,!1,s.toLowerCase(),null,!1,!1)});js.xlinkHref=new dn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){js[s]=new dn(s,1,!1,s.toLowerCase(),null,!0,!0)});function xS(s,e,t,n){var r=js.hasOwnProperty(e)?js[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(PL(e,t,r,n)&&(t=null),n||r===null?NL(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):r.mustUseProperty?s[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?s.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?s.setAttributeNS(n,e,t):s.setAttribute(e,t))))}var Oa=TL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tg=Symbol.for("react.element"),xu=Symbol.for("react.portal"),wu=Symbol.for("react.fragment"),wS=Symbol.for("react.strict_mode"),Mx=Symbol.for("react.profiler"),Qk=Symbol.for("react.provider"),Zk=Symbol.for("react.context"),bS=Symbol.for("react.forward_ref"),Ix=Symbol.for("react.suspense"),Ox=Symbol.for("react.suspense_list"),SS=Symbol.for("react.memo"),za=Symbol.for("react.lazy"),eT=Symbol.for("react.offscreen"),pE=Symbol.iterator;function wh(s){return s===null||typeof s!="object"?null:(s=pE&&s[pE]||s["@@iterator"],typeof s=="function"?s:null)}var Lt=Object.assign,Nv;function Ih(s){if(Nv===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Nv=e&&e[1]||""}return`
`+Nv+s}var jv=!1;function Pv(s,e){if(!s||jv)return"";jv=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(s,[],e)}else{try{e.call()}catch(u){n=u}s.call(e.prototype)}else{try{throw Error()}catch(u){n=u}s()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=n.stack.split(`
`),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==i[o]){var l=`
`+r[a].replace(" at new "," at ");return s.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",s.displayName)),l}while(1<=a&&0<=o);break}}}finally{jv=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?Ih(s):""}function RL(s){switch(s.tag){case 5:return Ih(s.type);case 16:return Ih("Lazy");case 13:return Ih("Suspense");case 19:return Ih("SuspenseList");case 0:case 2:case 15:return s=Pv(s.type,!1),s;case 11:return s=Pv(s.type.render,!1),s;case 1:return s=Pv(s.type,!0),s;default:return""}}function Fx(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case wu:return"Fragment";case xu:return"Portal";case Mx:return"Profiler";case wS:return"StrictMode";case Ix:return"Suspense";case Ox:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Zk:return(s.displayName||"Context")+".Consumer";case Qk:return(s._context.displayName||"Context")+".Provider";case bS:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case SS:return e=s.displayName||null,e!==null?e:Fx(s.type)||"Memo";case za:e=s._payload,s=s._init;try{return Fx(s(e))}catch{}}return null}function LL(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fx(e);case 8:return e===wS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Go(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function tT(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function DL(s){var e=tT(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),n=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,i=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function sg(s){s._valueTracker||(s._valueTracker=DL(s))}function sT(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return s&&(n=tT(s)?s.checked?"true":"false":s.value),s=n,s!==t?(e.setValue(s),!0):!1}function A0(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function $x(s,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function mE(s,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Go(e.value!=null?e.value:t),s._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function nT(s,e){e=e.checked,e!=null&&xS(s,"checked",e,!1)}function Ux(s,e){nT(s,e);var t=Go(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(n==="submit"||n==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?Bx(s,e.type,t):e.hasOwnProperty("defaultValue")&&Bx(s,e.type,Go(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function gE(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function Bx(s,e,t){(e!=="number"||A0(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var Oh=Array.isArray;function Fu(s,e,t,n){if(s=s.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<s.length;t++)r=e.hasOwnProperty("$"+s[t].value),s[t].selected!==r&&(s[t].selected=r),r&&n&&(s[t].defaultSelected=!0)}else{for(t=""+Go(t),e=null,r=0;r<s.length;r++){if(s[r].value===t){s[r].selected=!0,n&&(s[r].defaultSelected=!0);return}e!==null||s[r].disabled||(e=s[r])}e!==null&&(e.selected=!0)}}function Hx(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function yE(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ne(92));if(Oh(t)){if(1<t.length)throw Error(ne(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:Go(t)}}function rT(s,e){var t=Go(e.value),n=Go(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),n!=null&&(s.defaultValue=""+n)}function vE(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function iT(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vx(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?iT(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var ng,aT=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return s(e,t,n,r)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(ng=ng||document.createElement("div"),ng.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ng.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function Cf(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var uf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ML=["Webkit","ms","Moz","O"];Object.keys(uf).forEach(function(s){ML.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),uf[e]=uf[s]})});function oT(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||uf.hasOwnProperty(s)&&uf[s]?(""+e).trim():e+"px"}function lT(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=oT(t,e[t],n);t==="float"&&(t="cssFloat"),n?s.setProperty(t,r):s[t]=r}}var IL=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zx(s,e){if(e){if(IL[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function Wx(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gx=null;function _S(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var qx=null,$u=null,Uu=null;function xE(s){if(s=Dm(s)){if(typeof qx!="function")throw Error(ne(280));var e=s.stateNode;e&&(e=By(e),qx(s.stateNode,s.type,e))}}function cT(s){$u?Uu?Uu.push(s):Uu=[s]:$u=s}function uT(){if($u){var s=$u,e=Uu;if(Uu=$u=null,xE(s),e)for(s=0;s<e.length;s++)xE(e[s])}}function dT(s,e){return s(e)}function hT(){}var Rv=!1;function fT(s,e,t){if(Rv)return s(e,t);Rv=!0;try{return dT(s,e,t)}finally{Rv=!1,($u!==null||Uu!==null)&&(hT(),uT())}}function Nf(s,e){var t=s.stateNode;if(t===null)return null;var n=By(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(s=s.type,n=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!n;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(ne(231,e,typeof t));return t}var Kx=!1;if(Na)try{var bh={};Object.defineProperty(bh,"passive",{get:function(){Kx=!0}}),window.addEventListener("test",bh,bh),window.removeEventListener("test",bh,bh)}catch{Kx=!1}function OL(s,e,t,n,r,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var df=!1,k0=null,T0=!1,Xx=null,FL={onError:function(s){df=!0,k0=s}};function $L(s,e,t,n,r,i,a,o,l){df=!1,k0=null,OL.apply(FL,arguments)}function UL(s,e,t,n,r,i,a,o,l){if($L.apply(this,arguments),df){if(df){var u=k0;df=!1,k0=null}else throw Error(ne(198));T0||(T0=!0,Xx=u)}}function Kc(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function pT(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function wE(s){if(Kc(s)!==s)throw Error(ne(188))}function BL(s){var e=s.alternate;if(!e){if(e=Kc(s),e===null)throw Error(ne(188));return e!==s?null:s}for(var t=s,n=e;;){var r=t.return;if(r===null)break;var i=r.alternate;if(i===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===t)return wE(r),s;if(i===n)return wE(r),e;i=i.sibling}throw Error(ne(188))}if(t.return!==n.return)t=r,n=i;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,n=i;break}if(o===n){a=!0,n=r,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,n=r;break}if(o===n){a=!0,n=i,t=r;break}o=o.sibling}if(!a)throw Error(ne(189))}}if(t.alternate!==n)throw Error(ne(190))}if(t.tag!==3)throw Error(ne(188));return t.stateNode.current===t?s:e}function mT(s){return s=BL(s),s!==null?gT(s):null}function gT(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=gT(s);if(e!==null)return e;s=s.sibling}return null}var yT=Jn.unstable_scheduleCallback,bE=Jn.unstable_cancelCallback,HL=Jn.unstable_shouldYield,VL=Jn.unstable_requestPaint,Bt=Jn.unstable_now,zL=Jn.unstable_getCurrentPriorityLevel,ES=Jn.unstable_ImmediatePriority,vT=Jn.unstable_UserBlockingPriority,C0=Jn.unstable_NormalPriority,WL=Jn.unstable_LowPriority,xT=Jn.unstable_IdlePriority,Oy=null,ji=null;function GL(s){if(ji&&typeof ji.onCommitFiberRoot=="function")try{ji.onCommitFiberRoot(Oy,s,void 0,(s.current.flags&128)===128)}catch{}}var Jr=Math.clz32?Math.clz32:XL,qL=Math.log,KL=Math.LN2;function XL(s){return s>>>=0,s===0?32:31-(qL(s)/KL|0)|0}var rg=64,ig=4194304;function Fh(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function N0(s,e){var t=s.pendingLanes;if(t===0)return 0;var n=0,r=s.suspendedLanes,i=s.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?n=Fh(o):(i&=a,i!==0&&(n=Fh(i)))}else a=t&~r,a!==0?n=Fh(a):i!==0&&(n=Fh(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=n;0<e;)t=31-Jr(e),r=1<<t,n|=s[t],e&=~r;return n}function YL(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JL(s,e){for(var t=s.suspendedLanes,n=s.pingedLanes,r=s.expirationTimes,i=s.pendingLanes;0<i;){var a=31-Jr(i),o=1<<a,l=r[a];l===-1?(!(o&t)||o&n)&&(r[a]=YL(o,e)):l<=e&&(s.expiredLanes|=o),i&=~o}}function Yx(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function wT(){var s=rg;return rg<<=1,!(rg&4194240)&&(rg=64),s}function Lv(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function Rm(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-Jr(e),s[e]=t}function QL(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var n=s.eventTimes;for(s=s.expirationTimes;0<t;){var r=31-Jr(t),i=1<<r;e[r]=0,n[r]=-1,s[r]=-1,t&=~i}}function AS(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var n=31-Jr(t),r=1<<n;r&e|s[n]&e&&(s[n]|=e),t&=~r}}var nt=0;function bT(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var ST,kS,_T,ET,AT,Jx=!1,ag=[],Oo=null,Fo=null,$o=null,jf=new Map,Pf=new Map,qa=[],ZL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function SE(s,e){switch(s){case"focusin":case"focusout":Oo=null;break;case"dragenter":case"dragleave":Fo=null;break;case"mouseover":case"mouseout":$o=null;break;case"pointerover":case"pointerout":jf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pf.delete(e.pointerId)}}function Sh(s,e,t,n,r,i){return s===null||s.nativeEvent!==i?(s={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Dm(e),e!==null&&kS(e)),s):(s.eventSystemFlags|=n,e=s.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),s)}function eD(s,e,t,n,r){switch(e){case"focusin":return Oo=Sh(Oo,s,e,t,n,r),!0;case"dragenter":return Fo=Sh(Fo,s,e,t,n,r),!0;case"mouseover":return $o=Sh($o,s,e,t,n,r),!0;case"pointerover":var i=r.pointerId;return jf.set(i,Sh(jf.get(i)||null,s,e,t,n,r)),!0;case"gotpointercapture":return i=r.pointerId,Pf.set(i,Sh(Pf.get(i)||null,s,e,t,n,r)),!0}return!1}function kT(s){var e=_l(s.target);if(e!==null){var t=Kc(e);if(t!==null){if(e=t.tag,e===13){if(e=pT(t),e!==null){s.blockedOn=e,AT(s.priority,function(){_T(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Og(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=Qx(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var n=new t.constructor(t.type,t);Gx=n,t.target.dispatchEvent(n),Gx=null}else return e=Dm(t),e!==null&&kS(e),s.blockedOn=t,!1;e.shift()}return!0}function _E(s,e,t){Og(s)&&t.delete(e)}function tD(){Jx=!1,Oo!==null&&Og(Oo)&&(Oo=null),Fo!==null&&Og(Fo)&&(Fo=null),$o!==null&&Og($o)&&($o=null),jf.forEach(_E),Pf.forEach(_E)}function _h(s,e){s.blockedOn===e&&(s.blockedOn=null,Jx||(Jx=!0,Jn.unstable_scheduleCallback(Jn.unstable_NormalPriority,tD)))}function Rf(s){function e(r){return _h(r,s)}if(0<ag.length){_h(ag[0],s);for(var t=1;t<ag.length;t++){var n=ag[t];n.blockedOn===s&&(n.blockedOn=null)}}for(Oo!==null&&_h(Oo,s),Fo!==null&&_h(Fo,s),$o!==null&&_h($o,s),jf.forEach(e),Pf.forEach(e),t=0;t<qa.length;t++)n=qa[t],n.blockedOn===s&&(n.blockedOn=null);for(;0<qa.length&&(t=qa[0],t.blockedOn===null);)kT(t),t.blockedOn===null&&qa.shift()}var Bu=Oa.ReactCurrentBatchConfig,j0=!0;function sD(s,e,t,n){var r=nt,i=Bu.transition;Bu.transition=null;try{nt=1,TS(s,e,t,n)}finally{nt=r,Bu.transition=i}}function nD(s,e,t,n){var r=nt,i=Bu.transition;Bu.transition=null;try{nt=4,TS(s,e,t,n)}finally{nt=r,Bu.transition=i}}function TS(s,e,t,n){if(j0){var r=Qx(s,e,t,n);if(r===null)Vv(s,e,n,P0,t),SE(s,n);else if(eD(r,s,e,t,n))n.stopPropagation();else if(SE(s,n),e&4&&-1<ZL.indexOf(s)){for(;r!==null;){var i=Dm(r);if(i!==null&&ST(i),i=Qx(s,e,t,n),i===null&&Vv(s,e,n,P0,t),i===r)break;r=i}r!==null&&n.stopPropagation()}else Vv(s,e,n,null,t)}}var P0=null;function Qx(s,e,t,n){if(P0=null,s=_S(n),s=_l(s),s!==null)if(e=Kc(s),e===null)s=null;else if(t=e.tag,t===13){if(s=pT(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return P0=s,null}function TT(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zL()){case ES:return 1;case vT:return 4;case C0:case WL:return 16;case xT:return 536870912;default:return 16}default:return 16}}var Do=null,CS=null,Fg=null;function CT(){if(Fg)return Fg;var s,e=CS,t=e.length,n,r="value"in Do?Do.value:Do.textContent,i=r.length;for(s=0;s<t&&e[s]===r[s];s++);var a=t-s;for(n=1;n<=a&&e[t-n]===r[i-n];n++);return Fg=r.slice(s,1<n?1-n:void 0)}function $g(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function og(){return!0}function EE(){return!1}function er(s){function e(t,n,r,i,a){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in s)s.hasOwnProperty(o)&&(t=s[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?og:EE,this.isPropagationStopped=EE,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=og)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=og)},persist:function(){},isPersistent:og}),e}var hh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},NS=er(hh),Lm=Lt({},hh,{view:0,detail:0}),rD=er(Lm),Dv,Mv,Eh,Fy=Lt({},Lm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jS,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Eh&&(Eh&&s.type==="mousemove"?(Dv=s.screenX-Eh.screenX,Mv=s.screenY-Eh.screenY):Mv=Dv=0,Eh=s),Dv)},movementY:function(s){return"movementY"in s?s.movementY:Mv}}),AE=er(Fy),iD=Lt({},Fy,{dataTransfer:0}),aD=er(iD),oD=Lt({},Lm,{relatedTarget:0}),Iv=er(oD),lD=Lt({},hh,{animationName:0,elapsedTime:0,pseudoElement:0}),cD=er(lD),uD=Lt({},hh,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),dD=er(uD),hD=Lt({},hh,{data:0}),kE=er(hD),fD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gD(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=mD[s])?!!e[s]:!1}function jS(){return gD}var yD=Lt({},Lm,{key:function(s){if(s.key){var e=fD[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=$g(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?pD[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jS,charCode:function(s){return s.type==="keypress"?$g(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?$g(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),vD=er(yD),xD=Lt({},Fy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),TE=er(xD),wD=Lt({},Lm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jS}),bD=er(wD),SD=Lt({},hh,{propertyName:0,elapsedTime:0,pseudoElement:0}),_D=er(SD),ED=Lt({},Fy,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),AD=er(ED),kD=[9,13,27,32],PS=Na&&"CompositionEvent"in window,hf=null;Na&&"documentMode"in document&&(hf=document.documentMode);var TD=Na&&"TextEvent"in window&&!hf,NT=Na&&(!PS||hf&&8<hf&&11>=hf),CE=" ",NE=!1;function jT(s,e){switch(s){case"keyup":return kD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function PT(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var bu=!1;function CD(s,e){switch(s){case"compositionend":return PT(e);case"keypress":return e.which!==32?null:(NE=!0,CE);case"textInput":return s=e.data,s===CE&&NE?null:s;default:return null}}function ND(s,e){if(bu)return s==="compositionend"||!PS&&jT(s,e)?(s=CT(),Fg=CS=Do=null,bu=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return NT&&e.locale!=="ko"?null:e.data;default:return null}}var jD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jE(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!jD[s.type]:e==="textarea"}function RT(s,e,t,n){cT(n),e=R0(e,"onChange"),0<e.length&&(t=new NS("onChange","change",null,t,n),s.push({event:t,listeners:e}))}var ff=null,Lf=null;function PD(s){VT(s,0)}function $y(s){var e=Eu(s);if(sT(e))return s}function RD(s,e){if(s==="change")return e}var LT=!1;if(Na){var Ov;if(Na){var Fv="oninput"in document;if(!Fv){var PE=document.createElement("div");PE.setAttribute("oninput","return;"),Fv=typeof PE.oninput=="function"}Ov=Fv}else Ov=!1;LT=Ov&&(!document.documentMode||9<document.documentMode)}function RE(){ff&&(ff.detachEvent("onpropertychange",DT),Lf=ff=null)}function DT(s){if(s.propertyName==="value"&&$y(Lf)){var e=[];RT(e,Lf,s,_S(s)),fT(PD,e)}}function LD(s,e,t){s==="focusin"?(RE(),ff=e,Lf=t,ff.attachEvent("onpropertychange",DT)):s==="focusout"&&RE()}function DD(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return $y(Lf)}function MD(s,e){if(s==="click")return $y(e)}function ID(s,e){if(s==="input"||s==="change")return $y(e)}function OD(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Zr=typeof Object.is=="function"?Object.is:OD;function Df(s,e){if(Zr(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!Dx.call(e,r)||!Zr(s[r],e[r]))return!1}return!0}function LE(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function DE(s,e){var t=LE(s);s=0;for(var n;t;){if(t.nodeType===3){if(n=s+t.textContent.length,s<=e&&n>=e)return{node:t,offset:e-s};s=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=LE(t)}}function MT(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?MT(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function IT(){for(var s=window,e=A0();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=A0(s.document)}return e}function RS(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function FD(s){var e=IT(),t=s.focusedElem,n=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&MT(t.ownerDocument.documentElement,t)){if(n!==null&&RS(t)){if(e=n.start,s=n.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var r=t.textContent.length,i=Math.min(n.start,r);n=n.end===void 0?i:Math.min(n.end,r),!s.extend&&i>n&&(r=n,n=i,i=r),r=DE(t,i);var a=DE(t,n);r&&a&&(s.rangeCount!==1||s.anchorNode!==r.node||s.anchorOffset!==r.offset||s.focusNode!==a.node||s.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),s.removeAllRanges(),i>n?(s.addRange(e),s.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var $D=Na&&"documentMode"in document&&11>=document.documentMode,Su=null,Zx=null,pf=null,ew=!1;function ME(s,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;ew||Su==null||Su!==A0(n)||(n=Su,"selectionStart"in n&&RS(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),pf&&Df(pf,n)||(pf=n,n=R0(Zx,"onSelect"),0<n.length&&(e=new NS("onSelect","select",null,e,t),s.push({event:e,listeners:n}),e.target=Su)))}function lg(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var _u={animationend:lg("Animation","AnimationEnd"),animationiteration:lg("Animation","AnimationIteration"),animationstart:lg("Animation","AnimationStart"),transitionend:lg("Transition","TransitionEnd")},$v={},OT={};Na&&(OT=document.createElement("div").style,"AnimationEvent"in window||(delete _u.animationend.animation,delete _u.animationiteration.animation,delete _u.animationstart.animation),"TransitionEvent"in window||delete _u.transitionend.transition);function Uy(s){if($v[s])return $v[s];if(!_u[s])return s;var e=_u[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in OT)return $v[s]=e[t];return s}var FT=Uy("animationend"),$T=Uy("animationiteration"),UT=Uy("animationstart"),BT=Uy("transitionend"),HT=new Map,IE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tl(s,e){HT.set(s,e),qc(e,[s])}for(var Uv=0;Uv<IE.length;Uv++){var Bv=IE[Uv],UD=Bv.toLowerCase(),BD=Bv[0].toUpperCase()+Bv.slice(1);tl(UD,"on"+BD)}tl(FT,"onAnimationEnd");tl($T,"onAnimationIteration");tl(UT,"onAnimationStart");tl("dblclick","onDoubleClick");tl("focusin","onFocus");tl("focusout","onBlur");tl(BT,"onTransitionEnd");Zd("onMouseEnter",["mouseout","mouseover"]);Zd("onMouseLeave",["mouseout","mouseover"]);Zd("onPointerEnter",["pointerout","pointerover"]);Zd("onPointerLeave",["pointerout","pointerover"]);qc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qc("onBeforeInput",["compositionend","keypress","textInput","paste"]);qc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $h="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HD=new Set("cancel close invalid load scroll toggle".split(" ").concat($h));function OE(s,e,t){var n=s.type||"unknown-event";s.currentTarget=t,UL(n,e,void 0,s),s.currentTarget=null}function VT(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var n=s[t],r=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&r.isPropagationStopped())break e;OE(r,o,u),i=l}else for(a=0;a<n.length;a++){if(o=n[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&r.isPropagationStopped())break e;OE(r,o,u),i=l}}}if(T0)throw s=Xx,T0=!1,Xx=null,s}function xt(s,e){var t=e[iw];t===void 0&&(t=e[iw]=new Set);var n=s+"__bubble";t.has(n)||(zT(e,s,2,!1),t.add(n))}function Hv(s,e,t){var n=0;e&&(n|=4),zT(t,s,n,e)}var cg="_reactListening"+Math.random().toString(36).slice(2);function Mf(s){if(!s[cg]){s[cg]=!0,Jk.forEach(function(t){t!=="selectionchange"&&(HD.has(t)||Hv(t,!1,s),Hv(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[cg]||(e[cg]=!0,Hv("selectionchange",!1,e))}}function zT(s,e,t,n){switch(TT(e)){case 1:var r=sD;break;case 4:r=nD;break;default:r=TS}t=r.bind(null,e,t,s),r=void 0,!Kx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?s.addEventListener(e,t,{capture:!0,passive:r}):s.addEventListener(e,t,!0):r!==void 0?s.addEventListener(e,t,{passive:r}):s.addEventListener(e,t,!1)}function Vv(s,e,t,n,r){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=_l(o),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}o=o.parentNode}}n=n.return}fT(function(){var u=i,h=_S(t),f=[];e:{var p=HT.get(s);if(p!==void 0){var m=NS,g=s;switch(s){case"keypress":if($g(t)===0)break e;case"keydown":case"keyup":m=vD;break;case"focusin":g="focus",m=Iv;break;case"focusout":g="blur",m=Iv;break;case"beforeblur":case"afterblur":m=Iv;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=AE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=aD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=bD;break;case FT:case $T:case UT:m=cD;break;case BT:m=_D;break;case"scroll":m=rD;break;case"wheel":m=AD;break;case"copy":case"cut":case"paste":m=dD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=TE}var y=(e&4)!==0,b=!y&&s==="scroll",v=y?p!==null?p+"Capture":null:p;y=[];for(var x=u,w;x!==null;){w=x;var E=w.stateNode;if(w.tag===5&&E!==null&&(w=E,v!==null&&(E=Nf(x,v),E!=null&&y.push(If(x,E,w)))),b)break;x=x.return}0<y.length&&(p=new m(p,g,null,t,h),f.push({event:p,listeners:y}))}}if(!(e&7)){e:{if(p=s==="mouseover"||s==="pointerover",m=s==="mouseout"||s==="pointerout",p&&t!==Gx&&(g=t.relatedTarget||t.fromElement)&&(_l(g)||g[ja]))break e;if((m||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,m?(g=t.relatedTarget||t.toElement,m=u,g=g?_l(g):null,g!==null&&(b=Kc(g),g!==b||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=u),m!==g)){if(y=AE,E="onMouseLeave",v="onMouseEnter",x="mouse",(s==="pointerout"||s==="pointerover")&&(y=TE,E="onPointerLeave",v="onPointerEnter",x="pointer"),b=m==null?p:Eu(m),w=g==null?p:Eu(g),p=new y(E,x+"leave",m,t,h),p.target=b,p.relatedTarget=w,E=null,_l(h)===u&&(y=new y(v,x+"enter",g,t,h),y.target=w,y.relatedTarget=b,E=y),b=E,m&&g)t:{for(y=m,v=g,x=0,w=y;w;w=nu(w))x++;for(w=0,E=v;E;E=nu(E))w++;for(;0<x-w;)y=nu(y),x--;for(;0<w-x;)v=nu(v),w--;for(;x--;){if(y===v||v!==null&&y===v.alternate)break t;y=nu(y),v=nu(v)}y=null}else y=null;m!==null&&FE(f,p,m,y,!1),g!==null&&b!==null&&FE(f,b,g,y,!0)}}e:{if(p=u?Eu(u):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var T=RD;else if(jE(p))if(LT)T=ID;else{T=DD;var C=LD}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(T=MD);if(T&&(T=T(s,u))){RT(f,T,t,h);break e}C&&C(s,p,u),s==="focusout"&&(C=p._wrapperState)&&C.controlled&&p.type==="number"&&Bx(p,"number",p.value)}switch(C=u?Eu(u):window,s){case"focusin":(jE(C)||C.contentEditable==="true")&&(Su=C,Zx=u,pf=null);break;case"focusout":pf=Zx=Su=null;break;case"mousedown":ew=!0;break;case"contextmenu":case"mouseup":case"dragend":ew=!1,ME(f,t,h);break;case"selectionchange":if($D)break;case"keydown":case"keyup":ME(f,t,h)}var N;if(PS)e:{switch(s){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else bu?jT(s,t)&&(j="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(j="onCompositionStart");j&&(NT&&t.locale!=="ko"&&(bu||j!=="onCompositionStart"?j==="onCompositionEnd"&&bu&&(N=CT()):(Do=h,CS="value"in Do?Do.value:Do.textContent,bu=!0)),C=R0(u,j),0<C.length&&(j=new kE(j,s,null,t,h),f.push({event:j,listeners:C}),N?j.data=N:(N=PT(t),N!==null&&(j.data=N)))),(N=TD?CD(s,t):ND(s,t))&&(u=R0(u,"onBeforeInput"),0<u.length&&(h=new kE("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=N))}VT(f,e)})}function If(s,e,t){return{instance:s,listener:e,currentTarget:t}}function R0(s,e){for(var t=e+"Capture",n=[];s!==null;){var r=s,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Nf(s,t),i!=null&&n.unshift(If(s,i,r)),i=Nf(s,e),i!=null&&n.push(If(s,i,r))),s=s.return}return n}function nu(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function FE(s,e,t,n,r){for(var i=e._reactName,a=[];t!==null&&t!==n;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===n)break;o.tag===5&&u!==null&&(o=u,r?(l=Nf(t,i),l!=null&&a.unshift(If(t,l,o))):r||(l=Nf(t,i),l!=null&&a.push(If(t,l,o)))),t=t.return}a.length!==0&&s.push({event:e,listeners:a})}var VD=/\r\n?/g,zD=/\u0000|\uFFFD/g;function $E(s){return(typeof s=="string"?s:""+s).replace(VD,`
`).replace(zD,"")}function ug(s,e,t){if(e=$E(e),$E(s)!==e&&t)throw Error(ne(425))}function L0(){}var tw=null,sw=null;function nw(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rw=typeof setTimeout=="function"?setTimeout:void 0,WD=typeof clearTimeout=="function"?clearTimeout:void 0,UE=typeof Promise=="function"?Promise:void 0,GD=typeof queueMicrotask=="function"?queueMicrotask:typeof UE<"u"?function(s){return UE.resolve(null).then(s).catch(qD)}:rw;function qD(s){setTimeout(function(){throw s})}function zv(s,e){var t=e,n=0;do{var r=t.nextSibling;if(s.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){s.removeChild(r),Rf(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);Rf(e)}function Uo(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function BE(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var fh=Math.random().toString(36).slice(2),Ti="__reactFiber$"+fh,Of="__reactProps$"+fh,ja="__reactContainer$"+fh,iw="__reactEvents$"+fh,KD="__reactListeners$"+fh,XD="__reactHandles$"+fh;function _l(s){var e=s[Ti];if(e)return e;for(var t=s.parentNode;t;){if(e=t[ja]||t[Ti]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=BE(s);s!==null;){if(t=s[Ti])return t;s=BE(s)}return e}s=t,t=s.parentNode}return null}function Dm(s){return s=s[Ti]||s[ja],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Eu(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(ne(33))}function By(s){return s[Of]||null}var aw=[],Au=-1;function sl(s){return{current:s}}function wt(s){0>Au||(s.current=aw[Au],aw[Au]=null,Au--)}function mt(s,e){Au++,aw[Au]=s.current,s.current=e}var qo={},Hs=sl(qo),En=sl(!1),Uc=qo;function eh(s,e){var t=s.type.contextTypes;if(!t)return qo;var n=s.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in t)r[i]=e[i];return n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=r),r}function An(s){return s=s.childContextTypes,s!=null}function D0(){wt(En),wt(Hs)}function HE(s,e,t){if(Hs.current!==qo)throw Error(ne(168));mt(Hs,e),mt(En,t)}function WT(s,e,t){var n=s.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(ne(108,LL(s)||"Unknown",r));return Lt({},t,n)}function M0(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||qo,Uc=Hs.current,mt(Hs,s),mt(En,En.current),!0}function VE(s,e,t){var n=s.stateNode;if(!n)throw Error(ne(169));t?(s=WT(s,e,Uc),n.__reactInternalMemoizedMergedChildContext=s,wt(En),wt(Hs),mt(Hs,s)):wt(En),mt(En,t)}var Vi=null,Hy=!1,Wv=!1;function GT(s){Vi===null?Vi=[s]:Vi.push(s)}function YD(s){Hy=!0,GT(s)}function nl(){if(!Wv&&Vi!==null){Wv=!0;var s=0,e=nt;try{var t=Vi;for(nt=1;s<t.length;s++){var n=t[s];do n=n(!0);while(n!==null)}Vi=null,Hy=!1}catch(r){throw Vi!==null&&(Vi=Vi.slice(s+1)),yT(ES,nl),r}finally{nt=e,Wv=!1}}return null}var ku=[],Tu=0,I0=null,O0=0,mr=[],gr=0,Bc=null,wa=1,ba="";function dl(s,e){ku[Tu++]=O0,ku[Tu++]=I0,I0=s,O0=e}function qT(s,e,t){mr[gr++]=wa,mr[gr++]=ba,mr[gr++]=Bc,Bc=s;var n=wa;s=ba;var r=32-Jr(n)-1;n&=~(1<<r),t+=1;var i=32-Jr(e)+r;if(30<i){var a=r-r%5;i=(n&(1<<a)-1).toString(32),n>>=a,r-=a,wa=1<<32-Jr(e)+r|t<<r|n,ba=i+s}else wa=1<<i|t<<r|n,ba=s}function LS(s){s.return!==null&&(dl(s,1),qT(s,1,0))}function DS(s){for(;s===I0;)I0=ku[--Tu],ku[Tu]=null,O0=ku[--Tu],ku[Tu]=null;for(;s===Bc;)Bc=mr[--gr],mr[gr]=null,ba=mr[--gr],mr[gr]=null,wa=mr[--gr],mr[gr]=null}var Xn=null,Kn=null,kt=!1,Kr=null;function KT(s,e){var t=vr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function zE(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,Xn=s,Kn=Uo(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,Xn=s,Kn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Bc!==null?{id:wa,overflow:ba}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=vr(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,Xn=s,Kn=null,!0):!1;default:return!1}}function ow(s){return(s.mode&1)!==0&&(s.flags&128)===0}function lw(s){if(kt){var e=Kn;if(e){var t=e;if(!zE(s,e)){if(ow(s))throw Error(ne(418));e=Uo(t.nextSibling);var n=Xn;e&&zE(s,e)?KT(n,t):(s.flags=s.flags&-4097|2,kt=!1,Xn=s)}}else{if(ow(s))throw Error(ne(418));s.flags=s.flags&-4097|2,kt=!1,Xn=s}}}function WE(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Xn=s}function dg(s){if(s!==Xn)return!1;if(!kt)return WE(s),kt=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!nw(s.type,s.memoizedProps)),e&&(e=Kn)){if(ow(s))throw XT(),Error(ne(418));for(;e;)KT(s,e),e=Uo(e.nextSibling)}if(WE(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ne(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){Kn=Uo(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}Kn=null}}else Kn=Xn?Uo(s.stateNode.nextSibling):null;return!0}function XT(){for(var s=Kn;s;)s=Uo(s.nextSibling)}function th(){Kn=Xn=null,kt=!1}function MS(s){Kr===null?Kr=[s]:Kr.push(s)}var JD=Oa.ReactCurrentBatchConfig;function Ah(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ne(309));var n=t.stateNode}if(!n)throw Error(ne(147,s));var r=n,i=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=r.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof s!="string")throw Error(ne(284));if(!t._owner)throw Error(ne(290,s))}return s}function hg(s,e){throw s=Object.prototype.toString.call(e),Error(ne(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function GE(s){var e=s._init;return e(s._payload)}function YT(s){function e(v,x){if(s){var w=v.deletions;w===null?(v.deletions=[x],v.flags|=16):w.push(x)}}function t(v,x){if(!s)return null;for(;x!==null;)e(v,x),x=x.sibling;return null}function n(v,x){for(v=new Map;x!==null;)x.key!==null?v.set(x.key,x):v.set(x.index,x),x=x.sibling;return v}function r(v,x){return v=zo(v,x),v.index=0,v.sibling=null,v}function i(v,x,w){return v.index=w,s?(w=v.alternate,w!==null?(w=w.index,w<x?(v.flags|=2,x):w):(v.flags|=2,x)):(v.flags|=1048576,x)}function a(v){return s&&v.alternate===null&&(v.flags|=2),v}function o(v,x,w,E){return x===null||x.tag!==6?(x=Qv(w,v.mode,E),x.return=v,x):(x=r(x,w),x.return=v,x)}function l(v,x,w,E){var T=w.type;return T===wu?h(v,x,w.props.children,E,w.key):x!==null&&(x.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===za&&GE(T)===x.type)?(E=r(x,w.props),E.ref=Ah(v,x,w),E.return=v,E):(E=Gg(w.type,w.key,w.props,null,v.mode,E),E.ref=Ah(v,x,w),E.return=v,E)}function u(v,x,w,E){return x===null||x.tag!==4||x.stateNode.containerInfo!==w.containerInfo||x.stateNode.implementation!==w.implementation?(x=Zv(w,v.mode,E),x.return=v,x):(x=r(x,w.children||[]),x.return=v,x)}function h(v,x,w,E,T){return x===null||x.tag!==7?(x=Ic(w,v.mode,E,T),x.return=v,x):(x=r(x,w),x.return=v,x)}function f(v,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Qv(""+x,v.mode,w),x.return=v,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case tg:return w=Gg(x.type,x.key,x.props,null,v.mode,w),w.ref=Ah(v,null,x),w.return=v,w;case xu:return x=Zv(x,v.mode,w),x.return=v,x;case za:var E=x._init;return f(v,E(x._payload),w)}if(Oh(x)||wh(x))return x=Ic(x,v.mode,w,null),x.return=v,x;hg(v,x)}return null}function p(v,x,w,E){var T=x!==null?x.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return T!==null?null:o(v,x,""+w,E);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case tg:return w.key===T?l(v,x,w,E):null;case xu:return w.key===T?u(v,x,w,E):null;case za:return T=w._init,p(v,x,T(w._payload),E)}if(Oh(w)||wh(w))return T!==null?null:h(v,x,w,E,null);hg(v,w)}return null}function m(v,x,w,E,T){if(typeof E=="string"&&E!==""||typeof E=="number")return v=v.get(w)||null,o(x,v,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case tg:return v=v.get(E.key===null?w:E.key)||null,l(x,v,E,T);case xu:return v=v.get(E.key===null?w:E.key)||null,u(x,v,E,T);case za:var C=E._init;return m(v,x,w,C(E._payload),T)}if(Oh(E)||wh(E))return v=v.get(w)||null,h(x,v,E,T,null);hg(x,E)}return null}function g(v,x,w,E){for(var T=null,C=null,N=x,j=x=0,P=null;N!==null&&j<w.length;j++){N.index>j?(P=N,N=null):P=N.sibling;var M=p(v,N,w[j],E);if(M===null){N===null&&(N=P);break}s&&N&&M.alternate===null&&e(v,N),x=i(M,x,j),C===null?T=M:C.sibling=M,C=M,N=P}if(j===w.length)return t(v,N),kt&&dl(v,j),T;if(N===null){for(;j<w.length;j++)N=f(v,w[j],E),N!==null&&(x=i(N,x,j),C===null?T=N:C.sibling=N,C=N);return kt&&dl(v,j),T}for(N=n(v,N);j<w.length;j++)P=m(N,v,j,w[j],E),P!==null&&(s&&P.alternate!==null&&N.delete(P.key===null?j:P.key),x=i(P,x,j),C===null?T=P:C.sibling=P,C=P);return s&&N.forEach(function(V){return e(v,V)}),kt&&dl(v,j),T}function y(v,x,w,E){var T=wh(w);if(typeof T!="function")throw Error(ne(150));if(w=T.call(w),w==null)throw Error(ne(151));for(var C=T=null,N=x,j=x=0,P=null,M=w.next();N!==null&&!M.done;j++,M=w.next()){N.index>j?(P=N,N=null):P=N.sibling;var V=p(v,N,M.value,E);if(V===null){N===null&&(N=P);break}s&&N&&V.alternate===null&&e(v,N),x=i(V,x,j),C===null?T=V:C.sibling=V,C=V,N=P}if(M.done)return t(v,N),kt&&dl(v,j),T;if(N===null){for(;!M.done;j++,M=w.next())M=f(v,M.value,E),M!==null&&(x=i(M,x,j),C===null?T=M:C.sibling=M,C=M);return kt&&dl(v,j),T}for(N=n(v,N);!M.done;j++,M=w.next())M=m(N,v,j,M.value,E),M!==null&&(s&&M.alternate!==null&&N.delete(M.key===null?j:M.key),x=i(M,x,j),C===null?T=M:C.sibling=M,C=M);return s&&N.forEach(function(L){return e(v,L)}),kt&&dl(v,j),T}function b(v,x,w,E){if(typeof w=="object"&&w!==null&&w.type===wu&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case tg:e:{for(var T=w.key,C=x;C!==null;){if(C.key===T){if(T=w.type,T===wu){if(C.tag===7){t(v,C.sibling),x=r(C,w.props.children),x.return=v,v=x;break e}}else if(C.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===za&&GE(T)===C.type){t(v,C.sibling),x=r(C,w.props),x.ref=Ah(v,C,w),x.return=v,v=x;break e}t(v,C);break}else e(v,C);C=C.sibling}w.type===wu?(x=Ic(w.props.children,v.mode,E,w.key),x.return=v,v=x):(E=Gg(w.type,w.key,w.props,null,v.mode,E),E.ref=Ah(v,x,w),E.return=v,v=E)}return a(v);case xu:e:{for(C=w.key;x!==null;){if(x.key===C)if(x.tag===4&&x.stateNode.containerInfo===w.containerInfo&&x.stateNode.implementation===w.implementation){t(v,x.sibling),x=r(x,w.children||[]),x.return=v,v=x;break e}else{t(v,x);break}else e(v,x);x=x.sibling}x=Zv(w,v.mode,E),x.return=v,v=x}return a(v);case za:return C=w._init,b(v,x,C(w._payload),E)}if(Oh(w))return g(v,x,w,E);if(wh(w))return y(v,x,w,E);hg(v,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,x!==null&&x.tag===6?(t(v,x.sibling),x=r(x,w),x.return=v,v=x):(t(v,x),x=Qv(w,v.mode,E),x.return=v,v=x),a(v)):t(v,x)}return b}var sh=YT(!0),JT=YT(!1),F0=sl(null),$0=null,Cu=null,IS=null;function OS(){IS=Cu=$0=null}function FS(s){var e=F0.current;wt(F0),s._currentValue=e}function cw(s,e,t){for(;s!==null;){var n=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),s===t)break;s=s.return}}function Hu(s,e){$0=s,IS=Cu=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(_n=!0),s.firstContext=null)}function Sr(s){var e=s._currentValue;if(IS!==s)if(s={context:s,memoizedValue:e,next:null},Cu===null){if($0===null)throw Error(ne(308));Cu=s,$0.dependencies={lanes:0,firstContext:s}}else Cu=Cu.next=s;return e}var El=null;function $S(s){El===null?El=[s]:El.push(s)}function QT(s,e,t,n){var r=e.interleaved;return r===null?(t.next=t,$S(e)):(t.next=r.next,r.next=t),e.interleaved=t,Pa(s,n)}function Pa(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var Wa=!1;function US(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ZT(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function _a(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function Bo(s,e,t){var n=s.updateQueue;if(n===null)return null;if(n=n.shared,Ke&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,Pa(s,t)}return r=n.interleaved,r===null?(e.next=e,$S(n)):(e.next=r.next,r.next=e),n.interleaved=e,Pa(s,t)}function Ug(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,AS(s,t)}}function qE(s,e){var t=s.updateQueue,n=s.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?r=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?r=i=e:i=i.next=e}else r=i=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:n.shared,effects:n.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function U0(s,e,t,n){var r=s.updateQueue;Wa=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var h=s.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=r.baseState;a=0,h=u=l=null,o=i;do{var p=o.lane,m=o.eventTime;if((n&p)===p){h!==null&&(h=h.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=s,y=o;switch(p=e,m=t,y.tag){case 1:if(g=y.payload,typeof g=="function"){f=g.call(m,f,p);break e}f=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,p=typeof g=="function"?g.call(m,f,p):g,p==null)break e;f=Lt({},f,p);break e;case 2:Wa=!0}}o.callback!==null&&o.lane!==0&&(s.flags|=64,p=r.effects,p===null?r.effects=[o]:p.push(o))}else m={eventTime:m,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=m,l=f):h=h.next=m,a|=p;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;p=o,o=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(!0);if(h===null&&(l=f),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Vc|=a,s.lanes=a,s.memoizedState=f}}function KE(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var n=s[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(ne(191,r));r.call(n)}}}var Mm={},Pi=sl(Mm),Ff=sl(Mm),$f=sl(Mm);function Al(s){if(s===Mm)throw Error(ne(174));return s}function BS(s,e){switch(mt($f,e),mt(Ff,s),mt(Pi,Mm),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Vx(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=Vx(e,s)}wt(Pi),mt(Pi,e)}function nh(){wt(Pi),wt(Ff),wt($f)}function eC(s){Al($f.current);var e=Al(Pi.current),t=Vx(e,s.type);e!==t&&(mt(Ff,s),mt(Pi,t))}function HS(s){Ff.current===s&&(wt(Pi),wt(Ff))}var jt=sl(0);function B0(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Gv=[];function VS(){for(var s=0;s<Gv.length;s++)Gv[s]._workInProgressVersionPrimary=null;Gv.length=0}var Bg=Oa.ReactCurrentDispatcher,qv=Oa.ReactCurrentBatchConfig,Hc=0,Rt=null,ss=null,ps=null,H0=!1,mf=!1,Uf=0,QD=0;function Ps(){throw Error(ne(321))}function zS(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!Zr(s[t],e[t]))return!1;return!0}function WS(s,e,t,n,r,i){if(Hc=i,Rt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bg.current=s===null||s.memoizedState===null?sM:nM,s=t(n,r),mf){i=0;do{if(mf=!1,Uf=0,25<=i)throw Error(ne(301));i+=1,ps=ss=null,e.updateQueue=null,Bg.current=rM,s=t(n,r)}while(mf)}if(Bg.current=V0,e=ss!==null&&ss.next!==null,Hc=0,ps=ss=Rt=null,H0=!1,e)throw Error(ne(300));return s}function GS(){var s=Uf!==0;return Uf=0,s}function li(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ps===null?Rt.memoizedState=ps=s:ps=ps.next=s,ps}function _r(){if(ss===null){var s=Rt.alternate;s=s!==null?s.memoizedState:null}else s=ss.next;var e=ps===null?Rt.memoizedState:ps.next;if(e!==null)ps=e,ss=s;else{if(s===null)throw Error(ne(310));ss=s,s={memoizedState:ss.memoizedState,baseState:ss.baseState,baseQueue:ss.baseQueue,queue:ss.queue,next:null},ps===null?Rt.memoizedState=ps=s:ps=ps.next=s}return ps}function Bf(s,e){return typeof e=="function"?e(s):e}function Kv(s){var e=_r(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=s;var n=ss,r=n.baseQueue,i=t.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}n.baseQueue=r=i,t.pending=null}if(r!==null){i=r.next,n=n.baseState;var o=a=null,l=null,u=i;do{var h=u.lane;if((Hc&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:s(n,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=f,a=n):l=l.next=f,Rt.lanes|=h,Vc|=h}u=u.next}while(u!==null&&u!==i);l===null?a=n:l.next=o,Zr(n,e.memoizedState)||(_n=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=l,t.lastRenderedState=n}if(s=t.interleaved,s!==null){r=s;do i=r.lane,Rt.lanes|=i,Vc|=i,r=r.next;while(r!==s)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Xv(s){var e=_r(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=s;var n=t.dispatch,r=t.pending,i=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do i=s(i,a.action),a=a.next;while(a!==r);Zr(i,e.memoizedState)||(_n=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function tC(){}function sC(s,e){var t=Rt,n=_r(),r=e(),i=!Zr(n.memoizedState,r);if(i&&(n.memoizedState=r,_n=!0),n=n.queue,qS(iC.bind(null,t,n,s),[s]),n.getSnapshot!==e||i||ps!==null&&ps.memoizedState.tag&1){if(t.flags|=2048,Hf(9,rC.bind(null,t,n,r,e),void 0,null),ms===null)throw Error(ne(349));Hc&30||nC(t,e,r)}return r}function nC(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function rC(s,e,t,n){e.value=t,e.getSnapshot=n,aC(e)&&oC(s)}function iC(s,e,t){return t(function(){aC(e)&&oC(s)})}function aC(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Zr(s,t)}catch{return!0}}function oC(s){var e=Pa(s,1);e!==null&&Qr(e,s,1,-1)}function XE(s){var e=li();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bf,lastRenderedState:s},e.queue=s,s=s.dispatch=tM.bind(null,Rt,s),[e.memoizedState,s]}function Hf(s,e,t,n){return s={tag:s,create:e,destroy:t,deps:n,next:null},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(n=t.next,t.next=s,s.next=n,e.lastEffect=s)),s}function lC(){return _r().memoizedState}function Hg(s,e,t,n){var r=li();Rt.flags|=s,r.memoizedState=Hf(1|e,t,void 0,n===void 0?null:n)}function Vy(s,e,t,n){var r=_r();n=n===void 0?null:n;var i=void 0;if(ss!==null){var a=ss.memoizedState;if(i=a.destroy,n!==null&&zS(n,a.deps)){r.memoizedState=Hf(e,t,i,n);return}}Rt.flags|=s,r.memoizedState=Hf(1|e,t,i,n)}function YE(s,e){return Hg(8390656,8,s,e)}function qS(s,e){return Vy(2048,8,s,e)}function cC(s,e){return Vy(4,2,s,e)}function uC(s,e){return Vy(4,4,s,e)}function dC(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function hC(s,e,t){return t=t!=null?t.concat([s]):null,Vy(4,4,dC.bind(null,e,s),t)}function KS(){}function fC(s,e){var t=_r();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&zS(e,n[1])?n[0]:(t.memoizedState=[s,e],s)}function pC(s,e){var t=_r();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&zS(e,n[1])?n[0]:(s=s(),t.memoizedState=[s,e],s)}function mC(s,e,t){return Hc&21?(Zr(t,e)||(t=wT(),Rt.lanes|=t,Vc|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,_n=!0),s.memoizedState=t)}function ZD(s,e){var t=nt;nt=t!==0&&4>t?t:4,s(!0);var n=qv.transition;qv.transition={};try{s(!1),e()}finally{nt=t,qv.transition=n}}function gC(){return _r().memoizedState}function eM(s,e,t){var n=Vo(s);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},yC(s))vC(e,t);else if(t=QT(s,e,t,n),t!==null){var r=on();Qr(t,s,n,r),xC(t,e,n)}}function tM(s,e,t){var n=Vo(s),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(yC(s))vC(e,r);else{var i=s.alternate;if(s.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(r.hasEagerState=!0,r.eagerState=o,Zr(o,a)){var l=e.interleaved;l===null?(r.next=r,$S(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=QT(s,e,r,n),t!==null&&(r=on(),Qr(t,s,n,r),xC(t,e,n))}}function yC(s){var e=s.alternate;return s===Rt||e!==null&&e===Rt}function vC(s,e){mf=H0=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function xC(s,e,t){if(t&4194240){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,AS(s,t)}}var V0={readContext:Sr,useCallback:Ps,useContext:Ps,useEffect:Ps,useImperativeHandle:Ps,useInsertionEffect:Ps,useLayoutEffect:Ps,useMemo:Ps,useReducer:Ps,useRef:Ps,useState:Ps,useDebugValue:Ps,useDeferredValue:Ps,useTransition:Ps,useMutableSource:Ps,useSyncExternalStore:Ps,useId:Ps,unstable_isNewReconciler:!1},sM={readContext:Sr,useCallback:function(s,e){return li().memoizedState=[s,e===void 0?null:e],s},useContext:Sr,useEffect:YE,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,Hg(4194308,4,dC.bind(null,e,s),t)},useLayoutEffect:function(s,e){return Hg(4194308,4,s,e)},useInsertionEffect:function(s,e){return Hg(4,2,s,e)},useMemo:function(s,e){var t=li();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var n=li();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},n.queue=s,s=s.dispatch=eM.bind(null,Rt,s),[n.memoizedState,s]},useRef:function(s){var e=li();return s={current:s},e.memoizedState=s},useState:XE,useDebugValue:KS,useDeferredValue:function(s){return li().memoizedState=s},useTransition:function(){var s=XE(!1),e=s[0];return s=ZD.bind(null,s[1]),li().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var n=Rt,r=li();if(kt){if(t===void 0)throw Error(ne(407));t=t()}else{if(t=e(),ms===null)throw Error(ne(349));Hc&30||nC(n,e,t)}r.memoizedState=t;var i={value:t,getSnapshot:e};return r.queue=i,YE(iC.bind(null,n,i,s),[s]),n.flags|=2048,Hf(9,rC.bind(null,n,i,t,e),void 0,null),t},useId:function(){var s=li(),e=ms.identifierPrefix;if(kt){var t=ba,n=wa;t=(n&~(1<<32-Jr(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Uf++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=QD++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},nM={readContext:Sr,useCallback:fC,useContext:Sr,useEffect:qS,useImperativeHandle:hC,useInsertionEffect:cC,useLayoutEffect:uC,useMemo:pC,useReducer:Kv,useRef:lC,useState:function(){return Kv(Bf)},useDebugValue:KS,useDeferredValue:function(s){var e=_r();return mC(e,ss.memoizedState,s)},useTransition:function(){var s=Kv(Bf)[0],e=_r().memoizedState;return[s,e]},useMutableSource:tC,useSyncExternalStore:sC,useId:gC,unstable_isNewReconciler:!1},rM={readContext:Sr,useCallback:fC,useContext:Sr,useEffect:qS,useImperativeHandle:hC,useInsertionEffect:cC,useLayoutEffect:uC,useMemo:pC,useReducer:Xv,useRef:lC,useState:function(){return Xv(Bf)},useDebugValue:KS,useDeferredValue:function(s){var e=_r();return ss===null?e.memoizedState=s:mC(e,ss.memoizedState,s)},useTransition:function(){var s=Xv(Bf)[0],e=_r().memoizedState;return[s,e]},useMutableSource:tC,useSyncExternalStore:sC,useId:gC,unstable_isNewReconciler:!1};function Lr(s,e){if(s&&s.defaultProps){e=Lt({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}function uw(s,e,t,n){e=s.memoizedState,t=t(n,e),t=t==null?e:Lt({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var zy={isMounted:function(s){return(s=s._reactInternals)?Kc(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var n=on(),r=Vo(s),i=_a(n,r);i.payload=e,t!=null&&(i.callback=t),e=Bo(s,i,r),e!==null&&(Qr(e,s,r,n),Ug(e,s,r))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var n=on(),r=Vo(s),i=_a(n,r);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Bo(s,i,r),e!==null&&(Qr(e,s,r,n),Ug(e,s,r))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=on(),n=Vo(s),r=_a(t,n);r.tag=2,e!=null&&(r.callback=e),e=Bo(s,r,n),e!==null&&(Qr(e,s,n,t),Ug(e,s,n))}};function JE(s,e,t,n,r,i,a){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(n,i,a):e.prototype&&e.prototype.isPureReactComponent?!Df(t,n)||!Df(r,i):!0}function wC(s,e,t){var n=!1,r=qo,i=e.contextType;return typeof i=="object"&&i!==null?i=Sr(i):(r=An(e)?Uc:Hs.current,n=e.contextTypes,i=(n=n!=null)?eh(s,r):qo),e=new e(t,i),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=zy,s.stateNode=e,e._reactInternals=s,n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=i),e}function QE(s,e,t,n){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==s&&zy.enqueueReplaceState(e,e.state,null)}function dw(s,e,t,n){var r=s.stateNode;r.props=t,r.state=s.memoizedState,r.refs={},US(s);var i=e.contextType;typeof i=="object"&&i!==null?r.context=Sr(i):(i=An(e)?Uc:Hs.current,r.context=eh(s,i)),r.state=s.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(uw(s,e,i,t),r.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&zy.enqueueReplaceState(r,r.state,null),U0(s,t,r,n),r.state=s.memoizedState),typeof r.componentDidMount=="function"&&(s.flags|=4194308)}function rh(s,e){try{var t="",n=e;do t+=RL(n),n=n.return;while(n);var r=t}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:s,source:e,stack:r,digest:null}}function Yv(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function hw(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var iM=typeof WeakMap=="function"?WeakMap:Map;function bC(s,e,t){t=_a(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){W0||(W0=!0,Sw=n),hw(s,e)},t}function SC(s,e,t){t=_a(-1,t),t.tag=3;var n=s.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){hw(s,e)}}var i=s.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){hw(s,e),typeof n!="function"&&(Ho===null?Ho=new Set([this]):Ho.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function ZE(s,e,t){var n=s.pingCache;if(n===null){n=s.pingCache=new iM;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),s=xM.bind(null,s,e,t),e.then(s,s))}function e1(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function t1(s,e,t,n,r){return s.mode&1?(s.flags|=65536,s.lanes=r,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=_a(-1,1),e.tag=2,Bo(t,e,1))),t.lanes|=1),s)}var aM=Oa.ReactCurrentOwner,_n=!1;function sn(s,e,t,n){e.child=s===null?JT(e,null,t,n):sh(e,s.child,t,n)}function s1(s,e,t,n,r){t=t.render;var i=e.ref;return Hu(e,r),n=WS(s,e,t,n,i,r),t=GS(),s!==null&&!_n?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,Ra(s,e,r)):(kt&&t&&LS(e),e.flags|=1,sn(s,e,n,r),e.child)}function n1(s,e,t,n,r){if(s===null){var i=t.type;return typeof i=="function"&&!s_(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,_C(s,e,i,n,r)):(s=Gg(t.type,null,n,e,e.mode,r),s.ref=e.ref,s.return=e,e.child=s)}if(i=s.child,!(s.lanes&r)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:Df,t(a,n)&&s.ref===e.ref)return Ra(s,e,r)}return e.flags|=1,s=zo(i,n),s.ref=e.ref,s.return=e,e.child=s}function _C(s,e,t,n,r){if(s!==null){var i=s.memoizedProps;if(Df(i,n)&&s.ref===e.ref)if(_n=!1,e.pendingProps=n=i,(s.lanes&r)!==0)s.flags&131072&&(_n=!0);else return e.lanes=s.lanes,Ra(s,e,r)}return fw(s,e,t,n,r)}function EC(s,e,t){var n=e.pendingProps,r=n.children,i=s!==null?s.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},mt(ju,Wn),Wn|=t;else{if(!(t&1073741824))return s=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,mt(ju,Wn),Wn|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,mt(ju,Wn),Wn|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,mt(ju,Wn),Wn|=n;return sn(s,e,r,t),e.child}function AC(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function fw(s,e,t,n,r){var i=An(t)?Uc:Hs.current;return i=eh(e,i),Hu(e,r),t=WS(s,e,t,n,i,r),n=GS(),s!==null&&!_n?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,Ra(s,e,r)):(kt&&n&&LS(e),e.flags|=1,sn(s,e,t,r),e.child)}function r1(s,e,t,n,r){if(An(t)){var i=!0;M0(e)}else i=!1;if(Hu(e,r),e.stateNode===null)Vg(s,e),wC(e,t,n),dw(e,t,n,r),n=!0;else if(s===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Sr(u):(u=An(t)?Uc:Hs.current,u=eh(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||l!==u)&&QE(e,a,n,u),Wa=!1;var p=e.memoizedState;a.state=p,U0(e,n,a,r),l=e.memoizedState,o!==n||p!==l||En.current||Wa?(typeof h=="function"&&(uw(e,t,h,n),l=e.memoizedState),(o=Wa||JE(e,t,o,n,p,l,u))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),a.props=n,a.state=l,a.context=u,n=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,ZT(s,e),o=e.memoizedProps,u=e.type===e.elementType?o:Lr(e.type,o),a.props=u,f=e.pendingProps,p=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Sr(l):(l=An(t)?Uc:Hs.current,l=eh(e,l));var m=t.getDerivedStateFromProps;(h=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||p!==l)&&QE(e,a,n,l),Wa=!1,p=e.memoizedState,a.state=p,U0(e,n,a,r);var g=e.memoizedState;o!==f||p!==g||En.current||Wa?(typeof m=="function"&&(uw(e,t,m,n),g=e.memoizedState),(u=Wa||JE(e,t,u,n,p,g,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=g),a.props=n,a.state=g,a.context=l,n=u):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=1024),n=!1)}return pw(s,e,t,n,i,r)}function pw(s,e,t,n,r,i){AC(s,e);var a=(e.flags&128)!==0;if(!n&&!a)return r&&VE(e,t,!1),Ra(s,e,i);n=e.stateNode,aM.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,s!==null&&a?(e.child=sh(e,s.child,null,i),e.child=sh(e,null,o,i)):sn(s,e,o,i),e.memoizedState=n.state,r&&VE(e,t,!0),e.child}function kC(s){var e=s.stateNode;e.pendingContext?HE(s,e.pendingContext,e.pendingContext!==e.context):e.context&&HE(s,e.context,!1),BS(s,e.containerInfo)}function i1(s,e,t,n,r){return th(),MS(r),e.flags|=256,sn(s,e,t,n),e.child}var mw={dehydrated:null,treeContext:null,retryLane:0};function gw(s){return{baseLanes:s,cachePool:null,transitions:null}}function TC(s,e,t){var n=e.pendingProps,r=jt.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=s!==null&&s.memoizedState===null?!1:(r&2)!==0),o?(i=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(r|=1),mt(jt,r&1),s===null)return lw(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,s=n.fallback,i?(n=e.mode,i=e.child,a={mode:"hidden",children:a},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=qy(a,n,0,null),s=Ic(s,n,t,null),i.return=e,s.return=e,i.sibling=s,e.child=i,e.child.memoizedState=gw(t),e.memoizedState=mw,s):XS(e,a));if(r=s.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return oM(s,e,a,n,o,r,t);if(i){i=n.fallback,a=e.mode,r=s.child,o=r.sibling;var l={mode:"hidden",children:n.children};return!(a&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=zo(r,l),n.subtreeFlags=r.subtreeFlags&14680064),o!==null?i=zo(o,i):(i=Ic(i,a,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,a=s.child.memoizedState,a=a===null?gw(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=s.childLanes&~t,e.memoizedState=mw,n}return i=s.child,s=i.sibling,n=zo(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=n,e.memoizedState=null,n}function XS(s,e){return e=qy({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function fg(s,e,t,n){return n!==null&&MS(n),sh(e,s.child,null,t),s=XS(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function oM(s,e,t,n,r,i,a){if(t)return e.flags&256?(e.flags&=-257,n=Yv(Error(ne(422))),fg(s,e,a,n)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(i=n.fallback,r=e.mode,n=qy({mode:"visible",children:n.children},r,0,null),i=Ic(i,r,a,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&sh(e,s.child,null,a),e.child.memoizedState=gw(a),e.memoizedState=mw,i);if(!(e.mode&1))return fg(s,e,a,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(ne(419)),n=Yv(i,n,void 0),fg(s,e,a,n)}if(o=(a&s.childLanes)!==0,_n||o){if(n=ms,n!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Pa(s,r),Qr(n,s,r,-1))}return t_(),n=Yv(Error(ne(421))),fg(s,e,a,n)}return r.data==="$?"?(e.flags|=128,e.child=s.child,e=wM.bind(null,s),r._reactRetry=e,null):(s=i.treeContext,Kn=Uo(r.nextSibling),Xn=e,kt=!0,Kr=null,s!==null&&(mr[gr++]=wa,mr[gr++]=ba,mr[gr++]=Bc,wa=s.id,ba=s.overflow,Bc=e),e=XS(e,n.children),e.flags|=4096,e)}function a1(s,e,t){s.lanes|=e;var n=s.alternate;n!==null&&(n.lanes|=e),cw(s.return,e,t)}function Jv(s,e,t,n,r){var i=s.memoizedState;i===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=r)}function CC(s,e,t){var n=e.pendingProps,r=n.revealOrder,i=n.tail;if(sn(s,e,n.children,t),n=jt.current,n&2)n=n&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&a1(s,t,e);else if(s.tag===19)a1(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}n&=1}if(mt(jt,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)s=t.alternate,s!==null&&B0(s)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Jv(e,!1,r,t,i);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(s=r.alternate,s!==null&&B0(s)===null){e.child=r;break}s=r.sibling,r.sibling=t,t=r,r=s}Jv(e,!0,t,null,i);break;case"together":Jv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vg(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function Ra(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),Vc|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(ne(153));if(e.child!==null){for(s=e.child,t=zo(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=zo(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function lM(s,e,t){switch(e.tag){case 3:kC(e),th();break;case 5:eC(e);break;case 1:An(e.type)&&M0(e);break;case 4:BS(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;mt(F0,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(mt(jt,jt.current&1),e.flags|=128,null):t&e.child.childLanes?TC(s,e,t):(mt(jt,jt.current&1),s=Ra(s,e,t),s!==null?s.sibling:null);mt(jt,jt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,s.flags&128){if(n)return CC(s,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),mt(jt,jt.current),n)break;return null;case 22:case 23:return e.lanes=0,EC(s,e,t)}return Ra(s,e,t)}var NC,yw,jC,PC;NC=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};yw=function(){};jC=function(s,e,t,n){var r=s.memoizedProps;if(r!==n){s=e.stateNode,Al(Pi.current);var i=null;switch(t){case"input":r=$x(s,r),n=$x(s,n),i=[];break;case"select":r=Lt({},r,{value:void 0}),n=Lt({},n,{value:void 0}),i=[];break;case"textarea":r=Hx(s,r),n=Hx(s,n),i=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(s.onclick=L0)}zx(t,n);var a;t=null;for(u in r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var o=r[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Tf.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(o=r!=null?r[u]:void 0,n.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Tf.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&xt("scroll",s),i||o===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};PC=function(s,e,t,n){t!==n&&(e.flags|=4)};function kh(s,e){if(!kt)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:n.sibling=null}}function Rs(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,n=0;if(e)for(var r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=s,r=r.sibling;else for(r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=s,r=r.sibling;return s.subtreeFlags|=n,s.childLanes=t,e}function cM(s,e,t){var n=e.pendingProps;switch(DS(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rs(e),null;case 1:return An(e.type)&&D0(),Rs(e),null;case 3:return n=e.stateNode,nh(),wt(En),wt(Hs),VS(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(s===null||s.child===null)&&(dg(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Kr!==null&&(Aw(Kr),Kr=null))),yw(s,e),Rs(e),null;case 5:HS(e);var r=Al($f.current);if(t=e.type,s!==null&&e.stateNode!=null)jC(s,e,t,n,r),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ne(166));return Rs(e),null}if(s=Al(Pi.current),dg(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[Ti]=e,n[Of]=i,s=(e.mode&1)!==0,t){case"dialog":xt("cancel",n),xt("close",n);break;case"iframe":case"object":case"embed":xt("load",n);break;case"video":case"audio":for(r=0;r<$h.length;r++)xt($h[r],n);break;case"source":xt("error",n);break;case"img":case"image":case"link":xt("error",n),xt("load",n);break;case"details":xt("toggle",n);break;case"input":mE(n,i),xt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},xt("invalid",n);break;case"textarea":yE(n,i),xt("invalid",n)}zx(t,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&ug(n.textContent,o,s),r=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&ug(n.textContent,o,s),r=["children",""+o]):Tf.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&xt("scroll",n)}switch(t){case"input":sg(n),gE(n,i,!0);break;case"textarea":sg(n),vE(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=L0)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=iT(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=a.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof n.is=="string"?s=a.createElement(t,{is:n.is}):(s=a.createElement(t),t==="select"&&(a=s,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):s=a.createElementNS(s,t),s[Ti]=e,s[Of]=n,NC(s,e,!1,!1),e.stateNode=s;e:{switch(a=Wx(t,n),t){case"dialog":xt("cancel",s),xt("close",s),r=n;break;case"iframe":case"object":case"embed":xt("load",s),r=n;break;case"video":case"audio":for(r=0;r<$h.length;r++)xt($h[r],s);r=n;break;case"source":xt("error",s),r=n;break;case"img":case"image":case"link":xt("error",s),xt("load",s),r=n;break;case"details":xt("toggle",s),r=n;break;case"input":mE(s,n),r=$x(s,n),xt("invalid",s);break;case"option":r=n;break;case"select":s._wrapperState={wasMultiple:!!n.multiple},r=Lt({},n,{value:void 0}),xt("invalid",s);break;case"textarea":yE(s,n),r=Hx(s,n),xt("invalid",s);break;default:r=n}zx(t,r),o=r;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?lT(s,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&aT(s,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Cf(s,l):typeof l=="number"&&Cf(s,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Tf.hasOwnProperty(i)?l!=null&&i==="onScroll"&&xt("scroll",s):l!=null&&xS(s,i,l,a))}switch(t){case"input":sg(s),gE(s,n,!1);break;case"textarea":sg(s),vE(s);break;case"option":n.value!=null&&s.setAttribute("value",""+Go(n.value));break;case"select":s.multiple=!!n.multiple,i=n.value,i!=null?Fu(s,!!n.multiple,i,!1):n.defaultValue!=null&&Fu(s,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(s.onclick=L0)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Rs(e),null;case 6:if(s&&e.stateNode!=null)PC(s,e,s.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ne(166));if(t=Al($f.current),Al(Pi.current),dg(e)){if(n=e.stateNode,t=e.memoizedProps,n[Ti]=e,(i=n.nodeValue!==t)&&(s=Xn,s!==null))switch(s.tag){case 3:ug(n.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&ug(n.nodeValue,t,(s.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Ti]=e,e.stateNode=n}return Rs(e),null;case 13:if(wt(jt),n=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(kt&&Kn!==null&&e.mode&1&&!(e.flags&128))XT(),th(),e.flags|=98560,i=!1;else if(i=dg(e),n!==null&&n.dehydrated!==null){if(s===null){if(!i)throw Error(ne(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ne(317));i[Ti]=e}else th(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Rs(e),i=!1}else Kr!==null&&(Aw(Kr),Kr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(s!==null&&s.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(s===null||jt.current&1?ns===0&&(ns=3):t_())),e.updateQueue!==null&&(e.flags|=4),Rs(e),null);case 4:return nh(),yw(s,e),s===null&&Mf(e.stateNode.containerInfo),Rs(e),null;case 10:return FS(e.type._context),Rs(e),null;case 17:return An(e.type)&&D0(),Rs(e),null;case 19:if(wt(jt),i=e.memoizedState,i===null)return Rs(e),null;if(n=(e.flags&128)!==0,a=i.rendering,a===null)if(n)kh(i,!1);else{if(ns!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(a=B0(s),a!==null){for(e.flags|=128,kh(i,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,s=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,s=a.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return mt(jt,jt.current&1|2),e.child}s=s.sibling}i.tail!==null&&Bt()>ih&&(e.flags|=128,n=!0,kh(i,!1),e.lanes=4194304)}else{if(!n)if(s=B0(a),s!==null){if(e.flags|=128,n=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),kh(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!kt)return Rs(e),null}else 2*Bt()-i.renderingStartTime>ih&&t!==1073741824&&(e.flags|=128,n=!0,kh(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Bt(),e.sibling=null,t=jt.current,mt(jt,n?t&1|2:t&1),e):(Rs(e),null);case 22:case 23:return e_(),n=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Wn&1073741824&&(Rs(e),e.subtreeFlags&6&&(e.flags|=8192)):Rs(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function uM(s,e){switch(DS(e),e.tag){case 1:return An(e.type)&&D0(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return nh(),wt(En),wt(Hs),VS(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return HS(e),null;case 13:if(wt(jt),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));th()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return wt(jt),null;case 4:return nh(),null;case 10:return FS(e.type._context),null;case 22:case 23:return e_(),null;case 24:return null;default:return null}}var pg=!1,Us=!1,dM=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Nu(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){It(s,e,n)}else t.current=null}function vw(s,e,t){try{t()}catch(n){It(s,e,n)}}var o1=!1;function hM(s,e){if(tw=j0,s=IT(),RS(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,h=0,f=s,p=null;t:for(;;){for(var m;f!==t||r!==0&&f.nodeType!==3||(o=a+r),f!==i||n!==0&&f.nodeType!==3||(l=a+n),f.nodeType===3&&(a+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===s)break t;if(p===t&&++u===r&&(o=a),p===i&&++h===n&&(l=a),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(sw={focusedElem:s,selectionRange:t},j0=!1,ue=e;ue!==null;)if(e=ue,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,ue=s;else for(;ue!==null;){e=ue;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,b=g.memoizedState,v=e.stateNode,x=v.getSnapshotBeforeUpdate(e.elementType===e.type?y:Lr(e.type,y),b);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(E){It(e,e.return,E)}if(s=e.sibling,s!==null){s.return=e.return,ue=s;break}ue=e.return}return g=o1,o1=!1,g}function gf(s,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&s)===s){var i=r.destroy;r.destroy=void 0,i!==void 0&&vw(e,t,i)}r=r.next}while(r!==n)}}function Wy(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function xw(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function RC(s){var e=s.alternate;e!==null&&(s.alternate=null,RC(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[Ti],delete e[Of],delete e[iw],delete e[KD],delete e[XD])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function LC(s){return s.tag===5||s.tag===3||s.tag===4}function l1(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||LC(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function ww(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=L0));else if(n!==4&&(s=s.child,s!==null))for(ww(s,e,t),s=s.sibling;s!==null;)ww(s,e,t),s=s.sibling}function bw(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(n!==4&&(s=s.child,s!==null))for(bw(s,e,t),s=s.sibling;s!==null;)bw(s,e,t),s=s.sibling}var As=null,Gr=!1;function $a(s,e,t){for(t=t.child;t!==null;)DC(s,e,t),t=t.sibling}function DC(s,e,t){if(ji&&typeof ji.onCommitFiberUnmount=="function")try{ji.onCommitFiberUnmount(Oy,t)}catch{}switch(t.tag){case 5:Us||Nu(t,e);case 6:var n=As,r=Gr;As=null,$a(s,e,t),As=n,Gr=r,As!==null&&(Gr?(s=As,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):As.removeChild(t.stateNode));break;case 18:As!==null&&(Gr?(s=As,t=t.stateNode,s.nodeType===8?zv(s.parentNode,t):s.nodeType===1&&zv(s,t),Rf(s)):zv(As,t.stateNode));break;case 4:n=As,r=Gr,As=t.stateNode.containerInfo,Gr=!0,$a(s,e,t),As=n,Gr=r;break;case 0:case 11:case 14:case 15:if(!Us&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&vw(t,e,a),r=r.next}while(r!==n)}$a(s,e,t);break;case 1:if(!Us&&(Nu(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(o){It(t,e,o)}$a(s,e,t);break;case 21:$a(s,e,t);break;case 22:t.mode&1?(Us=(n=Us)||t.memoizedState!==null,$a(s,e,t),Us=n):$a(s,e,t);break;default:$a(s,e,t)}}function c1(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new dM),e.forEach(function(n){var r=bM.bind(null,s,n);t.has(n)||(t.add(n),n.then(r,r))})}}function jr(s,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var i=s,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:As=o.stateNode,Gr=!1;break e;case 3:As=o.stateNode.containerInfo,Gr=!0;break e;case 4:As=o.stateNode.containerInfo,Gr=!0;break e}o=o.return}if(As===null)throw Error(ne(160));DC(i,a,r),As=null,Gr=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){It(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)MC(e,s),e=e.sibling}function MC(s,e){var t=s.alternate,n=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(jr(e,s),si(s),n&4){try{gf(3,s,s.return),Wy(3,s)}catch(y){It(s,s.return,y)}try{gf(5,s,s.return)}catch(y){It(s,s.return,y)}}break;case 1:jr(e,s),si(s),n&512&&t!==null&&Nu(t,t.return);break;case 5:if(jr(e,s),si(s),n&512&&t!==null&&Nu(t,t.return),s.flags&32){var r=s.stateNode;try{Cf(r,"")}catch(y){It(s,s.return,y)}}if(n&4&&(r=s.stateNode,r!=null)){var i=s.memoizedProps,a=t!==null?t.memoizedProps:i,o=s.type,l=s.updateQueue;if(s.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&nT(r,i),Wx(o,a);var u=Wx(o,i);for(a=0;a<l.length;a+=2){var h=l[a],f=l[a+1];h==="style"?lT(r,f):h==="dangerouslySetInnerHTML"?aT(r,f):h==="children"?Cf(r,f):xS(r,h,f,u)}switch(o){case"input":Ux(r,i);break;case"textarea":rT(r,i);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Fu(r,!!i.multiple,m,!1):p!==!!i.multiple&&(i.defaultValue!=null?Fu(r,!!i.multiple,i.defaultValue,!0):Fu(r,!!i.multiple,i.multiple?[]:"",!1))}r[Of]=i}catch(y){It(s,s.return,y)}}break;case 6:if(jr(e,s),si(s),n&4){if(s.stateNode===null)throw Error(ne(162));r=s.stateNode,i=s.memoizedProps;try{r.nodeValue=i}catch(y){It(s,s.return,y)}}break;case 3:if(jr(e,s),si(s),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Rf(e.containerInfo)}catch(y){It(s,s.return,y)}break;case 4:jr(e,s),si(s);break;case 13:jr(e,s),si(s),r=s.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(QS=Bt())),n&4&&c1(s);break;case 22:if(h=t!==null&&t.memoizedState!==null,s.mode&1?(Us=(u=Us)||h,jr(e,s),Us=u):jr(e,s),si(s),n&8192){if(u=s.memoizedState!==null,(s.stateNode.isHidden=u)&&!h&&s.mode&1)for(ue=s,h=s.child;h!==null;){for(f=ue=h;ue!==null;){switch(p=ue,m=p.child,p.tag){case 0:case 11:case 14:case 15:gf(4,p,p.return);break;case 1:Nu(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){It(n,t,y)}}break;case 5:Nu(p,p.return);break;case 22:if(p.memoizedState!==null){d1(f);continue}}m!==null?(m.return=p,ue=m):d1(f)}h=h.sibling}e:for(h=null,f=s;;){if(f.tag===5){if(h===null){h=f;try{r=f.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=f.stateNode,l=f.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=oT("display",a))}catch(y){It(s,s.return,y)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){It(s,s.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===s)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===s)break e;for(;f.sibling===null;){if(f.return===null||f.return===s)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:jr(e,s),si(s),n&4&&c1(s);break;case 21:break;default:jr(e,s),si(s)}}function si(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if(LC(t)){var n=t;break e}t=t.return}throw Error(ne(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(Cf(r,""),n.flags&=-33);var i=l1(s);bw(s,i,r);break;case 3:case 4:var a=n.stateNode.containerInfo,o=l1(s);ww(s,o,a);break;default:throw Error(ne(161))}}catch(l){It(s,s.return,l)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function fM(s,e,t){ue=s,IC(s)}function IC(s,e,t){for(var n=(s.mode&1)!==0;ue!==null;){var r=ue,i=r.child;if(r.tag===22&&n){var a=r.memoizedState!==null||pg;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||Us;o=pg;var u=Us;if(pg=a,(Us=l)&&!u)for(ue=r;ue!==null;)a=ue,l=a.child,a.tag===22&&a.memoizedState!==null?h1(r):l!==null?(l.return=a,ue=l):h1(r);for(;i!==null;)ue=i,IC(i),i=i.sibling;ue=r,pg=o,Us=u}u1(s)}else r.subtreeFlags&8772&&i!==null?(i.return=r,ue=i):u1(s)}}function u1(s){for(;ue!==null;){var e=ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Us||Wy(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Us)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Lr(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&KE(e,i,n);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}KE(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Rf(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}Us||e.flags&512&&xw(e)}catch(p){It(e,e.return,p)}}if(e===s){ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}}function d1(s){for(;ue!==null;){var e=ue;if(e===s){ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ue=t;break}ue=e.return}}function h1(s){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Wy(4,e)}catch(l){It(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(l){It(e,r,l)}}var i=e.return;try{xw(e)}catch(l){It(e,i,l)}break;case 5:var a=e.return;try{xw(e)}catch(l){It(e,a,l)}}}catch(l){It(e,e.return,l)}if(e===s){ue=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ue=o;break}ue=e.return}}var pM=Math.ceil,z0=Oa.ReactCurrentDispatcher,YS=Oa.ReactCurrentOwner,xr=Oa.ReactCurrentBatchConfig,Ke=0,ms=null,qt=null,Ns=0,Wn=0,ju=sl(0),ns=0,Vf=null,Vc=0,Gy=0,JS=0,yf=null,bn=null,QS=0,ih=1/0,$i=null,W0=!1,Sw=null,Ho=null,mg=!1,Mo=null,G0=0,vf=0,_w=null,zg=-1,Wg=0;function on(){return Ke&6?Bt():zg!==-1?zg:zg=Bt()}function Vo(s){return s.mode&1?Ke&2&&Ns!==0?Ns&-Ns:JD.transition!==null?(Wg===0&&(Wg=wT()),Wg):(s=nt,s!==0||(s=window.event,s=s===void 0?16:TT(s.type)),s):1}function Qr(s,e,t,n){if(50<vf)throw vf=0,_w=null,Error(ne(185));Rm(s,t,n),(!(Ke&2)||s!==ms)&&(s===ms&&(!(Ke&2)&&(Gy|=t),ns===4&&Ka(s,Ns)),kn(s,n),t===1&&Ke===0&&!(e.mode&1)&&(ih=Bt()+500,Hy&&nl()))}function kn(s,e){var t=s.callbackNode;JL(s,e);var n=N0(s,s===ms?Ns:0);if(n===0)t!==null&&bE(t),s.callbackNode=null,s.callbackPriority=0;else if(e=n&-n,s.callbackPriority!==e){if(t!=null&&bE(t),e===1)s.tag===0?YD(f1.bind(null,s)):GT(f1.bind(null,s)),GD(function(){!(Ke&6)&&nl()}),t=null;else{switch(bT(n)){case 1:t=ES;break;case 4:t=vT;break;case 16:t=C0;break;case 536870912:t=xT;break;default:t=C0}t=zC(t,OC.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function OC(s,e){if(zg=-1,Wg=0,Ke&6)throw Error(ne(327));var t=s.callbackNode;if(Vu()&&s.callbackNode!==t)return null;var n=N0(s,s===ms?Ns:0);if(n===0)return null;if(n&30||n&s.expiredLanes||e)e=q0(s,n);else{e=n;var r=Ke;Ke|=2;var i=$C();(ms!==s||Ns!==e)&&($i=null,ih=Bt()+500,Mc(s,e));do try{yM();break}catch(o){FC(s,o)}while(!0);OS(),z0.current=i,Ke=r,qt!==null?e=0:(ms=null,Ns=0,e=ns)}if(e!==0){if(e===2&&(r=Yx(s),r!==0&&(n=r,e=Ew(s,r))),e===1)throw t=Vf,Mc(s,0),Ka(s,n),kn(s,Bt()),t;if(e===6)Ka(s,n);else{if(r=s.current.alternate,!(n&30)&&!mM(r)&&(e=q0(s,n),e===2&&(i=Yx(s),i!==0&&(n=i,e=Ew(s,i))),e===1))throw t=Vf,Mc(s,0),Ka(s,n),kn(s,Bt()),t;switch(s.finishedWork=r,s.finishedLanes=n,e){case 0:case 1:throw Error(ne(345));case 2:hl(s,bn,$i);break;case 3:if(Ka(s,n),(n&130023424)===n&&(e=QS+500-Bt(),10<e)){if(N0(s,0)!==0)break;if(r=s.suspendedLanes,(r&n)!==n){on(),s.pingedLanes|=s.suspendedLanes&r;break}s.timeoutHandle=rw(hl.bind(null,s,bn,$i),e);break}hl(s,bn,$i);break;case 4:if(Ka(s,n),(n&4194240)===n)break;for(e=s.eventTimes,r=-1;0<n;){var a=31-Jr(n);i=1<<a,a=e[a],a>r&&(r=a),n&=~i}if(n=r,n=Bt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*pM(n/1960))-n,10<n){s.timeoutHandle=rw(hl.bind(null,s,bn,$i),n);break}hl(s,bn,$i);break;case 5:hl(s,bn,$i);break;default:throw Error(ne(329))}}}return kn(s,Bt()),s.callbackNode===t?OC.bind(null,s):null}function Ew(s,e){var t=yf;return s.current.memoizedState.isDehydrated&&(Mc(s,e).flags|=256),s=q0(s,e),s!==2&&(e=bn,bn=t,e!==null&&Aw(e)),s}function Aw(s){bn===null?bn=s:bn.push.apply(bn,s)}function mM(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],i=r.getSnapshot;r=r.value;try{if(!Zr(i(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ka(s,e){for(e&=~JS,e&=~Gy,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-Jr(e),n=1<<t;s[t]=-1,e&=~n}}function f1(s){if(Ke&6)throw Error(ne(327));Vu();var e=N0(s,0);if(!(e&1))return kn(s,Bt()),null;var t=q0(s,e);if(s.tag!==0&&t===2){var n=Yx(s);n!==0&&(e=n,t=Ew(s,n))}if(t===1)throw t=Vf,Mc(s,0),Ka(s,e),kn(s,Bt()),t;if(t===6)throw Error(ne(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,hl(s,bn,$i),kn(s,Bt()),null}function ZS(s,e){var t=Ke;Ke|=1;try{return s(e)}finally{Ke=t,Ke===0&&(ih=Bt()+500,Hy&&nl())}}function zc(s){Mo!==null&&Mo.tag===0&&!(Ke&6)&&Vu();var e=Ke;Ke|=1;var t=xr.transition,n=nt;try{if(xr.transition=null,nt=1,s)return s()}finally{nt=n,xr.transition=t,Ke=e,!(Ke&6)&&nl()}}function e_(){Wn=ju.current,wt(ju)}function Mc(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,WD(t)),qt!==null)for(t=qt.return;t!==null;){var n=t;switch(DS(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&D0();break;case 3:nh(),wt(En),wt(Hs),VS();break;case 5:HS(n);break;case 4:nh();break;case 13:wt(jt);break;case 19:wt(jt);break;case 10:FS(n.type._context);break;case 22:case 23:e_()}t=t.return}if(ms=s,qt=s=zo(s.current,null),Ns=Wn=e,ns=0,Vf=null,JS=Gy=Vc=0,bn=yf=null,El!==null){for(e=0;e<El.length;e++)if(t=El[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,i=t.pending;if(i!==null){var a=i.next;i.next=r,n.next=a}t.pending=n}El=null}return s}function FC(s,e){do{var t=qt;try{if(OS(),Bg.current=V0,H0){for(var n=Rt.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}H0=!1}if(Hc=0,ps=ss=Rt=null,mf=!1,Uf=0,YS.current=null,t===null||t.return===null){ns=1,Vf=e,qt=null;break}e:{var i=s,a=t.return,o=t,l=e;if(e=Ns,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=o,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=e1(a);if(m!==null){m.flags&=-257,t1(m,a,o,i,e),m.mode&1&&ZE(i,u,e),e=m,l=u;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){ZE(i,u,e),t_();break e}l=Error(ne(426))}}else if(kt&&o.mode&1){var b=e1(a);if(b!==null){!(b.flags&65536)&&(b.flags|=256),t1(b,a,o,i,e),MS(rh(l,o));break e}}i=l=rh(l,o),ns!==4&&(ns=2),yf===null?yf=[i]:yf.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=bC(i,l,e);qE(i,v);break e;case 1:o=l;var x=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ho===null||!Ho.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var E=SC(i,o,e);qE(i,E);break e}}i=i.return}while(i!==null)}BC(t)}catch(T){e=T,qt===t&&t!==null&&(qt=t=t.return);continue}break}while(!0)}function $C(){var s=z0.current;return z0.current=V0,s===null?V0:s}function t_(){(ns===0||ns===3||ns===2)&&(ns=4),ms===null||!(Vc&268435455)&&!(Gy&268435455)||Ka(ms,Ns)}function q0(s,e){var t=Ke;Ke|=2;var n=$C();(ms!==s||Ns!==e)&&($i=null,Mc(s,e));do try{gM();break}catch(r){FC(s,r)}while(!0);if(OS(),Ke=t,z0.current=n,qt!==null)throw Error(ne(261));return ms=null,Ns=0,ns}function gM(){for(;qt!==null;)UC(qt)}function yM(){for(;qt!==null&&!HL();)UC(qt)}function UC(s){var e=VC(s.alternate,s,Wn);s.memoizedProps=s.pendingProps,e===null?BC(s):qt=e,YS.current=null}function BC(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=uM(t,e),t!==null){t.flags&=32767,qt=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{ns=6,qt=null;return}}else if(t=cM(t,e,Wn),t!==null){qt=t;return}if(e=e.sibling,e!==null){qt=e;return}qt=e=s}while(e!==null);ns===0&&(ns=5)}function hl(s,e,t){var n=nt,r=xr.transition;try{xr.transition=null,nt=1,vM(s,e,t,n)}finally{xr.transition=r,nt=n}return null}function vM(s,e,t,n){do Vu();while(Mo!==null);if(Ke&6)throw Error(ne(327));t=s.finishedWork;var r=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error(ne(177));s.callbackNode=null,s.callbackPriority=0;var i=t.lanes|t.childLanes;if(QL(s,i),s===ms&&(qt=ms=null,Ns=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||mg||(mg=!0,zC(C0,function(){return Vu(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=xr.transition,xr.transition=null;var a=nt;nt=1;var o=Ke;Ke|=4,YS.current=null,hM(s,t),MC(t,s),FD(sw),j0=!!tw,sw=tw=null,s.current=t,fM(t),VL(),Ke=o,nt=a,xr.transition=i}else s.current=t;if(mg&&(mg=!1,Mo=s,G0=r),i=s.pendingLanes,i===0&&(Ho=null),GL(t.stateNode),kn(s,Bt()),e!==null)for(n=s.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(W0)throw W0=!1,s=Sw,Sw=null,s;return G0&1&&s.tag!==0&&Vu(),i=s.pendingLanes,i&1?s===_w?vf++:(vf=0,_w=s):vf=0,nl(),null}function Vu(){if(Mo!==null){var s=bT(G0),e=xr.transition,t=nt;try{if(xr.transition=null,nt=16>s?16:s,Mo===null)var n=!1;else{if(s=Mo,Mo=null,G0=0,Ke&6)throw Error(ne(331));var r=Ke;for(Ke|=4,ue=s.current;ue!==null;){var i=ue,a=i.child;if(ue.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(ue=u;ue!==null;){var h=ue;switch(h.tag){case 0:case 11:case 15:gf(8,h,i)}var f=h.child;if(f!==null)f.return=h,ue=f;else for(;ue!==null;){h=ue;var p=h.sibling,m=h.return;if(RC(h),h===u){ue=null;break}if(p!==null){p.return=m,ue=p;break}ue=m}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var b=y.sibling;y.sibling=null,y=b}while(y!==null)}}ue=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ue=a;else e:for(;ue!==null;){if(i=ue,i.flags&2048)switch(i.tag){case 0:case 11:case 15:gf(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,ue=v;break e}ue=i.return}}var x=s.current;for(ue=x;ue!==null;){a=ue;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,ue=w;else e:for(a=x;ue!==null;){if(o=ue,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Wy(9,o)}}catch(T){It(o,o.return,T)}if(o===a){ue=null;break e}var E=o.sibling;if(E!==null){E.return=o.return,ue=E;break e}ue=o.return}}if(Ke=r,nl(),ji&&typeof ji.onPostCommitFiberRoot=="function")try{ji.onPostCommitFiberRoot(Oy,s)}catch{}n=!0}return n}finally{nt=t,xr.transition=e}}return!1}function p1(s,e,t){e=rh(t,e),e=bC(s,e,1),s=Bo(s,e,1),e=on(),s!==null&&(Rm(s,1,e),kn(s,e))}function It(s,e,t){if(s.tag===3)p1(s,s,t);else for(;e!==null;){if(e.tag===3){p1(e,s,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ho===null||!Ho.has(n))){s=rh(t,s),s=SC(e,s,1),e=Bo(e,s,1),s=on(),e!==null&&(Rm(e,1,s),kn(e,s));break}}e=e.return}}function xM(s,e,t){var n=s.pingCache;n!==null&&n.delete(e),e=on(),s.pingedLanes|=s.suspendedLanes&t,ms===s&&(Ns&t)===t&&(ns===4||ns===3&&(Ns&130023424)===Ns&&500>Bt()-QS?Mc(s,0):JS|=t),kn(s,e)}function HC(s,e){e===0&&(s.mode&1?(e=ig,ig<<=1,!(ig&130023424)&&(ig=4194304)):e=1);var t=on();s=Pa(s,e),s!==null&&(Rm(s,e,t),kn(s,t))}function wM(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),HC(s,t)}function bM(s,e){var t=0;switch(s.tag){case 13:var n=s.stateNode,r=s.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=s.stateNode;break;default:throw Error(ne(314))}n!==null&&n.delete(e),HC(s,t)}var VC;VC=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||En.current)_n=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return _n=!1,lM(s,e,t);_n=!!(s.flags&131072)}else _n=!1,kt&&e.flags&1048576&&qT(e,O0,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Vg(s,e),s=e.pendingProps;var r=eh(e,Hs.current);Hu(e,t),r=WS(null,e,n,s,r,t);var i=GS();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,An(n)?(i=!0,M0(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,US(e),r.updater=zy,e.stateNode=r,r._reactInternals=e,dw(e,n,s,t),e=pw(null,e,n,!0,i,t)):(e.tag=0,kt&&i&&LS(e),sn(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Vg(s,e),s=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=_M(n),s=Lr(n,s),r){case 0:e=fw(null,e,n,s,t);break e;case 1:e=r1(null,e,n,s,t);break e;case 11:e=s1(null,e,n,s,t);break e;case 14:e=n1(null,e,n,Lr(n.type,s),t);break e}throw Error(ne(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Lr(n,r),fw(s,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Lr(n,r),r1(s,e,n,r,t);case 3:e:{if(kC(e),s===null)throw Error(ne(387));n=e.pendingProps,i=e.memoizedState,r=i.element,ZT(s,e),U0(e,n,null,t);var a=e.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=rh(Error(ne(423)),e),e=i1(s,e,n,t,r);break e}else if(n!==r){r=rh(Error(ne(424)),e),e=i1(s,e,n,t,r);break e}else for(Kn=Uo(e.stateNode.containerInfo.firstChild),Xn=e,kt=!0,Kr=null,t=JT(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(th(),n===r){e=Ra(s,e,t);break e}sn(s,e,n,t)}e=e.child}return e;case 5:return eC(e),s===null&&lw(e),n=e.type,r=e.pendingProps,i=s!==null?s.memoizedProps:null,a=r.children,nw(n,r)?a=null:i!==null&&nw(n,i)&&(e.flags|=32),AC(s,e),sn(s,e,a,t),e.child;case 6:return s===null&&lw(e),null;case 13:return TC(s,e,t);case 4:return BS(e,e.stateNode.containerInfo),n=e.pendingProps,s===null?e.child=sh(e,null,n,t):sn(s,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Lr(n,r),s1(s,e,n,r,t);case 7:return sn(s,e,e.pendingProps,t),e.child;case 8:return sn(s,e,e.pendingProps.children,t),e.child;case 12:return sn(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,i=e.memoizedProps,a=r.value,mt(F0,n._currentValue),n._currentValue=a,i!==null)if(Zr(i.value,a)){if(i.children===r.children&&!En.current){e=Ra(s,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=_a(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),cw(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(ne(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),cw(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}sn(s,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Hu(e,t),r=Sr(r),n=n(r),e.flags|=1,sn(s,e,n,t),e.child;case 14:return n=e.type,r=Lr(n,e.pendingProps),r=Lr(n.type,r),n1(s,e,n,r,t);case 15:return _C(s,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Lr(n,r),Vg(s,e),e.tag=1,An(n)?(s=!0,M0(e)):s=!1,Hu(e,t),wC(e,n,r),dw(e,n,r,t),pw(null,e,n,!0,s,t);case 19:return CC(s,e,t);case 22:return EC(s,e,t)}throw Error(ne(156,e.tag))};function zC(s,e){return yT(s,e)}function SM(s,e,t,n){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vr(s,e,t,n){return new SM(s,e,t,n)}function s_(s){return s=s.prototype,!(!s||!s.isReactComponent)}function _M(s){if(typeof s=="function")return s_(s)?1:0;if(s!=null){if(s=s.$$typeof,s===bS)return 11;if(s===SS)return 14}return 2}function zo(s,e){var t=s.alternate;return t===null?(t=vr(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function Gg(s,e,t,n,r,i){var a=2;if(n=s,typeof s=="function")s_(s)&&(a=1);else if(typeof s=="string")a=5;else e:switch(s){case wu:return Ic(t.children,r,i,e);case wS:a=8,r|=8;break;case Mx:return s=vr(12,t,e,r|2),s.elementType=Mx,s.lanes=i,s;case Ix:return s=vr(13,t,e,r),s.elementType=Ix,s.lanes=i,s;case Ox:return s=vr(19,t,e,r),s.elementType=Ox,s.lanes=i,s;case eT:return qy(t,r,i,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Qk:a=10;break e;case Zk:a=9;break e;case bS:a=11;break e;case SS:a=14;break e;case za:a=16,n=null;break e}throw Error(ne(130,s==null?s:typeof s,""))}return e=vr(a,t,e,r),e.elementType=s,e.type=n,e.lanes=i,e}function Ic(s,e,t,n){return s=vr(7,s,n,e),s.lanes=t,s}function qy(s,e,t,n){return s=vr(22,s,n,e),s.elementType=eT,s.lanes=t,s.stateNode={isHidden:!1},s}function Qv(s,e,t){return s=vr(6,s,null,e),s.lanes=t,s}function Zv(s,e,t){return e=vr(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function EM(s,e,t,n,r){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Lv(0),this.expirationTimes=Lv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lv(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function n_(s,e,t,n,r,i,a,o,l){return s=new EM(s,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=vr(3,null,null,e),s.current=i,i.stateNode=s,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},US(i),s}function AM(s,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xu,key:n==null?null:""+n,children:s,containerInfo:e,implementation:t}}function WC(s){if(!s)return qo;s=s._reactInternals;e:{if(Kc(s)!==s||s.tag!==1)throw Error(ne(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(An(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(s.tag===1){var t=s.type;if(An(t))return WT(s,t,e)}return e}function GC(s,e,t,n,r,i,a,o,l){return s=n_(t,n,!0,s,r,i,a,o,l),s.context=WC(null),t=s.current,n=on(),r=Vo(t),i=_a(n,r),i.callback=e??null,Bo(t,i,r),s.current.lanes=r,Rm(s,r,n),kn(s,n),s}function Ky(s,e,t,n){var r=e.current,i=on(),a=Vo(r);return t=WC(t),e.context===null?e.context=t:e.pendingContext=t,e=_a(i,a),e.payload={element:s},n=n===void 0?null:n,n!==null&&(e.callback=n),s=Bo(r,e,a),s!==null&&(Qr(s,r,a,i),Ug(s,r,a)),a}function K0(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function m1(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function r_(s,e){m1(s,e),(s=s.alternate)&&m1(s,e)}function kM(){return null}var qC=typeof reportError=="function"?reportError:function(s){console.error(s)};function i_(s){this._internalRoot=s}Xy.prototype.render=i_.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(ne(409));Ky(s,e,null,null)};Xy.prototype.unmount=i_.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;zc(function(){Ky(null,s,null,null)}),e[ja]=null}};function Xy(s){this._internalRoot=s}Xy.prototype.unstable_scheduleHydration=function(s){if(s){var e=ET();s={blockedOn:null,target:s,priority:e};for(var t=0;t<qa.length&&e!==0&&e<qa[t].priority;t++);qa.splice(t,0,s),t===0&&kT(s)}};function a_(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Yy(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function g1(){}function TM(s,e,t,n,r){if(r){if(typeof n=="function"){var i=n;n=function(){var u=K0(a);i.call(u)}}var a=GC(e,n,s,0,null,!1,!1,"",g1);return s._reactRootContainer=a,s[ja]=a.current,Mf(s.nodeType===8?s.parentNode:s),zc(),a}for(;r=s.lastChild;)s.removeChild(r);if(typeof n=="function"){var o=n;n=function(){var u=K0(l);o.call(u)}}var l=n_(s,0,!1,null,null,!1,!1,"",g1);return s._reactRootContainer=l,s[ja]=l.current,Mf(s.nodeType===8?s.parentNode:s),zc(function(){Ky(e,l,t,n)}),l}function Jy(s,e,t,n,r){var i=t._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var o=r;r=function(){var l=K0(a);o.call(l)}}Ky(e,a,s,r)}else a=TM(t,e,s,r,n);return K0(a)}ST=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=Fh(e.pendingLanes);t!==0&&(AS(e,t|1),kn(e,Bt()),!(Ke&6)&&(ih=Bt()+500,nl()))}break;case 13:zc(function(){var n=Pa(s,1);if(n!==null){var r=on();Qr(n,s,1,r)}}),r_(s,1)}};kS=function(s){if(s.tag===13){var e=Pa(s,134217728);if(e!==null){var t=on();Qr(e,s,134217728,t)}r_(s,134217728)}};_T=function(s){if(s.tag===13){var e=Vo(s),t=Pa(s,e);if(t!==null){var n=on();Qr(t,s,e,n)}r_(s,e)}};ET=function(){return nt};AT=function(s,e){var t=nt;try{return nt=s,e()}finally{nt=t}};qx=function(s,e,t){switch(e){case"input":if(Ux(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==s&&n.form===s.form){var r=By(n);if(!r)throw Error(ne(90));sT(n),Ux(n,r)}}}break;case"textarea":rT(s,t);break;case"select":e=t.value,e!=null&&Fu(s,!!t.multiple,e,!1)}};dT=ZS;hT=zc;var CM={usingClientEntryPoint:!1,Events:[Dm,Eu,By,cT,uT,ZS]},Th={findFiberByHostInstance:_l,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},NM={bundleType:Th.bundleType,version:Th.version,rendererPackageName:Th.rendererPackageName,rendererConfig:Th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Oa.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=mT(s),s===null?null:s.stateNode},findFiberByHostInstance:Th.findFiberByHostInstance||kM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gg.isDisabled&&gg.supportsFiber)try{Oy=gg.inject(NM),ji=gg}catch{}}Zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CM;Zn.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!a_(e))throw Error(ne(200));return AM(s,e,null,t)};Zn.createRoot=function(s,e){if(!a_(s))throw Error(ne(299));var t=!1,n="",r=qC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=n_(s,1,!1,null,null,t,!1,n,r),s[ja]=e.current,Mf(s.nodeType===8?s.parentNode:s),new i_(e)};Zn.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(ne(188)):(s=Object.keys(s).join(","),Error(ne(268,s)));return s=mT(e),s=s===null?null:s.stateNode,s};Zn.flushSync=function(s){return zc(s)};Zn.hydrate=function(s,e,t){if(!Yy(e))throw Error(ne(200));return Jy(null,s,e,!0,t)};Zn.hydrateRoot=function(s,e,t){if(!a_(s))throw Error(ne(405));var n=t!=null&&t.hydratedSources||null,r=!1,i="",a=qC;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=GC(e,null,s,1,t??null,r,!1,i,a),s[ja]=e.current,Mf(s),n)for(s=0;s<n.length;s++)t=n[s],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Xy(e)};Zn.render=function(s,e,t){if(!Yy(e))throw Error(ne(200));return Jy(null,s,e,!1,t)};Zn.unmountComponentAtNode=function(s){if(!Yy(s))throw Error(ne(40));return s._reactRootContainer?(zc(function(){Jy(null,null,s,!1,function(){s._reactRootContainer=null,s[ja]=null})}),!0):!1};Zn.unstable_batchedUpdates=ZS;Zn.unstable_renderSubtreeIntoContainer=function(s,e,t,n){if(!Yy(t))throw Error(ne(200));if(s==null||s._reactInternals===void 0)throw Error(ne(38));return Jy(s,e,t,!1,n)};Zn.version="18.3.1-next-f1338f8080-20240426";function KC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(KC)}catch(s){console.error(s)}}KC(),Kk.exports=Zn;var XC=Kk.exports,YC,y1=XC;YC=y1.createRoot,y1.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zf(){return zf=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},zf.apply(this,arguments)}var Io;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Io||(Io={}));const v1="popstate";function jM(s){s===void 0&&(s={});function e(n,r){let{pathname:i,search:a,hash:o}=n.location;return kw("",{pathname:i,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:QC(r)}return RM(e,t,null,s)}function Xt(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function JC(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function PM(){return Math.random().toString(36).substr(2,8)}function x1(s,e){return{usr:s.state,key:s.key,idx:e}}function kw(s,e,t,n){return t===void 0&&(t=null),zf({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?ph(e):e,{state:t,key:e&&e.key||n||PM()})}function QC(s){let{pathname:e="/",search:t="",hash:n=""}=s;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function ph(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substr(t),s=s.substr(0,t));let n=s.indexOf("?");n>=0&&(e.search=s.substr(n),s=s.substr(0,n)),s&&(e.pathname=s)}return e}function RM(s,e,t,n){n===void 0&&(n={});let{window:r=document.defaultView,v5Compat:i=!1}=n,a=r.history,o=Io.Pop,l=null,u=h();u==null&&(u=0,a.replaceState(zf({},a.state,{idx:u}),""));function h(){return(a.state||{idx:null}).idx}function f(){o=Io.Pop;let b=h(),v=b==null?null:b-u;u=b,l&&l({action:o,location:y.location,delta:v})}function p(b,v){o=Io.Push;let x=kw(y.location,b,v);u=h()+1;let w=x1(x,u),E=y.createHref(x);try{a.pushState(w,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;r.location.assign(E)}i&&l&&l({action:o,location:y.location,delta:1})}function m(b,v){o=Io.Replace;let x=kw(y.location,b,v);u=h();let w=x1(x,u),E=y.createHref(x);a.replaceState(w,"",E),i&&l&&l({action:o,location:y.location,delta:0})}function g(b){let v=r.location.origin!=="null"?r.location.origin:r.location.href,x=typeof b=="string"?b:QC(b);return x=x.replace(/ $/,"%20"),Xt(v,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,v)}let y={get action(){return o},get location(){return s(r,a)},listen(b){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(v1,f),l=b,()=>{r.removeEventListener(v1,f),l=null}},createHref(b){return e(r,b)},createURL:g,encodeLocation(b){let v=g(b);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:p,replace:m,go(b){return a.go(b)}};return y}var w1;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(w1||(w1={}));function LM(s,e,t){return t===void 0&&(t="/"),DM(s,e,t)}function DM(s,e,t,n){let r=typeof e=="string"?ph(e):e,i=tN(r.pathname||"/",t);if(i==null)return null;let a=ZC(s);MM(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=qM(i);o=zM(a[l],u)}return o}function ZC(s,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let r=(i,a,o)=>{let l={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};l.relativePath.startsWith("/")&&(Xt(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=Oc([n,l.relativePath]),h=t.concat(l);i.children&&i.children.length>0&&(Xt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),ZC(i.children,e,h,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:HM(u,i.index),routesMeta:h})};return s.forEach((i,a)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))r(i,a);else for(let l of eN(i.path))r(i,a,l)}),e}function eN(s){let e=s.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return r?[i,""]:[i];let a=eN(n.join("/")),o=[];return o.push(...a.map(l=>l===""?i:[i,l].join("/"))),r&&o.push(...a),o.map(l=>s.startsWith("/")&&l===""?"/":l)}function MM(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:VM(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const IM=/^:[\w-]+$/,OM=3,FM=2,$M=1,UM=10,BM=-2,b1=s=>s==="*";function HM(s,e){let t=s.split("/"),n=t.length;return t.some(b1)&&(n+=BM),e&&(n+=FM),t.filter(r=>!b1(r)).reduce((r,i)=>r+(IM.test(i)?OM:i===""?$M:UM),n)}function VM(s,e){return s.length===e.length&&s.slice(0,-1).every((n,r)=>n===e[r])?s[s.length-1]-e[e.length-1]:0}function zM(s,e,t){let{routesMeta:n}=s,r={},i="/",a=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=WM({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},h),p=l.route;if(!f)return null;Object.assign(r,f.params),a.push({params:r,pathname:Oc([i,f.pathname]),pathnameBase:JM(Oc([i,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(i=Oc([i,f.pathnameBase]))}return a}function WM(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,n]=GM(s.path,s.caseSensitive,s.end),r=e.match(t);if(!r)return null;let i=r[0],a=i.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce((u,h,f)=>{let{paramName:p,isOptional:m}=h;if(p==="*"){let y=o[f]||"";a=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const g=o[f];return m&&!g?u[p]=void 0:u[p]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:a,pattern:s}}function GM(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),JC(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let n=[],r="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(n.push({paramName:"*"}),r+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":s!==""&&s!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function qM(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return JC(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),s}}function tN(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=s.charAt(t);return n&&n!=="/"?null:s.slice(t)||"/"}function KM(s,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:r=""}=typeof s=="string"?ph(s):s;return{pathname:t?t.startsWith("/")?t:XM(t,e):e,search:QM(n),hash:ZM(r)}}function XM(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function ex(s,e,t,n){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function YM(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function sN(s,e){let t=YM(s);return e?t.map((n,r)=>r===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function nN(s,e,t,n){n===void 0&&(n=!1);let r;typeof s=="string"?r=ph(s):(r=zf({},s),Xt(!r.pathname||!r.pathname.includes("?"),ex("?","pathname","search",r)),Xt(!r.pathname||!r.pathname.includes("#"),ex("#","pathname","hash",r)),Xt(!r.search||!r.search.includes("#"),ex("#","search","hash",r)));let i=s===""||r.pathname==="",a=i?"/":r.pathname,o;if(a==null)o=t;else{let f=e.length-1;if(!n&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),f-=1;r.pathname=p.join("/")}o=f>=0?e[f]:"/"}let l=KM(r,o),u=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||h)&&(l.pathname+="/"),l}const Oc=s=>s.join("/").replace(/\/\/+/g,"/"),JM=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),QM=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,ZM=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function eI(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const rN=["post","put","patch","delete"];new Set(rN);const tI=["get",...rN];new Set(tI);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wf(){return Wf=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},Wf.apply(this,arguments)}const o_=_.createContext(null),sI=_.createContext(null),Im=_.createContext(null),Qy=_.createContext(null),Xc=_.createContext({outlet:null,matches:[],isDataRoute:!1}),iN=_.createContext(null);function Om(){return _.useContext(Qy)!=null}function l_(){return Om()||Xt(!1),_.useContext(Qy).location}function aN(s){_.useContext(Im).static||_.useLayoutEffect(s)}function oN(){let{isDataRoute:s}=_.useContext(Xc);return s?mI():nI()}function nI(){Om()||Xt(!1);let s=_.useContext(o_),{basename:e,future:t,navigator:n}=_.useContext(Im),{matches:r}=_.useContext(Xc),{pathname:i}=l_(),a=JSON.stringify(sN(r,t.v7_relativeSplatPath)),o=_.useRef(!1);return aN(()=>{o.current=!0}),_.useCallback(function(u,h){if(h===void 0&&(h={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let f=nN(u,JSON.parse(a),i,h.relative==="path");s==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Oc([e,f.pathname])),(h.replace?n.replace:n.push)(f,h.state,h)},[e,n,a,i,s])}function rI(s,e){return iI(s,e)}function iI(s,e,t,n){Om()||Xt(!1);let{navigator:r}=_.useContext(Im),{matches:i}=_.useContext(Xc),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let u=l_(),h;if(e){var f;let b=typeof e=="string"?ph(e):e;l==="/"||(f=b.pathname)!=null&&f.startsWith(l)||Xt(!1),h=b}else h=u;let p=h.pathname||"/",m=p;if(l!=="/"){let b=l.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(b.length).join("/")}let g=LM(s,{pathname:m}),y=uI(g&&g.map(b=>Object.assign({},b,{params:Object.assign({},o,b.params),pathname:Oc([l,r.encodeLocation?r.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?l:Oc([l,r.encodeLocation?r.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),i,t,n);return e&&y?_.createElement(Qy.Provider,{value:{location:Wf({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Io.Pop}},y):y}function aI(){let s=pI(),e=eI(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),t?_.createElement("pre",{style:r},t):null,null)}const oI=_.createElement(aI,null);class lI extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?_.createElement(Xc.Provider,{value:this.props.routeContext},_.createElement(iN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function cI(s){let{routeContext:e,match:t,children:n}=s,r=_.useContext(o_);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(Xc.Provider,{value:e},n)}function uI(s,e,t,n){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),s==null){var i;if(!t)return null;if(t.errors)s=t.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let a=s,o=(r=t)==null?void 0:r.errors;if(o!=null){let h=a.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);h>=0||Xt(!1),a=a.slice(0,Math.min(a.length,h+1))}let l=!1,u=-1;if(t&&n&&n.v7_partialHydration)for(let h=0;h<a.length;h++){let f=a[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=h),f.route.id){let{loaderData:p,errors:m}=t,g=f.route.loader&&p[f.route.id]===void 0&&(!m||m[f.route.id]===void 0);if(f.route.lazy||g){l=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((h,f,p)=>{let m,g=!1,y=null,b=null;t&&(m=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||oI,l&&(u<0&&p===0?(gI("route-fallback"),g=!0,b=null):u===p&&(g=!0,b=f.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,p+1)),x=()=>{let w;return m?w=y:g?w=b:f.route.Component?w=_.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=h,_.createElement(cI,{match:f,routeContext:{outlet:h,matches:v,isDataRoute:t!=null},children:w})};return t&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?_.createElement(lI,{location:t.location,revalidation:t.revalidation,component:y,error:m,children:x(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):x()},null)}var lN=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(lN||{}),cN=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(cN||{});function dI(s){let e=_.useContext(o_);return e||Xt(!1),e}function hI(s){let e=_.useContext(sI);return e||Xt(!1),e}function fI(s){let e=_.useContext(Xc);return e||Xt(!1),e}function uN(s){let e=fI(),t=e.matches[e.matches.length-1];return t.route.id||Xt(!1),t.route.id}function pI(){var s;let e=_.useContext(iN),t=hI(),n=uN();return e!==void 0?e:(s=t.errors)==null?void 0:s[n]}function mI(){let{router:s}=dI(lN.UseNavigateStable),e=uN(cN.UseNavigateStable),t=_.useRef(!1);return aN(()=>{t.current=!0}),_.useCallback(function(r,i){i===void 0&&(i={}),t.current&&(typeof r=="number"?s.navigate(r):s.navigate(r,Wf({fromRouteId:e},i)))},[s,e])}const S1={};function gI(s,e,t){S1[s]||(S1[s]=!0)}function yI(s,e){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function Uh(s){let{to:e,replace:t,state:n,relative:r}=s;Om()||Xt(!1);let{future:i,static:a}=_.useContext(Im),{matches:o}=_.useContext(Xc),{pathname:l}=l_(),u=oN(),h=nN(e,sN(o,i.v7_relativeSplatPath),l,r==="path"),f=JSON.stringify(h);return _.useEffect(()=>u(JSON.parse(f),{replace:t,state:n,relative:r}),[u,f,r,t,n]),null}function Bh(s){Xt(!1)}function vI(s){let{basename:e="/",children:t=null,location:n,navigationType:r=Io.Pop,navigator:i,static:a=!1,future:o}=s;Om()&&Xt(!1);let l=e.replace(/^\/*/,"/"),u=_.useMemo(()=>({basename:l,navigator:i,static:a,future:Wf({v7_relativeSplatPath:!1},o)}),[l,o,i,a]);typeof n=="string"&&(n=ph(n));let{pathname:h="/",search:f="",hash:p="",state:m=null,key:g="default"}=n,y=_.useMemo(()=>{let b=tN(h,l);return b==null?null:{location:{pathname:b,search:f,hash:p,state:m,key:g},navigationType:r}},[l,h,f,p,m,g,r]);return y==null?null:_.createElement(Im.Provider,{value:u},_.createElement(Qy.Provider,{children:t,value:y}))}function xI(s){let{children:e,location:t}=s;return rI(Tw(e),t)}new Promise(()=>{});function Tw(s,e){e===void 0&&(e=[]);let t=[];return _.Children.forEach(s,(n,r)=>{if(!_.isValidElement(n))return;let i=[...e,r];if(n.type===_.Fragment){t.push.apply(t,Tw(n.props.children,i));return}n.type!==Bh&&Xt(!1),!n.props.index||!n.props.children||Xt(!1);let a={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=Tw(n.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const wI="6";try{window.__reactRouterVersion=wI}catch{}const bI="startTransition",_1=xL[bI];function SI(s){let{basename:e,children:t,future:n,window:r}=s,i=_.useRef();i.current==null&&(i.current=jM({window:r,v5Compat:!0}));let a=i.current,[o,l]=_.useState({action:a.action,location:a.location}),{v7_startTransition:u}=n||{},h=_.useCallback(f=>{u&&_1?_1(()=>l(f)):l(f)},[l,u]);return _.useLayoutEffect(()=>a.listen(h),[a,h]),_.useEffect(()=>yI(n),[n]),_.createElement(vI,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:n})}var E1;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(E1||(E1={}));var A1;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(A1||(A1={}));const yg="accessToken",vg="refreshToken",xg="userData",nn={storeTokens(s,e){localStorage.setItem(yg,s),localStorage.setItem(vg,e)},getStoredTokens(){return{accessToken:localStorage.getItem(yg),refreshToken:localStorage.getItem(vg)}},getStoredAccessToken(){return localStorage.getItem(yg)},getStoredRefreshToken(){return localStorage.getItem(vg)},clearStoredTokens(){localStorage.removeItem(yg),localStorage.removeItem(vg),localStorage.removeItem(xg)},isTokensStored(){const s=this.getStoredTokens();return!!(s.accessToken&&s.refreshToken)},storeUserData(s){localStorage.setItem(xg,JSON.stringify(s))},getUserData(){const s=localStorage.getItem(xg);return s?JSON.parse(s):null},clearUserData(){localStorage.removeItem(xg)},decodeToken(s){try{const t=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}catch(e){return console.error("Error decoding token:",e),null}},isTokenExpired(s){if(!s)return!0;const e=this.decodeToken(s);if(!e||!e.exp)return!0;const t=Date.now()/1e3;return e.exp<t},getTokenExpiration(s){const e=this.decodeToken(s);return e?e.exp*1e3:null},shouldRefreshToken(s){if(!s)return!0;const e=this.decodeToken(s);if(!e||!e.exp)return!0;const t=Date.now()/1e3;return e.exp-t<300},async autoRefreshToken(){const s=this.getStoredTokens();if(!s.accessToken||!s.refreshToken)return!1;if(this.shouldRefreshToken(s.accessToken))try{const e=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s.refreshToken})});if(e.ok){const t=await e.json();return this.storeTokens(t.accessToken,t.refreshToken),!0}else return this.clearStoredTokens(),!1}catch(e){return console.error("Token refresh error:",e),this.clearStoredTokens(),!1}return!0}};class _I{constructor(){this.isEnabled=localStorage.getItem("api-debug")==="true",this.logs=[],this.maxLogs=100}log(e,t,n,r=null){if(!this.isEnabled)return;const i=new Date().toISOString(),a={timestamp:i,level:e,category:t,message:n,data:r?JSON.parse(JSON.stringify(r)):null};this.logs.unshift(a),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs));const o={info:"color: #3B82F6; font-weight: bold;",success:"color: #10B981; font-weight: bold;",warning:"color: #F59E0B; font-weight: bold;",error:"color: #EF4444; font-weight: bold;",debug:"color: #8B5CF6; font-weight: bold;"};console.group(`%c[API ${e.toUpperCase()}] ${t}`,o[e]),console.log(`%c${n}`,"color: #374151;"),r&&console.log("%cData:","color: #6B7280; font-weight: bold;",r),console.log(`%cTime: ${i}`,"color: #9CA3AF; font-size: 0.8em;"),console.groupEnd()}info(e,t,n=null){this.log("info",e,t,n)}success(e,t,n=null){this.log("success",e,t,n)}warning(e,t,n=null){this.log("warning",e,t,n)}error(e,t,n=null){this.log("error",e,t,n)}debug(e,t,n=null){this.log("debug",e,t,n)}logRequest(e,t,n=null){this.info("REQUEST",`${e} ${t}`,{method:e,url:t,body:n,timestamp:Date.now()})}logResponse(e,t,n,r=null){const a=n.status>=200&&n.status<300?"success":"error";this[a]("RESPONSE",`${e} ${t} - ${n.status}`,{status:n.status,statusText:n.statusText,data:n.data||n,duration:r?`${r}ms`:null,timestamp:Date.now()})}logError(e,t,n){this.error("ERROR",`${e} ${t} - ${n.message}`,{error:n.message,stack:n.stack,timestamp:Date.now()})}getLogs(){return this.logs}clearLogs(){this.logs=[]}exportLogs(){const e=JSON.stringify(this.logs,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`api-debug-logs-${new Date().toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(n)}enable(){this.isEnabled=!0,localStorage.setItem("api-debug","true"),this.info("DEBUG","API debugging enabled")}disable(){this.isEnabled=!1,localStorage.setItem("api-debug","false"),this.info("DEBUG","API debugging disabled")}}const R=new _I;typeof window<"u"&&(window.apiDebugger=R);const EI="lang-school-cache",X0="kv",k1=1,T1="app_cache_version";function AI(){return new Promise((s,e)=>{if(!("indexedDB"in window))return s(null);const t=indexedDB.open(EI,1);t.onupgradeneeded=()=>{const n=t.result;if(!n.objectStoreNames.contains(X0)){const r=n.createObjectStore(X0,{keyPath:"key"});r.createIndex("lastAccessed","lastAccessed"),r.createIndex("size","size")}},t.onsuccess=()=>s(t.result),t.onerror=()=>s(null)})}async function Pr(s,e,t){return s?new Promise((n,r)=>{const i=s.transaction(X0,e),a=i.objectStore(X0),o=t(a);i.oncomplete=()=>n(o),i.onerror=()=>r(i.error)}):null}function kI(s){try{return new Blob([JSON.stringify(s)]).size}catch{return 0}}function wg(){return Date.now()}class TI{constructor(e={}){this.db=null,this.maxBytes=e.maxBytes||100*1024*1024,this.namespace=e.namespace||"default",this.fallback=window.localStorage}async init(){this.db=await AI();const e=this.fallback.getItem(T1);return String(e)!==String(k1)&&(await this.clearAll(),this.fallback.setItem(T1,String(k1))),this}buildKey(e){return`${this.namespace}:${e}`}async get(e){const t=this.buildKey(e);if(!this.db){const r=this.fallback.getItem(t);if(!r)return null;const i=JSON.parse(r);return i.expiresAt&&Date.now()>i.expiresAt?(this.fallback.removeItem(t),null):i.value}const n=await Pr(this.db,"readonly",r=>r.get(t));if(n){if(n.expiresAt&&Date.now()>n.expiresAt)return await Pr(this.db,"readwrite",i=>i.delete(t)),null;const r={key:t,value:n.value,size:n.size,lastAccessed:wg(),createdAt:n.createdAt,ttl:n.ttl,expiresAt:n.expiresAt};return await Pr(this.db,"readwrite",i=>i.put(r)),n.value}return null}async set(e,t,n=null){const r=this.buildKey(e),i={key:r,value:t,size:kI(t),lastAccessed:wg(),createdAt:wg(),ttl:n,expiresAt:n?wg()+n:null};try{if(!this.db){this.fallback.setItem(r,JSON.stringify(i));return}await Pr(this.db,"readwrite",a=>a.put(i)),await this.ensureWithinQuota()}catch{await this.evictLeastRecentlyUsed();try{this.db?await Pr(this.db,"readwrite",o=>o.put(i)):this.fallback.setItem(r,JSON.stringify(i))}catch{await this.clearAll()}}}async remove(e){const t=this.buildKey(e);if(!this.db){this.fallback.removeItem(t);return}await Pr(this.db,"readwrite",n=>n.delete(t))}async clearAll(){this.db&&await Pr(this.db,"readwrite",t=>t.clear());const e=`${this.namespace}:
`;for(let t=this.fallback.length-1;t>=0;t--){const n=this.fallback.key(t);n&&n.startsWith(e)&&this.fallback.removeItem(n)}}async ensureWithinQuota(){if(!this.db)return;let e=0;const t=[];if(await Pr(this.db,"readonly",r=>new Promise((i,a)=>{const o=r.openCursor();o.onsuccess=()=>{const l=o.result;if(l){const u=l.value;e+=u.size||0,t.push(u),l.continue()}else i()},o.onerror=()=>i()})),e<=this.maxBytes)return;t.sort((r,i)=>(r.lastAccessed||0)-(i.lastAccessed||0));let n=0;for(;e>this.maxBytes&&n<t.length;){const r=t[n++];await Pr(this.db,"readwrite",i=>i.delete(r.key)),e-=r.size||0}}async evictLeastRecentlyUsed(e=5){if(!this.db)return;const t=[];await Pr(this.db,"readonly",n=>new Promise((r,i)=>{const a=n.openCursor();a.onsuccess=()=>{const o=a.result;o?(t.push(o.value),o.continue()):r()},a.onerror=()=>r()})),t.sort((n,r)=>(n.lastAccessed||0)-(r.lastAccessed||0));for(let n=0;n<Math.min(e,t.length);n++)await Pr(this.db,"readwrite",r=>r.delete(t[n].key))}}function C1(s,e=""){const t=e?`:${e}`:"";return{dataKey:`cache:${s}${t}`,etagKey:`etag:${s}${t}`,versionKey:`version:${s}${t}`}}async function dN(s="default"){const e=new TI({namespace:s});return await e.init(),e}const CI="/api",N1=(()=>{try{const s=nn.getUserData();return s!=null&&s.id?`user:${s.id}`:"anon"}catch{return"anon"}})(),tx=dN(N1).then(s=>(console.log(` [CACHE] Initialized cache for namespace: ${N1}`),s)).catch(s=>{throw console.error(" [CACHE] Failed to initialize cache:",s),s});class NI{constructor(){this.baseURL=CI}getAuthHeaders(){const e=nn.getStoredAccessToken(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}async makePublicRequest(e,t={}){const n=`${this.baseURL}${e}`,r={...t,headers:{"Content-Type":"application/json",...t.headers}},i=Date.now(),a=t.method||"GET";R.logRequest(a,n,t.body?JSON.parse(t.body):null);try{const o=await fetch(n,r),l=Date.now()-i;if(R.debug("NETWORK",`Response received for ${a} ${n}`,{status:o.status,statusText:o.statusText,duration:`${l}ms`,headers:Object.fromEntries(o.headers.entries())}),!o.ok){if(o.status===502){const p=new Error("Service temporarily unavailable. Please try again later.");throw R.logError(a,n,p),p}const h=await o.json().catch(()=>({error:"Unknown error"})),f=new Error(h.error||`HTTP ${o.status}`);throw f.status=o.status,R.logError(a,n,f),f}const u=await o.json();return R.logResponse(a,n,{status:o.status,data:u},l),u}catch(o){const l=Date.now()-i;if(R.logError(a,n,o),o.message.includes("Service temporarily unavailable")){const u={success:!1,error:"Service temporarily unavailable",status:502};return R.logResponse(a,n,u,l),u}if(o.name==="TypeError"&&o.message.includes("fetch")){R.warning("API","Backend server not available, using fallback data",{endpoint:e,error:o.message});const u={success:!1,error:"Backend server not available",status:0};return R.logResponse(a,n,u,l),u}throw o}}async makeRequest(e,t={}){const n=`${this.baseURL}${e}`,r={...t,headers:{...this.getAuthHeaders(),...t.headers}};t.body&&typeof t.body=="string"&&(r.headers["Content-Type"]="application/json");const i=Date.now(),a=t.method||"GET";R.logRequest(a,n,t.body?JSON.parse(t.body):null);try{const o=await fetch(n,r),l=Date.now()-i;if(R.debug("NETWORK",`Response received for ${a} ${n}`,{status:o.status,statusText:o.statusText,duration:`${l}ms`,headers:Object.fromEntries(o.headers.entries())}),!o.ok){if(o.status===502){const p=new Error("Service temporarily unavailable. Please try again later.");throw R.logError(a,n,p),p}const h=await o.json().catch(()=>({error:"Unknown error"})),f=new Error(h.error||`HTTP ${o.status}`);throw f.status=o.status,R.logError(a,n,f),f}const u=await o.json();return R.logResponse(a,n,{status:o.status,data:u},l),u}catch(o){const l=Date.now()-i;if(R.logError(a,n,o),o.message.includes("Service temporarily unavailable")){const u={success:!1,error:"Service temporarily unavailable",status:502};return R.logResponse(a,n,u,l),u}throw o}}async fetchWithCache(e,t={},n={}){const r=`${this.baseURL}${e}`,i=t.method||"GET",a=n.resource||e.split("?")[0].replace(/^\//,"").replace(/\//g,":"),o=e.includes("?")?e.split("?")[1]:"",l=o?`?${o}`:"",u=n.cacheKey||`${a}${l}`,{dataKey:h,etagKey:f}=C1(a,u),p=5*60*1e3,m=await tx,g=await m.get(h),y=await m.get(f);console.log(` [CACHE] ${e}`,{hasCachedData:!!g,hasCachedEtag:!!y,dataKey:h,etagKey:f,resource:a,cacheKeyHint:u,cachedDataSize:g?JSON.stringify(g).length:0});const b={...this.getAuthHeaders(),...t.headers||{}};y&&typeof y=="string"&&(b["If-None-Match"]=y);const v=Date.now();R.logRequest(i,r,t.body?JSON.parse(t.body):null);try{const x=await fetch(r,{...t,headers:b}),w=Date.now()-v,E=Object.fromEntries(x.headers.entries());if(R.debug("NETWORK",`Response received for ${i} ${r}`,{status:x.status,statusText:x.statusText,duration:`${w}ms`,headers:E}),x.status===304&&g)return R.success("CACHE","Serving cached data (304)",{endpoint:e}),g;if(!x.ok){const j=await x.json().catch(()=>({error:"Unknown error"})),P=new Error(j.error||`HTTP ${x.status}`);if(P.status=x.status,R.logError(i,r,P),g)return console.log(` [CACHE] Network error, returning cached data for ${e}`,{status:x.status,hasCachedData:!!g,cachedDataSize:JSON.stringify(g).length}),window.dispatchEvent(new CustomEvent("cache:fallback",{detail:{endpoint:e,resource:a,reason:"network_error"}})),R.warning("CACHE","Network error, returning cached data",{endpoint:e}),g;throw console.log(` [CACHE] Network error and no cached data for ${e}`,{status:x.status,hasCachedData:!!g}),P}const T=await x.json();R.logResponse(i,r,{status:x.status,data:T},w);const C=x.headers.get("ETag")||x.headers.get("Etag")||x.headers.get("etag"),N=JSON.parse(JSON.stringify(T));return console.log(` [CACHE] Storing data for ${e}`,{dataKey:h,etagKey:f,dataSize:JSON.stringify(N).length,hasEtag:!!C}),await m.set(h,N,p),C&&await m.set(f,C,p),await this.warmCacheForResource(a,N,C,m),T}catch(x){if(console.log(` [CACHE] Exception occurred for ${e}`,{error:x.message,hasCachedData:!!g,cachedDataSize:g?JSON.stringify(g).length:0}),R.logError(i,r,x),g)return console.log(` [CACHE] Exception fallback, returning cached data for ${e}`),window.dispatchEvent(new CustomEvent("cache:fallback",{detail:{endpoint:e,resource:a,reason:"exception"}})),R.warning("CACHE","Error occurred, returning cached data",{endpoint:e}),g;throw console.log(` [CACHE] Exception and no cached data for ${e}`),x}}async invalidateListCache(e){try{const t=await tx,n=await this.getCacheKeys(e);for(const r of n)r.includes(e)&&await t.remove(r)}catch(t){console.warn("Cache invalidation failed:",t)}}async getCacheKeys(e){return[`cache:${e}`,`etag:${e}`,`version:${e}`]}async warmCacheForResource(e,t,n,r){try{const a={teachers:["?status=active","?status=inactive",""],students:["?status=active&limit=100","?status=active&page=1&limit=50&sort_by=added_date&sort_order=desc","?status=active"]}[e]||[];for(const o of a){const l=`${e}${o}`,{dataKey:u,etagKey:h}=C1(e,l);await r.get(u)||(console.log(` [CACHE] Warming cache for ${l}`),await r.set(u,t,this.TTL),n&&await r.set(h,n,this.TTL))}}catch(i){console.warn("Cache warming failed:",i)}}async getVersions(){return this.makeRequest("/versions")}async login(e,t){var n,r;R.info("AUTH","Attempting login",{username:e,hasPassword:!!t});try{const i=await this.makeRequest("/auth/login",{method:"POST",body:JSON.stringify({username:e,password:t})});return i.success?R.success("AUTH","Login successful",{username:e,role:(n=i.user)==null?void 0:n.role,userId:(r=i.user)==null?void 0:r.id}):R.warning("AUTH","Login failed",{username:e,error:i.error}),i}catch(i){throw R.error("AUTH","Login error",{username:e,error:i.message}),i}}async refreshToken(e){R.debug("AUTH","Refreshing token",{hasToken:!!e});try{const t=await this.makeRequest("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return t.success?R.success("AUTH","Token refreshed successfully"):R.warning("AUTH","Token refresh failed",{error:t.error}),t}catch(t){throw R.error("AUTH","Token refresh error",{error:t.message}),t}}async logout(){return this.makeRequest("/auth/logout",{method:"POST"})}async verifyToken(){return this.makeRequest("/auth/verify")}async changePassword(e,t){return this.makeRequest("/auth/change-password",{method:"POST",body:JSON.stringify({oldPassword:e,newPassword:t})})}async getProfile(){return this.makeRequest("/auth/profile")}async validateCredentials(e,t){return this.makeRequest("/auth/validate-credentials",{method:"POST",body:JSON.stringify({username:e,password:t})})}async checkUsername(e){return this.makeRequest(`/auth/check-username/${encodeURIComponent(e)}`)}async getTeachers(e={}){console.log(" [API] getTeachers called with filters:",e);const t=new URLSearchParams;Object.entries(e).forEach(([a,o])=>{o!=null&&o!==""&&t.append(a,o)}),t.append("_t",Date.now());const n=t.toString(),r=`/teachers${n?`?${n}`:""}`;console.log(" [API] getTeachers URL:",r);const i=await this.fetchWithCache(r,{method:"GET"},{resource:"teachers",cacheKey:n});return console.log(" [API] getTeachers result:",i),i}async getTeacher(e){return this.fetchWithCache(`/teachers/${e}`,{method:"GET"},{resource:"teacher",cacheKey:e})}async createTeacher(e){return this.makeRequest("/teachers",{method:"POST",body:JSON.stringify(e)})}async updateTeacher(e,t){const n=await this.makeRequest(`/teachers/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success&&(await(await tx).remove(`cache:teacher:${e}`),await this.invalidateListCache("teachers")),n}async deactivateTeacher(e){return this.makeRequest(`/teachers/${e}/deactivate`,{method:"POST"})}async deleteTeacher(e){return this.makeRequest(`/teachers/${e}`,{method:"DELETE"})}async reactivateTeacher(e){return this.makeRequest(`/teachers/${e}/reactivate`,{method:"POST"})}async getTeacherStudents(e){return this.fetchWithCache(`/teachers/${e}/students`,{method:"GET"},{resource:"teachers",cacheKey:`students-${e}`})}async getTeacherSchedule(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/teachers/${e}/schedule${n}`)}async getTeacherStats(e,t={}){const n=new URLSearchParams(t).toString(),r=`/teachers/${e}/stats${n?`?${n}`:""}`;return this.fetchWithCache(r,{method:"GET"},{resource:"teachers",cacheKey:`stats-${e}-${n||"all"}`})}async getMonthlyLessonStats(e,t){const r=`/teachers/monthly-stats?${new URLSearchParams({month:e,year:t}).toString()}`;return this.fetchWithCache(r,{method:"GET"},{resource:"teachers",cacheKey:`monthly-stats-${t}-${e}`})}async getRandomTeachers(e=3){var t,n;R.info("TEACHERS","Fetching random teachers (public)",{count:e});try{const r=await this.makePublicRequest(`/teachers/random/${e}`);if(r.success)return R.success("TEACHERS","Random teachers fetched",{count:((t=r.teachers)==null?void 0:t.length)||0,teacherIds:((n=r.teachers)==null?void 0:n.map(i=>i.id))||[]}),r;{R.warning("TEACHERS","Failed to fetch random teachers from API",{count:e,error:r.error});const i=[{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience. Specializes in business English and conversation practice.",photo_url:"/pics/teachers/sarah.jpg"},{id:2,name:"Michael Chen",description:"Native Mandarin speaker teaching Chinese language and culture. Patient and encouraging teaching style.",photo_url:"/pics/teachers/michael.jpg"},{id:3,name:"Elena Rodriguez",description:"Spanish teacher from Madrid with expertise in grammar and pronunciation. Loves teaching through music and culture.",photo_url:"/pics/teachers/elena.jpg"}].slice(0,e);return R.info("TEACHERS","Using fallback teacher data",{count:i.length,reason:"API unavailable"}),{success:!0,teachers:i,fallback:!0}}}catch(r){R.error("TEACHERS","Error fetching random teachers",{count:e,error:r.message});const i=[{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience. Specializes in business English and conversation practice.",photo_url:"/pics/teachers/sarah.jpg"},{id:2,name:"Michael Chen",description:"Native Mandarin speaker teaching Chinese language and culture. Patient and encouraging teaching style.",photo_url:"/pics/teachers/michael.jpg"},{id:3,name:"Elena Rodriguez",description:"Spanish teacher from Madrid with expertise in grammar and pronunciation. Loves teaching through music and culture.",photo_url:"/pics/teachers/elena.jpg"}].slice(0,e);return R.info("TEACHERS","Using fallback teacher data due to error",{count:i.length,error:r.message}),{success:!0,teachers:i,fallback:!0}}}async getTeacherMonthlyStats(e,t,n){return this.makeRequest(`/teachers/${e}/monthly-stats/${t}/${n}`)}async getTeacherAttendance(e,t,n){const r=new URLSearchParams;t&&r.append("start_date",t),n&&r.append("end_date",n);const i=r.toString();return this.makeRequest(`/teachers/${e}/attendance${i?`?${i}`:""}`)}async getTeacherLessons(e,t,n,r,i){const a=new URLSearchParams;t&&a.append("start_date",t),n&&a.append("end_date",n),r&&a.append("page",r),i&&a.append("limit",i);const o=a.toString();return this.makeRequest(`/teachers/${e}/lessons${o?`?${o}`:""}`)}async uploadTeacherPhoto(e,t){return this.makeRequest(`/teachers/${e}/upload-photo`,{method:"POST",body:JSON.stringify({photo_url:t})})}async searchTeachers(e,t=1,n=50){const r=new URLSearchParams({q:e,page:t,limit:n});return this.makeRequest(`/teachers/search?${r}`)}async getInactiveTeachers(){return this.makeRequest("/teachers/inactive")}async bulkUpdateTeachers(e,t){return this.makeRequest("/teachers/bulk-update",{method:"POST",body:JSON.stringify({teacherIds:e,updates:t})})}async reactivateStudent(e){return this.makeRequest(`/students/${e}/reactivate`,{method:"POST"})}async getStudentSchedule(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/students/${e}/schedule${n}`)}async getStudentLessons(e){return this.makeRequest(`/students/${e}/lessons`)}async reassignStudent(e,t){return this.makeRequest(`/students/${e}/reassign`,{method:"POST",body:JSON.stringify({new_teacher_id:t})})}async searchStudents(e,t=1,n=50){const r=new URLSearchParams({q:e,page:t,limit:n});return this.makeRequest(`/students/search?${r}`)}async getStudentAttendance(e,t){const n=t?`?period=${t}`:"";return this.makeRequest(`/students/${e}/attendance${n}`)}async getStudentProgress(e){return this.makeRequest(`/students/${e}/progress`)}async getStudentsByTeacher(e){return this.makeRequest(`/students/teacher/${e}`)}async getInactiveStudents(){return this.makeRequest("/students/inactive")}async exportStudents(){return this.makeRequest("/students/export")}async getStudentTeachers(e){return this.makeRequest(`/students/${e}/teachers`)}async bulkUpdateStudents(e,t){return this.makeRequest("/students/bulk-update",{method:"POST",body:JSON.stringify({studentIds:e,updates:t})})}async getSchedules(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.fetchWithCache(`/schedules${n?`?${n}`:""}`,{method:"GET"},{resource:"schedules",cacheKey:n})}async getWeeklySchedule(e){return this.makeRequest(`/schedules/week/${e}`)}async createSchedule(e){const t=await this.makeRequest("/schedules",{method:"POST",body:JSON.stringify(e)});return t.success&&await this.invalidateListCache("teachers"),t}async updateSchedule(e,t){return this.makeRequest(`/schedules/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteSchedule(e){const t=await this.makeRequest(`/schedules/${e}`,{method:"DELETE"});return t.success&&await this.invalidateListCache("teachers"),t}async bulkUpdateSchedules(e){return this.makeRequest("/schedules/bulk",{method:"POST",body:JSON.stringify({schedules:e})})}async getScheduleConflicts(e){const t=e?`?week_start=${e}`:"";return this.makeRequest(`/schedules/conflicts${t}`)}async getTeacherSchedules(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/schedules/teacher/${e}${n}`)}async getStudentSchedules(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/schedules/student/${e}${n}`)}async getMonthlySchedules(e,t){return this.makeRequest(`/schedules/month/${e}/${t}`)}async saveWeekSchedule(e,t){return this.makeRequest("/schedules/save-week",{method:"POST",body:JSON.stringify({week_start_date:e,schedules:t})})}async discardChanges(){return this.makeRequest("/schedules/discard-changes",{method:"POST"})}async getAvailableSlots(e,t,n){const r=new URLSearchParams({teacher_id:e,day_of_week:t,week_start_date:n});return this.makeRequest(`/schedules/available-slots?${r}`)}async reassignStudentSchedules(e,t,n){return this.makeRequest("/schedules/reassign-student",{method:"POST",body:JSON.stringify({student_id:e,new_teacher_id:t,schedule_ids:n})})}async reassignStudentInSchedule(e,t,n){return this.makeRequest("/schedules/reassign-student",{method:"POST",body:JSON.stringify({student_id:e,new_teacher_id:t,schedule_ids:n})})}async getAttendance(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.makeRequest(`/attendance${n?`?${n}`:""}`)}async markAttendance(e,t,n){return this.makeRequest("/attendance/mark",{method:"POST",body:JSON.stringify({schedule_id:e,status:t,attendance_date:n})})}async updateAttendance(e,t,n){return this.makeRequest(`/attendance/${e}`,{method:"PUT",body:JSON.stringify({status:t,attendance_date:n})})}async getTeacherAttendance(e,t){const n=t?`?period=${t}`:"";return this.makeRequest(`/attendance/teacher/${e}${n}`)}async getStudentAttendance(e,t){const n=t?`?period=${t}`:"";return this.makeRequest(`/attendance/student/${e}${n}`)}async getAttendanceStats(e,t,n){const r=new URLSearchParams;e&&r.append("teacher_id",e),t&&r.append("student_id",t),n&&r.append("period",n);const i=r.toString();return this.makeRequest(`/attendance/stats${i?`?${i}`:""}`)}async getWeeklyAttendance(e){return this.makeRequest(`/attendance/week/${e}`)}async getMonthlyAttendance(e,t){return this.makeRequest(`/attendance/month/${e}/${t}`)}async bulkMarkAttendance(e){return this.makeRequest("/attendance/bulk-mark",{method:"POST",body:JSON.stringify({attendance_updates:e})})}async exportAttendance(e){const t=e?`?period=${e}`:"";return this.makeRequest(`/attendance/export${t}`)}async getStudentAttendanceAnalytics(e,t,n,r="week"){const i=new URLSearchParams;return t&&i.append("from",t),n&&i.append("to",n),i.append("bucket",r),this.fetchWithCache(`/analytics/students/${e}/attendance?${i.toString()}`,{method:"GET"},{resource:"analytics",cacheKey:`student_${e}_${t}_${n}`})}async getTeacherAttendanceAnalytics(e,t,n,r="week"){const i=new URLSearchParams;return t&&i.append("from",t),n&&i.append("to",n),i.append("bucket",r),this.fetchWithCache(`/analytics/teachers/${e}/attendance?${i.toString()}`,{method:"GET"},{resource:"analytics",cacheKey:`teacher_${e}_${t}_${n}`})}async getMyTeacherAttendanceAnalytics(e,t,n="week"){const r=new URLSearchParams;return e&&r.append("from",e),t&&r.append("to",t),r.append("bucket",n),this.fetchWithCache(`/analytics/teachers/me/attendance?${r.toString()}`,{method:"GET"},{resource:"analytics",cacheKey:`teacher_me_${e}_${t}`})}async getReports(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.makeRequest(`/reports${n?`?${n}`:""}`)}async getReport(e){return this.makeRequest(`/reports/${e}`)}async createReport(e){return this.makeRequest("/reports",{method:"POST",body:JSON.stringify(e)})}async updateReport(e,t){return this.makeRequest(`/reports/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteReport(e){return this.makeRequest(`/reports/${e}`,{method:"DELETE"})}async getTeacherReports(e,t={}){const n=new URLSearchParams;Object.entries(t).forEach(([i,a])=>{a!=null&&a!==""&&n.append(i,a)});const r=n.toString();return this.makeRequest(`/reports/teacher/${e}${r?`?${r}`:""}`)}async getStudentReports(e,t={}){const n=new URLSearchParams;Object.entries(t).forEach(([i,a])=>{a!=null&&a!==""&&n.append(i,a)});const r=n.toString();return this.makeRequest(`/reports/student/${e}${r?`?${r}`:""}`)}async getReportsByDate(e){return this.makeRequest(`/reports/date/${e}`)}async getWeeklyReports(e){return this.makeRequest(`/reports/week/${e}`)}async getMonthlyReports(e,t){return this.makeRequest(`/reports/month/${e}/${t}`)}async bulkCreateReports(e){return this.makeRequest("/reports/bulk-create",{method:"POST",body:JSON.stringify({reports:e})})}async exportReports(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.makeRequest(`/reports/export${n?`?${n}`:""}`)}async setFeaturedTeachers(e){return this.makeRequest("/content/featured-teachers",{method:"POST",body:JSON.stringify({teacher_ids:e})})}async reorderCourses(e){return this.makeRequest("/content/courses/reorder",{method:"POST",body:JSON.stringify({course_orders:e})})}async exportContent(){return this.makeRequest("/content/export")}async getTeacherPassword(e){return this.makeRequest(`/passwords/teacher/${e}`)}async changeTeacherPassword(e,t){return this.makeRequest(`/passwords/teacher/${e}`,{method:"PUT",body:JSON.stringify({new_password:t})})}async resetTeacherPassword(e,t){return this.makeRequest(`/passwords/teacher/${e}/reset`,{method:"POST",body:JSON.stringify({new_password:t})})}async bulkResetPasswords(e,t){return this.makeRequest("/passwords/bulk-reset",{method:"POST",body:JSON.stringify({teacher_ids:e,new_password:t})})}async getPasswordHistory(e){return this.makeRequest(`/passwords/history/${e}`)}async validatePassword(e){return this.makeRequest("/passwords/validate",{method:"POST",body:JSON.stringify({password:e})})}async getPasswordPolicy(){return this.makeRequest("/passwords/policy")}async checkCurrentPassword(e){return this.makeRequest("/passwords/check-current",{method:"POST",body:JSON.stringify({password:e})})}async uploadImage(e){return this.makeRequest("/cloudinary/upload",{method:"POST",body:JSON.stringify(e)})}async deleteImage(e){return this.makeRequest("/cloudinary/delete",{method:"DELETE",body:JSON.stringify({public_id:e})})}async uploadTeacherPhoto(e,t){return this.makeRequest("/cloudinary/upload-teacher-photo",{method:"POST",body:JSON.stringify({teacher_id:e,image:t})})}async uploadCourseImage(e,t){return this.makeRequest("/cloudinary/upload-course-image",{method:"POST",body:JSON.stringify({course_id:e,image:t})})}async uploadMissionBanner(e){return this.makeRequest("/cloudinary/upload-mission-banner",{method:"POST",body:JSON.stringify({image:e})})}async getTransformedImageUrl(e,t){const n=new URLSearchParams;e&&n.append("public_id",e),t&&n.append("transformations",t);const r=n.toString();return this.makeRequest(`/cloudinary/transform${r?`?${r}`:""}`)}async bulkUploadImages(e,t){return this.makeRequest("/cloudinary/bulk-upload",{method:"POST",body:JSON.stringify({images:e,folder:t})})}async listImages(e,t,n){const r=new URLSearchParams;e&&r.append("folder",e),t&&r.append("max_results",t),n&&r.append("next_cursor",n);const i=r.toString();return this.makeRequest(`/cloudinary/images${i?`?${i}`:""}`)}async getStudents(e={}){var t;R.info("STUDENTS","Fetching students",{filters:e});try{const n=new URLSearchParams;Object.entries(e).forEach(([a,o])=>{o!==void 0&&o!==""&&n.append(a,o)});const r=n.toString(),i=await this.fetchWithCache(`/students${r?`?${r}`:""}`,{method:"GET"},{resource:"students",cacheKey:r});return i.success?R.success("STUDENTS","Students fetched successfully",{count:((t=i.students)==null?void 0:t.length)||0,total:i.total||0}):R.warning("STUDENTS","Failed to fetch students",{error:i.error}),i}catch(n){throw R.error("STUDENTS","Error fetching students",{error:n.message}),n}}async getStudentMonthlyLessons(e,t){var n;R.info("STUDENTS","Fetching monthly lessons",{month:e,year:t});try{const i=`/students/monthly-lessons?${new URLSearchParams({month:e,year:t}).toString()}`,a=await this.fetchWithCache(i,{method:"GET"},{resource:"students",cacheKey:`monthly-lessons-${t}-${e}`});return a.success?R.success("STUDENTS","Monthly lessons fetched successfully",{count:((n=a.monthlyLessons)==null?void 0:n.length)||0,month:a.month,year:a.year}):R.warning("STUDENTS","Failed to fetch monthly lessons",{error:a.error}),a}catch(r){throw R.error("STUDENTS","Error fetching monthly lessons",{error:r.message}),r}}async getInactiveStudents(){var e;R.info("STUDENTS","Fetching inactive students");try{const t=await this.makeRequest("/students/inactive");return t.success?R.success("STUDENTS","Inactive students fetched",{count:((e=t.students)==null?void 0:e.length)||0}):R.warning("STUDENTS","Failed to fetch inactive students",{error:t.error}),t}catch(t){throw R.error("STUDENTS","Error fetching inactive students",{error:t.message}),t}}async getStudent(e){R.info("STUDENTS","Fetching student",{studentId:e});try{const t=await this.fetchWithCache(`/students/${e}`,{method:"GET"},{resource:"student",cacheKey:e});return t.success?R.success("STUDENTS","Student fetched successfully",{studentId:e}):R.warning("STUDENTS","Failed to fetch student",{studentId:e,error:t.error}),t}catch(t){throw R.error("STUDENTS","Error fetching student",{studentId:e,error:t.message}),t}}async createStudent(e){var t;R.info("STUDENTS","Creating student",{studentData:e});try{const n=await this.makeRequest("/students",{method:"POST",body:JSON.stringify(e)});return n.success?R.success("STUDENTS","Student created successfully",{studentId:(t=n.student)==null?void 0:t.id}):R.warning("STUDENTS","Failed to create student",{error:n.error}),n}catch(n){throw R.error("STUDENTS","Error creating student",{error:n.message}),n}}async updateStudent(e,t){R.info("STUDENTS","Updating student",{studentId:e,studentData:t});try{const n=await this.makeRequest(`/students/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?R.success("STUDENTS","Student updated successfully",{studentId:e}):R.warning("STUDENTS","Failed to update student",{studentId:e,error:n.error}),n}catch(n){throw R.error("STUDENTS","Error updating student",{studentId:e,error:n.message}),n}}async deactivateStudent(e){R.info("STUDENTS","Deactivating student",{studentId:e});try{const t=await this.makeRequest(`/students/${e}/deactivate`,{method:"POST"});return t.success?R.success("STUDENTS","Student deactivated successfully",{studentId:e}):R.warning("STUDENTS","Failed to deactivate student",{studentId:e,error:t.error}),t}catch(t){throw R.error("STUDENTS","Error deactivating student",{studentId:e,error:t.message}),t}}async deleteStudent(e){R.info("STUDENTS","Deleting student",{studentId:e});try{const t=await this.makeRequest(`/students/${e}`,{method:"DELETE"});return t.success?R.success("STUDENTS","Student deleted successfully",{studentId:e}):R.warning("STUDENTS","Failed to delete student",{studentId:e,error:t.error}),t}catch(t){throw R.error("STUDENTS","Error deleting student",{studentId:e,error:t.message}),t}}async getMissionContent(){R.info("CONTENT","Fetching mission content");try{const e=await this.makeRequest("/content/mission");return e.success?R.success("CONTENT","Mission content fetched successfully"):R.warning("CONTENT","Failed to fetch mission content",{error:e.error}),e}catch(e){throw R.error("CONTENT","Error fetching mission content",{error:e.message}),e}}async updateMissionContent(e){R.info("CONTENT","Updating mission content",{missionData:e});try{const t=await this.makeRequest("/content/mission",{method:"PUT",body:JSON.stringify(e)});return t.success?R.success("CONTENT","Mission content updated successfully"):R.warning("CONTENT","Failed to update mission content",{error:t.error}),t}catch(t){throw R.error("CONTENT","Error updating mission content",{error:t.message}),t}}async getCourses(){var e;R.info("CONTENT","Fetching courses");try{const t=await this.makeRequest("/content/courses");return t.success?R.success("CONTENT","Courses fetched successfully",{count:((e=t.courses)==null?void 0:e.length)||0}):R.warning("CONTENT","Failed to fetch courses",{error:t.error}),t}catch(t){throw R.error("CONTENT","Error fetching courses",{error:t.message}),t}}async createCourse(e){var t;R.info("CONTENT","Creating course",{courseData:e});try{const n=await this.makeRequest("/content/courses",{method:"POST",body:JSON.stringify(e)});return n.success?R.success("CONTENT","Course created successfully",{courseId:(t=n.course)==null?void 0:t.id}):R.warning("CONTENT","Failed to create course",{error:n.error}),n}catch(n){throw R.error("CONTENT","Error creating course",{error:n.message}),n}}async updateCourse(e,t){R.info("CONTENT","Updating course",{courseId:e,courseData:t});try{const n=await this.makeRequest(`/content/courses/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?R.success("CONTENT","Course updated successfully",{courseId:e}):R.warning("CONTENT","Failed to update course",{courseId:e,error:n.error}),n}catch(n){throw R.error("CONTENT","Error updating course",{courseId:e,error:n.message}),n}}async deleteCourse(e){R.info("CONTENT","Deleting course",{courseId:e});try{const t=await this.makeRequest(`/content/courses/${e}`,{method:"DELETE"});return t.success?R.success("CONTENT","Course deleted successfully",{courseId:e}):R.warning("CONTENT","Failed to delete course",{courseId:e,error:t.error}),t}catch(t){throw R.error("CONTENT","Error deleting course",{courseId:e,error:t.message}),t}}async toggleCourse(e,t){R.info("CONTENT","Toggling course",{courseId:e,isActive:t});try{const n=await this.makeRequest(`/content/courses/${e}/toggle`,{method:"PUT",body:JSON.stringify({is_active:t})});return n.success?R.success("CONTENT","Course toggled successfully",{courseId:e,isActive:t}):R.warning("CONTENT","Failed to toggle course",{courseId:e,error:n.error}),n}catch(n){throw R.error("CONTENT","Error toggling course",{courseId:e,error:n.message}),n}}async uploadImage(e,t="lang-school",n=null,r=null){R.info("CLOUDINARY","Uploading image",{folder:t,hasPublicId:!!n});try{const i=await this.makeRequest("/cloudinary/upload",{method:"POST",body:JSON.stringify({image:e,folder:t,public_id:n,transformations:r})});return i.success?R.success("CLOUDINARY","Image uploaded successfully",{publicId:i.public_id,url:i.secure_url}):R.warning("CLOUDINARY","Failed to upload image",{error:i.error}),i}catch(i){throw R.error("CLOUDINARY","Error uploading image",{error:i.message}),i}}async deleteImage(e){R.info("CLOUDINARY","Deleting image",{publicId:e});try{const t=await this.makeRequest("/cloudinary/delete",{method:"DELETE",body:JSON.stringify({public_id:e})});return t.success?R.success("CLOUDINARY","Image deleted successfully",{publicId:e}):R.warning("CLOUDINARY","Failed to delete image",{publicId:e,error:t.error}),t}catch(t){throw R.error("CLOUDINARY","Error deleting image",{publicId:e,error:t.message}),t}}async uploadCourseImage(e,t){R.info("CLOUDINARY","Uploading course image",{courseId:e});try{const n=await this.makeRequest("/cloudinary/upload-course-image",{method:"POST",body:JSON.stringify({course_id:e,image:t})});return n.success?R.success("CLOUDINARY","Course image uploaded successfully",{courseId:e,publicId:n.public_id,url:n.secure_url}):R.warning("CLOUDINARY","Failed to upload course image",{courseId:e,error:n.error}),n}catch(n){throw R.error("CLOUDINARY","Error uploading course image",{courseId:e,error:n.message}),n}}async uploadMissionBanner(e){R.info("CLOUDINARY","Uploading mission banner",{});try{const t=await this.makeRequest("/cloudinary/upload-mission-banner",{method:"POST",body:JSON.stringify({image:e})});return t.success?R.success("CLOUDINARY","Mission banner uploaded successfully",{publicId:t.public_id,url:t.secure_url}):R.warning("CLOUDINARY","Failed to upload mission banner",{error:t.error}),t}catch(t){throw R.error("CLOUDINARY","Error uploading mission banner",{error:t.message}),t}}async getShowcaseSettings(){R.info("CONTENT","Fetching showcase settings");try{const e=await this.makeRequest("/content/showcase");return e.success?R.success("CONTENT","Showcase settings fetched successfully"):R.warning("CONTENT","Failed to fetch showcase settings",{error:e.error}),e}catch(e){throw R.error("CONTENT","Error fetching showcase settings",{error:e.message}),e}}async getShowcaseSettingsPublic(){R.info("CONTENT","Fetching showcase settings (public)");try{const e=await this.makePublicRequest("/content/showcase/public");return e.success?R.success("CONTENT","Showcase settings fetched successfully (public)"):R.warning("CONTENT","Failed to fetch showcase settings (public)",{error:e.error}),e}catch(e){throw R.error("CONTENT","Error fetching showcase settings (public)",{error:e.message}),e}}async updateShowcaseSettings(e){R.info("CONTENT","Updating showcase settings",{settings:e});try{const t=await this.makeRequest("/content/showcase",{method:"PUT",body:JSON.stringify(e)});return t.success?R.success("CONTENT","Showcase settings updated successfully"):R.warning("CONTENT","Failed to update showcase settings",{error:t.error}),t}catch(t){throw R.error("CONTENT","Error updating showcase settings",{error:t.message}),t}}async getStudentTeachers(e){var t;try{R.info("TEACHER_MGMT","Fetching student teachers",{studentId:e});const n=await this.makeRequest(`/students/${e}/teachers`,{method:"GET"});return n.success?R.success("TEACHER_MGMT","Student teachers fetched successfully",{count:((t=n.teachers)==null?void 0:t.length)||0}):R.warning("TEACHER_MGMT","Failed to fetch student teachers",{error:n.error}),n}catch(n){throw R.error("TEACHER_MGMT","Error fetching student teachers",{error:n.message}),n}}async addStudentTeacher(e,t){try{R.info("TEACHER_MGMT","Adding teacher to student",{studentId:e,teacherData:t});const n=await this.makeRequest(`/students/${e}/teachers`,{method:"POST",body:JSON.stringify(t)});return n.success?(R.success("TEACHER_MGMT","Teacher added successfully"),await this.invalidateListCache("teachers")):R.warning("TEACHER_MGMT","Failed to add teacher",{error:n.error}),n}catch(n){throw R.error("TEACHER_MGMT","Error adding teacher",{error:n.message}),n}}async removeStudentTeacher(e,t){try{R.info("TEACHER_MGMT","Removing teacher from student",{studentId:e,teacherId:t});const n=await this.makeRequest(`/students/${e}/teachers/${t}`,{method:"DELETE"});return n.success?(R.success("TEACHER_MGMT","Teacher removed successfully"),await this.invalidateListCache("teachers")):R.warning("TEACHER_MGMT","Failed to remove teacher",{error:n.error}),n}catch(n){throw R.error("TEACHER_MGMT","Error removing teacher",{error:n.message}),n}}async getCurrentStudents(e){var t;try{R.info("STUDENT_SUGGESTIONS","Fetching current students",{teacherId:e});const n=await this.makeRequest(`/students/teacher/${e}/current`);return n.success?R.success("STUDENT_SUGGESTIONS","Current students fetched successfully",{count:((t=n.students)==null?void 0:t.length)||0}):R.warning("STUDENT_SUGGESTIONS","Failed to fetch current students",{error:n.error}),n}catch(n){throw R.error("STUDENT_SUGGESTIONS","Error fetching current students",{error:n.message}),n}}async getHistoryStudents(e){var t;try{R.info("STUDENT_SUGGESTIONS","Fetching history students",{teacherId:e});const n=await this.makeRequest(`/students/teacher/${e}/history`);return n.success?R.success("STUDENT_SUGGESTIONS","History students fetched successfully",{count:((t=n.students)==null?void 0:t.length)||0}):R.warning("STUDENT_SUGGESTIONS","Failed to fetch history students",{error:n.error}),n}catch(n){throw R.error("STUDENT_SUGGESTIONS","Error fetching history students",{error:n.message}),n}}async getFolders(){var e;R.info("FILES","Fetching folders");try{const t=await this.makeRequest("/files/folders");return t.success?R.success("FILES","Folders fetched successfully",{count:((e=t.folders)==null?void 0:e.length)||0}):R.warning("FILES","Failed to fetch folders",{error:t.error}),t}catch(t){throw R.error("FILES","Error fetching folders",{error:t.message}),t}}async createFolder(e){var t;R.info("FILES","Creating folder",{folderData:e});try{const n=await this.makeRequest("/files/folders",{method:"POST",body:JSON.stringify(e)});return n.success?R.success("FILES","Folder created successfully",{folderId:(t=n.folder)==null?void 0:t.id}):R.warning("FILES","Failed to create folder",{error:n.error}),n}catch(n){throw R.error("FILES","Error creating folder",{error:n.message}),n}}async updateFolder(e,t){R.info("FILES","Updating folder",{folderId:e,folderData:t});try{const n=await this.makeRequest(`/files/folders/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?R.success("FILES","Folder updated successfully",{folderId:e}):R.warning("FILES","Failed to update folder",{error:n.error}),n}catch(n){throw R.error("FILES","Error updating folder",{error:n.message}),n}}async deleteFolder(e){R.info("FILES","Deleting folder",{folderId:e});try{const t=await this.makeRequest(`/files/folders/${e}`,{method:"DELETE"});return t.success?R.success("FILES","Folder deleted successfully",{folderId:e}):R.warning("FILES","Failed to delete folder",{error:t.error}),t}catch(t){throw R.error("FILES","Error deleting folder",{error:t.message}),t}}async uploadFile(e){var t;R.info("FILES","Uploading file",{fileName:e.display_name});try{const n=await this.makeRequest("/files/upload",{method:"POST",body:JSON.stringify(e)});return n.success?R.success("FILES","File uploaded successfully",{fileId:(t=n.file)==null?void 0:t.id}):R.warning("FILES","Failed to upload file",{error:n.error}),n}catch(n){throw R.error("FILES","Error uploading file",{error:n.message}),n}}async updateFile(e,t){R.info("FILES","Updating file",{fileId:e,fileData:t});try{const n=await this.makeRequest(`/files/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?R.success("FILES","File updated successfully",{fileId:e}):R.warning("FILES","Failed to update file",{error:n.error}),n}catch(n){throw R.error("FILES","Error updating file",{error:n.message}),n}}async deleteFile(e){R.info("FILES","Deleting file",{fileId:e});try{const t=await this.makeRequest(`/files/${e}`,{method:"DELETE"});return t.success?R.success("FILES","File deleted successfully",{fileId:e}):R.warning("FILES","Failed to delete file",{error:t.error}),t}catch(t){throw R.error("FILES","Error deleting file",{error:t.message}),t}}async getFiles(e={}){var t;R.info("FILES","Fetching files",{filters:e});try{const n=new URLSearchParams(e).toString(),r=await this.makeRequest(`/files${n?`?${n}`:""}`);return r.success?R.success("FILES","Files fetched successfully",{count:((t=r.files)==null?void 0:t.length)||0}):R.warning("FILES","Failed to fetch files",{error:r.error}),r}catch(n){throw R.error("FILES","Error fetching files",{error:n.message}),n}}async downloadFile(e){R.info("FILES","Downloading file",{fileId:e});try{const t=await this.makePublicRequest(`/files/${e}/download/public`);return t.success?R.success("FILES","File download initiated",{fileId:e}):R.warning("FILES","Failed to download file",{error:t.error}),t}catch(t){throw R.error("FILES","Error downloading file",{error:t.message}),t}}async getPublicFiles(e={}){var t;R.info("FILES","Fetching public files",{filters:e});try{const n=new URLSearchParams(e).toString(),r=await this.makePublicRequest(`/files/public${n?`?${n}`:""}`);return r.success?R.success("FILES","Public files fetched successfully",{count:((t=r.files)==null?void 0:t.length)||0}):R.warning("FILES","Failed to fetch public files",{error:r.error}),r}catch(n){throw R.error("FILES","Error fetching public files",{error:n.message}),n}}async getUploadToken(e){var t,n;R.info("UPLOAD","Getting upload token",{uploadData:e});try{const r=await this.makeRequest("/upload-token",{method:"POST",body:JSON.stringify(e)});return r.success?R.success("UPLOAD","Upload token received",{cloudName:(t=r.data)==null?void 0:t.cloudName,hasSignature:!!((n=r.data)!=null&&n.signature)}):R.warning("UPLOAD","Failed to get upload token",{error:r.error}),r}catch(r){throw R.error("UPLOAD","Error getting upload token",{error:r.message}),r}}async extendSchedules(){return this.makeRequest("/schedules/extend",{method:"POST"})}async checkExtensionReminder(){return this.makeRequest("/schedules/extension-reminder",{method:"POST"})}async getStudentPackages(e={}){var t;R.info("PACKAGES","Fetching student packages",{filters:e});try{const n=new URLSearchParams;Object.entries(e).forEach(([a,o])=>{o!==void 0&&o!==""&&n.append(a,o)});const r=n.toString(),i=await this.makeRequest(`/students/packages${r?`?${r}`:""}`);return i.success?R.success("PACKAGES","Student packages fetched successfully",{count:((t=i.packages)==null?void 0:t.length)||0,total:i.total||0}):R.warning("PACKAGES","Failed to fetch student packages",{error:i.error}),i}catch(n){throw R.error("PACKAGES","Error fetching student packages",{error:n.message}),n}}async addStudentPackage(e){var t;R.info("PACKAGES","Adding student package",{packageData:e});try{const n=await this.makeRequest("/students/packages",{method:"POST",body:JSON.stringify(e)});return n.success?R.success("PACKAGES","Student package added successfully",{packageId:(t=n.package)==null?void 0:t.id}):R.warning("PACKAGES","Failed to add student package",{error:n.error}),n}catch(n){throw R.error("PACKAGES","Error adding student package",{error:n.message}),n}}async deleteStudentPackage(e){R.info("PACKAGES","Deleting student package",{packageId:e});try{const t=await this.makeRequest(`/students/packages/${e}`,{method:"DELETE"});return t.success?R.success("PACKAGES","Student package deleted successfully",{packageId:e}):R.warning("PACKAGES","Failed to delete student package",{error:t.error}),t}catch(t){throw R.error("PACKAGES","Error deleting student package",{error:t.message}),t}}async getExhaustedPackages(){var e;R.info("PACKAGES","Fetching exhausted packages");try{const t=await this.makeRequest("/students/packages/exhausted");return t.success?R.success("PACKAGES","Exhausted packages fetched successfully",{count:((e=t.packages)==null?void 0:e.length)||0}):R.warning("PACKAGES","Failed to fetch exhausted packages",{error:t.error}),t}catch(t){throw R.error("PACKAGES","Error fetching exhausted packages",{error:t.message}),t}}async uploadFile(e){var t;R.info("SUPABASE_FILES","Uploading file",{fileName:e.display_name});try{const n=await this.makeRequest("/supabase-files/upload",{method:"POST",body:JSON.stringify(e)});return n.success?R.success("SUPABASE_FILES","File uploaded successfully",{fileId:(t=n.file)==null?void 0:t.id}):R.warning("SUPABASE_FILES","Failed to upload file",{error:n.error}),n}catch(n){throw R.error("SUPABASE_FILES","Error uploading file",{error:n.message}),n}}async downloadFile(e){R.info("SUPABASE_FILES","Downloading file",{fileId:e});try{const t=await this.makeRequest(`/supabase-files/${e}/download`);return t.success?R.success("SUPABASE_FILES","File download initiated",{fileId:e}):R.warning("SUPABASE_FILES","Failed to download file",{error:t.error}),t}catch(t){throw R.error("SUPABASE_FILES","Error downloading file",{error:t.message}),t}}async getFileViewUrl(e){R.info("SUPABASE_FILES","Getting file view URL",{fileId:e});try{const t=await this.makeRequest(`/supabase-files/${e}/view`);return t.success?R.success("SUPABASE_FILES","File view URL generated",{fileId:e}):R.warning("SUPABASE_FILES","Failed to get file view URL",{error:t.error}),t}catch(t){throw R.error("SUPABASE_FILES","Error getting file view URL",{error:t.message}),t}}async getPublicFiles(e=""){var t;R.info("SUPABASE_FILES","Fetching public files",{queryParams:e});try{const n=await this.makeRequest(`/supabase-files/public?${e}`);return n.success?R.success("SUPABASE_FILES","Public files fetched successfully",{count:((t=n.files)==null?void 0:t.length)||0}):R.warning("SUPABASE_FILES","Failed to fetch public files",{error:n.error}),n}catch(n){throw R.error("SUPABASE_FILES","Error fetching public files",{error:n.message}),n}}}const se=new NI,hN=_.createContext(),Fm=()=>{const s=_.useContext(hN);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},jI=({children:s})=>{const[e,t]=_.useState(null),[n,r]=_.useState(!0);_.useEffect(()=>{(async()=>{var h,f,p,m,g,y,b,v,x,w,E,T,C;R.info("AUTH_CONTEXT","Initializing authentication");try{const N=nn.getStoredTokens();if(R.debug("AUTH_CONTEXT","Stored tokens check",{hasAccessToken:!!N.accessToken,hasRefreshToken:!!N.refreshToken}),N.accessToken&&N.refreshToken)try{R.info("AUTH_CONTEXT","Verifying existing token");const j=await se.verifyToken(),P={id:(h=j.user)==null?void 0:h.id,username:(f=j.user)==null?void 0:f.username,role:(p=j.user)==null?void 0:p.role,teacherId:(m=j.user)==null?void 0:m.teacher_id,teacherName:(g=j.user)==null?void 0:g.teacher_name,isAdmin:((y=j.user)==null?void 0:y.role)==="admin",isTeacher:((b=j.user)==null?void 0:b.role)==="teacher"};t(P),R.success("AUTH_CONTEXT","Token verified successfully",{userId:P.id,role:P.role,teacherId:P.teacherId,teacherName:P.teacherName,isAdmin:P.isAdmin,isTeacher:P.isTeacher})}catch(j){if(R.warning("AUTH_CONTEXT","Token verification failed",{error:j.message,isNetworkError:j.message.includes("fetch")||j.message.includes("Backend server not available")}),j.message.includes("fetch")||j.message.includes("Backend server not available")){R.info("AUTH_CONTEXT","Backend not available, skipping token refresh"),nn.clearStoredTokens();return}R.info("AUTH_CONTEXT","Attempting token refresh");try{const P=await se.refreshToken(N.refreshToken);nn.storeTokens(P.accessToken,P.refreshToken);const M=await se.verifyToken();t(M.user),R.success("AUTH_CONTEXT","Token refreshed successfully",{userId:(v=M.user)==null?void 0:v.id,role:(x=M.user)==null?void 0:x.role,teacherId:(w=M.user)==null?void 0:w.teacher_id,teacherName:(E=M.user)==null?void 0:E.teacher_name,isAdmin:((T=M.user)==null?void 0:T.role)==="admin",isTeacher:((C=M.user)==null?void 0:C.role)==="teacher"})}catch(P){R.error("AUTH_CONTEXT","Token refresh failed, clearing tokens",{error:P.message}),nn.clearStoredTokens()}}else R.info("AUTH_CONTEXT","No stored tokens found")}catch(N){R.error("AUTH_CONTEXT","Auth initialization error",{error:N.message}),nn.clearStoredTokens()}finally{r(!1),R.info("AUTH_CONTEXT","Auth initialization complete",{isAuthenticated:!!e,loading:!1})}})()},[]);const i=async(u,h)=>{var f,p,m,g,y,b,v,x;R.info("AUTH_CONTEXT","Login attempt initiated",{username:u,hasPassword:!!h,apiService:typeof se,tokenManager:typeof nn});try{R.info("AUTH_CONTEXT","Calling apiService.login",{username:u});const w=await se.login(u,h);if(R.info("AUTH_CONTEXT","API login response received",{success:w==null?void 0:w.success,hasAccessToken:!!(w!=null&&w.accessToken),hasRefreshToken:!!(w!=null&&w.refreshToken),hasUser:!!(w!=null&&w.user),userRole:(f=w==null?void 0:w.user)==null?void 0:f.role}),w.success&&w.accessToken&&w.refreshToken){R.info("AUTH_CONTEXT","Storing tokens and setting user",{username:u}),nn.storeTokens(w.accessToken,w.refreshToken);const E={id:(p=w.user)==null?void 0:p.id,username:(m=w.user)==null?void 0:m.username,role:(g=w.user)==null?void 0:g.role,teacherId:(y=w.user)==null?void 0:y.teacher_id,teacherName:(b=w.user)==null?void 0:b.teacher_name,isAdmin:((v=w.user)==null?void 0:v.role)==="admin",isTeacher:((x=w.user)==null?void 0:x.role)==="teacher"};return t(E),R.success("AUTH_CONTEXT","Login successful",{username:u,userId:E.id,role:E.role,teacherId:E.teacherId,teacherName:E.teacherName,isAdmin:E.isAdmin,isTeacher:E.isTeacher}),{success:!0}}else return R.warning("AUTH_CONTEXT","API login returned unsuccessful response",{data:w,success:w==null?void 0:w.success,error:w==null?void 0:w.error}),{success:!1,error:(w==null?void 0:w.error)||"Login failed"}}catch(w){return R.error("AUTH_CONTEXT","Login failed with error",{username:u,error:w.message,stack:w.stack}),{success:!1,error:w.message||"Login failed"}}},a=async u=>{try{R.info("AUTH_CONTEXT","Refreshing tokens");const h=await se.refreshToken(u);if(h.success&&h.accessToken&&h.refreshToken){nn.storeTokens(h.accessToken,h.refreshToken);const f=await se.verifyToken();return t(f.user),R.success("AUTH_CONTEXT","Tokens refreshed successfully"),!0}else return R.warning("AUTH_CONTEXT","Token refresh failed - invalid response"),!1}catch(h){return R.error("AUTH_CONTEXT","Token refresh failed",{error:h.message}),!1}},l={user:e,login:i,logout:()=>{R.info("AUTH_CONTEXT","Logout initiated",{userId:e==null?void 0:e.id,role:e==null?void 0:e.role}),nn.clearStoredTokens(),t(null),R.success("AUTH_CONTEXT","Logout completed")},refreshTokens:a,refreshToken:a,loading:n,isAuthenticated:!!e,isAdmin:(e==null?void 0:e.role)==="admin",isTeacher:(e==null?void 0:e.role)==="teacher"};return c.jsx(hN.Provider,{value:l,children:s})},PI=({children:s})=>{const{refreshTokens:e,logout:t}=Fm(),[n,r]=_.useState(!1);return _.useEffect(()=>{const i=async()=>{const o=nn.getStoredTokens();if(!(!o.accessToken||!o.refreshToken)&&(nn.isTokenExpired(o.accessToken)||nn.shouldRefreshToken(o.accessToken))){if(n)return;try{r(!0),await e(o.refreshToken)||t()}catch(l){console.error("Token refresh error:",l),t()}finally{r(!1)}}};i();const a=setInterval(i,5*60*1e3);return()=>clearInterval(a)},[e,t,n]),_.useEffect(()=>{const i=se.makeRequest;se.makeRequest=async function(a,o={}){try{return await i.call(this,a,o)}catch(l){if(l.status===401){const u=nn.getStoredTokens();if(u.refreshToken)try{if(await e(u.refreshToken))return await i.call(this,a,o)}catch(h){console.error("Token refresh failed:",h),t()}}throw l}}},[e,t]),n?c.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),c.jsx("p",{className:"text-neutral-600",children:"Refreshing session..."})]})}):c.jsx(c.Fragment,{children:s})},RI=()=>{const[s,e]=_.useState(!navigator.onLine),[t,n]=_.useState(!1);return _.useEffect(()=>{const r=()=>{e(!1),n(!1)},i=()=>{e(!0),n(!0)};return window.addEventListener("online",r),window.addEventListener("offline",i),navigator.onLine||n(!0),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",i)}},[]),_.useEffect(()=>{const r=i=>{s&&n(!0)};return window.addEventListener("cache:fallback",r),()=>{window.removeEventListener("cache:fallback",r)}},[s]),t?c.jsx("div",{className:"fixed top-4 right-4 z-50",children:c.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2",children:[c.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-pulse"}),c.jsx("span",{className:"text-sm font-medium",children:s?"Offline - Using cached data":"Using cached data"}),c.jsx("button",{onClick:()=>n(!1),className:"text-yellow-600 hover:text-yellow-800 ml-2",children:""})]})}):null},fN=_.createContext({transformPagePoint:s=>s,isStatic:!1,reducedMotion:"never"}),Zy=_.createContext({}),ev=_.createContext(null),tv=typeof document<"u",c_=tv?_.useLayoutEffect:_.useEffect,pN=_.createContext({strict:!1}),u_=s=>s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),LI="framerAppearId",mN="data-"+u_(LI);function DI(s,e,t,n){const{visualElement:r}=_.useContext(Zy),i=_.useContext(pN),a=_.useContext(ev),o=_.useContext(fN).reducedMotion,l=_.useRef();n=n||i.renderer,!l.current&&n&&(l.current=n(s,{visualState:e,parent:r,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:o}));const u=l.current;_.useInsertionEffect(()=>{u&&u.update(t,a)});const h=_.useRef(!!(t[mN]&&!window.HandoffComplete));return c_(()=>{u&&(u.render(),h.current&&u.animationState&&u.animationState.animateChanges())}),_.useEffect(()=>{u&&(u.updateFeatures(),!h.current&&u.animationState&&u.animationState.animateChanges(),h.current&&(h.current=!1,window.HandoffComplete=!0))}),u}function Pu(s){return s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function MI(s,e,t){return _.useCallback(n=>{n&&s.mount&&s.mount(n),e&&(n?e.mount(n):e.unmount()),t&&(typeof t=="function"?t(n):Pu(t)&&(t.current=n))},[e])}function Gf(s){return typeof s=="string"||Array.isArray(s)}function sv(s){return s!==null&&typeof s=="object"&&typeof s.start=="function"}const d_=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],h_=["initial",...d_];function nv(s){return sv(s.animate)||h_.some(e=>Gf(s[e]))}function gN(s){return!!(nv(s)||s.variants)}function II(s,e){if(nv(s)){const{initial:t,animate:n}=s;return{initial:t===!1||Gf(t)?t:void 0,animate:Gf(n)?n:void 0}}return s.inherit!==!1?e:{}}function OI(s){const{initial:e,animate:t}=II(s,_.useContext(Zy));return _.useMemo(()=>({initial:e,animate:t}),[j1(e),j1(t)])}function j1(s){return Array.isArray(s)?s.join(" "):s}const P1={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},qf={};for(const s in P1)qf[s]={isEnabled:e=>P1[s].some(t=>!!e[t])};function FI(s){for(const e in s)qf[e]={...qf[e],...s[e]}}const f_=_.createContext({}),yN=_.createContext({}),$I=Symbol.for("motionComponentSymbol");function UI({preloadedFeatures:s,createVisualElement:e,useRender:t,useVisualState:n,Component:r}){s&&FI(s);function i(o,l){let u;const h={..._.useContext(fN),...o,layoutId:BI(o)},{isStatic:f}=h,p=OI(o),m=n(o,f);if(!f&&tv){p.visualElement=DI(r,m,h,e);const g=_.useContext(yN),y=_.useContext(pN).strict;p.visualElement&&(u=p.visualElement.loadFeatures(h,y,s,g))}return _.createElement(Zy.Provider,{value:p},u&&p.visualElement?_.createElement(u,{visualElement:p.visualElement,...h}):null,t(r,o,MI(m,p.visualElement,l),m,f,p.visualElement))}const a=_.forwardRef(i);return a[$I]=r,a}function BI({layoutId:s}){const e=_.useContext(f_).id;return e&&s!==void 0?e+"-"+s:s}function HI(s){function e(n,r={}){return UI(s(n,r))}if(typeof Proxy>"u")return e;const t=new Map;return new Proxy(e,{get:(n,r)=>(t.has(r)||t.set(r,e(r)),t.get(r))})}const VI=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function p_(s){return typeof s!="string"||s.includes("-")?!1:!!(VI.indexOf(s)>-1||/[A-Z]/.test(s))}const Y0={};function zI(s){Object.assign(Y0,s)}const $m=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Yc=new Set($m);function vN(s,{layout:e,layoutId:t}){return Yc.has(s)||s.startsWith("origin")||(e||t!==void 0)&&(!!Y0[s]||s==="opacity")}const Tn=s=>!!(s&&s.getVelocity),WI={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},GI=$m.length;function qI(s,{enableHardwareAcceleration:e=!0,allowTransformNone:t=!0},n,r){let i="";for(let a=0;a<GI;a++){const o=$m[a];if(s[o]!==void 0){const l=WI[o]||o;i+=`${l}(${s[o]}) `}}return e&&!s.z&&(i+="translateZ(0)"),i=i.trim(),r?i=r(s,n?"":i):t&&n&&(i="none"),i}const xN=s=>e=>typeof e=="string"&&e.startsWith(s),wN=xN("--"),Cw=xN("var(--"),KI=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,XI=(s,e)=>e&&typeof s=="number"?e.transform(s):s,Ko=(s,e,t)=>Math.min(Math.max(t,s),e),Jc={test:s=>typeof s=="number",parse:parseFloat,transform:s=>s},xf={...Jc,transform:s=>Ko(0,1,s)},bg={...Jc,default:1},wf=s=>Math.round(s*1e5)/1e5,rv=/(-)?([\d]*\.?[\d])+/g,bN=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,YI=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Um(s){return typeof s=="string"}const Bm=s=>({test:e=>Um(e)&&e.endsWith(s)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${s}`}),Ba=Bm("deg"),Ri=Bm("%"),Te=Bm("px"),JI=Bm("vh"),QI=Bm("vw"),R1={...Ri,parse:s=>Ri.parse(s)/100,transform:s=>Ri.transform(s*100)},L1={...Jc,transform:Math.round},SN={borderWidth:Te,borderTopWidth:Te,borderRightWidth:Te,borderBottomWidth:Te,borderLeftWidth:Te,borderRadius:Te,radius:Te,borderTopLeftRadius:Te,borderTopRightRadius:Te,borderBottomRightRadius:Te,borderBottomLeftRadius:Te,width:Te,maxWidth:Te,height:Te,maxHeight:Te,size:Te,top:Te,right:Te,bottom:Te,left:Te,padding:Te,paddingTop:Te,paddingRight:Te,paddingBottom:Te,paddingLeft:Te,margin:Te,marginTop:Te,marginRight:Te,marginBottom:Te,marginLeft:Te,rotate:Ba,rotateX:Ba,rotateY:Ba,rotateZ:Ba,scale:bg,scaleX:bg,scaleY:bg,scaleZ:bg,skew:Ba,skewX:Ba,skewY:Ba,distance:Te,translateX:Te,translateY:Te,translateZ:Te,x:Te,y:Te,z:Te,perspective:Te,transformPerspective:Te,opacity:xf,originX:R1,originY:R1,originZ:Te,zIndex:L1,fillOpacity:xf,strokeOpacity:xf,numOctaves:L1};function m_(s,e,t,n){const{style:r,vars:i,transform:a,transformOrigin:o}=s;let l=!1,u=!1,h=!0;for(const f in e){const p=e[f];if(wN(f)){i[f]=p;continue}const m=SN[f],g=XI(p,m);if(Yc.has(f)){if(l=!0,a[f]=g,!h)continue;p!==(m.default||0)&&(h=!1)}else f.startsWith("origin")?(u=!0,o[f]=g):r[f]=g}if(e.transform||(l||n?r.transform=qI(s.transform,t,h,n):r.transform&&(r.transform="none")),u){const{originX:f="50%",originY:p="50%",originZ:m=0}=o;r.transformOrigin=`${f} ${p} ${m}`}}const g_=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function _N(s,e,t){for(const n in e)!Tn(e[n])&&!vN(n,t)&&(s[n]=e[n])}function ZI({transformTemplate:s},e,t){return _.useMemo(()=>{const n=g_();return m_(n,e,{enableHardwareAcceleration:!t},s),Object.assign({},n.vars,n.style)},[e])}function eO(s,e,t){const n=s.style||{},r={};return _N(r,n,s),Object.assign(r,ZI(s,e,t)),s.transformValues?s.transformValues(r):r}function tO(s,e,t){const n={},r=eO(s,e,t);return s.drag&&s.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=s.drag===!0?"none":`pan-${s.drag==="x"?"y":"x"}`),s.tabIndex===void 0&&(s.onTap||s.onTapStart||s.whileTap)&&(n.tabIndex=0),n.style=r,n}const sO=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function J0(s){return s.startsWith("while")||s.startsWith("drag")&&s!=="draggable"||s.startsWith("layout")||s.startsWith("onTap")||s.startsWith("onPan")||s.startsWith("onLayout")||sO.has(s)}let EN=s=>!J0(s);function nO(s){s&&(EN=e=>e.startsWith("on")?!J0(e):s(e))}try{nO(require("@emotion/is-prop-valid").default)}catch{}function rO(s,e,t){const n={};for(const r in s)r==="values"&&typeof s.values=="object"||(EN(r)||t===!0&&J0(r)||!e&&!J0(r)||s.draggable&&r.startsWith("onDrag"))&&(n[r]=s[r]);return n}function D1(s,e,t){return typeof s=="string"?s:Te.transform(e+t*s)}function iO(s,e,t){const n=D1(e,s.x,s.width),r=D1(t,s.y,s.height);return`${n} ${r}`}const aO={offset:"stroke-dashoffset",array:"stroke-dasharray"},oO={offset:"strokeDashoffset",array:"strokeDasharray"};function lO(s,e,t=1,n=0,r=!0){s.pathLength=1;const i=r?aO:oO;s[i.offset]=Te.transform(-n);const a=Te.transform(e),o=Te.transform(t);s[i.array]=`${a} ${o}`}function y_(s,{attrX:e,attrY:t,attrScale:n,originX:r,originY:i,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...u},h,f,p){if(m_(s,u,h,p),f){s.style.viewBox&&(s.attrs.viewBox=s.style.viewBox);return}s.attrs=s.style,s.style={};const{attrs:m,style:g,dimensions:y}=s;m.transform&&(y&&(g.transform=m.transform),delete m.transform),y&&(r!==void 0||i!==void 0||g.transform)&&(g.transformOrigin=iO(y,r!==void 0?r:.5,i!==void 0?i:.5)),e!==void 0&&(m.x=e),t!==void 0&&(m.y=t),n!==void 0&&(m.scale=n),a!==void 0&&lO(m,a,o,l,!1)}const AN=()=>({...g_(),attrs:{}}),v_=s=>typeof s=="string"&&s.toLowerCase()==="svg";function cO(s,e,t,n){const r=_.useMemo(()=>{const i=AN();return y_(i,e,{enableHardwareAcceleration:!1},v_(n),s.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(s.style){const i={};_N(i,s.style,s),r.style={...i,...r.style}}return r}function uO(s=!1){return(t,n,r,{latestValues:i},a)=>{const l=(p_(t)?cO:tO)(n,i,a,t),h={...rO(n,typeof t=="string",s),...l,ref:r},{children:f}=n,p=_.useMemo(()=>Tn(f)?f.get():f,[f]);return _.createElement(t,{...h,children:p})}}function kN(s,{style:e,vars:t},n,r){Object.assign(s.style,e,r&&r.getProjectionStyles(n));for(const i in t)s.style.setProperty(i,t[i])}const TN=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function CN(s,e,t,n){kN(s,e,void 0,n);for(const r in e.attrs)s.setAttribute(TN.has(r)?r:u_(r),e.attrs[r])}function x_(s,e){const{style:t}=s,n={};for(const r in t)(Tn(t[r])||e.style&&Tn(e.style[r])||vN(r,s))&&(n[r]=t[r]);return n}function NN(s,e){const t=x_(s,e);for(const n in s)if(Tn(s[n])||Tn(e[n])){const r=$m.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;t[r]=s[n]}return t}function w_(s,e,t,n={},r={}){return typeof e=="function"&&(e=e(t!==void 0?t:s.custom,n,r)),typeof e=="string"&&(e=s.variants&&s.variants[e]),typeof e=="function"&&(e=e(t!==void 0?t:s.custom,n,r)),e}function jN(s){const e=_.useRef(null);return e.current===null&&(e.current=s()),e.current}const Q0=s=>Array.isArray(s),dO=s=>!!(s&&typeof s=="object"&&s.mix&&s.toValue),hO=s=>Q0(s)?s[s.length-1]||0:s;function qg(s){const e=Tn(s)?s.get():s;return dO(e)?e.toValue():e}function fO({scrapeMotionValuesFromProps:s,createRenderState:e,onMount:t},n,r,i){const a={latestValues:pO(n,r,i,s),renderState:e()};return t&&(a.mount=o=>t(n,o,a)),a}const PN=s=>(e,t)=>{const n=_.useContext(Zy),r=_.useContext(ev),i=()=>fO(s,e,n,r);return t?i():jN(i)};function pO(s,e,t,n){const r={},i=n(s,{});for(const p in i)r[p]=qg(i[p]);let{initial:a,animate:o}=s;const l=nv(s),u=gN(s);e&&u&&!l&&s.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let h=t?t.initial===!1:!1;h=h||a===!1;const f=h?o:a;return f&&typeof f!="boolean"&&!sv(f)&&(Array.isArray(f)?f:[f]).forEach(m=>{const g=w_(s,m);if(!g)return;const{transitionEnd:y,transition:b,...v}=g;for(const x in v){let w=v[x];if(Array.isArray(w)){const E=h?w.length-1:0;w=w[E]}w!==null&&(r[x]=w)}for(const x in y)r[x]=y[x]}),r}const Ht=s=>s;class M1{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function mO(s){let e=new M1,t=new M1,n=0,r=!1,i=!1;const a=new WeakSet,o={schedule:(l,u=!1,h=!1)=>{const f=h&&r,p=f?e:t;return u&&a.add(l),p.add(l)&&f&&r&&(n=e.order.length),l},cancel:l=>{t.remove(l),a.delete(l)},process:l=>{if(r){i=!0;return}if(r=!0,[e,t]=[t,e],t.clear(),n=e.order.length,n)for(let u=0;u<n;u++){const h=e.order[u];h(l),a.has(h)&&(o.schedule(h),s())}r=!1,i&&(i=!1,o.process(l))}};return o}const Sg=["prepare","read","update","preRender","render","postRender"],gO=40;function yO(s,e){let t=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=Sg.reduce((f,p)=>(f[p]=mO(()=>t=!0),f),{}),a=f=>i[f].process(r),o=()=>{const f=performance.now();t=!1,r.delta=n?1e3/60:Math.max(Math.min(f-r.timestamp,gO),1),r.timestamp=f,r.isProcessing=!0,Sg.forEach(a),r.isProcessing=!1,t&&e&&(n=!1,s(o))},l=()=>{t=!0,n=!0,r.isProcessing||s(o)};return{schedule:Sg.reduce((f,p)=>{const m=i[p];return f[p]=(g,y=!1,b=!1)=>(t||l(),m.schedule(g,y,b)),f},{}),cancel:f=>Sg.forEach(p=>i[p].cancel(f)),state:r,steps:i}}const{schedule:yt,cancel:La,state:Fs,steps:sx}=yO(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ht,!0),vO={useVisualState:PN({scrapeMotionValuesFromProps:NN,createRenderState:AN,onMount:(s,e,{renderState:t,latestValues:n})=>{yt.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),yt.render(()=>{y_(t,n,{enableHardwareAcceleration:!1},v_(e.tagName),s.transformTemplate),CN(e,t)})}})},xO={useVisualState:PN({scrapeMotionValuesFromProps:x_,createRenderState:g_})};function wO(s,{forwardMotionProps:e=!1},t,n){return{...p_(s)?vO:xO,preloadedFeatures:t,useRender:uO(e),createVisualElement:n,Component:s}}function Sa(s,e,t,n={passive:!0}){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t)}const RN=s=>s.pointerType==="mouse"?typeof s.button!="number"||s.button<=0:s.isPrimary!==!1;function iv(s,e="page"){return{point:{x:s[e+"X"],y:s[e+"Y"]}}}const bO=s=>e=>RN(e)&&s(e,iv(e));function Ea(s,e,t,n){return Sa(s,e,bO(t),n)}const SO=(s,e)=>t=>e(s(t)),Wo=(...s)=>s.reduce(SO);function LN(s){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=s,t):!1}}const I1=LN("dragHorizontal"),O1=LN("dragVertical");function DN(s){let e=!1;if(s==="y")e=O1();else if(s==="x")e=I1();else{const t=I1(),n=O1();t&&n?e=()=>{t(),n()}:(t&&t(),n&&n())}return e}function MN(){const s=DN(!0);return s?(s(),!1):!0}class rl{constructor(e){this.isMounted=!1,this.node=e}update(){}}function F1(s,e){const t="pointer"+(e?"enter":"leave"),n="onHover"+(e?"Start":"End"),r=(i,a)=>{if(i.pointerType==="touch"||MN())return;const o=s.getProps();s.animationState&&o.whileHover&&s.animationState.setActive("whileHover",e),o[n]&&yt.update(()=>o[n](i,a))};return Ea(s.current,t,r,{passive:!s.getProps()[n]})}class _O extends rl{mount(){this.unmount=Wo(F1(this.node,!0),F1(this.node,!1))}unmount(){}}class EO extends rl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Wo(Sa(this.node.current,"focus",()=>this.onFocus()),Sa(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const IN=(s,e)=>e?s===e?!0:IN(s,e.parentElement):!1;function nx(s,e){if(!e)return;const t=new PointerEvent("pointer"+s);e(t,iv(t))}class AO extends rl{constructor(){super(...arguments),this.removeStartListeners=Ht,this.removeEndListeners=Ht,this.removeAccessibleListeners=Ht,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),i=Ea(window,"pointerup",(o,l)=>{if(!this.checkPressEnd())return;const{onTap:u,onTapCancel:h,globalTapTarget:f}=this.node.getProps();yt.update(()=>{!f&&!IN(this.node.current,o.target)?h&&h(o,l):u&&u(o,l)})},{passive:!(n.onTap||n.onPointerUp)}),a=Ea(window,"pointercancel",(o,l)=>this.cancelPress(o,l),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Wo(i,a),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const a=o=>{o.key!=="Enter"||!this.checkPressEnd()||nx("up",(l,u)=>{const{onTap:h}=this.node.getProps();h&&yt.update(()=>h(l,u))})};this.removeEndListeners(),this.removeEndListeners=Sa(this.node.current,"keyup",a),nx("down",(o,l)=>{this.startPress(o,l)})},t=Sa(this.node.current,"keydown",e),n=()=>{this.isPressing&&nx("cancel",(i,a)=>this.cancelPress(i,a))},r=Sa(this.node.current,"blur",n);this.removeAccessibleListeners=Wo(t,r)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&yt.update(()=>n(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!MN()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&yt.update(()=>n(e,t))}mount(){const e=this.node.getProps(),t=Ea(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=Sa(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Wo(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Nw=new WeakMap,rx=new WeakMap,kO=s=>{const e=Nw.get(s.target);e&&e(s)},TO=s=>{s.forEach(kO)};function CO({root:s,...e}){const t=s||document;rx.has(t)||rx.set(t,{});const n=rx.get(t),r=JSON.stringify(e);return n[r]||(n[r]=new IntersectionObserver(TO,{root:s,...e})),n[r]}function NO(s,e,t){const n=CO(e);return Nw.set(s,t),n.observe(s),()=>{Nw.delete(s),n.unobserve(s)}}const jO={some:0,all:1};class PO extends rl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:i}=e,a={root:t?t.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:jO[r]},o=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),p=u?h:f;p&&p(l)};return NO(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(RO(e,t))&&this.startObserver()}unmount(){}}function RO({viewport:s={}},{viewport:e={}}={}){return t=>s[t]!==e[t]}const LO={inView:{Feature:PO},tap:{Feature:AO},focus:{Feature:EO},hover:{Feature:_O}};function ON(s,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==s.length)return!1;for(let n=0;n<t;n++)if(e[n]!==s[n])return!1;return!0}function DO(s){const e={};return s.values.forEach((t,n)=>e[n]=t.get()),e}function MO(s){const e={};return s.values.forEach((t,n)=>e[n]=t.getVelocity()),e}function av(s,e,t){const n=s.getProps();return w_(n,e,t!==void 0?t:n.custom,DO(s),MO(s))}let b_=Ht;const Fc=s=>s*1e3,Aa=s=>s/1e3,IO={current:!1},FN=s=>Array.isArray(s)&&typeof s[0]=="number";function $N(s){return!!(!s||typeof s=="string"&&UN[s]||FN(s)||Array.isArray(s)&&s.every($N))}const Hh=([s,e,t,n])=>`cubic-bezier(${s}, ${e}, ${t}, ${n})`,UN={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Hh([0,.65,.55,1]),circOut:Hh([.55,0,1,.45]),backIn:Hh([.31,.01,.66,-.59]),backOut:Hh([.33,1.53,.69,.99])};function BN(s){if(s)return FN(s)?Hh(s):Array.isArray(s)?s.map(BN):UN[s]}function OO(s,e,t,{delay:n=0,duration:r,repeat:i=0,repeatType:a="loop",ease:o,times:l}={}){const u={[e]:t};l&&(u.offset=l);const h=BN(o);return Array.isArray(h)&&(u.easing=h),s.animate(u,{delay:n,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:i+1,direction:a==="reverse"?"alternate":"normal"})}function FO(s,{repeat:e,repeatType:t="loop"}){const n=e&&t!=="loop"&&e%2===1?0:s.length-1;return s[n]}const HN=(s,e,t)=>(((1-3*t+3*e)*s+(3*t-6*e))*s+3*e)*s,$O=1e-7,UO=12;function BO(s,e,t,n,r){let i,a,o=0;do a=e+(t-e)/2,i=HN(a,n,r)-s,i>0?t=a:e=a;while(Math.abs(i)>$O&&++o<UO);return a}function Hm(s,e,t,n){if(s===e&&t===n)return Ht;const r=i=>BO(i,0,1,s,t);return i=>i===0||i===1?i:HN(r(i),e,n)}const HO=Hm(.42,0,1,1),VO=Hm(0,0,.58,1),VN=Hm(.42,0,.58,1),zO=s=>Array.isArray(s)&&typeof s[0]!="number",zN=s=>e=>e<=.5?s(2*e)/2:(2-s(2*(1-e)))/2,WN=s=>e=>1-s(1-e),S_=s=>1-Math.sin(Math.acos(s)),GN=WN(S_),WO=zN(S_),qN=Hm(.33,1.53,.69,.99),__=WN(qN),GO=zN(__),qO=s=>(s*=2)<1?.5*__(s):.5*(2-Math.pow(2,-10*(s-1))),KO={linear:Ht,easeIn:HO,easeInOut:VN,easeOut:VO,circIn:S_,circInOut:WO,circOut:GN,backIn:__,backInOut:GO,backOut:qN,anticipate:qO},$1=s=>{if(Array.isArray(s)){b_(s.length===4);const[e,t,n,r]=s;return Hm(e,t,n,r)}else if(typeof s=="string")return KO[s];return s},E_=(s,e)=>t=>!!(Um(t)&&YI.test(t)&&t.startsWith(s)||e&&Object.prototype.hasOwnProperty.call(t,e)),KN=(s,e,t)=>n=>{if(!Um(n))return n;const[r,i,a,o]=n.match(rv);return{[s]:parseFloat(r),[e]:parseFloat(i),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},XO=s=>Ko(0,255,s),ix={...Jc,transform:s=>Math.round(XO(s))},kl={test:E_("rgb","red"),parse:KN("red","green","blue"),transform:({red:s,green:e,blue:t,alpha:n=1})=>"rgba("+ix.transform(s)+", "+ix.transform(e)+", "+ix.transform(t)+", "+wf(xf.transform(n))+")"};function YO(s){let e="",t="",n="",r="";return s.length>5?(e=s.substring(1,3),t=s.substring(3,5),n=s.substring(5,7),r=s.substring(7,9)):(e=s.substring(1,2),t=s.substring(2,3),n=s.substring(3,4),r=s.substring(4,5),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const jw={test:E_("#"),parse:YO,transform:kl.transform},Ru={test:E_("hsl","hue"),parse:KN("hue","saturation","lightness"),transform:({hue:s,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(s)+", "+Ri.transform(wf(e))+", "+Ri.transform(wf(t))+", "+wf(xf.transform(n))+")"},en={test:s=>kl.test(s)||jw.test(s)||Ru.test(s),parse:s=>kl.test(s)?kl.parse(s):Ru.test(s)?Ru.parse(s):jw.parse(s),transform:s=>Um(s)?s:s.hasOwnProperty("red")?kl.transform(s):Ru.transform(s)},Pt=(s,e,t)=>-t*s+t*e+s;function ax(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*(2/3-t)*6:s}function JO({hue:s,saturation:e,lightness:t,alpha:n}){s/=360,e/=100,t/=100;let r=0,i=0,a=0;if(!e)r=i=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;r=ax(l,o,s+1/3),i=ax(l,o,s),a=ax(l,o,s-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(a*255),alpha:n}}const ox=(s,e,t)=>{const n=s*s;return Math.sqrt(Math.max(0,t*(e*e-n)+n))},QO=[jw,kl,Ru],ZO=s=>QO.find(e=>e.test(s));function U1(s){const e=ZO(s);let t=e.parse(s);return e===Ru&&(t=JO(t)),t}const XN=(s,e)=>{const t=U1(s),n=U1(e),r={...t};return i=>(r.red=ox(t.red,n.red,i),r.green=ox(t.green,n.green,i),r.blue=ox(t.blue,n.blue,i),r.alpha=Pt(t.alpha,n.alpha,i),kl.transform(r))};function eF(s){var e,t;return isNaN(s)&&Um(s)&&(((e=s.match(rv))===null||e===void 0?void 0:e.length)||0)+(((t=s.match(bN))===null||t===void 0?void 0:t.length)||0)>0}const YN={regex:KI,countKey:"Vars",token:"${v}",parse:Ht},JN={regex:bN,countKey:"Colors",token:"${c}",parse:en.parse},QN={regex:rv,countKey:"Numbers",token:"${n}",parse:Jc.parse};function lx(s,{regex:e,countKey:t,token:n,parse:r}){const i=s.tokenised.match(e);i&&(s["num"+t]=i.length,s.tokenised=s.tokenised.replace(e,n),s.values.push(...i.map(r)))}function Z0(s){const e=s.toString(),t={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return t.value.includes("var(--")&&lx(t,YN),lx(t,JN),lx(t,QN),t}function ZN(s){return Z0(s).values}function e2(s){const{values:e,numColors:t,numVars:n,tokenised:r}=Z0(s),i=e.length;return a=>{let o=r;for(let l=0;l<i;l++)l<n?o=o.replace(YN.token,a[l]):l<n+t?o=o.replace(JN.token,en.transform(a[l])):o=o.replace(QN.token,wf(a[l]));return o}}const tF=s=>typeof s=="number"?0:s;function sF(s){const e=ZN(s);return e2(s)(e.map(tF))}const Xo={test:eF,parse:ZN,createTransformer:e2,getAnimatableNone:sF},t2=(s,e)=>t=>`${t>0?e:s}`;function s2(s,e){return typeof s=="number"?t=>Pt(s,e,t):en.test(s)?XN(s,e):s.startsWith("var(")?t2(s,e):r2(s,e)}const n2=(s,e)=>{const t=[...s],n=t.length,r=s.map((i,a)=>s2(i,e[a]));return i=>{for(let a=0;a<n;a++)t[a]=r[a](i);return t}},nF=(s,e)=>{const t={...s,...e},n={};for(const r in t)s[r]!==void 0&&e[r]!==void 0&&(n[r]=s2(s[r],e[r]));return r=>{for(const i in n)t[i]=n[i](r);return t}},r2=(s,e)=>{const t=Xo.createTransformer(e),n=Z0(s),r=Z0(e);return n.numVars===r.numVars&&n.numColors===r.numColors&&n.numNumbers>=r.numNumbers?Wo(n2(n.values,r.values),t):t2(s,e)},Kf=(s,e,t)=>{const n=e-s;return n===0?1:(t-s)/n},B1=(s,e)=>t=>Pt(s,e,t);function rF(s){return typeof s=="number"?B1:typeof s=="string"?en.test(s)?XN:r2:Array.isArray(s)?n2:typeof s=="object"?nF:B1}function iF(s,e,t){const n=[],r=t||rF(s[0]),i=s.length-1;for(let a=0;a<i;a++){let o=r(s[a],s[a+1]);if(e){const l=Array.isArray(e)?e[a]||Ht:e;o=Wo(l,o)}n.push(o)}return n}function i2(s,e,{clamp:t=!0,ease:n,mixer:r}={}){const i=s.length;if(b_(i===e.length),i===1)return()=>e[0];s[0]>s[i-1]&&(s=[...s].reverse(),e=[...e].reverse());const a=iF(e,n,r),o=a.length,l=u=>{let h=0;if(o>1)for(;h<s.length-2&&!(u<s[h+1]);h++);const f=Kf(s[h],s[h+1],u);return a[h](f)};return t?u=>l(Ko(s[0],s[i-1],u)):l}function aF(s,e){const t=s[s.length-1];for(let n=1;n<=e;n++){const r=Kf(0,e,n);s.push(Pt(t,1,r))}}function oF(s){const e=[0];return aF(e,s.length-1),e}function lF(s,e){return s.map(t=>t*e)}function cF(s,e){return s.map(()=>e||VN).splice(0,s.length-1)}function ey({duration:s=300,keyframes:e,times:t,ease:n="easeInOut"}){const r=zO(n)?n.map($1):$1(n),i={done:!1,value:e[0]},a=lF(t&&t.length===e.length?t:oF(e),s),o=i2(a,e,{ease:Array.isArray(r)?r:cF(e,r)});return{calculatedDuration:s,next:l=>(i.value=o(l),i.done=l>=s,i)}}function a2(s,e){return e?s*(1e3/e):0}const uF=5;function o2(s,e,t){const n=Math.max(e-uF,0);return a2(t-s(n),e-n)}const cx=.001,dF=.01,hF=10,fF=.05,pF=1;function mF({duration:s=800,bounce:e=.25,velocity:t=0,mass:n=1}){let r,i,a=1-e;a=Ko(fF,pF,a),s=Ko(dF,hF,Aa(s)),a<1?(r=u=>{const h=u*a,f=h*s,p=h-t,m=Pw(u,a),g=Math.exp(-f);return cx-p/m*g},i=u=>{const f=u*a*s,p=f*t+t,m=Math.pow(a,2)*Math.pow(u,2)*s,g=Math.exp(-f),y=Pw(Math.pow(u,2),a);return(-r(u)+cx>0?-1:1)*((p-m)*g)/y}):(r=u=>{const h=Math.exp(-u*s),f=(u-t)*s+1;return-cx+h*f},i=u=>{const h=Math.exp(-u*s),f=(t-u)*(s*s);return h*f});const o=5/s,l=yF(r,i,o);if(s=Fc(s),isNaN(l))return{stiffness:100,damping:10,duration:s};{const u=Math.pow(l,2)*n;return{stiffness:u,damping:a*2*Math.sqrt(n*u),duration:s}}}const gF=12;function yF(s,e,t){let n=t;for(let r=1;r<gF;r++)n=n-s(n)/e(n);return n}function Pw(s,e){return s*Math.sqrt(1-e*e)}const vF=["duration","bounce"],xF=["stiffness","damping","mass"];function H1(s,e){return e.some(t=>s[t]!==void 0)}function wF(s){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...s};if(!H1(s,xF)&&H1(s,vF)){const t=mF(s);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function l2({keyframes:s,restDelta:e,restSpeed:t,...n}){const r=s[0],i=s[s.length-1],a={done:!1,value:r},{stiffness:o,damping:l,mass:u,duration:h,velocity:f,isResolvedFromDuration:p}=wF({...n,velocity:-Aa(n.velocity||0)}),m=f||0,g=l/(2*Math.sqrt(o*u)),y=i-r,b=Aa(Math.sqrt(o/u)),v=Math.abs(y)<5;t||(t=v?.01:2),e||(e=v?.005:.5);let x;if(g<1){const w=Pw(b,g);x=E=>{const T=Math.exp(-g*b*E);return i-T*((m+g*b*y)/w*Math.sin(w*E)+y*Math.cos(w*E))}}else if(g===1)x=w=>i-Math.exp(-b*w)*(y+(m+b*y)*w);else{const w=b*Math.sqrt(g*g-1);x=E=>{const T=Math.exp(-g*b*E),C=Math.min(w*E,300);return i-T*((m+g*b*y)*Math.sinh(C)+w*y*Math.cosh(C))/w}}return{calculatedDuration:p&&h||null,next:w=>{const E=x(w);if(p)a.done=w>=h;else{let T=m;w!==0&&(g<1?T=o2(x,w,E):T=0);const C=Math.abs(T)<=t,N=Math.abs(i-E)<=e;a.done=C&&N}return a.value=a.done?i:E,a}}}function V1({keyframes:s,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:a,min:o,max:l,restDelta:u=.5,restSpeed:h}){const f=s[0],p={done:!1,value:f},m=j=>o!==void 0&&j<o||l!==void 0&&j>l,g=j=>o===void 0?l:l===void 0||Math.abs(o-j)<Math.abs(l-j)?o:l;let y=t*e;const b=f+y,v=a===void 0?b:a(b);v!==b&&(y=v-f);const x=j=>-y*Math.exp(-j/n),w=j=>v+x(j),E=j=>{const P=x(j),M=w(j);p.done=Math.abs(P)<=u,p.value=p.done?v:M};let T,C;const N=j=>{m(p.value)&&(T=j,C=l2({keyframes:[p.value,g(p.value)],velocity:o2(w,j,p.value),damping:r,stiffness:i,restDelta:u,restSpeed:h}))};return N(0),{calculatedDuration:null,next:j=>{let P=!1;return!C&&T===void 0&&(P=!0,E(j),N(j)),T!==void 0&&j>T?C.next(j-T):(!P&&E(j),p)}}}const bF=s=>{const e=({timestamp:t})=>s(t);return{start:()=>yt.update(e,!0),stop:()=>La(e),now:()=>Fs.isProcessing?Fs.timestamp:performance.now()}},z1=2e4;function W1(s){let e=0;const t=50;let n=s.next(e);for(;!n.done&&e<z1;)e+=t,n=s.next(e);return e>=z1?1/0:e}const SF={decay:V1,inertia:V1,tween:ey,keyframes:ey,spring:l2};function ty({autoplay:s=!0,delay:e=0,driver:t=bF,keyframes:n,type:r="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:o="loop",onPlay:l,onStop:u,onComplete:h,onUpdate:f,...p}){let m=1,g=!1,y,b;const v=()=>{b=new Promise(J=>{y=J})};v();let x;const w=SF[r]||ey;let E;w!==ey&&typeof n[0]!="number"&&(E=i2([0,100],n,{clamp:!1}),n=[0,100]);const T=w({...p,keyframes:n});let C;o==="mirror"&&(C=w({...p,keyframes:[...n].reverse(),velocity:-(p.velocity||0)}));let N="idle",j=null,P=null,M=null;T.calculatedDuration===null&&i&&(T.calculatedDuration=W1(T));const{calculatedDuration:V}=T;let L=1/0,I=1/0;V!==null&&(L=V+a,I=L*(i+1)-a);let O=0;const X=J=>{if(P===null)return;m>0&&(P=Math.min(P,J)),m<0&&(P=Math.min(J-I/m,P)),j!==null?O=j:O=Math.round(J-P)*m;const ee=O-e*(m>=0?1:-1),de=m>=0?ee<0:ee>I;O=Math.max(ee,0),N==="finished"&&j===null&&(O=I);let ge=O,Ce=T;if(i){const Re=Math.min(O,I)/L;let Se=Math.floor(Re),Ze=Re%1;!Ze&&Re>=1&&(Ze=1),Ze===1&&Se--,Se=Math.min(Se,i+1),!!(Se%2)&&(o==="reverse"?(Ze=1-Ze,a&&(Ze-=a/L)):o==="mirror"&&(Ce=C)),ge=Ko(0,1,Ze)*L}const B=de?{done:!1,value:n[0]}:Ce.next(ge);E&&(B.value=E(B.value));let{done:K}=B;!de&&V!==null&&(K=m>=0?O>=I:O<=0);const xe=j===null&&(N==="finished"||N==="running"&&K);return f&&f(B.value),xe&&D(),B},$=()=>{x&&x.stop(),x=void 0},H=()=>{N="idle",$(),y(),v(),P=M=null},D=()=>{N="finished",h&&h(),$(),y()},F=()=>{if(g)return;x||(x=t(X));const J=x.now();l&&l(),j!==null?P=J-j:(!P||N==="finished")&&(P=J),N==="finished"&&v(),M=P,j=null,N="running",x.start()};s&&F();const q={then(J,ee){return b.then(J,ee)},get time(){return Aa(O)},set time(J){J=Fc(J),O=J,j!==null||!x||m===0?j=J:P=x.now()-J/m},get duration(){const J=T.calculatedDuration===null?W1(T):T.calculatedDuration;return Aa(J)},get speed(){return m},set speed(J){J===m||!x||(m=J,q.time=Aa(O))},get state(){return N},play:F,pause:()=>{N="paused",j=O},stop:()=>{g=!0,N!=="idle"&&(N="idle",u&&u(),H())},cancel:()=>{M!==null&&X(M),H()},complete:()=>{N="finished"},sample:J=>(P=0,X(J))};return q}function _F(s){let e;return()=>(e===void 0&&(e=s()),e)}const EF=_F(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),AF=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),_g=10,kF=2e4,TF=(s,e)=>e.type==="spring"||s==="backgroundColor"||!$N(e.ease);function CF(s,e,{onUpdate:t,onComplete:n,...r}){if(!(EF()&&AF.has(e)&&!r.repeatDelay&&r.repeatType!=="mirror"&&r.damping!==0&&r.type!=="inertia"))return!1;let a=!1,o,l,u=!1;const h=()=>{l=new Promise(w=>{o=w})};h();let{keyframes:f,duration:p=300,ease:m,times:g}=r;if(TF(e,r)){const w=ty({...r,repeat:0,delay:0});let E={done:!1,value:f[0]};const T=[];let C=0;for(;!E.done&&C<kF;)E=w.sample(C),T.push(E.value),C+=_g;g=void 0,f=T,p=C-_g,m="linear"}const y=OO(s.owner.current,e,f,{...r,duration:p,ease:m,times:g}),b=()=>{u=!1,y.cancel()},v=()=>{u=!0,yt.update(b),o(),h()};return y.onfinish=()=>{u||(s.set(FO(f,r)),n&&n(),v())},{then(w,E){return l.then(w,E)},attachTimeline(w){return y.timeline=w,y.onfinish=null,Ht},get time(){return Aa(y.currentTime||0)},set time(w){y.currentTime=Fc(w)},get speed(){return y.playbackRate},set speed(w){y.playbackRate=w},get duration(){return Aa(p)},play:()=>{a||(y.play(),La(b))},pause:()=>y.pause(),stop:()=>{if(a=!0,y.playState==="idle")return;const{currentTime:w}=y;if(w){const E=ty({...r,autoplay:!1});s.setWithVelocity(E.sample(w-_g).value,E.sample(w).value,_g)}v()},complete:()=>{u||y.finish()},cancel:v}}function NF({keyframes:s,delay:e,onUpdate:t,onComplete:n}){const r=()=>(t&&t(s[s.length-1]),n&&n(),{time:0,speed:1,duration:0,play:Ht,pause:Ht,stop:Ht,then:i=>(i(),Promise.resolve()),cancel:Ht,complete:Ht});return e?ty({keyframes:[0,1],duration:0,delay:e,onComplete:r}):r()}const jF={type:"spring",stiffness:500,damping:25,restSpeed:10},PF=s=>({type:"spring",stiffness:550,damping:s===0?2*Math.sqrt(550):30,restSpeed:10}),RF={type:"keyframes",duration:.8},LF={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},DF=(s,{keyframes:e})=>e.length>2?RF:Yc.has(s)?s.startsWith("scale")?PF(e[1]):jF:LF,Rw=(s,e)=>s==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Xo.test(e)||e==="0")&&!e.startsWith("url(")),MF=new Set(["brightness","contrast","saturate","opacity"]);function IF(s){const[e,t]=s.slice(0,-1).split("(");if(e==="drop-shadow")return s;const[n]=t.match(rv)||[];if(!n)return s;const r=t.replace(n,"");let i=MF.has(e)?1:0;return n!==t&&(i*=100),e+"("+i+r+")"}const OF=/([a-z-]*)\(.*?\)/g,Lw={...Xo,getAnimatableNone:s=>{const e=s.match(OF);return e?e.map(IF).join(" "):s}},FF={...SN,color:en,backgroundColor:en,outlineColor:en,fill:en,stroke:en,borderColor:en,borderTopColor:en,borderRightColor:en,borderBottomColor:en,borderLeftColor:en,filter:Lw,WebkitFilter:Lw},A_=s=>FF[s];function c2(s,e){let t=A_(s);return t!==Lw&&(t=Xo),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const u2=s=>/^0[^.\s]+$/.test(s);function $F(s){if(typeof s=="number")return s===0;if(s!==null)return s==="none"||s==="0"||u2(s)}function UF(s,e,t,n){const r=Rw(e,t);let i;Array.isArray(t)?i=[...t]:i=[null,t];const a=n.from!==void 0?n.from:s.get();let o;const l=[];for(let u=0;u<i.length;u++)i[u]===null&&(i[u]=u===0?a:i[u-1]),$F(i[u])&&l.push(u),typeof i[u]=="string"&&i[u]!=="none"&&i[u]!=="0"&&(o=i[u]);if(r&&l.length&&o)for(let u=0;u<l.length;u++){const h=l[u];i[h]=c2(e,o)}return i}function BF({when:s,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:r,repeat:i,repeatType:a,repeatDelay:o,from:l,elapsed:u,...h}){return!!Object.keys(h).length}function k_(s,e){return s[e]||s.default||s}const HF={skipAnimations:!1},T_=(s,e,t,n={})=>r=>{const i=k_(n,s)||{},a=i.delay||n.delay||0;let{elapsed:o=0}=n;o=o-Fc(a);const l=UF(e,s,t,i),u=l[0],h=l[l.length-1],f=Rw(s,u),p=Rw(s,h);let m={keyframes:l,velocity:e.getVelocity(),ease:"easeOut",...i,delay:-o,onUpdate:g=>{e.set(g),i.onUpdate&&i.onUpdate(g)},onComplete:()=>{r(),i.onComplete&&i.onComplete()}};if(BF(i)||(m={...m,...DF(s,m)}),m.duration&&(m.duration=Fc(m.duration)),m.repeatDelay&&(m.repeatDelay=Fc(m.repeatDelay)),!f||!p||IO.current||i.type===!1||HF.skipAnimations)return NF(m);if(!n.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const g=CF(e,s,m);if(g)return g}return ty(m)};function sy(s){return!!(Tn(s)&&s.add)}const d2=s=>/^\-?\d*\.?\d+$/.test(s);function C_(s,e){s.indexOf(e)===-1&&s.push(e)}function N_(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}class j_{constructor(){this.subscriptions=[]}add(e){return C_(this.subscriptions,e),()=>N_(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){const a=this.subscriptions[i];a&&a(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const VF=s=>!isNaN(parseFloat(s));class zF{constructor(e,t={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(n,r=!0)=>{this.prev=this.current,this.current=n;const{delta:i,timestamp:a}=Fs;this.lastUpdated!==a&&(this.timeDelta=i,this.lastUpdated=a,yt.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>yt.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{n!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=VF(this.current),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new j_);const n=this.events[e].add(t);return e==="change"?()=>{n(),yt.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,n){this.set(t),this.prev=e,this.timeDelta=n}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?a2(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ah(s,e){return new zF(s,e)}const h2=s=>e=>e.test(s),WF={test:s=>s==="auto",parse:s=>s},f2=[Jc,Te,Ri,Ba,QI,JI,WF],Ch=s=>f2.find(h2(s)),GF=[...f2,en,Xo],qF=s=>GF.find(h2(s));function KF(s,e,t){s.hasValue(e)?s.getValue(e).set(t):s.addValue(e,ah(t))}function XF(s,e){const t=av(s,e);let{transitionEnd:n={},transition:r={},...i}=t?s.makeTargetAnimatable(t,!1):{};i={...i,...n};for(const a in i){const o=hO(i[a]);KF(s,a,o)}}function YF(s,e,t){var n,r;const i=Object.keys(e).filter(o=>!s.hasValue(o)),a=i.length;if(a)for(let o=0;o<a;o++){const l=i[o],u=e[l];let h=null;Array.isArray(u)&&(h=u[0]),h===null&&(h=(r=(n=t[l])!==null&&n!==void 0?n:s.readValue(l))!==null&&r!==void 0?r:e[l]),h!=null&&(typeof h=="string"&&(d2(h)||u2(h))?h=parseFloat(h):!qF(h)&&Xo.test(u)&&(h=c2(l,u)),s.addValue(l,ah(h,{owner:s})),t[l]===void 0&&(t[l]=h),h!==null&&s.setBaseTarget(l,h))}}function JF(s,e){return e?(e[s]||e.default||e).from:void 0}function QF(s,e,t){const n={};for(const r in s){const i=JF(r,e);if(i!==void 0)n[r]=i;else{const a=t.getValue(r);a&&(n[r]=a.get())}}return n}function ZF({protectedKeys:s,needsAnimating:e},t){const n=s.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function e4(s,e){const t=s.get();if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}else return t!==e}function p2(s,e,{delay:t=0,transitionOverride:n,type:r}={}){let{transition:i=s.getDefaultTransition(),transitionEnd:a,...o}=s.makeTargetAnimatable(e);const l=s.getValue("willChange");n&&(i=n);const u=[],h=r&&s.animationState&&s.animationState.getState()[r];for(const f in o){const p=s.getValue(f),m=o[f];if(!p||m===void 0||h&&ZF(h,f))continue;const g={delay:t,elapsed:0,...k_(i||{},f)};if(window.HandoffAppearAnimations){const v=s.getProps()[mN];if(v){const x=window.HandoffAppearAnimations(v,f,p,yt);x!==null&&(g.elapsed=x,g.isHandoff=!0)}}let y=!g.isHandoff&&!e4(p,m);if(g.type==="spring"&&(p.getVelocity()||g.velocity)&&(y=!1),p.animation&&(y=!1),y)continue;p.start(T_(f,p,m,s.shouldReduceMotion&&Yc.has(f)?{type:!1}:g));const b=p.animation;sy(l)&&(l.add(f),b.then(()=>l.remove(f))),u.push(b)}return a&&Promise.all(u).then(()=>{a&&XF(s,a)}),u}function Dw(s,e,t={}){const n=av(s,e,t.custom);let{transition:r=s.getDefaultTransition()||{}}=n||{};t.transitionOverride&&(r=t.transitionOverride);const i=n?()=>Promise.all(p2(s,n,t)):()=>Promise.resolve(),a=s.variantChildren&&s.variantChildren.size?(l=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:f}=r;return t4(s,e,u+l,h,f,t)}:()=>Promise.resolve(),{when:o}=r;if(o){const[l,u]=o==="beforeChildren"?[i,a]:[a,i];return l().then(()=>u())}else return Promise.all([i(),a(t.delay)])}function t4(s,e,t=0,n=0,r=1,i){const a=[],o=(s.variantChildren.size-1)*n,l=r===1?(u=0)=>u*n:(u=0)=>o-u*n;return Array.from(s.variantChildren).sort(s4).forEach((u,h)=>{u.notify("AnimationStart",e),a.push(Dw(u,e,{...i,delay:t+l(h)}).then(()=>u.notify("AnimationComplete",e)))}),Promise.all(a)}function s4(s,e){return s.sortNodePosition(e)}function n4(s,e,t={}){s.notify("AnimationStart",e);let n;if(Array.isArray(e)){const r=e.map(i=>Dw(s,i,t));n=Promise.all(r)}else if(typeof e=="string")n=Dw(s,e,t);else{const r=typeof e=="function"?av(s,e,t.custom):e;n=Promise.all(p2(s,r,t))}return n.then(()=>s.notify("AnimationComplete",e))}const r4=[...d_].reverse(),i4=d_.length;function a4(s){return e=>Promise.all(e.map(({animation:t,options:n})=>n4(s,t,n)))}function o4(s){let e=a4(s);const t=c4();let n=!0;const r=(l,u)=>{const h=av(s,u);if(h){const{transition:f,transitionEnd:p,...m}=h;l={...l,...m,...p}}return l};function i(l){e=l(s)}function a(l,u){const h=s.getProps(),f=s.getVariantContext(!0)||{},p=[],m=new Set;let g={},y=1/0;for(let v=0;v<i4;v++){const x=r4[v],w=t[x],E=h[x]!==void 0?h[x]:f[x],T=Gf(E),C=x===u?w.isActive:null;C===!1&&(y=v);let N=E===f[x]&&E!==h[x]&&T;if(N&&n&&s.manuallyAnimateOnMount&&(N=!1),w.protectedKeys={...g},!w.isActive&&C===null||!E&&!w.prevProp||sv(E)||typeof E=="boolean")continue;let P=l4(w.prevProp,E)||x===u&&w.isActive&&!N&&T||v>y&&T,M=!1;const V=Array.isArray(E)?E:[E];let L=V.reduce(r,{});C===!1&&(L={});const{prevResolvedValues:I={}}=w,O={...I,...L},X=$=>{P=!0,m.has($)&&(M=!0,m.delete($)),w.needsAnimating[$]=!0};for(const $ in O){const H=L[$],D=I[$];if(g.hasOwnProperty($))continue;let F=!1;Q0(H)&&Q0(D)?F=!ON(H,D):F=H!==D,F?H!==void 0?X($):m.add($):H!==void 0&&m.has($)?X($):w.protectedKeys[$]=!0}w.prevProp=E,w.prevResolvedValues=L,w.isActive&&(g={...g,...L}),n&&s.blockInitialAnimation&&(P=!1),P&&(!N||M)&&p.push(...V.map($=>({animation:$,options:{type:x,...l}})))}if(m.size){const v={};m.forEach(x=>{const w=s.getBaseTarget(x);w!==void 0&&(v[x]=w)}),p.push({animation:v})}let b=!!p.length;return n&&(h.initial===!1||h.initial===h.animate)&&!s.manuallyAnimateOnMount&&(b=!1),n=!1,b?e(p):Promise.resolve()}function o(l,u,h){var f;if(t[l].isActive===u)return Promise.resolve();(f=s.variantChildren)===null||f===void 0||f.forEach(m=>{var g;return(g=m.animationState)===null||g===void 0?void 0:g.setActive(l,u)}),t[l].isActive=u;const p=a(h,l);for(const m in t)t[m].protectedKeys={};return p}return{animateChanges:a,setActive:o,setAnimateFunction:i,getState:()=>t}}function l4(s,e){return typeof e=="string"?e!==s:Array.isArray(e)?!ON(e,s):!1}function ol(s=!1){return{isActive:s,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function c4(){return{animate:ol(!0),whileInView:ol(),whileHover:ol(),whileTap:ol(),whileDrag:ol(),whileFocus:ol(),exit:ol()}}class u4 extends rl{constructor(e){super(e),e.animationState||(e.animationState=o4(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),sv(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}let d4=0;class h4 extends rl{constructor(){super(...arguments),this.id=d4++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e,{custom:n??this.node.getProps().custom});t&&!e&&i.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const f4={animation:{Feature:u4},exit:{Feature:h4}},G1=(s,e)=>Math.abs(s-e);function p4(s,e){const t=G1(s.x,e.x),n=G1(s.y,e.y);return Math.sqrt(t**2+n**2)}class m2{constructor(e,t,{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=dx(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=p4(f.offset,{x:0,y:0})>=3;if(!p&&!m)return;const{point:g}=f,{timestamp:y}=Fs;this.history.push({...g,timestamp:y});const{onStart:b,onMove:v}=this.handlers;p||(b&&b(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,f)},this.handlePointerMove=(f,p)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=ux(p,this.transformPagePoint),yt.update(this.updatePoint,!0)},this.handlePointerUp=(f,p)=>{this.end();const{onEnd:m,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=dx(f.type==="pointercancel"?this.lastMoveEventInfo:ux(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(f,b),g&&g(f,b)},!RN(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.contextWindow=r||window;const a=iv(e),o=ux(a,this.transformPagePoint),{point:l}=o,{timestamp:u}=Fs;this.history=[{...l,timestamp:u}];const{onSessionStart:h}=t;h&&h(e,dx(o,this.history)),this.removeListeners=Wo(Ea(this.contextWindow,"pointermove",this.handlePointerMove),Ea(this.contextWindow,"pointerup",this.handlePointerUp),Ea(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),La(this.updatePoint)}}function ux(s,e){return e?{point:e(s.point)}:s}function q1(s,e){return{x:s.x-e.x,y:s.y-e.y}}function dx({point:s},e){return{point:s,delta:q1(s,g2(e)),offset:q1(s,m4(e)),velocity:g4(e,.1)}}function m4(s){return s[0]}function g2(s){return s[s.length-1]}function g4(s,e){if(s.length<2)return{x:0,y:0};let t=s.length-1,n=null;const r=g2(s);for(;t>=0&&(n=s[t],!(r.timestamp-n.timestamp>Fc(e)));)t--;if(!n)return{x:0,y:0};const i=Aa(r.timestamp-n.timestamp);if(i===0)return{x:0,y:0};const a={x:(r.x-n.x)/i,y:(r.y-n.y)/i};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Qn(s){return s.max-s.min}function Mw(s,e=0,t=.01){return Math.abs(s-e)<=t}function K1(s,e,t,n=.5){s.origin=n,s.originPoint=Pt(e.min,e.max,s.origin),s.scale=Qn(t)/Qn(e),(Mw(s.scale,1,1e-4)||isNaN(s.scale))&&(s.scale=1),s.translate=Pt(t.min,t.max,s.origin)-s.originPoint,(Mw(s.translate)||isNaN(s.translate))&&(s.translate=0)}function bf(s,e,t,n){K1(s.x,e.x,t.x,n?n.originX:void 0),K1(s.y,e.y,t.y,n?n.originY:void 0)}function X1(s,e,t){s.min=t.min+e.min,s.max=s.min+Qn(e)}function y4(s,e,t){X1(s.x,e.x,t.x),X1(s.y,e.y,t.y)}function Y1(s,e,t){s.min=e.min-t.min,s.max=s.min+Qn(e)}function Sf(s,e,t){Y1(s.x,e.x,t.x),Y1(s.y,e.y,t.y)}function v4(s,{min:e,max:t},n){return e!==void 0&&s<e?s=n?Pt(e,s,n.min):Math.max(s,e):t!==void 0&&s>t&&(s=n?Pt(t,s,n.max):Math.min(s,t)),s}function J1(s,e,t){return{min:e!==void 0?s.min+e:void 0,max:t!==void 0?s.max+t-(s.max-s.min):void 0}}function x4(s,{top:e,left:t,bottom:n,right:r}){return{x:J1(s.x,t,r),y:J1(s.y,e,n)}}function Q1(s,e){let t=e.min-s.min,n=e.max-s.max;return e.max-e.min<s.max-s.min&&([t,n]=[n,t]),{min:t,max:n}}function w4(s,e){return{x:Q1(s.x,e.x),y:Q1(s.y,e.y)}}function b4(s,e){let t=.5;const n=Qn(s),r=Qn(e);return r>n?t=Kf(e.min,e.max-n,s.min):n>r&&(t=Kf(s.min,s.max-r,e.min)),Ko(0,1,t)}function S4(s,e){const t={};return e.min!==void 0&&(t.min=e.min-s.min),e.max!==void 0&&(t.max=e.max-s.min),t}const Iw=.35;function _4(s=Iw){return s===!1?s=0:s===!0&&(s=Iw),{x:Z1(s,"left","right"),y:Z1(s,"top","bottom")}}function Z1(s,e,t){return{min:eA(s,e),max:eA(s,t)}}function eA(s,e){return typeof s=="number"?s:s[e]||0}const tA=()=>({translate:0,scale:1,origin:0,originPoint:0}),Lu=()=>({x:tA(),y:tA()}),sA=()=>({min:0,max:0}),Wt=()=>({x:sA(),y:sA()});function or(s){return[s("x"),s("y")]}function y2({top:s,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:s,max:n}}}function E4({x:s,y:e}){return{top:e.min,right:s.max,bottom:e.max,left:s.min}}function A4(s,e){if(!e)return s;const t=e({x:s.left,y:s.top}),n=e({x:s.right,y:s.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}function hx(s){return s===void 0||s===1}function Ow({scale:s,scaleX:e,scaleY:t}){return!hx(s)||!hx(e)||!hx(t)}function fl(s){return Ow(s)||v2(s)||s.z||s.rotate||s.rotateX||s.rotateY}function v2(s){return nA(s.x)||nA(s.y)}function nA(s){return s&&s!=="0%"}function ny(s,e,t){const n=s-t,r=e*n;return t+r}function rA(s,e,t,n,r){return r!==void 0&&(s=ny(s,r,n)),ny(s,t,n)+e}function Fw(s,e=0,t=1,n,r){s.min=rA(s.min,e,t,n,r),s.max=rA(s.max,e,t,n,r)}function x2(s,{x:e,y:t}){Fw(s.x,e.translate,e.scale,e.originPoint),Fw(s.y,t.translate,t.scale,t.originPoint)}function k4(s,e,t,n=!1){const r=t.length;if(!r)return;e.x=e.y=1;let i,a;for(let o=0;o<r;o++){i=t[o],a=i.projectionDelta;const l=i.instance;l&&l.style&&l.style.display==="contents"||(n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Du(s,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,x2(s,a)),n&&fl(i.latestValues)&&Du(s,i.latestValues))}e.x=iA(e.x),e.y=iA(e.y)}function iA(s){return Number.isInteger(s)||s>1.0000000000001||s<.999999999999?s:1}function Ga(s,e){s.min=s.min+e,s.max=s.max+e}function aA(s,e,[t,n,r]){const i=e[r]!==void 0?e[r]:.5,a=Pt(s.min,s.max,i);Fw(s,e[t],e[n],a,e.scale)}const T4=["x","scaleX","originX"],C4=["y","scaleY","originY"];function Du(s,e){aA(s.x,e,T4),aA(s.y,e,C4)}function w2(s,e){return y2(A4(s.getBoundingClientRect(),e))}function N4(s,e,t){const n=w2(s,t),{scroll:r}=e;return r&&(Ga(n.x,r.offset.x),Ga(n.y,r.offset.y)),n}const b2=({current:s})=>s?s.ownerDocument.defaultView:null,j4=new WeakMap;class P4{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Wt(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const r=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(iv(h,"page").point)},i=(h,f)=>{const{drag:p,dragPropagation:m,onDragStart:g}=this.getProps();if(p&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=DN(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),or(b=>{let v=this.getAxisMotionValue(b).get()||0;if(Ri.test(v)){const{projection:x}=this.visualElement;if(x&&x.layout){const w=x.layout.layoutBox[b];w&&(v=Qn(w)*(parseFloat(v)/100))}}this.originPoint[b]=v}),g&&yt.update(()=>g(h,f),!1,!0);const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(h,f)=>{const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:g,onDrag:y}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:b}=f;if(m&&this.currentDirection===null){this.currentDirection=R4(b),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",f.point,b),this.updateAxis("y",f.point,b),this.visualElement.render(),y&&y(h,f)},o=(h,f)=>this.stop(h,f),l=()=>or(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:u}=this.getProps();this.panSession=new m2(e,{onSessionStart:r,onStart:i,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,contextWindow:b2(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&yt.update(()=>i(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!Eg(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=v4(a,this.constraints[e],this.elastic[e])),i.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;t&&Pu(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=x4(r.layoutBox,t):this.constraints=!1,this.elastic=_4(n),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&or(a=>{this.getAxisMotionValue(a)&&(this.constraints[a]=S4(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Pu(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=N4(n,r.root,this.visualElement.getTransformPagePoint());let a=w4(r.layout.layoutBox,i);if(t){const o=t(E4(a));this.hasMutatedConstraints=!!o,o&&(a=y2(o))}return a}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},u=or(h=>{if(!Eg(h,t,this.currentDirection))return;let f=l&&l[h]||{};a&&(f={min:0,max:0});const p=r?200:1e6,m=r?40:1e7,g={type:"inertia",velocity:n?e[h]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(h,g)});return Promise.all(u).then(o)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(T_(e,n,0,t))}stopAnimation(){or(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){or(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){or(t=>{const{drag:n}=this.getProps();if(!Eg(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:a,max:o}=r.layout.layoutBox[t];i.set(e[t]-Pt(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Pu(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};or(a=>{const o=this.getAxisMotionValue(a);if(o){const l=o.get();r[a]=b4({min:l,max:l},this.constraints[a])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),or(a=>{if(!Eg(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:u}=this.constraints[a];o.set(Pt(l,u,r[a]))})}addListeners(){if(!this.visualElement.current)return;j4.set(this.visualElement,this);const e=this.visualElement.current,t=Ea(e,"pointerdown",l=>{const{drag:u,dragListener:h=!0}=this.getProps();u&&h&&this.start(l)}),n=()=>{const{dragConstraints:l}=this.getProps();Pu(l)&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),n();const a=Sa(window,"resize",()=>this.scalePositionWithinConstraints()),o=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(or(h=>{const f=this.getAxisMotionValue(h);f&&(this.originPoint[h]+=l[h].translate,f.set(f.get()+l[h].translate))}),this.visualElement.render())});return()=>{a(),t(),i(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:a=Iw,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:a,dragMomentum:o}}}function Eg(s,e,t){return(e===!0||e===s)&&(t===null||t===s)}function R4(s,e=10){let t=null;return Math.abs(s.y)>e?t="y":Math.abs(s.x)>e&&(t="x"),t}class L4 extends rl{constructor(e){super(e),this.removeGroupControls=Ht,this.removeListeners=Ht,this.controls=new P4(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ht}unmount(){this.removeGroupControls(),this.removeListeners()}}const oA=s=>(e,t)=>{s&&yt.update(()=>s(e,t))};class D4 extends rl{constructor(){super(...arguments),this.removePointerDownListener=Ht}onPointerDown(e){this.session=new m2(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:b2(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:oA(e),onStart:oA(t),onMove:n,onEnd:(i,a)=>{delete this.session,r&&yt.update(()=>r(i,a))}}}mount(){this.removePointerDownListener=Ea(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function M4(){const s=_.useContext(ev);if(s===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:n}=s,r=_.useId();return _.useEffect(()=>n(r),[]),!e&&t?[!1,()=>t&&t(r)]:[!0]}const Kg={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function lA(s,e){return e.max===e.min?0:s/(e.max-e.min)*100}const Nh={correct:(s,e)=>{if(!e.target)return s;if(typeof s=="string")if(Te.test(s))s=parseFloat(s);else return s;const t=lA(s,e.target.x),n=lA(s,e.target.y);return`${t}% ${n}%`}},I4={correct:(s,{treeScale:e,projectionDelta:t})=>{const n=s,r=Xo.parse(s);if(r.length>5)return n;const i=Xo.createTransformer(s),a=typeof r[0]!="number"?1:0,o=t.x.scale*e.x,l=t.y.scale*e.y;r[0+a]/=o,r[1+a]/=l;const u=Pt(o,l,.5);return typeof r[2+a]=="number"&&(r[2+a]/=u),typeof r[3+a]=="number"&&(r[3+a]/=u),i(r)}};class O4 extends Iy.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;zI(F4),i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Kg.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,a=n.projection;return a&&(a.isPresent=i,r||e.layoutDependency!==t||t===void 0?a.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?a.promote():a.relegate()||yt.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function S2(s){const[e,t]=M4(),n=_.useContext(f_);return Iy.createElement(O4,{...s,layoutGroup:n,switchLayoutGroup:_.useContext(yN),isPresent:e,safeToRemove:t})}const F4={borderRadius:{...Nh,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Nh,borderTopRightRadius:Nh,borderBottomLeftRadius:Nh,borderBottomRightRadius:Nh,boxShadow:I4},_2=["TopLeft","TopRight","BottomLeft","BottomRight"],$4=_2.length,cA=s=>typeof s=="string"?parseFloat(s):s,uA=s=>typeof s=="number"||Te.test(s);function U4(s,e,t,n,r,i){r?(s.opacity=Pt(0,t.opacity!==void 0?t.opacity:1,B4(n)),s.opacityExit=Pt(e.opacity!==void 0?e.opacity:1,0,H4(n))):i&&(s.opacity=Pt(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,n));for(let a=0;a<$4;a++){const o=`border${_2[a]}Radius`;let l=dA(e,o),u=dA(t,o);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||uA(l)===uA(u)?(s[o]=Math.max(Pt(cA(l),cA(u),n),0),(Ri.test(u)||Ri.test(l))&&(s[o]+="%")):s[o]=u}(e.rotate||t.rotate)&&(s.rotate=Pt(e.rotate||0,t.rotate||0,n))}function dA(s,e){return s[e]!==void 0?s[e]:s.borderRadius}const B4=E2(0,.5,GN),H4=E2(.5,.95,Ht);function E2(s,e,t){return n=>n<s?0:n>e?1:t(Kf(s,e,n))}function hA(s,e){s.min=e.min,s.max=e.max}function rr(s,e){hA(s.x,e.x),hA(s.y,e.y)}function fA(s,e,t,n,r){return s-=e,s=ny(s,1/t,n),r!==void 0&&(s=ny(s,1/r,n)),s}function V4(s,e=0,t=1,n=.5,r,i=s,a=s){if(Ri.test(e)&&(e=parseFloat(e),e=Pt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Pt(i.min,i.max,n);s===i&&(o-=e),s.min=fA(s.min,e,t,o,r),s.max=fA(s.max,e,t,o,r)}function pA(s,e,[t,n,r],i,a){V4(s,e[t],e[n],e[r],e.scale,i,a)}const z4=["x","scaleX","originX"],W4=["y","scaleY","originY"];function mA(s,e,t,n){pA(s.x,e,z4,t?t.x:void 0,n?n.x:void 0),pA(s.y,e,W4,t?t.y:void 0,n?n.y:void 0)}function gA(s){return s.translate===0&&s.scale===1}function A2(s){return gA(s.x)&&gA(s.y)}function G4(s,e){return s.x.min===e.x.min&&s.x.max===e.x.max&&s.y.min===e.y.min&&s.y.max===e.y.max}function k2(s,e){return Math.round(s.x.min)===Math.round(e.x.min)&&Math.round(s.x.max)===Math.round(e.x.max)&&Math.round(s.y.min)===Math.round(e.y.min)&&Math.round(s.y.max)===Math.round(e.y.max)}function yA(s){return Qn(s.x)/Qn(s.y)}class q4{constructor(){this.members=[]}add(e){C_(this.members,e),e.scheduleRender()}remove(e){if(N_(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let n;for(let r=t;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){n=i;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function vA(s,e,t){let n="";const r=s.x.translate/e.x,i=s.y.translate/e.y;if((r||i)&&(n=`translate3d(${r}px, ${i}px, 0) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{rotate:l,rotateX:u,rotateY:h}=t;l&&(n+=`rotate(${l}deg) `),u&&(n+=`rotateX(${u}deg) `),h&&(n+=`rotateY(${h}deg) `)}const a=s.x.scale*e.x,o=s.y.scale*e.y;return(a!==1||o!==1)&&(n+=`scale(${a}, ${o})`),n||"none"}const K4=(s,e)=>s.depth-e.depth;class X4{constructor(){this.children=[],this.isDirty=!1}add(e){C_(this.children,e),this.isDirty=!0}remove(e){N_(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(K4),this.isDirty=!1,this.children.forEach(e)}}function Y4(s,e){const t=performance.now(),n=({timestamp:r})=>{const i=r-t;i>=e&&(La(n),s(i-e))};return yt.read(n,!0),()=>La(n)}function J4(s){window.MotionDebug&&window.MotionDebug.record(s)}function Q4(s){return s instanceof SVGElement&&s.tagName!=="svg"}function Z4(s,e,t){const n=Tn(s)?s:ah(s);return n.start(T_("",n,e,t)),n.animation}const xA=["","X","Y","Z"],e3={visibility:"hidden"},wA=1e3;let t3=0;const pl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function T2({attachResizeListener:s,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(a={},o=e==null?void 0:e()){this.id=t3++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,pl.totalNodes=pl.resolvedTargetDeltas=pl.recalculatedProjection=0,this.nodes.forEach(r3),this.nodes.forEach(c3),this.nodes.forEach(u3),this.nodes.forEach(i3),J4(pl)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new X4)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new j_),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Q4(a),this.instance=a;const{layoutId:l,layout:u,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(u||l)&&(this.isLayoutDirty=!0),s){let f;const p=()=>this.root.updateBlockedByResize=!1;s(a,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=Y4(p,250),Kg.hasAnimatedSinceResize&&(Kg.hasAnimatedSinceResize=!1,this.nodes.forEach(SA))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&h&&(l||u)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeTargetChanged:m,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||h.getDefaultTransition()||m3,{onLayoutAnimationStart:b,onLayoutAnimationComplete:v}=h.getProps(),x=!this.targetLayout||!k2(this.targetLayout,g)||m,w=!p&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||p&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,w);const E={...k_(y,"layout"),onPlay:b,onComplete:v};(h.shouldReduceMotion||this.options.layoutRoot)&&(E.delay=0,E.type=!1),this.startAnimation(E)}else p||SA(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,La(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(d3),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(bA);return}this.isUpdating||this.nodes.forEach(o3),this.isUpdating=!1,this.nodes.forEach(l3),this.nodes.forEach(s3),this.nodes.forEach(n3),this.clearAllSnapshots();const o=performance.now();Fs.delta=Ko(0,1e3/60,o-Fs.timestamp),Fs.timestamp=o,Fs.isProcessing=!0,sx.update.process(Fs),sx.preRender.process(Fs),sx.render.process(Fs),Fs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(a3),this.sharedNodes.forEach(h3)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,yt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){yt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Wt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&(this.scroll={animationId:this.root.animationId,phase:a,isRoot:n(this.instance),offset:t(this.instance)})}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform,o=this.projectionDelta&&!A2(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,h=u!==this.prevTransformTemplateValue;a&&(o||fl(this.latestValues)||h)&&(r(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),g3(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return Wt();const o=a.measureViewportBox(),{scroll:l}=this.root;return l&&(Ga(o.x,l.offset.x),Ga(o.y,l.offset.y)),o}removeElementScroll(a){const o=Wt();rr(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l],{scroll:h,options:f}=u;if(u!==this.root&&h&&f.layoutScroll){if(h.isRoot){rr(o,a);const{scroll:p}=this.root;p&&(Ga(o.x,-p.offset.x),Ga(o.y,-p.offset.y))}Ga(o.x,h.offset.x),Ga(o.y,h.offset.y)}}return o}applyTransform(a,o=!1){const l=Wt();rr(l,a);for(let u=0;u<this.path.length;u++){const h=this.path[u];!o&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Du(l,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),fl(h.latestValues)&&Du(l,h.latestValues)}return fl(this.latestValues)&&Du(l,this.latestValues),l}removeTransform(a){const o=Wt();rr(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!fl(u.latestValues))continue;Ow(u.latestValues)&&u.updateSnapshot();const h=Wt(),f=u.measurePageBox();rr(h,f),mA(o,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,h)}return fl(this.latestValues)&&mA(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==l;if(!(a||u&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=Fs.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Wt(),this.relativeTargetOrigin=Wt(),Sf(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),rr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Wt(),this.targetWithTransforms=Wt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),y4(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):rr(this.target,this.layout.layoutBox),x2(this.target,this.targetDelta)):rr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Wt(),this.relativeTargetOrigin=Wt(),Sf(this.relativeTargetOrigin,this.target,m.target),rr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}pl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Ow(this.parent.latestValues)||v2(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let u=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(u=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===Fs.timestamp&&(u=!1),u)return;const{layout:h,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||f))return;rr(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,m=this.treeScale.y;k4(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox);const{target:g}=o;if(!g){this.projectionTransform&&(this.projectionDelta=Lu(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Lu(),this.projectionDeltaWithTransform=Lu());const y=this.projectionTransform;bf(this.projectionDelta,this.layoutCorrected,g,this.latestValues),this.projectionTransform=vA(this.projectionDelta,this.treeScale),(this.projectionTransform!==y||this.treeScale.x!==p||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),pl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(a,o=!1){const l=this.snapshot,u=l?l.latestValues:{},h={...this.latestValues},f=Lu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const p=Wt(),m=l?l.source:void 0,g=this.layout?this.layout.source:void 0,y=m!==g,b=this.getStack(),v=!b||b.members.length<=1,x=!!(y&&!v&&this.options.crossfade===!0&&!this.path.some(p3));this.animationProgress=0;let w;this.mixTargetDelta=E=>{const T=E/1e3;_A(f.x,a.x,T),_A(f.y,a.y,T),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Sf(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f3(this.relativeTarget,this.relativeTargetOrigin,p,T),w&&G4(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Wt()),rr(w,this.relativeTarget)),y&&(this.animationValues=h,U4(h,u,this.latestValues,T,x,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(La(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=yt.update(()=>{Kg.hasAnimatedSinceResize=!0,this.currentAnimation=Z4(0,wA,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(wA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:u,latestValues:h}=a;if(!(!o||!l||!u)){if(this!==a&&this.layout&&u&&C2(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Wt();const f=Qn(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+f;const p=Qn(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}rr(o,l),Du(o,h),bf(this.projectionDeltaWithTransform,this.layoutCorrected,o,h)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new q4),this.sharedNodes.get(a).add(o);const u=o.options.initialPromotionConfig;o.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.rotate||l.rotateX||l.rotateY||l.rotateZ)&&(o=!0),!o)return;const u={};for(let h=0;h<xA.length;h++){const f="rotate"+xA[h];l[f]&&(u[f]=l[f],a.setStaticValue(f,0))}a.render();for(const h in u)a.setStaticValue(h,u[h]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return e3;const u={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,u.opacity="",u.pointerEvents=qg(a==null?void 0:a.pointerEvents)||"",u.transform=h?h(this.latestValues,""):"none",u;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=qg(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!fl(this.latestValues)&&(y.transform=h?h({},""):"none",this.hasProjected=!1),y}const p=f.animationValues||f.latestValues;this.applyTransformsToTarget(),u.transform=vA(this.projectionDeltaWithTransform,this.treeScale,p),h&&(u.transform=h(p,u.transform));const{x:m,y:g}=this.projectionDelta;u.transformOrigin=`${m.origin*100}% ${g.origin*100}% 0`,f.animationValues?u.opacity=f===this?(l=(o=p.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:u.opacity=f===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const y in Y0){if(p[y]===void 0)continue;const{correct:b,applyTo:v}=Y0[y],x=u.transform==="none"?p[y]:b(p[y],f);if(v){const w=v.length;for(let E=0;E<w;E++)u[v[E]]=x}else u[y]=x}return this.options.layoutId&&(u.pointerEvents=f===this?qg(a==null?void 0:a.pointerEvents)||"":"none"),u}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(bA),this.root.sharedNodes.clear()}}}function s3(s){s.updateLayout()}function n3(s){var e;const t=((e=s.resumeFrom)===null||e===void 0?void 0:e.snapshot)||s.snapshot;if(s.isLead()&&s.layout&&t&&s.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=s.layout,{animationType:i}=s.options,a=t.source!==s.layout.source;i==="size"?or(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],m=Qn(p);p.min=n[f].min,p.max=p.min+m}):C2(i,t.layoutBox,n)&&or(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],m=Qn(n[f]);p.max=p.min+m,s.relativeTarget&&!s.currentAnimation&&(s.isProjectionDirty=!0,s.relativeTarget[f].max=s.relativeTarget[f].min+m)});const o=Lu();bf(o,n,t.layoutBox);const l=Lu();a?bf(l,s.applyTransform(r,!0),t.measuredBox):bf(l,n,t.layoutBox);const u=!A2(o);let h=!1;if(!s.resumeFrom){const f=s.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:m}=f;if(p&&m){const g=Wt();Sf(g,t.layoutBox,p.layoutBox);const y=Wt();Sf(y,n,m.layoutBox),k2(g,y)||(h=!0),f.options.layoutRoot&&(s.relativeTarget=y,s.relativeTargetOrigin=g,s.relativeParent=f)}}}s.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:l,layoutDelta:o,hasLayoutChanged:u,hasRelativeTargetChanged:h})}else if(s.isLead()){const{onExitComplete:n}=s.options;n&&n()}s.options.transition=void 0}function r3(s){pl.totalNodes++,s.parent&&(s.isProjecting()||(s.isProjectionDirty=s.parent.isProjectionDirty),s.isSharedProjectionDirty||(s.isSharedProjectionDirty=!!(s.isProjectionDirty||s.parent.isProjectionDirty||s.parent.isSharedProjectionDirty)),s.isTransformDirty||(s.isTransformDirty=s.parent.isTransformDirty))}function i3(s){s.isProjectionDirty=s.isSharedProjectionDirty=s.isTransformDirty=!1}function a3(s){s.clearSnapshot()}function bA(s){s.clearMeasurements()}function o3(s){s.isLayoutDirty=!1}function l3(s){const{visualElement:e}=s.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),s.resetTransform()}function SA(s){s.finishAnimation(),s.targetDelta=s.relativeTarget=s.target=void 0,s.isProjectionDirty=!0}function c3(s){s.resolveTargetDelta()}function u3(s){s.calcProjection()}function d3(s){s.resetRotation()}function h3(s){s.removeLeadSnapshot()}function _A(s,e,t){s.translate=Pt(e.translate,0,t),s.scale=Pt(e.scale,1,t),s.origin=e.origin,s.originPoint=e.originPoint}function EA(s,e,t,n){s.min=Pt(e.min,t.min,n),s.max=Pt(e.max,t.max,n)}function f3(s,e,t,n){EA(s.x,e.x,t.x,n),EA(s.y,e.y,t.y,n)}function p3(s){return s.animationValues&&s.animationValues.opacityExit!==void 0}const m3={duration:.45,ease:[.4,0,.1,1]},AA=s=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(s),kA=AA("applewebkit/")&&!AA("chrome/")?Math.round:Ht;function TA(s){s.min=kA(s.min),s.max=kA(s.max)}function g3(s){TA(s.x),TA(s.y)}function C2(s,e,t){return s==="position"||s==="preserve-aspect"&&!Mw(yA(e),yA(t),.2)}const y3=T2({attachResizeListener:(s,e)=>Sa(s,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),fx={current:void 0},N2=T2({measureScroll:s=>({x:s.scrollLeft,y:s.scrollTop}),defaultParent:()=>{if(!fx.current){const s=new y3({});s.mount(window),s.setOptions({layoutScroll:!0}),fx.current=s}return fx.current},resetTransform:(s,e)=>{s.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:s=>window.getComputedStyle(s).position==="fixed"}),v3={pan:{Feature:D4},drag:{Feature:L4,ProjectionNode:N2,MeasureLayout:S2}},x3=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function w3(s){const e=x3.exec(s);if(!e)return[,];const[,t,n]=e;return[t,n]}function $w(s,e,t=1){const[n,r]=w3(s);if(!n)return;const i=window.getComputedStyle(e).getPropertyValue(n);if(i){const a=i.trim();return d2(a)?parseFloat(a):a}else return Cw(r)?$w(r,e,t+1):r}function b3(s,{...e},t){const n=s.current;if(!(n instanceof Element))return{target:e,transitionEnd:t};t&&(t={...t}),s.values.forEach(r=>{const i=r.get();if(!Cw(i))return;const a=$w(i,n);a&&r.set(a)});for(const r in e){const i=e[r];if(!Cw(i))continue;const a=$w(i,n);a&&(e[r]=a,t||(t={}),t[r]===void 0&&(t[r]=i))}return{target:e,transitionEnd:t}}const S3=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),j2=s=>S3.has(s),_3=s=>Object.keys(s).some(j2),CA=s=>s===Jc||s===Te,NA=(s,e)=>parseFloat(s.split(", ")[e]),jA=(s,e)=>(t,{transform:n})=>{if(n==="none"||!n)return 0;const r=n.match(/^matrix3d\((.+)\)$/);if(r)return NA(r[1],e);{const i=n.match(/^matrix\((.+)\)$/);return i?NA(i[1],s):0}},E3=new Set(["x","y","z"]),A3=$m.filter(s=>!E3.has(s));function k3(s){const e=[];return A3.forEach(t=>{const n=s.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e.length&&s.render(),e}const oh={width:({x:s},{paddingLeft:e="0",paddingRight:t="0"})=>s.max-s.min-parseFloat(e)-parseFloat(t),height:({y:s},{paddingTop:e="0",paddingBottom:t="0"})=>s.max-s.min-parseFloat(e)-parseFloat(t),top:(s,{top:e})=>parseFloat(e),left:(s,{left:e})=>parseFloat(e),bottom:({y:s},{top:e})=>parseFloat(e)+(s.max-s.min),right:({x:s},{left:e})=>parseFloat(e)+(s.max-s.min),x:jA(4,13),y:jA(5,14)};oh.translateX=oh.x;oh.translateY=oh.y;const T3=(s,e,t)=>{const n=e.measureViewportBox(),r=e.current,i=getComputedStyle(r),{display:a}=i,o={};a==="none"&&e.setStaticValue("display",s.display||"block"),t.forEach(u=>{o[u]=oh[u](n,i)}),e.render();const l=e.measureViewportBox();return t.forEach(u=>{const h=e.getValue(u);h&&h.jump(o[u]),s[u]=oh[u](l,i)}),s},C3=(s,e,t={},n={})=>{e={...e},n={...n};const r=Object.keys(e).filter(j2);let i=[],a=!1;const o=[];if(r.forEach(l=>{const u=s.getValue(l);if(!s.hasValue(l))return;let h=t[l],f=Ch(h);const p=e[l];let m;if(Q0(p)){const g=p.length,y=p[0]===null?1:0;h=p[y],f=Ch(h);for(let b=y;b<g&&p[b]!==null;b++)m?b_(Ch(p[b])===m):m=Ch(p[b])}else m=Ch(p);if(f!==m)if(CA(f)&&CA(m)){const g=u.get();typeof g=="string"&&u.set(parseFloat(g)),typeof p=="string"?e[l]=parseFloat(p):Array.isArray(p)&&m===Te&&(e[l]=p.map(parseFloat))}else f!=null&&f.transform&&(m!=null&&m.transform)&&(h===0||p===0)?h===0?u.set(m.transform(h)):e[l]=f.transform(p):(a||(i=k3(s),a=!0),o.push(l),n[l]=n[l]!==void 0?n[l]:e[l],u.jump(p))}),o.length){const l=o.indexOf("height")>=0?window.pageYOffset:null,u=T3(e,s,o);return i.length&&i.forEach(([h,f])=>{s.getValue(h).set(f)}),s.render(),tv&&l!==null&&window.scrollTo({top:l}),{target:u,transitionEnd:n}}else return{target:e,transitionEnd:n}};function N3(s,e,t,n){return _3(e)?C3(s,e,t,n):{target:e,transitionEnd:n}}const j3=(s,e,t,n)=>{const r=b3(s,e,n);return e=r.target,n=r.transitionEnd,N3(s,e,t,n)},Uw={current:null},P2={current:!1};function P3(){if(P2.current=!0,!!tv)if(window.matchMedia){const s=window.matchMedia("(prefers-reduced-motion)"),e=()=>Uw.current=s.matches;s.addListener(e),e()}else Uw.current=!1}function R3(s,e,t){const{willChange:n}=e;for(const r in e){const i=e[r],a=t[r];if(Tn(i))s.addValue(r,i),sy(n)&&n.add(r);else if(Tn(a))s.addValue(r,ah(i,{owner:s})),sy(n)&&n.remove(r);else if(a!==i)if(s.hasValue(r)){const o=s.getValue(r);!o.hasAnimated&&o.set(i)}else{const o=s.getStaticValue(r);s.addValue(r,ah(o!==void 0?o:i,{owner:s}))}}for(const r in t)e[r]===void 0&&s.removeValue(r);return e}const PA=new WeakMap,R2=Object.keys(qf),L3=R2.length,RA=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],D3=h_.length;class M3{constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,visualState:i},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>yt.render(this.render,!1,!0);const{latestValues:o,renderState:l}=i;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.isControllingVariants=nv(t),this.isVariantNode=gN(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{});for(const f in h){const p=h[f];o[f]!==void 0&&Tn(p)&&(p.set(o[f],!1),sy(u)&&u.add(f))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,PA.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,n)=>this.bindToMotionValue(n,t)),P2.current||P3(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Uw.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){PA.delete(this.current),this.projection&&this.projection.unmount(),La(this.notifyUpdate),La(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const n=Yc.has(e),r=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&yt.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),i=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{r(),i()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...t},n,r,i){let a,o;for(let l=0;l<L3;l++){const u=R2[l],{isEnabled:h,Feature:f,ProjectionNode:p,MeasureLayout:m}=qf[u];p&&(a=p),h(t)&&(!this.features[u]&&f&&(this.features[u]=new f(this)),m&&(o=m))}if((this.type==="html"||this.type==="svg")&&!this.projection&&a){this.projection=new a(this.latestValues,this.parent&&this.parent.projection);const{layoutId:l,layout:u,drag:h,dragConstraints:f,layoutScroll:p,layoutRoot:m}=t;this.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!h||f&&Pu(f),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof u=="string"?u:"both",initialPromotionConfig:i,layoutScroll:p,layoutRoot:m})}return o}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Wt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<RA.length;n++){const r=RA[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i=e["on"+r];i&&(this.propEventSubscriptions[r]=this.on(r,i))}this.prevMotionValues=R3(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const n=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(n.initial=this.props.initial),n}const t={};for(let n=0;n<D3;n++){const r=h_[n],i=this.props[r];(Gf(i)||i===!1)&&(t[r]=i)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ah(t,{owner:this}),this.addValue(e,n)),n}readValue(e){var t;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(t=this.getBaseTargetFromProps(this.props,e))!==null&&t!==void 0?t:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props,r=typeof n=="string"||typeof n=="object"?(t=w_(this.props,n))===null||t===void 0?void 0:t[e]:void 0;if(n&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Tn(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new j_),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class L2 extends M3{sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...n},{transformValues:r},i){let a=QF(n,e||{},this);if(r&&(t&&(t=r(t)),n&&(n=r(n)),a&&(a=r(a))),i){YF(this,n,a);const o=j3(this,n,a,t);t=o.transitionEnd,n=o.target}return{transition:e,transitionEnd:t,...n}}}function I3(s){return window.getComputedStyle(s)}class O3 extends L2{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(Yc.has(t)){const n=A_(t);return n&&n.default||0}else{const n=I3(e),r=(wN(t)?n.getPropertyValue(t):n[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return w2(e,t)}build(e,t,n,r){m_(e,t,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,t){return x_(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Tn(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}renderInstance(e,t,n,r){kN(e,t,n,r)}}class F3 extends L2{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Yc.has(t)){const n=A_(t);return n&&n.default||0}return t=TN.has(t)?t:u_(t),e.getAttribute(t)}measureInstanceViewportBox(){return Wt()}scrapeMotionValuesFromProps(e,t){return NN(e,t)}build(e,t,n,r){y_(e,t,n,this.isSVGTag,r.transformTemplate)}renderInstance(e,t,n,r){CN(e,t,n,r)}mount(e){this.isSVGTag=v_(e.tagName),super.mount(e)}}const $3=(s,e)=>p_(s)?new F3(e,{enableHardwareAcceleration:!1}):new O3(e,{enableHardwareAcceleration:!0}),U3={layout:{ProjectionNode:N2,MeasureLayout:S2}},B3={...f4,...LO,...v3,...U3},Q=HI((s,e)=>wO(s,e,B3,$3));function D2(){const s=_.useRef(!1);return c_(()=>(s.current=!0,()=>{s.current=!1}),[]),s}function H3(){const s=D2(),[e,t]=_.useState(0),n=_.useCallback(()=>{s.current&&t(e+1)},[e]);return[_.useCallback(()=>yt.postRender(n),[n]),e]}class V3 extends _.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function z3({children:s,isPresent:e}){const t=_.useId(),n=_.useRef(null),r=_.useRef({width:0,height:0,top:0,left:0});return _.useInsertionEffect(()=>{const{width:i,height:a,top:o,left:l}=r.current;if(e||!n.current||!i||!a)return;n.current.dataset.motionPopId=t;const u=document.createElement("style");return document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${a}px !important;
            top: ${o}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[e]),_.createElement(V3,{isPresent:e,childRef:n,sizeRef:r},_.cloneElement(s,{ref:n}))}const px=({children:s,initial:e,isPresent:t,onExitComplete:n,custom:r,presenceAffectsLayout:i,mode:a})=>{const o=jN(W3),l=_.useId(),u=_.useMemo(()=>({id:l,initial:e,isPresent:t,custom:r,onExitComplete:h=>{o.set(h,!0);for(const f of o.values())if(!f)return;n&&n()},register:h=>(o.set(h,!1),()=>o.delete(h))}),i?void 0:[t]);return _.useMemo(()=>{o.forEach((h,f)=>o.set(f,!1))},[t]),_.useEffect(()=>{!t&&!o.size&&n&&n()},[t]),a==="popLayout"&&(s=_.createElement(z3,{isPresent:t},s)),_.createElement(ev.Provider,{value:u},s)};function W3(){return new Map}function G3(s){return _.useEffect(()=>()=>s(),[])}const ml=s=>s.key||"";function q3(s,e){s.forEach(t=>{const n=ml(t);e.set(n,t)})}function K3(s){const e=[];return _.Children.forEach(s,t=>{_.isValidElement(t)&&e.push(t)}),e}const cn=({children:s,custom:e,initial:t=!0,onExitComplete:n,exitBeforeEnter:r,presenceAffectsLayout:i=!0,mode:a="sync"})=>{const o=_.useContext(f_).forceRender||H3()[0],l=D2(),u=K3(s);let h=u;const f=_.useRef(new Map).current,p=_.useRef(h),m=_.useRef(new Map).current,g=_.useRef(!0);if(c_(()=>{g.current=!1,q3(u,m),p.current=h}),G3(()=>{g.current=!0,m.clear(),f.clear()}),g.current)return _.createElement(_.Fragment,null,h.map(x=>_.createElement(px,{key:ml(x),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:a},x)));h=[...h];const y=p.current.map(ml),b=u.map(ml),v=y.length;for(let x=0;x<v;x++){const w=y[x];b.indexOf(w)===-1&&!f.has(w)&&f.set(w,void 0)}return a==="wait"&&f.size&&(h=[]),f.forEach((x,w)=>{if(b.indexOf(w)!==-1)return;const E=m.get(w);if(!E)return;const T=y.indexOf(w);let C=x;if(!C){const N=()=>{f.delete(w);const j=Array.from(m.keys()).filter(P=>!b.includes(P));if(j.forEach(P=>m.delete(P)),p.current=u.filter(P=>{const M=ml(P);return M===w||j.includes(M)}),!f.size){if(l.current===!1)return;o(),n&&n()}};C=_.createElement(px,{key:ml(E),isPresent:!1,onExitComplete:N,custom:e,presenceAffectsLayout:i,mode:a},E),f.set(w,C)}h.splice(T,0,C)}),h=h.map(x=>{const w=x.key;return f.has(w)?x:_.createElement(px,{key:ml(x),isPresent:!0,presenceAffectsLayout:i,mode:a},x)}),_.createElement(_.Fragment,null,f.size?h:h.map(x=>_.cloneElement(x)))},Di={info:(s,e,t)=>console.log(`[${s}] ${e}`,t||""),warning:(s,e,t)=>console.warn(`[${s}] ${e}`,t||""),error:(s,e,t)=>console.error(`[${s}] ${e}`,t||""),success:(s,e,t)=>console.log(` [${s}] ${e}`,t||""),debug:(s,e,t)=>console.log(` [${s}] ${e}`,t||""),enable:()=>console.log("Debug enabled")},X3=({onLogin:s,loginError:e})=>{const[t,n]=_.useState(!1),[r,i]=_.useState(""),[a,o]=_.useState(""),[l,u]=_.useState(!1),h=_.useRef(null);_.useEffect(()=>{const p=m=>{h.current&&!h.current.contains(m.target)&&n(!1)};return t&&document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[t]);const f=async p=>{if(p.preventDefault(),Di.info("HEADER","Login form submitted",{username:r.trim(),hasPassword:!!a.trim(),onLoginFunction:typeof s}),!r.trim()||!a.trim()){Di.warning("HEADER","Login form validation failed",{usernameEmpty:!r.trim(),passwordEmpty:!a.trim()});return}if(!s||typeof s!="function"){Di.error("HEADER","onLogin function not provided or invalid",{onLogin:s,type:typeof s});return}u(!0),Di.info("HEADER","Calling onLogin function",{username:r.trim()});try{const m=await s(r.trim(),a);Di.success("HEADER","onLogin function completed",{result:m,success:m==null?void 0:m.success})}catch(m){Di.error("HEADER","onLogin function failed",{error:m.message,stack:m.stack})}finally{u(!1),Di.info("HEADER","Login process completed",{loading:!1})}};return c.jsxs("header",{className:"bg-white/95 backdrop-blur-sm shadow-sm border-b border-neutral-200 sticky top-0 z-50",children:[c.jsxs("div",{className:"relative w-full h-32 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(/pics/large.jpg)"},children:[c.jsx("div",{className:"w-full h-full bg-black bg-opacity-10"})," "]}),c.jsxs("div",{className:"absolute top-0 right-0 p-4",children:[!1,c.jsx("div",{className:"relative",ref:h,children:t?c.jsxs(Q.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"absolute right-0 top-0 bg-white rounded-lg shadow-lg border border-neutral-200 p-4 w-80 max-w-[calc(100vw-2rem)] sm:w-80 z-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"text-lg font-semibold text-neutral-800",children:"Login"}),c.jsx("button",{onClick:()=>n(!1),className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("form",{onSubmit:f,className:"space-y-3",children:[e&&c.jsx(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-xs",children:e}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"header-username",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Username"}),c.jsx("input",{type:"text",id:"header-username",value:r,onChange:p=>i(p.target.value),placeholder:"Enter username",className:"w-full px-3 py-2 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent transition-all duration-200",required:!0,disabled:l,autoComplete:"username"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"header-password",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Password"}),c.jsx("input",{type:"password",id:"header-password",value:a,onChange:p=>o(p.target.value),placeholder:"Enter password",className:"w-full px-3 py-2 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent transition-all duration-200",required:!0,disabled:l,autoComplete:"current-password"})]}),c.jsx(Q.button,{type:"submit",disabled:l||!r.trim()||!a.trim(),className:"w-full bg-primary-500 hover:bg-primary-600 disabled:bg-neutral-300 disabled:cursor-not-allowed text-white text-sm font-medium py-2 rounded transition-colors duration-200",whileHover:{scale:1.01},whileTap:{scale:.99},onClick:p=>{Di.info("HEADER","Submit button clicked",{loading:l,username:r.trim(),hasPassword:!!a.trim(),disabled:l||!r.trim()||!a.trim()})},children:l?c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Logging in..."]}):"Login"})]})]}):c.jsxs(Q.button,{onClick:()=>{Di.info("HEADER","Login button clicked",{showLogin:!1}),n(!0)},className:"bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 sm:px-4",whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx("span",{className:"hidden sm:inline",children:"Login"}),c.jsx("span",{className:"sm:hidden",children:""})]})})]})]})},M2=({teachers:s=[],title:e="Meet Our Teachers",subtitle:t="Our experienced and passionate teachers are here to help you achieve your language learning goals",showSelection:n=!1,selectedTeachers:r=[],onSelectionChange:i,displayCount:a=null})=>{const[o,l]=_.useState(0),u=_.useRef(null),[h,f]=_.useState(a),p=Math.max(0,s.length-h),m=()=>{o<p?l(v=>Math.min(v+1,p)):l(0)},g=()=>{o>0?l(v=>Math.max(v-1,0)):l(p)};_.useEffect(()=>{const v=()=>{if(u.current){const w=u.current.offsetWidth,E=n?192:256,T=32,N=w-32,j=Math.floor(N/(E+T));if(a&&a>0){const P=Math.min(a,j,s.length);f(P)}else{const P=Math.max(1,Math.min(j,s.length));f(P)}}};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[s.length,n,a]),_.useEffect(()=>{if(u.current){const v=u.current,E=o*((n?192:256)+32);v.scrollTo({left:E,behavior:"smooth"})}},[o,n]);const y=s.slice(o,o+h),b=v=>{if(!i)return;const x=r.includes(v);let w;x?w=r.filter(E=>E!==v):w=[...r,v],i(w)};return c.jsxs("div",{className:"text-center mb-16",children:[c.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-4",children:e}),c.jsx("p",{className:"text-neutral-600 mb-8 max-w-2xl mx-auto",children:t}),c.jsxs("div",{className:"relative w-full px-4 md:px-8 lg:px-16 xl:px-24",children:[s.length>h&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:g,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full bg-white shadow-lg border border-gray-200 flex items-center justify-center transition-all duration-200 hover:bg-gray-50 hover:shadow-xl",title:"Previous teachers",children:c.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx("button",{onClick:m,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full bg-white shadow-lg border border-gray-200 flex items-center justify-center transition-all duration-200 hover:bg-gray-50 hover:shadow-xl",title:"Next teachers",children:c.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),c.jsx("div",{ref:u,className:`flex gap-8 transition-all duration-500 ease-in-out overflow-x-auto overflow-y-hidden pb-4 scrollbar-hide ${n?"justify-start":"justify-center"}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:y.map((v,x)=>{const w=n&&r.includes(v.id);return c.jsxs(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:x*.1},className:`bg-transparent rounded-lg p-4 hover:shadow-xl transition-all duration-300 flex-shrink-0 ${n?`cursor-pointer w-48 ${w?"ring-2 ring-primary-500 ring-offset-2":""}`:"clickable w-64"}`,onClick:n?()=>b(v.id):void 0,children:[c.jsx("div",{className:`mx-auto mb-4 rounded-full overflow-hidden shadow-lg ${n?"w-32 h-32":"w-40 h-40"}`,style:{background:"linear-gradient(135deg, #fefce8 0%, #faf5ff 100%)"},children:c.jsx("img",{src:v.photo_url||"/pics/teachers/default.jpg",alt:v.name,className:"w-full h-full object-cover",onError:E=>{E.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDgiIGN5PSI0OCIgcj0iNDgiIGZpbGw9IiNGM0Y0RjYiLz4KPHBhdGggZD0iTTQ4IDI0QzM5LjE2NDkgMjQgMzIgMzEuMTY0OSAzMiA0MEMzMiA0OC44MzUxIDM5LjE2NDkgNTYgNDggNTZDNTYuODM1MSA1NiA2NCA0OC44MzUxIDY0IDQwQzY0IDMxLjE2NDkgNTYuODM1MSAyNCA0OCAyNFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHBhdGggZD0iTTQ4IDY0QzM5LjE2NDkgNjQgMzIgNzEuMTY0OSAzMiA4MEMzMiA4OC44MzUxIDM5LjE2NDkgOTYgNDggOTZDNTYuODM1MSA5NiA2NCA4OC44MzUxIDY0IDgwQzY0IDcxLjE2NDkgNTYuODM1MSA2NCA0OCA2NFoiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+"}})}),c.jsx("h3",{className:`font-semibold text-neutral-800 mb-2 text-center ${n?"text-lg":"text-xl"}`,children:v.name}),n?c.jsx("div",{className:"flex justify-center",children:c.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${w?"bg-primary-500 border-primary-500":"border-gray-300 hover:border-primary-400"}`,children:w&&c.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}):c.jsx("p",{className:"text-neutral-600 text-sm leading-relaxed",children:v.description})]},v.id)})}),s.length>h&&c.jsx("div",{className:"flex justify-center mt-6 space-x-2",children:Array.from({length:p+1},(v,x)=>c.jsx("button",{onClick:()=>l(x),className:`w-3 h-3 rounded-full transition-all duration-200 ${x===o?"bg-primary-500":"bg-gray-300 hover:bg-gray-400"}`,title:`View teachers ${x+1}-${Math.min(x+h,s.length)}`},x))}),n&&c.jsx("div",{className:"mt-6 text-center",children:c.jsxs("p",{className:"text-sm text-gray-600",children:[r.length," of ",s.length," teachers selected"]})})]})]})},Y3=({mission:s})=>{const e=s;return c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},className:"bg-white rounded-2xl shadow-xl overflow-hidden max-w-4xl mx-auto",children:c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"h-64 bg-gradient-to-r from-primary-500 to-secondary-500 flex items-center justify-center relative",style:{backgroundImage:e.banner_image?`url(${e.banner_image})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[c.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40"}),c.jsxs("div",{className:"text-center text-white relative z-10",children:[c.jsx("h2",{className:"text-4xl font-bold mb-4",children:e.title}),c.jsx("div",{className:"w-16 h-1 bg-white mx-auto rounded-full"})]})]}),c.jsx("div",{className:"p-8 md:p-12",children:c.jsx("div",{className:"max-w-3xl mx-auto text-center",children:c.jsx("p",{className:"text-lg text-neutral-600 leading-relaxed",children:e.content})})})]})})},J3=({courses:s=[],title:e="Our Courses",subtitle:t="Choose from our wide range of language courses designed to meet your learning goals"})=>{const[n,r]=_.useState(0),[i,a]=_.useState(!1),o=()=>{r(h=>(h+1)%s.length)},l=()=>{r(h=>(h-1+s.length)%s.length)};if(!s||s.length===0)return c.jsxs("div",{className:"text-center py-12",children:[c.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-4",children:e}),c.jsx("p",{className:"text-neutral-600",children:"No courses available at the moment."})]});const u=s[n];return c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-4",children:e}),c.jsx("p",{className:"text-neutral-600 mb-8 max-w-2xl mx-auto",children:t}),c.jsxs("div",{className:"max-w-4xl mx-auto",children:[c.jsxs(Q.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.5},className:"relative bg-white rounded-2xl shadow-xl overflow-hidden cursor-pointer",onClick:()=>a(!0),children:[c.jsxs("div",{className:"h-80 bg-gradient-to-r from-primary-500 to-secondary-500 relative",style:{backgroundImage:u.background_image?`url(${u.background_image})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[c.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("h3",{className:"text-4xl font-bold mb-4",children:u.name}),c.jsx("p",{className:"text-xl max-w-2xl mx-auto px-4",children:u.description})]})})]}),c.jsx("button",{onClick:h=>{h.stopPropagation(),l()},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-full transition-all duration-200 clickable",title:"Previous course",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx("button",{onClick:h=>{h.stopPropagation(),o()},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-full transition-all duration-200 clickable",title:"Next course",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),c.jsxs("div",{className:"absolute bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm",children:[n+1," / ",s.length]})]},n),s.length>1&&c.jsx("div",{className:"flex justify-center mt-6 space-x-2",children:s.map((h,f)=>c.jsx("button",{onClick:()=>r(f),className:`w-3 h-3 rounded-full transition-all duration-200 ${f===n?"bg-primary-500":"bg-gray-300 hover:bg-gray-400"}`,title:`View course ${f+1}: ${s[f].name}`},f))}),c.jsx(cn,{children:i&&c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>a(!1),children:c.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto",onClick:h=>h.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-start mb-6",children:[c.jsx("h3",{className:"text-3xl font-bold text-neutral-800",children:u.name}),c.jsx("button",{onClick:()=>a(!1),className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("p",{className:"text-lg text-neutral-600",children:u.description}),c.jsx("p",{className:"text-neutral-700 leading-relaxed",children:u.detailed_description})]}),c.jsx("div",{className:"mt-8 flex justify-end",children:c.jsx("button",{onClick:()=>a(!1),className:"btn-primary",children:"Close"})})]})})})]})]})},ru={title:"Welcome to RioTalk",subtitle:"Master English Language with our experienced teachers and innovative teaching methods",teacherShowcaseTitle:"Meet Our Teachers",teacherShowcaseSubtitle:"Our experienced and passionate teachers are here to help you achieve your language learning goals",coursesTitle:"Our Courses",coursesSubtitle:"Choose from our wide range of language courses designed to meet your learning goals"},ni={info:(s,e,t)=>console.log(`[${s}] ${e}`,t||""),warning:(s,e,t)=>console.warn(`[${s}] ${e}`,t||""),error:(s,e,t)=>console.error(`[${s}] ${e}`,t||""),success:(s,e,t)=>console.log(` [${s}] ${e}`,t||""),debug:(s,e,t)=>console.log(` [${s}] ${e}`,t||""),enable:()=>console.log("Debug enabled")},Q3=()=>{const{login:s,user:e}=Fm(),t=oN(),[n,r]=_.useState(""),[i,a]=_.useState([]),[o,l]=_.useState(null),[u,h]=_.useState([]),[f,p]=_.useState(!0);_.useEffect(()=>{m()},[]);const m=async()=>{try{p(!0);const y=await se.getShowcaseSettingsPublic(),b=y.success?y.settings.display_count:3,[v,x,w]=await Promise.all([se.getRandomTeachers(b),se.getMissionContent(),se.getCourses()]);v.success?a(v.teachers):a([{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience. Specializes in business English and conversation practice.",photo_url:"/pics/teachers/sarah.jpg"},{id:2,name:"Michael Chen",description:"Native Mandarin speaker teaching Chinese language and culture. Patient and encouraging teaching style.",photo_url:"/pics/teachers/michael.jpg"},{id:3,name:"Elena Rodriguez",description:"Spanish teacher from Madrid with expertise in grammar and pronunciation. Loves teaching through music and culture.",photo_url:"/pics/teachers/elena.jpg"}]),x.success?l(x.mission):l({title:"Our Mission",content:"At Rio talk, we believe that language learning should be engaging, practical, and accessible to everyone. Our mission is to break down language barriers and connect people across cultures through innovative teaching methods, experienced instructors, and a supportive learning environment.",banner_image:"/pics/banners/mission-banner.jpg"}),w.success?h(w.courses):h([{id:1,name:"English for Beginners",description:"Start your English learning journey with our comprehensive beginner course.",background_image:"/pics/courses/english-beginner.jpg",detailed_description:"Our English for Beginners course is designed to take you from zero to conversational level in just 6 months."},{id:2,name:"Business English Mastery",description:"Advanced business communication skills for professionals.",background_image:"/pics/courses/business-english.jpg",detailed_description:"Master the art of professional communication with our Business English course."},{id:3,name:"Spanish Conversation Club",description:"Improve your speaking skills through interactive conversations.",background_image:"/pics/courses/spanish-conversation.jpg",detailed_description:"Join our dynamic Spanish Conversation Club for engaging discussions."}])}catch(y){console.error("Error fetching data:",y),a([{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience.",photo_url:"/pics/teachers/sarah.jpg"}]),l({title:"Our Mission",content:"At Rio talk, we believe that language learning should be engaging, practical, and accessible to everyone.",banner_image:"/pics/banners/mission-banner.jpg"}),h([{id:1,name:"English for Beginners",description:"Start your English learning journey.",background_image:"/pics/courses/english-beginner.jpg",detailed_description:"Learn English from zero to conversational level."}])}finally{p(!1)}};_.useEffect(()=>{e&&(ni.info("LOGIN_PAGE","User logged in, navigating to dashboard",{role:e.role,userId:e.id}),e.role==="admin"?(ni.success("LOGIN_PAGE","Navigating to admin dashboard"),t("/admin")):e.role==="teacher"&&(ni.success("LOGIN_PAGE","Navigating to teacher dashboard"),t("/teacher")))},[e,t]);const g=async(y,b)=>{if(ni.info("LOGIN_PAGE","handleLogin called",{username:y,hasPassword:!!b,loginFunction:typeof s}),r(""),!s||typeof s!="function"){ni.error("LOGIN_PAGE","Login function not available from useAuth",{login:s,type:typeof s}),r("Login function not available");return}try{ni.info("LOGIN_PAGE","Calling login function from AuthContext",{username:y});const v=await s(y,b);ni.info("LOGIN_PAGE","Login result received",{result:v,success:v==null?void 0:v.success,error:v==null?void 0:v.error}),v.success?ni.success("LOGIN_PAGE","Login successful, waiting for user state update",{username:y,result:v}):(ni.warning("LOGIN_PAGE","Login failed",{error:v.error,username:y}),r(v.error))}catch(v){ni.error("LOGIN_PAGE","Login function threw error",{error:v.message,stack:v.stack,username:y}),r(v.message||"Login failed")}};return f?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50 flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50",children:[c.jsx(X3,{onLogin:g,loginError:n}),c.jsxs("div",{className:"w-full px-4 py-8",children:[c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-12 mx-auto",children:[c.jsx("h1",{className:"text-5xl font-bold text-neutral-800 mb-4",children:ru.title}),c.jsx("p",{className:"text-xl text-neutral-600 max-w-2xl mx-auto",children:ru.subtitle})]}),c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-16 mx-auto",children:c.jsx(M2,{teachers:i,title:ru.teacherShowcaseTitle,subtitle:ru.teacherShowcaseSubtitle})}),o&&c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"mb-16 mx-auto",children:c.jsx(Y3,{mission:o})}),u.length>0&&c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},className:"mx-auto",children:c.jsx(J3,{courses:u,title:ru.coursesTitle,subtitle:ru.coursesSubtitle})})]})]})},Z3=()=>{const[s,e]=_.useState([]),[t,n]=_.useState({}),[r,i]=_.useState({}),[a,o]=_.useState(new Set),[l,u]=_.useState(!0),[h,f]=_.useState(!1),[p,m]=_.useState(""),[g,y]=_.useState(new Date),[b,v]=_.useState(null),[x,w]=_.useState([]),[E,T]=_.useState(!1),[C,N]=_.useState({});_.useEffect(()=>{(async()=>{try{u(!0),m("");const O=await se.getTeachers();if(O.success)console.log(" [TEACHERS_TABLE] Teachers data:",O.teachers.map(X=>({id:X.id,name:X.name,student_count:X.student_count}))),O.teachers.forEach(X=>{console.log(` [TEACHER] ${X.name} (ID: ${X.id}): ${X.student_count||0} students`)}),e(O.teachers||[]);else throw new Error(O.error||"Failed to load teachers")}catch(O){console.error("Error fetching teachers:",O),m(`Failed to load teachers: ${O.message}`),e([])}finally{u(!1)}})()},[]);const j=async I=>{if(!r[I])try{const O=await se.getTeacherStudents(I);O.success&&i(X=>({...X,[I]:O.students||[]}))}catch(O){console.error(`Error fetching students for teacher ${I}:`,O)}},P=async I=>{const O=new Set;a.has(I)||(O.add(I),await j(I)),o(O)},M=I=>I?new Date(I).toLocaleDateString():"",V=I=>{const O=I.getFullYear(),X=I.getMonth(),$=new Date(O,X,1),H=new Date(O,X+1,0),D=[];let F=new Date($),q=1;const J=$.getDay(),ee=J===0?-6:1-J;for(F.setDate($.getDate()+ee);F<=H;){const de=new Date(F);de.setDate(F.getDate()+6),de>=$&&F<=H&&D.push({weekNumber:q,start:F.getFullYear()+"-"+String(F.getMonth()+1).padStart(2,"0")+"-"+String(F.getDate()).padStart(2,"0"),end:de.getFullYear()+"-"+String(de.getMonth()+1).padStart(2,"0")+"-"+String(de.getDate()).padStart(2,"0"),label:`${F.getDate()}-${de.getDate()} ${I.toLocaleString("default",{month:"short"})}`}),F.setDate(F.getDate()+7),q++}return D},L=I=>{if(b){const $=C[I];if(!$)return console.log(` [GET_LESSON_COUNT] No monthly stats for teacher ${I}`),0;const H=b.start;console.log(` [GET_LESSON_COUNT] Looking for week ${H} in teacher ${I} stats:`,$);for(const[D,F]of Object.entries($)){const q=new Date(D),J=q.getFullYear()+"-"+String(q.getMonth()+1).padStart(2,"0")+"-"+String(q.getDate()).padStart(2,"0");if(J===H)return console.log(` [GET_LESSON_COUNT] Found matching week ${D} (${J}):`,F),F.total_lessons||0}return console.log(` [GET_LESSON_COUNT] No matching week found for ${H}`),0}const O=C[I];if(!O)return 0;let X=0;return Object.values(O).forEach($=>{X+=$.total_lessons||0}),X};return _.useEffect(()=>{const I=V(g);w(I),v(null),(async()=>{try{f(!0);const X=g.getMonth()+1,$=g.getFullYear();console.log(" [TEACHERS_TABLE] Fetching monthly stats for:",$,X);const H=await se.getMonthlyLessonStats(X,$);if(H.success){const D={};H.monthlyStats.forEach(F=>{const q=F.teacher_id,J=F.week_start_date;D[q]||(D[q]={}),D[q][J]={completed_lessons:Number(F.completed_lessons),absent_lessons:Number(F.absent_lessons),total_lessons:Number(F.completed_lessons)+Number(F.absent_lessons)}}),N(D),console.log(" [TEACHERS_TABLE] Monthly stats loaded:",D)}}catch(X){console.error("Error fetching monthly stats:",X)}finally{f(!1)}})()},[g]),l?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"})}):p?c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-4",children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-error text-sm mb-4",children:p}),c.jsx("button",{onClick:()=>window.location.reload(),className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Retry"})]})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-4 sm:p-6",children:[c.jsxs("div",{className:"mb-4 sm:mb-6",children:[c.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-neutral-800 mb-4",children:"Teachers Overview"}),c.jsxs("div",{className:"flex items-center justify-start space-x-2 sm:space-x-4",children:[c.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[c.jsx("button",{onClick:()=>y(I=>new Date(I.getFullYear(),I.getMonth()-1)),className:"px-2 py-1 sm:px-3 sm:py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors text-sm sm:text-base",children:""}),c.jsx("h3",{className:"text-sm sm:text-lg font-semibold text-gray-800",children:g.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),c.jsx("button",{onClick:()=>y(I=>new Date(I.getFullYear(),I.getMonth()+1)),className:"px-2 py-1 sm:px-3 sm:py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors text-sm sm:text-base",children:""})]}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>T(!E),className:"px-2 py-1 sm:px-3 sm:py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-xs sm:text-sm",children:b?b.label:"All Weeks"}),E&&c.jsxs("div",{className:"absolute mt-1 bg-white border rounded shadow-lg z-10 min-w-64 right-0",children:[c.jsx("button",{onClick:()=>{v(null),T(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:"All Weeks"}),x.map((I,O)=>c.jsxs("button",{onClick:()=>{console.log(" [WEEK_SELECT] Selected week:",I),v(I),T(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:["Week ",I.weekNumber,": ",new Date(I.start).toLocaleDateString()," - ",new Date(I.end).toLocaleDateString()]},O))]})]})]}),b&&c.jsxs("p",{className:"text-xs sm:text-base text-neutral-600 mt-2",children:["Showing lessons for week: ",b.label,h&&c.jsx("span",{className:"ml-2 text-primary-600",children:"(Filtering...)"})]})]}),c.jsx("div",{className:"w-full",children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"w-full min-w-[320px]",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"border-b border-neutral-200",children:[c.jsx("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/3 sm:w-auto",children:"Teacher"}),c.jsxs("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/6 sm:w-1/4",children:[c.jsx("span",{className:"sm:hidden",children:"s"}),c.jsx("span",{className:"hidden sm:inline",children:"Students"})]}),c.jsxs("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/6 sm:w-1/6",children:[c.jsx("span",{className:"sm:hidden",children:"l"}),c.jsx("span",{className:"hidden sm:inline",children:"Lessons"})]}),c.jsx("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/3 sm:w-auto",children:"Actions"})]})}),c.jsx("tbody",{children:s.map(I=>{t[I.id];const O=a.has(I.id);return r[I.id],c.jsxs(Q.tr,{className:"border-b border-neutral-100 hover:bg-neutral-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:[c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-neutral-800 truncate",children:I.name})}),c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-neutral-600",children:I.student_count||0})}),c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-neutral-600",children:L(I.id)})}),c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsxs("button",{onClick:()=>P(I.id),className:"inline-flex items-center px-1.5 py-1 sm:px-2 sm:py-1.5 border border-neutral-300 rounded text-xs sm:text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 focus:outline-none focus:ring-1 focus:ring-primary-500 w-auto justify-center sm:justify-start",children:[c.jsx("span",{className:"hidden sm:inline",children:O?"Hide Students":"Show Students"}),c.jsx("span",{className:"sm:hidden",children:O?"Hide":"Show"}),c.jsx(Q.svg,{className:"ml-0.5 sm:ml-1 w-2.5 h-2.5 sm:w-3 sm:h-3",animate:{rotate:O?180:0},transition:{duration:.2},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]},I.id)})})]})})}),c.jsx(cn,{children:s.map(I=>{const O=a.has(I.id),X=r[I.id]||[];return O?c.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t border-neutral-200 bg-neutral-50",children:c.jsxs("div",{className:"p-3 sm:p-6",children:[c.jsxs("h4",{className:"text-base sm:text-lg font-semibold text-neutral-800 mb-3 sm:mb-4",children:["Students for ",I.name]}),X.length===0?c.jsxs("div",{className:"text-center py-6 sm:py-8 text-neutral-500",children:[c.jsx("div",{className:"mb-3 sm:mb-4",children:c.jsx("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-sm sm:text-base",children:"No students assigned to this teacher"})]}):c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:X.map($=>c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},className:"bg-white rounded-lg border border-neutral-200 p-3 sm:p-4 hover:shadow-md transition-shadow",children:c.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[c.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-secondary-100 flex items-center justify-center flex-shrink-0",children:c.jsx("span",{className:"text-xs font-semibold text-secondary-700",children:$.name.split(" ").map(H=>H[0]).join("")})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-neutral-800 text-sm sm:text-base truncate",children:$.name}),c.jsxs("div",{className:"text-xs sm:text-sm text-neutral-500",children:[$.lessons_per_week," lessons/week (auto)"]}),c.jsxs("div",{className:"text-xs text-neutral-400",children:["Added: ",M($.added_date)]})]})]})},$.id))})]})},`students-${I.id}`):null})}),s.length===0&&!l&&c.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-neutral-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-lg font-medium mb-2",children:"No teachers found"}),c.jsx("p",{className:"text-sm text-neutral-400",children:"There are no teachers in the database yet."})]})]})},e$=dN("photos").then(s=>(s.maxBytes=500*1024*1024,console.log(" [PHOTO_CACHE] Initialized photo cache with 500MB limit"),s)).catch(s=>{throw console.error(" [PHOTO_CACHE] Failed to initialize photo cache:",s),s}),LA="photo_metadata";class t${constructor(){this.cache=null,this.metadata=new Map}async init(){this.cache=await e$,await this.loadMetadata()}async loadMetadata(){try{const e=await this.cache.get(LA);e&&(this.metadata=new Map(e),console.log(` [PHOTO_CACHE] Loaded metadata for ${this.metadata.size} photos`))}catch(e){console.warn("Failed to load photo metadata:",e),this.metadata=new Map}}async saveMetadata(){try{await this.cache.set(LA,Array.from(this.metadata.entries()))}catch(e){console.warn("Failed to save photo metadata:",e)}}getPhotoKey(e,t){return`photo:${t||this.extractFileId(e)}`}extractFileId(e){try{const t=e.match(/\/([^\/]+)\.(jpg|jpeg|png|gif|webp|svg)$/i);return t?t[1]:e.split("/").pop()}catch{return e.split("/").pop()}}needsFetch(e,t){const n=this.getPhotoKey(e,t),r=this.metadata.get(n);if(!r)return console.log(` [PHOTO_CACHE] Photo not cached: ${n}`),!0;if(r.url!==e)return console.log(` [PHOTO_CACHE] Photo URL changed: ${n}`),!0;const i=Date.now()-7*24*60*60*1e3;return r.cachedAt<i?(console.log(` [PHOTO_CACHE] Photo is old, refreshing: ${n}`),!0):(console.log(` [PHOTO_CACHE] Photo is cached and up-to-date: ${n}`),!1)}async getCachedPhoto(e,t){this.cache||await this.init();const n=this.getPhotoKey(e,t);if(!this.metadata.get(n))return null;try{const i=await this.cache.get(n);if(i)return console.log(` [PHOTO_CACHE] Retrieved cached photo: ${n}`),i}catch(i){console.warn(`Failed to get cached photo ${n}:`,i)}return null}async cachePhoto(e,t,n){this.cache||await this.init();const r=this.getPhotoKey(e,t);try{return await this.cache.set(r,n),this.metadata.set(r,{url:e,fileId:t,cachedAt:Date.now(),size:n.length||0}),await this.saveMetadata(),console.log(` [PHOTO_CACHE] Cached photo: ${r} (${n.length||0} bytes)`),!0}catch(i){return console.error(`Failed to cache photo ${r}:`,i),!1}}async getPhoto(e,t,n=!1){if(this.cache||await this.init(),!n&&!this.needsFetch(e,t)){const r=await this.getCachedPhoto(e,t);if(r)return r}try{console.log(` [PHOTO_CACHE] Fetching photo: ${e}`);const r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch photo: ${r.status}`);const i=await r.arrayBuffer(),a=new Uint8Array(i);return await this.cachePhoto(e,t,a),a}catch(r){console.error(`Failed to fetch photo ${e}:`,r);const i=await this.getCachedPhoto(e,t);if(i)return console.log(` [PHOTO_CACHE] Using cached fallback for: ${e}`),i;throw r}}createBlobUrl(e){if(!e)return null;const t=new Blob([e]);return URL.createObjectURL(t)}revokeBlobUrl(e){e&&URL.revokeObjectURL(e)}async getStats(){return this.cache||await this.init(),{photoCount:this.metadata.size,totalSize:Array.from(this.metadata.values()).reduce((e,t)=>e+(t.size||0),0),oldestPhoto:Math.min(...Array.from(this.metadata.values()).map(e=>e.cachedAt)),newestPhoto:Math.max(...Array.from(this.metadata.values()).map(e=>e.cachedAt))}}}const Mi=new t$;function s$(s,e,t={}){const[n,r]=_.useState(null),[i,a]=_.useState(null),[o,l]=_.useState(!1),[u,h]=_.useState(null),[f,p]=_.useState(!1),m=_.useRef(null),{forceRefresh:g=!1,autoLoad:y=!0,onLoad:b=null,onError:v=null}=t;_.useEffect(()=>()=>{m.current&&Mi.revokeBlobUrl(m.current)},[s]);const x=async()=>{if(s){l(!0),h(null);try{const T=Mi.needsFetch(s,e);p(!T);const C=await Mi.getPhoto(s,e,g);if(C){r(C);const N=Mi.createBlobUrl(C);m.current&&Mi.revokeBlobUrl(m.current),m.current=N,a(N),b&&b(C,N)}}catch(T){console.error("Failed to load photo:",T),h(T.message),v&&v(T)}finally{l(!1)}}};return _.useEffect(()=>{y&&s&&x()},[s,e,g,y]),{photoData:n,blobUrl:i,loading:o,error:u,isCached:f,refresh:()=>{x()},clearCache:async()=>{if(s&&e){const T=Mi.getPhotoKey(s,e);await Mi.cache.remove(T),Mi.metadata.delete(T),await Mi.saveMetadata(),p(!1)}},loadPhoto:x}}const n$=({src:s,fileId:e,alt:t="",className:n="",style:r={},fallback:i=null,onLoad:a=null,onError:o=null,...l})=>{const[u,h]=_.useState(!1),{blobUrl:f,loading:p,error:m}=s$(s,e,{forceRefresh:!1,onLoad:(y,b)=>{h(!1),a&&a(y,b)},onError:y=>{h(!0),o&&o(y)}});return f&&!p&&!m?c.jsx("img",{src:f,alt:t,className:n,style:r,...l}):i||c.jsx("div",{className:`flex items-center justify-center bg-gray-100 ${n}`,style:r,children:c.jsx("div",{className:"flex flex-col items-center space-y-2 text-center",children:c.jsx("div",{className:"w-8 h-8 text-gray-400",children:c.jsx("svg",{className:"w-full h-full",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})})})})},r$=({selectedTeacher:s,onTeacherSelect:e,onTeachersLoaded:t})=>{const[n,r]=_.useState([]),[i,a]=_.useState(!0),[o,l]=_.useState(""),[u,h]=_.useState("management"),[f,p]=_.useState(!1),m=()=>{const g=document.getElementById("teachers-scroll-container");if(g){const y=g.scrollWidth>g.clientWidth;p(y)}};return _.useEffect(()=>{(async()=>{try{a(!0),l(""),console.log(" [TEACHER_TABS] Fetching teachers...");const y=new Promise((v,x)=>setTimeout(()=>x(new Error("Request timeout")),1e4)),b=await Promise.race([se.getTeachers(),y]);if(console.log(" [TEACHER_TABS] Teachers response:",b),console.log(" [TEACHER_TABS] Response type:",typeof b),console.log(" [TEACHER_TABS] Response success:",b.success),console.log(" [TEACHER_TABS] Response teachers:",b.teachers),b.success){const v=b.teachers||[];r(v),console.log(" [TEACHER_TABS] Teachers loaded successfully:",v.length),t&&t(v),v.length===0&&console.log(" [TEACHER_TABS] No teachers found in database")}else throw new Error(b.error||"Failed to load teachers")}catch(y){console.error(" [TEACHER_TABS] Error fetching teachers:",y),y.message.includes("Backend server not available")||y.message.includes("fetch")||y.message.includes("NetworkError")||y.message.includes("Failed to fetch")?l("Backend server is not available. Please check if the development server is running and environment variables are configured."):y.message.includes("Request timeout")?l("Request timed out. The server may be slow or unresponsive."):l(`Failed to load teachers: ${y.message}`),r([])}finally{a(!1)}})()},[]),_.useEffect(()=>{if(n.length>0){const g=setTimeout(m,100);return()=>clearTimeout(g)}},[n]),_.useEffect(()=>{const g=()=>{m()};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),c.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200",children:[c.jsx("style",{jsx:!0,children:`
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-top {
          scrollbar-width: thin;
          scrollbar-color: #d1d5db transparent;
        }
        .scrollbar-top::-webkit-scrollbar {
          height: 6px;
          display: block;
        }
        .scrollbar-top::-webkit-scrollbar-track {
          background: transparent;
        }
        .scrollbar-top::-webkit-scrollbar-thumb {
          background-color: #d1d5db;
          border-radius: 3px;
        }
        .scrollbar-top::-webkit-scrollbar-thumb:hover {
          background-color: #9ca3af;
        }
      `}),c.jsx("div",{className:"border-b border-neutral-200",children:c.jsxs("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:[c.jsx("button",{onClick:()=>h("management"),className:`py-4 px-1 border-b-2 font-medium text-sm ${u==="management"?"border-primary-500 text-primary-600":"border-transparent text-neutral-500 hover:text-neutral-700 hover:border-neutral-300"}`,children:"Teacher Management"}),c.jsx("button",{onClick:()=>h("overview"),className:`py-4 px-1 border-b-2 font-medium text-sm ${u==="overview"?"border-primary-500 text-primary-600":"border-transparent text-neutral-500 hover:text-neutral-700 hover:border-neutral-300"}`,children:"Lesson Overview"})]})}),c.jsxs("div",{className:"p-6",children:[u==="management"&&c.jsx("div",{children:i?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"})}):o?c.jsx("div",{children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-error text-sm mb-4 max-w-md mx-auto",children:o}),c.jsxs("div",{className:"text-xs text-neutral-500 mb-4 max-w-md mx-auto",children:[c.jsx("strong",{children:"Development Setup:"}),c.jsx("br",{}),"1. Create a ",c.jsx("code",{children:".env"})," file with required environment variables",c.jsx("br",{}),"2. Run ",c.jsx("code",{children:"npm run netlify:dev"})," to start the backend server",c.jsx("br",{}),"3. Ensure database connection is configured"]}),c.jsxs("div",{className:"flex gap-2 justify-center",children:[c.jsx("button",{onClick:()=>window.location.reload(),className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Retry"}),c.jsx("button",{onClick:()=>{l(""),a(!0),window.location.reload()},className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Refresh"})]})]})}):c.jsxs("div",{children:[c.jsxs("div",{className:"relative flex items-center",children:[c.jsx("button",{onClick:()=>{const g=document.getElementById("teachers-scroll-container");g&&g.scrollBy({left:-150,behavior:"smooth"})},className:"lg:hidden p-1.5 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors mr-2 flex-shrink-0",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx("div",{id:"teachers-scroll-container",className:`flex space-x-1 sm:space-x-2 overflow-x-auto pb-2 flex-1 ${f?"scrollbar-top":"scrollbar-hide"}`,style:{scrollbarWidth:f?"thin":"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:n.map((g,y)=>c.jsx(Q.button,{onClick:()=>e(g),className:`flex-shrink-0 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 min-w-[120px] sm:min-w-0 ${(s==null?void 0:s.id)===g.id?"bg-primary-500 text-white shadow-md":"bg-neutral-100 text-neutral-700 hover:bg-primary-100 hover:text-primary-700"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:y*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:c.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[c.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-neutral-200 flex items-center justify-center overflow-hidden",children:g.photo_url?c.jsx(n$,{src:g.photo_url,fileId:`teacher-${g.id}`,alt:g.name,className:"w-full h-full object-cover",fallback:c.jsx("span",{className:"text-xs font-semibold text-neutral-600",children:g.name.split(" ").map(b=>b[0]).join("")})}):c.jsx("span",{className:"text-xs font-semibold text-neutral-600",children:g.name.split(" ").map(b=>b[0]).join("")})}),c.jsx("span",{className:"whitespace-nowrap text-xs sm:text-sm",children:g.name}),g.student_count>0&&c.jsx("span",{className:"bg-primary-100 text-primary-700 text-xs px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full",children:g.student_count})]})},g.id))}),c.jsx("button",{onClick:()=>{const g=document.getElementById("teachers-scroll-container");g&&g.scrollBy({left:150,behavior:"smooth"})},className:"lg:hidden p-1.5 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors ml-2 flex-shrink-0",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),n.length===0&&!i&&c.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-neutral-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-lg font-medium mb-2",children:"No teachers found"}),c.jsx("p",{className:"text-sm text-neutral-400 mb-4",children:"There are no teachers in the database yet."}),c.jsx("button",{onClick:()=>window.location.reload(),className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Refresh"})]})]})}),u==="overview"&&c.jsx("div",{children:c.jsx(Z3,{})})]})]})},I2=(s,e="short")=>{if(!s)return"";const t=new Date(s);if(isNaN(t.getTime()))return"";const n={short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric"},time:{hour:"2-digit",minute:"2-digit"},datetime:{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}};return t.toLocaleDateString("en-US",n[e]||n.short)},$c=()=>{const s=new Date,e=s.getFullYear(),t=s.getMonth(),n=s.getDate(),r=new Date(e,t,n),i=r.getDay(),a=`${e}-${String(t+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`;console.log(" [getCurrentWeekStart] Today:",a),console.log(" [getCurrentWeekStart] Day of week:",i);const o=i===0?6:i-1;console.log(" [getCurrentWeekStart] Days to Monday:",o);const l=new Date(r);l.setDate(r.getDate()-o);const u=l.getFullYear(),h=l.getMonth(),f=l.getDate(),p=`${u}-${String(h+1).padStart(2,"0")}-${String(f).padStart(2,"0")}`;return console.log(" [getCurrentWeekStart] Calculated Monday:",p),p},DA=s=>{const e=new Date(s),t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=new Date(t,n,r),a=i.getDay(),o=a===0?6:a-1,l=new Date(i);l.setDate(i.getDate()-o);const u=l.getFullYear(),h=l.getMonth(),f=l.getDate();return`${u}-${String(h+1).padStart(2,"0")}-${String(f).padStart(2,"0")}`},P_=s=>{const e=new Date(s),t=[];for(let n=0;n<7;n++){const r=new Date(e);r.setDate(e.getDate()+n),t.push(r)}return t},O2=(s,e)=>{const t=new Date(s);return t.setDate(t.getDate()+e),t.toISOString().split("T")[0]},F2=(s,e)=>{const t=new Date(s);return t.setDate(t.getDate()-e),t.toISOString().split("T")[0]},$2=()=>{const s=new Date;return{year:s.getFullYear(),month:s.getMonth()+1,name:s.toLocaleDateString("en-US",{month:"long"})}},i$=(s,e,t)=>{const n=new Date(s),r=n.getMonth()+1,i=n.getFullYear();if(r!==e||i!==t)return null;const o=new Date(t,e-1,1).getDay(),l=n.getDate();return Math.ceil((l+o)/7)},ov=(s,e,t)=>{const n=P_(s);if(!n.some(l=>l.getMonth()+1===e&&l.getFullYear()===t))return{weekNumber:null,isCurrentMonth:!1,days:n.map(l=>({date:l,isCurrentMonth:!1,isEditable:!0}))};const i=n.find(l=>l.getMonth()+1===e&&l.getFullYear()===t),a=i$(i,e,t),o=n.map(l=>{const u=l.getMonth()+1===e&&l.getFullYear()===t;return{date:l,isCurrentMonth:u,isEditable:!0}});return{weekNumber:a,isCurrentMonth:!0,days:o}},a$=(s,e)=>{const t=$c();return ov(t,s,e)},U2=(s,e,t)=>{const n=ov(s,e,t);if(!n.isCurrentMonth)return{weekNumber:null,weekLabel:"Other Month",isCurrentWeek:!1};a$(e,t);const r=s===$c();return{weekNumber:n.weekNumber,weekLabel:`Week ${n.weekNumber}`,isCurrentWeek:r}},mx="schedule_draft_changes",ks={getDraftChanges(){try{const s=localStorage.getItem(mx);return s?JSON.parse(s):null}catch(s){return console.error("Error loading draft changes:",s),null}},saveDraftChanges(s){try{const e={...s,hasUnsavedChanges:!0,lastModified:new Date().toISOString()};return localStorage.setItem(mx,JSON.stringify(e)),!0}catch(e){return console.error("Error saving draft changes:",e),!1}},clearDraftChanges(){try{return localStorage.removeItem(mx),!0}catch(s){return console.error("Error clearing draft changes:",s),!1}},hasUnsavedChanges(){const s=this.getDraftChanges();return s&&s.hasUnsavedChanges},initializeDraft(s,e){const t={teacherId:s,weekStart:e,additions:[],deletions:[],modifications:[],hasUnsavedChanges:!1,lastModified:new Date().toISOString()};return this.saveDraftChanges(t),t},addLesson(s){const e=this.getDraftChanges()||this.initializeDraft(s.teacherId,s.weekStart),t=e.additions.find(n=>n.dayOfWeek===s.dayOfWeek&&n.timeSlot===s.timeSlot);return t?Object.assign(t,s):e.additions.push({id:`temp_${Date.now()}_${Math.random()}`,...s,type:"addition"}),this.saveDraftChanges(e),e},deleteLesson(s,e){let t=this.getDraftChanges();return t||(t=this.initializeDraft(e.teacherId,e.weekStart)),t.additions=t.additions.filter(n=>n.dayOfWeek!==e.dayOfWeek||n.timeSlot!==e.timeSlot),t.deletions.push({scheduleId:s,...e,type:"deletion"}),this.saveDraftChanges(t),t},getChangesForTeacherWeek(s,e){const t=this.getDraftChanges();return!t||t.teacherId!==s||t.weekStart!==e?null:t},applyDraftToSchedule(s,e,t){const n=this.getChangesForTeacherWeek(e,t);if(!n)return s;let r=[...s];return n.deletions.forEach(i=>{r=r.filter(a=>!(a.day_of_week===i.dayOfWeek&&a.time_slot===i.timeSlot))}),n.additions.forEach(i=>{const a={id:i.id,student_id:i.studentId,student_name:i.studentName,teacher_id:i.teacherId,day_of_week:i.dayOfWeek,time_slot:i.timeSlot,week_start_date:i.weekStart,attendance_status:"scheduled",is_draft:!0};r.push(a)}),r},getChangesSummary(){const s=this.getDraftChanges();return s?{additions:s.additions.length,deletions:s.deletions.length,modifications:s.modifications.length,total:s.additions.length+s.deletions.length+s.modifications.length,lastModified:s.lastModified}:null}},B2=({isOpen:s,onClose:e,onSave:t,onDiscard:n,pendingAction:r,changesSummary:i})=>{if(!s)return null;const a=()=>{t(),e()},o=()=>{n(),e()};return c.jsx(cn,{children:c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 shadow-xl",children:[c.jsxs("div",{className:"flex items-center mb-4",children:[c.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3",children:c.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Unsaved Changes"})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-gray-600 mb-3",children:"You have unsaved changes to the schedule. What would you like to do?"}),i&&c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Pending Changes:"}),c.jsxs("div",{className:"flex space-x-4 text-sm text-gray-600",children:[i.additions>0&&c.jsxs("span",{className:"flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1"}),i.additions," additions"]}),i.deletions>0&&c.jsxs("span",{className:"flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),i.deletions," deletions"]}),i.modifications>0&&c.jsxs("span",{className:"flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-1"}),i.modifications," modifications"]})]})]}),r&&c.jsxs("p",{className:"text-sm text-gray-500",children:[c.jsx("strong",{children:"Next action:"})," ",r]})]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Discard Changes"}),c.jsx("button",{onClick:a,className:"flex-1 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:"Save & Continue"}),c.jsx("button",{onClick:e,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Cancel"})]})]})})})};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o$=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l$=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),MA=s=>{const e=l$(s);return e.charAt(0).toUpperCase()+e.slice(1)},H2=(...s)=>s.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),c$=s=>{for(const e in s)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var u$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d$=_.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:i,iconNode:a,...o},l)=>_.createElement("svg",{ref:l,...u$,width:e,height:e,stroke:s,strokeWidth:n?Number(t)*24/Number(e):t,className:H2("lucide",r),...!i&&!c$(o)&&{"aria-hidden":"true"},...o},[...a.map(([u,h])=>_.createElement(u,h)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lv=(s,e)=>{const t=_.forwardRef(({className:n,...r},i)=>_.createElement(d$,{ref:i,iconNode:e,className:H2(`lucide-${o$(MA(s))}`,`lucide-${s}`,n),...r}));return t.displayName=MA(s),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h$=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],f$=lv("clock",h$);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],m$=lv("user-plus",p$);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],y$=lv("users",g$);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v$=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],x$=lv("x",v$),w$=({isOpen:s,onClose:e,onSelect:t,teacherId:n,teacherName:r})=>{const[i,a]=_.useState([]),[o,l]=_.useState([]),[u,h]=_.useState([]),[f,p]=_.useState(!1),[m,g]=_.useState(""),[y,b]=_.useState(""),[v,x]=_.useState("current");_.useEffect(()=>{s&&n&&w()},[s,n]);const w=async()=>{try{p(!0),g("");const[P,M,V]=await Promise.all([se.getCurrentStudents(n),se.getHistoryStudents(n),se.getStudents({status:"active"})]);P.success&&a(P.students||[]),M.success&&l(M.students||[]),V.success&&h(V.students||[])}catch(P){console.error("Error fetching student suggestions:",P),g("Failed to load student suggestions")}finally{p(!1)}},E=P=>{t(P),e()},T=P=>y?P.filter(M=>M.name.toLowerCase().includes(y.toLowerCase())):P,C=P=>P.lesson_count!==void 0?`${P.lesson_count} lessons`:P.total_lessons!==void 0?`${P.total_lessons} total lessons`:"",N=P=>P.last_lesson_date?new Date(P.last_lesson_date).toLocaleDateString():"",j=(P,M,V,L,I)=>{const O=T(P);return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg ${I} bg-opacity-10`,children:[L,c.jsx("span",{className:"font-medium text-sm",children:V}),c.jsxs("span",{className:"text-xs text-gray-500",children:["(",O.length,")"]})]}),c.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:O.map(X=>c.jsx(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>E(X),className:`p-3 rounded-lg border cursor-pointer transition-all duration-200 hover:shadow-md ${I} border-opacity-30 hover:border-opacity-50`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-gray-900",children:X.name}),c.jsxs("div",{className:"text-sm text-gray-500",children:[C(X),N(X)&&`  Last lesson: ${N(X)}`]})]}),c.jsxs("div",{className:"text-xs text-gray-400",children:[M==="current"&&"Current",M==="history"&&"Previous",M==="all"&&"Available"]})]})},X.id))})]})};return s?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[c.jsxs("div",{children:[c.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Select Student for ",r]}),c.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose from current, previous, or all available students"})]}),c.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:c.jsx(x$,{className:"w-5 h-5 text-gray-500"})})]}),c.jsx("div",{className:"p-6 border-b border-gray-200",children:c.jsx("input",{type:"text",placeholder:"Search students...",value:y,onChange:P=>b(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),c.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"current",label:"Current Students",count:i.length},{id:"history",label:"Previous Students",count:o.length},{id:"all",label:"All Students",count:u.length}].map(P=>c.jsxs("button",{onClick:()=>x(P.id),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors duration-200 ${v===P.id?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[P.label," (",P.count,")"]},P.id))}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:f?c.jsx("div",{className:"flex items-center justify-center py-8",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):m?c.jsxs("div",{className:"text-center py-8",children:[c.jsx("p",{className:"text-red-600",children:m}),c.jsx("button",{onClick:w,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"Retry"})]}):c.jsxs(cn,{mode:"wait",children:[v==="current"&&c.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:j(i,"current","Current Students",c.jsx(y$,{className:"w-4 h-4 text-green-600"}),"border-green-200 bg-green-50")},"current"),v==="history"&&c.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:j(o,"history","Previous Students",c.jsx(f$,{className:"w-4 h-4 text-blue-600"}),"border-blue-200 bg-blue-50")},"history"),v==="all"&&c.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:j(u,"all","All Available Students",c.jsx(m$,{className:"w-4 h-4 text-gray-600"}),"border-gray-200 bg-gray-50")},"all")]})}),c.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:c.jsx("div",{className:"flex justify-end space-x-3",children:c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Cancel"})})})]})}):null},mh=({isVisible:s,onClose:e,title:t,message:n,type:r="success",duration:i=4e3})=>{_.useEffect(()=>{if(s&&i>0){const l=setTimeout(()=>{e()},i);return()=>clearTimeout(l)}},[s,i,e]);const o=(()=>{switch(r){case"success":return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-400",title:"text-green-800",message:"text-green-700",iconSymbol:""};case"error":return{bg:"bg-red-50",border:"border-red-200",icon:"text-red-400",title:"text-red-800",message:"text-red-700",iconSymbol:""};case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",icon:"text-yellow-400",title:"text-yellow-800",message:"text-yellow-700",iconSymbol:""};case"info":return{bg:"bg-blue-50",border:"border-blue-200",icon:"text-blue-400",title:"text-blue-800",message:"text-blue-700",iconSymbol:""};default:return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-400",title:"text-green-800",message:"text-green-700",iconSymbol:""}}})();return c.jsx(cn,{children:s&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none",children:c.jsx(Q.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},transition:{duration:.3,ease:"easeOut"},className:`${o.bg} ${o.border} border rounded-lg shadow-lg p-6 max-w-md mx-4 pointer-events-auto`,children:c.jsxs("div",{className:"flex items-start",children:[c.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full ${o.bg} flex items-center justify-center`,children:c.jsx("span",{className:`text-lg font-bold ${o.icon}`,children:o.iconSymbol})}),c.jsxs("div",{className:"ml-4 flex-1",children:[c.jsx("h3",{className:`text-lg font-semibold ${o.title}`,children:t}),n&&c.jsx("p",{className:`mt-1 text-sm ${o.message}`,children:n})]}),c.jsxs("button",{onClick:e,className:`ml-4 flex-shrink-0 ${o.title} hover:opacity-70 transition-opacity`,children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})})})})},ka=({isOpen:s,onClose:e,title:t,children:n,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:a,onCancel:o,loading:l=!1,loadingText:u="Saving...",confirmButtonColor:h="bg-primary-500 hover:bg-primary-600",disabled:f=!1})=>{if(!s)return null;const p=async()=>{l||f||a&&await a()},m=()=>{l||(o?o():e&&e())};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),!l&&c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"space-y-4",children:n}),c.jsxs("div",{className:"flex space-x-3 mt-6",children:[c.jsx("button",{onClick:m,disabled:l,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i}),c.jsx("button",{onClick:p,disabled:l||f,className:`flex-1 px-4 py-2 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors ${h}`,children:l?c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),u]}):r})]})]})})},b$=({onExtendSchedules:s})=>{const[e,t]=_.useState(!1),[n,r]=_.useState(0),[i,a]=_.useState(!0);_.useEffect(()=>{o()},[]);const o=async()=>{try{a(!0);const h=new Date().toDateString(),f=localStorage.getItem("extensionCheckData");if(f){const{date:m,needsExtension:g,count:y}=JSON.parse(f);if(m===h){console.log(" [EXTENSION_REMINDER] Using cached result from today:",{lastNeedsExtension:g,lastCount:y}),t(g),r(y),a(!1);return}else localStorage.removeItem("extensionCheckData"),console.log(" [EXTENSION_REMINDER] Deleted old check data from:",m)}console.log(" [EXTENSION_REMINDER] Checking reminder for today:",h);const p=await se.checkExtensionReminder();if(p.success){t(p.needsExtension),r(p.count);const m={date:h,needsExtension:p.needsExtension,count:p.count};localStorage.setItem("extensionCheckData",JSON.stringify(m)),console.log(" [EXTENSION_REMINDER] Saved check data to localStorage:",m)}}catch(h){console.error(" [EXTENSION_REMINDER] Error checking extension reminder:",h)}finally{a(!1)}},l=async()=>{await s(),await o()},u=async()=>{localStorage.removeItem("extensionCheckData"),console.log(" [EXTENSION_REMINDER] Cleared cache, forcing fresh check"),await o()};return i?c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:c.jsxs("div",{className:"animate-pulse flex items-center space-x-3",children:[c.jsx("div",{className:"w-4 h-4 bg-blue-300 rounded-full"}),c.jsx("div",{className:"h-4 bg-blue-300 rounded w-1/3"})]})}):e?c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsxs("h3",{className:"font-medium text-yellow-800",children:[" ",n," schedules need extension"]}),c.jsx("p",{className:"text-sm text-yellow-600",children:"Some schedules have 2 weeks or less remaining"})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:l,className:"btn btn-primary text-sm",children:"Extend +1 Week"}),c.jsx("button",{onClick:u,className:"btn btn-secondary text-sm",title:"Force refresh to check updated count",children:""})]})]})}):null},S$=({teacherId:s,weekStart:e,onWeekChange:t})=>{console.log(" [ScheduleTable] Received weekStart prop:",e),console.log(" [ScheduleTable] Expected current week:",$c());const[n,r]=_.useState([]),[i,a]=_.useState(!0),[o,l]=_.useState(""),[u,h]=_.useState(!1);_.useEffect(()=>{console.log(" [EDIT_MODE] State changed to:",u)},[u]);const[f,p]=_.useState(!1),[m,g]=_.useState(null),[y,b]=_.useState(""),[v,x]=_.useState(!1),[w,E]=_.useState([]),[T,C]=_.useState(null),[N,j]=_.useState(""),[P,M]=_.useState([]),[V,L]=_.useState(!1),[I,O]=_.useState(null),[X,$]=_.useState(!1),[H,D]=_.useState(null),[F,q]=_.useState(!1),[J,ee]=_.useState(null),[de,ge]=_.useState(!1),[Ce,B]=_.useState(!1),[K,xe]=_.useState(null),[Re,Se]=_.useState(null),[Ze,lt]=_.useState(!1),[Ae,$e]=_.useState(null),[ie,U]=_.useState(!1),[oe,Ue]=_.useState(!1),[hn,ys]=_.useState(!1),[Vs,Ar]=_.useState(!1),[tr,zs]=_.useState(!1),[kr,Cn]=_.useState(!1),[ct,Ws]=_.useState(null),[vs,is]=_.useState(!1),[xs,Tr]=_.useState({title:"",message:"",type:"success"}),[fn,Cr]=_.useState(!1),as=(W,Z,we="success")=>{Tr({title:W,message:Z,type:we}),is(!0)},[al,Tt]=_.useState([]);_.useEffect(()=>{s?(bt(),Nr()):a(!1)},[s,e]),_.useEffect(()=>()=>{Re&&clearTimeout(Re)},[Re]);const bt=async()=>{try{console.log(" [FETCH_SCHEDULE] Starting fetch for teacherId:",s,"weekStart:",e),a(!0);const W=await se.getTeacherSchedule(s,e);console.log(" [FETCH_SCHEDULE] API response:",W);const Z=W.schedules||[];console.log(" [FETCH_SCHEDULE] Original data:",Z),Tt(Z);const we=ks.applyDraftToSchedule(Z,s,e);console.log(" [FETCH_SCHEDULE] Schedule with draft:",we),r(we);const Ee=ks.hasUnsavedChanges();zs(Ee)}catch(W){l("Failed to load schedule"),console.error(" [FETCH_SCHEDULE] Error fetching schedule:",W)}finally{a(!1)}},Nr=async()=>{try{if(!s)return;const W=await se.getStudents({status:"active",limit:250});console.log(" [FETCH_STUDENTS] All students response:",W);const Z=[];W.success&&W.students&&Z.push(...W.students),E(Z)}catch(W){console.error("Error fetching available students:",W),alert("Failed to load students. Please refresh the page and try again.")}},Fa=W=>{var we;if(Re&&(clearTimeout(Re),Se(null)),!W.trim()){M([]),L(!1),B(!1),xe(null),O(null);return}const Z=w.map(Ee=>({...Ee,score:z(Ee.name,W)})).filter(Ee=>Ee.score>0).sort((Ee,tt)=>tt.score-Ee.score);if(M(Z),L(!0),Z.length===1&&Z[0].score>=80&&W.trim().length>0){const Ee=Z[0];console.log(" [AUTOFILL] Showing tip for single match:",Ee.name,"Score:",Ee.score),O(Ee),L(!1),B(!0),xe(Ee);const tt=Ee.score>=100?8e3:5e3,Ne=setTimeout(()=>{console.log(" [AUTOFILL] Hiding tip after timeout"),B(!1),xe(null),O(null)},tt);Se(Ne)}else console.log(" [AUTOFILL] No tip - filtered.length:",Z.length,"topScore:",(we=Z[0])==null?void 0:we.score),B(!1),xe(null),O(null)},z=(W,Z)=>{const we=W.toLowerCase(),Ee=Z.toLowerCase();return we.startsWith(Ee)?100:we.includes(Ee)?50:0},te=W=>{const Z=W.target.value;if(j(Z),O(null),Ce&&K){const we=Z.toLowerCase().trim(),Ee=K.name.toLowerCase();(!Ee.includes(we)||we.length<Ee.length)&&(B(!1),xe(null))}Fa(Z)},G=(W,Z)=>{console.log(" [DOUBLE_CLICK] editMode:",u,"dayIndex:",W,"timeSlot:",Z);const we=tu(W,Z);if(console.log(" [DOUBLE_CLICK] existingSchedule:",we),we){if(we.is_deleted)return;u?(console.log(" [DOUBLE_CLICK] Edit mode - calling handleDeleteLesson"),xh(we)):(console.log(" [DOUBLE_CLICK] Read mode - calling fetchLessonReport"),su(we))}else{if(!u)return;const Ee=`${W}-${Z}`;C(Ee),j(""),O(null),L(!1),B(!1),xe(null),setTimeout(()=>{const tt=document.getElementById(`student-input-${Ee}`);tt&&tt.focus()},0)}},he=()=>{C(null),j(""),O(null),L(!1),B(!1),xe(null)},ye=W=>{const Z={Monday:0,Tuesday:1,Wednesday:2,Thursday:3,Friday:4,Saturday:5,Sunday:6};return Z[W]!==void 0?Z[W]:0},be=W=>{if(console.log(" [HANDLE_STUDENT_SELECT] Selected student:",W),!m){console.log(" [HANDLE_STUDENT_SELECT] No time slot selected");return}je(W,null,m)},je=async(W=null,Z=null,we=null)=>{console.log(" [HANDLE_ADD_STUDENT] Called with:",{student:W==null?void 0:W.name,dayIndex:Z,timeSlot:we,selectedStudentId:y,selectedTimeSlot:m});const Ee=W,tt=we||m;if(console.log(" [HANDLE_ADD_STUDENT] Using:",{studentToUse:Ee==null?void 0:Ee.name,timeSlotToUse:tt}),!Ee||!tt){console.log(" [HANDLE_ADD_STUDENT] Missing required data:",{hasStudent:!!Ee,hasTimeSlot:!!tt});return}try{const Ne=Z!==null?Z:ye(tt.day);console.log(" [HANDLE_ADD_STUDENT] dayNumber:",Ne,"timeSlotToUse:",tt);const De={teacherId:s,studentId:Ee.id,studentName:Ee.name,dayOfWeek:Ne,timeSlot:tt.time||tt,weekStart:e};console.log(" [HANDLE_ADD_STUDENT] Adding to draft:",De);const qe=ks.addLesson(De);console.log(" [HANDLE_ADD_STUDENT] Draft result:",qe),zs(!0);const sr={id:De.id||`temp_${Date.now()}_${Math.random()}`,student_id:De.studentId,student_name:De.studentName,teacher_id:De.teacherId,day_of_week:De.dayOfWeek,time_slot:De.timeSlot,week_start_date:De.weekStart,attendance_status:"scheduled",is_draft:!0};r(nr=>[...nr,sr]),p(!1),b(""),g(null),C(null),j(""),O(null),L(!1),console.log(" [HANDLE_ADD_STUDENT] Added to draft successfully")}catch(Ne){console.error(" [HANDLE_ADD_STUDENT] Error adding student to schedule:",Ne),alert("Failed to add student to schedule: "+Ne.message)}},Je=["8:00-8:30","8:30-9:00","9:00-9:30","9:30-10:00","10:00-10:30","10:30-11:00","11:00-11:30","11:30-12:00","12:00-12:30","12:30-13:00","13:00-13:30","13:30-14:00","14:00-14:30","14:30-15:00","15:00-15:30","15:30-16:00","16:00-16:30","16:30-17:00","17:00-17:30","17:30-18:00","18:00-18:30","18:30-19:00","19:00-19:30","19:30-20:00","20:00-20:30","20:30-21:00","21:00-21:30","21:30-22:00"],Y=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],pe=e?P_(e):[],ke=$2(),Ie={};pe.forEach(W=>{const Z=`${W.getFullYear()}-${W.getMonth()+1}`;Ie[Z]=(Ie[Z]||0)+1});const Ge=Object.keys(Ie).reduce((W,Z)=>Ie[W]>Ie[Z]?W:Z,Object.keys(Ie)[0]),[Gs,vt]=Ge?Ge.split("-").map(Number):[ke.year,ke.month],Jt=e?ov(e,vt,Gs):null,ut=e?U2(e,vt,Gs):null,dt=pe.length>0?pe[0].toLocaleDateString("en-US",{month:"long",year:"numeric"}):ke.name+" "+ke.year,qs=(W,Z)=>n.find(we=>we.day_of_week===W&&we.time_slot===Z&&!we.is_deleted),tu=(W,Z)=>n.find(we=>we.day_of_week===W&&we.time_slot===Z),su=async W=>{try{const Z=new Date(W.week_start_date),we=new Date(Z);we.setDate(Z.getDate()+W.day_of_week);const Ee=we.getFullYear()+"-"+String(we.getMonth()+1).padStart(2,"0")+"-"+String(we.getDate()).padStart(2,"0");console.log(" [ADMIN_FETCH_REPORT] Schedule:",W),console.log(" [ADMIN_FETCH_REPORT] Week start:",W.week_start_date),console.log(" [ADMIN_FETCH_REPORT] Day of week:",W.day_of_week),console.log(" [ADMIN_FETCH_REPORT] Calculated lesson date:",Ee);const tt=await se.getReports({student_id:W.student_id,teacher_id:W.teacher_id,lesson_date:Ee,time_slot:W.time_slot});tt.reports&&tt.reports.length>0?ee({schedule:W,report:tt.reports[0]}):ee({schedule:W,report:null}),q(!0)}catch(Z){console.error("Error fetching lesson report:",Z),alert("Error fetching lesson report: "+Z.message)}},xh=async W=>{const Z=new Date(W.week_start_date)<new Date;$(!0),D(W)},nE=async()=>{if(H){try{if(H.is_draft){const W=ks.getDraftChanges();W&&(W.additions=W.additions.filter(Z=>!(Z.dayOfWeek===H.day_of_week&&Z.timeSlot===H.time_slot)),ks.saveDraftChanges(W),zs(W.additions.length>0||W.deletions.length>0))}else{const W={teacherId:s,dayOfWeek:H.day_of_week,timeSlot:H.time_slot,weekStart:e};console.log(" [DELETE] Calling draftManager.deleteLesson with:",H.id,W);const Z=ks.deleteLesson(H.id,W);console.log(" [DELETE] Delete result:",Z),zs(!0);const we=ks.getDraftChanges();console.log(" [DELETE] Draft after deletion:",we),we&&ks.saveDraftChanges(we)}}catch(W){console.error("Exception:",W),alert("Error deleting lesson: "+W.message),$(!1),D(null);return}H.is_draft?r(W=>W.filter(Z=>!(Z.day_of_week===H.day_of_week&&Z.time_slot===H.time_slot))):r(W=>W.map(Z=>Z.id===H.id?{...Z,is_deleted:!0,attendance_status:"deleted"}:Z)),$(!1),D(null)}},BR=async()=>{if(!(J!=null&&J.report)){as("Error","No report to delete","error");return}try{Ue(!0);const W=await se.deleteReport(J.report.id);W.success?(await se.markAttendance(J.schedule.id,"scheduled",new Date().toISOString().split("T")[0]),await bt(),q(!1),ee(null),ge(!1),as("Success!","Report deleted successfully. Lesson has been reset for the teacher to submit a new report.","success")):(console.error("Delete report failed:",W.error),as("Error","Failed to delete report: "+W.error,"error"))}catch(W){console.error("Exception deleting report:",W),as("Error","Error deleting report: "+W.message,"error")}finally{Ue(!1)}},HR=async W=>{try{const Z=await se.markAttendance(W.id,"scheduled");Z.success?(await bt(),as("Success!","Lesson has been reset for the teacher to submit a new report.","success")):(console.error("Failed to reset lesson:",Z.error),as("Error","Failed to reset lesson: "+(Z.error||"Unknown error"),"error"))}catch(Z){console.error("Error resetting lesson:",Z),as("Error","Error resetting lesson: "+Z.message,"error")}},rE=async()=>{try{ys(!0);const W=await se.extendSchedules();W.success?(as("Success!",`Extended ${W.count} schedule templates by one week.`,"success"),await bt()):(console.error("Failed to extend schedules:",W.error),as("Error","Failed to extend schedules: "+(W.error||"Unknown error"),"error"))}catch(W){console.error("Error extending schedules:",W),as("Error","Error extending schedules: "+W.message,"error")}finally{ys(!1),Ar(!1)}},VR=()=>{Ar(!0)},zR=W=>{$e(W),lt(!0)},WR=async()=>{if(Ae)try{U(!0),await HR(Ae),lt(!1),$e(null)}finally{U(!1)}},GR=(W,Z,we)=>{const Ee=`${W}-${Z}`;if(T===Ee)return c.jsxs("div",{className:"relative w-full",children:[c.jsx("input",{id:`student-input-${Ee}`,type:"text",value:N,onChange:te,onFocus:()=>L(!0),onBlur:()=>setTimeout(()=>L(!1),200),placeholder:"Type student name...",className:"w-full px-2 py-1 text-sm border border-blue-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onKeyDown:Ne=>{Ne.key==="Enter"&&I?(je(I,W,Z),C(null)):Ne.key==="Escape"&&(C(null),j(""),O(null))}}),Ce&&K&&c.jsx(Q.div,{initial:{opacity:0,y:-5,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-5,scale:.95},transition:{duration:.15,ease:"easeOut"},className:"absolute z-50 w-full mt-1 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-lg px-3 py-2 cursor-pointer hover:from-blue-100 hover:to-indigo-100 hover:shadow-xl transition-all duration-200",onClick:()=>{console.log(" [AUTOFILL_CLICK] Clicked autofill tip",{selectedStudent:I,autofillStudent:K,dayIndex:W,timeSlot:Z});const Ne=I||K;Ne?(console.log(" [AUTOFILL_CLICK] Calling handleAddStudentToSchedule with:",{student:Ne.name,dayIndex:W,timeSlot:Z}),je(Ne,W,Z),C(null)):console.log(" [AUTOFILL_CLICK] No student available for scheduling")},role:"button",tabIndex:0,"aria-label":`Select ${K.name} for this time slot`,onKeyDown:Ne=>{if(Ne.key==="Enter"||Ne.key===" "){Ne.preventDefault();const De=I||K;De&&(je(De,W,Z),C(null))}else Ne.key==="Escape"&&(B(!1),xe(null),O(null))},children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),c.jsxs("span",{className:"text-sm text-blue-800",children:[c.jsx("span",{className:"font-semibold",children:K.name}),c.jsx("span",{className:"text-blue-600 ml-2 text-xs",children:"Press Enter or click to select"})]})]}),c.jsx("button",{onClick:Ne=>{Ne.stopPropagation(),B(!1),xe(null),O(null)},className:"text-blue-400 hover:text-blue-600 ml-2 p-1 rounded-full hover:bg-blue-100 transition-colors","aria-label":"Dismiss suggestion",children:c.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),V&&P.length>1&&P.length<=7&&c.jsx(Q.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.15},className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:P.map((Ne,De)=>c.jsx("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 flex items-center justify-between",onClick:()=>{console.log(" [SUGGESTION_CLICK] Selected student:",Ne.name),je(Ne,W,Z),C(null)},role:"button",tabIndex:0,"aria-label":`Select ${Ne.name} for this time slot`,onKeyDown:qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),je(Ne,W,Z),C(null))},children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${Ne.score>=100?"bg-green-500":Ne.score>=80?"bg-blue-500":"bg-yellow-500"}`}),c.jsx("span",{className:"text-sm font-medium text-gray-800",children:Ne.name})]})},Ne.id))})]});if(we){const Ne=we.is_deleted;return c.jsxs("div",{className:`flex items-center justify-between cursor-pointer hover:bg-gray-50 p-1 ${Ne?"opacity-50 bg-red-50 line-through":""}`,onDoubleClick:()=>!Ne&&G(W,Z),title:Ne?"Marked for deletion (will be removed when saved)":u?"Double-click to remove student":"Double-click to view lesson report",children:[c.jsxs("span",{className:`text-sm font-medium ${Ne?"text-red-600":""}`,children:[we.student_name,Ne&&c.jsx("span",{className:"ml-1 text-xs text-red-500",children:"(deleted)"})]}),u&&!Ne&&c.jsx("button",{onClick:()=>xh(we),className:"text-red-500 hover:text-red-700 text-xs",children:""})]})}return c.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 cursor-pointer hover:bg-gray-50",onDoubleClick:()=>G(W,Z),children:c.jsx("span",{className:"text-xs",children:"Double-click to add student"})})},qR={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},KR=async()=>{t&&e&&!v&&Av("previousWeek")},XR=async()=>{t&&e&&!v&&Av("nextWeek")},YR=async()=>{t&&!v&&Av("currentWeek")},iE=async()=>{var tt,Ne;console.log(" [SAVE] Save button clicked, hasUnsavedChanges:",tr),console.log(" [SAVE] Current date:",new Date().toISOString().split("T")[0]),console.log(" [SAVE] Current date local:",new Date().toLocaleDateString("en-CA")),console.log(" [SAVE] Current day of week:",new Date().getDay()),console.log(" [SAVE] Expected current week start:",$c());const W=new Date,Z=W.getDay(),we=Z===0?6:Z-1,Ee=new Date(W);if(Ee.setDate(W.getDate()-we),console.log(" [SAVE] Manual calculation - daysToMonday:",we),console.log(" [SAVE] Manual calculation - monday:",Ee.toISOString().split("T")[0]),!tr){console.log(" [SAVE] No unsaved changes, returning early");return}try{Cr(!0);const De=ks.getDraftChanges();if(console.log(" [SAVE] Draft data:",De),console.log(" [SAVE] localStorage draft:",localStorage.getItem("schedule_draft_changes")),!De){console.log(" [SAVE] No draft data found"),console.log(" [SAVE] Checking if there are any changes in schedule state...");const qe=n.filter(nr=>nr.is_draft),sr=n.filter(nr=>nr.is_deleted);console.log(" [SAVE] Draft items in schedule:",qe.length),console.log(" [SAVE] Deleted items in schedule:",sr.length);return}console.log(" [SAVE] Current weekStart prop:",e),console.log(" [SAVE] Processing additions:",De.additions.length);for(const qe of De.additions){console.log(" [SAVE] Addition weekStart:",qe.weekStart),console.log(" [SAVE] Calling createSchedule with:",{student_id:qe.studentId,teacher_id:qe.teacherId,day_of_week:qe.dayOfWeek,time_slot:qe.timeSlot,week_start_date:qe.weekStart});try{const sr=await se.createSchedule({student_id:qe.studentId,teacher_id:qe.teacherId,day_of_week:qe.dayOfWeek,time_slot:qe.timeSlot,week_start_date:qe.weekStart});console.log(" [SAVE] createSchedule result:",sr)}catch(sr){throw console.error(" [SAVE] createSchedule error:",sr),sr}}console.log(" [SAVE] Processing deletions:",De.deletions.length);for(const qe of De.deletions)console.log(" [SAVE] Deleting schedule:",qe.scheduleId),await se.deleteSchedule(qe.scheduleId);ks.clearDraftChanges(),zs(!1),await bt(),console.log(" [DRAFT] Changes saved successfully")}catch(De){console.error(" [DRAFT] Failed to save changes:",De);let qe="Failed to save changes. Please try again.";De.message?qe=De.message:(Ne=(tt=De.response)==null?void 0:tt.data)!=null&&Ne.message&&(qe=De.response.data.message),as("Error",qe,"error")}finally{Cr(!1)}},JR=async()=>{ks.clearDraftChanges(),zs(!1),await bt(),console.log(" [DRAFT] Changes discarded")},Av=W=>{tr?(Ws(W),Cn(!0)):kv(W)},kv=W=>{if(W==="previousWeek"){if(t&&e&&!v){x(!0);const Z=F2(e,7);t(Z),setTimeout(()=>x(!1),300)}}else if(W==="nextWeek"){if(t&&e&&!v){x(!0);const Z=O2(e,7);t(Z),setTimeout(()=>x(!1),300)}}else if(W==="currentWeek"&&t&&!v){x(!0);const Z=$c();t(Z),setTimeout(()=>x(!1),300)}},aE=W=>{W==="save"?iE().then(()=>kv(ct)):W==="discard"&&(JR(),kv(ct)),Cn(!1),Ws(null)},QR=W=>W&&W.attendance_status||"scheduled",ZR=W=>{switch(W){case"completed":return"bg-success text-white";case"absent":return"bg-error text-white";case"absent_warned":return"bg-yellow-500 text-white";default:return"bg-neutral-200 text-neutral-700"}};return i?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"})}):o?c.jsx("div",{className:"text-center py-8",children:c.jsx("p",{className:"text-error text-sm",children:o})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200",children:[c.jsx(b$,{onExtendSchedules:rE}),c.jsx("div",{className:"p-4 border-b border-neutral-200",children:c.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[c.jsxs("h2",{className:"text-xs sm:text-lg font-semibold whitespace-nowrap",children:[c.jsx("span",{className:"sm:hidden",children:"Schedule"}),c.jsx("span",{className:"hidden sm:inline",children:"Weekly Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[t&&c.jsxs(Q.div,{className:"flex items-center gap-1",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:[c.jsx(Q.button,{onClick:KR,disabled:v,className:"p-2 rounded-lg border border-neutral-300 hover:bg-neutral-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:v?{x:[-2,2,-2]}:{x:0},transition:{duration:.1,repeat:v?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx(Q.button,{onClick:YR,disabled:v,className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed ${ut!=null&&ut.isCurrentWeek?"bg-primary-500 text-white":"text-neutral-700 bg-neutral-100 hover:bg-neutral-200"}`,title:(ut==null?void 0:ut.weekLabel)||"Current Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:(ut==null?void 0:ut.weekLabel)||"Week 1"},(ut==null?void 0:ut.weekLabel)||"Week 1")}),c.jsx(Q.button,{onClick:XR,disabled:v,className:"p-2 rounded-lg border border-neutral-300 hover:bg-neutral-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:v?{x:[2,-2,2]}:{x:0},transition:{duration:.1,repeat:v?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),c.jsx("button",{onClick:VR,disabled:hn,className:"flex items-center justify-center p-1.5 sm:p-2 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white rounded transition-colors group relative ml-2 sm:ml-4",title:"Extend all schedules by one week",children:hn?c.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):c.jsx("img",{src:"/pics/extend-schedule.png",alt:"Extend Schedule",className:"w-3 h-3 sm:w-4 sm:h-4 group-hover:scale-110 transition-transform"})})]})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3 flex-shrink-0 pt-1 sm:pt-0",children:[c.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[c.jsxs("span",{className:"text-xs font-medium text-neutral-700 whitespace-nowrap",children:[c.jsx("span",{className:"sm:hidden",children:"Read"}),c.jsx("span",{className:"hidden sm:inline",children:"Read Mode"})]}),c.jsx("button",{onClick:()=>h(!u),className:`relative inline-flex h-5 w-10 sm:h-6 sm:w-11 items-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${u?"bg-primary-500":"bg-neutral-300"}`,children:c.jsx("span",{className:`inline-block h-3 w-3 sm:h-4 sm:w-4 transform rounded-full bg-white transition-transform duration-200 ${u?"translate-x-6 sm:translate-x-6":"translate-x-1"}`})}),c.jsxs("span",{className:"text-xs font-medium text-neutral-700 whitespace-nowrap",children:[c.jsx("span",{className:"sm:hidden",children:"Edit"}),c.jsx("span",{className:"hidden sm:inline",children:"Edit Mode"})]})]}),u&&c.jsx("button",{className:"btn-primary text-xs sm:text-sm px-2 sm:px-4 py-1 sm:py-2 w-full sm:w-auto",onClick:iE,disabled:fn,children:fn?c.jsxs("div",{className:"flex items-center justify-center space-x-1 sm:space-x-2",children:[c.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),c.jsx("span",{className:"text-xs sm:text-sm",children:"Saving..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sm:hidden",children:"Save"}),c.jsx("span",{className:"hidden sm:inline",children:"Save Changes"})]})})]})]})}),c.jsx("div",{className:"w-full",children:c.jsx(cn,{mode:"wait",children:c.jsxs(Q.table,{className:"w-full table-fixed",variants:qR,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.3,ease:"easeInOut"},children:[c.jsxs("thead",{className:"bg-neutral-50",children:[c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-xs sm:text-sm font-semibold text-neutral-800 w-12 sm:w-16 md:w-24"}),c.jsx("th",{colSpan:"7",className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center text-sm sm:text-base md:text-lg font-bold text-neutral-800",children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:dt},dt)})]}),c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-medium text-neutral-700 w-10 sm:w-12 md:w-16",children:"Time"}),Y.map((W,Z)=>{var tt;const we=(tt=Jt==null?void 0:Jt.days)==null?void 0:tt[Z],Ee=(we==null?void 0:we.isCurrentMonth)??!0;return we==null||we.isEditable,c.jsx(Q.th,{className:`px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center font-medium min-w-0 ${Ee?"text-neutral-700":"text-neutral-400 bg-neutral-100"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:Z*.05},children:c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("div",{className:`font-semibold text-2xs sm:text-xs md:text-sm truncate ${Ee?"":"opacity-50"}`,children:W}),pe.length>Z&&c.jsx(Q.div,{className:`text-2xs sm:text-xs mt-0.5 sm:mt-1 truncate ${Ee?"text-neutral-500":"text-neutral-400"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.1+Z*.05},children:I2(pe[Z],"short")})]})},`${W}-${e}`)})]})]}),c.jsx("tbody",{children:Je.map((W,Z)=>c.jsxs(Q.tr,{className:"border-b border-neutral-100",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:Z*.02},children:[c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-2xs sm:text-xs md:text-sm text-neutral-600 font-medium",children:W}),Y.map((we,Ee)=>{var oE;const tt=ye(we),Ne=qs(tt,W),De=QR(Ne),qe=(oE=Jt==null?void 0:Jt.days)==null?void 0:oE[Ee],sr=(qe==null?void 0:qe.isCurrentMonth)??!0,nr=(qe==null?void 0:qe.isEditable)??!0;return c.jsx(Q.td,{className:`px-1 sm:px-2 py-1 h-10 sm:h-12 md:h-14 relative ${sr?"":"bg-neutral-50"}`,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2,delay:Z*.02+Ee*.01},onClick:he,children:c.jsx(cn,{mode:"wait",children:Ne?c.jsxs(Q.div,{className:`p-1 rounded-lg text-2xs font-medium text-center transition-all duration-200 ${ZR(De)} ${u&&nr||De==="completed"||De==="absent"||De==="absent_warned"?"cursor-pointer":""}`,whileHover:u&&nr?{scale:1.02}:De==="completed"?{scale:1.02}:De==="absent"||De==="absent_warned"?{scale:1.02}:{},whileTap:u&&nr?{scale:.98}:De==="completed"?{scale:.98}:De==="absent"||De==="absent_warned"?{scale:.98}:{},initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},onClick:u&&nr?()=>xh(Ne):De==="completed"?()=>su(Ne):De==="absent"||De==="absent_warned"?()=>zR(Ne):void 0,children:[c.jsx("div",{className:"truncate text-2xs",children:Ne.student_name}),u&&nr?c.jsx("div",{className:"mt-1 text-2xs opacity-75",children:"Click to remove"}):De==="completed"?c.jsx("div",{className:"mt-1 text-2xs opacity-75",children:"Click to view report"}):De==="absent"||De==="absent_warned"?c.jsx("div",{className:"mt-1 text-2xs opacity-75",children:"Click to reset"}):null]},`student-${Ne.id}-${e}`):u&&nr?c.jsx(Q.div,{className:"w-full h-full",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:GR(tt,W,tu(tt,W))},`enhanced-cell-${Ee}-${Z}-${e}`):c.jsx(Q.div,{className:`w-full h-12 flex items-center justify-center ${sr?"text-neutral-300":"text-neutral-200"}`,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:sr?"-":""},`empty-${Ee}-${Z}-${e}`)})},`${Ee}-${Z}-${e}`)})]},W))})]},e)})}),c.jsx("div",{className:"p-4 border-t border-neutral-200",children:c.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-success rounded"}),c.jsx("span",{children:"Completed"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-error rounded"}),c.jsx("span",{children:"UI"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),c.jsx("span",{children:"I"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-neutral-200 rounded"}),c.jsx("span",{children:"Scheduled"})]})]})}),c.jsx(w$,{isOpen:f,onClose:()=>{p(!1),b(""),g(null)},onSelect:be,teacherId:s,teacherName:"Teacher"}),F&&J&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"Lesson Report"}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Student:"})," ",J.schedule.student_name]}),c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Date:"})," ",(()=>{const W=new Date(J.schedule.week_start_date),Z=new Date(W);return Z.setDate(W.getDate()+J.schedule.day_of_week),Z.toLocaleDateString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit"})})()]}),c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Time:"})," ",J.schedule.time_slot]}),c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Status:"})," ",J.schedule.attendance_status]})]}),J.report?c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Teacher's Report:"}),c.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:c.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:J.report.comment})}),c.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Report created: ",new Date(J.report.created_at).toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})]})]}):c.jsx("div",{className:"mb-4",children:c.jsx("p",{className:"text-gray-500 italic",children:"No lesson report available for this lesson."})}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:()=>q(!1),className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Close"}),J.report&&c.jsx("button",{onClick:()=>ge(!0),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete Report"})]})]})}),c.jsxs(ka,{isOpen:de,onClose:()=>ge(!1),title:"Delete Lesson Report",loading:oe,loadingText:"Deleting...",confirmText:"Delete Report",confirmButtonColor:"bg-red-500 hover:bg-red-600",onConfirm:BR,children:[c.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to delete this lesson report?"}),c.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[c.jsx("p",{className:"text-sm text-yellow-800",children:c.jsx("strong",{children:"This will:"})}),c.jsxs("ul",{className:"text-sm text-yellow-700 mt-2 list-disc list-inside",children:[c.jsx("li",{children:"Delete the report from the database"}),c.jsx("li",{children:'Reset the lesson status to "Scheduled"'}),c.jsx("li",{children:"Allow the teacher to submit a new report"}),c.jsx("li",{children:"Reset attendance status "})]})]})]}),c.jsxs(ka,{isOpen:Ze,onClose:()=>{lt(!1),$e(null)},title:"Reset Lesson",loading:ie,loadingText:"Resetting...",confirmText:"Reset Lesson",confirmButtonColor:"bg-blue-500 hover:bg-blue-600",onConfirm:WR,children:[c.jsx("p",{className:"text-gray-600 mb-4",children:'Are you sure you want to reset this lesson to "Scheduled"?'}),c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[c.jsx("p",{className:"text-sm text-blue-800",children:c.jsx("strong",{children:"This will:"})}),c.jsxs("ul",{className:"text-sm text-blue-700 mt-2 list-disc list-inside",children:[c.jsx("li",{children:'Reset the lesson status to "Scheduled"'}),c.jsx("li",{children:"Allow the teacher to mark attendance again"})]})]})]}),c.jsxs(ka,{isOpen:Vs,onClose:()=>Ar(!1),title:"Extend All Schedules",loading:hn,loadingText:"Extending...",confirmText:"Extend Schedules",confirmButtonColor:"bg-blue-500 hover:bg-blue-600",onConfirm:rE,children:[c.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to extend all schedules by 1 week?"}),c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[c.jsx("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"This will:"}),c.jsxs("ul",{className:"text-sm text-blue-700 list-disc list-inside",children:[c.jsx("li",{children:"Add one new week after the last scheduled week for each active schedule pattern"}),c.jsx("li",{children:"Extend all active student/teacher/day/time combinations"}),c.jsx("li",{children:'Create new schedule entries with "scheduled" status'})]})]})]}),X&&H&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4 text-red-600",children:"Delete Future Lessons"}),c.jsxs("p",{className:"text-gray-600 mb-4",children:["This will delete ",c.jsx("strong",{children:"all future lessons"})," with the same pattern."]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Past lessons will be ",c.jsx("strong",{children:"preserved"})," for historical records."]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:()=>$(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{onClick:nE,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg",children:"Delete Future Lessons"})]})]})}),c.jsx(B2,{isOpen:kr,onClose:()=>Cn(!1),onSave:()=>aE("save"),onDiscard:()=>aE("discard"),pendingAction:ct,changesSummary:ks.getChangesSummary()}),c.jsx(mh,{isVisible:vs,onClose:()=>is(!1),title:xs.title,message:xs.message,type:xs.type})]})},_$=({teacher:s,loading:e=!1})=>c.jsxs(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center justify-between p-3 border rounded-lg transition-all duration-200 bg-gray-50 border-gray-200 hover:bg-gray-100",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"flex-shrink-0",children:s.photo_url?c.jsx("img",{src:s.photo_url,alt:s.name,className:"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"}):c.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center border-2 border-white shadow-sm",children:c.jsx("span",{className:"text-sm font-medium text-gray-600",children:s.name.charAt(0).toUpperCase()})})}),c.jsxs("div",{children:[c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("span",{className:"font-medium text-gray-900",children:s.name})}),c.jsxs("div",{className:"text-sm text-gray-500",children:["Assigned: ",new Date(s.assigned_date).toLocaleDateString()]})]})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("span",{className:"text-xs text-gray-500",children:"Connected"})})]}),E$=({student:s,isOpen:e,onClose:t,assignedTeachers:n=[],loading:r=!1})=>!e||!s?null:c.jsx(cn,{children:c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[c.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Teachers for ",s.name]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),c.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:c.jsxs("div",{className:"mb-6",children:[c.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:["Currently Assigned Teachers (",n.length,")"]}),c.jsx("div",{className:"space-y-2",children:n.length===0?c.jsxs("div",{className:"text-center py-8 text-gray-500",children:[c.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),c.jsx("p",{className:"text-sm",children:"No teachers assigned"})]}):c.jsx(cn,{children:n.map(i=>c.jsx(_$,{teacher:i,loading:r},i.id))})})]})}),c.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end",children:c.jsx("button",{onClick:t,disabled:r,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Close"})})]})})}),A$=({packages:s,loading:e,onDeletePackage:t,onSort:n,sortConfig:r,onPageChange:i,pagination:a})=>{const o=l=>{switch(l){case"exhausted":return"text-red-600 bg-red-50";case"low":return"text-yellow-600 bg-yellow-50";case"active":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};return c.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[c.jsxs("table",{className:"w-full",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50",children:[c.jsxs("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>n("student_name"),children:["Student Name",r.key==="student_name"&&c.jsx("span",{className:"ml-1",children:r.direction==="asc"?"":""})]}),c.jsxs("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>n("lessons_remaining"),children:["Package",r.key==="lessons_remaining"&&c.jsx("span",{className:"ml-1",children:r.direction==="asc"?"":""})]}),c.jsxs("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>n("date_added"),children:["Date Added",r.key==="date_added"&&c.jsx("span",{className:"ml-1",children:r.direction==="asc"?"":""})]}),c.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e?c.jsx("tr",{children:c.jsx("td",{colSpan:"4",className:"px-4 py-8 text-center text-gray-500",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"})})}):s.length===0?c.jsx("tr",{children:c.jsx("td",{colSpan:"4",className:"px-4 py-8 text-center text-sm text-gray-500",children:"No packages found"})}):s.map(l=>c.jsxs(Q.tr,{className:"hover:bg-gray-50",whileHover:{scale:1.01},transition:{duration:.2},children:[c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:l.student_name}),c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o(l.package_status)}`,children:[l.lessons_remaining," / ",l.number_of_lessons]}),c.jsxs("span",{className:"text-gray-500",children:["(",l.lessons_taken," used)"]})]})}),c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(l.date_added).toLocaleDateString()}),c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm",children:c.jsx("button",{onClick:()=>t(l),className:"text-red-600 hover:text-red-800 transition-colors",children:"Delete"})})]},l.package_id))})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mt-4 gap-2",children:[c.jsxs("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(a.page-1)*a.limit+1," to ",Math.min(a.page*a.limit,a.total||0)," of ",a.total||0," packages"]}),c.jsxs("div",{className:"flex space-x-2 justify-center sm:justify-end",children:[c.jsx("button",{onClick:()=>i(Math.max(1,a.page-1)),disabled:a.page===1,className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),c.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",a.page," of ",Math.ceil((a.total||0)/a.limit)]}),c.jsx("button",{onClick:()=>i(a.page+1),disabled:a.page>=Math.ceil((a.total||0)/a.limit),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})},k$=({isOpen:s,onClose:e,onAddPackage:t,loading:n,availableStudents:r,onStudentNameChange:i,onStudentSelect:a,newPackage:o,setNewPackage:l,showSuggestions:u,filteredStudents:h,showAutofillTip:f,autofillStudent:p})=>c.jsx(ka,{isOpen:s,onClose:e,title:"Add New Package",onConfirm:t,loading:n,loadingText:"Adding package...",confirmText:"Add Package",cancelText:"Cancel",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student Name *"}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",placeholder:"Type student name...",value:o.studentName,onChange:m=>i(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),u&&h.length>0&&c.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:h.map(m=>c.jsx("div",{onClick:()=>a(m),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",children:m.name},m.id))}),f&&p&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:["Press Enter to select: ",p.name]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Lessons *"}),c.jsx("input",{type:"number",min:"1",placeholder:"Enter number of lessons",value:o.numberOfLessons,onChange:m=>l(g=>({...g,numberOfLessons:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Added *"}),c.jsx("input",{type:"date",value:o.dateAdded,onChange:m=>l(g=>({...g,dateAdded:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]})}),T$=({isOpen:s,onClose:e,onConfirm:t,loading:n,packageData:r})=>c.jsx(ka,{isOpen:s&&!!r,onClose:e,title:"Delete Package",confirmText:"Delete Package",cancelText:"Cancel",onConfirm:t,loading:n,loadingText:"Deleting...",confirmButtonColor:"bg-red-500 hover:bg-red-600",disabled:n,children:r&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to delete the package for ",c.jsx("strong",{children:r.student_name}),"?"]}),c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:c.jsx("p",{className:"text-yellow-800 text-sm",children:"This will permanently remove the package and all associated data."})})]})}),C$=()=>{const[s,e]=_.useState([]),[t,n]=_.useState(!1),[r,i]=_.useState({name:"",status:"all"}),[a,o]=_.useState({key:"date_added",direction:"desc"}),[l,u]=_.useState({page:1,limit:20,total:0}),[h,f]=_.useState(!1),[p,m]=_.useState(!1),[g,y]=_.useState(null),[b,v]=_.useState(!1),[x,w]=_.useState(!1),[E,T]=_.useState([]),[C,N]=_.useState([]),[j,P]=_.useState(!1),[M,V]=_.useState(!1),[L,I]=_.useState(null),[O,X]=_.useState(null),[$,H]=_.useState({studentName:"",studentId:null,numberOfLessons:"",dateAdded:new Date().toISOString().split("T")[0]}),[D,F]=_.useState(!1),[q,J]=_.useState({title:"",message:"",type:"success"}),ee=(ie,U,oe="success")=>{J({title:ie,message:U,type:oe}),F(!0)},de=async()=>{try{n(!0);const ie=await se.getStudentPackages({...r,page:l.page,limit:l.limit,sort:a.key,direction:a.direction});ie.success?(e(ie.packages),u(U=>({...U,total:ie.total||ie.packages.length}))):ee("Error",`Failed to fetch packages: ${ie.error||"Unknown error"}`,"error")}catch(ie){console.error(" [FETCH_PACKAGES] Error fetching packages:",ie),ee("Error","Error fetching packages","error")}finally{n(!1)}},ge=async()=>{try{const ie=await se.getStudents({status:"active"});ie.success&&T(ie.students)}catch(ie){console.error(" [FETCH_AVAILABLE_STUDENTS] Error fetching students:",ie)}},Ce=ie=>{if(!ie.trim()){N([]),P(!1),V(!1),I(null);return}const U=E.filter(oe=>oe.name.toLowerCase().includes(ie.toLowerCase()));N(U),P(!0),U.length<=3&&U.length>0?(V(!0),I(U[0])):(V(!1),I(null))},B=ie=>{H(oe=>({...oe,studentName:ie,studentId:null})),O&&clearTimeout(O);const U=setTimeout(()=>{ie.trim()&&M&&L&&(H(oe=>({...oe,studentName:L.name,studentId:L.id})),P(!1),V(!1),I(null))},2e3);X(U),Ce(ie)},K=ie=>{H(U=>({...U,studentName:ie.name,studentId:ie.id})),P(!1),V(!1),I(null)},xe=ie=>{o(U=>({key:ie,direction:U.key===ie&&U.direction==="asc"?"desc":"asc"}))},Re=ie=>{u(U=>({...U,page:ie}))},Se=(ie,U)=>{i(oe=>({...oe,[ie]:U})),u(oe=>({...oe,page:1}))},Ze=async()=>{try{if(v(!0),!$.studentId||!$.numberOfLessons||!$.dateAdded){ee("Error","Please fill in all fields","error");return}if(s.find(Ue=>Ue.student_id===$.studentId&&Ue.package_status!=="exhausted")){ee("Error","This student already has an active package. Please delete the existing package first.","error");return}const U={student_id:$.studentId,number_of_lessons:parseInt($.numberOfLessons),date_added:$.dateAdded},oe=await se.addStudentPackage(U);oe.success?(ee("Success!","Package added successfully","success"),f(!1),H({studentName:"",studentId:null,numberOfLessons:"",dateAdded:new Date().toISOString().split("T")[0]}),await de()):ee("Error",`Failed to add package: ${oe.error||"Unknown error"}`,"error")}catch(ie){console.error(" [ADD_PACKAGE] Error adding package:",ie),ee("Error","Error adding package","error")}finally{v(!1)}},lt=ie=>{y(ie),m(!0)},Ae=async()=>{try{w(!0);const ie=await se.deleteStudentPackage(g.package_id);ie.success?(ee("Success!","Package deleted successfully","success"),m(!1),y(null),await de()):ee("Error",`Failed to delete package: ${ie.error||"Unknown error"}`,"error")}catch(ie){console.error(" [DELETE_PACKAGE] Error deleting package:",ie),ee("Error","Error deleting package","error")}finally{w(!1)}},$e=async()=>{var oe;const ie=new Date().toISOString().split("T")[0],U=localStorage.getItem("exhaustedPackagesChecked");if(console.log(" [CHECK_EXHAUSTED_PACKAGES] Starting check...",{today:ie,lastChecked:U,shouldCheck:U!==ie}),U!==ie){console.log(" [CHECK_EXHAUSTED_PACKAGES] Need to check today - proceeding with API call"),U&&U!==ie&&(console.log(" [CHECK_EXHAUSTED_PACKAGES] Clearing previous day record:",U),localStorage.removeItem("exhaustedPackagesChecked"));try{console.log(" [CHECK_EXHAUSTED_PACKAGES] Calling getExhaustedPackages API...");const Ue=await se.getExhaustedPackages();console.log(" [CHECK_EXHAUSTED_PACKAGES] API Response:",{success:Ue.success,packageCount:((oe=Ue.packages)==null?void 0:oe.length)||0,packages:Ue.packages}),Ue.success&&Ue.packages.length>0?(console.log(" [CHECK_EXHAUSTED_PACKAGES] Found exhausted packages - showing notification"),ee("Exhausted Packages",`${Ue.packages.length} packages have been exhausted`,"warning")):console.log(" [CHECK_EXHAUSTED_PACKAGES] No exhausted packages found"),localStorage.setItem("exhaustedPackagesChecked",ie),console.log(" [CHECK_EXHAUSTED_PACKAGES] Saved check date to localStorage:",ie)}catch(Ue){console.error(" [CHECK_EXHAUSTED_PACKAGES] Error checking exhausted packages:",Ue)}}else console.log(" [CHECK_EXHAUSTED_PACKAGES] Already checked today - skipping")};return _.useEffect(()=>{de()},[r,a,l.page]),_.useEffect(()=>{ge()},[]),_.useEffect(()=>{$e()},[]),c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 sm:p-4",children:c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0",children:[c.jsxs("div",{className:"flex-1 max-w-md",children:[c.jsx("label",{className:"block text-xs sm:text-sm text-gray-600 mb-1",children:"Search by name"}),c.jsx("input",{type:"text",placeholder:"Search packages by student name...",value:r.name,onChange:ie=>Se("name",ie.target.value),className:"px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent w-full text-sm"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("select",{value:r.status,onChange:ie=>Se("status",ie.target.value),className:"px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",children:[c.jsx("option",{value:"all",children:"All"}),c.jsx("option",{value:"low",children:"Low"}),c.jsx("option",{value:"exhausted",children:"Exhausted"})]}),c.jsx("button",{onClick:()=>f(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-3 sm:px-4 py-1 sm:py-2 rounded-lg text-sm transition-colors duration-200",children:"Add Package"})]})]})}),c.jsx(A$,{packages:s,loading:t,onDeletePackage:lt,onSort:xe,sortConfig:a,onPageChange:Re,pagination:l}),c.jsx(k$,{isOpen:h,onClose:()=>f(!1),onAddPackage:Ze,loading:b,availableStudents:E,onStudentNameChange:B,onStudentSelect:K,newPackage:$,setNewPackage:H,showSuggestions:j,filteredStudents:C,showAutofillTip:M,autofillStudent:L}),c.jsx(T$,{isOpen:p,onClose:()=>m(!1),onConfirm:Ae,loading:x,packageData:g}),c.jsx(mh,{isVisible:D,onClose:()=>F(!1),title:q.title,message:q.message,type:q.type,duration:4e3})]})},N$=({onStudentSelect:s,selectedStudent:e})=>{const[t,n]=_.useState([]),[r,i]=_.useState([]),[a,o]=_.useState(!0),[l,u]=_.useState("active"),[h,f]=_.useState({name:"",status:"active"}),[p,m]=_.useState({page:1,limit:50,total:0}),[g,y]=_.useState(!1),[b,v]=_.useState({name:""}),[x,w]=_.useState(!1),[E,T]=_.useState([]),[C,N]=_.useState({key:"added_date",direction:"desc"}),[j,P]=_.useState(!1),[M,V]=_.useState(null),[L,I]=_.useState([]),[O,X]=_.useState([]),[$,H]=_.useState(!1),[D,F]=_.useState(!1),[q,J]=_.useState(null),[ee,de]=_.useState(!1),[ge,Ce]=_.useState(!1),[B,K]=_.useState(null),[xe,Re]=_.useState(!1),[Se,Ze]=_.useState(null),[lt,Ae]=_.useState(!1),[$e,ie]=_.useState(!1),[U,oe]=_.useState({title:"",message:"",type:"success"}),[Ue,hn]=_.useState(new Date),[ys,Vs]=_.useState(null),[Ar,tr]=_.useState([]),[zs,kr]=_.useState(!1),[Cn,ct]=_.useState({}),[Ws,vs]=_.useState(!1);_.useEffect(()=>{l==="active"?is():xs(),Tr()},[p.page,h,C,l]),_.useEffect(()=>{is(),xs(),Tr()},[]),_.useEffect(()=>{const Y=fn(Ue);tr(Y),Vs(null),(async()=>{try{vs(!0);const ke=Ue.getMonth()+1,Ie=Ue.getFullYear();console.log(" [STUDENT_MANAGEMENT] Fetching monthly lessons for:",Ie,ke);const Ge=await se.getStudentMonthlyLessons(ke,Ie);if(Ge.success){const Gs={};Ge.monthlyLessons.forEach(vt=>{const Jt=vt.student_id,ut=vt.week_start_date;Gs[Jt]||(Gs[Jt]={}),Gs[Jt][ut]={completed_lessons:Number(vt.completed_lessons),absent_lessons:Number(vt.absent_lessons),total_lessons:Number(vt.total_lessons)}}),ct(Gs),console.log(" [STUDENT_MANAGEMENT] Monthly lessons loaded:",Gs)}}catch(ke){console.error("Error fetching monthly lessons:",ke)}finally{vs(!1)}})()},[Ue]);const is=async()=>{var Y;try{o(!0);const pe=await se.getStudents({...h,status:"active",page:p.page,limit:p.limit,sort_by:C.key,sort_order:C.direction});pe.success&&(console.log(" [STUDENTS] API Response:",{studentsCount:(Y=pe.students)==null?void 0:Y.length,total:pe.total}),n(pe.students),m(ke=>({...ke,total:pe.total})))}catch(pe){console.error("Error fetching students:",pe)}finally{o(!1)}},xs=async()=>{try{o(!0);const Y=await se.getInactiveStudents();Y.success&&i(Y.students||[])}catch(Y){console.error("Error fetching inactive students:",Y),Y.status===401&&(window.location.href="/login")}finally{o(!1)}},Tr=async()=>{try{const Y=await se.getTeachers();Y.success&&T(Y.teachers)}catch(Y){console.error("Error fetching teachers:",Y),Y.status===401&&(window.location.href="/login")}},fn=Y=>{const pe=Y.getFullYear(),ke=Y.getMonth(),Ie=[],Ge=new Date(pe,ke,1),Gs=new Date(pe,ke+1,0);let vt=new Date(Ge);const Jt=Ge.getDay(),ut=Jt===0?1:(8-Jt)%7;vt.setDate(Ge.getDate()+ut);let dt=1;for(;vt<=Gs;){const qs=new Date(vt);qs.setDate(vt.getDate()+6),Ie.push({weekNumber:dt,start:vt.getFullYear()+"-"+String(vt.getMonth()+1).padStart(2,"0")+"-"+String(vt.getDate()).padStart(2,"0"),end:qs.getFullYear()+"-"+String(qs.getMonth()+1).padStart(2,"0")+"-"+String(qs.getDate()).padStart(2,"0")}),vt.setDate(vt.getDate()+7),dt++}return Ie},Cr=()=>{hn(Y=>new Date(Y.getFullYear(),Y.getMonth()-1))},as=()=>{hn(Y=>new Date(Y.getFullYear(),Y.getMonth()+1))},al=Y=>{if(ys){const Ie=Cn[Y];if(!Ie)return console.log(` [GET_LESSON_COUNT] No monthly lessons for student ${Y}`),0;const Ge=ys.start;console.log(` [GET_LESSON_COUNT] Looking for week ${Ge} in student ${Y} lessons:`,Ie);for(const[Gs,vt]of Object.entries(Ie)){const Jt=new Date(Gs),ut=Jt.getFullYear()+"-"+String(Jt.getMonth()+1).padStart(2,"0")+"-"+String(Jt.getDate()).padStart(2,"0");if(ut===Ge)return console.log(` [GET_LESSON_COUNT] Found matching week ${Gs} (${ut}):`,vt),vt.total_lessons||0}return console.log(` [GET_LESSON_COUNT] No matching week found for ${Ge}`),0}const pe=Cn[Y];if(!pe)return 0;let ke=0;return Object.values(pe).forEach(Ie=>{ke+=Ie.total_lessons||0}),ke},Tt=(Y,pe,ke="success")=>{oe({title:Y,message:pe,type:ke}),ie(!0)},bt=(Y,pe)=>{f(ke=>({...ke,[Y]:pe})),m(ke=>({...ke,page:1}))},Nr=Y=>{N(pe=>({key:Y,direction:pe.key===Y&&pe.direction==="asc"?"desc":"asc"})),m(pe=>({...pe,page:1}))},Fa=async Y=>{try{de(!0);const pe=await se.getStudentAttendanceAnalytics(Y,h.date_from||void 0,h.date_to||void 0,"week");pe.success&&(J(pe.data),F(!0))}catch(pe){console.error("Error fetching student stats:",pe),Tt("Error","Error loading student statistics","error")}finally{de(!1)}},z=(Y,pe)=>{K({student:Y,newStatus:pe}),Ce(!0)},te=async()=>{try{const{student:Y,newStatus:pe}=B;pe===!1?(await se.updateStudent(Y.id,{name:Y.name,teacher_id:null,lessons_per_week:Y.lessons_per_week,is_active:!1}),await Promise.all([is(),xs()]),Tt("Success!","Student deactivated successfully","success"),Ce(!1),K(null)):pe===!0&&(await se.updateStudent(Y.id,{name:Y.name,teacher_id:null,lessons_per_week:Y.lessons_per_week,is_active:!0}),await Promise.all([is(),xs()]),Tt("Success!","Student reactivated successfully","success"),Ce(!1),K(null))}catch(Y){console.error("Error updating student status:",Y),Tt("Error","Error updating student status","error")}},G=async()=>{try{if(!b.name){Tt("Validation Error","Please fill in the student name","error");return}w(!0),(await se.createStudent({name:b.name,lessons_per_week:1,added_date:new Date().toISOString().split("T")[0]})).success&&(v({name:""}),y(!1),is(),Tt("Success!","Student added successfully","success"))}catch(Y){console.error("Error adding student:",Y),Tt("Error","Failed to add student","error")}finally{w(!1)}},he=async Y=>{try{H(!0);const pe=await se.getStudentTeachers(Y);if(pe.success){I(pe.teachers||[]);const ke=(pe.teachers||[]).map(Ge=>Ge.id),Ie=E.filter(Ge=>!ke.includes(Ge.id)&&Ge.is_active===!0);console.log(" [TEACHER_MANAGEMENT] Available teachers calculation:",{assignedTeachers:pe.teachers||[],assignedIds:ke,allTeachers:E.length,activeTeachers:E.filter(Ge=>Ge.is_active===!0).length,availableTeachers:Ie.length,availableIds:Ie.map(Ge=>Ge.id),inactiveTeachers:E.filter(Ge=>Ge.is_active===!1).map(Ge=>({id:Ge.id,name:Ge.name}))}),X(Ie)}else console.error(" [TEACHER_MANAGEMENT] Failed to fetch student teachers:",pe),Tt("Error","Failed to load teacher assignments. Please run the database migration script.","error"),I([]),X([])}catch(pe){console.error(" [TEACHER_MANAGEMENT] Error fetching student teachers:",pe),console.error(" [DEBUG] Student ID:",Y),console.error(" [DEBUG] Error details:",{message:pe.message,status:pe.status,stack:pe.stack}),Tt("Error",`Failed to load teacher assignments: ${pe.message}`,"error"),I([]),X([])}finally{H(!1)}},ye=async Y=>{V(Y),P(!0),await he(Y.id)},be=()=>{P(!1),V(null),I([]),X([])},je=Y=>{Ze(Y),Re(!0)},Je=async()=>{try{Ae(!0),(await se.deleteStudent(Se.id)).success&&(await Promise.all([is(),xs()]),Tt("Success!","Student deleted successfully - all data removed","success")),Re(!1),Ze(null)}catch(Y){console.error("Error deleting student:",Y),Tt("Error","Error deleting student","error")}finally{Ae(!1)}};return c.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-3 sm:p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-4",children:[c.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800",children:"Student Management"}),c.jsx("button",{onClick:()=>y(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-3 sm:px-4 py-2 rounded-lg text-sm sm:text-base transition-colors duration-200",children:"Add New Student"})]}),c.jsxs("div",{className:"flex space-x-1 mb-4 sm:mb-6 overflow-x-auto",children:[c.jsxs("button",{onClick:()=>u("active"),className:`px-1.5 sm:px-4 py-0.5 sm:py-2 rounded-lg text-xs sm:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l==="active"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Active (",t.length,")"]}),c.jsx("button",{onClick:()=>u("packages"),className:`px-1.5 sm:px-4 py-0.5 sm:py-2 rounded-lg text-xs sm:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l==="packages"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Packages"}),c.jsxs("button",{onClick:()=>u("inactive"),className:`px-1.5 sm:px-4 py-0.5 sm:py-2 rounded-lg text-xs sm:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l==="inactive"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Inactive (",r.length,")"]})]}),l==="active"&&c.jsx("div",{className:"mb-4 sm:mb-6",children:c.jsxs("div",{className:"flex items-center justify-start space-x-4",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:Cr,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:""}),c.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:Ue.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),c.jsx("button",{onClick:as,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:""})]}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>kr(!zs),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:ys?`Week ${ys.weekNumber}`:"All Weeks"}),zs&&c.jsxs("div",{className:"absolute mt-1 bg-white border rounded shadow-lg z-10 min-w-64 right-0",children:[c.jsx("button",{onClick:()=>{Vs(null),kr(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:"All Weeks"}),Ar.map(Y=>c.jsxs("button",{onClick:()=>{Vs(Y),kr(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:["Week ",Y.weekNumber,": ",new Date(Y.start).toLocaleDateString()," - ",new Date(Y.end).toLocaleDateString()]},Y.weekNumber))]})]})]})}),l==="active"&&c.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0",children:[c.jsxs("div",{className:"flex-1 max-w-md",children:[c.jsx("label",{className:"block text-xs sm:text-sm text-gray-600 mb-1",children:"Search by name"}),c.jsx("input",{type:"text",placeholder:"Search by name...",value:h.name,onChange:Y=>bt("name",Y.target.value),className:"px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent w-full text-sm"})]}),c.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:ys?`Showing lesson counts for Week ${ys.weekNumber} (${new Date(ys.start).toLocaleDateString()} - ${new Date(ys.end).toLocaleDateString()})`:`Showing lesson counts for ${Ue.toLocaleDateString("en-US",{month:"long",year:"numeric"})}`})]})}),c.jsxs("div",{className:"w-full overflow-x-auto",children:[Ws&&c.jsxs("div",{className:"flex items-center justify-center py-4 text-gray-500",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-500 mr-2"}),"Loading lesson data..."]}),c.jsxs("table",{className:"w-full table-fixed min-w-full",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50",children:[c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none w-1/3 sm:w-auto",onClick:()=>Nr("name"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{children:"Name"}),C.key==="name"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"":""})]})}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none w-1/6 sm:w-auto",onClick:()=>Nr("teacher_name"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{className:"sm:hidden",children:"T"}),c.jsx("span",{className:"hidden sm:inline",children:"Teacher"}),C.key==="teacher_name"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"":""})]})}),c.jsxs("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider w-1/6 sm:w-auto",children:[c.jsx("span",{className:"sm:hidden",children:"L"}),c.jsx("span",{className:"hidden sm:inline",children:"Total Lessons"})]}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none hidden xl:table-cell",onClick:()=>Nr("added_date"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{children:"Added Date"}),C.key==="added_date"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"":""})]})}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none w-1/6 sm:w-auto",onClick:()=>Nr("is_active"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{className:"sm:hidden",children:"A"}),c.jsx("span",{className:"hidden sm:inline",children:"Status"}),C.key==="is_active"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"":""})]})}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider w-1/3 sm:w-auto",children:"Actions"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a?c.jsx("tr",{children:c.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"})})}):(l==="active"?t:r).length===0?c.jsx("tr",{children:c.jsxs("td",{colSpan:"6",className:"px-4 py-8 text-center text-sm sm:text-base text-gray-500",children:["No ",l," students found"]})}):(l==="active"?t:r).map(Y=>c.jsxs(Q.tr,{className:`hover:bg-gray-50 cursor-pointer ${(e==null?void 0:e.id)===Y.id?"bg-primary-50":""}`,onClick:()=>{s(Y),Fa(Y.id)},whileHover:{scale:1.01},transition:{duration:.2},children:[c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-xs sm:text-base font-medium text-gray-900",children:c.jsx("div",{className:"truncate",children:Y.name})}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-xs sm:text-base text-gray-500",children:Y.is_active?c.jsxs("button",{onClick:pe=>{pe.stopPropagation(),ye(Y)},className:"text-blue-600 hover:text-blue-800 text-xs px-1 py-0.5 rounded hover:bg-blue-50",children:[c.jsx("span",{className:"sm:hidden",children:"T"}),c.jsx("span",{className:"hidden sm:inline",children:"Teachers"})]}):c.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-xs sm:text-base text-gray-500",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600",children:al(Y.id)})}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-sm sm:text-base text-gray-500 hidden xl:table-cell",children:new Date(Y.added_date).toLocaleDateString()}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3",children:c.jsx("div",{className:"flex items-center space-x-4 sm:space-x-2",children:c.jsxs("span",{className:`inline-flex px-1 py-0.5 sm:px-2 sm:py-1 text-xs sm:text-sm font-semibold rounded-full ${Y.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[c.jsx("span",{className:"sm:hidden",children:Y.is_active?"A":"I"}),c.jsx("span",{className:"hidden sm:inline",children:Y.is_active?"Active":"Inactive"})]})})}),c.jsx("td",{className:"px-1 py-1 sm:px-1 sm:py-3 text-xs sm:text-base text-gray-500",children:c.jsxs("div",{className:"flex space-x-1 sm:space-x-2 sm:justify-start",children:[c.jsxs("button",{type:"button",onClick:pe=>{pe.stopPropagation(),z(Y,!Y.is_active)},className:`text-xs px-1 py-0.5 sm:px-2 sm:py-1 rounded transition-colors ${Y.is_active?"text-red-600 hover:text-red-800 hover:bg-red-50":"text-green-600 hover:text-green-800 hover:bg-green-50"}`,children:[c.jsx("span",{className:"sm:hidden",children:Y.is_active?"Deac":"React"}),c.jsx("span",{className:"hidden sm:inline",children:Y.is_active?"Deactivate":"Reactivate"})]}),Y.is_active&&c.jsxs("button",{type:"button",onClick:pe=>{pe.preventDefault(),pe.stopPropagation(),je(Y)},className:"text-red-600 hover:text-red-800 text-xs px-1 py-0.5 sm:px-2 sm:py-1 rounded hover:bg-red-50",children:[c.jsx("span",{className:"sm:hidden",children:"Del"}),c.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})})]},Y.id))})]})]}),l==="packages"&&c.jsx(C$,{}),(l==="active"||l==="inactive")&&c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mt-4 sm:mt-6 gap-2 sm:gap-0",children:[c.jsxs("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(p.page-1)*p.limit+1," to ",Math.min(p.page*p.limit,p.total||0)," of ",p.total||0," students"]}),c.jsxs("div",{className:"flex space-x-2 justify-center sm:justify-end",children:[c.jsx("button",{onClick:()=>m(Y=>({...Y,page:Math.max(1,Y.page-1)})),disabled:p.page===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),c.jsx("button",{onClick:()=>m(Y=>({...Y,page:Y.page+1})),disabled:p.page*p.limit>=p.total,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]}),g&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Student"}),c.jsx("div",{className:"space-y-4",children:c.jsx("input",{type:"text",placeholder:"Student Name",value:b.name,onChange:Y=>v(pe=>({...pe,name:Y.target.value})),disabled:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>y(!1),disabled:x,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:G,disabled:x||!b.name.trim(),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[120px]",children:x?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):"Add Student"})]})]})}),D&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[e==null?void 0:e.name," - Lesson Statistics"]}),c.jsx("button",{onClick:()=>F(!1),className:"text-gray-400 hover:text-gray-600",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"mb-4 text-sm text-gray-600",children:h.date_from&&h.date_to?`Period: ${h.date_from} to ${h.date_to}`:"All time statistics"}),ee?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):q?c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"p-4 bg-green-50 rounded-lg text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-green-600",children:q.completed||0}),c.jsx("div",{className:"text-sm text-green-700",children:"Completed"})]}),c.jsxs("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-red-600",children:q.absent||0}),c.jsx("div",{className:"text-sm text-red-700",children:"I"})]}),c.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:q.warned||0}),c.jsx("div",{className:"text-sm text-yellow-700",children:"UI"})]}),c.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q.total||0}),c.jsx("div",{className:"text-sm text-blue-700",children:"Total"})]})]}):c.jsx("div",{className:"text-center py-8 text-gray-500",children:"No statistics available for this student."}),c.jsx("div",{className:"flex justify-end mt-6",children:c.jsx("button",{onClick:()=>F(!1),className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200",children:"Close"})})]})})}),ge&&B&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Status Change"}),c.jsx("button",{onClick:()=>Ce(!1),className:"text-gray-400 hover:text-gray-600",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("p",{className:"text-gray-600 mb-4",children:["Are you sure you want to ",B.newStatus?"reactivate":"deactivate"," student"," ",c.jsx("span",{className:"font-semibold",children:B.student.name}),"?"]}),B.newStatus&&c.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:c.jsxs("p",{className:"text-green-800 text-sm",children:[c.jsx("strong",{children:"Note:"})," Student will be reactivated without a teacher assignment. You can assign a teacher later."]})}),!B.newStatus&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:c.jsxs("p",{className:"text-red-800 text-sm",children:[c.jsx("strong",{children:"Warning:"})," Deactivating will remove the student from their current teacher and all active schedules."]})})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{onClick:()=>Ce(!1),className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg transition-colors duration-200",children:"Cancel"}),c.jsx("button",{onClick:te,className:`px-4 py-2 rounded-lg transition-colors duration-200 ${B.newStatus?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:B.newStatus?"Reactivate":"Deactivate"})]})]})})}),c.jsx(ka,{isOpen:xe&&!!Se,onClose:()=>Re(!1),title:" Permanent Deletion",confirmText:"Delete Permanently",cancelText:"Cancel",onConfirm:Je,loading:lt,loadingText:"Deleting...",confirmButtonColor:"bg-red-500 hover:bg-red-600",disabled:lt,children:Se&&c.jsxs("div",{className:"mb-2",children:[c.jsxs("p",{className:"text-gray-600 mb-4",children:["Are you sure you want to ",c.jsx("strong",{children:"permanently delete"})," student"," ",c.jsx("span",{className:"font-semibold text-red-600",children:Se.name}),"?"]}),c.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[c.jsx("p",{className:"text-red-800 text-sm font-semibold mb-2",children:"This action will permanently delete:"}),c.jsxs("ul",{className:"text-red-700 text-sm space-y-1",children:[c.jsx("li",{children:" Student record and all personal data"}),c.jsx("li",{children:" All lesson reports and attendance data"}),c.jsx("li",{children:" All schedules (past and future)"}),c.jsx("li",{children:" All lesson tracking records"}),c.jsx("li",{children:" All schedule templates"})]}),c.jsx("p",{className:"text-red-800 text-sm font-semibold mt-2",children:"This action cannot be undone!"})]})]})}),c.jsx(mh,{isVisible:$e,onClose:()=>ie(!1),title:U.title,message:U.message,type:U.type,duration:4e3}),c.jsx(E$,{student:M,isOpen:j,onClose:be,assignedTeachers:L,loading:$})]})},ry=({onUpload:s,onError:e,folder:t="lang-school",maxSize:n=5*1024*1024,acceptedTypes:r=["image/jpeg","image/png","image/webp"],transformations:i=null,className:a="",showUploadArea:o=!0,uploadedImageUrl:l=null})=>{const[u,h]=_.useState(!1),[f,p]=_.useState(null),[m,g]=_.useState(!1),[y,b]=_.useState(l),[v,x]=_.useState(!1),w=_.useRef(null);_.useEffect(()=>{b(l)},[l]),_.useEffect(()=>{l!==y&&b(l)},[l,y]);const E=async L=>{if(!L)return;if(!r.includes(L.type)){e==null||e("Invalid file type. Please select a JPEG, PNG, or WebP image.");return}if(L.size>n){e==null||e(`File too large. Maximum size is ${Math.round(n/1024/1024)}MB.`);return}const I=new FileReader;I.onload=O=>p(O.target.result),I.readAsDataURL(L);try{h(!0);const O=await T(L),X=await se.uploadImage(O,t,null,i);if(X.success){const $=X.secure_url||X.data,H=X.public_id;b($),s==null||s($,H),p(null)}else e==null||e(X.error||"Upload failed")}catch(O){console.error("Upload error:",O),e==null||e("Upload failed. Please try again.")}finally{h(!1)}},T=L=>new Promise((I,O)=>{const X=new FileReader;X.readAsDataURL(L),X.onload=()=>I(X.result),X.onerror=$=>O($)}),C=L=>{if(!L)return null;try{const I=L.split("/");return I[I.length-1].split(".")[0]}catch(I){return console.error("Error extracting public ID from URL:",I),null}},N=async L=>{if(L.preventDefault(),L.stopPropagation(),!y){e==null||e("No image to delete");return}if(window.confirm("Are you sure you want to delete this image?")){x(!0);try{const I=C(y);if(I){const O=await se.deleteImage(I);if(!O.success){e==null||e(O.error||"Failed to delete image from Cloudinary");return}}b(null),s==null||s(""),alert("Image deleted successfully!")}catch(I){console.error("Delete error:",I),e==null||e("Failed to delete image. Please try again.")}finally{x(!1)}}},j=L=>{L.preventDefault(),L.stopPropagation(),L.type==="dragenter"||L.type==="dragover"?g(!0):L.type==="dragleave"&&g(!1)},P=L=>{L.preventDefault(),L.stopPropagation(),g(!1),L.dataTransfer.files&&L.dataTransfer.files[0]&&E(L.dataTransfer.files[0])},M=()=>{var L;(L=w.current)==null||L.click()},V=L=>{L.target.files&&L.target.files[0]&&E(L.target.files[0])};return c.jsxs("div",{className:`relative ${a}`,children:[y&&y!==""&&y!==null&&y!==void 0&&y.startsWith("http")&&c.jsx("div",{className:"mb-4 flex justify-center",children:c.jsxs("div",{className:"relative",children:[c.jsx("img",{src:y,alt:"Course background image",className:"w-full h-64 object-cover rounded-lg shadow-md"}),c.jsx("button",{type:"button",onClick:N,disabled:v,className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-200",children:v?"Deleting...":"Delete"})]})}),o&&(!y||y===""||y===null||y===void 0||y&&!y.startsWith("http"))&&c.jsxs(Q.div,{className:`
            border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-all duration-200
            ${m?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-400 hover:bg-gray-50"}
            ${u?"pointer-events-none opacity-50":""}
          `,onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:P,onClick:M,whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx("input",{ref:w,type:"file",accept:r.join(","),onChange:V,className:"hidden"}),u?c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Uploading..."})]}):f?c.jsxs("div",{className:"space-y-2",children:[c.jsx("img",{src:f,alt:"Preview",className:"max-h-32 mx-auto rounded-lg"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Processing..."})]}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"w-12 h-12 mx-auto bg-gray-100 rounded-full flex items-center justify-center",children:c.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Click to upload or drag and drop"}),c.jsxs("p",{className:"text-xs text-gray-500",children:["PNG, JPG, WebP up to ",Math.round(n/1024/1024),"MB"]})]})]})]})]})},j$=({onTeacherSelect:s,selectedTeacher:e})=>{const[t,n]=_.useState([]),[r,i]=_.useState([]),[a,o]=_.useState(!0),[l,u]=_.useState("active"),[h,f]=_.useState(!1),[p,m]=_.useState(!1),[g,y]=_.useState(!1),[b,v]=_.useState(!1),[x,w]=_.useState(null),[E,T]=_.useState({name:"",username:"",password:"",description:"",photo_url:"",meeting_id:"",meeting_password:""}),[C,N]=_.useState(!1),[j,P]=_.useState(null),[M,V]=_.useState(!1),[L,I]=_.useState(null),[O,X]=_.useState(!1),[$,H]=_.useState(!1),[D,F]=_.useState({title:"",message:"",type:"success"}),[q,J]=_.useState(!1),[ee,de]=_.useState(!1);_.useEffect(()=>{l==="active"?ge():l==="inactive"&&Ce()},[l]),_.useEffect(()=>{(async()=>{await Promise.all([ge(),Ce()])})()},[]);const ge=async()=>{try{o(!0);const U=await se.getTeachers({status:"active"});U.success&&n(U.teachers)}catch(U){console.error("Error fetching teachers:",U)}finally{o(!1)}},Ce=async()=>{try{o(!0);const U=await se.getTeachers({status:"inactive"});U.success&&i(U.teachers)}catch(U){console.error("Error fetching inactive teachers:",U)}finally{o(!1)}},B=(U,oe,Ue="success")=>{F({title:U,message:oe,type:Ue}),H(!0)},K=async()=>{try{if(!E.name||!E.username||!E.password){B("Validation Error","Please fill in all required fields","error");return}J(!0),(await se.createTeacher({name:E.name,username:E.username,password:E.password,description:E.description,photo_url:E.photo_url,meeting_id:E.meeting_id,meeting_password:E.meeting_password})).success&&(T({name:"",username:"",password:"",description:"",photo_url:"",meeting_id:"",meeting_password:""}),f(!1),ge(),B("Success!","Teacher added successfully","success"))}catch(U){console.error("Error adding teacher:",U),B("Error","Failed to add teacher","error")}finally{J(!1)}},xe=async()=>{try{if(!x.name){B("Validation Error","Please fill in all required fields","error");return}de(!0),(await se.updateTeacher(x.id,{name:x.name,description:x.description,photo_url:x.photo_url,meeting_id:x.meeting_id,meeting_password:x.meeting_password})).success&&(w(null),m(!1),await ge(),B("Success!","Teacher updated successfully","success"))}catch(U){console.error("Error updating teacher:",U),B("Error","Failed to update teacher","error")}finally{de(!1)}},Re=(U,oe)=>{P({teacher:U,newStatus:oe}),N(!0)},Se=async()=>{try{const{teacher:U,newStatus:oe}=j;oe===!1?(await se.deactivateTeacher(U.id)).success&&(await Promise.all([ge(),Ce()]),B("Success!","Teacher deactivated successfully - future schedules removed","success")):oe===!0&&(await se.reactivateTeacher(U.id)).success&&(await Promise.all([ge(),Ce()]),B("Success!","Teacher reactivated successfully","success")),N(!1),P(null)}catch(U){console.error("Error updating teacher status:",U),B("Error","Error updating teacher status","error")}},Ze=U=>{I(U),V(!0)},lt=async()=>{try{X(!0),(await se.deleteTeacher(L.id)).success&&(await Promise.all([ge(),Ce()]),B("Success!","Teacher deleted successfully - all data removed","success")),V(!1),I(null)}catch(U){console.error("Error deleting teacher:",U),B("Error","Error deleting teacher","error")}finally{X(!1)}},Ae=async(U,oe)=>{try{(await se.changeTeacherPassword(U,oe)).success&&(B("Success!","Password changed successfully","success"),y(!1))}catch(Ue){console.error("Error changing password:",Ue),B("Error","Failed to change password","error")}},$e=U=>{w({...U}),m(!0)},ie=U=>{w(U),v(!0)};return c.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0 mb-6",children:[c.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-gray-800 text-center sm:text-left",children:"Teacher Management"}),c.jsx("button",{onClick:()=>f(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-3 sm:px-4 py-1.5 sm:py-2 rounded text-sm sm:text-base transition-colors duration-200",children:"Add New Teacher"})]}),c.jsxs("div",{className:"flex space-x-1 mb-6",children:[c.jsxs("button",{onClick:()=>u("active"),className:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${l==="active"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Active Teachers (",t.length,")"]}),c.jsx("button",{onClick:()=>u("idpass"),className:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${l==="idpass"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ID/Pass"}),c.jsxs("button",{onClick:()=>u("inactive"),className:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${l==="inactive"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Inactive Teachers (",r.length,")"]})]}),l==="idpass"?c.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"w-full",children:[c.jsx("thead",{className:"bg-gray-50",children:c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-semibold text-neutral-800",children:"Teacher"}),c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-semibold text-neutral-800",children:"Meeting ID"}),c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-semibold text-neutral-800",children:"Meeting Pass"})]})}),c.jsx("tbody",{children:a?c.jsx("tr",{children:c.jsx("td",{colSpan:"3",className:"px-4 py-8 text-center",children:c.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-500 mx-auto"})})}):t.length===0?c.jsx("tr",{children:c.jsx("td",{colSpan:"3",className:"px-4 py-8 text-center text-gray-500",children:"No teachers found"})}):t.map(U=>c.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:U.photo_url?c.jsx("img",{src:U.photo_url,alt:U.name,className:"w-8 h-8 rounded-full object-cover"}):c.jsx("span",{className:"text-primary-600 font-semibold text-sm",children:U.name.charAt(0)})}),c.jsx("span",{className:"text-2xs sm:text-xs md:text-sm font-medium text-neutral-800 truncate",children:U.name})]})}),c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2",children:c.jsx("span",{className:"text-2xs sm:text-xs md:text-sm text-neutral-600",children:U.meeting_id||"-"})}),c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2",children:c.jsx("span",{className:"text-2xs sm:text-xs md:text-sm text-neutral-600",children:U.meeting_password||"-"})})]},U.id))})]})})}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a?c.jsx("div",{className:"col-span-full flex justify-center py-8",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):(l==="active"?t:r).length===0?c.jsxs("div",{className:"col-span-full text-center text-gray-500 py-8",children:["No ",l," teachers found"]}):(l==="active"?t:r).map(U=>c.jsxs(Q.div,{className:`border rounded-lg p-4 cursor-pointer transition-all duration-200 ${(e==null?void 0:e.id)===U.id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-primary-300 hover:shadow-md"}`,onClick:()=>s(U),whileHover:{scale:1.02},transition:{duration:.2},children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[c.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:U.photo_url?c.jsx("img",{src:U.photo_url,alt:U.name,className:"w-12 h-12 rounded-full object-cover"}):c.jsx("span",{className:"text-primary-600 font-semibold text-lg",children:U.name.charAt(0)})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:U.name}),c.jsx("p",{className:"text-sm text-gray-500 truncate",children:U.meeting_id||"No Meeting ID"})]})]}),U.description&&c.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:U.description}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${U.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:U.is_active?"Active":"Inactive"}),c.jsx("button",{onClick:oe=>{oe.stopPropagation(),Re(U,!U.is_active)},className:`text-xs px-2 py-1 rounded transition-colors ${U.is_active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:U.is_active?"Deactivate":"Reactivate"})]}),c.jsxs("div",{className:"flex space-x-1",children:[c.jsx("button",{onClick:oe=>{oe.stopPropagation(),$e(U)},className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50",children:"Edit"}),c.jsx("button",{onClick:oe=>{oe.stopPropagation(),ie(U)},className:"text-yellow-600 hover:text-yellow-800 text-xs px-2 py-1 rounded hover:bg-yellow-50",children:"Password"}),U.is_active&&c.jsx("button",{onClick:oe=>{oe.stopPropagation(),Ze(U)},className:"text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded hover:bg-red-50",children:"Delete"})]})]})]},U.id))}),h&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Teacher"}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"Teacher Name *",value:E.name,onChange:U=>T(oe=>({...oe,name:U.target.value})),disabled:q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"text",placeholder:"Meeting ID",value:E.meeting_id,onChange:U=>T(oe=>({...oe,meeting_id:U.target.value})),disabled:q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"text",placeholder:"Meeting Password",value:E.meeting_password,onChange:U=>T(oe=>({...oe,meeting_password:U.target.value})),disabled:q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"text",placeholder:"Username *",value:E.username,onChange:U=>T(oe=>({...oe,username:U.target.value})),disabled:q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"password",placeholder:"Password *",value:E.password,onChange:U=>T(oe=>({...oe,password:U.target.value})),disabled:q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("textarea",{placeholder:"Description",value:E.description,onChange:U=>T(oe=>({...oe,description:U.target.value})),rows:3,disabled:q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Teacher Photo"}),c.jsx("div",{className:q?"pointer-events-none opacity-50":"",children:c.jsx(ry,{onUpload:U=>T(oe=>({...oe,photo_url:U})),onError:U=>console.error("Upload error:",U),folder:"lang-school/teachers",className:"w-full",uploadedImageUrl:E.photo_url,showUploadArea:!E.photo_url})})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>f(!1),disabled:q,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:K,disabled:q||!E.name.trim()||!E.username.trim()||!E.password.trim(),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[140px]",children:q?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):"Add Teacher"})]})]})}),p&&x&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Teacher"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),c.jsx("input",{type:"text",placeholder:"Teacher Name *",value:x.name,onChange:U=>w(oe=>({...oe,name:U.target.value})),disabled:ee,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meeting ID"}),c.jsx("input",{type:"text",placeholder:"Meeting ID",value:x.meeting_id||"",onChange:U=>w(oe=>({...oe,meeting_id:U.target.value})),disabled:ee,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meeting Password"}),c.jsx("input",{type:"text",placeholder:"Meeting Password",value:x.meeting_password||"",onChange:U=>w(oe=>({...oe,meeting_password:U.target.value})),disabled:ee,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),c.jsx("textarea",{placeholder:"Description",value:x.description||"",onChange:U=>w(oe=>({...oe,description:U.target.value})),rows:3,disabled:ee,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Teacher Photo"}),c.jsx("div",{className:ee?"pointer-events-none opacity-50":"",children:c.jsx(ry,{onUpload:U=>w(oe=>({...oe,photo_url:U})),onError:U=>console.error("Upload error:",U),folder:"lang-school/teachers",className:"w-full",uploadedImageUrl:x.photo_url,showUploadArea:!0})}),x.photo_url&&c.jsx("p",{className:"text-sm text-neutral-600 mt-2",children:"Click above to upload a new photo"})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>m(!1),disabled:ee,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:xe,disabled:ee||!x.name.trim(),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[140px]",children:ee?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):"Update Teacher"})]})]})}),b&&x&&c.jsx(R$,{teacher:x,onClose:()=>v(!1),onEditPassword:()=>{v(!1),y(!0)}}),g&&x&&c.jsx(P$,{teacher:x,onClose:()=>y(!1),onChangePassword:Ae}),C&&j&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Status Change"}),c.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("p",{className:"text-gray-600 mb-4",children:["Are you sure you want to ",j.newStatus?"reactivate":"deactivate"," teacher"," ",c.jsx("span",{className:"font-semibold",children:j.teacher.name}),"?"]}),!j.newStatus&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:c.jsxs("p",{className:"text-red-800 text-sm",children:[c.jsx("strong",{children:"Warning:"})," Deactivating will unassign all students from this teacher and make them unavailable for new student assignments. Students will become unassigned but remain active."]})})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg transition-colors duration-200",children:"Cancel"}),c.jsx("button",{onClick:Se,className:`px-4 py-2 rounded-lg transition-colors duration-200 ${j.newStatus?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:j.newStatus?"Reactivate":"Deactivate"})]})]})})}),c.jsx(ka,{isOpen:M&&!!L,onClose:()=>V(!1),title:" Permanent Deletion",confirmText:"Delete Permanently",cancelText:"Cancel",onConfirm:lt,loading:O,loadingText:"Deleting...",confirmButtonColor:"bg-red-500 hover:bg-red-600",disabled:O,children:L&&c.jsxs("div",{className:"mb-2",children:[c.jsxs("p",{className:"text-gray-600 mb-4",children:["Are you sure you want to ",c.jsx("strong",{children:"permanently delete"})," teacher"," ",c.jsx("span",{className:"font-semibold text-red-600",children:L.name}),"?"]}),c.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[c.jsx("p",{className:"text-red-800 text-sm font-semibold mb-2",children:"This action will permanently delete:"}),c.jsxs("ul",{className:"text-red-700 text-sm space-y-1",children:[c.jsx("li",{children:" Teacher record and user account"}),c.jsx("li",{children:" All lesson reports and attendance data"}),c.jsx("li",{children:" All schedules (past and future)"}),c.jsx("li",{children:" Schedule templates and history"}),c.jsx("li",{children:" Teacher photo from Cloudinary"})]}),c.jsx("p",{className:"text-red-800 text-sm font-semibold mt-2",children:"This action cannot be undone!"})]})]})}),c.jsx(mh,{isVisible:$,onClose:()=>H(!1),title:D.title,message:D.message,type:D.type,duration:4e3})]})},P$=({teacher:s,onClose:e,onChangePassword:t})=>{const[n,r]=_.useState(""),[i,a]=_.useState(""),[o,l]=_.useState(!1),u=h=>{if(h.preventDefault(),n!==i){alert("Passwords do not match");return}if(n.length<6){alert("Password must be at least 6 characters long");return}t(s.id,n)};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Change Password for ",s.name]}),c.jsxs("form",{onSubmit:u,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:o?"text":"password",value:n,onChange:h=>r(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent pr-10",required:!0}),c.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:o?"":""})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),c.jsx("input",{type:"password",value:i,onChange:h=>a(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:"Change Password"})]})]})]})})},R$=({teacher:s,onClose:e,onEditPassword:t})=>{const[n,r]=_.useState(""),[i,a]=_.useState(!1),[o,l]=_.useState(""),[u,h]=_.useState(!1);_.useEffect(()=>{s?(r(""),l(""),h(!1),a(!1),f()):(r(""),l(""),h(!1),a(!1))},[s]);const f=async()=>{try{a(!0),l("");const m=await se.getTeacherPassword(s.id);m.success?r(m.password_info.password):l(m.error||"Failed to fetch password")}catch(m){console.error("Error fetching password:",m),l("Failed to fetch password")}finally{a(!1)}},p=async()=>{try{await navigator.clipboard.writeText(n)}catch(m){console.error("Failed to copy password:",m)}};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Current Password - ",s.name]}),i&&c.jsxs("div",{className:"text-center py-4",children:[c.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary-500"}),c.jsx("p",{className:"mt-2 text-gray-600",children:"Loading password..."})]}),o&&c.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-4",children:o}),!i&&!o&&n&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:u?"text":"password",value:n,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"}),c.jsx("button",{type:"button",onClick:()=>h(!u),className:"px-3 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:u?"Hide":"Show"}),c.jsx("button",{type:"button",onClick:p,className:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm",children:"Copy"})]})]}),c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:c.jsxs("p",{className:"text-yellow-800 text-sm",children:[c.jsx("strong",{children:"Note:"}),` This is the teacher's current password. Click "Change Password" below to set a new one.`]})})]}),c.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Close"}),c.jsx("button",{onClick:t,className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg",children:"Change Password"})]})]})})},L$=()=>{var ge,Ce;const[s,e]=_.useState("mission"),[t,n]=_.useState({title:"",content:"",banner_image:"",banner_image_public_id:""}),[r,i]=_.useState([]),[a,o]=_.useState({display_count:3,rotation_type:"random"}),[l,u]=_.useState([]),[h,f]=_.useState([]),[p,m]=_.useState(!0),[g,y]=_.useState(!1),[b,v]=_.useState(null),[x,w]=_.useState({name:"",description:"",detailed_description:"",background_image:"",background_image_public_id:"",display_order:0}),[E,T]=_.useState(!1),[C,N]=_.useState(!1),[j,P]=_.useState(!1),[M,V]=_.useState({title:"",message:"",type:"success"});_.useEffect(()=>{I()},[]);const L=(B,K,xe="success")=>{V({title:B,message:K,type:xe}),P(!0)},I=async()=>{try{m(!0);const[B,K,xe,Re]=await Promise.all([se.getMissionContent(),se.getCourses(),se.getShowcaseSettings(),se.getTeachers()]);B.success&&n(B.mission),K.success&&i(K.courses),xe.success&&o(xe.settings),Re.success&&u(Re.teachers)}catch(B){console.error("Error fetching content:",B)}finally{m(!1)}},O=async()=>{try{T(!0),(await se.updateMissionContent(t)).success&&L("Success!","Mission content saved successfully","success")}catch(B){console.error("Error saving mission content:",B),L("Error","Failed to save mission content","error")}finally{T(!1)}},X=async()=>{try{console.log("Saving showcase settings:",a),console.log("Selected teachers:",h);const B=await se.updateShowcaseSettings(a);if(console.log("Showcase settings response:",B),B.success)if(a.rotation_type==="featured")if(h.length>0){console.log("Saving featured teachers:",h);try{const K=await se.setFeaturedTeachers(h);console.log("Featured teachers response:",K),K&&K.success?alert("Showcase settings and featured teachers saved successfully"):(console.error("Featured teachers API failed:",K),alert(`Showcase settings saved, but failed to save featured teachers: ${(K==null?void 0:K.error)||"Unknown error"}`))}catch(K){console.error("Featured teachers API error:",K),alert(`Showcase settings saved, but failed to save featured teachers: ${K.message}`)}}else{alert("Please select at least one teacher for featured teachers mode");return}else alert("Showcase settings saved successfully");else alert("Failed to save showcase settings")}catch(B){console.error("Error saving showcase settings:",B),alert("Failed to save showcase settings")}},$=(B,K)=>{n(xe=>({...xe,banner_image:B,banner_image_public_id:K}))},H=(B,K)=>{b?v(xe=>({...xe,background_image:B,background_image_public_id:K})):w(xe=>({...xe,background_image:B,background_image_public_id:K}))},D=async()=>{try{if(!x.name||!x.description){alert("Please fill in required fields");return}N(!0),(await se.createCourse(x)).success&&(w({name:"",description:"",detailed_description:"",background_image:"",background_image_public_id:"",display_order:r.length+1}),y(!1),I(),L("Success!","Course added successfully","success"))}catch(B){console.error("Error adding course:",B),L("Error","Failed to add course","error")}finally{N(!1)}},F=async()=>{try{if(!b.name||!b.description){alert("Please fill in required fields");return}N(!0),(await se.updateCourse(b.id,b)).success&&(v(null),y(!1),I(),L("Success!","Course updated successfully","success"))}catch(B){console.error("Error updating course:",B),L("Error","Failed to update course","error")}finally{N(!1)}},q=async B=>{if(window.confirm("Are you sure you want to delete this course?"))try{(await se.deleteCourse(B)).success&&(I(),L("Success!","Course deleted successfully","success"))}catch(K){console.error("Error deleting course:",K),L("Error","Failed to delete course","error")}},J=async(B,K)=>{try{(await se.toggleCourse(B,K)).success&&I()}catch(xe){console.error("Error toggling course:",xe),L("Error","Failed to toggle course","error")}},ee=B=>{v({...B}),y(!0)},de=()=>{v(null),w({name:"",description:"",detailed_description:"",background_image:"",background_image_public_id:"",display_order:r.length+1}),y(!0)};return p?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 sm:p-6",children:[c.jsx("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:c.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800",children:"Content Management"})}),c.jsx("div",{className:"flex space-x-1 mb-6 overflow-x-auto",children:[{id:"mission",label:"Mission Content"},{id:"courses",label:"Courses"},{id:"showcase",label:"Teacher Showcase"}].map(B=>c.jsx("button",{type:"button",onClick:()=>e(B.id),className:`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors duration-200 text-xs sm:text-sm whitespace-nowrap flex-shrink-0 ${s===B.id?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:B.label},B.id))}),s==="mission"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mission Title"}),c.jsx("input",{type:"text",value:t.title,onChange:B=>n(K=>({...K,title:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mission Content"}),c.jsx("textarea",{value:t.content,onChange:B=>n(K=>({...K,content:B.target.value})),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Banner Image"}),c.jsx(ry,{onUpload:(B,K)=>{if(console.log(" [CONTENT] Image upload callback",{url:B,publicId:K,currentBanner:t.banner_image}),$(B,K),B){const xe={...t,banner_image:B,banner_image_public_id:K};console.log(" [CONTENT] Updating mission content with new image",xe),se.updateMissionContent(xe).then(Re=>{console.log(" [CONTENT] Mission content updated successfully",Re),n(xe)}).catch(Re=>{console.error(" [CONTENT] Error updating mission content:",Re),alert("Failed to save image")})}else{const xe={...t,banner_image:"",banner_image_public_id:null};console.log(" [CONTENT] Clearing mission image",xe),se.updateMissionContent(xe).then(()=>{n(xe)}).catch(Re=>{console.error("Error deleting image:",Re),alert("Failed to delete image")})}},onError:B=>console.error("Mission image error:",B),folder:"lang-school/banners",transformations:[{width:1200,height:400,crop:"fill"}],uploadedImageUrl:t.banner_image,showUploadArea:!0,className:"mb-4"})]}),c.jsx("button",{type:"button",onClick:O,disabled:E,className:"w-full sm:w-auto bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-4 sm:px-6 py-2 sm:py-2 rounded-lg transition-colors duration-200 text-sm sm:text-base flex items-center justify-center min-w-[180px]",children:E?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Mission Content"})]}),s==="courses"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0",children:[c.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"Course Management"}),c.jsx("button",{type:"button",onClick:de,disabled:C,className:"w-full sm:w-auto bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg transition-colors duration-200 text-sm sm:text-base",children:"Add New Course"})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(B=>c.jsxs(Q.div,{className:"border rounded-lg p-4 hover:shadow-md transition-shadow duration-200",whileHover:{scale:1.02},children:[c.jsx("div",{className:"aspect-video bg-gray-200 rounded-lg mb-3 overflow-hidden",children:B.background_image&&B.background_image.startsWith("http")?c.jsx("img",{src:B.background_image,alt:B.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"})}),c.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:B.name}),c.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:B.description}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${B.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:B.is_active?"Active":"Inactive"}),c.jsxs("div",{className:"flex space-x-1",children:[c.jsx("button",{type:"button",onClick:()=>ee(B),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50",children:"Edit"}),c.jsx("button",{type:"button",onClick:()=>J(B.id,!B.is_active),className:`text-xs px-2 py-1 rounded hover:bg-gray-50 ${B.is_active?"text-red-600 hover:text-red-800":"text-green-600 hover:text-green-800"}`,children:B.is_active?"Deactivate":"Activate"}),c.jsx("button",{type:"button",onClick:()=>q(B.id),className:"text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded hover:bg-red-50",children:"Delete"})]})]})]},B.id))})]}),s==="showcase"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Teachers to Display"}),c.jsx("input",{type:"number",min:"1",max:"10",value:a.display_count,onChange:B=>o(K=>({...K,display_count:parseInt(B.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rotation Type"}),c.jsxs("select",{value:a.rotation_type,onChange:B=>o(K=>({...K,rotation_type:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[c.jsx("option",{value:"random",children:"Random Selection"}),c.jsx("option",{value:"featured",children:"Featured Teachers Only"}),c.jsx("option",{value:"alphabetical",children:"Alphabetical Order"})]})]}),a.rotation_type==="featured"&&c.jsx("div",{className:"mt-8",children:c.jsx(M2,{teachers:l,showSelection:!0,selectedTeachers:h,onSelectionChange:f,title:"Select Featured Teachers",subtitle:"Choose which teachers to feature on the login page",displayCount:a.display_count})}),c.jsx("button",{type:"button",onClick:X,className:"w-full sm:w-auto bg-primary-500 hover:bg-primary-600 text-white px-4 sm:px-6 py-2 rounded-lg transition-colors duration-200 text-sm sm:text-base",children:"Save Showcase Settings"})]}),g&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:b?"Edit Course":"Add New Course"}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"Course Name *",value:b?b.name:x.name,onChange:B=>{b?v(K=>({...K,name:B.target.value})):w(K=>({...K,name:B.target.value}))},disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("textarea",{placeholder:"Short Description *",value:b?b.description:x.description,onChange:B=>{b?v(K=>({...K,description:B.target.value})):w(K=>({...K,description:B.target.value}))},rows:3,disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("textarea",{placeholder:"Detailed Description (for popup)",value:b?b.detailed_description:x.detailed_description,onChange:B=>{b?v(K=>({...K,detailed_description:B.target.value})):w(K=>({...K,detailed_description:B.target.value}))},rows:4,disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Background Image"}),c.jsx("div",{className:C?"pointer-events-none opacity-50":"",children:c.jsx(ry,{onUpload:(B,K)=>H(B,K),onError:B=>console.error("Course image error:",B),folder:"lang-school/courses",transformations:[{width:800,height:600,crop:"fill"}],uploadedImageUrl:b?b.background_image:x.background_image,showUploadArea:!0})})]}),c.jsx("input",{type:"number",placeholder:"Display Order",value:b?b.display_order:x.display_order,onChange:B=>{b?v(K=>({...K,display_order:parseInt(B.target.value)})):w(K=>({...K,display_order:parseInt(B.target.value)}))},disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>y(!1),disabled:C,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{type:"button",onClick:b?F:D,disabled:C||!((ge=b?b.name:x.name)!=null&&ge.trim())||!((Ce=b?b.description:x.description)!=null&&Ce.trim()),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[140px]",children:C?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),b?"Updating...":"Adding..."]}):b?"Update Course":"Add Course"})]})]})}),c.jsx(mh,{isOpen:j,onClose:()=>P(!1),title:M.title,message:M.message,type:M.type})]})},D$="modulepreload",M$=function(s){return"/"+s},IA={},Vm=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=M$(l),l in IA)return;IA[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":D$,u||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),u)return new Promise((p,m)=>{f.addEventListener("load",p),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},I$=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Vm(async()=>{const{default:n}=await Promise.resolve().then(()=>gh);return{default:n}},[]).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class R_ extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class OA extends R_{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class FA extends R_{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class $A extends R_{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Bw;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(Bw||(Bw={}));var O$=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};class F${constructor(e,{headers:t={},customFetch:n,region:r=Bw.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=I$(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return O$(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:a,signal:o}=t;let l={},{region:u}=t;u||(u=this.region);const h=new URL(`${this.url}/${e}`);u&&u!=="any"&&(l["x-region"]=u,h.searchParams.set("forceFunctionRegion",u));let f;a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",f=a):typeof a=="string"?(l["Content-Type"]="text/plain",f=a):typeof FormData<"u"&&a instanceof FormData?f=a:(l["Content-Type"]="application/json",f=JSON.stringify(a)));const p=yield this.fetch(h.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),r),body:f,signal:o}).catch(b=>{throw b.name==="AbortError"?b:new OA(b)}),m=p.headers.get("x-relay-error");if(m&&m==="true")throw new FA(p);if(!p.ok)throw new $A(p);let g=((n=p.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return g==="application/json"?y=yield p.json():g==="application/octet-stream"?y=yield p.blob():g==="text/event-stream"?y=p:g==="multipart/form-data"?y=yield p.formData():y=yield p.text(),{data:y,error:null,response:p}}catch(r){return r instanceof Error&&r.name==="AbortError"?{data:null,error:new OA(r)}:{data:null,error:r,response:r instanceof $A||r instanceof FA?r.context:void 0}}})}}var Sn={},L_={},cv={},zm={},uv={},dv={},$$=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},lh=$$();const U$=lh.fetch,V2=lh.fetch.bind(lh),z2=lh.Headers,B$=lh.Request,H$=lh.Response,gh=Object.freeze(Object.defineProperty({__proto__:null,Headers:z2,Request:B$,Response:H$,default:V2,fetch:U$},Symbol.toStringTag,{value:"Module"})),V$=nL(gh);var hv={};Object.defineProperty(hv,"__esModule",{value:!0});let z$=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};hv.default=z$;var W2=br&&br.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(dv,"__esModule",{value:!0});const W$=W2(V$),G$=W2(hv);let q$=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=W$.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let r=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,l,u;let h=null,f=null,p=null,m=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((a=this.headers.get("Accept"))===null||a===void 0)&&a.includes("application/vnd.pgrst.plan+text"))?f=x:f=JSON.parse(x))}const b=(o=this.headers.get("Prefer"))===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");b&&v&&v.length>1&&(p=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(h={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,p=null,m=406,g="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const b=await i.text();try{h=JSON.parse(b),Array.isArray(h)&&i.status===404&&(f=[],h=null,m=200,g="OK")}catch{i.status===404&&b===""?(m=204,g="No Content"):h={message:b}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,m=200,g="OK"),h&&this.shouldThrowOnError)throw new G$.default(h)}return{error:h,data:f,count:p,status:m,statusText:g}});return this.shouldThrowOnError||(r=r.catch(i=>{var a,o,l;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};dv.default=q$;var K$=br&&br.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(uv,"__esModule",{value:!0});const X$=K$(dv);let Y$=class extends X$.default{select(e){let t=!1;const n=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:i=r}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:r=n}={}){const i=typeof r>"u"?"offset":`${r}.offset`,a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:i=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${u}"; options=${l};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};uv.default=Y$;var J$=br&&br.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(zm,"__esModule",{value:!0});const Q$=J$(uv);let Z$=class extends Q$.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const a=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};zm.default=Z$;var e5=br&&br.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(cv,"__esModule",{value:!0});const jh=e5(zm);let t5=class{constructor(e,{headers:t={},schema:n,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=r}select(e,{head:t=!1,count:n}={}){const r=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),n&&this.headers.append("Prefer",`count=${n}`),new jh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:n=!0}={}){var r;const i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new jh.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:i=!0}={}){var a;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const l=e.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new jh.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}update(e,{count:t}={}){var n;const r="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new jh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:e}={}){var t;const n="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new jh.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};cv.default=t5;var G2=br&&br.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(L_,"__esModule",{value:!0});const s5=G2(cv),n5=G2(zm);let r5=class q2{constructor(e,{headers:t={},schema:n,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new s5.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new q2(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:r=!1,count:i}={}){var a;let o;const l=new URL(`${this.url}/rpc/${e}`);let u;n||r?(o=n?"HEAD":"GET",Object.entries(t).filter(([f,p])=>p!==void 0).map(([f,p])=>[f,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([f,p])=>{l.searchParams.append(f,p)})):(o="POST",u=t);const h=new Headers(this.headers);return i&&h.set("Prefer",`count=${i}`),new n5.default({method:o,url:l,headers:h,schema:this.schemaName,body:u,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};L_.default=r5;var yh=br&&br.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.PostgrestError=Sn.PostgrestBuilder=Sn.PostgrestTransformBuilder=Sn.PostgrestFilterBuilder=Sn.PostgrestQueryBuilder=Sn.PostgrestClient=void 0;const K2=yh(L_);Sn.PostgrestClient=K2.default;const X2=yh(cv);Sn.PostgrestQueryBuilder=X2.default;const Y2=yh(zm);Sn.PostgrestFilterBuilder=Y2.default;const J2=yh(uv);Sn.PostgrestTransformBuilder=J2.default;const Q2=yh(dv);Sn.PostgrestBuilder=Q2.default;const Z2=yh(hv);Sn.PostgrestError=Z2.default;var i5=Sn.default={PostgrestClient:K2.default,PostgrestQueryBuilder:X2.default,PostgrestFilterBuilder:Y2.default,PostgrestTransformBuilder:J2.default,PostgrestBuilder:Q2.default,PostgrestError:Z2.default};const{PostgrestClient:a5,PostgrestQueryBuilder:XH,PostgrestFilterBuilder:YH,PostgrestTransformBuilder:JH,PostgrestBuilder:QH,PostgrestError:ZH}=i5;class o5{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,r=parseInt(n.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const l5="2.15.5",c5=`realtime-js/${l5}`,u5="1.0.0",Hw=1e4,d5=1e3,h5=100;var _f;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(_f||(_f={}));var Qt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(Qt||(Qt={}));var qr;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(qr||(qr={}));var Vw;(function(s){s.websocket="websocket"})(Vw||(Vw={}));var wl;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(wl||(wl={}));class f5{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const r=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=n.decode(e.slice(a,a+r));a=a+r;const l=n.decode(e.slice(a,a+i));a=a+i;const u=JSON.parse(n.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:u}}}class ej{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ft;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(ft||(ft={}));const UA=(s,e,t={})=>{var n;const r=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,a)=>(i[a]=p5(a,s,e,r),i),{})},p5=(s,e,t,n)=>{const r=e.find(o=>o.name===s),i=r==null?void 0:r.type,a=t[s];return i&&!n.includes(i)?tj(i,a):zw(a)},tj=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return v5(e,t)}switch(s){case ft.bool:return m5(e);case ft.float4:case ft.float8:case ft.int2:case ft.int4:case ft.int8:case ft.numeric:case ft.oid:return g5(e);case ft.json:case ft.jsonb:return y5(e);case ft.timestamp:return x5(e);case ft.abstime:case ft.date:case ft.daterange:case ft.int4range:case ft.int8range:case ft.money:case ft.reltime:case ft.text:case ft.time:case ft.timestamptz:case ft.timetz:case ft.tsrange:case ft.tstzrange:return zw(e);default:return zw(e)}},zw=s=>s,m5=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},g5=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},y5=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},v5=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,n=s[t];if(s[0]==="{"&&n==="}"){let i;const a=s.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>tj(e,o))}return s},x5=s=>typeof s=="string"?s.replace(" ","T"):s,sj=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class gx{constructor(e,t,n={},r=Hw){this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var BA;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(BA||(BA={}));class Ef{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ef.syncState(this.state,r,i,a),this.pendingDiffs.forEach(l=>{this.state=Ef.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=Ef.syncDiff(this.state,r,i,a),o())}),this.onJoin((r,i,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:a})}),this.onLeave((r,i,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(u,h)=>{a[u]||(l[u]=h)}),this.map(a,(u,h)=>{const f=i[u];if(f){const p=h.map(b=>b.presence_ref),m=f.map(b=>b.presence_ref),g=h.filter(b=>m.indexOf(b.presence_ref)<0),y=f.filter(b=>p.indexOf(b.presence_ref)<0);g.length>0&&(o[u]=g),y.length>0&&(l[u]=y)}else o[u]=h}),this.syncDiff(i,{joins:o,leaves:l},n,r)}static syncDiff(e,t,n,r){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(i,(o,l)=>{var u;const h=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(l),h.length>0){const f=e[o].map(m=>m.presence_ref),p=h.filter(m=>f.indexOf(m.presence_ref)<0);e[o].unshift(...p)}n(o,h,l)}),this.map(a,(o,l)=>{let u=e[o];if(!u)return;const h=l.map(f=>f.presence_ref);u=u.filter(f=>h.indexOf(f.presence_ref)<0),e[o]=u,r(o,u,l),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return"metas"in r?t[n]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var HA;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(HA||(HA={}));var Af;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Af||(Af={}));var Ui;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Ui||(Ui={}));class D_{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Qt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new gx(this,qr.join,this.params,this.timeout),this.rejoinTimer=new ej(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Qt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Qt.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Qt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(qr.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new Ef(this),this.broadcastEndpointURL=sj(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Qt.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,u=(r=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&r!==void 0?r:[],h=!!this.bindings[Af.PRESENCE]&&this.bindings[Af.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},p={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:h}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(m=>e==null?void 0:e(Ui.CHANNEL_ERROR,m)),this._onClose(()=>e==null?void 0:e(Ui.CLOSED)),this.updateJoinPayload(Object.assign({config:p},f)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:m})=>{var g;if(this.socket.setAuth(),m===void 0){e==null||e(Ui.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,b=(g=y==null?void 0:y.length)!==null&&g!==void 0?g:0,v=[];for(let x=0;x<b;x++){const w=y[x],{filter:{event:E,schema:T,table:C,filter:N}}=w,j=m&&m[x];if(j&&j.event===E&&j.schema===T&&j.table===C&&j.filter===N)v.push(Object.assign(Object.assign({},w),{id:j.id}));else{this.unsubscribe(),this.state=Qt.errored,e==null||e(Ui.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(Ui.SUBSCRIBED);return}}).receive("error",m=>{this.state=Qt.errored,e==null||e(Ui.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ui.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Qt.joined&&e===Af.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((r=u.body)===null||r===void 0?void 0:r.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Qt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(qr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new gx(this,qr.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Qt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,i=setTimeout(()=>r.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),a}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new gx(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>h5){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:u,join:h}=qr;if(n&&[o,l,u,h].indexOf(a)>=0&&n!==this._joinRef())return;let p=this._onMessage(a,t,n);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(m=>{var g,y,b;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((b=(y=m.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===a}).map(m=>m.callback(p,n)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var g,y,b,v,x,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const E=m.id,T=(g=m.filter)===null||g===void 0?void 0:g.event;return E&&((y=t.ids)===null||y===void 0?void 0:y.includes(E))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const E=(x=(v=m==null?void 0:m.filter)===null||v===void 0?void 0:v.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return E==="*"||E===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof p=="object"&&"ids"in p){const g=p.data,{schema:y,table:b,commit_timestamp:v,type:x,errors:w}=g;p=Object.assign(Object.assign({},{schema:y,table:b,commit_timestamp:v,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(g))}m.callback(p,n)})}_isClosed(){return this.state===Qt.closed}_isJoined(){return this.state===Qt.joined}_isJoining(){return this.state===Qt.joining}_isLeaving(){return this.state===Qt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&D_.isEqual(r.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(qr.close,{},e)}_onError(e){this._on(qr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Qt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=UA(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=UA(e.columns,e.old_record)),t}}const yx=()=>{},Ag={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},w5=[1e3,2e3,5e3,1e4],b5=1e4,S5=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _5{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Hw,this.transport=null,this.heartbeatIntervalMs=Ag.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=yx,this.ref=0,this.reconnectTimer=null,this.logger=yx,this.conn=null,this.sendBuffer=[],this.serializer=new f5,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>{let i;return r?i=r:typeof fetch>"u"?i=(...a)=>Vm(async()=>{const{default:o}=await Promise.resolve().then(()=>gh);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...a)=>i(...a)},!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Vw.websocket}`,this.httpEndpoint=sj(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=o5.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:u5}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case _f.connecting:return wl.Connecting;case _f.open:return wl.Open;case _f.closing:return wl.Closing;default:return wl.Closed}}isConnected(){return this.connectionState()===wl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,r=this.getChannels().find(i=>i.topic===n);if(r)return r;{const i=new D_(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:r,ref:i}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${n} (${i})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(d5,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ag.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:r,payload:i,ref:a}=t,o=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${r} ${o}`.trim(),i),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(r,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(qr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${n}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([S5],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const r={access_token:t,version:c5};t&&n.updateJoinPayload(r),n.joinedOnce&&n._isJoined()&&n._push(qr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new ej(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ag.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,i,a,o,l,u,h;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:Hw,this.heartbeatIntervalMs=(r=e==null?void 0:e.heartbeatIntervalMs)!==null&&r!==void 0?r:Ag.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:yx,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:f=>w5[f-1]||b5,this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(f,p)=>p(JSON.stringify(f)),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class M_ extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Gt(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class E5 extends M_{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ww extends M_{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var A5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const nj=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Vm(async()=>{const{default:n}=await Promise.resolve().then(()=>gh);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},k5=()=>A5(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Vm(()=>Promise.resolve().then(()=>gh),void 0)).Response:Response}),Gw=s=>{if(Array.isArray(s))return s.map(t=>Gw(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,n])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=Gw(n)}),e},T5=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)};var Qc=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const vx=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),C5=(s,e,t)=>Qc(void 0,void 0,void 0,function*(){const n=yield k5();s instanceof n&&!(t!=null&&t.noResolveJson)?s.json().then(r=>{const i=s.status||500,a=(r==null?void 0:r.statusCode)||i+"";e(new E5(vx(r),i,a))}).catch(r=>{e(new Ww(vx(r),r))}):e(new Ww(vx(s),s))}),N5=(s,e,t,n)=>{const r={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||!n?r:(T5(n)?(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(n)):r.body=n,e!=null&&e.duplex&&(r.duplex=e.duplex),Object.assign(Object.assign({},r),t))};function Wm(s,e,t,n,r,i){return Qc(this,void 0,void 0,function*(){return new Promise((a,o)=>{s(t,N5(e,n,r,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>C5(l,o,n))})})}function iy(s,e,t,n){return Qc(this,void 0,void 0,function*(){return Wm(s,"GET",e,t,n)})}function ci(s,e,t,n,r){return Qc(this,void 0,void 0,function*(){return Wm(s,"POST",e,n,r,t)})}function qw(s,e,t,n,r){return Qc(this,void 0,void 0,function*(){return Wm(s,"PUT",e,n,r,t)})}function j5(s,e,t,n){return Qc(this,void 0,void 0,function*(){return Wm(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function rj(s,e,t,n,r){return Qc(this,void 0,void 0,function*(){return Wm(s,"DELETE",e,n,r,t)})}var P5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};class R5{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return P5(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Gt(e))return{data:null,error:e};throw e}})}}var L5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};class D5{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new R5(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return L5(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Gt(e))return{data:null,error:e};throw e}})}}var pn=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const M5={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},VA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class I5{constructor(e,t={},n,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=nj(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,r){return pn(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},VA),r);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),r!=null&&r.headers&&(o=Object.assign(Object.assign({},o),r.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),f=yield(e=="PUT"?qw:ci)(this.fetch,`${this.url}/object/${h}`,i,Object.assign({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gt(i))return{data:null,error:i};throw i}})}upload(e,t,n){return pn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,r){return pn(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:VA.upsert},r),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const f=yield qw(this.fetch,o.toString(),l,{headers:h});return{data:{path:i,fullPath:f.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Gt(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return pn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const r=Object.assign({},this.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const i=yield ci(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:r}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new M_("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Gt(n))return{data:null,error:n};throw n}})}update(e,t,n){return pn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return pn(this,void 0,void 0,function*(){try{return{data:yield ci(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Gt(r))return{data:null,error:r};throw r}})}copy(e,t,n){return pn(this,void 0,void 0,function*(){try{return{data:{path:(yield ci(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Gt(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,n){return pn(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield ci(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Gt(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,n){return pn(this,void 0,void 0,function*(){try{const r=yield ci(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Gt(r))return{data:null,error:r};throw r}})}download(e,t){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"",o=this._getFinalPath(e),l=()=>iy(this.fetch,`${this.url}/${r}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new D5(l,this.shouldThrowOnError)}info(e){return pn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield iy(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Gw(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Gt(n))return{data:null,error:n};throw n}})}exists(e){return pn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield j5(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Gt(n)&&n instanceof Ww){const r=n.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&r.push(l);let u=r.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${u}`)}}}remove(e){return pn(this,void 0,void 0,function*(){try{return{data:yield rj(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Gt(t))return{data:null,error:t};throw t}})}list(e,t,n){return pn(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},M5),t),{prefix:e||""});return{data:yield ci(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Gt(r))return{data:null,error:r};throw r}})}listV2(e,t){return pn(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield ci(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Gt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const O5="2.12.2",F5={"X-Client-Info":`storage-js/${O5}`};var iu=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,[])).next())})};class $5{constructor(e,t={},n,r){this.shouldThrowOnError=!1;const i=new URL(e);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},F5),t),this.fetch=nj(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return iu(this,void 0,void 0,function*(){try{return{data:yield iy(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Gt(e))return{data:null,error:e};throw e}})}getBucket(e){return iu(this,void 0,void 0,function*(){try{return{data:yield iy(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Gt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return iu(this,void 0,void 0,function*(){try{return{data:yield ci(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Gt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return iu(this,void 0,void 0,function*(){try{return{data:yield qw(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Gt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return iu(this,void 0,void 0,function*(){try{return{data:yield ci(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Gt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return iu(this,void 0,void 0,function*(){try{return{data:yield rj(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Gt(t))return{data:null,error:t};throw t}})}}class U5 extends $5{constructor(e,t={},n,r){super(e,t,n,r)}from(e){return new I5(this.url,this.headers,e,this.fetch)}}const B5="2.58.0";let Vh="";typeof Deno<"u"?Vh="deno":typeof document<"u"?Vh="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Vh="react-native":Vh="node";const H5={"X-Client-Info":`supabase-js-${Vh}/${B5}`},V5={headers:H5},z5={schema:"public"},W5={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},G5={};var q5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const K5=s=>{let e;return s?e=s:typeof fetch>"u"?e=V2:e=fetch,(...t)=>e(...t)},X5=()=>typeof Headers>"u"?z2:Headers,Y5=(s,e,t)=>{const n=K5(t),r=X5();return(i,a)=>q5(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:s;let u=new r(a==null?void 0:a.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},a),{headers:u}))})};var J5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,[])).next())})};function Q5(s){return s.endsWith("/")?s:s+"/"}function Z5(s,e){var t,n;const{db:r,auth:i,realtime:a,global:o}=s,{db:l,auth:u,realtime:h,global:f}=e,p={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},h),a),storage:{},global:Object.assign(Object.assign(Object.assign({},f),o),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>J5(this,void 0,void 0,function*(){return""})};return s.accessToken?p.accessToken=s.accessToken:delete p.accessToken,p}function eU(s){const e=s==null?void 0:s.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Q5(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const ij="2.72.0",uu=30*1e3,Kw=3,xx=Kw*uu,tU="http://localhost:9999",sU="supabase.auth.token",nU={"X-Client-Info":`gotrue-js/${ij}`},Xw="X-Supabase-Api-Version",aj={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},rU=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,iU=10*60*1e3;class I_ extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Me(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class aU extends I_{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function oU(s){return Me(s)&&s.name==="AuthApiError"}class oj extends I_{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class il extends I_{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class Ha extends il{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function lU(s){return Me(s)&&s.name==="AuthSessionMissingError"}class Ph extends il{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class kg extends il{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Tg extends il{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function cU(s){return Me(s)&&s.name==="AuthImplicitGrantRedirectError"}class zA extends il{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yw extends il{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function wx(s){return Me(s)&&s.name==="AuthRetryableFetchError"}class WA extends il{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Jw extends il{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ay="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),GA=` 	
\r=`.split(""),uU=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<GA.length;e+=1)s[GA[e].charCodeAt(0)]=-2;for(let e=0;e<ay.length;e+=1)s[ay[e].charCodeAt(0)]=e;return s})();function qA(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(ay[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(ay[n]),e.queuedBits-=6}}function lj(s,e,t){const n=uU[s];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function KA(s){const e=[],t=a=>{e.push(String.fromCodePoint(a))},n={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=a=>{fU(a,n,t)};for(let a=0;a<s.length;a+=1)lj(s.charCodeAt(a),r,i);return e.join("")}function dU(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function hU(s,e){for(let t=0;t<s.length;t+=1){let n=s.charCodeAt(t);if(n>55295&&n<=56319){const r=(n-55296)*1024&65535;n=(s.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}dU(n,e)}}function fU(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let n=1;n<6;n+=1)if(!(s>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function pU(s){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};for(let r=0;r<s.length;r+=1)lj(s.charCodeAt(r),t,n);return new Uint8Array(e)}function mU(s){const e=[];return hU(s,t=>e.push(t)),new Uint8Array(e)}function gU(s){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};return s.forEach(r=>qA(r,t,n)),qA(null,t,n),e.join("")}function yU(s){return Math.round(Date.now()/1e3)+s}function vU(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const ar=()=>typeof window<"u"&&typeof document<"u",ll={tested:!1,writable:!1},cj=()=>{if(!ar())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ll.tested)return ll.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),ll.tested=!0,ll.writable=!0}catch{ll.tested=!0,ll.writable=!1}return ll.writable};function xU(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((n,r)=>{e[r]=n}),e}const uj=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Vm(async()=>{const{default:n}=await Promise.resolve().then(()=>gh);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},wU=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",du=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},cl=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ua=async(s,e)=>{await s.removeItem(e)};class fv{constructor(){this.promise=new fv.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}fv.promiseConstructor=Promise;function bx(s){const e=s.split(".");if(e.length!==3)throw new Jw("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!rU.test(e[n]))throw new Jw("JWT not in base64url format");return{header:JSON.parse(KA(e[0])),payload:JSON.parse(KA(e[1])),signature:pU(e[2]),raw:{header:e[0],payload:e[1]}}}async function bU(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function SU(s,e){return new Promise((n,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await s(i);if(!e(i,null,a)){n(a);return}}catch(a){if(!e(i,a)){r(a);return}}})()})}function _U(s){return("0"+s.toString(16)).substr(-2)}function EU(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}return crypto.getRandomValues(e),Array.from(e,_U).join("")}async function AU(s){const t=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function kU(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await AU(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function au(s,e,t=!1){const n=EU();let r=n;t&&(r+="/PASSWORD_RECOVERY"),await du(s,`${e}-code-verifier`,r);const i=await kU(n);return[i,n===i?"plain":"s256"]}const TU=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function CU(s){const e=s.headers.get(Xw);if(!e||!e.match(TU))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function NU(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function jU(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const PU=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ou(s){if(!PU.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Sx(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function XA(s){return JSON.parse(JSON.stringify(s))}var RU=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t};const gl=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),LU=[502,503,504];async function YA(s){var e;if(!wU(s))throw new Yw(gl(s),0);if(LU.includes(s.status))throw new Yw(gl(s),s.status);let t;try{t=await s.json()}catch(i){throw new oj(gl(i),i)}let n;const r=CU(s);if(r&&r.getTime()>=aj["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new WA(gl(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ha}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new WA(gl(t),s.status,t.weak_password.reasons);throw new aU(gl(t),s.status||500,n)}const DU=(s,e,t,n)=>{const r={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(n),Object.assign(Object.assign({},r),t))};async function He(s,e,t,n){var r;const i=Object.assign({},n==null?void 0:n.headers);i[Xw]||(i[Xw]=aj["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const a=(r=n==null?void 0:n.query)!==null&&r!==void 0?r:{};n!=null&&n.redirectTo&&(a.redirect_to=n.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await MU(s,e,t+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function MU(s,e,t,n,r,i){const a=DU(e,n,r,i);let o;try{o=await s(t,Object.assign({},a))}catch(l){throw console.error(l),new Yw(gl(l),0)}if(o.ok||await YA(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(l){await YA(l)}}function ai(s){var e;let t=null;$U(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=yU(s.expires_in)));const n=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:n},error:null}}function JA(s){const e=ai(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Xa(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function IU(s){return{data:s,error:null}}function OU(s){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:i}=s,a=RU(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function FU(s){return s}function $U(s){return s.access_token&&s.refresh_token&&s.expires_in}const _x=["global","local","others"];var UU=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t};class BU{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=uj(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=_x[0]){if(_x.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_x.join(", ")}`);try{return await He(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Me(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await He(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Xa})}catch(n){if(Me(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=UU(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=n==null?void 0:n.newEmail,delete r.newEmail),await He(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:OU,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Me(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await He(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Xa})}catch(t){if(Me(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,i,a,o,l;try{const u={nextPage:null,lastPage:0,total:0},h=await He(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:FU});if(h.error)throw h.error;const f=await h.json(),p=(a=h.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(l=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(g.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(p)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Me(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){ou(e);try{return await He(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Xa})}catch(t){if(Me(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ou(e);try{return await He(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Xa})}catch(n){if(Me(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){ou(e);try{return await He(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Xa})}catch(n){if(Me(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){ou(e.userId);try{const{data:t,error:n}=await He(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:n}}catch(t){if(Me(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ou(e.userId),ou(e.id);try{return{data:await He(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Me(t))return{data:null,error:t};throw t}}}function QA(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function HU(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const lu={debug:!!(globalThis&&cj()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class dj extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class VU extends dj{}async function zU(s,e,t){lu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),lu.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async r=>{if(r){lu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,r.name);try{return await t()}finally{lu.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,r.name)}}else{if(e===0)throw lu.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new VU(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(lu.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function hj(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function WU(s){return parseInt(s,16)}function GU(s){const e=new TextEncoder().encode(s);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function qU(s){var e;const{chainId:t,domain:n,expirationTime:r,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:u,scheme:h,uri:f,version:p}=s;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=s.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const m=hj(s.address),g=h?`${h}://${n}`:n,y=s.statement?`${s.statement}
`:"",b=`${g} wants you to sign in with your Ethereum account:
${m}

${y}`;let v=`URI: ${f}
Version: ${p}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(r&&(v+=`
Expiration Time: ${r.toISOString()}`),o&&(v+=`
Not Before: ${o.toISOString()}`),l&&(v+=`
Request ID: ${l}`),u){let x=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);x+=`
- ${w}`}v+=x}return`${b}
${v}`}HU();const KU={url:tU,storageKey:sU,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nU,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ZA(s,e,t){return await t()}const cu={};class Xf{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Xf.nextInstanceID,Xf.nextInstanceID+=1,this.instanceID>0&&ar()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},KU),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new BU({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=uj(r.fetch),this.lock=r.lock||ZA,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:ar()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=zU:this.lock=ZA,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:cj()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=QA(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=QA(this.memoryStorage)),ar()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=cu[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){cu[this.storageKey]=Object.assign(Object.assign({},cu[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=cu[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){cu[this.storageKey]=Object.assign(Object.assign({},cu[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ij}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=xU(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),ar()&&this.detectSessionInUrl&&n!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),cU(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Me(t)?{error:t}:{error:new oj("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const i=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:ai}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(Me(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,n,r;try{let i;if("email"in e){const{email:h,password:f,options:p}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await au(this.storage,this.storageKey)),i=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:h,password:f,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:m,code_challenge_method:g},xform:ai})}else if("phone"in e){const{phone:h,password:f,options:p}=e;i=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:f,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(r=p==null?void 0:p.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:ai})}else throw new kg("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(Me(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await He(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:JA})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await He(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:JA})}else throw new kg("You must provide either an email or phone number and a password");const{data:n,error:r}=t;return r?{data:{user:null,session:null},error:r}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Ph}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(Me(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,r,i,a,o,l,u,h,f,p;let m,g;if("message"in e)m=e.message,g=e.signature;else{const{chain:y,wallet:b,statement:v,options:x}=e;let w;if(ar())if(typeof b=="object")w=b;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")w=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const E=new URL((t=x==null?void 0:x.url)!==null&&t!==void 0?t:window.location.href),T=await w.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!T||T.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=hj(T[0]);let N=(n=x==null?void 0:x.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!N){const P=await w.request({method:"eth_chainId"});N=WU(P)}const j={domain:E.host,address:C,statement:v,uri:E.href,version:"1",chainId:N,nonce:(r=x==null?void 0:x.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(a=(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=x==null?void 0:x.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=x==null?void 0:x.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=x==null?void 0:x.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(h=x==null?void 0:x.signInWithEthereum)===null||h===void 0?void 0:h.resources};m=qU(j),g=await w.request({method:"personal_sign",params:[GU(m),C]})}try{const{data:y,error:b}=await He(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:g},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:ai});if(b)throw b;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new Ph}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:b})}catch(y){if(Me(y))return{data:{user:null,session:null},error:y};throw y}}async signInWithSolana(e){var t,n,r,i,a,o,l,u,h,f,p,m;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:b,wallet:v,statement:x,options:w}=e;let E;if(ar())if(typeof v=="object")E=v;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))E=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=v}const T=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const C=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),x?{statement:x}:null));let N;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")N=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)N=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in N&&"signature"in N&&(typeof N.signedMessage=="string"||N.signedMessage instanceof Uint8Array)&&N.signature instanceof Uint8Array)g=typeof N.signedMessage=="string"?N.signedMessage:new TextDecoder().decode(N.signedMessage),y=N.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${T.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(r=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(h=w==null?void 0:w.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(N=>`- ${N}`)]:[]].join(`
`);const C=await E.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=C}}try{const{data:b,error:v}=await He(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:gU(y)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:ai});if(v)throw v;return!b||!b.session||!b.user?{data:{user:null,session:null},error:new Ph}:(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:v})}catch(b){if(Me(b))return{data:{user:null,session:null},error:b};throw b}}async _exchangeCodeForSession(e){const t=await cl(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(t??"").split("/");try{const{data:i,error:a}=await He(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:ai});if(await Ua(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ph}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:a})}catch(i){if(Me(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:i,nonce:a}=e,o=await He(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ai}),{data:l,error:u}=o;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ph}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(Me(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,r,i,a;try{if("email"in e){const{email:o,options:l}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await au(this.storage,this.storageKey));const{error:f}=await He(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:o,options:l}=e,{data:u,error:h}=await He(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:h}}throw new kg("You must provide either an email or phone number.")}catch(o){if(Me(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,n;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:a,error:o}=await He(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:ai});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,u=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(r){if(Me(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,n,r;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await au(this.storage,this.storageKey)),await He(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:IU})}catch(i){if(Me(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ha;const{error:r}=await He(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(Me(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:r,options:i}=e,{error:a}=await He(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:n,type:r,options:i}=e,{data:a,error:o}=await He(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new kg("You must provide either an email or phone number and a type")}catch(t){if(Me(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await cl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<xx:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const a=await cl(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Sx()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,h)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,h))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await He(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Xa}):await this._useSession(async t=>{var n,r,i;const{data:a,error:o}=t;if(o)throw o;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ha}:await He(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:Xa})})}catch(t){if(Me(t))return lU(t)&&(await this._removeSession(),await Ua(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:r,error:i}=n;if(i)throw i;if(!r.session)throw new Ha;const a=r.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await au(this.storage,this.storageKey));const{data:u,error:h}=await He(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:Xa});if(h)throw h;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(n){if(Me(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ha;const t=Date.now()/1e3;let n=t,r=!0,i=null;const{payload:a}=bx(e.access_token);if(a.exp&&(n=a.exp,r=n<=t),r){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(Me(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(n=a.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Ha;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Me(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ar())throw new Tg("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Tg(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new zA("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Tg("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new zA("No code detected.");const{data:x,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:u}=e;if(!i||!o||!a||!u)throw new Tg("No session defined in URL");const h=Math.round(Date.now()/1e3),f=parseInt(o);let p=h+f;l&&(p=parseInt(l));const m=p-h;m*1e3<=uu&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const g=p-f;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,p,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,p,h);const{data:y,error:b}=await this._getUser(i);if(b)throw b;const v={provider_token:n,provider_refresh_token:r,access_token:i,expires_in:f,expires_at:p,refresh_token:a,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(n){if(Me(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await cl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return{error:i};const a=(n=r.session)===null||n===void 0?void 0:n.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(oU(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Ua(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=vU(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:i},error:a}=t;if(a)throw a;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,r=null;this.flowType==="pkce"&&([n,r]=await au(this.storage,this.storageKey,!0));try{return await He(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(Me(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Me(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:r}=await this._useSession(async i=>{var a,o,l,u,h;const{data:f,error:p}=i;if(p)throw p;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await He(this.fetch,"GET",m,{headers:this.headers,jwt:(h=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(r)throw r;return ar()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(Me(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:a}=t;if(a)throw a;return await He(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(Me(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await SU(async r=>(r>0&&await bU(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await He(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ai})),(r,i)=>{const a=200*Math.pow(2,r);return i&&wx(i)&&Date.now()+a-n<uu})}catch(n){if(this._debug(t,"error",n),Me(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),ar()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const r=await cl(this.storage,this.storageKey);if(r&&this.userStorage){let a=await cl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:r.user},await du(this.userStorage,this.storageKey+"-user",a)),r.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Sx()}else if(r&&!r.user&&!r.user){const a=await cl(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(r.user=a.user,await Ua(this.storage,this.storageKey+"-user"),await du(this.storage,this.storageKey,r)):r.user=Sx()}if(this._debug(n,"session from storage",r),!this._isValidSession(r)){this._debug(n,"session is not valid"),r!==null&&await this._removeSession();return}const i=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<xx;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${xx}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),wx(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(r.access_token);!o&&(a!=null&&a.user)?(r.user=a.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(n,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(n,"error",r),console.error(r);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ha;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new fv;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Ha;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(r,"error",i),Me(i)){const a={session:null,error:i};return wx(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,n=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await du(this.userStorage,this.storageKey+"-user",{user:t.user});const r=Object.assign({},t);delete r.user;const i=XA(r);await du(this.storage,this.storageKey,i)}else{const r=XA(t);await du(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),await Ua(this.storage,this.storageKey),await Ua(this.storage,this.storageKey+"-code-verifier"),await Ua(this.storage,this.storageKey+"-user"),this.userStorage&&await Ua(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ar()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),uu);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((n.expires_at*1e3-e)/uu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${uu}ms, refresh threshold is ${Kw} ticks`),r<=Kw&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof dj)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ar()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,a]=await au(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);r.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;return i?{data:null,error:i}:await He(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Me(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await He(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((r=l==null?void 0:l.totp)===null||r===void 0)&&r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(Me(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await He(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(Me(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;return i?{data:null,error:i}:await He(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Me(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],r=n.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=n.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:n,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=bx(r.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((n=(t=r.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const h=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(o=>o.kid===e);if(n)return n;const r=Date.now();if(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+iU>r)return n;const{data:i,error:a}=await He(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=r,n=i.keys.find(o=>o.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};n=m.session.access_token}const{header:r,payload:i,signature:a,raw:{header:o,payload:l}}=bx(n);t!=null&&t.allowExpired||NU(i.exp);const u=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:i,header:r,signature:a},error:null}}const h=jU(r.alg),f=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,f,a,mU(`${o}.${l}`)))throw new Jw("Invalid JWT signature");return{data:{claims:i,header:r,signature:a},error:null}}catch(n){if(Me(n))return{data:null,error:n};throw n}}}Xf.nextInstanceID=0;const XU=Xf;class YU extends XU{constructor(e){super(e)}}var JU=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,[])).next())})};class QU{constructor(e,t,n){var r,i,a;this.supabaseUrl=e,this.supabaseKey=t;const o=eU(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,u={db:z5,realtime:G5,auth:Object.assign(Object.assign({},W5),{storageKey:l}),global:V5},h=Z5(n??{},u);this.storageKey=(r=h.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=h.auth)!==null&&a!==void 0?a:{},this.headers,h.global.fetch),this.fetch=Y5(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new a5(new URL("rest/v1",o).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new U5(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new F$(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return JU(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:i,storageKey:a,flowType:o,lock:l,debug:u},h,f){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new YU({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),h),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:i,flowType:o,lock:l,debug:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new _5(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const fj=(s,e,t)=>new QU(s,e,t);function ZU(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const e=s.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}ZU()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const O_="https://carqvkbmbnqofizbbkjt.supabase.co",pj="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNhcnF2a2JtYm5xb2ZpemJia2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1Mjk0MTEsImV4cCI6MjA3NDEwNTQxMX0.2vzjY0M2fBEaOyfo5XVPqtF7ZZ0-WjZDXX0awA2U7uE";console.log(" [SUPABASE] Environment check:",{hasSupabaseUrl:!0,hasAnonKey:!0,supabaseUrl:O_.substring(0,30)+"...",anonKey:pj.substring(0,20)+"...",source:"build-time"});const Ex=fj(O_,pj),e6="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNhcnF2a2JtYm5xb2ZpemJia2p0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODUyOTQxMSwiZXhwIjoyMDc0MTA1NDExfQ.u2W-xGXZcvXWvMTsVAxe7pF3fn6OdH1PRsqjjEFU4f4";fj(O_,e6,{auth:{autoRefreshToken:!1,persistSession:!1}});class t6{async uploadFile(e,t=null,n={}){const r=this.generateFilePath(e,t),{data:i,error:a}=await Ex.storage.from("files").upload(r,e,{cacheControl:"3600",upsert:!1});if(a)throw a;return{path:i.path,bucket:"files",size:e.size,contentType:e.type}}generateFilePath(e,t){const r=`${Date.now()}-${e.name}`;return t?`folders/folder-${t}/${r}`:`root/${r}`}async getSignedUrl(e,t=3600){const{data:n,error:r}=await Ex.storage.from("files").createSignedUrl(e,t);if(r)throw r;return n.signedUrl}async deleteFile(e){const{error:t}=await Ex.storage.from("files").remove([e]);if(t)throw t}}const s6=new t6,n6=(s,e="")=>{var n;const t={"application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","text/plain":"txt","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.ms-powerpoint":"ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application/zip":"zip","application/x-zip-compressed":"zip","application/x-rar-compressed":"rar","image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/svg+xml":"svg","audio/mpeg":"mp3","audio/mp3":"mp3","audio/wav":"wav","audio/ogg":"ogg","audio/m4a":"m4a","audio/aac":"aac","audio/flac":"flac"};if(s&&t[s])return t[s];if(e){const r=(n=e.split(".").pop())==null?void 0:n.toLowerCase(),i={pdf:"pdf",doc:"doc",docx:"docx",txt:"txt",xls:"xls",xlsx:"xlsx",ppt:"ppt",pptx:"pptx",zip:"zip",rar:"rar",jpg:"jpg",jpeg:"jpg",png:"png",gif:"gif",webp:"webp",svg:"svg",mp3:"mp3",wav:"wav",ogg:"ogg",m4a:"m4a",aac:"aac",flac:"flac"};if(r&&i[r])return i[r]}return"unknown"},r6=()=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/zip","application/x-zip-compressed","application/x-rar-compressed","image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml","audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/aac","audio/flac"],ek=s=>{if(s===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,n)).toFixed(2))+" "+t[n]},oy=s=>{const e="w-8 h-8 text-blue-600";switch(s){case"pdf":return c.jsx("div",{className:`${e} flex items-center justify-center bg-red-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-red-600",children:"PDF"})]})});case"doc":case"docx":return c.jsx("div",{className:`${e} flex items-center justify-center bg-blue-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-blue-600",children:"DOC"})]})});case"xls":case"xlsx":return c.jsx("div",{className:`${e} flex items-center justify-center bg-green-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-green-600",children:"XLS"})]})});case"ppt":case"pptx":return c.jsx("div",{className:`${e} flex items-center justify-center bg-orange-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-orange-600",children:"PPT"})]})});case"jpg":case"jpeg":case"png":case"gif":case"webp":case"svg":return c.jsx("div",{className:`${e} flex items-center justify-center bg-purple-50 rounded-lg`,children:c.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"})})});case"mp3":case"wav":case"ogg":case"m4a":case"aac":case"flac":return c.jsx("div",{className:`${e} flex items-center justify-center bg-pink-50 rounded-lg`,children:c.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.01,19.86 21,16.28 21,12C21,7.72 18.01,4.14 14,3.23M16.5,12C16.5,10.23 15.48,8.71 14,7.97V16.02C15.48,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z"})})});case"zip":case"rar":return c.jsx("div",{className:`${e} flex items-center justify-center bg-yellow-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-yellow-600",children:"ZIP"})]})});case"txt":return c.jsx("div",{className:`${e} flex items-center justify-center bg-gray-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-gray-600",children:"TXT"})]})});default:return c.jsx("div",{className:`${e} flex items-center justify-center bg-gray-50 rounded-lg`,children:c.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})})}},tk=({folders:s,files:e,selectedFolder:t,onFolderSelect:n,onFolderCreate:r,onFolderUpdate:i,onFolderDelete:a,onSubfolderCreate:o,onCurrentFolderChange:l,onFileUpdate:u,onFileDelete:h,onFileMove:f,onFileSelect:p,onFileUpload:m})=>{const[g,y]=_.useState(new Set),[b,v]=_.useState(!1),[x,w]=_.useState(null),[E,T]=_.useState({name:"",parent_id:null}),[C,N]=_.useState({name:"",parent_id:null}),[j,P]=_.useState(null),[M,V]=_.useState(null),[L,I]=_.useState({x:0,y:0}),[O,X]=_.useState(null),[$,H]=_.useState(null),[D,F]=_.useState({name:""}),[q,J]=_.useState({x:0,y:0}),[ee,de]=_.useState(null),[ge,Ce]=_.useState([]),B=_.useRef(null),[K,xe]=_.useState(!1),[Re,Se]=_.useState(0),[Ze,lt]=_.useState(!1),Ae=_.useRef(null);_.useEffect(()=>{const z=te=>{B.current&&!B.current.contains(te.target)&&H(null),j&&!te.target.closest(".file-context-menu")&&(P(null),V(null))};return($||j)&&document.addEventListener("mousedown",z),()=>{document.removeEventListener("mousedown",z)}},[$,j]),_.useEffect(()=>{console.log(" [FOLDER_TREE] currentFolderId changed:",ee)},[ee]),_.useEffect(()=>{console.log(" [FOLDER_TREE] folderPath changed:",ge)},[ge]);const $e=async z=>{z.preventDefault();try{const te=await se.createFolder(E);te.success?(r(te.folder),T({name:"",parent_id:null}),v(!1)):alert("Failed to create folder: "+te.error)}catch(te){console.error("Error creating folder:",te),alert("Failed to create folder")}},ie=async z=>{z.preventDefault();try{const te=await se.createFolder(C);te.success?(r(te.folder),N({name:"",parent_id:null}),w(null)):alert("Failed to create subfolder: "+te.error)}catch(te){console.error("Error creating subfolder:",te),alert("Failed to create subfolder")}},U=async z=>{z.preventDefault();try{const te=await se.updateFolder(O.id,{name:D.name});te.success?(i(te.folder),X(null),F({name:""})):alert("Failed to rename folder: "+te.error)}catch(te){console.error("Error renaming folder:",te),alert("Failed to rename folder")}},oe=async z=>{if(confirm("Are you sure you want to delete this folder? This will also delete all files in the folder. This action cannot be undone."))try{const te=await se.deleteFolder(z);te.success?(a(z),H(null)):alert("Failed to delete folder: "+te.error)}catch(te){console.error("Error deleting folder:",te),alert("Failed to delete folder")}},Ue=(z,te)=>{var ye;z.preventDefault(),z.stopPropagation();const G=z.currentTarget.getBoundingClientRect();if((ye=z.currentTarget.closest(".folder-tree-container"))==null?void 0:ye.getBoundingClientRect()){let je=G.right,Je=G.top;je+200>window.innerWidth&&(je=G.left-200),Je<0&&(Je=G.bottom),J({x:je,y:Je})}H(te.id)},hn=z=>{X(z),F({name:z.name}),H(null)},ys=z=>{console.log(" [FOLDER_TREE] Single click on folder:",z.id,z.name),de(z.id),Ce(te=>[...te,{id:z.id,name:z.name}]),n(z.id)},Vs=z=>{Ar(z)},Ar=z=>{console.log(" [FOLDER_TREE] Double click - navigating to folder:",z.id,z.name),de(z.id),Ce(te=>[...te,{id:z.id,name:z.name}]),n(z.id),l&&l(z.id)},tr=()=>{if(console.log(" [FOLDER_TREE] navigateBack called",{folderPath:ge,currentFolderId:ee,folderPathLength:ge.length,folderPathContents:ge.map(z=>({id:z.id,name:z.name}))}),ge.length>0){const z=[...ge],te=z.pop();if(console.log(" [FOLDER_TREE] Removed folder from path:",te),console.log(" [FOLDER_TREE] New path after pop:",z),Ce(z),z.length===0)console.log(" [FOLDER_TREE] Navigating to root"),de(null),console.log(" [FOLDER_TREE] Calling onFolderSelect(null)"),n(null),l&&(console.log(" [FOLDER_TREE] Calling onCurrentFolderChange(null)"),l(null));else{const G=z[z.length-1];console.log(" [FOLDER_TREE] Navigating to parent folder:",G),de(G.id),console.log(" [FOLDER_TREE] Calling onFolderSelect with parent folder ID:",G.id),n(G.id),l&&(console.log(" [FOLDER_TREE] Calling onCurrentFolderChange with parent folder ID:",G.id),l(G.id))}}else console.log(" [FOLDER_TREE] Already at root, cannot go back")},zs=()=>{de(null),Ce([]),n(null),l&&l(null)},kr=z=>{y(te=>{const G=new Set(te);return G.has(z)?G.delete(z):G.add(z),G})},Cn=(z,te)=>{z.preventDefault(),z.stopPropagation();const G=z.currentTarget.getBoundingClientRect();I({x:G.right+5,y:G.top}),V(te),P(te.id)},ct=()=>{P(null),V(null)},Ws=async z=>{if(z.preventDefault(),z.stopPropagation(),console.log(" [FOLDER_TREE] Download clicked for file:",M),console.log(" [FOLDER_TREE] Event:",z),console.log(" [FOLDER_TREE] Selected file ID:",M==null?void 0:M.id),!M){console.error(" [FOLDER_TREE] No file selected"),alert("Error: No file selected"),ct();return}try{console.log(" [FOLDER_TREE] Starting download");let te,G;if(M.supabase_path){console.log(" [FOLDER_TREE] Getting signed URL for Supabase file");const Je=await se.downloadFile(M.id);if(!Je.success)throw new Error(Je.error||"Failed to get download URL");te=Je.downloadUrl,G=Je.fileName,console.log(" [FOLDER_TREE] Got signed URL:",te.substring(0,50)+"...")}else te=M.cloudinary_url,G=M.display_name||M.original_name,console.log(" [FOLDER_TREE] Using Cloudinary URL:",te.substring(0,50)+"...");console.log(" [FOLDER_TREE] Fetching file content from URL");const he=await fetch(te);if(!he.ok)throw new Error(`Download failed: ${he.status} ${he.statusText}`);const ye=await he.blob();if(console.log(" [FOLDER_TREE] File blob size:",ye.size,"bytes"),ye.size===0)throw new Error("Downloaded file is empty");const be=URL.createObjectURL(ye),je=document.createElement("a");je.href=be,je.download=G,document.body.appendChild(je),je.click(),document.body.removeChild(je),URL.revokeObjectURL(be),console.log(" [FOLDER_TREE] Download initiated successfully")}catch(te){console.error(" [FOLDER_TREE] Download failed:",te),alert("Download failed: "+te.message)}ct()},vs=z=>{if(z.preventDefault(),z.stopPropagation(),console.log(" [FOLDER_TREE] View clicked for file:",M),console.log(" [FOLDER_TREE] Event:",z),console.log(" [FOLDER_TREE] Selected file ID:",M==null?void 0:M.id),!M){console.error(" [FOLDER_TREE] No file selected"),alert("Error: No file selected"),ct();return}p?(console.log(" [FOLDER_TREE] Calling onFileSelect with file:",M),p(M)):(console.error(" [FOLDER_TREE] onFileSelect function not provided"),alert("Error: File preview not available")),ct()},is=z=>{if(z.preventDefault(),z.stopPropagation(),console.log(" [FOLDER_TREE] Move clicked for file:",M),!M){console.error(" [FOLDER_TREE] No file selected"),alert("Error: No file selected"),ct();return}if(f)try{f(M),console.log(" [FOLDER_TREE] Move dialog opened successfully")}catch(te){console.error(" [FOLDER_TREE] Move failed:",te),alert("Failed to open move dialog: "+te.message)}else console.error(" [FOLDER_TREE] onFileMove prop not provided"),alert("Error: Move functionality not available");ct()},xs=z=>{if(z.preventDefault(),z.stopPropagation(),console.log(" [FOLDER_TREE] Delete clicked for file:",M),!M){console.error(" [FOLDER_TREE] No file selected"),alert("Error: No file selected"),ct();return}if(!window.confirm(`Are you sure you want to delete "${M.display_name}"?

This action cannot be undone.`)){console.log(" [FOLDER_TREE] Delete cancelled by user"),ct();return}if(h)try{h(M),console.log(" [FOLDER_TREE] Delete initiated successfully")}catch(G){console.error(" [FOLDER_TREE] Delete failed:",G),alert("Failed to delete file: "+G.message)}else console.error(" [FOLDER_TREE] onFileDelete prop not provided"),alert("Error: Delete functionality not available");ct()},Tr=()=>s.filter(z=>!z.parent_id),fn=z=>s.filter(te=>te.parent_id===z),Cr=(z,te=0)=>{const G=g.has(z.id),he=fn(z.id),ye=he.length>0;return c.jsxs("div",{className:"select-none",children:[c.jsxs("div",{className:`flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm ${t===z.id?"bg-blue-100 text-blue-700":"text-gray-700"}`,style:{paddingLeft:`${te*16+8}px`},onClick:()=>ys(z),onDoubleClick:()=>Vs(z),tabIndex:0,children:[ye?c.jsx("button",{onClick:be=>{be.stopPropagation(),kr(z.id)},className:"mr-1 w-4 h-4 flex items-center justify-center",children:c.jsx(Q.svg,{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:G?90:0},transition:{duration:.2},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):c.jsx("div",{className:"w-4 h-4 mr-1"}),c.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1 truncate",children:z.name}),c.jsx("div",{className:"flex items-center space-x-1",children:c.jsx("button",{onClick:be=>Ue(be,z),className:"p-1 hover:bg-gray-200 rounded text-gray-500 hover:text-gray-700",title:"Folder options",children:c.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),c.jsx(cn,{children:G&&ye&&c.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:he.map(be=>Cr(be,te+1))})})]},z.id)},as=()=>{var z;(z=Ae.current)==null||z.click()},al=z=>{const te=Array.from(z.target.files);te.length>0&&Tt(te)},Tt=async z=>{if(!(!z||z.length===0)){xe(!0),Se(0);try{for(let te=0;te<z.length;te++){const G=z[te],he=(te+1)/z.length*100;Se(he);const ye=n6(G.type,G.name);if(ye==="unknown"){alert(`File "${G.name}" is not a supported file type.`);continue}const be=await s6.uploadFile(G,ee),je={display_name:G.name,original_name:G.name,file_type:ye,file_size:G.size,supabase_path:be.path,supabase_bucket:be.bucket,content_type:be.contentType,folder_id:ee},Je=await se.uploadFile(je);Je.success?(console.log(" File uploaded successfully:",Je.file),m&&m(Je.file)):(console.error(" Failed to save file metadata:",Je.error),alert(`Failed to save file "${G.name}": ${Je.error}`))}}catch(te){console.error(" Upload error:",te),alert("Upload failed: "+te.message)}finally{xe(!1),Se(0)}}},bt=z=>{z.preventDefault(),z.stopPropagation()},Nr=z=>{z.preventDefault(),z.stopPropagation()},Fa=z=>{z.preventDefault(),z.stopPropagation(),z.dataTransfer.files&&z.dataTransfer.files[0]&&Tt(Array.from(z.dataTransfer.files))};return c.jsxs("div",{className:"h-full flex flex-col bg-gray-50 border-r border-gray-200 folder-tree-container relative",onDragEnter:bt,onDragLeave:bt,onDragOver:Nr,onDrop:Fa,children:[c.jsxs("div",{className:"p-3 border-b border-gray-200",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Folders"}),ee!==null&&c.jsxs("div",{className:"mt-2 flex items-center space-x-1 text-xs",children:[c.jsxs("button",{onClick:zs,className:"flex items-center px-2 py-1 text-blue-600 hover:bg-blue-100 rounded",title:"Go to root",children:[c.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Root"]}),c.jsx("span",{className:"text-gray-400",children:"/"}),c.jsxs("button",{onClick:tr,className:"flex items-center px-2 py-1 text-blue-600 hover:bg-blue-100 rounded",title:"Go back",children:[c.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),ge.map((z,te)=>c.jsxs(Iy.Fragment,{children:[c.jsx("span",{className:"text-gray-400",children:"/"}),c.jsx("span",{className:"px-2 py-1 text-gray-600",children:z.name})]},z.id))]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:ee===null?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:`flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm ${t===null?"bg-blue-100 text-blue-700":"text-gray-700"}`,onClick:()=>{console.log(" [FOLDER_TREE] All Files clicked - selecting root"),de(null),n(null)},children:[c.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1",children:"All Files"})]}),Tr().map(z=>Cr(z)),(()=>{const z=e?e.filter(te=>te.folder_id===null):[];return console.log(" [FOLDER_TREE] Root files:",{allFiles:(e==null?void 0:e.length)||0,rootFiles:z.length}),z.length>0?c.jsxs("div",{className:"mt-3",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-600 mb-2 px-2",children:["Files (",z.length,")"]}),z.map(te=>c.jsxs("div",{className:"flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm text-gray-700 group",children:[c.jsx("span",{className:"mr-2",children:oy(te.file_type)}),c.jsx("span",{className:"flex-1 truncate",title:te.display_name,children:te.display_name}),c.jsx("div",{className:"relative",children:c.jsx("button",{onClick:G=>Cn(G,te),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 rounded",title:"File options",children:c.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})})})]},te.id))]}):c.jsx("div",{className:"mt-3 text-sm text-gray-500 italic p-2",children:"No files in root"})})()]}):c.jsx(c.Fragment,{children:(()=>{const z=s.find(G=>G.id===ee),te=fn(ee);return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[" ",(z==null?void 0:z.name)||"Unknown Folder"]}),te.length>0?te.map(G=>Cr(G)):c.jsx("div",{className:"text-sm text-gray-500 italic p-2",children:"No subfolders in this folder"}),(()=>{const G=e?e.filter(he=>he.folder_id===ee||he.folder_id===null&&ee===null):[];return console.log(" [FOLDER_TREE] Current folder files:",{currentFolderId:ee,allFiles:(e==null?void 0:e.length)||0,filteredFiles:G.length}),G.length>0?c.jsxs("div",{className:"mt-3",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-600 mb-2 px-2",children:["Files (",G.length,")"]}),G.map(he=>c.jsxs("div",{className:"flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm text-gray-700 group",children:[c.jsx("span",{className:"mr-2",children:oy(he.file_type)}),c.jsx("span",{className:"flex-1 truncate",title:he.display_name,children:he.display_name}),c.jsx("div",{className:"relative",children:c.jsx("button",{onClick:ye=>Cn(ye,he),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 rounded",title:"File options",children:c.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})})})]},he.id))]}):c.jsx("div",{className:"mt-3 text-sm text-gray-500 italic p-2",children:"No files in this folder"})})()]})})()})}),c.jsx("div",{className:"p-2 border-t border-gray-200",children:c.jsxs("button",{onClick:()=>v(!0),className:"w-full flex items-center justify-center py-2 px-3 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",children:[c.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Folder"]})}),c.jsxs("div",{className:"p-2 border-t border-gray-200",children:[c.jsx("button",{onClick:as,disabled:K,className:"w-full flex items-center justify-center py-2 px-3 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:K?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"}),"Uploading... ",Math.round(Re),"%"]}):c.jsxs(c.Fragment,{children:[c.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Files"]})}),c.jsx("input",{ref:Ae,type:"file",multiple:!0,accept:r6().join(","),onChange:al,className:"hidden"}),K&&c.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-primary-500 h-2 rounded-full transition-all duration-300",style:{width:`${Re}%`}})})]}),b&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Create New Folder"}),c.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Folder Name *"}),c.jsx("input",{type:"text",value:E.name,onChange:z=>T(te=>({...te,name:z.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter folder name",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Create Folder"})]})]})]})}),x&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Create Subfolder"}),c.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subfolder Name *"}),c.jsx("input",{type:"text",value:C.name,onChange:z=>N(te=>({...te,name:z.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter subfolder name",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>w(null),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Create Subfolder"})]})]})]})}),c.jsx(cn,{children:$&&c.jsxs(Q.div,{ref:B,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50 min-w-48",style:{top:`${q.y}px`,left:`${q.x}px`},children:[c.jsxs("button",{onClick:()=>{const z=s.find(te=>te.id===$);z&&(N({name:"",description:"",parent_id:z.id}),w(z.id)),H(null)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Subfolder"]}),c.jsxs("button",{onClick:()=>{const z=s.find(te=>te.id===$);z&&hn(z)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),c.jsx("div",{className:"border-t border-gray-200 my-1"}),c.jsxs("button",{onClick:()=>oe($),className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})}),O&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Rename Folder"}),c.jsxs("form",{onSubmit:U,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Folder Name *"}),c.jsx("input",{type:"text",value:D.name,onChange:z=>F(te=>({...te,name:z.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter folder name",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>{X(null),F({name:""})},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Save Changes"})]})]})]})}),j&&XC.createPortal(c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-[99998]",onClick:ct}),c.jsxs("div",{className:"fixed bg-white border border-gray-200 rounded-lg shadow-lg z-[99999] py-1 min-w-[120px] file-context-menu",style:{left:L.x,top:L.y},children:[c.jsxs("button",{onClick:vs,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsxs("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]}),c.jsxs("button",{onClick:Ws,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),c.jsx("div",{className:"border-t border-gray-200 my-1"}),c.jsxs("button",{onClick:is,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),"Move"]}),c.jsxs("button",{onClick:xs,className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]}),document.body)]})},tn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Qw=[.001,0,0,.001,0,0],Ax=1.35,zn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ci={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},mj="pdfjs_internal_editor_",Pe={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},We={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},gj={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ls={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},kf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ot={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},hu={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Gm={ERRORS:0,WARNINGS:1,INFOS:5},Yf={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Cg={moveTo:0,lineTo:1,curveTo:2,closePath:3},yj={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let pv=Gm.WARNINGS;function i6(s){Number.isInteger(s)&&(pv=s)}function a6(){return pv}function mv(s){pv>=Gm.INFOS&&console.log(`Info: ${s}`)}function Le(s){pv>=Gm.WARNINGS&&console.log(`Warning: ${s}`)}function at(s){throw new Error(s)}function Kt(s,e){s||at(e)}function o6(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function F_(s,e=null,t=null){if(!s)return null;if(t&&typeof s=="string"){if(t.addDefaultProtocol&&s.startsWith("www.")){const r=s.match(/\./g);(r==null?void 0:r.length)>=2&&(s=`http://${s}`)}if(t.tryConvertEncoding)try{s=h6(s)}catch{}}const n=e?URL.parse(s,e):URL.parse(s);return o6(n)?n:null}function $_(s,e,t=!1){const n=URL.parse(s);return n?(n.hash=e,n.href):t&&F_(s,"http://example.com")?s.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Ve(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const Zc=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class sk extends Zc{constructor(e,t){super(e,"PasswordException"),this.code=t}}class kx extends Zc{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class ly extends Zc{constructor(e){super(e,"InvalidPDFException")}}class Jf extends Zc{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class l6 extends Zc{constructor(e){super(e,"FormatError")}}class Da extends Zc{constructor(e){super(e,"AbortException")}}function vj(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&at("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let r=0;r<e;r+=t){const i=Math.min(r+t,e),a=s.subarray(r,i);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function qm(s){typeof s!="string"&&at("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function c6(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function u6(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function d6(){try{return new Function(""),!0}catch{return!1}}class gs{static get isLittleEndian(){return Ve(this,"isLittleEndian",u6())}static get isEvalSupported(){return Ve(this,"isEvalSupported",d6())}static get isOffscreenCanvasSupported(){return Ve(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ve(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Ve(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return Ve(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Tx=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));var Ta,Xg,Zw;class ve{static makeHexColor(e,t,n){return`#${Tx[e]}${Tx[t]}${Tx[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,n=0){const r=e[n],i=e[n+1];e[n]=r*t[0]+i*t[2]+t[4],e[n+1]=r*t[1]+i*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],i=t[1],a=t[2],o=t[3],l=t[4],u=t[5];for(let h=0;h<6;h+=2){const f=e[n+h],p=e[n+h+1];e[n+h]=f*r+p*a+l,e[n+h+1]=f*i+p*o+u}}static applyInverseTransform(e,t){const n=e[0],r=e[1],i=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/i,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/i}static axialAlignedBoundingBox(e,t,n){const r=t[0],i=t[1],a=t[2],o=t[3],l=t[4],u=t[5],h=e[0],f=e[1],p=e[2],m=e[3];let g=r*h+l,y=g,b=r*p+l,v=b,x=o*f+u,w=x,E=o*m+u,T=E;if(i!==0||a!==0){const C=i*h,N=i*p,j=a*f,P=a*m;g+=j,v+=j,b+=P,y+=P,x+=C,T+=C,E+=N,w+=N}n[0]=Math.min(n[0],g,b,y,v),n[1]=Math.min(n[1],x,E,w,T),n[2]=Math.max(n[2],g,b,y,v),n[3]=Math.max(n[3],x,E,w,T)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],o=n**2+r**2,l=n*i+r*a,u=i**2+a**2,h=(o+u)/2,f=Math.sqrt(h**2-(o*u-l**2));t[0]=Math.sqrt(h+f||1),t[1]=Math.sqrt(h-f||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[n,i,r,a]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,i){i[0]=Math.min(i[0],e,n),i[1]=Math.min(i[1],t,r),i[2]=Math.max(i[2],e,n),i[3]=Math.max(i[3],t,r)}static bezierBoundingBox(e,t,n,r,i,a,o,l,u){u[0]=Math.min(u[0],e,o),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,o),u[3]=Math.max(u[3],t,l),k(this,Ta,Zw).call(this,e,n,i,o,t,r,a,l,3*(-e+3*(n-i)+o),6*(e-2*n+i),3*(n-e),u),k(this,Ta,Zw).call(this,e,n,i,o,t,r,a,l,3*(-t+3*(r-a)+l),6*(t-2*r+a),3*(r-t),u)}}Ta=new WeakSet,Xg=function(e,t,n,r,i,a,o,l,u,h){if(u<=0||u>=1)return;const f=1-u,p=u*u,m=p*u,g=f*(f*(f*e+3*u*t)+3*p*n)+m*r,y=f*(f*(f*i+3*u*a)+3*p*o)+m*l;h[0]=Math.min(h[0],g),h[1]=Math.min(h[1],y),h[2]=Math.max(h[2],g),h[3]=Math.max(h[3],y)},Zw=function(e,t,n,r,i,a,o,l,u,h,f,p){if(Math.abs(u)<1e-12){Math.abs(h)>=1e-12&&k(this,Ta,Xg).call(this,e,t,n,r,i,a,o,l,-f/h,p);return}const m=h**2-4*f*u;if(m<0)return;const g=Math.sqrt(m),y=2*u;k(this,Ta,Xg).call(this,e,t,n,r,i,a,o,l,(-h+g)/y,p),k(this,Ta,Xg).call(this,e,t,n,r,i,a,o,l,(-h-g)/y,p)},A(ve,Ta);function h6(s){return decodeURIComponent(escape(s))}let Cx=null,nk=null;function xj(s){return Cx||(Cx=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,nk=new Map([["","t"]])),s.replaceAll(Cx,(e,t,n)=>t?t.normalize("NFKC"):nk.get(n))}function U_(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),vj(s)}const B_="pdfjs_internal_id_";function f6(s,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...i]=t;if(!s(n)&&!Number.isInteger(n)||!e(r))return!1;const a=i.length;let o=!0;switch(r.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of i)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function $s(s,e,t){return Math.min(Math.max(s,e),t)}function wj(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(vj(s))}function p6(s){return Uint8Array.fromBase64?Uint8Array.fromBase64(s):qm(atob(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(s){return s.reduce((e,t)=>e+t,0)});const Ii="http://www.w3.org/2000/svg",bl=class bl{};re(bl,"CSS",96),re(bl,"PDF",72),re(bl,"PDF_TO_CSS_UNITS",bl.CSS/bl.PDF);let Ma=bl;async function vh(s,e="text"){if(zh(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class Km{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:i=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=i,this.offsetY=a,n*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let h,f,p,m;switch(r%=360,r<0&&(r+=360),r){case 180:h=-1,f=0,p=0,m=1;break;case 90:h=0,f=1,p=1,m=0;break;case 270:h=0,f=-1,p=-1,m=0;break;case 0:h=1,f=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,m=-m);let g,y,b,v;h===0?(g=Math.abs(u-e[1])*n+i,y=Math.abs(l-e[0])*n+a,b=(e[3]-e[1])*n,v=(e[2]-e[0])*n):(g=Math.abs(l-e[0])*n+i,y=Math.abs(u-e[1])*n+a,b=(e[2]-e[0])*n,v=(e[3]-e[1])*n),this.transform=[h*n,f*n,p*n,m*n,g-h*n*l-p*n*u,y-f*n*l-m*n*u],this.width=b,this.height=v}get rawDims(){const e=this.viewBox;return Ve(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new Km({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){const n=[e,t];return ve.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];ve.applyTransform(t,this.transform);const n=[e[2],e[3]];return ve.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return ve.applyInverseTransform(n,this.transform),n}}class gv extends Zc{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Xm(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function yv(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function bj(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function Sj(s,e="document.pdf"){if(typeof s!="string")return e;if(Xm(s))return Le('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(s);if(!n)return e;const r=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},i=/\.pdf$/i,a=n.pathname.split("/").at(-1);if(i.test(a))return r(a);if(n.searchParams.size>0){const o=Array.from(n.searchParams.values()).reverse();for(const u of o)if(i.test(u))return r(u);const l=Array.from(n.searchParams.keys()).reverse();for(const u of l)if(i.test(u))return r(u)}if(n.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(l)return r(l[0])}return e}class rk{constructor(){re(this,"started",Object.create(null));re(this,"times",[])}time(e){e in this.started&&Le(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Le(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:i}of this.times)e.push(`${n.padEnd(t)} ${i-r}ms
`);return e.join("")}}function zh(s,e){const t=e?URL.parse(s,e):URL.parse(s);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Er(s){s.preventDefault()}function Ut(s){s.preventDefault(),s.stopPropagation()}function m6(s){console.log("Deprecated API usage: "+s)}var np;class vv{static toDateObject(e){if(!e||typeof e!="string")return null;d(this,np)||S(this,np,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=d(this,np).exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,u==="-"?(a+=h,o+=f):u==="+"&&(a-=h,o-=f),new Date(Date.UTC(n,r,i,a,o,l))}}np=new WeakMap,A(vv,np);function _j(s,{scale:e=1,rotation:t=0}){const{width:n,height:r}=s.attributes.style,i=[0,0,parseInt(n),parseInt(r)];return new Km({viewBox:i,userUnit:1,scale:e,rotation:t})}function H_(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Le(`Not a valid color format: "${s}"`),[0,0,0])}function g6(s){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,H_(n))}e.remove()}function Nt(s){const{a:e,b:t,c:n,d:r,e:i,f:a}=s.getTransform();return[e,t,n,r,i,a]}function ri(s){const{a:e,b:t,c:n,d:r,e:i,f:a}=s.getTransform().invertSelf();return[e,t,n,r,i,a]}function Yo(s,e,t=!1,n=!0){if(e instanceof Km){const{pageWidth:r,pageHeight:i}=e.rawDims,{style:a}=s,o=gs.isCSSRoundSupported,l=`var(--total-scale-factor) * ${r}px`,u=`var(--total-scale-factor) * ${i}px`,h=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,f=o?`round(down, ${u}, var(--scale-round-y))`:`calc(${u})`;!t||e.rotation%180===0?(a.width=h,a.height=f):(a.width=f,a.height=h)}n&&s.setAttribute("data-main-rotation",e.rotation)}class ei{constructor(){const{pixelRatio:e}=ei;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,i=-1){let a=1/0,o=1/0,l=1/0;n=ei.capPixels(n,i),n>0&&(a=Math.sqrt(n/(e*t))),r!==-1&&(o=r/e,l=r/t);const u=Math.min(a,o,l);return this.sx>u||this.sy>u?(this.sx=u,this.sy=u,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const cy=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var Ya,Tl,lr,Ja,rp,qu,ip,gy,Ej,rn,Aj,kj,Wh,Yg;const Bi=class Bi{constructor(e){A(this,rn);A(this,Ya,null);A(this,Tl,null);A(this,lr);A(this,Ja,null);A(this,rp,null);A(this,qu,null);S(this,lr,e),d(Bi,ip)||S(Bi,ip,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=S(this,Ya,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=d(this,lr)._uiManager._signal;e.addEventListener("contextmenu",Er,{signal:t}),e.addEventListener("pointerdown",k(Bi,gy,Ej),{signal:t});const n=S(this,Ja,document.createElement("div"));n.className="buttons",e.append(n);const r=d(this,lr).toolbarPosition;if(r){const{style:i}=e,a=d(this,lr)._uiManager.direction==="ltr"?1-r[0]:r[0];i.insetInlineEnd=`${100*a}%`,i.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return d(this,Ya)}hide(){var e;d(this,Ya).classList.add("hidden"),(e=d(this,Tl))==null||e.hideDropdown()}show(){var e;d(this,Ya).classList.remove("hidden"),(e=d(this,rp))==null||e.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=d(this,lr),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",d(Bi,ip)[e]),k(this,rn,Wh).call(this,n),n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),d(this,Ja).append(n)}async addAltText(e){const t=await e.render();k(this,rn,Wh).call(this,t),d(this,Ja).append(t,d(this,rn,Yg)),S(this,rp,e)}addColorPicker(e){S(this,Tl,e);const t=e.renderButton();k(this,rn,Wh).call(this,t),d(this,Ja).append(t,d(this,rn,Yg))}async addEditSignatureButton(e){const t=S(this,qu,await e.renderEditButton(d(this,lr)));k(this,rn,Wh).call(this,t),d(this,Ja).append(t,d(this,rn,Yg))}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break}}updateEditSignatureButton(e){d(this,qu)&&(d(this,qu).title=e)}remove(){var e;d(this,Ya).remove(),(e=d(this,Tl))==null||e.destroy(),S(this,Tl,null)}};Ya=new WeakMap,Tl=new WeakMap,lr=new WeakMap,Ja=new WeakMap,rp=new WeakMap,qu=new WeakMap,ip=new WeakMap,gy=new WeakSet,Ej=function(e){e.stopPropagation()},rn=new WeakSet,Aj=function(e){d(this,lr)._focusEventsAllowed=!1,Ut(e)},kj=function(e){d(this,lr)._focusEventsAllowed=!0,Ut(e)},Wh=function(e){const t=d(this,lr)._uiManager._signal;e.addEventListener("focusin",k(this,rn,Aj).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",k(this,rn,kj).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Er,{signal:t})},Yg=function(){const e=document.createElement("div");return e.className="divider",e},A(Bi,gy),A(Bi,ip,null);let eb=Bi;var ap,Cl,Nl,Qo,Tj,Cj,Nj;class y6{constructor(e){A(this,Qo);A(this,ap,null);A(this,Cl,null);A(this,Nl);S(this,Nl,e)}show(e,t,n){const[r,i]=k(this,Qo,Cj).call(this,t,n),{style:a}=d(this,Cl)||S(this,Cl,k(this,Qo,Tj).call(this));e.append(d(this,Cl)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){d(this,Cl).remove()}}ap=new WeakMap,Cl=new WeakMap,Nl=new WeakMap,Qo=new WeakSet,Tj=function(){const e=S(this,Cl,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Er,{signal:d(this,Nl)._signal});const t=S(this,ap,document.createElement("div"));return t.className="buttons",e.append(t),k(this,Qo,Nj).call(this),e},Cj=function(e,t){let n=0,r=0;for(const i of e){const a=i.y+i.height;if(a<n)continue;const o=i.x+(t?i.width:0);if(a>n){r=o,n=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,n]},Nj=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=d(this,Nl)._signal;e.addEventListener("contextmenu",Er,{signal:n}),e.addEventListener("click",()=>{d(this,Nl).highlightSelection("floating_button")},{signal:n}),d(this,ap).append(e)};function jj(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}var yy;class v6{constructor(){A(this,yy,0)}get id(){return`${mj}${Ks(this,yy)._++}`}}yy=new WeakMap;var Ku,op,Ms,Xu,Jg;const Z_=class Z_{constructor(){A(this,Xu);A(this,Ku,U_());A(this,op,0);A(this,Ms,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const i=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Ve(this,"_isSVGFittingCanvas",i)}async getFromFile(e){const{lastModified:t,name:n,size:r,type:i}=e;return k(this,Xu,Jg).call(this,`${t}_${n}_${r}_${i}`,e)}async getFromUrl(e){return k(this,Xu,Jg).call(this,e,e)}async getFromBlob(e,t){const n=await t;return k(this,Xu,Jg).call(this,e,n)}async getFromId(e){d(this,Ms)||S(this,Ms,new Map);const t=d(this,Ms).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){d(this,Ms)||S(this,Ms,new Map);let n=d(this,Ms).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${d(this,Ku)}_${Ks(this,op)._++}`,refCounter:1,isSvg:!1},d(this,Ms).set(e,n),d(this,Ms).set(n.id,n),n}getSvgUrl(e){const t=d(this,Ms).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;d(this,Ms)||S(this,Ms,new Map);const t=d(this,Ms).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(n.width,n.height);i.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=i.convertToBlob()}(r=n.close)==null||r.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${d(this,Ku)}_`)}};Ku=new WeakMap,op=new WeakMap,Ms=new WeakMap,Xu=new WeakSet,Jg=async function(e,t){d(this,Ms)||S(this,Ms,new Map);let n=d(this,Ms).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${d(this,Ku)}_${Ks(this,op)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(n.url=t,r=await vh(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const i=Z_._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((u,h)=>{o.onload=()=>{n.bitmap=o,n.isSvg=!0,u()},a.onload=async()=>{const f=n.svgUrl=a.result;o.src=await i?`${f}#svgView(preserveAspectRatio(none))`:f},o.onerror=a.onerror=h});a.readAsDataURL(r),await l}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){Le(r),n=null}return d(this,Ms).set(e,n),n&&d(this,Ms).set(n.id,n),n};let tb=Z_;var Ft,Qa,lp,Ct;class x6{constructor(e=128){A(this,Ft,[]);A(this,Qa,!1);A(this,lp);A(this,Ct,-1);S(this,lp,e)}add({cmd:e,undo:t,post:n,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),d(this,Qa))return;const l={cmd:e,undo:t,post:n,type:i};if(d(this,Ct)===-1){d(this,Ft).length>0&&(d(this,Ft).length=0),S(this,Ct,0),d(this,Ft).push(l);return}if(a&&d(this,Ft)[d(this,Ct)].type===i){o&&(l.undo=d(this,Ft)[d(this,Ct)].undo),d(this,Ft)[d(this,Ct)]=l;return}const u=d(this,Ct)+1;u===d(this,lp)?d(this,Ft).splice(0,1):(S(this,Ct,u),u<d(this,Ft).length&&d(this,Ft).splice(u)),d(this,Ft).push(l)}undo(){if(d(this,Ct)===-1)return;S(this,Qa,!0);const{undo:e,post:t}=d(this,Ft)[d(this,Ct)];e(),t==null||t(),S(this,Qa,!1),S(this,Ct,d(this,Ct)-1)}redo(){if(d(this,Ct)<d(this,Ft).length-1){S(this,Ct,d(this,Ct)+1),S(this,Qa,!0);const{cmd:e,post:t}=d(this,Ft)[d(this,Ct)];e(),t==null||t(),S(this,Qa,!1)}}hasSomethingToUndo(){return d(this,Ct)!==-1}hasSomethingToRedo(){return d(this,Ct)<d(this,Ft).length-1}cleanType(e){if(d(this,Ct)!==-1){for(let t=d(this,Ct);t>=0;t--)if(d(this,Ft)[t].type!==e){d(this,Ft).splice(t+1,d(this,Ct)-t),S(this,Ct,t);return}d(this,Ft).length=0,S(this,Ct,-1)}}destroy(){S(this,Ft,null)}}Ft=new WeakMap,Qa=new WeakMap,lp=new WeakMap,Ct=new WeakMap;var vy,Pj;class Ym{constructor(e){A(this,vy);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=gs.platform;for(const[n,r,i={}]of e)for(const a of n){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(k(this,vy,Pj).call(this,t));if(!n)return;const{callback:r,options:{bubbles:i=!1,args:a=[],checker:o=null}}=n;o&&!o(e,t)||(r.bind(e,...a,t)(),i||Ut(t))}}vy=new WeakSet,Pj=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const xy=class xy{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return g6(e),Ve(this,"_colors",e)}convert(e){const t=H_(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((i,a)=>i===t[a]))return xy._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?ve.makeHexColor(...t):e}};re(xy,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let sb=xy;var Yu,jn,es,ws,Ju,zi,Qu,cr,Za,eo,Zu,jl,ui,Dr,Pl,cp,up,ed,dp,di,to,td,so,hi,wy,no,hp,ro,Rl,Ll,io,fp,os,st,Wi,ao,Dl,pp,mp,oo,fi,Gi,gp,yp,ur,ae,Qg,nb,Rj,Lj,Zg,Dj,Mj,Ij,rb,Oj,ib,ab,Fj,Xs,Oi,$j,Uj,ob,Bj,Gh,lb;const Iu=class Iu{constructor(e,t,n,r,i,a,o,l,u,h,f,p,m,g,y){A(this,ae);A(this,Yu,new AbortController);A(this,jn,null);A(this,es,new Map);A(this,ws,new Map);A(this,Ju,null);A(this,zi,null);A(this,Qu,null);A(this,cr,new x6);A(this,Za,null);A(this,eo,null);A(this,Zu,0);A(this,jl,new Set);A(this,ui,null);A(this,Dr,null);A(this,Pl,new Set);re(this,"_editorUndoBar",null);A(this,cp,!1);A(this,up,!1);A(this,ed,!1);A(this,dp,null);A(this,di,null);A(this,to,null);A(this,td,null);A(this,so,!1);A(this,hi,null);A(this,wy,new v6);A(this,no,!1);A(this,hp,!1);A(this,ro,null);A(this,Rl,null);A(this,Ll,null);A(this,io,null);A(this,fp,null);A(this,os,Pe.NONE);A(this,st,new Set);A(this,Wi,null);A(this,ao,null);A(this,Dl,null);A(this,pp,null);A(this,mp,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});A(this,oo,[0,0]);A(this,fi,null);A(this,Gi,null);A(this,gp,null);A(this,yp,null);A(this,ur,null);const b=this._signal=d(this,Yu).signal;S(this,Gi,e),S(this,gp,t),S(this,yp,n),S(this,Ju,r),S(this,ao,i),this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:b}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),a._on("setpreference",this.onSetPreference.bind(this),{signal:b}),a._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:b}),k(this,ae,Dj).call(this),k(this,ae,Fj).call(this),k(this,ae,rb).call(this),S(this,zi,o.annotationStorage),S(this,dp,o.filterFactory),S(this,Dl,l),S(this,td,u||null),S(this,cp,h),S(this,up,f),S(this,ed,p),S(this,fp,m||null),this.viewParameters={realScale:Ma.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=y!==!1}static get _keyboardManager(){const e=Iu.prototype,t=a=>d(a,Gi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),n=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},r=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return Ve(this,"_keyboardManager",new Ym([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,Gi).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,Gi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}destroy(){var e,t,n,r,i,a,o,l;(e=d(this,ur))==null||e.resolve(),S(this,ur,null),(t=d(this,Yu))==null||t.abort(),S(this,Yu,null),this._signal=null;for(const u of d(this,ws).values())u.destroy();d(this,ws).clear(),d(this,es).clear(),d(this,Pl).clear(),(n=d(this,io))==null||n.clear(),S(this,jn,null),d(this,st).clear(),d(this,cr).destroy(),(r=d(this,Ju))==null||r.destroy(),(i=d(this,ao))==null||i.destroy(),(a=d(this,hi))==null||a.hide(),S(this,hi,null),(o=d(this,Ll))==null||o.destroy(),S(this,Ll,null),d(this,di)&&(clearTimeout(d(this,di)),S(this,di,null)),d(this,fi)&&(clearTimeout(d(this,fi)),S(this,fi,null)),(l=this._editorUndoBar)==null||l.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return d(this,fp)}get useNewAltTextFlow(){return d(this,up)}get useNewAltTextWhenAddingImage(){return d(this,ed)}get hcmFilter(){return Ve(this,"hcmFilter",d(this,Dl)?d(this,dp).addHCMFilter(d(this,Dl).foreground,d(this,Dl).background):"none")}get direction(){return Ve(this,"direction",getComputedStyle(d(this,Gi)).direction)}get highlightColors(){return Ve(this,"highlightColors",d(this,td)?new Map(d(this,td).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColorNames(){return Ve(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),S(this,eo,e)}setMainHighlightColorPicker(e){S(this,Ll,e)}editAltText(e,t=!1){var n;(n=d(this,Ju))==null||n.editAltText(this,e,t)}getSignature(e){var t;(t=d(this,ao))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return d(this,ao)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":S(this,ed,t);break}}onPageChanging({pageNumber:e}){S(this,Zu,e-1)}focusMainContainer(){d(this,Gi).focus()}findParent(e,t){for(const n of d(this,ws).values()){const{x:r,y:i,width:a,height:o}=n.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return n}return null}disableUserSelect(e=!1){d(this,gp).classList.toggle("noUserSelect",e)}addShouldRescale(e){d(this,Pl).add(e)}removeShouldRescale(e){d(this,Pl).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Ma.PDF_TO_CSS_UNITS;for(const n of d(this,Pl))n.onScaleChanging();(t=d(this,eo))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}=t,o=t.toString(),u=k(this,ae,Qg).call(this,t).closest(".textLayer"),h=this.getSelectionBoxes(u);if(!h)return;t.empty();const f=k(this,ae,nb).call(this,u),p=d(this,os)===Pe.NONE,m=()=>{f==null||f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(Pe.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&d(this,zi)&&!d(this,zi).has(e.id)&&d(this,zi).setValue(e.id,e)}a11yAlert(e,t=null){const n=d(this,yp);n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,d(this,so)&&(S(this,so,!1),k(this,ae,Zg).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of d(this,st))if(t.div.contains(e)){S(this,Rl,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!d(this,Rl))return;const[e,t]=d(this,Rl);S(this,Rl,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){k(this,ae,rb).call(this),k(this,ae,ib).call(this)}removeEditListeners(){k(this,ae,Oj).call(this),k(this,ae,ab).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of d(this,Dr))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of d(this,Dr))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=d(this,jn))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of d(this,st)){const i=r.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const a of d(this,Dr))if(a.isHandlingMimeForPasting(i.type)){a.paste(i,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(i){Le(`paste: "${i.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const i=[];for(const l of n){const u=await r.deserialize(l);if(!u)return;i.push(u)}const a=()=>{for(const l of i)k(this,ae,ob).call(this,l);k(this,ae,lb).call(this,i)},o=()=>{for(const l of i)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(i){Le(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),d(this,os)!==Pe.NONE&&!this.isEditorHandlingKeyboard&&Iu._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,d(this,so)&&(S(this,so,!1),k(this,ae,Zg).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(k(this,ae,Mj).call(this),k(this,ae,ib).call(this),k(this,ae,Xs).call(this,{isEditing:d(this,os)!==Pe.NONE,isEmpty:k(this,ae,Gh).call(this),hasSomethingToUndo:d(this,cr).hasSomethingToUndo(),hasSomethingToRedo:d(this,cr).hasSomethingToRedo(),hasSelectedEditor:!1})):(k(this,ae,Ij).call(this),k(this,ae,ab).call(this),k(this,ae,Xs).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!d(this,Dr)){S(this,Dr,e);for(const t of d(this,Dr))k(this,ae,Oi).call(this,t.defaultPropertiesToUpdate)}}getId(){return d(this,wy).id}get currentLayer(){return d(this,ws).get(d(this,Zu))}getLayer(e){return d(this,ws).get(e)}get currentPageIndex(){return d(this,Zu)}addLayer(e){d(this,ws).set(e.pageIndex,e),d(this,no)?e.enable():e.disable()}removeLayer(e){d(this,ws).delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1){var i,a,o;if(d(this,os)!==e&&!(d(this,ur)&&(await d(this,ur).promise,!d(this,ur)))){if(S(this,ur,Promise.withResolvers()),(i=d(this,eo))==null||i.commitOrRemove(),S(this,os,e),e===Pe.NONE){this.setEditingState(!1),k(this,ae,Uj).call(this),(a=this._editorUndoBar)==null||a.hide(),d(this,ur).resolve();return}e===Pe.SIGNATURE&&await((o=d(this,ao))==null?void 0:o.loadSignatures()),this.setEditingState(!0),await k(this,ae,$j).call(this),this.unselectAll();for(const l of d(this,ws).values())l.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),d(this,ur).resolve();return}for(const l of d(this,es).values())l.annotationElementId===t||l.id===t?(this.setSelected(l),r&&l.enterInEditMode()):l.unselect();d(this,ur).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==d(this,os)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){var n;if(d(this,Dr)){switch(e){case We.CREATE:this.currentLayer.addNewEditor(t);return;case We.HIGHLIGHT_DEFAULT_COLOR:(n=d(this,Ll))==null||n.updateColor(t);break;case We.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(d(this,pp)||S(this,pp,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of d(this,st))r.updateParams(e,t);for(const r of d(this,Dr))r.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var i;for(const a of d(this,es).values())a.editorType===e&&a.show(t);(((i=d(this,pp))==null?void 0:i.get(We.HIGHLIGHT_SHOW_ALL))??!0)!==t&&k(this,ae,Oi).call(this,[[We.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(d(this,hp)!==e){S(this,hp,e);for(const t of d(this,ws).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const n of d(this,es).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return d(this,es).get(e)}addEditor(e){d(this,es).set(e.id,e)}removeEditor(e){var t,n;e.div.contains(document.activeElement)&&(d(this,di)&&clearTimeout(d(this,di)),S(this,di,setTimeout(()=>{this.focusMainContainer(),S(this,di,null)},0))),d(this,es).delete(e.id),e.annotationElementId&&((t=d(this,io))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!d(this,jl).has(e.annotationElementId))&&((n=d(this,zi))==null||n.remove(e.id))}addDeletedAnnotationElement(e){d(this,jl).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return d(this,jl).has(e)}removeDeletedAnnotationElement(e){d(this,jl).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){d(this,jn)!==e&&(S(this,jn,e),e&&k(this,ae,Oi).call(this,e.propertiesToUpdate))}updateUI(e){d(this,ae,Bj)===e&&k(this,ae,Oi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){k(this,ae,Oi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(d(this,st).has(e)){d(this,st).delete(e),e.unselect(),k(this,ae,Xs).call(this,{hasSelectedEditor:this.hasSelection});return}d(this,st).add(e),e.select(),k(this,ae,Oi).call(this,e.propertiesToUpdate),k(this,ae,Xs).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.id}),(t=d(this,eo))==null||t.commitOrRemove();for(const n of d(this,st))n!==e&&n.unselect();d(this,st).clear(),d(this,st).add(e),e.select(),k(this,ae,Oi).call(this,e.propertiesToUpdate),k(this,ae,Xs).call(this,{hasSelectedEditor:!0})}isSelected(e){return d(this,st).has(e)}get firstSelectedEditor(){return d(this,st).values().next().value}unselect(e){e.unselect(),d(this,st).delete(e),k(this,ae,Xs).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return d(this,st).size!==0}get isEnterHandled(){return d(this,st).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;d(this,cr).undo(),k(this,ae,Xs).call(this,{hasSomethingToUndo:d(this,cr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:k(this,ae,Gh).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){d(this,cr).redo(),k(this,ae,Xs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:d(this,cr).hasSomethingToRedo(),isEmpty:k(this,ae,Gh).call(this)})}addCommands(e){d(this,cr).add(e),k(this,ae,Xs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:k(this,ae,Gh).call(this)})}cleanUndoStack(e){d(this,cr).cleanType(e)}delete(){var i;this.commitOrRemove();const e=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...d(this,st)],n=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)k(this,ae,ob).call(this,a)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=d(this,jn))==null||e.commitOrRemove()}hasSomethingToControl(){return d(this,jn)||this.hasSelection}selectAll(){for(const e of d(this,st))e.commit();k(this,ae,lb).call(this,d(this,es).values())}unselectAll(){var e;if(!(d(this,jn)&&(d(this,jn).commitOrRemove(),d(this,os)!==Pe.NONE))&&!((e=d(this,eo))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of d(this,st))t.unselect();d(this,st).clear(),k(this,ae,Xs).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;d(this,oo)[0]+=e,d(this,oo)[1]+=t;const[r,i]=d(this,oo),a=[...d(this,st)],o=1e3;d(this,fi)&&clearTimeout(d(this,fi)),S(this,fi,setTimeout(()=>{S(this,fi,null),d(this,oo)[0]=d(this,oo)[1]=0,this.addCommands({cmd:()=>{for(const l of a)d(this,es).has(l.id)&&(l.translateInPage(r,i),l.translationDone())},undo:()=>{for(const l of a)d(this,es).has(l.id)&&(l.translateInPage(-r,-i),l.translationDone())},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),S(this,ui,new Map);for(const e of d(this,st))d(this,ui).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!d(this,ui))return!1;this.disableUserSelect(!1);const e=d(this,ui);S(this,ui,null);let t=!1;for(const[{x:r,y:i,pageIndex:a},o]of e)o.newX=r,o.newY=i,o.newPageIndex=a,t||(t=r!==o.savedX||i!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const n=(r,i,a,o)=>{if(d(this,es).has(r.id)){const l=d(this,ws).get(o);l?r._setParentAndPosition(l,i,a):(r.pageIndex=o,r.x=i,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:i,newY:a,newPageIndex:o}]of e)n(r,i,a,o)},undo:()=>{for(const[r,{savedX:i,savedY:a,savedPageIndex:o}]of e)n(r,i,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(d(this,ui))for(const n of d(this,ui).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||d(this,st).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return d(this,jn)===e}getActive(){return d(this,jn)}getMode(){return d(this,os)}get imageManager(){return Ve(this,"imageManager",new tb)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,h=t.rangeCount;u<h;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:n,y:r,width:i,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(u,h,f,p)=>({x:(h-r)/a,y:1-(u+f-n)/i,width:p/a,height:f/i});break;case"180":o=(u,h,f,p)=>({x:1-(u+f-n)/i,y:1-(h+p-r)/a,width:f/i,height:p/a});break;case"270":o=(u,h,f,p)=>({x:1-(h+p-r)/a,y:(u-n)/i,width:p/a,height:f/i});break;default:o=(u,h,f,p)=>({x:(u-n)/i,y:(h-r)/a,width:f/i,height:p/a});break}const l=[];for(let u=0,h=t.rangeCount;u<h;u++){const f=t.getRangeAt(u);if(!f.collapsed)for(const{x:p,y:m,width:g,height:y}of f.getClientRects())g===0||y===0||l.push(o(p,m,g,y))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(d(this,Qu)||S(this,Qu,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=d(this,Qu))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=d(this,Qu))==null?void 0:r.get(e.data.id);if(!t)return;const n=d(this,zi).getRawValue(t);n&&(d(this,os)===Pe.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){var i;const r=(i=d(this,io))==null?void 0:i.get(e);r&&(r.setCanvas(t,n),d(this,io).delete(e))}addMissingCanvas(e,t){(d(this,io)||S(this,io,new Map)).set(e,t)}};Yu=new WeakMap,jn=new WeakMap,es=new WeakMap,ws=new WeakMap,Ju=new WeakMap,zi=new WeakMap,Qu=new WeakMap,cr=new WeakMap,Za=new WeakMap,eo=new WeakMap,Zu=new WeakMap,jl=new WeakMap,ui=new WeakMap,Dr=new WeakMap,Pl=new WeakMap,cp=new WeakMap,up=new WeakMap,ed=new WeakMap,dp=new WeakMap,di=new WeakMap,to=new WeakMap,td=new WeakMap,so=new WeakMap,hi=new WeakMap,wy=new WeakMap,no=new WeakMap,hp=new WeakMap,ro=new WeakMap,Rl=new WeakMap,Ll=new WeakMap,io=new WeakMap,fp=new WeakMap,os=new WeakMap,st=new WeakMap,Wi=new WeakMap,ao=new WeakMap,Dl=new WeakMap,pp=new WeakMap,mp=new WeakMap,oo=new WeakMap,fi=new WeakMap,Gi=new WeakMap,gp=new WeakMap,yp=new WeakMap,ur=new WeakMap,ae=new WeakSet,Qg=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},nb=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of d(this,ws).values())if(n.hasTextLayer(e))return n;return null},Rj=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=k(this,ae,Qg).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(d(this,hi)||S(this,hi,new y6(this)),d(this,hi).show(n,r,this.direction==="ltr"))},Lj=function(){var i,a,o;const e=document.getSelection();if(!e||e.isCollapsed){d(this,Wi)&&((i=d(this,hi))==null||i.hide(),S(this,Wi,null),k(this,ae,Xs).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===d(this,Wi))return;const r=k(this,ae,Qg).call(this,e).closest(".textLayer");if(!r){d(this,Wi)&&((a=d(this,hi))==null||a.hide(),S(this,Wi,null),k(this,ae,Xs).call(this,{hasSelectedText:!1}));return}if((o=d(this,hi))==null||o.hide(),S(this,Wi,t),k(this,ae,Xs).call(this,{hasSelectedText:!0}),!(d(this,os)!==Pe.HIGHLIGHT&&d(this,os)!==Pe.NONE)&&(d(this,os)===Pe.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),S(this,so,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=d(this,os)===Pe.HIGHLIGHT?k(this,ae,nb).call(this,r):null;l==null||l.toggleDrawing();const u=new AbortController,h=this.combinedSignal(u),f=p=>{p.type==="pointerup"&&p.button!==0||(u.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&k(this,ae,Zg).call(this,"main_toolbar"))};window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("blur",f,{signal:h})}},Zg=function(e=""){d(this,os)===Pe.HIGHLIGHT?this.highlightSelection(e):d(this,cp)&&k(this,ae,Rj).call(this)},Dj=function(){document.addEventListener("selectionchange",k(this,ae,Lj).bind(this),{signal:this._signal})},Mj=function(){if(d(this,to))return;S(this,to,new AbortController);const e=this.combinedSignal(d(this,to));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Ij=function(){var e;(e=d(this,to))==null||e.abort(),S(this,to,null)},rb=function(){if(d(this,ro))return;S(this,ro,new AbortController);const e=this.combinedSignal(d(this,ro));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Oj=function(){var e;(e=d(this,ro))==null||e.abort(),S(this,ro,null)},ib=function(){if(d(this,Za))return;S(this,Za,new AbortController);const e=this.combinedSignal(d(this,Za));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},ab=function(){var e;(e=d(this,Za))==null||e.abort(),S(this,Za,null)},Fj=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Xs=function(e){Object.entries(e).some(([n,r])=>d(this,mp)[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(d(this,mp),e)}),d(this,os)===Pe.HIGHLIGHT&&e.hasSelectedEditor===!1&&k(this,ae,Oi).call(this,[[We.HIGHLIGHT_FREE,!0]]))},Oi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},$j=async function(){if(!d(this,no)){S(this,no,!0);const e=[];for(const t of d(this,ws).values())e.push(t.enable());await Promise.all(e);for(const t of d(this,es).values())t.enable()}},Uj=function(){if(this.unselectAll(),d(this,no)){S(this,no,!1);for(const e of d(this,ws).values())e.disable();for(const e of d(this,es).values())e.disable()}},ob=function(e){const t=d(this,ws).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Bj=function(){let e=null;for(e of d(this,st));return e},Gh=function(){if(d(this,es).size===0)return!0;if(d(this,es).size===1)for(const e of d(this,es).values())return e.isEmpty();return!1},lb=function(e){for(const t of d(this,st))t.unselect();d(this,st).clear();for(const t of e)t.isEmpty()||(d(this,st).add(t),t.select());k(this,ae,Xs).call(this,{hasSelectedEditor:this.hasSelection})},re(Iu,"TRANSLATE_SMALL",1),re(Iu,"TRANSLATE_BIG",10);let Jo=Iu;var ls,pi,Mr,sd,mi,Pn,nd,gi,yn,qi,Ml,yi,lo,Yr,qh,e0;const Ys=class Ys{constructor(e){A(this,Yr);A(this,ls,null);A(this,pi,!1);A(this,Mr,null);A(this,sd,null);A(this,mi,null);A(this,Pn,null);A(this,nd,!1);A(this,gi,null);A(this,yn,null);A(this,qi,null);A(this,Ml,null);A(this,yi,!1);S(this,yn,e),S(this,yi,e._uiManager.useNewAltTextFlow),d(Ys,lo)||S(Ys,lo,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Ys._l10n??(Ys._l10n=e)}async render(){const e=S(this,Mr,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=S(this,sd,document.createElement("span"));e.append(t),d(this,yi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",d(Ys,lo).missing),t.setAttribute("data-l10n-id",d(Ys,lo)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=d(this,yn)._uiManager._signal;e.addEventListener("contextmenu",Er,{signal:n}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:n});const r=i=>{i.preventDefault(),d(this,yn)._uiManager.editAltText(d(this,yn)),d(this,yi)&&d(this,yn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:d(this,Yr,qh)}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(S(this,nd,!0),r(i))},{signal:n}),await k(this,Yr,e0).call(this),e}finish(){d(this,Mr)&&(d(this,Mr).focus({focusVisible:d(this,nd)}),S(this,nd,!1))}isEmpty(){return d(this,yi)?d(this,ls)===null:!d(this,ls)&&!d(this,pi)}hasData(){return d(this,yi)?d(this,ls)!==null||!!d(this,qi):this.isEmpty()}get guessedText(){return d(this,qi)}async setGuessedText(e){d(this,ls)===null&&(S(this,qi,e),S(this,Ml,await Ys._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),k(this,Yr,e0).call(this))}toggleAltTextBadge(e=!1){var t;if(!d(this,yi)||d(this,ls)){(t=d(this,gi))==null||t.remove(),S(this,gi,null);return}if(!d(this,gi)){const n=S(this,gi,document.createElement("div"));n.className="noAltTextBadge",d(this,yn).div.append(n)}d(this,gi).classList.toggle("hidden",!e)}serialize(e){let t=d(this,ls);return!e&&d(this,qi)===t&&(t=d(this,Ml)),{altText:t,decorative:d(this,pi),guessedText:d(this,qi),textWithDisclaimer:d(this,Ml)}}get data(){return{altText:d(this,ls),decorative:d(this,pi)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:i=!1}){n&&(S(this,qi,n),S(this,Ml,r)),!(d(this,ls)===e&&d(this,pi)===t)&&(i||(S(this,ls,e),S(this,pi,t)),k(this,Yr,e0).call(this))}toggle(e=!1){d(this,Mr)&&(!e&&d(this,Pn)&&(clearTimeout(d(this,Pn)),S(this,Pn,null)),d(this,Mr).disabled=!e)}shown(){d(this,yn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:d(this,Yr,qh)}})}destroy(){var e,t;(e=d(this,Mr))==null||e.remove(),S(this,Mr,null),S(this,sd,null),S(this,mi,null),(t=d(this,gi))==null||t.remove(),S(this,gi,null)}};ls=new WeakMap,pi=new WeakMap,Mr=new WeakMap,sd=new WeakMap,mi=new WeakMap,Pn=new WeakMap,nd=new WeakMap,gi=new WeakMap,yn=new WeakMap,qi=new WeakMap,Ml=new WeakMap,yi=new WeakMap,lo=new WeakMap,Yr=new WeakSet,qh=function(){return d(this,ls)&&"added"||d(this,ls)===null&&this.guessedText&&"review"||"missing"},e0=async function(){var r,i,a;const e=d(this,Mr);if(!e)return;if(d(this,yi)){if(e.classList.toggle("done",!!d(this,ls)),e.setAttribute("data-l10n-id",d(Ys,lo)[d(this,Yr,qh)]),(r=d(this,sd))==null||r.setAttribute("data-l10n-id",d(Ys,lo)[`${d(this,Yr,qh)}-label`]),!d(this,ls)){(i=d(this,mi))==null||i.remove();return}}else{if(!d(this,ls)&&!d(this,pi)){e.classList.remove("done"),(a=d(this,mi))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=d(this,mi);if(!t){S(this,mi,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${d(this,yn).id}`;const o=100,l=d(this,yn)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(d(this,Pn)),S(this,Pn,null)},{once:!0}),e.addEventListener("mouseenter",()=>{S(this,Pn,setTimeout(()=>{S(this,Pn,null),d(this,mi).classList.add("show"),d(this,yn)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var u;d(this,Pn)&&(clearTimeout(d(this,Pn)),S(this,Pn,null)),(u=d(this,mi))==null||u.classList.remove("show")},{signal:l})}d(this,pi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=d(this,ls)),t.parentNode||e.append(t);const n=d(this,yn).getElementForAltText();n==null||n.setAttribute("aria-describedby",t.id)},A(Ys,lo,null),re(Ys,"_l10n",null);let uy=Ys;var rd,Il,vp,xp,wp,bp,Sp,Ki,Ol,Xi,Fl,Yi,Zo,Hj,Vj,zj;const eE=class eE{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:a=null,signal:o}){A(this,Zo);A(this,rd);A(this,Il,!1);A(this,vp,null);A(this,xp);A(this,wp);A(this,bp);A(this,Sp);A(this,Ki,null);A(this,Ol);A(this,Xi,null);A(this,Fl);A(this,Yi,null);S(this,rd,e),S(this,vp,n),S(this,xp,t),S(this,wp,r),S(this,bp,i),S(this,Sp,a),S(this,Fl,new AbortController),S(this,Ol,AbortSignal.any([o,d(this,Fl).signal])),e.addEventListener("touchstart",k(this,Zo,Hj).bind(this),{passive:!1,signal:d(this,Ol)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ei.pixelRatio}destroy(){var e,t;(e=d(this,Fl))==null||e.abort(),S(this,Fl,null),(t=d(this,Ki))==null||t.abort(),S(this,Ki,null)}};rd=new WeakMap,Il=new WeakMap,vp=new WeakMap,xp=new WeakMap,wp=new WeakMap,bp=new WeakMap,Sp=new WeakMap,Ki=new WeakMap,Ol=new WeakMap,Xi=new WeakMap,Fl=new WeakMap,Yi=new WeakMap,Zo=new WeakSet,Hj=function(e){var r,i,a;if((r=d(this,xp))!=null&&r.call(this))return;if(e.touches.length===1){if(d(this,Ki))return;const o=S(this,Ki,new AbortController),l=AbortSignal.any([d(this,Ol),o.signal]),u=d(this,rd),h={capture:!0,signal:l,passive:!1},f=p=>{var m;p.pointerType==="touch"&&((m=d(this,Ki))==null||m.abort(),S(this,Ki,null))};u.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(Ut(p),f(p))},h),u.addEventListener("pointerup",f,h),u.addEventListener("pointercancel",f,h);return}if(!d(this,Yi)){S(this,Yi,new AbortController);const o=AbortSignal.any([d(this,Ol),d(this,Yi).signal]),l=d(this,rd),u={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",k(this,Zo,Vj).bind(this),u);const h=k(this,Zo,zj).bind(this);l.addEventListener("touchend",h,u),l.addEventListener("touchcancel",h,u),u.capture=!0,l.addEventListener("pointerdown",Ut,u),l.addEventListener("pointermove",Ut,u),l.addEventListener("pointercancel",Ut,u),l.addEventListener("pointerup",Ut,u),(i=d(this,wp))==null||i.call(this)}if(Ut(e),e.touches.length!==2||(a=d(this,vp))!=null&&a.call(this)){S(this,Xi,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),S(this,Xi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},Vj=function(e){var E;if(!d(this,Xi)||e.touches.length!==2)return;Ut(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:i}=t,{screenX:a,screenY:o}=n,l=d(this,Xi),{touch0X:u,touch0Y:h,touch1X:f,touch1Y:p}=l,m=f-u,g=p-h,y=a-r,b=o-i,v=Math.hypot(y,b)||1,x=Math.hypot(m,g)||1;if(!d(this,Il)&&Math.abs(x-v)<=eE.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=r,l.touch0Y=i,l.touch1X=a,l.touch1Y=o,!d(this,Il)){S(this,Il,!0);return}const w=[(r+a)/2,(i+o)/2];(E=d(this,bp))==null||E.call(this,w,x,v)},zj=function(e){var t;e.touches.length>=2||(d(this,Yi)&&(d(this,Yi).abort(),S(this,Yi,null),(t=d(this,Sp))==null||t.call(this)),d(this,Xi)&&(Ut(e),S(this,Xi,null),S(this,Il,!1)))};let Qf=eE;var $l,Ir,_t,id,co,_p,Ul,bs,Bl,Ji,uo,Ep,Hl,Rn,Ap,Vl,Qi,vi,ad,od,dr,zl,kp,by,_e,cb,Tp,ub,t0,Wj,Gj,db,s0,hb,qj,Kj,Xj,fb,Yj,pb,Jj,Qj,Zj,mb,Kh;const Fe=class Fe{constructor(e){A(this,_e);A(this,$l,null);A(this,Ir,null);A(this,_t,null);A(this,id,!1);A(this,co,null);A(this,_p,"");A(this,Ul,!1);A(this,bs,null);A(this,Bl,null);A(this,Ji,null);A(this,uo,null);A(this,Ep,"");A(this,Hl,!1);A(this,Rn,null);A(this,Ap,!1);A(this,Vl,!1);A(this,Qi,!1);A(this,vi,null);A(this,ad,0);A(this,od,0);A(this,dr,null);A(this,zl,null);re(this,"isSelected",!1);re(this,"_isCopy",!1);re(this,"_editToolbar",null);re(this,"_initialOptions",Object.create(null));re(this,"_initialData",null);re(this,"_isVisible",!0);re(this,"_uiManager",null);re(this,"_focusEventsAllowed",!0);A(this,kp,!1);A(this,by,Fe._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[i,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Fe.prototype._resizeWithKeyboard,t=Jo.TRANSLATE_SMALL,n=Jo.TRANSLATE_BIG;return Ve(this,"_resizerKeyboardManager",new Ym([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Fe.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Ve(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new w6({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Fe._l10n??(Fe._l10n=e),Fe._l10nResizer||(Fe._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Fe._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);Fe._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){at("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return d(this,kp)}set _isDraggable(e){var t;S(this,kp,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=d(this,by)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):k(this,_e,Kh).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(d(this,Hl)?S(this,Hl,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[i,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}translate(e,t){k(this,_e,cb).call(this,this.parentDimensions,e,t)}translateInPage(e,t){d(this,Rn)||S(this,Rn,[this.x,this.y,this.width,this.height]),k(this,_e,cb).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){d(this,Rn)||S(this,Rn,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,u]=this.getBaseTranslation();a+=l,o+=u;const{style:h}=n;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!d(this,Rn)&&(d(this,Rn)[0]!==this.x||d(this,Rn)[1]!==this.y)}get _hasBeenResized(){return!!d(this,Rn)&&(d(this,Rn)[2]!==this.width||d(this,Rn)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=Fe,r=n/e,i=n/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:i,y:a,width:o,height:l}=this;if(o*=n,l*=r,i*=n,a*=r,this._mustFixPosition)switch(e){case 0:i=$s(i,0,n-o),a=$s(a,0,r-l);break;case 90:i=$s(i,0,n-l),a=$s(a,o,r);break;case 180:i=$s(i,o,n),a=$s(a,l,r);break;case 270:i=$s(i,l,n),a=$s(a,0,r-o);break}this.x=i/=n,this.y=a/=r;const[u,h]=this.getBaseTranslation();i+=u,a+=h,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return k(n=Fe,Tp,ub).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return k(n=Fe,Tp,ub).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){const[n,r]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/n).toFixed(2)}%`,d(this,Ul)||(i.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:n}=e,r=n.endsWith("%"),i=!d(this,Ul)&&t.endsWith("%");if(r&&i)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(n)/a).toFixed(2)}%`),!d(this,Ul)&&!i&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=d(this,_t))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||d(this,Vl))return this._editToolbar;this._editToolbar=new eb(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=d(this,_t))==null||e.destroy())}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return d(this,_t)||(uy.initialize(Fe._l10n),S(this,_t,new uy(this)),d(this,$l)&&(d(this,_t).data=d(this,$l),S(this,$l,null))),d(this,_t)}get altTextData(){var e;return(e=d(this,_t))==null?void 0:e.data}set altTextData(e){d(this,_t)&&(d(this,_t).data=e)}get guessedAltText(){var e;return(e=d(this,_t))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=d(this,_t))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=d(this,_t))==null?void 0:t.serialize(e)}hasAltText(){return!!d(this,_t)&&!d(this,_t).isEmpty()}hasAltTextData(){var e;return((e=d(this,_t))==null?void 0:e.hasData())??!1}render(){var a;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=d(this,id)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),k(this,_e,pb).call(this);const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,i]=this.getInitialTranslation();return this.translate(r,i),jj(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(d(this,zl)||S(this,zl,new Qf({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:k(this,_e,qj).bind(this),onPinching:k(this,_e,Kj).bind(this),onPinchEnd:k(this,_e,Xj).bind(this),signal:this._uiManager._signal}))),(a=this._uiManager._editorUndoBar)==null||a.hide(),e}pointerdown(e){const{isMac:t}=gs.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(S(this,Hl,!0),this._isDraggable){k(this,_e,Yj).call(this,e);return}k(this,_e,fb).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){d(this,vi)&&clearTimeout(d(this,vi)),S(this,vi,setTimeout(()=>{var e;S(this,vi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[i,a]=this.pageDimensions,[o,l]=this.pageTranslation,u=e/r,h=t/r,f=this.x*i,p=this.y*a,m=this.width*i,g=this.height*a;switch(n){case 0:return[f+u+o,a-p-h-g+l,f+u+m+o,a-p-h+l];case 90:return[f+h+o,a-p+u+l,f+h+g+o,a-p+u+m+l];case 180:return[f-u-m+o,a-p+h+l,f-u+o,a-p+h+g+l];case 270:return[f-h-g+o,a-p-u-m+l,f-h+o,a-p-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,i,a]=e,o=i-n,l=a-r;switch(this.rotation){case 0:return[n,t-a,o,l];case 90:return[n,t-r,l,o];case 180:return[i,t-r,o,l];case 270:return[i,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),S(this,Vl,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),S(this,Vl,!1),!0):!1}isInEditMode(){return d(this,Vl)}shouldGetKeyboardEvents(){return d(this,Qi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return t<a&&r>0&&e<i&&n>0}rebuild(){k(this,_e,pb).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){at("An editor must be serializable")}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId});r.rotation=e.rotation,S(r,$l,e.accessibilityData),r._isCopy=e.isCopy||!1;const[i,a]=r.pageDimensions,[o,l,u,h]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=l/a,r.width=u/i,r.height=h/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=d(this,uo))==null||e.abort(),S(this,uo,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),d(this,vi)&&(clearTimeout(d(this,vi)),S(this,vi,null)),k(this,_e,Kh).call(this),this.removeEditToolbar(),d(this,dr)){for(const n of d(this,dr).values())clearTimeout(n);S(this,dr,null)}this.parent=null,(t=d(this,zl))==null||t.destroy(),S(this,zl,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(k(this,_e,Wj).call(this),d(this,bs).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),S(this,Ji,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=d(this,bs).children;if(!d(this,Ir)){S(this,Ir,Array.from(t));const a=k(this,_e,Jj).bind(this),o=k(this,_e,Qj).bind(this),l=this._uiManager._signal;for(const u of d(this,Ir)){const h=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:l}),u.addEventListener("blur",o,{signal:l}),u.addEventListener("focus",k(this,_e,Zj).bind(this,h),{signal:l}),u.setAttribute("data-l10n-id",Fe._l10nResizer[h])}}const n=d(this,Ir)[0];let r=0;for(const a of t){if(a===n)break;r++}const i=(360-this.rotation+this.parentRotation)%360/90*(d(this,Ir).length/4);if(i!==r){if(i<r)for(let o=0;o<r-i;o++)d(this,bs).append(d(this,bs).firstChild);else if(i>r)for(let o=0;o<i-r;o++)d(this,bs).firstChild.before(d(this,bs).lastChild);let a=0;for(const o of t){const u=d(this,Ir)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",Fe._l10nResizer[u])}}k(this,_e,mb).call(this,0),S(this,Qi,!0),d(this,bs).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){d(this,Qi)&&k(this,_e,hb).call(this,d(this,Ep),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){k(this,_e,Kh).call(this),this.div.focus()}select(){var e,t,n;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,i;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(t=this._editToolbar)==null||t.show(),(n=d(this,_t))==null||n.toggleAltTextBadge(!1)}}unselect(){var e,t,n,r,i;this.isSelected&&(this.isSelected=!1,(e=d(this,bs))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(i=d(this,_t))==null||i.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return d(this,Ap)}set isEditing(e){S(this,Ap,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){S(this,Ul,!0);const n=e/t,{style:r}=this.div;r.aspectRatio=n,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){d(this,dr)||S(this,dr,new Map);const{action:n}=e;let r=d(this,dr).get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),d(this,dr).delete(n),d(this,dr).size===0&&S(this,dr,null)},Fe._telemetryTimeout),d(this,dr).set(n,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),S(this,id,!1)}disable(){this.div&&(this.div.tabIndex=-1),S(this,id,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};$l=new WeakMap,Ir=new WeakMap,_t=new WeakMap,id=new WeakMap,co=new WeakMap,_p=new WeakMap,Ul=new WeakMap,bs=new WeakMap,Bl=new WeakMap,Ji=new WeakMap,uo=new WeakMap,Ep=new WeakMap,Hl=new WeakMap,Rn=new WeakMap,Ap=new WeakMap,Vl=new WeakMap,Qi=new WeakMap,vi=new WeakMap,ad=new WeakMap,od=new WeakMap,dr=new WeakMap,zl=new WeakMap,kp=new WeakMap,by=new WeakMap,_e=new WeakSet,cb=function([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Tp=new WeakSet,ub=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},t0=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},Wj=function(){if(d(this,bs))return;S(this,bs,document.createElement("div")),d(this,bs).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");d(this,bs).append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",k(this,_e,Gj).bind(this,n),{signal:t}),r.addEventListener("contextmenu",Er,{signal:t}),r.tabIndex=-1}this.div.prepend(d(this,bs))},Gj=function(e,t){var h;t.preventDefault();const{isMac:n}=gs.platform;if(t.button!==0||t.ctrlKey&&n)return;(h=d(this,_t))==null||h.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,S(this,Bl,[t.screenX,t.screenY]);const i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",k(this,_e,hb).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Ut,{passive:!1,signal:a}),window.addEventListener("contextmenu",Er,{signal:a}),S(this,Ji,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var f;i.abort(),this.parent.togglePointerEvents(!0),(f=d(this,_t))==null||f.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=l,k(this,_e,s0).call(this)};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})},db=function(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t;const[i,a]=this.parentDimensions;this.setDims(i*n,a*r),this.fixAndSetPosition(),this._onResized()},s0=function(){if(!d(this,Ji))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=d(this,Ji);S(this,Ji,null);const i=this.x,a=this.y,o=this.width,l=this.height;i===e&&a===t&&o===n&&l===r||this.addCommands({cmd:k(this,_e,db).bind(this,i,a,o,l),undo:k(this,_e,db).bind(this,e,t,n,r),mustExec:!0})},hb=function(e,t){const[n,r]=this.parentDimensions,i=this.x,a=this.y,o=this.width,l=this.height,u=Fe.MIN_SIZE/n,h=Fe.MIN_SIZE/r,f=k(this,_e,t0).call(this,this.rotation),p=($,H)=>[f[0]*$+f[2]*H,f[1]*$+f[3]*H],m=k(this,_e,t0).call(this,360-this.rotation),g=($,H)=>[m[0]*$+m[2]*H,m[1]*$+m[3]*H];let y,b,v=!1,x=!1;switch(e){case"topLeft":v=!0,y=($,H)=>[0,0],b=($,H)=>[$,H];break;case"topMiddle":y=($,H)=>[$/2,0],b=($,H)=>[$/2,H];break;case"topRight":v=!0,y=($,H)=>[$,0],b=($,H)=>[0,H];break;case"middleRight":x=!0,y=($,H)=>[$,H/2],b=($,H)=>[0,H/2];break;case"bottomRight":v=!0,y=($,H)=>[$,H],b=($,H)=>[0,0];break;case"bottomMiddle":y=($,H)=>[$/2,H],b=($,H)=>[$/2,0];break;case"bottomLeft":v=!0,y=($,H)=>[0,H],b=($,H)=>[$,0];break;case"middleLeft":x=!0,y=($,H)=>[0,H/2],b=($,H)=>[$,H/2];break}const w=y(o,l),E=b(o,l);let T=p(...E);const C=Fe._round(i+T[0]),N=Fe._round(a+T[1]);let j=1,P=1,M,V;if(t.fromKeyboard)({deltaX:M,deltaY:V}=t);else{const{screenX:$,screenY:H}=t,[D,F]=d(this,Bl);[M,V]=this.screenToPageTranslation($-D,H-F),d(this,Bl)[0]=$,d(this,Bl)[1]=H}if([M,V]=g(M/n,V/r),v){const $=Math.hypot(o,l);j=P=Math.max(Math.min(Math.hypot(E[0]-w[0]-M,E[1]-w[1]-V)/$,1/o,1/l),u/o,h/l)}else x?j=$s(Math.abs(E[0]-w[0]-M),u,1)/o:P=$s(Math.abs(E[1]-w[1]-V),h,1)/l;const L=Fe._round(o*j),I=Fe._round(l*P);T=p(...b(L,I));const O=C-T[0],X=N-T[1];d(this,Rn)||S(this,Rn,[this.x,this.y,this.width,this.height]),this.width=L,this.height=I,this.x=O,this.y=X,this.setDims(n*L,r*I),this.fixAndSetPosition(),this._onResizing()},qj=function(){var e;S(this,Ji,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=d(this,_t))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Kj=function(e,t,n){let i=.7*(n/t)+1-.7;if(i===1)return;const a=k(this,_e,t0).call(this,this.rotation),o=(C,N)=>[a[0]*C+a[2]*N,a[1]*C+a[3]*N],[l,u]=this.parentDimensions,h=this.x,f=this.y,p=this.width,m=this.height,g=Fe.MIN_SIZE/l,y=Fe.MIN_SIZE/u;i=Math.max(Math.min(i,1/p,1/m),g/p,y/m);const b=Fe._round(p*i),v=Fe._round(m*i);if(b===p&&v===m)return;d(this,Rn)||S(this,Rn,[h,f,p,m]);const x=o(p/2,m/2),w=Fe._round(h+x[0]),E=Fe._round(f+x[1]),T=o(b/2,v/2);this.x=w-T[0],this.y=E-T[1],this.width=b,this.height=v,this.setDims(l*b,u*v),this.fixAndSetPosition(),this._onResizing()},Xj=function(){var e;(e=d(this,_t))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),k(this,_e,s0).call(this)},fb=function(e){const{isMac:t}=gs.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Yj=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,i=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:i},o=u=>{r.abort(),S(this,co,null),S(this,Hl,!1),this._uiManager.endDragSession()||k(this,_e,fb).call(this,u),n&&this._onStopDragging()};t&&(S(this,ad,e.clientX),S(this,od,e.clientY),S(this,co,e.pointerId),S(this,_p,e.pointerType),window.addEventListener("pointermove",u=>{n||(n=!0,this._onStartDragging());const{clientX:h,clientY:f,pointerId:p}=u;if(p!==d(this,co)){Ut(u);return}const[m,g]=this.screenToPageTranslation(h-d(this,ad),f-d(this,od));S(this,ad,h),S(this,od,f),this._uiManager.dragSelectedEditors(m,g)},a),window.addEventListener("touchmove",Ut,a),window.addEventListener("pointerdown",u=>{u.pointerType===d(this,_p)&&(d(this,zl)||u.isPrimary)&&o(u),Ut(u)},a));const l=u=>{if(!d(this,co)||d(this,co)===u.pointerId){o(u);return}Ut(u)};window.addEventListener("pointerup",l,{signal:i}),window.addEventListener("blur",l,{signal:i})},pb=function(){if(d(this,uo)||!this.div)return;S(this,uo,new AbortController);const e=this._uiManager.combinedSignal(d(this,uo));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Jj=function(e){Fe._resizerKeyboardManager.exec(this,e)},Qj=function(e){var t;d(this,Qi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==d(this,bs)&&k(this,_e,Kh).call(this)},Zj=function(e){S(this,Ep,d(this,Qi)?e:"")},mb=function(e){if(d(this,Ir))for(const t of d(this,Ir))t.tabIndex=e},Kh=function(){S(this,Qi,!1),k(this,_e,mb).call(this,-1),k(this,_e,s0).call(this)},A(Fe,Tp),re(Fe,"_l10n",null),re(Fe,"_l10nResizer",null),re(Fe,"_borderLineWidth",-1),re(Fe,"_colorManager",new sb),re(Fe,"_zIndex",1),re(Fe,"_telemetryTimeout",1e3);let gt=Fe;class w6 extends gt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ik=3285377520,ir=4294901760,ii=65535;class eP{constructor(e){this.h1=e?e&4294967295:ik,this.h2=e?e&4294967295:ik}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let y=0,b=e.length;y<b;y++){const v=e.charCodeAt(y);v<=255?t[n++]=v:(t[n++]=v>>>8,t[n++]=v&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,i=n-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,l=0,u=this.h1,h=this.h2;const f=3432918353,p=461845907,m=f&ii,g=p&ii;for(let y=0;y<r;y++)y&1?(o=a[y],o=o*f&ir|o*m&ii,o=o<<15|o>>>17,o=o*p&ir|o*g&ii,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(l=a[y],l=l*f&ir|l*m&ii,l=l<<15|l>>>17,l=l*p&ir|l*g&ii,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*f&ir|o*m&ii,o=o<<15|o>>>17,o=o*p&ir|o*g&ii,r&1?u^=o:h^=o}this.h1=u,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&ir|e*36045&ii,t=t*4283543511&ir|((t<<16|e>>>16)*2950163797&ir)>>>16,e^=t>>>1,e=e*444984403&ir|e*60499&ii,t=t*3301882366&ir|((t<<16|e>>>16)*3120437893&ir)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const gb=Object.freeze({map:null,hash:"",transfer:void 0});var Wl,Gl,Ss,Sy,tP;class V_{constructor(){A(this,Sy);A(this,Wl,!1);A(this,Gl,null);A(this,Ss,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=d(this,Ss).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return d(this,Ss).get(e)}remove(e){if(d(this,Ss).delete(e),d(this,Ss).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of d(this,Ss).values())if(t instanceof gt)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=d(this,Ss).get(e);let r=!1;if(n!==void 0)for(const[i,a]of Object.entries(t))n[i]!==a&&(r=!0,n[i]=a);else r=!0,d(this,Ss).set(e,t);r&&k(this,Sy,tP).call(this),t instanceof gt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return d(this,Ss).has(e)}get size(){return d(this,Ss).size}resetModified(){d(this,Wl)&&(S(this,Wl,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new sP(this)}get serializable(){if(d(this,Ss).size===0)return gb;const e=new Map,t=new eP,n=[],r=Object.create(null);let i=!1;for(const[a,o]of d(this,Ss)){const l=o instanceof gt?o.serialize(!1,r):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),i||(i=!!l.bitmap))}if(i)for(const a of e.values())a.bitmap&&n.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:gb}get editorStats(){let e=null;const t=new Map;for(const n of d(this,Ss).values()){if(!(n instanceof gt))continue;const r=n.telemetryFinalData;if(!r)continue;const{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));const a=e[i]||(e[i]=new Map);for(const[o,l]of Object.entries(r)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));const h=u.get(l)??0;u.set(l,h+1)}}for(const[n,r]of t)e[n]=r.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){S(this,Gl,null)}get modifiedIds(){if(d(this,Gl))return d(this,Gl);const e=[];for(const t of d(this,Ss).values())!(t instanceof gt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return S(this,Gl,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return d(this,Ss).entries()}}Wl=new WeakMap,Gl=new WeakMap,Ss=new WeakMap,Sy=new WeakSet,tP=function(){d(this,Wl)||(S(this,Wl,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Cp;class sP extends V_{constructor(t){super();A(this,Cp);const{map:n,hash:r,transfer:i}=t.serializable,a=structuredClone(n,i?{transfer:i}:null);S(this,Cp,{map:a,hash:r,transfer:i})}get print(){at("Should not call PrintAnnotationStorage.print")}get serializable(){return d(this,Cp)}get modifiedIds(){return Ve(this,"modifiedIds",{ids:new Set,hash:""})}}Cp=new WeakMap;var ld;class b6{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){A(this,ld,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),d(this,ld).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||d(this,ld).has(e.loadedName))){if(Kt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:i,style:a}=e,o=new FontFace(r,i,a);this.addNativeFontFace(o);try{await o.load(),d(this,ld).add(r),n==null||n(e)}catch{Le(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}at("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw Le(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Ve(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Ve(this,"isSyncFontLoadingSupported",tn||gs.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Kt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const i=n.shift();setTimeout(i.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ve(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(E,T){return E.charCodeAt(T)<<24|E.charCodeAt(T+1)<<16|E.charCodeAt(T+2)<<8|E.charCodeAt(T+3)&255}function r(E,T,C,N){const j=E.substring(0,T),P=E.substring(T+C);return j+N+P}let i,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let u=0;function h(E,T){if(++u>30){Le("Load test font never loaded."),T();return}if(l.font="30px "+E,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){T();return}setTimeout(h.bind(null,E,T))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=r(p,976,f.length,f);const g=16,y=1482184792;let b=n(p,g);for(i=0,a=f.length-3;i<a;i+=4)b=b-y+n(f,i)|0;i<f.length&&(b=b-y+n(f+"XXX",i)|0),p=r(p,g,4,c6(b));const v=`url(data:font/opentype;base64,${btoa(p)});`,x=`@font-face {font-family:"${f}";src:${v}}`;this.insertRule(x);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const E of[e.loadedName,f]){const T=this._document.createElement("span");T.textContent="Hi",T.style.fontFamily=E,w.append(T)}this._document.body.append(w),h(f,()=>{w.remove(),t.complete()})}}ld=new WeakMap;class S6{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const n in e)this[n]=e[n];this._inspectFont=t}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${wj(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(a){Le(`getPathGenerator - ignoring character: "${a}".`)}const i=new Path2D(r||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=i}}function _6(s){if(s instanceof URL)return s.href;if(typeof s=="string"){if(tn)return s;const e=URL.parse(s,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function E6(s){if(tn&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return qm(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Ng(s){if(typeof s!="string")return null;if(s.endsWith("/"))return s;throw new Error(`Invalid factory url: "${s}" must include trailing slash.`)}const yb=s=>typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0,A6=s=>typeof s=="object"&&typeof(s==null?void 0:s.name)=="string",nP=f6.bind(null,yb,A6);var Zi,_y;class k6{constructor(){A(this,Zi,new Map);A(this,_y,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};d(this,_y).then(()=>{for(const[r]of d(this,Zi))r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:i}=n;if(i.aborted){Le("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener("abort",a),i.addEventListener("abort",a)}d(this,Zi).set(t,r)}removeEventListener(e,t){const n=d(this,Zi).get(t);n==null||n(),d(this,Zi).delete(t)}terminate(){for(const[,e]of d(this,Zi))e==null||e();d(this,Zi).clear()}}Zi=new WeakMap,_y=new WeakMap;const jg={DATA:1,ERROR:2},zt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function ak(){}function mn(s){if(s instanceof Da||s instanceof ly||s instanceof sk||s instanceof Jf||s instanceof kx)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||at('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Da(s.message);case"InvalidPDFException":return new ly(s.message);case"PasswordException":return new sk(s.message,s.code);case"ResponseException":return new Jf(s.message,s.status,s.missing);case"UnknownErrorException":return new kx(s.message,s.details)}return new kx(s.message,s.toString())}var cd,wr,rP,iP,aP,n0;class Xh{constructor(e,t,n){A(this,wr);A(this,cd,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",k(this,wr,rP).bind(this),{signal:d(this,cd).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(a){i.reject(a)}return i.promise}sendWithStream(e,t,n,r){const i=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const h=Promise.withResolvers();return this.streamControllers[i]={controller:u,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:i,data:t,desiredSize:u.desiredSize},r),h.promise},pull:u=>{const h=Promise.withResolvers();return this.streamControllers[i].pullCall=h,l.postMessage({sourceName:a,targetName:o,stream:zt.PULL,streamId:i,desiredSize:u.desiredSize}),h.promise},cancel:u=>{Kt(u instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[i].cancelCall=h,this.streamControllers[i].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:zt.CANCEL,streamId:i,reason:mn(u)}),h.promise}},n)}destroy(){var e;(e=d(this,cd))==null||e.abort(),S(this,cd,null)}}cd=new WeakMap,wr=new WeakSet,rP=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){k(this,wr,aP).call(this,e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===jg.DATA)r.resolve(e.data);else if(e.callback===jg.ERROR)r.reject(mn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(a){i.postMessage({sourceName:n,targetName:r,callback:jg.DATA,callbackId:e.callbackId,data:a})},function(a){i.postMessage({sourceName:n,targetName:r,callback:jg.ERROR,callbackId:e.callbackId,reason:mn(a)})});return}if(e.streamId){k(this,wr,iP).call(this,e);return}t(e.data)},iP=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(u,h=1,f){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=h,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:r,stream:zt.ENQUEUE,streamId:t,chunk:u},f)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:zt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(u){Kt(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:zt.ERROR,streamId:t,reason:mn(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){i.postMessage({sourceName:n,targetName:r,stream:zt.START_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:n,targetName:r,stream:zt.START_COMPLETE,streamId:t,reason:mn(u)})})},aP=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case zt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(mn(e.reason));break;case zt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(mn(e.reason));break;case zt.PULL:if(!o){i.postMessage({sourceName:n,targetName:r,stream:zt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||ak).then(function(){i.postMessage({sourceName:n,targetName:r,stream:zt.PULL_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:n,targetName:r,stream:zt.PULL_COMPLETE,streamId:t,reason:mn(u)})});break;case zt.ENQUEUE:if(Kt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case zt.CLOSE:if(Kt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),k(this,wr,n0).call(this,a,t);break;case zt.ERROR:Kt(a,"error should have stream controller"),a.controller.error(mn(e.reason)),k(this,wr,n0).call(this,a,t);break;case zt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(mn(e.reason)),k(this,wr,n0).call(this,a,t);break;case zt.CANCEL:if(!o)break;const l=mn(e.reason);Promise.try(o.onCancel||ak,l).then(function(){i.postMessage({sourceName:n,targetName:r,stream:zt.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:n,targetName:r,stream:zt.CANCEL_COMPLETE,streamId:t,reason:mn(u)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},n0=async function(e,t){var n,r,i;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(r=e.pullCall)==null?void 0:r.promise,(i=e.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var Np;class oP{constructor({enableHWA:e=!1}){A(this,Np,!1);S(this,Np,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!d(this,Np)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){at("Abstract method `_createCanvas` called.")}}Np=new WeakMap;class T6 extends oP{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class lP{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){at("Abstract method `_fetch` called.")}}class ok extends lP{async _fetch(e){const t=await vh(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):qm(t)}}class cP{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,i){return"none"}destroy(e=!1){}}var ql,ud,ea,ta,Is,Kl,Xl,le,Ds,Yh,fu,r0,pu,uP,vb,mu,Jh,Qh,xb,Zh;class C6 extends cP{constructor({docId:t,ownerDocument:n=globalThis.document}){super();A(this,le);A(this,ql);A(this,ud);A(this,ea);A(this,ta);A(this,Is);A(this,Kl);A(this,Xl,0);S(this,ta,t),S(this,Is,n)}addFilter(t){if(!t)return"none";let n=d(this,le,Ds).get(t);if(n)return n;const[r,i,a]=k(this,le,r0).call(this,t),o=t.length===1?r:`${r}${i}${a}`;if(n=d(this,le,Ds).get(o),n)return d(this,le,Ds).set(t,n),n;const l=`g_${d(this,ta)}_transfer_map_${Ks(this,Xl)._++}`,u=k(this,le,pu).call(this,l);d(this,le,Ds).set(t,u),d(this,le,Ds).set(o,u);const h=k(this,le,mu).call(this,l);return k(this,le,Qh).call(this,r,i,a,h),u}addHCMFilter(t,n){var g;const r=`${t}-${n}`,i="base";let a=d(this,le,Yh).get(i);if((a==null?void 0:a.key)===r||(a?((g=a.filter)==null||g.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},d(this,le,Yh).set(i,a)),!t||!n))return a.url;const o=k(this,le,Zh).call(this,t);t=ve.makeHexColor(...o);const l=k(this,le,Zh).call(this,n);if(n=ve.makeHexColor(...l),d(this,le,fu).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return a.url;const u=new Array(256);for(let y=0;y<=255;y++){const b=y/255;u[y]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const h=u.join(","),f=`g_${d(this,ta)}_hcm_filter`,p=a.filter=k(this,le,mu).call(this,f);k(this,le,Qh).call(this,h,h,h,p),k(this,le,vb).call(this,p);const m=(y,b)=>{const v=o[y]/255,x=l[y]/255,w=new Array(b+1);for(let E=0;E<=b;E++)w[E]=v+E/b*(x-v);return w.join(",")};return k(this,le,Qh).call(this,m(0,5),m(1,5),m(2,5),p),a.url=k(this,le,pu).call(this,f),a.url}addAlphaFilter(t){let n=d(this,le,Ds).get(t);if(n)return n;const[r]=k(this,le,r0).call(this,[t]),i=`alpha_${r}`;if(n=d(this,le,Ds).get(i),n)return d(this,le,Ds).set(t,n),n;const a=`g_${d(this,ta)}_alpha_map_${Ks(this,Xl)._++}`,o=k(this,le,pu).call(this,a);d(this,le,Ds).set(t,o),d(this,le,Ds).set(i,o);const l=k(this,le,mu).call(this,a);return k(this,le,xb).call(this,r,l),o}addLuminosityFilter(t){let n=d(this,le,Ds).get(t||"luminosity");if(n)return n;let r,i;if(t?([r]=k(this,le,r0).call(this,[t]),i=`luminosity_${r}`):i="luminosity",n=d(this,le,Ds).get(i),n)return d(this,le,Ds).set(t,n),n;const a=`g_${d(this,ta)}_luminosity_map_${Ks(this,Xl)._++}`,o=k(this,le,pu).call(this,a);d(this,le,Ds).set(t,o),d(this,le,Ds).set(i,o);const l=k(this,le,mu).call(this,a);return k(this,le,uP).call(this,l),t&&k(this,le,xb).call(this,r,l),o}addHighlightHCMFilter(t,n,r,i,a){var x;const o=`${n}-${r}-${i}-${a}`;let l=d(this,le,Yh).get(t);if((l==null?void 0:l.key)===o||(l?((x=l.filter)==null||x.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},d(this,le,Yh).set(t,l)),!n||!r))return l.url;const[u,h]=[n,r].map(k(this,le,Zh).bind(this));let f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),p=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[m,g]=[i,a].map(k(this,le,Zh).bind(this));p<f&&([f,p,m,g]=[p,f,g,m]),d(this,le,fu).style.color="";const y=(w,E,T)=>{const C=new Array(256),N=(p-f)/T,j=w/255,P=(E-w)/(255*T);let M=0;for(let V=0;V<=T;V++){const L=Math.round(f+V*N),I=j+V*P;for(let O=M;O<=L;O++)C[O]=I;M=L+1}for(let V=M;V<256;V++)C[V]=C[M-1];return C.join(",")},b=`g_${d(this,ta)}_hcm_${t}_filter`,v=l.filter=k(this,le,mu).call(this,b);return k(this,le,vb).call(this,v),k(this,le,Qh).call(this,y(m[0],g[0],5),y(m[1],g[1],5),y(m[2],g[2],5),v),l.url=k(this,le,pu).call(this,b),l.url}destroy(t=!1){var n,r,i,a;t&&((n=d(this,Kl))!=null&&n.size)||((r=d(this,ea))==null||r.parentNode.parentNode.remove(),S(this,ea,null),(i=d(this,ud))==null||i.clear(),S(this,ud,null),(a=d(this,Kl))==null||a.clear(),S(this,Kl,null),S(this,Xl,0))}}ql=new WeakMap,ud=new WeakMap,ea=new WeakMap,ta=new WeakMap,Is=new WeakMap,Kl=new WeakMap,Xl=new WeakMap,le=new WeakSet,Ds=function(){return d(this,ud)||S(this,ud,new Map)},Yh=function(){return d(this,Kl)||S(this,Kl,new Map)},fu=function(){if(!d(this,ea)){const t=d(this,Is).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const r=d(this,Is).createElementNS(Ii,"svg");r.setAttribute("width",0),r.setAttribute("height",0),S(this,ea,d(this,Is).createElementNS(Ii,"defs")),t.append(r),r.append(d(this,ea)),d(this,Is).body.append(t)}return d(this,ea)},r0=function(t){if(t.length===1){const u=t[0],h=new Array(256);for(let p=0;p<256;p++)h[p]=u[p]/255;const f=h.join(",");return[f,f,f]}const[n,r,i]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let u=0;u<256;u++)a[u]=n[u]/255,o[u]=r[u]/255,l[u]=i[u]/255;return[a.join(","),o.join(","),l.join(",")]},pu=function(t){if(d(this,ql)===void 0){S(this,ql,"");const n=d(this,Is).URL;n!==d(this,Is).baseURI&&(Xm(n)?Le('#createUrl: ignore "data:"-URL for performance reasons.'):S(this,ql,$_(n,"")))}return`url(${d(this,ql)}#${t})`},uP=function(t){const n=d(this,Is).createElementNS(Ii,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},vb=function(t){const n=d(this,Is).createElementNS(Ii,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},mu=function(t){const n=d(this,Is).createElementNS(Ii,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),d(this,le,fu).append(n),n},Jh=function(t,n,r){const i=d(this,Is).createElementNS(Ii,n);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),t.append(i)},Qh=function(t,n,r,i){const a=d(this,Is).createElementNS(Ii,"feComponentTransfer");i.append(a),k(this,le,Jh).call(this,a,"feFuncR",t),k(this,le,Jh).call(this,a,"feFuncG",n),k(this,le,Jh).call(this,a,"feFuncB",r)},xb=function(t,n){const r=d(this,Is).createElementNS(Ii,"feComponentTransfer");n.append(r),k(this,le,Jh).call(this,r,"feFuncA",t)},Zh=function(t){return d(this,le,fu).style.color=t,H_(getComputedStyle(d(this,le,fu)).getPropertyValue("color"))};class dP{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){at("Abstract method `_fetch` called.")}}class lk extends dP{async _fetch(e){const t=await vh(e,"arraybuffer");return new Uint8Array(t)}}class hP{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){at("Abstract method `_fetch` called.")}}class ck extends hP{async _fetch(e){const t=await vh(e,"arraybuffer");return new Uint8Array(t)}}tn&&Le("Please use the `legacy` build in Node.js environments.");async function z_(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class N6 extends cP{}class j6 extends oP{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class P6 extends lP{async _fetch(e){return z_(e)}}class R6 extends dP{async _fetch(e){return z_(e)}}class L6 extends hP{async _fetch(e){return z_(e)}}const Ts={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function wb(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),s.clip(r)}class W_{isModifyingCurrentTransform(){return!1}getPattern(){at("Abstract method `getPattern` called.")}}class D6 extends W_{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let i;if(r===Ts.STROKE||r===Ts.FILL){const a=t.current.getClippedPathBoundingBox(r,Nt(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",o,l),h=u.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),n=ve.transform(n,[1,0,0,1,a[0],a[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),wb(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),i=e.createPattern(u.canvas,"no-repeat");const f=new DOMMatrix(n);i.setTransform(f)}else wb(e,this._bbox),i=this._createGradient(e);return i}}function Nx(s,e,t,n,r,i,a,o){const l=e.coords,u=e.colors,h=s.data,f=s.width*4;let p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=i,i=a,a=p),l[n+1]>l[r+1]&&(p=n,n=r,r=p,p=a,a=o,o=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=i,i=a,a=p);const m=(l[t]+e.offsetX)*e.scaleX,g=(l[t+1]+e.offsetY)*e.scaleY,y=(l[n]+e.offsetX)*e.scaleX,b=(l[n+1]+e.offsetY)*e.scaleY,v=(l[r]+e.offsetX)*e.scaleX,x=(l[r+1]+e.offsetY)*e.scaleY;if(g>=x)return;const w=u[i],E=u[i+1],T=u[i+2],C=u[a],N=u[a+1],j=u[a+2],P=u[o],M=u[o+1],V=u[o+2],L=Math.round(g),I=Math.round(x);let O,X,$,H,D,F,q,J;for(let ee=L;ee<=I;ee++){if(ee<b){const K=ee<g?0:(g-ee)/(g-b);O=m-(m-y)*K,X=w-(w-C)*K,$=E-(E-N)*K,H=T-(T-j)*K}else{let K;ee>x?K=1:b===x?K=0:K=(b-ee)/(b-x),O=y-(y-v)*K,X=C-(C-P)*K,$=N-(N-M)*K,H=j-(j-V)*K}let de;ee<g?de=0:ee>x?de=1:de=(g-ee)/(g-x),D=m-(m-v)*de,F=w-(w-P)*de,q=E-(E-M)*de,J=T-(T-V)*de;const ge=Math.round(Math.min(O,D)),Ce=Math.round(Math.max(O,D));let B=f*ee+ge*4;for(let K=ge;K<=Ce;K++)de=(O-K)/(O-D),de<0?de=0:de>1&&(de=1),h[B++]=X-(X-F)*de|0,h[B++]=$-($-q)*de|0,h[B++]=H-(H-J)*de|0,h[B++]=255}}function M6(s,e,t){const n=e.coords,r=e.colors;let i,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(n.length/o)-1,u=o-1;for(i=0;i<l;i++){let h=i*o;for(let f=0;f<u;f++,h++)Nx(s,t,n[h],n[h+1],n[h+o],r[h],r[h+1],r[h+o]),Nx(s,t,n[h+o+1],n[h+1],n[h+o],r[h+o+1],r[h+1],r[h+o])}break;case"triangles":for(i=0,a=n.length;i<a;i+=3)Nx(s,t,n[i],n[i+1],n[i+2],r[i],r[i+1],r[i+2]);break;default:throw new Error("illegal figure")}}class I6 extends W_{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,h=Math.ceil(this._bounds[3])-l,f=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),m=u/f,g=h/p,y={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/m,scaleY:1/g},b=f+2*2,v=p+2*2,x=n.getCanvas("mesh",b,v),w=x.context,E=w.createImageData(f,p);if(t){const C=E.data;for(let N=0,j=C.length;N<j;N+=4)C[N]=t[0],C[N+1]=t[1],C[N+2]=t[2],C[N+3]=255}for(const C of this._figures)M6(E,C,y);return w.putImageData(E,2,2),{canvas:x.canvas,offsetX:o-2*m,offsetY:l-2*g,scaleX:m,scaleY:g}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){wb(e,this._bbox);const i=new Float32Array(2);if(r===Ts.SHADING)ve.singularValueDecompose2dScale(Nt(e),i);else if(this.matrix){ve.singularValueDecompose2dScale(this.matrix,i);const[o,l]=i;ve.singularValueDecompose2dScale(t.baseTransform,i),i[0]*=o,i[1]*=l}else ve.singularValueDecompose2dScale(t.baseTransform,i);const a=this._createMeshCanvas(i,r===Ts.SHADING?null:this._background,t.cachedCanvases);return r!==Ts.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class O6 extends W_{getPattern(){return"hotpink"}}function F6(s){switch(s[0]){case"RadialAxial":return new D6(s);case"Mesh":return new I6(s);case"Dummy":return new O6}throw new Error(`Unknown IR type: ${s[0]}`)}const uk={COLORED:1,UNCOLORED:2},Ey=class Ey{constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:n,paintType:r,tilingType:i,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),mv("TilingType: "+i);const h=t[0],f=t[1],p=t[2],m=t[3],g=p-h,y=m-f,b=new Float32Array(2);ve.singularValueDecompose2dScale(this.matrix,b);const[v,x]=b;ve.singularValueDecompose2dScale(this.baseTransform,b);const w=v*b[0],E=x*b[1];let T=g,C=y,N=!1,j=!1;const P=Math.ceil(l*w),M=Math.ceil(u*E),V=Math.ceil(g*w),L=Math.ceil(y*E);P>=V?T=l:N=!0,M>=L?C=u:j=!0;const I=this.getSizeAndScale(T,this.ctx.canvas.width,w),O=this.getSizeAndScale(C,this.ctx.canvas.height,E),X=e.cachedCanvases.getCanvas("pattern",I.size,O.size),$=X.context,H=o.createCanvasGraphics($);if(H.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(H,r,a),$.translate(-I.scale*h,-O.scale*f),H.transform(I.scale,0,0,O.scale,0,0),$.save(),this.clipBbox(H,h,f,p,m),H.baseTransform=Nt(H.ctx),H.executeOperatorList(n),H.endDrawing(),$.restore(),N||j){const D=X.canvas;N&&(T=l),j&&(C=u);const F=this.getSizeAndScale(T,this.ctx.canvas.width,w),q=this.getSizeAndScale(C,this.ctx.canvas.height,E),J=F.size,ee=q.size,de=e.cachedCanvases.getCanvas("pattern-workaround",J,ee),ge=de.context,Ce=N?Math.floor(g/l):0,B=j?Math.floor(y/u):0;for(let K=0;K<=Ce;K++)for(let xe=0;xe<=B;xe++)ge.drawImage(D,J*K,ee*xe,J,ee,0,0,J,ee);return{canvas:de.canvas,scaleX:F.scale,scaleY:q.scale,offsetX:h,offsetY:f}}return{canvas:X.canvas,scaleX:I.scale,scaleY:O.scale,offsetX:h,offsetY:f}}getSizeAndScale(e,t,n){const r=Math.max(Ey.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,r,i){const a=r-t,o=i-n;e.ctx.rect(t,n,a,o),ve.axialAlignedBoundingBox([t,n,r,i],Nt(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,i=e.current;switch(t){case uk.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;r.fillStyle=i.fillColor=a,r.strokeStyle=i.strokeColor=o;break;case uk.UNCOLORED:r.fillStyle=r.strokeStyle=n,i.fillColor=i.strokeColor=n;break;default:throw new l6(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r){let i=n;r!==Ts.SHADING&&(i=ve.transform(i,t.baseTransform),this.matrix&&(i=ve.transform(i,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};re(Ey,"MAX_PATTERN_SIZE",3e3);let bb=Ey;function $6({src:s,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:i=4294967295,inverseDecode:a=!1}){const o=gs.isLittleEndian?4278190080:255,[l,u]=a?[i,o]:[o,i],h=n>>3,f=n&7,p=s.length;t=new Uint32Array(t.buffer);let m=0;for(let g=0;g<r;g++){for(const b=e+h;e<b;e++){const v=e<p?s[e]:255;t[m++]=v&128?u:l,t[m++]=v&64?u:l,t[m++]=v&32?u:l,t[m++]=v&16?u:l,t[m++]=v&8?u:l,t[m++]=v&4?u:l,t[m++]=v&2?u:l,t[m++]=v&1?u:l}if(f===0)continue;const y=e<p?s[e++]:255;for(let b=0;b<f;b++)t[m++]=y&1<<7-b?u:l}return{srcPos:e,destPos:m}}const dk=16,hk=100,U6=15,fk=10,wn=16,jx=new DOMMatrix,Gn=new Float32Array(2),Mu=new Float32Array([1/0,1/0,-1/0,-1/0]);function B6(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},s.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},s.transform=function(t,n,r,i,a,o){e.transform(t,n,r,i,a,o),this.__originalTransform(t,n,r,i,a,o)},s.setTransform=function(t,n,r,i,a,o){e.setTransform(t,n,r,i,a,o),this.__originalSetTransform(t,n,r,i,a,o)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(t){e.rotate(t),this.__originalRotate(t)},s.clip=function(t){e.clip(t),this.__originalClip(t)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,r,i,a,o){e.bezierCurveTo(t,n,r,i,a,o),this.__originalBezierCurveTo(t,n,r,i,a,o)},s.rect=function(t,n,r,i){e.rect(t,n,r,i),this.__originalRect(t,n,r,i)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class H6{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Pg(s,e,t,n,r,i,a,o,l,u){const[h,f,p,m,g,y]=Nt(s);if(f===0&&p===0){const x=a*h+g,w=Math.round(x),E=o*m+y,T=Math.round(E),C=(a+l)*h+g,N=Math.abs(Math.round(C)-w)||1,j=(o+u)*m+y,P=Math.abs(Math.round(j)-T)||1;return s.setTransform(Math.sign(h),0,0,Math.sign(m),w,T),s.drawImage(e,t,n,r,i,0,0,N,P),s.setTransform(h,f,p,m,g,y),[N,P]}if(h===0&&m===0){const x=o*p+g,w=Math.round(x),E=a*f+y,T=Math.round(E),C=(o+u)*p+g,N=Math.abs(Math.round(C)-w)||1,j=(a+l)*f+y,P=Math.abs(Math.round(j)-T)||1;return s.setTransform(0,Math.sign(f),Math.sign(p),0,w,T),s.drawImage(e,t,n,r,i,0,0,P,N),s.setTransform(h,f,p,m,g,y),[P,N]}s.drawImage(e,t,n,r,i,a,o,l,u);const b=Math.hypot(h,f),v=Math.hypot(p,m);return[b*l,v*u]}class pk{constructor(e,t){re(this,"alphaIsShape",!1);re(this,"fontSize",0);re(this,"fontSizeScale",1);re(this,"textMatrix",null);re(this,"textMatrixScale",1);re(this,"fontMatrix",Qw);re(this,"leading",0);re(this,"x",0);re(this,"y",0);re(this,"lineX",0);re(this,"lineY",0);re(this,"charSpacing",0);re(this,"wordSpacing",0);re(this,"textHScale",1);re(this,"textRenderingMode",Ls.FILL);re(this,"textRise",0);re(this,"fillColor","#000000");re(this,"strokeColor","#000000");re(this,"patternFill",!1);re(this,"patternStroke",!1);re(this,"fillAlpha",1);re(this,"strokeAlpha",1);re(this,"lineWidth",1);re(this,"activeSMask",null);re(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Mu.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Ts.FILL,t=null){const n=this.minMax.slice();if(e===Ts.STROKE){t||at("Stroke bounding box must include transform."),ve.singularValueDecompose2dScale(t,Gn);const r=Gn[0]*this.lineWidth/2,i=Gn[1]*this.lineWidth/2;n[0]-=r,n[1]-=i,n[2]+=r,n[3]+=i}return n}updateClipFromPath(){const e=ve.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Mu,0)}getClippedPathBoundingBox(e=Ts.FILL,t=null){return ve.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function mk(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%wn,i=(t-r)/wn,a=r===0?i:i+1,o=s.createImageData(n,wn);let l=0,u;const h=e.data,f=o.data;let p,m,g,y;if(e.kind===kf.GRAYSCALE_1BPP){const b=h.byteLength,v=new Uint32Array(f.buffer,0,f.byteLength>>2),x=v.length,w=n+7>>3,E=4294967295,T=gs.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(g=p<i?wn:r,u=0,m=0;m<g;m++){const C=b-l;let N=0;const j=C>w?n:C*8-7,P=j&-8;let M=0,V=0;for(;N<P;N+=8)V=h[l++],v[u++]=V&128?E:T,v[u++]=V&64?E:T,v[u++]=V&32?E:T,v[u++]=V&16?E:T,v[u++]=V&8?E:T,v[u++]=V&4?E:T,v[u++]=V&2?E:T,v[u++]=V&1?E:T;for(;N<j;N++)M===0&&(V=h[l++],M=128),v[u++]=V&M?E:T,M>>=1}for(;u<x;)v[u++]=0;s.putImageData(o,0,p*wn)}}else if(e.kind===kf.RGBA_32BPP){for(m=0,y=n*wn*4,p=0;p<i;p++)f.set(h.subarray(l,l+y)),l+=y,s.putImageData(o,0,m),m+=wn;p<a&&(y=n*r*4,f.set(h.subarray(l,l+y)),s.putImageData(o,0,m))}else if(e.kind===kf.RGB_24BPP)for(g=wn,y=n*g,p=0;p<a;p++){for(p>=i&&(g=r,y=n*g),u=0,m=y;m--;)f[u++]=h[l++],f[u++]=h[l++],f[u++]=h[l++],f[u++]=255;s.putImageData(o,0,p*wn)}else throw new Error(`bad image kind: ${e.kind}`)}function gk(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%wn,i=(t-r)/wn,a=r===0?i:i+1,o=s.createImageData(n,wn);let l=0;const u=e.data,h=o.data;for(let f=0;f<a;f++){const p=f<i?wn:r;({srcPos:l}=$6({src:u,srcPos:l,dest:h,width:n,height:p,nonBlackColor:0})),s.putImageData(o,0,f*wn)}}function Rh(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function Rg(s){s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0);const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}function yk(s,e){if(e)return!0;ve.singularValueDecompose2dScale(s,Gn);const t=Math.fround(ei.pixelRatio*Ma.PDF_TO_CSS_UNITS);return Gn[0]<=t&&Gn[1]<=t}const V6=["butt","round","square"],z6=["miter","round","bevel"],W6={},vk={};var ti,Sb,_b,Eb;const tE=class tE{constructor(e,t,n,r,i,{optionalContentConfig:a,markedContentStack:o=null},l,u){A(this,ti);this.ctx=e,this.current=new pk(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new H6(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,n){const l=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Nt(this.compositeCtx))}this.ctx.save(),Rg(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Nt(this.ctx)}executeOperatorList(e,t,n,r){const i=e.argsArray,a=e.fnArray;let o=t||0;const l=i.length;if(l===o)return o;const u=l-o>fk&&typeof n=="function",h=u?Date.now()+U6:0;let f=0;const p=this.commonObjs,m=this.objs;let g;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,n),o;if(g=a[o],g!==Yf.dependency)this[g].apply(this,i[o]);else for(const y of i[o]){const b=y.startsWith("g_")?p:m;if(!b.has(y))return b.get(y,n),o}if(o++,o===l)return o;if(u&&++f>fk){if(Date.now()>h)return n(),o;f=0}}}endDrawing(){k(this,ti,Sb).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),k(this,ti,_b).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=n,l=r,u="prescale1",h,f;for(;i>2&&o>1||a>2&&l>1;){let p=o,m=l;i>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/p),a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/m),h=this.cachedCanvases.getCanvas(u,p,m),f=h.context,f.clearRect(0,0,p,m),f.drawImage(e,0,0,o,l,0,0,p,m),e=h.canvas,o=p,l=m,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:r}=e,i=this.current.fillColor,a=this.current.patternFill,o=Nt(t);let l,u,h,f;if((e.bitmap||e.data)&&e.count>1){const P=e.bitmap||e.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),i]),l=this._cachedBitmapsMap.get(P),l||(l=new Map,this._cachedBitmapsMap.set(P,l));const M=l.get(u);if(M&&!a){const V=Math.round(Math.min(o[0],o[2])+o[4]),L=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:M,offsetX:V,offsetY:L}}h=M}h||(f=this.cachedCanvases.getCanvas("maskCanvas",n,r),gk(f.context,e));let p=ve.transform(o,[1/n,0,0,-1/r,0,0]);p=ve.transform(p,[1,0,0,1,0,-r]);const m=Mu.slice();ve.axialAlignedBoundingBox([0,0,n,r],p,m);const[g,y,b,v]=m,x=Math.round(b-g)||1,w=Math.round(v-y)||1,E=this.cachedCanvases.getCanvas("fillCanvas",x,w),T=E.context,C=g,N=y;T.translate(-C,-N),T.transform(...p),h||(h=this._scaleImage(f.canvas,ri(T)),h=h.img,l&&a&&l.set(u,h)),T.imageSmoothingEnabled=yk(Nt(T),e.interpolate),Pg(T,h,0,0,h.width,h.height,0,0,n,r),T.globalCompositeOperation="source-in";const j=ve.transform(ri(T),[1,0,0,1,-C,-N]);return T.fillStyle=a?i.getPattern(t,this,j,Ts.FILL):i,T.fillRect(0,0,n,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round(C),offsetY:Math.round(N)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=V6[e]}setLineJoin(e){this.ctx.lineJoin=z6[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx;const i=this.ctx=r.context;i.setTransform(this.suspendedCtx.getTransform()),Rh(this.suspendedCtx,i),B6(i,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Rh(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const i=r[0],a=r[1],o=r[2]-i,l=r[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,n,o,l,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,i,a,o,l,u,h,f){let p=e.canvas,m=l-h,g=u-f;if(a)if(m<0||g<0||m+n>p.width||g+r>p.height){const b=this.cachedCanvases.getCanvas("maskExtension",n,r),v=b.context;v.drawImage(p,-m,-g),v.globalCompositeOperation="destination-atop",v.fillStyle=a,v.fillRect(0,0,n,r),v.globalCompositeOperation="source-over",p=b.canvas,m=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(m,g,n,r),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(m,g,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const y=new Path2D;y.rect(l,u,n,r),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(p,m,g,n,r,l,u,n,r),t.restore()}save(){this.inSMaskMode&&Rh(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Rh(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,i,a){this.ctx.transform(e,t,n,r,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let[r]=t;if(!n){r||(r=t[0]=new Path2D),this[e](r);return}if(!(r instanceof Path2D)){const i=t[0]=new Path2D;for(let a=0,o=r.length;a<o;)switch(r[a++]){case Cg.moveTo:i.moveTo(r[a++],r[a++]);break;case Cg.lineTo:i.lineTo(r[a++],r[a++]);break;case Cg.curveTo:i.bezierCurveTo(r[a++],r[a++],r[a++],r[a++],r[a++],r[a++]);break;case Cg.closePath:i.closePath();break;default:Le(`Unrecognized drawing path operator: ${r[a-1]}`);break}r=i}ve.axialAlignedBoundingBox(n,Nt(this.ctx),this.current.minMax),this[e](r)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const n=this.ctx,r=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const i=r.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=r.getPattern(n,this,ri(n),Ts.STROKE),i){const a=new Path2D;a.addPath(e,n.getTransform().invertSelf().multiplySelf(i)),e=a}this.rescaleAndStroke(e,!1),n.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Ts.STROKE,Nt(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const n=this.ctx,r=this.current.fillColor,i=this.current.patternFill;let a=!1;if(i){const l=r.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.fillStyle=r.getPattern(n,this,ri(n),Ts.FILL),l){const u=new Path2D;u.addPath(e,n.getTransform().invertSelf().multiplySelf(l)),e=u}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(n.fill(e,"evenodd"),this.pendingEOFill=!1):n.fill(e)),a&&n.restore(),t&&this.consumePath(e,o)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=W6}eoClip(){this.pendingClip=vk}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const n=new Path2D,r=t.getTransform().invertSelf();for(const{transform:i,x:a,y:o,fontSize:l,path:u}of e)n.addPath(u,new DOMMatrix(i).preMultiplySelf(r).translate(a,o).scale(l,-l));t.clip(n),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var h;const n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=n.fontMatrix||Qw,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Le("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const i=n.loadedName||"sans-serif",a=((h=n.systemFontInfo)==null?void 0:h.css)||`"${i}", ${n.fallbackName}`;let o="normal";n.black?o="900":n.bold&&(o="bold");const l=n.italic?"italic":"normal";let u=t;t<dk?u=dk:t>hk&&(u=hk),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${o} ${u}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,r,i){const a=this.ctx,o=this.current,l=o.font,u=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,f=u&Ls.FILL_STROKE_MASK,p=!!(u&Ls.ADD_TO_PATH_FLAG),m=o.patternFill&&!l.missingFile,g=o.patternStroke&&!l.missingFile;let y;if((l.disableFontFace||p||m||g)&&(y=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||g){a.save(),a.translate(t,n),a.scale(h,-h);let b;if((f===Ls.FILL||f===Ls.FILL_STROKE)&&(r?(b=a.getTransform(),a.setTransform(...r),a.fill(k(this,ti,Eb).call(this,y,b,r))):a.fill(y)),f===Ls.STROKE||f===Ls.FILL_STROKE)if(i){b||(b=a.getTransform()),a.setTransform(...i);const{a:v,b:x,c:w,d:E}=b,T=ve.inverseTransform(i),C=ve.transform([v,x,w,E,0,0],T);ve.singularValueDecompose2dScale(C,Gn),a.lineWidth*=Math.max(Gn[0],Gn[1])/h,a.stroke(k(this,ti,Eb).call(this,y,b,i))}else a.lineWidth/=h,a.stroke(y);a.restore()}else(f===Ls.FILL||f===Ls.FILL_STROKE)&&a.fillText(e,t,n),(f===Ls.STROKE||f===Ls.FILL_STROKE)&&a.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Nt(a),x:t,y:n,fontSize:h,path:y})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return Ve(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const i=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,h=t.textHScale*u,f=e.length,p=n.vertical,m=p?1:-1,g=n.defaultVMetrics,y=r*t.fontMatrix[0],b=t.textRenderingMode===Ls.FILL&&!n.disableFontFace&&!t.patternFill;i.save(),t.textMatrix&&i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),u>0?i.scale(h,-1):i.scale(h,1);let v,x;if(t.patternFill){i.save();const N=t.fillColor.getPattern(i,this,ri(i),Ts.FILL);v=Nt(i),i.restore(),i.fillStyle=N}if(t.patternStroke){i.save();const N=t.strokeColor.getPattern(i,this,ri(i),Ts.STROKE);x=Nt(i),i.restore(),i.strokeStyle=N}let w=t.lineWidth;const E=t.textMatrixScale;if(E===0||w===0){const N=t.textRenderingMode&Ls.FILL_STROKE_MASK;(N===Ls.STROKE||N===Ls.FILL_STROKE)&&(w=this.getSinglePixelWidth())}else w/=E;if(a!==1&&(i.scale(a,a),w/=a),i.lineWidth=w,n.isInvalidPDFjsFont){const N=[];let j=0;for(const P of e)N.push(P.unicode),j+=P.width;i.fillText(N.join(""),0,0),t.x+=j*y*h,i.restore(),this.compose();return}let T=0,C;for(C=0;C<f;++C){const N=e[C];if(typeof N=="number"){T+=m*N*r/1e3;continue}let j=!1;const P=(N.isSpace?l:0)+o,M=N.fontChar,V=N.accent;let L,I,O=N.width;if(p){const $=N.vmetric||g,H=-(N.vmetric?$[1]:O*.5)*y,D=$[2]*y;O=$?-$[0]:O,L=H/a,I=(T+D)/a}else L=T/a,I=0;if(n.remeasure&&O>0){const $=i.measureText(M).width*1e3/r*a;if(O<$&&this.isFontSubpixelAAEnabled){const H=O/$;j=!0,i.save(),i.scale(H,1),L/=H}else O!==$&&(L+=(O-$)/2e3*r/a)}if(this.contentVisible&&(N.isInFont||n.missingFile)){if(b&&!V)i.fillText(M,L,I);else if(this.paintChar(M,L,I,v,x),V){const $=L+r*V.offset.x/a,H=I-r*V.offset.y/a;this.paintChar(V.fontChar,$,H,v,x)}}const X=p?O*y-P*u:O*y+P*u;T+=X,j&&i.restore()}p?t.y-=T:t.x+=T*h,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,r=n.font,i=n.fontSize,a=n.fontDirection,o=r.vertical?1:-1,l=n.charSpacing,u=n.wordSpacing,h=n.textHScale*a,f=n.fontMatrix||Qw,p=e.length,m=n.textRenderingMode===Ls.INVISIBLE;let g,y,b,v;if(!(m||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),n.textMatrix&&t.transform(...n.textMatrix),t.translate(n.x,n.y+n.textRise),t.scale(h,a),g=0;g<p;++g){if(y=e[g],typeof y=="number"){v=o*y*i/1e3,this.ctx.translate(v,0),n.x+=v*h;continue}const x=(y.isSpace?u:0)+l,w=r.charProcOperatorList[y.operatorListId];w?this.contentVisible&&(this.save(),t.scale(i,i),t.transform(...f),this.executeOperatorList(w),this.restore()):Le(`Type3 character "${y.operatorListId}" is not available.`);const E=[y.width,0];ve.applyTransform(E,f),b=E[0]*i+x,t.translate(b,0),n.x+=b*h}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,r,i,a){const o=new Path2D;o.rect(n,r,i-n,a-r),this.ctx.clip(o),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const n=this.baseTransform||Nt(this.ctx),r={createCanvasGraphics:i=>new tE(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new bb(e,this.ctx,r,n)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=F6(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,ri(t),Ts.SHADING);const r=ri(t);if(r){const{width:i,height:a}=t.canvas,o=Mu.slice();ve.axialAlignedBoundingBox([0,0,i,a],r,o);const[l,u,h,f]=o;this.ctx.fillRect(l,u,h-l,f-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){at("Should not call beginInlineImage")}beginImageData(){at("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Nt(this.ctx),t)){ve.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[n,r,i,a]=t,o=new Path2D;o.rect(n,r,i-n,a-r),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||mv("TODO: Support non-isolated groups."),e.knockout&&Le("Knockout groups not supported.");const n=Nt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Mu.slice();ve.axialAlignedBoundingBox(e.bbox,Nt(t),r);const i=[0,0,t.canvas.width,t.canvas.height];r=ve.intersect(r,i)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,u]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(h,l,u),p=f.context;p.translate(-a,-o),p.transform(...n);let m=new Path2D;const[g,y,b,v]=e.bbox;if(m.rect(g,y,b-g,v-y),e.matrix){const x=new Path2D;x.addPath(m,new DOMMatrix(e.matrix)),m=x}p.clip(m),e.smask?this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),Rh(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=Nt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const i=Mu.slice();ve.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r,i),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,n,r,i){if(k(this,ti,Sb).call(this),Rg(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(i&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o,ve.singularValueDecompose2dScale(Nt(this.ctx),Gn);const{viewportScale:l}=this,u=Math.ceil(a*this.outputScaleX*l),h=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(u,h);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Gn[0],0,0,-Gn[1],0,o*Gn[1]),Rg(this.ctx)}else{Rg(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],a,o),this.ctx.clip(l)}}this.current=new pk(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),k(this,ti,_b).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const n=this.ctx,r=this._createMaskCanvas(e),i=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(i,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,r=0,i,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=Nt(o);o.transform(t,n,r,i,0,0);const u=this._createMaskCanvas(e);o.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let h=0,f=a.length;h<f;h+=2){const p=ve.transform(l,[t,n,r,i,a[h],a[h+1]]);o.drawImage(u.canvas,p[4],p[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;for(const i of e){const{data:a,width:o,height:l,transform:u}=i,h=this.cachedCanvases.getCanvas("maskCanvas",o,l),f=h.context;f.save();const p=this.getObject(a,i);gk(f,p),f.globalCompositeOperation="source-in",f.fillStyle=r?n.getPattern(f,this,ri(t),Ts.FILL):n,f.fillRect(0,0,o,l),f.restore(),t.save(),t.transform(...u),t.scale(1,-1),Pg(t,h.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Le("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,r){if(!this.contentVisible)return;const i=this.getObject(e);if(!i){Le("Dependent image isn't ready yet");return}const a=i.width,o=i.height,l=[];for(let u=0,h=r.length;u<h;u+=2)l.push({transform:[t,0,0,n,r[u],r[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(i,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",n,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,r=this.ctx;this.save();const{filter:i}=r;i!=="none"&&i!==""&&(r.filter="none"),r.scale(1/t,-1/n);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const u=this.cachedCanvases.getCanvas("inlineImage",t,n).context;mk(u,e),a=this.applyTransferMapsToCanvas(u)}const o=this._scaleImage(a,ri(r));r.imageSmoothingEnabled=yk(Nt(r),e.interpolate),Pg(r,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const i=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",i,a).context;mk(l,e),r=this.applyTransferMapsToCanvas(l)}for(const i of t)n.save(),n.transform(...i.transform),n.scale(1,-1),Pg(n,r,i.x,i.y,i.w,i.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const r=this.ctx;this.pendingClip&&(n||(this.pendingClip===vk?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Nt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:i}=this.ctx.getTransform();let a,o;if(n===0&&r===0){const l=Math.abs(t),u=Math.abs(i);if(l===u)if(e===0)a=o=1/l;else{const h=l*e;a=o=h<1?1/h:1}else if(e===0)a=1/l,o=1/u;else{const h=l*e,f=u*e;a=h<1?1/h:1,o=f<1?1/f:1}}else{const l=Math.abs(t*i-n*r),u=Math.hypot(t,n),h=Math.hypot(r,i);if(e===0)a=h/l,o=u/l;else{const f=e*l;a=h>f?h/f:1,o=u>f?u/f:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[i,a]=this.getScaleForStroking();if(i===a){n.lineWidth=(r||1)*i,n.stroke(e);return}const o=n.getLineDash();t&&n.save(),n.scale(i,a),jx.a=1/i,jx.d=1/a;const l=new Path2D;if(l.addPath(e,jx),o.length>0){const u=Math.max(i,a);n.setLineDash(o.map(h=>h/u)),n.lineDashOffset/=u}n.lineWidth=r||1,n.stroke(l),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};ti=new WeakSet,Sb=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},_b=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Eb=function(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r};let zu=tE;for(const s in Yf)zu.prototype[s]!==void 0&&(zu.prototype[Yf[s]]=zu.prototype[s]);var jp,Pp;class Xr{static get workerPort(){return d(this,jp)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");S(this,jp,e)}static get workerSrc(){return d(this,Pp)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");S(this,Pp,e)}}jp=new WeakMap,Pp=new WeakMap,A(Xr,jp,null),A(Xr,Pp,"");var dd,Rp;class G6{constructor({parsedData:e,rawData:t}){A(this,dd);A(this,Rp);S(this,dd,e),S(this,Rp,t)}getRaw(){return d(this,Rp)}get(e){return d(this,dd).get(e)??null}[Symbol.iterator](){return d(this,dd).entries()}}dd=new WeakMap,Rp=new WeakMap;const gu=Symbol("INTERNAL");var Lp,Dp,Mp,hd;class q6{constructor(e,{name:t,intent:n,usage:r,rbGroups:i}){A(this,Lp,!1);A(this,Dp,!1);A(this,Mp,!1);A(this,hd,!0);S(this,Lp,!!(e&zn.DISPLAY)),S(this,Dp,!!(e&zn.PRINT)),this.name=t,this.intent=n,this.usage=r,this.rbGroups=i}get visible(){if(d(this,Mp))return d(this,hd);if(!d(this,hd))return!1;const{print:e,view:t}=this.usage;return d(this,Lp)?(t==null?void 0:t.viewState)!=="OFF":d(this,Dp)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==gu&&at("Internal method `_setVisible` called."),S(this,Mp,n),S(this,hd,t)}}Lp=new WeakMap,Dp=new WeakMap,Mp=new WeakMap,hd=new WeakMap;var ho,rt,fd,pd,Ip,Ab;class K6{constructor(e,t=zn.DISPLAY){A(this,Ip);A(this,ho,null);A(this,rt,new Map);A(this,fd,null);A(this,pd,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,S(this,pd,e.order);for(const n of e.groups)d(this,rt).set(n.id,new q6(t,n));if(e.baseState==="OFF")for(const n of d(this,rt).values())n._setVisible(gu,!1);for(const n of e.on)d(this,rt).get(n)._setVisible(gu,!0);for(const n of e.off)d(this,rt).get(n)._setVisible(gu,!1);S(this,fd,this.getHash())}}isVisible(e){if(d(this,rt).size===0)return!0;if(!e)return mv("Optional content group not defined."),!0;if(e.type==="OCG")return d(this,rt).has(e.id)?d(this,rt).get(e.id).visible:(Le(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return k(this,Ip,Ab).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!d(this,rt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(d(this,rt).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!d(this,rt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(!d(this,rt).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!d(this,rt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(!d(this,rt).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!d(this,rt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(d(this,rt).get(t).visible)return!1}return!0}return Le(`Unknown optional content policy ${e.policy}.`),!0}return Le(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var i;const r=d(this,rt).get(e);if(!r){Le(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((i=d(this,rt).get(o))==null||i._setVisible(gu,!1,!0));r._setVisible(gu,!!t,!0),S(this,ho,null)}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const i=d(this,rt).get(r);if(i)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!i.visible,t);break}}S(this,ho,null)}get hasInitialVisibility(){return d(this,fd)===null||this.getHash()===d(this,fd)}getOrder(){return d(this,rt).size?d(this,pd)?d(this,pd).slice():[...d(this,rt).keys()]:null}getGroup(e){return d(this,rt).get(e)||null}getHash(){if(d(this,ho)!==null)return d(this,ho);const e=new eP;for(const[t,n]of d(this,rt))e.update(`${t}:${n.visible}`);return S(this,ho,e.hexdigest())}[Symbol.iterator](){return d(this,rt).entries()}}ho=new WeakMap,rt=new WeakMap,fd=new WeakMap,pd=new WeakMap,Ip=new WeakSet,Ab=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const i=e[r];let a;if(Array.isArray(i))a=k(this,Ip,Ab).call(this,i);else if(d(this,rt).has(i))a=d(this,rt).get(i).visible;else return Le(`Optional content group not found: ${i}`),!0;switch(n){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return n==="And"};class X6{constructor(e,{disableRange:t=!1,disableStream:n=!1}){Kt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:i,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(i==null?void 0:i.length)>0){const l=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(i){return i._begin!==e?!1:(i._enqueue(n),!0)});Kt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,r,i;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(i=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||i.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Kt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Y6(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new J6(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class Y6{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=yv(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class J6{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Q6(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let h=o(t);return h=unescape(h),h=l(h),h=u(h),i(h)}if(t=a(s),t){const h=u(t);return i(h)}if(t=n("filename","i").exec(s),t){t=t[1];let h=o(t);return h=u(h),i(h)}function n(h,f){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function r(h,f){if(h){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const p=new TextDecoder(h,{fatal:!0}),m=qm(f);f=p.decode(m),e=!1}catch{}}return f}function i(h){return e&&/[\x80-\xff]/.test(h)&&(h=r("utf-8",h),e&&(h=r("iso-8859-1",h))),h}function a(h){const f=[];let p;const m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(h))!==null;){let[,y,b,v]=p;if(y=parseInt(y,10),y in f){if(y===0)break;continue}f[y]=[b,v]}const g=[];for(let y=0;y<f.length&&y in f;++y){let[b,v]=f[y];v=o(v),b&&(v=unescape(v),y===0&&(v=l(v))),g.push(v)}return g.join("")}function o(h){if(h.startsWith('"')){const f=h.slice(1).split('\\"');for(let p=0;p<f.length;++p){const m=f[p].indexOf('"');m!==-1&&(f[p]=f[p].slice(0,m),f.length=p+1),f[p]=f[p].replaceAll(/\\(.)/g,"$1")}h=f.join('"')}return h}function l(h){const f=h.indexOf("'");if(f===-1)return h;const p=h.slice(0,f),g=h.slice(f+1).replace(/^[^']*'/,"");return r(p,g)}function u(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,p,m,g){if(m==="q"||m==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,b){return String.fromCharCode(parseInt(b,16))}),r(p,g);try{g=atob(g)}catch{}return r(p,g)})}return""}function fP(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function xv(s){var e;return((e=URL.parse(s))==null?void 0:e.origin)??null}function pP({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(s.get("Content-Length"),10);return!Number.isInteger(i)||(r.suggestedLength=i,i<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function mP(s){const e=s.get("Content-Disposition");if(e){let t=Q6(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(yv(t))return t}return null}function Jm(s,e){return new Jf(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s,s===404||s===0&&e.startsWith("file:"))}function gP(s){return s===200||s===206}function yP(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function vP(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Le(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class Z6{constructor(e){re(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=fP(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Kt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new eB(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new tB(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class eB{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,yP(n,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=xv(i.url),!gP(i.status))throw Jm(i.status,r);this._reader=i.body.getReader(),this._headersCapability.resolve();const a=i.headers,{allowRangeRequests:o,suggestedLength:l}=pP({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=mP(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Da("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:vP(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class tB{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range",`bytes=${t}-${n-1}`);const a=r.url;fetch(a,yP(i,this._withCredentials,this._abortController)).then(o=>{const l=xv(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!gP(o.status))throw Jm(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:vP(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Px=200,Rx=206;function sB(s){const e=s.response;return typeof e!="string"?e:qm(e).buffer}class nB{constructor({url:e,httpHeaders:t,withCredentials:n}){re(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=fP(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,a]of this.headers)t.setRequestHeader(i,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Rx):r.expectedStatus=Px,t.responseType="arraybuffer",Kt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var r;const n=this.pendingRequests[e];n&&((r=n.onProgress)==null||r.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const i=r.status||Px;if(!(i===Px&&n.expectedStatus===Rx)&&i!==n.expectedStatus){n.onError(r.status);return}const o=sB(r);if(i===Rx){const l=r.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?n.onDone({begin:parseInt(u[1],10),chunk:o}):(Le('Missing or invalid "Content-Range" header.'),n.onError(0))}else o?n.onDone({begin:0,chunk:o}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class rB{constructor(e){this._source=e,this._manager=new nB(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Kt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new iB(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new aB(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class iB{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=xv(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...u]=o.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:a}=pP({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=mP(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Jm(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class aB{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=xv((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=Jm(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const oB=/^[a-z][a-z0-9\-+.]+:/i;function lB(s){if(oB.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}class cB{constructor(e){this.source=e,this.url=lB(e.url),Kt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Kt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new uB(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new dB(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class uB{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=Jm(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Da("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class dB{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Lh=Symbol("INITIAL_DATA");var Ln,Op,kb;class xP{constructor(){A(this,Op);A(this,Ln,Object.create(null))}get(e,t=null){if(t){const r=k(this,Op,kb).call(this,e);return r.promise.then(()=>t(r.data)),null}const n=d(this,Ln)[e];if(!n||n.data===Lh)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=d(this,Ln)[e];return!!t&&t.data!==Lh}delete(e){const t=d(this,Ln)[e];return!t||t.data===Lh?!1:(delete d(this,Ln)[e],!0)}resolve(e,t=null){const n=k(this,Op,kb).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in d(this,Ln)){const{data:n}=d(this,Ln)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}S(this,Ln,Object.create(null))}*[Symbol.iterator](){for(const e in d(this,Ln)){const{data:t}=d(this,Ln)[e];t!==Lh&&(yield[e,t])}}}Ln=new WeakMap,Op=new WeakSet,kb=function(e){var t;return(t=d(this,Ln))[e]||(t[e]={...Promise.withResolvers(),data:Lh})};const hB=1e5,xk=30;var Dk,fo,vn,Fp,$p,Yl,sa,Up,Bp,Jl,md,gd,po,yd,Hp,vd,Ql,Vp,zp,Mt,xd,Zl,Wp,mo,wd,Ia,wP,bP,Tb,Yn,i0,Cb,SP,_P;let Zf=(Mt=class{constructor({textContentSource:e,container:t,viewport:n}){A(this,Ia);A(this,fo,Promise.withResolvers());A(this,vn,null);A(this,Fp,!1);A(this,$p,!!((Dk=globalThis.FontInspector)!=null&&Dk.enabled));A(this,Yl,null);A(this,sa,null);A(this,Up,0);A(this,Bp,0);A(this,Jl,null);A(this,md,null);A(this,gd,0);A(this,po,0);A(this,yd,Object.create(null));A(this,Hp,[]);A(this,vd,null);A(this,Ql,[]);A(this,Vp,new WeakMap);A(this,zp,null);var l;if(e instanceof ReadableStream)S(this,vd,e);else if(typeof e=="object")S(this,vd,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');S(this,vn,S(this,md,t)),S(this,po,n.scale*ei.pixelRatio),S(this,gd,n.rotation),S(this,sa,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:i,pageX:a,pageY:o}=n.rawDims;S(this,zp,[1,0,0,-1,-a,o+i]),S(this,Bp,r),S(this,Up,i),k(l=Mt,Yn,SP).call(l),Yo(t,n),d(this,fo).promise.finally(()=>{d(Mt,wd).delete(this),S(this,sa,null),S(this,yd,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=gs.platform;return Ve(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{d(this,Jl).read().then(({value:t,done:n})=>{if(n){d(this,fo).resolve();return}d(this,Yl)??S(this,Yl,t.lang),Object.assign(d(this,yd),t.styles),k(this,Ia,wP).call(this,t.items),e()},d(this,fo).reject)};return S(this,Jl,d(this,vd).getReader()),d(Mt,wd).add(this),e(),d(this,fo).promise}update({viewport:e,onBefore:t=null}){var i;const n=e.scale*ei.pixelRatio,r=e.rotation;if(r!==d(this,gd)&&(t==null||t(),S(this,gd,r),Yo(d(this,md),{rotation:r})),n!==d(this,po)){t==null||t(),S(this,po,n);const a={div:null,properties:null,ctx:k(i=Mt,Yn,i0).call(i,d(this,Yl))};for(const o of d(this,Ql))a.properties=d(this,Vp).get(o),a.div=o,k(this,Ia,Tb).call(this,a)}}cancel(){var t;const e=new Da("TextLayer task cancelled.");(t=d(this,Jl))==null||t.cancel(e).catch(()=>{}),S(this,Jl,null),d(this,fo).reject(e)}get textDivs(){return d(this,Ql)}get textContentItemsStr(){return d(this,Hp)}static cleanup(){if(!(d(this,wd).size>0)){d(this,xd).clear();for(const{canvas:e}of d(this,Zl).values())e.remove();d(this,Zl).clear()}}},fo=new WeakMap,vn=new WeakMap,Fp=new WeakMap,$p=new WeakMap,Yl=new WeakMap,sa=new WeakMap,Up=new WeakMap,Bp=new WeakMap,Jl=new WeakMap,md=new WeakMap,gd=new WeakMap,po=new WeakMap,yd=new WeakMap,Hp=new WeakMap,vd=new WeakMap,Ql=new WeakMap,Vp=new WeakMap,zp=new WeakMap,xd=new WeakMap,Zl=new WeakMap,Wp=new WeakMap,mo=new WeakMap,wd=new WeakMap,Ia=new WeakSet,wP=function(e){var r,i;if(d(this,Fp))return;(i=d(this,sa)).ctx??(i.ctx=k(r=Mt,Yn,i0).call(r,d(this,Yl)));const t=d(this,Ql),n=d(this,Hp);for(const a of e){if(t.length>hB){Le("Ignoring additional textDivs for performance reasons."),S(this,Fp,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=d(this,vn);S(this,vn,document.createElement("span")),d(this,vn).classList.add("markedContent"),a.id!==null&&d(this,vn).setAttribute("id",`${a.id}`),o.append(d(this,vn))}else a.type==="endMarkedContent"&&S(this,vn,d(this,vn).parentNode);continue}n.push(a.str),k(this,Ia,bP).call(this,a)}},bP=function(e){var y;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};d(this,Ql).push(t);const r=ve.transform(d(this,zp),e.transform);let i=Math.atan2(r[1],r[0]);const a=d(this,yd)[e.fontName];a.vertical&&(i+=Math.PI/2);let o=d(this,$p)&&a.fontSubstitution||a.fontFamily;o=Mt.fontFamilyMap.get(o)||o;const l=Math.hypot(r[2],r[3]),u=l*k(y=Mt,Yn,_P).call(y,o,a,d(this,Yl));let h,f;i===0?(h=r[4],f=r[5]-u):(h=r[4]+u*Math.sin(i),f=r[5]-u*Math.cos(i));const p="calc(var(--total-scale-factor) *",m=t.style;d(this,vn)===d(this,md)?(m.left=`${(100*h/d(this,Bp)).toFixed(2)}%`,m.top=`${(100*f/d(this,Up)).toFixed(2)}%`):(m.left=`${p}${h.toFixed(2)}px)`,m.top=`${p}${f.toFixed(2)}px)`),m.fontSize=`${p}${(d(Mt,mo)*l).toFixed(2)}px)`,m.fontFamily=o,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,d(this,$p)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),i!==0&&(n.angle=i*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);b!==v&&Math.max(b,v)/Math.min(b,v)>1.5&&(g=!0)}if(g&&(n.canvasWidth=a.vertical?e.height:e.width),d(this,Vp).set(t,n),d(this,sa).div=t,d(this,sa).properties=n,k(this,Ia,Tb).call(this,d(this,sa)),n.hasText&&d(this,vn).append(t),n.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),d(this,vn).append(b)}},Tb=function(e){var o;const{div:t,properties:n,ctx:r}=e,{style:i}=t;let a="";if(d(Mt,mo)>1&&(a=`scale(${1/d(Mt,mo)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:l}=i,{canvasWidth:u,fontSize:h}=n;k(o=Mt,Yn,Cb).call(o,r,h*d(this,po),l);const{width:f}=r.measureText(t.textContent);f>0&&(a=`scaleX(${u*d(this,po)/f}) ${a}`)}n.angle!==0&&(a=`rotate(${n.angle}deg) ${a}`),a.length>0&&(i.transform=a)},Yn=new WeakSet,i0=function(e=null){let t=d(this,Zl).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),d(this,Zl).set(e,t),d(this,Wp).set(t,{size:0,family:""})}return t},Cb=function(e,t,n){const r=d(this,Wp).get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)},SP=function(){if(d(this,mo)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),S(this,mo,e.getBoundingClientRect().height),e.remove()},_P=function(e,t,n){const r=d(this,xd).get(e);if(r)return r;const i=k(this,Yn,i0).call(this,n);i.canvas.width=i.canvas.height=xk,k(this,Yn,Cb).call(this,i,xk,e);const a=i.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let u=.8;return o?u=o/(o+l):(gs.platform.isFirefox&&Le("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?u=t.ascent:t.descent&&(u=1+t.descent)),d(this,xd).set(e,u),u},A(Mt,Yn),A(Mt,xd,new Map),A(Mt,Zl,new Map),A(Mt,Wp,new WeakMap),A(Mt,mo,null),A(Mt,wd,new Set),Mt);class ep{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(i){var l;if(!i)return;let a=null;const o=i.name;if(o==="#text")a=i.value;else if(ep.shouldBuildText(o))(l=i==null?void 0:i.attributes)!=null&&l.textContent?a=i.attributes.textContent:i.value&&(a=i.value);else return;if(a!==null&&t.push({str:a}),!!i.children)for(const u of i.children)r(u)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const fB=100;function G_(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new Nb,{docId:t}=e,n=s.url?_6(s.url):null,r=s.data?E6(s.data):null,i=s.httpHeaders||null,a=s.withCredentials===!0,o=s.password??null,l=s.range instanceof q_?s.range:null,u=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:2**16;let h=s.worker instanceof ch?s.worker:null;const f=s.verbosity,p=typeof s.docBaseUrl=="string"&&!Xm(s.docBaseUrl)?s.docBaseUrl:null,m=Ng(s.cMapUrl),g=s.cMapPacked!==!1,y=s.CMapReaderFactory||(tn?P6:ok),b=Ng(s.iccUrl),v=Ng(s.standardFontDataUrl),x=s.StandardFontDataFactory||(tn?R6:lk),w=Ng(s.wasmUrl),E=s.WasmFactory||(tn?L6:ck),T=s.stopAtErrors!==!0,C=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,N=s.isEvalSupported!==!1,j=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!tn,P=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!tn&&(gs.platform.isFirefox||!globalThis.chrome),M=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,V=typeof s.disableFontFace=="boolean"?s.disableFontFace:tn,L=s.fontExtraProperties===!0,I=s.enableXfa===!0,O=s.ownerDocument||globalThis.document,X=s.disableRange===!0,$=s.disableStream===!0,H=s.disableAutoFetch===!0,D=s.pdfBug===!0,F=s.CanvasFactory||(tn?j6:T6),q=s.FilterFactory||(tn?N6:C6),J=s.enableHWA===!0,ee=s.useWasm!==!1,de=l?l.length:s.length??NaN,ge=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!tn&&!V,Ce=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:!!(y===ok&&x===lk&&E===ck&&m&&v&&w&&zh(m,document.baseURI)&&zh(v,document.baseURI)&&zh(w,document.baseURI)),B=null;i6(f);const K={canvasFactory:new F({ownerDocument:O,enableHWA:J}),filterFactory:new q({docId:t,ownerDocument:O}),cMapReaderFactory:Ce?null:new y({baseUrl:m,isCompressed:g}),standardFontDataFactory:Ce?null:new x({baseUrl:v}),wasmFactory:Ce?null:new E({baseUrl:w})};h||(h=ch.create({verbosity:f,port:Xr.workerPort}),e._worker=h);const xe={docId:t,apiVersion:"5.3.93",data:r,password:o,disableAutoFetch:H,rangeChunkSize:u,length:de,docBaseUrl:p,enableXfa:I,evaluatorOptions:{maxImageSize:C,disableFontFace:V,ignoreErrors:T,isEvalSupported:N,isOffscreenCanvasSupported:j,isImageDecoderSupported:P,canvasMaxAreaInBytes:M,fontExtraProperties:L,useSystemFonts:ge,useWasm:ee,useWorkerFetch:Ce,cMapUrl:m,iccUrl:b,standardFontDataUrl:v,wasmUrl:w}},Re={ownerDocument:O,pdfBug:D,styleElement:B,loadingParams:{disableAutoFetch:H,enableXfa:I}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Se=h.messageHandler.sendWithPromise("GetDocRequest",xe,r?[r.buffer]:null);let Ze;if(l)Ze=new X6(l,{disableRange:X,disableStream:$});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const lt=zh(n)?Z6:tn?cB:rB;Ze=new lt({url:n,length:de,httpHeaders:i,withCredentials:a,rangeChunkSize:u,disableRange:X,disableStream:$})}return Se.then(lt=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Ae=new Xh(t,lt,h.port),$e=new gB(Ae,e,Ze,Re,K);e._transport=$e,Ae.send("Ready",null)})}).catch(e._capability.reject),e}var Ay;const ky=class ky{constructor(){re(this,"_capability",Promise.withResolvers());re(this,"_transport",null);re(this,"_worker",null);re(this,"docId",`d${Ks(ky,Ay)._++}`);re(this,"destroyed",!1);re(this,"onPassword",null);re(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,n,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,i}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Ay=new WeakMap,A(ky,Ay,0);let Nb=ky;var ec,Gp,qp,Kp,Xp,Mk;let q_=(Mk=class{constructor(e,t,n=!1,r=null){A(this,ec,Promise.withResolvers());A(this,Gp,[]);A(this,qp,[]);A(this,Kp,[]);A(this,Xp,[]);this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){d(this,Xp).push(e)}addProgressListener(e){d(this,Kp).push(e)}addProgressiveReadListener(e){d(this,qp).push(e)}addProgressiveDoneListener(e){d(this,Gp).push(e)}onDataRange(e,t){for(const n of d(this,Xp))n(e,t)}onDataProgress(e,t){d(this,ec).promise.then(()=>{for(const n of d(this,Kp))n(e,t)})}onDataProgressiveRead(e){d(this,ec).promise.then(()=>{for(const t of d(this,qp))t(e)})}onDataProgressiveDone(){d(this,ec).promise.then(()=>{for(const e of d(this,Gp))e()})}transportReady(){d(this,ec).resolve()}requestDataRange(e,t){at("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},ec=new WeakMap,Gp=new WeakMap,qp=new WeakMap,Kp=new WeakMap,Xp=new WeakMap,Mk);class pB{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ve(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var na,tc,ef;class mB{constructor(e,t,n,r=!1){A(this,tc);A(this,na,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new rk:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new xP,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new Km({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ve(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:r=Ci.ENABLE,transform:i=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:h=null,isEditing:f=!1}){var E,T;(E=this._stats)==null||E.time("Overall");const p=this._transport.getRenderingIntent(n,r,h,f),{renderingIntent:m,cacheKey:g}=p;S(this,na,!1),o||(o=this._transport.getOptionalContentConfig(m));let y=this._intentStates.get(g);y||(y=Object.create(null),this._intentStates.set(g,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const b=!!(m&zn.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(T=this._stats)==null||T.time("Page Request"),this._pumpOperatorList(p));const v=C=>{var N;y.renderTasks.delete(x),b&&S(this,na,!0),k(this,tc,ef).call(this),C?(x.capability.reject(C),this._abortOperatorList({intentState:y,reason:C instanceof Error?C:new Error(C)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(N=globalThis.Stats)!=null&&N.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new jb({callback:v,params:{canvasContext:e,viewport:t,transform:i,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:u});(y.renderTasks||(y.renderTasks=new Set)).add(x);const w=x.task;return Promise.all([y.displayReadyCapability.promise,o]).then(([C,N])=>{var j;if(this.destroyed){v();return}if((j=this._stats)==null||j.time("Rendering"),!(N.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:C,optionalContentConfig:N}),x.operatorListChanged()}).catch(v),w}getOperatorList({intent:e="display",annotationMode:t=Ci.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){var u;function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,n,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>ep.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function i(){a.read().then(function({value:l,done:u}){if(u){n(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),i()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),S(this,na,!1),Promise.all(e)}cleanup(e=!1){S(this,na,!0);const t=k(this,tc,ef).call(this);return e&&t&&this._stats&&(this._stats=new rk),t}_startRenderPage(e,t){var r,i;const n=this._intentStates.get(t);n&&((r=this._stats)==null||r.timeEnd("Page Request"),(i=n.displayReadyCapability)==null||i.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&k(this,tc,ef).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:i,transfer:a}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},a).getReader(),u=this._intentStates.get(t);u.streamReader=l;const h=()=>{l.read().then(({value:f,done:p})=>{if(p){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,u),h())},f=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const p of u.renderTasks)p.operatorListChanged();k(this,tc,ef).call(this)}if(u.displayReadyCapability)u.displayReadyCapability.reject(f);else if(u.opListReadCapability)u.opListReadCapability.reject(f);else throw f}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof gv){let r=fB;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Da(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,i]of this._intentStates)if(i===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}na=new WeakMap,tc=new WeakSet,ef=function(){if(!d(this,na)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),S(this,na,!1),!0};var go,Or,ra,sc,Ty,nc,rc,an,a0,EP,AP,tf,bd,o0;const St=class St{constructor({name:e=null,port:t=null,verbosity:n=a6()}={}){A(this,an);A(this,go,Promise.withResolvers());A(this,Or,null);A(this,ra,null);A(this,sc,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(d(St,rc).has(t))throw new Error("Cannot use more than one PDFWorker per port.");d(St,rc).set(t,this),k(this,an,EP).call(this,t)}else k(this,an,AP).call(this)}get promise(){return d(this,go).promise}get port(){return d(this,ra)}get messageHandler(){return d(this,Or)}destroy(){var e,t;this.destroyed=!0,(e=d(this,sc))==null||e.terminate(),S(this,sc,null),d(St,rc).delete(d(this,ra)),S(this,ra,null),(t=d(this,Or))==null||t.destroy(),S(this,Or,null)}static create(e){const t=d(this,rc).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new St(e)}static get workerSrc(){if(Xr.workerSrc)return Xr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ve(this,"_setupFakeWorkerGlobal",(async()=>d(this,bd,o0)?d(this,bd,o0):(await import(this.workerSrc)).WorkerMessageHandler)())}};go=new WeakMap,Or=new WeakMap,ra=new WeakMap,sc=new WeakMap,Ty=new WeakMap,nc=new WeakMap,rc=new WeakMap,an=new WeakSet,a0=function(){d(this,go).resolve(),d(this,Or).send("configure",{verbosity:this.verbosity})},EP=function(e){S(this,ra,e),S(this,Or,new Xh("main","worker",e)),d(this,Or).on("ready",()=>{}),k(this,an,a0).call(this)},AP=function(){if(d(St,nc)||d(St,bd,o0)){k(this,an,tf).call(this);return}let{workerSrc:e}=St;try{St._isSameOrigin(window.location,e)||(e=St._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new Xh("main","worker",t),r=()=>{i.abort(),n.destroy(),t.terminate(),this.destroyed?d(this,go).reject(new Error("Worker was destroyed")):k(this,an,tf).call(this)},i=new AbortController;t.addEventListener("error",()=>{d(this,sc)||r()},{signal:i.signal}),n.on("test",o=>{if(i.abort(),this.destroyed||!o){r();return}S(this,Or,n),S(this,ra,t),S(this,sc,t),k(this,an,a0).call(this)}),n.on("ready",o=>{if(i.abort(),this.destroyed){r();return}try{a()}catch{k(this,an,tf).call(this)}});const a=()=>{const o=new Uint8Array;n.send("test",o,[o.buffer])};a();return}catch{mv("The worker has been disabled.")}k(this,an,tf).call(this)},tf=function(){d(St,nc)||(Le("Setting up fake worker."),S(St,nc,!0)),St._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){d(this,go).reject(new Error("Worker was destroyed"));return}const t=new k6;S(this,ra,t);const n=`fake${Ks(St,Ty)._++}`,r=new Xh(n+"_worker",n,t);e.setup(r,t),S(this,Or,new Xh(n,n+"_worker",t)),k(this,an,a0).call(this)}).catch(e=>{d(this,go).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},bd=new WeakSet,o0=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},A(St,bd),A(St,Ty,0),A(St,nc,!1),A(St,rc,new WeakMap),tn&&(S(St,nc,!0),Xr.workerSrc||(Xr.workerSrc="./pdf.worker.mjs")),St._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},St._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},St.fromPort=e=>{if(m6("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return St.create(e)};let ch=St;var ia,xi,Sd,_d,aa,ic,sf;class gB{constructor(e,t,n,r,i){A(this,ic);A(this,ia,new Map);A(this,xi,new Map);A(this,Sd,new Map);A(this,_d,new Map);A(this,aa,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new xP,this.fontLoader=new b6({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.wasmFactory=i.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Ve(this,"annotationStorage",new V_)}getRenderingIntent(e,t=Ci.ENABLE,n=null,r=!1,i=!1){let a=zn.DISPLAY,o=gb;switch(e){case"any":a=zn.ANY;break;case"display":break;case"print":a=zn.PRINT;break;default:Le(`getRenderingIntent - invalid intent: ${e}`)}const l=a&zn.PRINT&&n instanceof sP?n:this.annotationStorage;switch(t){case Ci.DISABLE:a+=zn.ANNOTATIONS_DISABLE;break;case Ci.ENABLE:break;case Ci.ENABLE_FORMS:a+=zn.ANNOTATIONS_FORMS;break;case Ci.ENABLE_STORAGE:a+=zn.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Le(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=zn.IS_EDITING),i&&(a+=zn.OPLIST);const{ids:u,hash:h}=l.modifiedIds,f=[a,o.hash,h];return{renderingIntent:a,cacheKey:f.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=d(this,aa))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of d(this,xi).values())e.push(r._destroy());d(this,xi).clear(),d(this,Sd).clear(),d(this,_d).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,i;this.commonObjs.clear(),this.fontLoader.clear(),d(this,ia).clear(),this.filterFactory.destroy(),Zf.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new Da("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{Kt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},r.onPull=()=>{this._fullReader.read().then(function({value:i,done:a}){if(a){r.close();return}Kt(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{r.error(i)})},r.onCancel=i=>{this._fullReader.cancel(i),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async n=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:i,contentLength:a}=this._fullReader;return(!r||!i)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:r,isRangeSupported:i,contentLength:a}}),e.on("GetRangeReader",(n,r)=>{Kt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(n.begin,n.end);if(!i){r.close();return}r.onPull=()=>{i.read().then(function({value:a,done:o}){if(o){r.close();return}Kt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{i.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new pB(n,this))}),e.on("DocException",n=>{t._capability.reject(mn(n))}),e.on("PasswordRequest",n=>{S(this,aa,Promise.withResolvers());try{if(!t.onPassword)throw mn(n);const r=i=>{i instanceof Error?d(this,aa).reject(i):d(this,aa).resolve({password:i})};t.onPassword(r,n.code)}catch(r){d(this,aa).reject(r)}return d(this,aa).promise}),e.on("DataLoaded",n=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;d(this,xi).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,i])=>{var a;if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in i){const h=i.error;Le(`Error during font loading: ${h}`),this.commonObjs.resolve(n,h);break}const o=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(h,f)=>globalThis.FontInspector.fontAdded(h,f):null,l=new S6(i,o);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(n,l)});break;case"CopyLocalImage":const{imageRef:u}=i;Kt(u,"The imageRef must be defined.");for(const h of d(this,xi).values())for(const[,f]of h.objs)if((f==null?void 0:f.ref)===u)return f.dataLen?(this.commonObjs.resolve(n,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,i);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,i,a])=>{var l;if(this.destroyed)return;const o=d(this,xi).get(r);if(!o.objs.has(n)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(i){case"Image":case"Pattern":o.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",n=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&Le("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=d(this,Sd).get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&d(this,_d).set(i.refStr,e);const a=new mB(t,i,this,this._params.pdfBug);return d(this,xi).set(t,a),a});return d(this,Sd).set(t,r),r}getPageIndex(e){return yb(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return k(this,ic,sf).call(this,"GetFieldObjects")}hasJSActions(){return k(this,ic,sf).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return k(this,ic,sf).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return k(this,ic,sf).call(this,"GetOptionalContentConfig").then(t=>new K6(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=d(this,ia).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>{var i,a;return{info:r[0],metadata:r[1]?new G6(r[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return d(this,ia).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of d(this,xi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),d(this,ia).clear(),this.filterFactory.destroy(!0),Zf.cleanup()}}cachedPageNumber(e){if(!yb(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return d(this,_d).get(t)??null}}ia=new WeakMap,xi=new WeakMap,Sd=new WeakMap,_d=new WeakMap,aa=new WeakMap,ic=new WeakSet,sf=function(e,t=null){const n=d(this,ia).get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return d(this,ia).set(e,r),r};var yo;class yB{constructor(e){A(this,yo,null);re(this,"onContinue",null);re(this,"onError",null);S(this,yo,e)}get promise(){return d(this,yo).capability.promise}cancel(e=0){d(this,yo).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=d(this,yo).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=d(this,yo);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}yo=new WeakMap;var vo,ac;const Sl=class Sl{constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:h=!1,pdfBug:f=!1,pageColors:p=null}){A(this,vo,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=f,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new yB(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(d(Sl,ac).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d(Sl,ac).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:r,transform:i,background:a}=this.params;this.gfx=new zu(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n,r,i;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),d(this,vo)&&(window.cancelAnimationFrame(d(this,vo)),S(this,vo,null)),d(Sl,ac).delete(this._canvas),e||(e=new gv(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(i=(r=this.task).onError)==null||i.call(r,e)}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?S(this,vo,window.requestAnimationFrame(()=>{S(this,vo,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),d(Sl,ac).delete(this._canvas),this.callback())))}};vo=new WeakMap,ac=new WeakMap,A(Sl,ac,new WeakSet);let jb=Sl;const kP="5.3.93",TP="cbeef3233";function wk(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function Dh(s){return Math.max(0,Math.min(255,255*s))}class bk{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Dh(e),[e,e,e]}static G_HTML([e]){const t=wk(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Dh)}static RGB_HTML(e){return`#${e.map(wk).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[Dh(1-Math.min(1,e+r)),Dh(1-Math.min(1,n+r)),Dh(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,i=1-t,a=1-n,o=Math.min(r,i,a);return["CMYK",r,i,a,o]}}class vB{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){at("Abstract method `_createSVG` called.")}}class tp extends vB{_createSVG(e){return document.createElementNS(Ii,e)}}class K_{static setupStorage(e,t,n,r,i){const a=r.getValue(t,{value:null});switch(n.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(a.value===n.attributes.xfaOn?e.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of n.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;r.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:i}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[l,u]of Object.entries(a))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}o&&i.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){var f,p;const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,i=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:i,linkService:n});const o=i!=="richText",l=e.div;if(l.append(a),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}o&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(r.children.length===0){if(r.value){const m=document.createTextNode(r.value);a.append(m),o&&ep.shouldBuildText(r.name)&&u.push(m)}return{textDivs:u}}const h=[[r,-1,a]];for(;h.length>0;){const[m,g,y]=h.at(-1);if(g+1===m.children.length){h.pop();continue}const b=m.children[++h.at(-1)[1]];if(b===null)continue;const{name:v}=b;if(v==="#text"){const w=document.createTextNode(b.value);u.push(w),y.append(w);continue}const x=(f=b==null?void 0:b.attributes)!=null&&f.xmlns?document.createElementNS(b.attributes.xmlns,v):document.createElement(v);if(y.append(x),b.attributes&&this.setAttributes({html:x,element:b,storage:t,intent:i,linkService:n}),((p=b.children)==null?void 0:p.length)>0)h.push([b,-1,x]);else if(b.value){const w=document.createTextNode(b.value);o&&ep.shouldBuildText(v)&&u.push(w),x.append(w)}}for(const m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const xB=9,Wc=new WeakSet;class Sk{static create(e){switch(e.data.annotationType){case Ot.LINK:return new CP(e);case Ot.TEXT:return new wB(e);case Ot.WIDGET:switch(e.data.fieldType){case"Tx":return new bB(e);case"Btn":return e.data.radioButton?new PP(e):e.data.checkBox?new _B(e):new EB(e);case"Ch":return new AB(e);case"Sig":return new SB(e)}return new eu(e);case Ot.POPUP:return new Rb(e);case Ot.FREETEXT:return new IP(e);case Ot.LINE:return new TB(e);case Ot.SQUARE:return new CB(e);case Ot.CIRCLE:return new NB(e);case Ot.POLYLINE:return new OP(e);case Ot.CARET:return new PB(e);case Ot.INK:return new X_(e);case Ot.POLYGON:return new jB(e);case Ot.HIGHLIGHT:return new FP(e);case Ot.UNDERLINE:return new RB(e);case Ot.SQUIGGLY:return new LB(e);case Ot.STRIKEOUT:return new DB(e);case Ot.STAMP:return new $P(e);case Ot.FILEATTACHMENT:return new MB(e);default:return new Vt(e)}}}var oc,Ed,Ad,Yp,Pb;const sE=class sE{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){A(this,Yp);A(this,oc,null);A(this,Ed,!1);A(this,Ad,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return sE._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;d(this,oc)||S(this,oc,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&k(this,Yp,Pb).call(this,t),(n=d(this,Ad))==null||n.popup.updateEdited(e)}resetEdited(){var e;d(this,oc)&&(k(this,Yp,Pb).call(this,d(this,oc).rect),(e=d(this,Ad))==null||e.popup.resetEdited(),S(this,oc,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof eu||(i.tabIndex=0);const{style:a}=i;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof Rb){const{rotation:y}=t;return!t.hasOwnCanvas&&y!==0&&this.setRotation(y,i),i}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const y=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(y>0||b>0){const x=`calc(${y}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;a.borderRadius=x}else if(this instanceof PP){const x=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=x}switch(t.borderStyle.style){case hu.SOLID:a.borderStyle="solid";break;case hu.DASHED:a.borderStyle="dashed";break;case hu.BEVELED:Le("Unimplemented border style: beveled");break;case hu.INSET:Le("Unimplemented border style: inset");break;case hu.UNDERLINE:a.borderBottomStyle="solid";break}const v=t.borderColor||null;v?(S(this,Ed,!0),a.borderColor=ve.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):a.borderWidth=0}const u=ve.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:f,pageX:p,pageY:m}=r.rawDims;a.left=`${100*(u[0]-p)/h}%`,a.top=`${100*(u[1]-m)/f}%`;const{rotation:g}=t;return t.hasOwnCanvas||g===0?(a.width=`${100*o/h}%`,a.height=`${100*l/f}%`):this.setRotation(g,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:i,height:a}=this;e%180!==0&&([i,a]=[a,i]),t.style.width=`${100*i/n}%`,t.style.height=`${100*a/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const i=r.detail[t],a=i[0],o=i.slice(1);r.target.style[n]=bk[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[n]:bk[`${a}_rgb`](o)})};return Ve(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail)){const i=e[r]||n[r];i==null||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,i]of Object.entries(t)){const a=n[r];if(a){const o={detail:{[r]:i},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,i]=this.data.rect.map(y=>Math.fround(y));if(e.length===8){const[y,b,v,x]=e.subarray(2,6);if(r===y&&i===b&&t===v&&n===x)return}const{style:a}=this.container;let o;if(d(this,Ed)){const{borderColor:y,borderWidth:b}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const l=r-t,u=i-n,{svgFactory:h}=this,f=h.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0),f.role="none";const p=h.createElement("defs");f.append(p);const m=h.createElement("clipPath"),g=`clippath_${this.data.id}`;m.setAttribute("id",g),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let y=2,b=e.length;y<b;y+=8){const v=e[y],x=e[y+1],w=e[y+2],E=e[y+3],T=h.createElement("rect"),C=(w-t)/l,N=(i-x)/u,j=(v-w)/l,P=(x-E)/u;T.setAttribute("x",C),T.setAttribute("y",N),T.setAttribute("width",j),T.setAttribute("height",P),m.append(T),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${N}" width="${j}" height="${P}"/>`)}d(this,Ed)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(f),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:e}=this,t=S(this,Ad,new Rb({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){at("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:i,id:a,exportValues:o}of r){if(i===-1||a===t)continue;const l=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!Wc.has(u)){Le(`_getElementsByName - element not allowed: ${a}`);continue}n.push({id:a,exportValue:l,domElement:u})}return n}for(const r of document.getElementsByName(e)){const{exportValue:i}=r,a=r.getAttribute("data-element-id");a!==t&&Wc.has(r)&&n.push({id:a,exportValue:i,domElement:r})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};oc=new WeakMap,Ed=new WeakMap,Ad=new WeakMap,Yp=new WeakSet,Pb=function(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}}}=this;n==null||n.splice(0,4,...e),t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+l)/a}%`,r===0?(t.width=`${100*(e[2]-e[0])/i}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(r)};let Vt=sE;var qn,yl,NP,jP;class CP extends Vt{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});A(this,qn);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let i=!1;return t.url?(n.addLinkAttributes(r,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(r,t.action),i=!0):t.attachment?(k(this,qn,NP).call(this,r,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(k(this,qn,jP).call(this,r,t.setOCGState),i=!0):t.dest?(this._bindLink(r,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),i=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&k(this,qn,yl).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),k(this,qn,yl).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(n.actions)){const a=r.get(i);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),k(this,qn,yl).call(this)}_bindResetFormAction(t,n){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),k(this,qn,yl).call(this),!this._fieldObjects){Le('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var f;r==null||r();const{fields:i,refs:a,include:o}=n,l=[];if(i.length!==0||a.length!==0){const p=new Set(a);for(const m of i){const g=this._fieldObjects[m]||[];for(const{id:y}of g)p.add(y)}for(const m of Object.values(this._fieldObjects))for(const g of m)p.has(g.id)===o&&l.push(g)}else for(const p of Object.values(this._fieldObjects))l.push(...p);const u=this.annotationStorage,h=[];for(const p of l){const{id:m}=p;switch(h.push(m),p.type){case"text":{const y=p.defaultValue||"";u.setValue(m,{value:y});break}case"checkbox":case"radiobutton":{const y=p.defaultValue===p.exportValues;u.setValue(m,{value:y});break}case"combobox":case"listbox":{const y=p.defaultValue||"";u.setValue(m,{value:y});break}default:continue}const g=document.querySelector(`[data-element-id="${m}"]`);if(g){if(!Wc.has(g)){Le(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}qn=new WeakSet,yl=function(){this.container.setAttribute("data-internal-link","")},NP=function(t,n,r=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(n.content,n.filename,r),!1},k(this,qn,yl).call(this)},jP=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),k(this,qn,yl).call(this)};class wB extends Vt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class eu extends Vt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return gs.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,i){n.includes("mouse")?e.addEventListener(n,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(n,a=>{var o;if(n==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}i&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a)}}))})}_setEventListeners(e,t,n,r){var i,a,o;for(const[l,u]of n)(u==="Action"||(i=this.data.actions)!=null&&i[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,u,r),u==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ve.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||xB,i=e.style;let a;const o=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),h=Math.round(u/(Ax*r))||1,f=u/h;a=Math.min(r,l(f/Ax))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,l(u/Ax))}i.fontSize=`calc(${a}px * var(--total-scale-factor))`,i.color=ve.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class bB extends eu{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const i=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),i.setValue(a.id,{[r]:n})}render(){var r,i;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let u=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=u??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",u??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Wc.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const f=this.data.dateFormat||this.data.timeFormat;f&&(n.title=f),this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",m=>{e.setValue(t,{value:m.target.value}),this.setPropertyOnSiblings(n,"value",m.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",m=>{const g=this.data.defaultFieldValue??"";n.value=h.userValue=g,h.formattedValue=null});let p=m=>{const{formattedValue:g}=h;g!=null&&(m.target.value=g),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",g=>{var b;if(h.focused)return;const{target:y}=g;h.userValue&&(y.value=h.userValue),h.lastCommittedValue=y.value,h.commitKey=1,(b=this.data.actions)!=null&&b.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const y={value(b){h.userValue=b.detail.value??"",e.setValue(t,{value:h.userValue.toString()}),b.target.value=h.userValue},formattedValue(b){const{formattedValue:v}=b.detail;h.formattedValue=v,v!=null&&b.target!==document.activeElement&&(b.target.value=v),e.setValue(t,{formattedValue:v})},selRange(b){b.target.setSelectionRange(...b.detail.selRange)},charLimit:b=>{var E;const{charLimit:v}=b.detail,{target:x}=b;if(v===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",v);let w=h.userValue;!w||w.length<=v||(w=w.slice(0,v),x.value=h.userValue=w,e.setValue(t,{value:w}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(y,g)}),n.addEventListener("keydown",g=>{var v;h.commitKey=1;let y=-1;if(g.key==="Escape"?y=0:g.key==="Enter"&&!this.data.multiLine?y=2:g.key==="Tab"&&(h.commitKey=3),y===-1)return;const{value:b}=g.target;h.lastCommittedValue!==b&&(h.lastCommittedValue=b,h.userValue=b,(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:y,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const m=p;p=null,n.addEventListener("blur",g=>{var b,v;if(!h.focused||!g.relatedTarget)return;(b=this.data.actions)!=null&&b.Blur||(h.focused=!1);const{value:y}=g.target;h.userValue=y,h.lastCommittedValue!==y&&((v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:h.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}})),m(g)}),(i=this.data.actions)!=null&&i.Keystroke&&n.addEventListener("beforeinput",g=>{var C;h.lastCommittedValue=null;const{data:y,target:b}=g,{value:v,selectionStart:x,selectionEnd:w}=b;let E=x,T=w;switch(g.inputType){case"deleteWordBackward":{const N=v.substring(0,x).match(/\w*[^\w]*$/);N&&(E-=N[0].length);break}case"deleteWordForward":{const N=v.substring(x).match(/^[^\w]*\w*/);N&&(T+=N[0].length);break}case"deleteContentBackward":x===w&&(E-=1);break;case"deleteContentForward":x===w&&(T+=1);break}g.preventDefault(),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,change:y||"",willCommit:!1,selStart:E,selEnd:T}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(p&&n.addEventListener("blur",p),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class SB extends eu{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class _B extends eu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return Wc.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=0,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,n)){const h=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=h),e.setValue(u.id,{value:h})}e.setValue(n,{value:l})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class PP extends eu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,n))e.setValue(a.id,{value:!1});const i=document.createElement("input");if(Wc.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=0,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,n))e.setValue(u.id,{value:!1});e.setValue(n,{value:l})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;i.addEventListener("updatefromsandbox",o=>{const l={value:u=>{const h=a===u.detail.value;for(const f of this._getElementsByName(u.target.name)){const p=h&&f.id===n;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class EB extends CP{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class AB extends eu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");Wc.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",h=>{const f=this.data.defaultFieldValue;for(const p of r.options)p.selected=p.value===f});for(const h of this.data.options){const f=document.createElement("option");f.textContent=h.displayValue,f.value=h.exportValue,n.value.includes(h.exportValue)&&(f.setAttribute("selected",!0),i=!1),r.append(f)}let a=null;if(i){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),r.prepend(h),a=()=>{h.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=h=>{const f=h?"value":"textContent",{options:p,multiple:m}=r;return m?Array.prototype.filter.call(p,g=>g.selected).map(g=>g[f]):p.selectedIndex===-1?null:p[p.selectedIndex][f]};let l=o(!1);const u=h=>{const f=h.target.options;return Array.prototype.map.call(f,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",h=>{const f={value(p){a==null||a();const m=p.detail.value,g=new Set(Array.isArray(m)?m:[m]);for(const y of r.options)y.selected=g.has(y.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(p){r.multiple=!0},remove(p){const m=r.options,g=p.detail.remove;m[g].selected=!1,r.remove(g),m.length>0&&Array.prototype.findIndex.call(m,b=>b.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:o(!0),items:u(p)}),l=o(!1)},clear(p){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(p){const{index:m,displayValue:g,exportValue:y}=p.detail.insert,b=r.children[m],v=document.createElement("option");v.textContent=g,v.value=y,b?b.before(v):r.append(v),e.setValue(t,{value:o(!0),items:u(p)}),l=o(!1)},items(p){const{items:m}=p.detail;for(;r.length!==0;)r.remove(0);for(const g of m){const{displayValue:y,exportValue:b}=g,v=document.createElement("option");v.textContent=y,v.value=b,r.append(v)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:u(p)}),l=o(!1)},indices(p){const m=new Set(p.detail.indices);for(const g of p.target.options)g.selected=m.has(g.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(f,h)}),r.addEventListener("input",h=>{var m;const f=o(!0),p=o(!1);e.setValue(t,{value:f}),h.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):r.addEventListener("input",function(h){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Rb extends Vt{constructor(e){const{data:t,elements:n}=e;super(e,{isRenderable:Vt._hasPopupData(t)}),this.elements=n,this.popup=null}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=new kB({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[];for(const r of this.elements)r.popup=t,r.container.ariaHasPopup="dialog",n.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(r=>`${B_}${r}`).join(",")),this.container}}var kd,Cy,Ny,Td,Cd,Dt,oa,lc,Jp,Qp,Nd,la,Fr,ca,Zp,ua,em,cc,uc,ot,l0,Lb,RP,LP,DP,MP,c0,u0,Db;class kB{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:l,rect:u,parentRect:h,open:f}){A(this,ot);A(this,kd,k(this,ot,DP).bind(this));A(this,Cy,k(this,ot,Db).bind(this));A(this,Ny,k(this,ot,u0).bind(this));A(this,Td,k(this,ot,c0).bind(this));A(this,Cd,null);A(this,Dt,null);A(this,oa,null);A(this,lc,null);A(this,Jp,null);A(this,Qp,null);A(this,Nd,null);A(this,la,!1);A(this,Fr,null);A(this,ca,null);A(this,Zp,null);A(this,ua,null);A(this,em,null);A(this,cc,null);A(this,uc,!1);var p;S(this,Dt,e),S(this,em,r),S(this,oa,a),S(this,ua,o),S(this,Qp,l),S(this,Cd,t),S(this,Zp,u),S(this,Nd,h),S(this,Jp,n),S(this,lc,vv.toDateObject(i)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(const m of this.trigger)m.addEventListener("click",d(this,Td)),m.addEventListener("mouseenter",d(this,Ny)),m.addEventListener("mouseleave",d(this,Cy)),m.classList.add("popupTriggerArea");for(const m of n)(p=m.container)==null||p.addEventListener("keydown",d(this,kd));d(this,Dt).hidden=!0,f&&k(this,ot,c0).call(this)}render(){if(d(this,Fr))return;const e=S(this,Fr,document.createElement("div"));if(e.className="popup",d(this,Cd)){const i=e.style.outlineColor=ve.makeHexColor(...d(this,Cd));e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const t=document.createElement("span");t.className="header";const n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=d(this,em),e.append(t),d(this,lc)){const i=document.createElement("time");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:d(this,lc).valueOf()})),i.dateTime=d(this,lc).toISOString(),t.append(i)}const r=d(this,ot,l0);if(r)K_.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(d(this,oa));e.append(i)}d(this,Dt).append(e)}_formatContents({str:e,dir:t}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let i=0,a=r.length;i<a;++i){const o=r[i];n.append(document.createTextNode(o)),i<a-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;d(this,cc)||S(this,cc,{contentsObj:d(this,oa),richText:d(this,ua)}),e&&S(this,ca,null),t&&(S(this,ua,k(this,ot,LP).call(this,t)),S(this,oa,null)),(n=d(this,Fr))==null||n.remove(),S(this,Fr,null)}resetEdited(){var e;d(this,cc)&&({contentsObj:Ks(this,oa)._,richText:Ks(this,ua)._}=d(this,cc),S(this,cc,null),(e=d(this,Fr))==null||e.remove(),S(this,Fr,null),S(this,ca,null))}forceHide(){S(this,uc,this.isVisible),d(this,uc)&&(d(this,Dt).hidden=!0)}maybeShow(){d(this,uc)&&(d(this,Fr)||k(this,ot,u0).call(this),S(this,uc,!1),d(this,Dt).hidden=!1)}get isVisible(){return d(this,Dt).hidden===!1}}kd=new WeakMap,Cy=new WeakMap,Ny=new WeakMap,Td=new WeakMap,Cd=new WeakMap,Dt=new WeakMap,oa=new WeakMap,lc=new WeakMap,Jp=new WeakMap,Qp=new WeakMap,Nd=new WeakMap,la=new WeakMap,Fr=new WeakMap,ca=new WeakMap,Zp=new WeakMap,ua=new WeakMap,em=new WeakMap,cc=new WeakMap,uc=new WeakMap,ot=new WeakSet,l0=function(){const e=d(this,ua),t=d(this,oa);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&d(this,ua).html||null},Lb=function(){var e,t,n;return((n=(t=(e=d(this,ot,l0))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},RP=function(){var e,t,n;return((n=(t=(e=d(this,ot,l0))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},LP=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:d(this,ot,RP),fontSize:d(this,ot,Lb)?`calc(${d(this,ot,Lb)}px * var(--total-scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:r});return n},DP=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&d(this,la))&&k(this,ot,c0).call(this)},MP=function(){if(d(this,ca)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=d(this,Qp);let a=!!d(this,Nd),o=a?d(this,Nd):d(this,Zp);for(const g of d(this,Jp))if(!o||ve.intersect(g.data.rect,o)!==null){o=g.data.rect,a=!0;break}const l=ve.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),h=a?o[2]-o[0]+5:0,f=l[0]+h,p=l[1];S(this,ca,[100*(f-r)/t,100*(p-i)/n]);const{style:m}=d(this,Dt);m.left=`${d(this,ca)[0]}%`,m.top=`${d(this,ca)[1]}%`},c0=function(){S(this,la,!d(this,la)),d(this,la)?(k(this,ot,u0).call(this),d(this,Dt).addEventListener("click",d(this,Td)),d(this,Dt).addEventListener("keydown",d(this,kd))):(k(this,ot,Db).call(this),d(this,Dt).removeEventListener("click",d(this,Td)),d(this,Dt).removeEventListener("keydown",d(this,kd)))},u0=function(){d(this,Fr)||this.render(),this.isVisible?d(this,la)&&d(this,Dt).classList.add("focused"):(k(this,ot,MP).call(this),d(this,Dt).hidden=!1,d(this,Dt).style.zIndex=parseInt(d(this,Dt).style.zIndex)+1e3)},Db=function(){d(this,Dt).classList.remove("focused"),!(d(this,la)||!this.isVisible)&&(d(this,Dt).hidden=!0,d(this,Dt).style.zIndex=parseInt(d(this,Dt).style.zIndex)-1e3)};class IP extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Pe.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var tm;class TB extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,tm,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:n,height:r}=this,i=this.svgFactory.create(n,r,!0),a=S(this,tm,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,tm)}addHighlightArea(){this.container.classList.add("highlightArea")}}tm=new WeakMap;var sm;class CB extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,sm,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:n,height:r}=this,i=this.svgFactory.create(n,r,!0),a=t.borderStyle.width,o=S(this,sm,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",n-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,sm)}addHighlightArea(){this.container.classList.add("highlightArea")}}sm=new WeakMap;var nm;class NB extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,nm,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:n,height:r}=this,i=this.svgFactory.create(n,r,!0),a=t.borderStyle.width,o=S(this,nm,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",n/2),o.setAttribute("cy",r/2),o.setAttribute("rx",n/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,nm)}addHighlightArea(){this.container.classList.add("highlightArea")}}nm=new WeakMap;var rm;class OP extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,rm,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:r,popupRef:i},width:a,height:o}=this;if(!n)return this.container;const l=this.svgFactory.create(a,o,!0);let u=[];for(let f=0,p=n.length;f<p;f+=2){const m=n[f]-t[0],g=t[3]-n[f+1];u.push(`${m},${g}`)}u=u.join(" ");const h=S(this,rm,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",u),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),l.append(h),this.container.append(l),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,rm)}addHighlightArea(){this.container.classList.add("highlightArea")}}rm=new WeakMap;class jB extends OP{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class PB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var im,dc,am,Mb;class X_ extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,am);A(this,im,null);A(this,dc,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Pe.HIGHLIGHT:Pe.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:r,borderStyle:i,popupRef:a}}=this,{transform:o,width:l,height:u}=k(this,am,Mb).call(this,n,t),h=this.svgFactory.create(l,u,!0),f=S(this,im,this.svgFactory.createElement("svg:g"));h.append(f),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",o);for(let p=0,m=r.length;p<m;p++){const g=this.svgFactory.createElement(this.svgElementName);d(this,dc).push(g),g.setAttribute("points",r[p].join(",")),f.append(g)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:r,rect:i}=t,a=d(this,im);if(n>=0&&a.setAttribute("stroke-width",n||1),r)for(let o=0,l=d(this,dc).length;o<l;o++)d(this,dc)[o].setAttribute("points",r[o].join(","));if(i){const{transform:o,width:l,height:u}=k(this,am,Mb).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return d(this,dc)}addHighlightArea(){this.container.classList.add("highlightArea")}}im=new WeakMap,dc=new WeakMap,am=new WeakSet,Mb=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class FP extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Pe.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class RB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class LB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class DB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class $P extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Pe.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var om,lm,Ib;class MB extends Vt{constructor(t){var r;super(t,{isRenderable:!0});A(this,lm);A(this,om,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let r;n.hasAppearance||n.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),r.addEventListener("dblclick",k(this,lm,Ib).bind(this)),S(this,om,r);const{isMac:i}=gs.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&k(this,lm,Ib).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return d(this,om)}addHighlightArea(){this.container.classList.add("highlightArea")}}om=new WeakMap,lm=new WeakSet,Ib=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var cm,hc,xo,um,el,Ob,Fb,jd;let Y_=(jd=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:i,viewport:a,structTreeLayer:o}){A(this,el);A(this,cm,null);A(this,hc,null);A(this,xo,new Map);A(this,um,null);this.div=e,S(this,cm,t),S(this,hc,n),S(this,um,o||null),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return d(this,xo).size>0}async render(e){var a;const{annotations:t}=e,n=this.div;Yo(n,this.viewport);const r=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new tp,annotationStorage:e.annotationStorage||new V_,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===Ot.POPUP;if(l){const f=r.get(o.id);if(!f)continue;i.elements=f}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;i.data=o;const u=Sk.create(i);if(!u.isRenderable)continue;if(!l&&o.popupRef){const f=r.get(o.popupRef);f?f.push(u):r.set(o.popupRef,[u])}const h=u.render();o.hidden&&(h.style.visibility="hidden"),await k(this,el,Ob).call(this,h,o.id,i.elements),u._isEditable&&(d(this,xo).set(u.data.id,u),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(u))}k(this,el,Fb).call(this)}async addLinkAnnotations(e,t){const n={data:null,layer:this.div,linkService:t,svgFactory:new tp,parent:this};for(const r of e){r.borderStyle||(r.borderStyle=jd._defaultBorderStyle),n.data=r;const i=Sk.create(n);if(!i.isRenderable)continue;const a=i.render();await k(this,el,Ob).call(this,a,r.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,Yo(t,{rotation:e.rotation}),k(this,el,Fb).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(d(this,xo).values())}getEditableAnnotation(e){return d(this,xo).get(e)}static get _defaultBorderStyle(){return Ve(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:hu.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},cm=new WeakMap,hc=new WeakMap,xo=new WeakMap,um=new WeakMap,el=new WeakSet,Ob=async function(e,t,n){var o,l;const r=e.firstChild||e,i=r.id=`${B_}${t}`,a=await((o=d(this,um))==null?void 0:o.getAriaAttributes(i));if(a)for(const[u,h]of a)r.setAttribute(u,h);n?n.at(-1).container.after(e):(this.div.append(e),(l=d(this,cm))==null||l.moveElementInDOM(this.div,e,r,!1))},Fb=function(){var t;if(!d(this,hc))return;const e=this.div;for(const[n,r]of d(this,hc)){const i=e.querySelector(`[data-annotation-id="${n}"]`);if(!i)continue;r.className="annotationContent";const{firstChild:a}=i;a?a.nodeName==="CANVAS"?a.replaceWith(r):a.classList.contains("annotationContent")?a.after(r):a.before(r):i.append(r);const o=d(this,xo).get(n);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(n,i.id,r),o._hasNoCanvas=!1):o.canvas=r)}d(this,hc).clear()},jd);const Lg=/\r\n?|\n/g;var $r,Dn,dm,fc,Mn,Yt,UP,BP,HP,d0,Ca,h0,f0,VP,Ub,zP;const pt=class pt extends gt{constructor(t){super({...t,name:"freeTextEditor"});A(this,Yt);A(this,$r);A(this,Dn,"");A(this,dm,`${this.id}-editor`);A(this,fc,null);A(this,Mn);S(this,$r,t.color||pt._defaultColor||gt._defaultLineColor),S(this,Mn,t.fontSize||pt._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const t=pt.prototype,n=a=>a.isEmpty(),r=Jo.TRANSLATE_SMALL,i=Jo.TRANSLATE_BIG;return Ve(this,"_keyboardManager",new Ym([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}]]))}static initialize(t,n){gt.initialize(t,n);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case We.FREETEXT_SIZE:pt._defaultFontSize=n;break;case We.FREETEXT_COLOR:pt._defaultColor=n;break}}updateParams(t,n){switch(t){case We.FREETEXT_SIZE:k(this,Yt,UP).call(this,n);break;case We.FREETEXT_COLOR:k(this,Yt,BP).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[We.FREETEXT_SIZE,pt._defaultFontSize],[We.FREETEXT_COLOR,pt._defaultColor||gt._defaultLineColor]]}get propertiesToUpdate(){return[[We.FREETEXT_SIZE,d(this,Mn)],[We.FREETEXT_COLOR,d(this,$r)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-pt._internalPadding*t,-(pt._internalPadding+d(this,Mn))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),S(this,fc,new AbortController);const t=this._uiManager.combinedSignal(d(this,fc));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",d(this,dm)),this._isDraggable=!0,(t=d(this,fc))==null||t.abort(),S(this,fc,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=d(this,Dn),n=S(this,Dn,k(this,Yt,HP).call(this).trimEnd());if(t===n)return;const r=i=>{if(S(this,Dn,i),!i){this.remove();return}k(this,Yt,f0).call(this),this._uiManager.rebuild(this),k(this,Yt,d0).call(this)};this.addCommands({cmd:()=>{r(n)},undo:()=>{r(t)},mustExec:!1}),k(this,Yt,d0).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){pt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,n;(this._isCopy||this.annotationElementId)&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",d(this,dm)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${d(this,Mn)}px * var(--total-scale-factor))`,r.color=d(this,$r),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[h,f]=this.pageDimensions,[p,m]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=t+(o[0]-p)/h,y=n+this.height-(o[1]-m)/f;break;case 90:g=t+(o[0]-p)/h,y=n-(o[1]-m)/f,[l,u]=[u,-l];break;case 180:g=t-this.width+(o[0]-p)/h,y=n-(o[1]-m)/f,[l,u]=[-l,-u];break;case 270:g=t+(o[0]-p-this.height*f)/h,y=n+(o[1]-m-this.width*h)/f,[l,u]=[-u,l];break}this.setAt(g*i,y*a,l,u)}else this._moveAfterPaste(t,n);k(this,Yt,f0).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var g,y,b;const n=t.clipboardData||window.clipboardData,{types:r}=n;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const i=k(g=pt,Ca,Ub).call(g,n.getData("text")||"").replaceAll(Lg,`
`);if(!i)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:u}=o,h=[],f=[];if(l.nodeType===Node.TEXT_NODE){const v=l.parentElement;if(f.push(l.nodeValue.slice(u).replaceAll(Lg,"")),v!==this.editorDiv){let x=h;for(const w of this.editorDiv.childNodes){if(w===v){x=f;continue}x.push(k(y=pt,Ca,h0).call(y,w))}}h.push(l.nodeValue.slice(0,u).replaceAll(Lg,""))}else if(l===this.editorDiv){let v=h,x=0;for(const w of this.editorDiv.childNodes)x++===u&&(v=f),v.push(k(b=pt,Ca,h0).call(b,w))}S(this,Dn,`${h.join(`
`)}${i}${f.join(`
`)}`),k(this,Yt,f0).call(this);const p=new Range;let m=Math.sumPrecise(h.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const x=v.nodeValue.length;if(m<=x){p.setStart(v,m),p.setEnd(v,m);break}m-=x}a.removeAllRanges(),a.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,r){var o;let i=null;if(t instanceof IP){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:h,rotation:f,id:p,popupRef:m},textContent:g,textPosition:y,parent:{page:{pageNumber:b}}}=t;if(!g||g.length===0)return null;i=t={annotationType:Pe.FREETEXT,color:Array.from(u),fontSize:l,value:g.join(`
`),position:y,pageIndex:b-1,rect:h.slice(0),rotation:f,annotationElementId:p,id:p,deleted:!1,popupRef:m}}const a=await super.deserialize(t,n,r);return S(a,Mn,t.fontSize),S(a,$r,ve.makeHexColor(...t.color)),S(a,Dn,k(o=pt,Ca,Ub).call(o,t.value)),a._initialData=i,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=pt._internalPadding*this.parentScale,r=this.getRect(n,n),i=gt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:d(this,$r)),a={annotationType:Pe.FREETEXT,color:i,fontSize:d(this,Mn),value:k(this,Yt,VP).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(a.isCopy=!0,a):this.annotationElementId&&!k(this,Yt,zP).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(this.deleted)return n;const{style:r}=n;r.fontSize=`calc(${d(this,Mn)}px * var(--total-scale-factor))`,r.color=d(this,$r),n.replaceChildren();for(const a of d(this,Dn).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),n.append(o)}const i=pt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:d(this,Dn)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};$r=new WeakMap,Dn=new WeakMap,dm=new WeakMap,fc=new WeakMap,Mn=new WeakMap,Yt=new WeakSet,UP=function(t){const n=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-d(this,Mn))*this.parentScale),S(this,Mn,i),k(this,Yt,d0).call(this)},r=d(this,Mn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},BP=function(t){const n=i=>{S(this,$r,this.editorDiv.style.color=i)},r=d(this,$r);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},HP=function(){var r;const t=[];this.editorDiv.normalize();let n=null;for(const i of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(k(r=pt,Ca,h0).call(r,i)),n=i);return t.join(`
`)},d0=function(){const[t,n]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:i,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",i.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/n):(this.width=r.height/t,this.height=r.width/n),this.fixAndSetPosition()},Ca=new WeakSet,h0=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Lg,"")},f0=function(){if(this.editorDiv.replaceChildren(),!!d(this,Dn))for(const t of d(this,Dn).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},VP=function(){return d(this,Dn).replaceAll(""," ")},Ub=function(t){return t.replaceAll(" ","")},zP=function(t){const{value:n,fontSize:r,color:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==r||t.color.some((o,l)=>o!==i[l])||t.pageIndex!==a},A(pt,Ca),re(pt,"_freeTextDefaultContent",""),re(pt,"_internalPadding",0),re(pt,"_defaultColor",null),re(pt,"_defaultFontSize",10),re(pt,"_type","freetext"),re(pt,"_editorType",Pe.FREETEXT);let $b=pt;class ce{toSVGPath(){at("Abstract method `toSVGPath` must be implemented.")}get box(){at("Abstract getter `box` must be implemented.")}serialize(e,t){at("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*r,a[o+1]=n+e[o+1]*i;return a}static _rescaleAndSwap(e,t,n,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*r,a[o+1]=n+e[o]*i;return a}static _translate(e,t,n,r){r||(r=new Float32Array(e.length));for(let i=0,a=e.length;i<a;i+=2)r[i]=t+e[i],r[i+1]=n+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,i){switch(i){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,i,a){return[(e+5*n)/6,(t+5*r)/6,(5*n+i)/6,(5*r+a)/6,(n+i)/2,(r+a)/2]}}re(ce,"PRECISION",1e-4);var In,Ur,Pd,Rd,wi,Be,pc,mc,hm,fm,Ld,Dd,wo,pm,jy,Py,rs,nf,WP,GP,qP,KP,XP,YP;const Hi=class Hi{constructor({x:e,y:t},n,r,i,a,o=0){A(this,rs);A(this,In);A(this,Ur,[]);A(this,Pd);A(this,Rd);A(this,wi,[]);A(this,Be,new Float32Array(18));A(this,pc);A(this,mc);A(this,hm);A(this,fm);A(this,Ld);A(this,Dd);A(this,wo,[]);S(this,In,n),S(this,Dd,i*r),S(this,Rd,a),d(this,Be).set([NaN,NaN,NaN,NaN,e,t],6),S(this,Pd,o),S(this,fm,d(Hi,pm)*r),S(this,hm,d(Hi,Py)*r),S(this,Ld,r),d(this,wo).push(e,t)}isEmpty(){return isNaN(d(this,Be)[8])}add({x:e,y:t}){var P;S(this,pc,e),S(this,mc,t);const[n,r,i,a]=d(this,In);let[o,l,u,h]=d(this,Be).subarray(8,12);const f=e-u,p=t-h,m=Math.hypot(f,p);if(m<d(this,hm))return!1;const g=m-d(this,fm),y=g/m,b=y*f,v=y*p;let x=o,w=l;o=u,l=h,u+=b,h+=v,(P=d(this,wo))==null||P.push(e,t);const E=-v/g,T=b/g,C=E*d(this,Dd),N=T*d(this,Dd);return d(this,Be).set(d(this,Be).subarray(2,8),0),d(this,Be).set([u+C,h+N],4),d(this,Be).set(d(this,Be).subarray(14,18),12),d(this,Be).set([u-C,h-N],16),isNaN(d(this,Be)[6])?(d(this,wi).length===0&&(d(this,Be).set([o+C,l+N],2),d(this,wi).push(NaN,NaN,NaN,NaN,(o+C-n)/i,(l+N-r)/a),d(this,Be).set([o-C,l-N],14),d(this,Ur).push(NaN,NaN,NaN,NaN,(o-C-n)/i,(l-N-r)/a)),d(this,Be).set([x,w,o,l,u,h],6),!this.isEmpty()):(d(this,Be).set([x,w,o,l,u,h],6),Math.abs(Math.atan2(w-l,x-o)-Math.atan2(v,b))<Math.PI/2?([o,l,u,h]=d(this,Be).subarray(2,6),d(this,wi).push(NaN,NaN,NaN,NaN,((o+u)/2-n)/i,((l+h)/2-r)/a),[o,l,x,w]=d(this,Be).subarray(14,18),d(this,Ur).push(NaN,NaN,NaN,NaN,((x+o)/2-n)/i,((w+l)/2-r)/a),!0):([x,w,o,l,u,h]=d(this,Be).subarray(0,6),d(this,wi).push(((x+5*o)/6-n)/i,((w+5*l)/6-r)/a,((5*o+u)/6-n)/i,((5*l+h)/6-r)/a,((o+u)/2-n)/i,((l+h)/2-r)/a),[u,h,o,l,x,w]=d(this,Be).subarray(12,18),d(this,Ur).push(((x+5*o)/6-n)/i,((w+5*l)/6-r)/a,((5*o+u)/6-n)/i,((5*l+h)/6-r)/a,((o+u)/2-n)/i,((l+h)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=d(this,wi),t=d(this,Ur);if(isNaN(d(this,Be)[6])&&!this.isEmpty())return k(this,rs,WP).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);k(this,rs,qP).call(this,n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return k(this,rs,GP).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,r,i,a){return new JP(e,t,n,r,i,a)}getOutlines(){var f;const e=d(this,wi),t=d(this,Ur),n=d(this,Be),[r,i,a,o]=d(this,In),l=new Float32Array((((f=d(this,wo))==null?void 0:f.length)??0)+2);for(let p=0,m=l.length-2;p<m;p+=2)l[p]=(d(this,wo)[p]-r)/a,l[p+1]=(d(this,wo)[p+1]-i)/o;if(l[l.length-2]=(d(this,pc)-r)/a,l[l.length-1]=(d(this,mc)-i)/o,isNaN(n[6])&&!this.isEmpty())return k(this,rs,KP).call(this,l);const u=new Float32Array(d(this,wi).length+24+d(this,Ur).length);let h=e.length;for(let p=0;p<h;p+=2){if(isNaN(e[p])){u[p]=u[p+1]=NaN;continue}u[p]=e[p],u[p+1]=e[p+1]}h=k(this,rs,YP).call(this,u,h);for(let p=t.length-6;p>=6;p-=6)for(let m=0;m<6;m+=2){if(isNaN(t[p+m])){u[h]=u[h+1]=NaN,h+=2;continue}u[h]=t[p+m],u[h+1]=t[p+m+1],h+=2}return k(this,rs,XP).call(this,u,h),this.newFreeDrawOutline(u,l,d(this,In),d(this,Ld),d(this,Pd),d(this,Rd))}};In=new WeakMap,Ur=new WeakMap,Pd=new WeakMap,Rd=new WeakMap,wi=new WeakMap,Be=new WeakMap,pc=new WeakMap,mc=new WeakMap,hm=new WeakMap,fm=new WeakMap,Ld=new WeakMap,Dd=new WeakMap,wo=new WeakMap,pm=new WeakMap,jy=new WeakMap,Py=new WeakMap,rs=new WeakSet,nf=function(){const e=d(this,Be).subarray(4,6),t=d(this,Be).subarray(16,18),[n,r,i,a]=d(this,In);return[(d(this,pc)+(e[0]-t[0])/2-n)/i,(d(this,mc)+(e[1]-t[1])/2-r)/a,(d(this,pc)+(t[0]-e[0])/2-n)/i,(d(this,mc)+(t[1]-e[1])/2-r)/a]},WP=function(){const[e,t,n,r]=d(this,In),[i,a,o,l]=k(this,rs,nf).call(this);return`M${(d(this,Be)[2]-e)/n} ${(d(this,Be)[3]-t)/r} L${(d(this,Be)[4]-e)/n} ${(d(this,Be)[5]-t)/r} L${i} ${a} L${o} ${l} L${(d(this,Be)[16]-e)/n} ${(d(this,Be)[17]-t)/r} L${(d(this,Be)[14]-e)/n} ${(d(this,Be)[15]-t)/r} Z`},GP=function(e){const t=d(this,Ur);e.push(`L${t[4]} ${t[5]} Z`)},qP=function(e){const[t,n,r,i]=d(this,In),a=d(this,Be).subarray(4,6),o=d(this,Be).subarray(16,18),[l,u,h,f]=k(this,rs,nf).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-n)/i} L${l} ${u} L${h} ${f} L${(o[0]-t)/r} ${(o[1]-n)/i}`)},KP=function(e){const t=d(this,Be),[n,r,i,a]=d(this,In),[o,l,u,h]=k(this,rs,nf).call(this),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-n)/i,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-n)/i,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,(t[16]-n)/i,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-n)/i,(t[15]-r)/a],0),this.newFreeDrawOutline(f,e,d(this,In),d(this,Ld),d(this,Pd),d(this,Rd))},XP=function(e,t){const n=d(this,Ur);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},YP=function(e,t){const n=d(this,Be).subarray(4,6),r=d(this,Be).subarray(16,18),[i,a,o,l]=d(this,In),[u,h,f,p]=k(this,rs,nf).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-i)/o,(n[1]-a)/l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(r[0]-i)/o,(r[1]-a)/l],t),t+=24},A(Hi,pm,8),A(Hi,jy,2),A(Hi,Py,d(Hi,pm)+d(Hi,jy));let dy=Hi;var Md,gc,da,mm,On,gm,$t,Ry,QP;class JP extends ce{constructor(t,n,r,i,a,o){super();A(this,Ry);A(this,Md);A(this,gc,new Float32Array(4));A(this,da);A(this,mm);A(this,On);A(this,gm);A(this,$t);S(this,$t,t),S(this,On,n),S(this,Md,r),S(this,gm,i),S(this,da,a),S(this,mm,o),this.lastPoint=[NaN,NaN],k(this,Ry,QP).call(this,o);const[l,u,h,f]=d(this,gc);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/h,t[p+1]=(t[p+1]-u)/f;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/h,n[p+1]=(n[p+1]-u)/f}toSVGPath(){const t=[`M${d(this,$t)[4]} ${d(this,$t)[5]}`];for(let n=6,r=d(this,$t).length;n<r;n+=6){if(isNaN(d(this,$t)[n])){t.push(`L${d(this,$t)[n+4]} ${d(this,$t)[n+5]}`);continue}t.push(`C${d(this,$t)[n]} ${d(this,$t)[n+1]} ${d(this,$t)[n+2]} ${d(this,$t)[n+3]} ${d(this,$t)[n+4]} ${d(this,$t)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,r,i],a){const o=r-t,l=i-n;let u,h;switch(a){case 0:u=ce._rescale(d(this,$t),t,i,o,-l),h=ce._rescale(d(this,On),t,i,o,-l);break;case 90:u=ce._rescaleAndSwap(d(this,$t),t,n,o,l),h=ce._rescaleAndSwap(d(this,On),t,n,o,l);break;case 180:u=ce._rescale(d(this,$t),r,n,-o,l),h=ce._rescale(d(this,On),r,n,-o,l);break;case 270:u=ce._rescaleAndSwap(d(this,$t),r,i,-o,-l),h=ce._rescaleAndSwap(d(this,On),r,i,-o,-l);break}return{outline:Array.from(u),points:[Array.from(h)]}}get box(){return d(this,gc)}newOutliner(t,n,r,i,a,o=0){return new dy(t,n,r,i,a,o)}getNewOutline(t,n){const[r,i,a,o]=d(this,gc),[l,u,h,f]=d(this,Md),p=a*h,m=o*f,g=r*h+l,y=i*f+u,b=this.newOutliner({x:d(this,On)[0]*p+g,y:d(this,On)[1]*m+y},d(this,Md),d(this,gm),t,d(this,mm),n??d(this,da));for(let v=2;v<d(this,On).length;v+=2)b.add({x:d(this,On)[v]*p+g,y:d(this,On)[v+1]*m+y});return b.getOutlines()}}Md=new WeakMap,gc=new WeakMap,da=new WeakMap,mm=new WeakMap,On=new WeakMap,gm=new WeakMap,$t=new WeakMap,Ry=new WeakSet,QP=function(t){const n=d(this,$t);let r=n[4],i=n[5];const a=[r,i,r,i];let o=r,l=i;const u=t?Math.max:Math.min;for(let f=6,p=n.length;f<p;f+=6){const m=n[f+4],g=n[f+5];if(isNaN(n[f]))ve.pointBoundingBox(m,g,a),l<g?(o=m,l=g):l===g&&(o=u(o,m));else{const y=[1/0,1/0,-1/0,-1/0];ve.bezierBoundingBox(r,i,...n.slice(f,f+6),y),ve.rectBoundingBox(...y,a),l<y[3]?(o=y[2],l=y[3]):l===y[3]&&(o=u(o,y[2]))}r=m,i=g}const h=d(this,gc);h[0]=a[0]-d(this,da),h[1]=a[1]-d(this,da),h[2]=a[2]-a[0]+2*d(this,da),h[3]=a[3]-a[1]+2*d(this,da),this.lastPoint=[o,l]};var ym,vm,bo,Br,ln,ZP,p0,eR,tR,Hb;class Bb{constructor(e,t=0,n=0,r=!0){A(this,ln);A(this,ym);A(this,vm);A(this,bo,[]);A(this,Br,[]);const i=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:m,y:g,width:y,height:b}of e){const v=Math.floor((m-t)/a)*a,x=Math.ceil((m+y+t)/a)*a,w=Math.floor((g-t)/a)*a,E=Math.ceil((g+b+t)/a)*a,T=[v,w,E,!0],C=[x,w,E,!1];d(this,bo).push(T,C),ve.rectBoundingBox(v,w,x,E,i)}const o=i[2]-i[0]+2*n,l=i[3]-i[1]+2*n,u=i[0]-n,h=i[1]-n,f=d(this,bo).at(r?-1:-2),p=[f[0],f[2]];for(const m of d(this,bo)){const[g,y,b]=m;m[0]=(g-u)/o,m[1]=(y-h)/l,m[2]=(b-h)/l}S(this,ym,new Float32Array([u,h,o,l])),S(this,vm,p)}getOutlines(){d(this,bo).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of d(this,bo))t[3]?(e.push(...k(this,ln,Hb).call(this,t)),k(this,ln,eR).call(this,t)):(k(this,ln,tR).call(this,t),e.push(...k(this,ln,Hb).call(this,t)));return k(this,ln,ZP).call(this,e)}}ym=new WeakMap,vm=new WeakMap,bo=new WeakMap,Br=new WeakMap,ln=new WeakSet,ZP=function(e){const t=[],n=new Set;for(const a of e){const[o,l,u]=a;t.push([o,l,a],[o,u,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],u=t[a+1][2];l.push(u),u.push(l),n.add(l),n.add(u)}const r=[];let i;for(;n.size>0;){const a=n.values().next().value;let[o,l,u,h,f]=a;n.delete(a);let p=o,m=l;for(i=[o,u],r.push(i);;){let g;if(n.has(h))g=h;else if(n.has(f))g=f;else break;n.delete(g),[o,l,u,h,f]=g,p!==o&&(i.push(p,m,o,m===l?l:u),p=o),m=m===l?u:l}i.push(p,m)}return new IB(r,d(this,ym),d(this,vm))},p0=function(e){const t=d(this,Br);let n=0,r=t.length-1;for(;n<=r;){const i=n+r>>1,a=t[i][0];if(a===e)return i;a<e?n=i+1:r=i-1}return r+1},eR=function([,e,t]){const n=k(this,ln,p0).call(this,e);d(this,Br).splice(n,0,[e,t])},tR=function([,e,t]){const n=k(this,ln,p0).call(this,e);for(let r=n;r<d(this,Br).length;r++){const[i,a]=d(this,Br)[r];if(i!==e)break;if(i===e&&a===t){d(this,Br).splice(r,1);return}}for(let r=n-1;r>=0;r--){const[i,a]=d(this,Br)[r];if(i!==e)break;if(i===e&&a===t){d(this,Br).splice(r,1);return}}},Hb=function(e){const[t,n,r]=e,i=[[t,n,r]],a=k(this,ln,p0).call(this,r);for(let o=0;o<a;o++){const[l,u]=d(this,Br)[o];for(let h=0,f=i.length;h<f;h++){const[,p,m]=i[h];if(!(u<=p||m<=l)){if(p>=l){if(m>u)i[h][1]=u;else{if(f===1)return[];i.splice(h,1),h--,f--}continue}i[h][2]=l,m>u&&i.push([t,u,m])}}}return i};var xm,Id;class IB extends ce{constructor(t,n,r){super();A(this,xm);A(this,Id);S(this,Id,t),S(this,xm,n),this.lastPoint=r}toSVGPath(){const t=[];for(const n of d(this,Id)){let[r,i]=n;t.push(`M${r} ${i}`);for(let a=2;a<n.length;a+=2){const o=n[a],l=n[a+1];o===r?(t.push(`V${l}`),i=l):l===i&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,n,r,i],a){const o=[],l=r-t,u=i-n;for(const h of d(this,Id)){const f=new Array(h.length);for(let p=0;p<h.length;p+=2)f[p]=t+h[p]*l,f[p+1]=i-h[p+1]*u;o.push(f)}return o}get box(){return d(this,xm)}get classNamesForOutlining(){return["highlightOutline"]}}xm=new WeakMap,Id=new WeakMap;class Vb extends dy{newFreeDrawOutline(e,t,n,r,i,a){return new OB(e,t,n,r,i,a)}}class OB extends JP{newOutliner(e,t,n,r,i,a=0){return new Vb(e,t,n,r,i,a)}}var Fn,yc,Od,ts,wm,Fd,ha,bm,So,Hr,$d,Sm,it,zb,Wb,Gb,vl,sR,Va;const gn=class gn{constructor({editor:e=null,uiManager:t=null}){A(this,it);A(this,Fn,null);A(this,yc,null);A(this,Od);A(this,ts,null);A(this,wm,!1);A(this,Fd,!1);A(this,ha,null);A(this,bm);A(this,So,null);A(this,Hr,null);A(this,$d);var n,r;e?(S(this,Fd,!1),S(this,$d,We.HIGHLIGHT_COLOR),S(this,ha,e)):(S(this,Fd,!0),S(this,$d,We.HIGHLIGHT_DEFAULT_COLOR)),S(this,Hr,(e==null?void 0:e._uiManager)||t),S(this,bm,d(this,Hr)._eventBus),S(this,Od,((n=e==null?void 0:e.color)==null?void 0:n.toUpperCase())||((r=d(this,Hr))==null?void 0:r.highlightColors.values().next().value)||"#FFFF98"),d(gn,Sm)||S(gn,Sm,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Ve(this,"_keyboardManager",new Ym([[["Escape","mac+Escape"],gn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],gn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],gn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],gn.prototype._moveToPrevious],[["Home","mac+Home"],gn.prototype._moveToBeginning],[["End","mac+End"],gn.prototype._moveToEnd]]))}renderButton(){const e=S(this,Fn,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",d(this,ha)&&(e.ariaControls=`${d(this,ha).id}_colorpicker_dropdown`);const t=d(this,Hr)._signal;e.addEventListener("click",k(this,it,vl).bind(this),{signal:t}),e.addEventListener("keydown",k(this,it,Gb).bind(this),{signal:t});const n=S(this,yc,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=d(this,Od),e.append(n),e}renderMainDropdown(){const e=S(this,ts,k(this,it,zb).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===d(this,Fn)){k(this,it,vl).call(this,e);return}const t=e.target.getAttribute("data-color");t&&k(this,it,Wb).call(this,t,e)}_moveToNext(e){var t,n;if(!d(this,it,Va)){k(this,it,vl).call(this,e);return}if(e.target===d(this,Fn)){(t=d(this,ts).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=d(this,ts))==null?void 0:t.firstChild)||e.target===d(this,Fn)){d(this,it,Va)&&this._hideDropdownFromKeyboard();return}d(this,it,Va)||k(this,it,vl).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!d(this,it,Va)){k(this,it,vl).call(this,e);return}(t=d(this,ts).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!d(this,it,Va)){k(this,it,vl).call(this,e);return}(t=d(this,ts).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=d(this,ts))==null||e.classList.add("hidden"),d(this,Fn).ariaExpanded="false",(t=d(this,So))==null||t.abort(),S(this,So,null)}_hideDropdownFromKeyboard(){var e;if(!d(this,Fd)){if(!d(this,it,Va)){(e=d(this,ha))==null||e.unselect();return}this.hideDropdown(),d(this,Fn).focus({preventScroll:!0,focusVisible:d(this,wm)})}}updateColor(e){if(d(this,yc)&&(d(this,yc).style.backgroundColor=e),!d(this,ts))return;const t=d(this,Hr).highlightColors.values();for(const n of d(this,ts).children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=d(this,Fn))==null||e.remove(),S(this,Fn,null),S(this,yc,null),(t=d(this,ts))==null||t.remove(),S(this,ts,null)}};Fn=new WeakMap,yc=new WeakMap,Od=new WeakMap,ts=new WeakMap,wm=new WeakMap,Fd=new WeakMap,ha=new WeakMap,bm=new WeakMap,So=new WeakMap,Hr=new WeakMap,$d=new WeakMap,Sm=new WeakMap,it=new WeakSet,zb=function(){const e=document.createElement("div"),t=d(this,Hr)._signal;e.addEventListener("contextmenu",Er,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),d(this,ha)&&(e.id=`${d(this,ha).id}_colorpicker_dropdown`);for(const[n,r]of d(this,Hr).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",r),i.title=n,i.setAttribute("data-l10n-id",d(gn,Sm)[n]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=r,i.ariaSelected=r===d(this,Od),i.addEventListener("click",k(this,it,Wb).bind(this,r),{signal:t}),e.append(i)}return e.addEventListener("keydown",k(this,it,Gb).bind(this),{signal:t}),e},Wb=function(e,t){t.stopPropagation(),d(this,bm).dispatch("switchannotationeditorparams",{source:this,type:d(this,$d),value:e})},Gb=function(e){gn._keyboardManager.exec(this,e)},vl=function(e){if(d(this,it,Va)){this.hideDropdown();return}if(S(this,wm,e.detail===0),d(this,So)||(S(this,So,new AbortController),window.addEventListener("pointerdown",k(this,it,sR).bind(this),{signal:d(this,Hr).combinedSignal(d(this,So))})),d(this,Fn).ariaExpanded="true",d(this,ts)){d(this,ts).classList.remove("hidden");return}const t=S(this,ts,k(this,it,zb).call(this));d(this,Fn).append(t)},sR=function(e){var t;(t=d(this,ts))!=null&&t.contains(e.target)||this.hideDropdown()},Va=function(){return d(this,ts)&&!d(this,ts).classList.contains("hidden")},A(gn,Sm,null);let sp=gn;var Ud,_m,fa,vc,Em,xn,Am,km,xc,hr,$n,_s,Bd,pa,Os,Hd,fr,Tm,Oe,qb,m0,nR,rR,iR,Kb,xl,yr,yu,aR,g0,rf,oR,lR,cR,uR,dR;const Qe=class Qe extends gt{constructor(t){super({...t,name:"highlightEditor"});A(this,Oe);A(this,Ud,null);A(this,_m,0);A(this,fa);A(this,vc,null);A(this,Em,null);A(this,xn,null);A(this,Am,null);A(this,km,0);A(this,xc,null);A(this,hr,null);A(this,$n,null);A(this,_s,!1);A(this,Bd,null);A(this,pa);A(this,Os,null);A(this,Hd,"");A(this,fr);A(this,Tm,"");this.color=t.color||Qe._defaultColor,S(this,fr,t.thickness||Qe._defaultThickness),S(this,pa,t.opacity||Qe._defaultOpacity),S(this,fa,t.boxes||null),S(this,Tm,t.methodOfCreation||""),S(this,Hd,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(S(this,_s,!0),k(this,Oe,m0).call(this,t),k(this,Oe,xl).call(this)):d(this,fa)&&(S(this,Ud,t.anchorNode),S(this,_m,t.anchorOffset),S(this,Am,t.focusNode),S(this,km,t.focusOffset),k(this,Oe,qb).call(this),k(this,Oe,xl).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=Qe.prototype;return Ve(this,"_keyboardManager",new Ym([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:d(this,_s)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:d(this,fr),methodOfCreation:d(this,Tm)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var r;gt.initialize(t,n),Qe._defaultColor||(Qe._defaultColor=((r=n.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case We.HIGHLIGHT_DEFAULT_COLOR:Qe._defaultColor=n;break;case We.HIGHLIGHT_THICKNESS:Qe._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return d(this,Bd)}updateParams(t,n){switch(t){case We.HIGHLIGHT_COLOR:k(this,Oe,nR).call(this,n);break;case We.HIGHLIGHT_THICKNESS:k(this,Oe,rR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[We.HIGHLIGHT_DEFAULT_COLOR,Qe._defaultColor],[We.HIGHLIGHT_THICKNESS,Qe._defaultThickness]]}get propertiesToUpdate(){return[[We.HIGHLIGHT_COLOR,this.color||Qe._defaultColor],[We.HIGHLIGHT_THICKNESS,d(this,fr)||Qe._defaultThickness],[We.HIGHLIGHT_FREE,d(this,_s)]]}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",S(this,Em,new sp({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(k(this,Oe,rf).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,k(this,Oe,rf).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){k(this,Oe,Kb).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(k(this,Oe,xl).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?k(this,Oe,Kb).call(this):t&&(k(this,Oe,xl).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var i,a,o;const{drawLayer:n}=this.parent;let r;d(this,_s)?(t=(t-this.rotation+360)%360,r=k(i=Qe,yr,yu).call(i,d(this,hr).box,t)):r=k(a=Qe,yr,yu).call(a,[this.x,this.y,this.width,this.height],t),n.updateProperties(d(this,$n),{bbox:r,root:{"data-main-rotation":t}}),n.updateProperties(d(this,Os),{bbox:k(o=Qe,yr,yu).call(o,d(this,xn).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();d(this,Hd)&&(t.setAttribute("aria-label",d(this,Hd)),t.setAttribute("role","mark")),d(this,_s)?t.classList.add("free"):this.div.addEventListener("keydown",k(this,Oe,aR).bind(this),{signal:this._uiManager._signal});const n=S(this,xc,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=d(this,vc);const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),jj(this,d(this,xc),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,Os),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,Os),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:k(this,Oe,g0).call(this,!0);break;case 1:case 3:k(this,Oe,g0).call(this,!1);break}}select(){var t;super.select(),d(this,Os)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,Os),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),d(this,Os)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,Os),{rootClass:{selected:!1}}),d(this,_s)||k(this,Oe,g0).call(this,!1))}get _mustFixPosition(){return!d(this,_s)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(d(this,$n),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(d(this,Os),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:r,x:i,y:a}){const{x:o,y:l,width:u,height:h}=r.getBoundingClientRect(),f=new AbortController,p=t.combinedSignal(f),m=g=>{f.abort(),k(this,yr,uR).call(this,t,g)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",Ut,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Er,{signal:p}),r.addEventListener("pointermove",k(this,yr,cR).bind(this,t),{signal:p}),this._freeHighlight=new Vb({x:i,y:a},[o,l,u,h],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,r){var y,b,v,x;let i=null;if(t instanceof FP){const{data:{quadPoints:w,rect:E,rotation:T,id:C,color:N,opacity:j,popupRef:P},parent:{page:{pageNumber:M}}}=t;i=t={annotationType:Pe.HIGHLIGHT,color:Array.from(N),opacity:j,quadPoints:w,boxes:null,pageIndex:M-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,popupRef:P}}else if(t instanceof X_){const{data:{inkLists:w,rect:E,rotation:T,id:C,color:N,borderStyle:{rawWidth:j},popupRef:P},parent:{page:{pageNumber:M}}}=t;i=t={annotationType:Pe.HIGHLIGHT,color:Array.from(N),thickness:j,inkLists:w,boxes:null,pageIndex:M-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,popupRef:P}}const{color:a,quadPoints:o,inkLists:l,opacity:u}=t,h=await super.deserialize(t,n,r);h.color=ve.makeHexColor(...a),S(h,pa,u||1),l&&S(h,fr,t.thickness),h._initialData=i;const[f,p]=h.pageDimensions,[m,g]=h.pageTranslation;if(o){const w=S(h,fa,[]);for(let E=0;E<o.length;E+=8)w.push({x:(o[E]-m)/f,y:1-(o[E+1]-g)/p,width:(o[E+2]-o[E])/f,height:(o[E+1]-o[E+5])/p});k(y=h,Oe,qb).call(y),k(b=h,Oe,xl).call(b),h.rotate(h.rotation)}else if(l){S(h,_s,!0);const w=l[0],E={x:w[0]-m,y:p-(w[1]-g)},T=new Vb(E,[0,0,f,p],1,d(h,fr)/2,!0,.001);for(let j=0,P=w.length;j<P;j+=2)E.x=w[j]-m,E.y=p-(w[j+1]-g),T.add(E);const{id:C,clipPathId:N}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:T.toSVGPath()}},!0,!0);k(v=h,Oe,m0).call(v,{highlightOutlines:T.getOutlines(),highlightId:C,clipPathId:N}),k(x=h,Oe,xl).call(x),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=this.getRect(0,0),r=gt._colorManager.convert(this.color),i={annotationType:Pe.HIGHLIGHT,color:r,opacity:d(this,pa),thickness:d(this,fr),quadPoints:k(this,Oe,oR).call(this),outlines:k(this,Oe,lR).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:k(this,Oe,rf).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!k(this,Oe,dR).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ud=new WeakMap,_m=new WeakMap,fa=new WeakMap,vc=new WeakMap,Em=new WeakMap,xn=new WeakMap,Am=new WeakMap,km=new WeakMap,xc=new WeakMap,hr=new WeakMap,$n=new WeakMap,_s=new WeakMap,Bd=new WeakMap,pa=new WeakMap,Os=new WeakMap,Hd=new WeakMap,fr=new WeakMap,Tm=new WeakMap,Oe=new WeakSet,qb=function(){const t=new Bb(d(this,fa),.001);S(this,hr,t.getOutlines()),[this.x,this.y,this.width,this.height]=d(this,hr).box;const n=new Bb(d(this,fa),.0025,.001,this._uiManager.direction==="ltr");S(this,xn,n.getOutlines());const{lastPoint:r}=d(this,xn);S(this,Bd,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},m0=function({highlightOutlines:t,highlightId:n,clipPathId:r}){var f,p;if(S(this,hr,t),S(this,xn,t.getNewOutline(d(this,fr)/2+1.5,.0025)),n>=0)S(this,$n,n),S(this,vc,r),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),S(this,Os,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:d(this,xn).box,path:{d:d(this,xn).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(d(this,$n),{bbox:k(f=Qe,yr,yu).call(f,d(this,hr).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(d(this,Os),{bbox:k(p=Qe,yr,yu).call(p,d(this,xn).box,m),path:{d:d(this,xn).toSVGPath()}})}const[a,o,l,u]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=u;break;case 90:{const[m,g]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*g/m,this.height=u*m/g;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=u;break;case 270:{const[m,g]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*g/m,this.height=u*m/g;break}}const{lastPoint:h}=d(this,xn);S(this,Bd,[(h[0]-a)/l,(h[1]-o)/u])},nR=function(t){const n=(a,o)=>{var l,u;this.color=a,S(this,pa,o),(l=this.parent)==null||l.drawLayer.updateProperties(d(this,$n),{root:{fill:a,"fill-opacity":o}}),(u=d(this,Em))==null||u.updateColor(a)},r=this.color,i=d(this,pa);this.addCommands({cmd:n.bind(this,t,Qe._defaultOpacity),undo:n.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},rR=function(t){const n=d(this,fr),r=i=>{S(this,fr,i),k(this,Oe,iR).call(this,i)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},iR=function(t){if(!d(this,_s))return;k(this,Oe,m0).call(this,{highlightOutlines:d(this,hr).getNewOutline(t/2)}),this.fixAndSetPosition();const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r)},Kb=function(){d(this,$n)===null||!this.parent||(this.parent.drawLayer.remove(d(this,$n)),S(this,$n,null),this.parent.drawLayer.remove(d(this,Os)),S(this,Os,null))},xl=function(t=this.parent){d(this,$n)===null&&({id:Ks(this,$n)._,clipPathId:Ks(this,vc)._}=t.drawLayer.draw({bbox:d(this,hr).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":d(this,pa)},rootClass:{highlight:!0,free:d(this,_s)},path:{d:d(this,hr).toSVGPath()}},!1,!0),S(this,Os,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:d(this,_s)},bbox:d(this,xn).box,path:{d:d(this,xn).toSVGPath()}},d(this,_s))),d(this,xc)&&(d(this,xc).style.clipPath=d(this,vc)))},yr=new WeakSet,yu=function([t,n,r,i],a){switch(a){case 90:return[1-n-i,t,i,r];case 180:return[1-t-r,1-n-i,r,i];case 270:return[n,1-t-r,i,r]}return[t,n,r,i]},aR=function(t){Qe._keyboardManager.exec(this,t)},g0=function(t){if(!d(this,Ud))return;const n=window.getSelection();t?n.setPosition(d(this,Ud),d(this,_m)):n.setPosition(d(this,Am),d(this,km))},rf=function(){return d(this,_s)?this.rotation:0},oR=function(){if(d(this,_s))return null;const[t,n]=this.pageDimensions,[r,i]=this.pageTranslation,a=d(this,fa),o=new Float32Array(a.length*8);let l=0;for(const{x:u,y:h,width:f,height:p}of a){const m=u*t+r,g=(1-h)*n+i;o[l]=o[l+4]=m,o[l+1]=o[l+3]=g,o[l+2]=o[l+6]=m+f*t,o[l+5]=o[l+7]=g-p*n,l+=8}return o},lR=function(t){return d(this,hr).serialize(t,k(this,Oe,rf).call(this))},cR=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},uR=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},dR=function(t){const{color:n}=this._initialData;return t.color.some((r,i)=>r!==n[i])},A(Qe,yr),re(Qe,"_defaultColor",null),re(Qe,"_defaultOpacity",1),re(Qe,"_defaultThickness",12),re(Qe,"_type","highlight"),re(Qe,"_editorType",Pe.HIGHLIGHT),re(Qe,"_freeHighlightId",-1),re(Qe,"_freeHighlight",null),re(Qe,"_freeHighlightClipId","");let hy=Qe;var wc;class hR{constructor(){A(this,wc,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){d(this,wc)[e]=t}toSVGProperties(){const e=d(this,wc);return S(this,wc,Object.create(null)),{root:e}}reset(){S(this,wc,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){at("Not implemented")}}wc=new WeakMap;var Un,Vd,cs,bc,Sc,_o,Eo,Ao,_c,Xe,Xb,Yb,Jb,af,fR,y0,of,vu;const fe=class fe extends gt{constructor(t){super(t);A(this,Xe);A(this,Un,null);A(this,Vd);re(this,"_drawId",null);S(this,Vd,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(k(this,Xe,Xb).call(this,t),k(this,Xe,af).call(this))}static _mergeSVGProperties(t,n){const r=new Set(Object.keys(t));for(const[i,a]of Object.entries(n))r.has(i)?Object.assign(t[i],a):t[i]=a;return t}static getDefaultDrawingOptions(t){at("Not implemented")}static get typesMap(){at("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,n),this._currentParent&&(d(fe,cs).updateProperty(r,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[r,i]of this.typesMap)t.push([r,n[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[r,i]of this.constructor.typesMap)t.push([r,n[i]]);return t}_updateProperty(t,n,r){const i=this._drawingOptions,a=i[n],o=l=>{var h;i.updateProperty(n,l);const u=d(this,Un).updateProperty(n,l);u&&k(this,Xe,of).call(this,u),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(d(this,Un).getPathResizingSVGProperties(k(this,Xe,y0).call(this)),{bbox:k(this,Xe,vu).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(d(this,Un).getPathResizedSVGProperties(k(this,Xe,y0).call(this)),{bbox:k(this,Xe,vu).call(this)}))}_onTranslating(t,n){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:k(this,Xe,vu).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(d(this,Un).getPathTranslatedSVGProperties(k(this,Xe,y0).call(this),this.parentDimensions),{bbox:k(this,Xe,vu).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,d(this,Vd)&&(S(this,Vd,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){k(this,Xe,Jb).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(k(this,Xe,af).call(this),k(this,Xe,of).call(this,d(this,Un).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),k(this,Xe,Jb).call(this)):t&&(this._uiManager.addShouldRescale(this),k(this,Xe,af).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties({bbox:k(this,Xe,vu).call(this)},d(this,Un).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&k(this,Xe,of).call(this,d(this,Un).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,n;this._isCopy&&(t=this.x,n=this.y);const r=super.render();r.classList.add("draw");const i=document.createElement("div");r.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,n),r}static createDrawerInstance(t,n,r,i,a){at("Not implemented")}static startDrawing(t,n,r,i){var b;const{target:a,offsetX:o,offsetY:l,pointerId:u,pointerType:h}=i;if(d(fe,Eo)&&d(fe,Eo)!==h)return;const{viewport:{rotation:f}}=t,{width:p,height:m}=a.getBoundingClientRect(),g=S(fe,bc,new AbortController),y=t.combinedSignal(g);if(d(fe,_o)||S(fe,_o,u),d(fe,Eo)??S(fe,Eo,h),window.addEventListener("pointerup",v=>{var x;d(fe,_o)===v.pointerId?this._endDraw(v):(x=d(fe,Ao))==null||x.delete(v.pointerId)},{signal:y}),window.addEventListener("pointercancel",v=>{var x;d(fe,_o)===v.pointerId?this._currentParent.endDrawingSession():(x=d(fe,Ao))==null||x.delete(v.pointerId)},{signal:y}),window.addEventListener("pointerdown",v=>{d(fe,Eo)===v.pointerType&&((d(fe,Ao)||S(fe,Ao,new Set)).add(v.pointerId),d(fe,cs).isCancellable()&&(d(fe,cs).removeLastElement(),d(fe,cs).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Er,{signal:y}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),a.addEventListener("touchmove",v=>{v.timeStamp===d(fe,_c)&&Ut(v)},{signal:y}),t.toggleDrawing(),(b=n._editorUndoBar)==null||b.hide(),d(fe,cs)){t.drawLayer.updateProperties(this._currentDrawId,d(fe,cs).startNew(o,l,p,m,f));return}n.updateUIForDefaultProperties(this),S(fe,cs,this.createDrawerInstance(o,l,p,m,f)),S(fe,Sc,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(d(fe,Sc).toSVGProperties(),d(fe,cs).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(S(fe,_c,-1),!d(fe,cs))return;const{offsetX:n,offsetY:r,pointerId:i}=t;if(d(fe,_o)===i){if(((a=d(fe,Ao))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,d(fe,cs).add(n,r)),S(fe,_c,t.timeStamp),Ut(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,S(fe,cs,null),S(fe,Sc,null),S(fe,Eo,null),S(fe,_c,NaN)),d(fe,bc)&&(d(fe,bc).abort(),S(fe,bc,null),S(fe,_o,NaN),S(fe,Ao,null))}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,d(fe,cs).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=d(fe,cs),i=this._currentDrawId,a=r.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(i,r.setLastElement(a))},undo:()=>{n.drawLayer.updateProperties(i,r.removeLastElement())},mustExec:!1,type:We.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(We.DRAW_STEP),!d(fe,cs).isEmpty()){const{pageDimensions:[r,i],scale:a}=n,o=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:d(fe,cs).getOutlines(r*a,i*a,a,this._INNER_MARGIN),drawingOptions:d(fe,Sc),mustBeCommitted:!t});return this._cleanup(!0),o}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,r,i,a,o){at("Not implemented")}static async deserialize(t,n,r){var f,p;const{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}=n.viewport,u=this.deserializeDraw(o,l,i,a,this._INNER_MARGIN,t),h=await super.deserialize(t,n,r);return h.createDrawingOptions(t),k(f=h,Xe,Xb).call(f,{drawOutlines:u}),k(p=h,Xe,af).call(p),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[n,r]=this.pageTranslation,[i,a]=this.pageDimensions;return d(this,Un).serialize([n,r,i,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Un=new WeakMap,Vd=new WeakMap,cs=new WeakMap,bc=new WeakMap,Sc=new WeakMap,_o=new WeakMap,Eo=new WeakMap,Ao=new WeakMap,_c=new WeakMap,Xe=new WeakSet,Xb=function({drawOutlines:t,drawId:n,drawingOptions:r}){S(this,Un,t),this._drawingOptions||(this._drawingOptions=r),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=k(this,Xe,Yb).call(this,t,this.parent),k(this,Xe,of).call(this,t.box)},Yb=function(t,n){const{id:r}=n.drawLayer.draw(fe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},Jb=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},af=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=k(this,Xe,Yb).call(this,d(this,Un),t)}},fR=function([t,n,r,i]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[n,1-t,r*(o/a),i*(a/o)];case 180:return[1-t,1-n,r,i];case 270:return[1-n,t,r*(o/a),i*(a/o)];default:return[t,n,r,i]}},y0=function(){const{x:t,y:n,width:r,height:i,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-n,t,r*(a/o),i*(o/a)];case 180:return[1-t,1-n,r,i];case 270:return[n,1-t,r*(a/o),i*(o/a)];default:return[t,n,r,i]}},of=function(t){if([this.x,this.y,this.width,this.height]=k(this,Xe,fR).call(this,t),this.div){this.fixAndSetPosition();const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r)}this._onResized()},vu=function(){const{x:t,y:n,width:r,height:i,rotation:a,parentRotation:o,parentDimensions:[l,u]}=this;switch((a*4+o)/90){case 1:return[1-n-i,t,i,r];case 2:return[1-t-r,1-n-i,r,i];case 3:return[n,1-t-r,i,r];case 4:return[t,n-r*(l/u),i*(u/l),r*(l/u)];case 5:return[1-n,t,r*(l/u),i*(u/l)];case 6:return[1-t-i*(u/l),1-n,i*(u/l),r*(l/u)];case 7:return[n-r*(l/u),1-t-i*(u/l),r*(l/u),i*(u/l)];case 8:return[t-r,n-i,r,i];case 9:return[1-n,t-r,i,r];case 10:return[1-t,1-n,r,i];case 11:return[n-i,1-t,i,r];case 12:return[t-i*(u/l),n,i*(u/l),r*(l/u)];case 13:return[1-n-r*(l/u),t-i*(u/l),r*(l/u),i*(u/l)];case 14:return[1-t,1-n-r*(l/u),i*(u/l),r*(l/u)];case 15:return[n,1-t,r*(l/u),i*(u/l)];default:return[t,n,r,i]}},re(fe,"_currentDrawId",-1),re(fe,"_currentParent",null),A(fe,cs,null),A(fe,bc,null),A(fe,Sc,null),A(fe,_o,NaN),A(fe,Eo,null),A(fe,Ao,null),A(fe,_c,NaN),re(fe,"_INNER_MARGIN",3);let fy=fe;var bi,us,ds,Ec,zd,Js,Es,pr,Ac,kc,Tc,Wd,v0;class FB{constructor(e,t,n,r,i,a){A(this,Wd);A(this,bi,new Float64Array(6));A(this,us);A(this,ds);A(this,Ec);A(this,zd);A(this,Js);A(this,Es,"");A(this,pr,0);A(this,Ac,new Qm);A(this,kc);A(this,Tc);S(this,kc,n),S(this,Tc,r),S(this,Ec,i),S(this,zd,a),[e,t]=k(this,Wd,v0).call(this,e,t);const o=S(this,us,[NaN,NaN,NaN,NaN,e,t]);S(this,Js,[e,t]),S(this,ds,[{line:o,points:d(this,Js)}]),d(this,bi).set(o,0)}updateProperty(e,t){e==="stroke-width"&&S(this,zd,t)}isEmpty(){return!d(this,ds)||d(this,ds).length===0}isCancellable(){return d(this,Js).length<=10}add(e,t){[e,t]=k(this,Wd,v0).call(this,e,t);const[n,r,i,a]=d(this,bi).subarray(2,6),o=e-i,l=t-a;return Math.hypot(d(this,kc)*o,d(this,Tc)*l)<=2?null:(d(this,Js).push(e,t),isNaN(n)?(d(this,bi).set([i,a,e,t],2),d(this,us).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(d(this,bi)[0])&&d(this,us).splice(6,6),d(this,bi).set([n,r,i,a,e,t],0),d(this,us).push(...ce.createBezierPoints(n,r,i,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(d(this,Js).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,i){S(this,kc,n),S(this,Tc,r),S(this,Ec,i),[e,t]=k(this,Wd,v0).call(this,e,t);const a=S(this,us,[NaN,NaN,NaN,NaN,e,t]);S(this,Js,[e,t]);const o=d(this,ds).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),d(this,ds).push({line:a,points:d(this,Js)}),d(this,bi).set(a,0),S(this,pr,0),this.toSVGPath(),null}getLastElement(){return d(this,ds).at(-1)}setLastElement(e){return d(this,ds)?(d(this,ds).push(e),S(this,us,e.line),S(this,Js,e.points),S(this,pr,0),{path:{d:this.toSVGPath()}}):d(this,Ac).setLastElement(e)}removeLastElement(){if(!d(this,ds))return d(this,Ac).removeLastElement();d(this,ds).pop(),S(this,Es,"");for(let e=0,t=d(this,ds).length;e<t;e++){const{line:n,points:r}=d(this,ds)[e];S(this,us,n),S(this,Js,r),S(this,pr,0),this.toSVGPath()}return{path:{d:d(this,Es)}}}toSVGPath(){const e=ce.svgRound(d(this,us)[4]),t=ce.svgRound(d(this,us)[5]);if(d(this,Js).length===2)return S(this,Es,`${d(this,Es)} M ${e} ${t} Z`),d(this,Es);if(d(this,Js).length<=6){const r=d(this,Es).lastIndexOf("M");S(this,Es,`${d(this,Es).slice(0,r)} M ${e} ${t}`),S(this,pr,6)}if(d(this,Js).length===4){const r=ce.svgRound(d(this,us)[10]),i=ce.svgRound(d(this,us)[11]);return S(this,Es,`${d(this,Es)} L ${r} ${i}`),S(this,pr,12),d(this,Es)}const n=[];d(this,pr)===0&&(n.push(`M ${e} ${t}`),S(this,pr,6));for(let r=d(this,pr),i=d(this,us).length;r<i;r+=6){const[a,o,l,u,h,f]=d(this,us).slice(r,r+6).map(ce.svgRound);n.push(`C${a} ${o} ${l} ${u} ${h} ${f}`)}return S(this,Es,d(this,Es)+n.join(" ")),S(this,pr,d(this,us).length),d(this,Es)}getOutlines(e,t,n,r){const i=d(this,ds).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),d(this,Ac).build(d(this,ds),e,t,n,d(this,Ec),d(this,zd),r),S(this,bi,null),S(this,us,null),S(this,ds,null),S(this,Es,null),d(this,Ac)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}bi=new WeakMap,us=new WeakMap,ds=new WeakMap,Ec=new WeakMap,zd=new WeakMap,Js=new WeakMap,Es=new WeakMap,pr=new WeakMap,Ac=new WeakMap,kc=new WeakMap,Tc=new WeakMap,Wd=new WeakSet,v0=function(e,t){return ce._normalizePoint(e,t,d(this,kc),d(this,Tc),d(this,Ec))};var Qs,Cm,Nm,Bn,Si,_i,Gd,qd,Cc,Cs,Fi,pR,mR,gR;class Qm extends ce{constructor(){super(...arguments);A(this,Cs);A(this,Qs);A(this,Cm,0);A(this,Nm);A(this,Bn);A(this,Si);A(this,_i);A(this,Gd);A(this,qd);A(this,Cc)}build(t,n,r,i,a,o,l){S(this,Si,n),S(this,_i,r),S(this,Gd,i),S(this,qd,a),S(this,Cc,o),S(this,Nm,l??0),S(this,Bn,t),k(this,Cs,mR).call(this)}get thickness(){return d(this,Cc)}setLastElement(t){return d(this,Bn).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return d(this,Bn).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of d(this,Bn)){if(t.push(`M${ce.svgRound(n[4])} ${ce.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12&&isNaN(n[6])){t.push(`L${ce.svgRound(n[10])} ${ce.svgRound(n[11])}`);continue}for(let r=6,i=n.length;r<i;r+=6){const[a,o,l,u,h,f]=n.subarray(r,r+6).map(ce.svgRound);t.push(`C${a} ${o} ${l} ${u} ${h} ${f}`)}}return t.join("")}serialize([t,n,r,i],a){const o=[],l=[],[u,h,f,p]=k(this,Cs,pR).call(this);let m,g,y,b,v,x,w,E,T;switch(d(this,qd)){case 0:T=ce._rescale,m=t,g=n+i,y=r,b=-i,v=t+u*r,x=n+(1-h-p)*i,w=t+(u+f)*r,E=n+(1-h)*i;break;case 90:T=ce._rescaleAndSwap,m=t,g=n,y=r,b=i,v=t+h*r,x=n+u*i,w=t+(h+p)*r,E=n+(u+f)*i;break;case 180:T=ce._rescale,m=t+r,g=n,y=-r,b=i,v=t+(1-u-f)*r,x=n+h*i,w=t+(1-u)*r,E=n+(h+p)*i;break;case 270:T=ce._rescaleAndSwap,m=t+r,g=n+i,y=-r,b=-i,v=t+(1-h-p)*r,x=n+(1-u-f)*i,w=t+(1-h)*r,E=n+(1-u)*i;break}for(const{line:C,points:N}of d(this,Bn))o.push(T(C,m,g,y,b,a?new Array(C.length):null)),l.push(T(N,m,g,y,b,a?new Array(N.length):null));return{lines:o,points:l,rect:[v,x,w,E]}}static deserialize(t,n,r,i,a,{paths:{lines:o,points:l},rotation:u,thickness:h}){const f=[];let p,m,g,y,b;switch(u){case 0:b=ce._rescale,p=-t/r,m=n/i+1,g=1/r,y=-1/i;break;case 90:b=ce._rescaleAndSwap,p=-n/i,m=-t/r,g=1/i,y=1/r;break;case 180:b=ce._rescale,p=t/r+1,m=-n/i,g=-1/r,y=1/i;break;case 270:b=ce._rescaleAndSwap,p=n/i+1,m=t/r+1,g=-1/i,y=-1/r;break}if(!o){o=[];for(const x of l){const w=x.length;if(w===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1]]));continue}if(w===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1],NaN,NaN,NaN,NaN,x[2],x[3]]));continue}const E=new Float32Array(3*(w-2));o.push(E);let[T,C,N,j]=x.subarray(0,4);E.set([NaN,NaN,NaN,NaN,T,C],0);for(let P=4;P<w;P+=2){const M=x[P],V=x[P+1];E.set(ce.createBezierPoints(T,C,N,j,M,V),(P-2)*3),[T,C,N,j]=[N,j,M,V]}}}for(let x=0,w=o.length;x<w;x++)f.push({line:b(o[x].map(E=>E??NaN),p,m,g,y),points:b(l[x].map(E=>E??NaN),p,m,g,y)});const v=new this.prototype.constructor;return v.build(f,r,i,1,u,h,a),v}get box(){return d(this,Qs)}updateProperty(t,n){return t==="stroke-width"?k(this,Cs,gR).call(this,n):null}updateParentDimensions([t,n],r){const[i,a]=k(this,Cs,Fi).call(this);S(this,Si,t),S(this,_i,n),S(this,Gd,r);const[o,l]=k(this,Cs,Fi).call(this),u=o-i,h=l-a,f=d(this,Qs);return f[0]-=u,f[1]-=h,f[2]+=2*u,f[3]+=2*h,f}updateRotation(t){return S(this,Cm,t),{path:{transform:this.rotationTransform}}}get viewBox(){return d(this,Qs).map(ce.svgRound).join(" ")}get defaultProperties(){const[t,n]=d(this,Qs);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=d(this,Qs);let r=0,i=0,a=0,o=0,l=0,u=0;switch(d(this,Cm)){case 90:i=n/t,a=-t/n,l=t;break;case 180:r=-1,o=-1,l=t,u=n;break;case 270:i=-n/t,a=t/n,u=n;break;default:return""}return`matrix(${r} ${i} ${a} ${o} ${ce.svgRound(l)} ${ce.svgRound(u)})`}getPathResizingSVGProperties([t,n,r,i]){const[a,o]=k(this,Cs,Fi).call(this),[l,u,h,f]=d(this,Qs);if(Math.abs(h-a)<=ce.PRECISION||Math.abs(f-o)<=ce.PRECISION){const b=t+r/2-(l+h/2),v=n+i/2-(u+f/2);return{path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`,transform:`${this.rotationTransform} translate(${b} ${v})`}}}const p=(r-2*a)/(h-2*a),m=(i-2*o)/(f-2*o),g=h/r,y=f/i;return{path:{"transform-origin":`${ce.svgRound(l)} ${ce.svgRound(u)}`,transform:`${this.rotationTransform} scale(${g} ${y}) translate(${ce.svgRound(a)} ${ce.svgRound(o)}) scale(${p} ${m}) translate(${ce.svgRound(-a)} ${ce.svgRound(-o)})`}}}getPathResizedSVGProperties([t,n,r,i]){const[a,o]=k(this,Cs,Fi).call(this),l=d(this,Qs),[u,h,f,p]=l;if(l[0]=t,l[1]=n,l[2]=r,l[3]=i,Math.abs(f-a)<=ce.PRECISION||Math.abs(p-o)<=ce.PRECISION){const v=t+r/2-(u+f/2),x=n+i/2-(h+p/2);for(const{line:w,points:E}of d(this,Bn))ce._translate(w,v,x,w),ce._translate(E,v,x,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(r-2*a)/(f-2*a),g=(i-2*o)/(p-2*o),y=-m*(u+a)+t+a,b=-g*(h+o)+n+o;if(m!==1||g!==1||y!==0||b!==0)for(const{line:v,points:x}of d(this,Bn))ce._rescale(v,y,b,m,g,v),ce._rescale(x,y,b,m,g,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],r){const[i,a]=r,o=d(this,Qs),l=t-o[0],u=n-o[1];if(d(this,Si)===i&&d(this,_i)===a)for(const{line:h,points:f}of d(this,Bn))ce._translate(h,l,u,h),ce._translate(f,l,u,f);else{const h=d(this,Si)/i,f=d(this,_i)/a;S(this,Si,i),S(this,_i,a);for(const{line:p,points:m}of d(this,Bn))ce._rescale(p,l,u,h,f,p),ce._rescale(m,l,u,h,f,m);o[2]*=h,o[3]*=f}return o[0]=t,o[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`}}}get defaultSVGProperties(){const t=d(this,Qs);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${ce.svgRound(t[0])} ${ce.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}Qs=new WeakMap,Cm=new WeakMap,Nm=new WeakMap,Bn=new WeakMap,Si=new WeakMap,_i=new WeakMap,Gd=new WeakMap,qd=new WeakMap,Cc=new WeakMap,Cs=new WeakSet,Fi=function(t=d(this,Cc)){const n=d(this,Nm)+t/2*d(this,Gd);return d(this,qd)%180===0?[n/d(this,Si),n/d(this,_i)]:[n/d(this,_i),n/d(this,Si)]},pR=function(){const[t,n,r,i]=d(this,Qs),[a,o]=k(this,Cs,Fi).call(this,0);return[t+a,n+o,r-2*a,i-2*o]},mR=function(){const t=S(this,Qs,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of d(this,Bn)){if(i.length<=12){for(let l=4,u=i.length;l<u;l+=6)ve.pointBoundingBox(i[l],i[l+1],t);continue}let a=i[4],o=i[5];for(let l=6,u=i.length;l<u;l+=6){const[h,f,p,m,g,y]=i.subarray(l,l+6);ve.bezierBoundingBox(a,o,h,f,p,m,g,y,t),a=g,o=y}}const[n,r]=k(this,Cs,Fi).call(this);t[0]=$s(t[0]-n,0,1),t[1]=$s(t[1]-r,0,1),t[2]=$s(t[2]+n,0,1),t[3]=$s(t[3]+r,0,1),t[2]-=t[0],t[3]-=t[1]},gR=function(t){const[n,r]=k(this,Cs,Fi).call(this);S(this,Cc,t);const[i,a]=k(this,Cs,Fi).call(this),[o,l]=[i-n,a-r],u=d(this,Qs);return u[0]-=o,u[1]-=l,u[2]+=2*o,u[3]+=2*l,u};class wv extends hR{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:gt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new wv(this._viewParameters);return e.updateAll(this),e}}var Ly,yR;const Ou=class Ou extends fy{constructor(t){super({...t,name:"inkEditor"});A(this,Ly);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,n){gt.initialize(t,n),this._defaultDrawingOptions=new wv(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ve(this,"typesMap",new Map([[We.INK_THICKNESS,"stroke-width"],[We.INK_COLOR,"stroke"],[We.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,r,i,a){return new FB(t,n,r,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,r,i,a,o){return Qm.deserialize(t,n,r,i,a,o)}static async deserialize(t,n,r){let i=null;if(t instanceof X_){const{data:{inkLists:o,rect:l,rotation:u,id:h,color:f,opacity:p,borderStyle:{rawWidth:m},popupRef:g},parent:{page:{pageNumber:y}}}=t;i=t={annotationType:Pe.INK,color:Array.from(f),thickness:m,opacity:p,paths:{points:o},boxes:null,pageIndex:y-1,rect:l.slice(0),rotation:u,annotationElementId:h,id:h,deleted:!1,popupRef:g}}const a=await super.deserialize(t,n,r);return a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:r}=this;n.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:r}){this._drawingOptions=Ou.getDefaultDrawingOptions({stroke:ve.makeHexColor(...t),"stroke-width":n,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,u={annotationType:Pe.INK,color:gt._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:n,points:r},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(u.isCopy=!0,u):this.annotationElementId&&!k(this,Ly,yR).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:n,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:n}),null}};Ly=new WeakSet,yR=function(t){const{color:n,thickness:r,opacity:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==n[l])||t.thickness!==r||t.opacity!==i||t.pageIndex!==a},re(Ou,"_type","ink"),re(Ou,"_editorType",Pe.INK),re(Ou,"_defaultDrawingOptions",null);let Qb=Ou;class Zb extends Qm{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Dg=8,Mh=3;var Nc,et,eS,Vr,vR,xR,tS,x0,wR,bR,SR,sS,nS,_R;class Ni{static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},i,a,o,l){let u=new OffscreenCanvas(1,1),h=u.getContext("2d",{alpha:!1});const f=200,p=h.font=`${n} ${r} ${f}px ${t}`,{actualBoundingBoxLeft:m,actualBoundingBoxRight:g,actualBoundingBoxAscent:y,actualBoundingBoxDescent:b,fontBoundingBoxAscent:v,fontBoundingBoxDescent:x,width:w}=h.measureText(e),E=1.5,T=Math.ceil(Math.max(Math.abs(m)+Math.abs(g)||0,w)*E),C=Math.ceil(Math.max(Math.abs(y)+Math.abs(b)||f,Math.abs(v)+Math.abs(x)||f)*E);u=new OffscreenCanvas(T,C),h=u.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=p,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,T,C),h.fillStyle="black",h.fillText(e,T*(E-1)/2,C*(3-E)/2);const N=k(this,et,sS).call(this,h.getImageData(0,0,T,C).data),j=k(this,et,SR).call(this,N),P=k(this,et,nS).call(this,j),M=k(this,et,tS).call(this,N,T,C,P);return this.processDrawnLines({lines:{curves:M,width:T,height:C},pageWidth:i,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,i){const[a,o,l]=k(this,et,_R).call(this,e),[u,h]=k(this,et,bR).call(this,a,o,l,Math.hypot(o,l)*d(this,Nc).sigmaSFactor,d(this,Nc).sigmaR,d(this,Nc).kernelSize),f=k(this,et,nS).call(this,h),p=k(this,et,tS).call(this,u,o,l,f);return this.processDrawnLines({lines:{curves:p,width:o,height:l},pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:a,areContours:o}){r%180!==0&&([t,n]=[n,t]);const{curves:l,width:u,height:h}=e,f=e.thickness??0,p=[],m=Math.min(t/u,n/h),g=m/t,y=m/n,b=[];for(const{points:x}of l){const w=a?k(this,et,wR).call(this,x):x;if(!w)continue;b.push(w);const E=w.length,T=new Float32Array(E),C=new Float32Array(3*(E===2?2:E-2));if(p.push({line:C,points:T}),E===2){T[0]=w[0]*g,T[1]=w[1]*y,C.set([NaN,NaN,NaN,NaN,T[0],T[1]],0);continue}let[N,j,P,M]=w;N*=g,j*=y,P*=g,M*=y,T.set([N,j,P,M],0),C.set([NaN,NaN,NaN,NaN,N,j],0);for(let V=4;V<E;V+=2){const L=T[V]=w[V]*g,I=T[V+1]=w[V+1]*y;C.set(ce.createBezierPoints(N,j,P,M,L,I),(V-2)*3),[N,j,P,M]=[P,M,L,I]}}if(p.length===0)return null;const v=o?new Zb:new Qm;return v.build(p,t,n,1,r,o?0:f,i),{outline:v,newCurves:b,areContours:o,thickness:f,width:u,height:h}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:i}){let a=1/0,o=-1/0,l=0;for(const w of e){l+=w.length;for(let E=2,T=w.length;E<T;E++){const C=w[E]-w[E-2];a=Math.min(a,C),o=Math.max(o,C)}}let u;a>=-128&&o<=127?u=Int8Array:a>=-32768&&o<=32767?u=Int16Array:u=Int32Array;const h=e.length,f=Dg+Mh*h,p=new Uint32Array(f);let m=0;p[m++]=f*Uint32Array.BYTES_PER_ELEMENT+(l-2*h)*u.BYTES_PER_ELEMENT,p[m++]=0,p[m++]=r,p[m++]=i,p[m++]=t?0:1,p[m++]=Math.max(0,Math.floor(n??0)),p[m++]=h,p[m++]=u.BYTES_PER_ELEMENT;for(const w of e)p[m++]=w.length-2,p[m++]=w[0],p[m++]=w[1];const g=new CompressionStream("deflate-raw"),y=g.writable.getWriter();await y.ready,y.write(p);const b=u.prototype.constructor;for(const w of e){const E=new b(w.length-2);for(let T=2,C=w.length;T<C;T++)E[T-2]=w[T]-w[T-2];y.write(E)}y.close();const v=await new Response(g.readable).arrayBuffer(),x=new Uint8Array(v);return wj(x)}static async decompressSignature(e){try{const t=p6(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),i=r.getWriter();await i.ready,i.write(t).then(async()=>{await i.ready,await i.close()}).catch(()=>{});let a=null,o=0;for await(const w of n)a||(a=new Uint8Array(new Uint32Array(w.buffer,0,4)[0])),a.set(w,o),o+=w.length;const l=new Uint32Array(a.buffer,0,a.length>>2),u=l[1];if(u!==0)throw new Error(`Invalid version: ${u}`);const h=l[2],f=l[3],p=l[4]===0,m=l[5],g=l[6],y=l[7],b=[],v=(Dg+Mh*g)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(y){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(a.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(a.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(a.buffer,v);break}o=0;for(let w=0;w<g;w++){const E=l[Mh*w+Dg],T=new Float32Array(E+2);b.push(T);for(let C=0;C<Mh-1;C++)T[C]=l[Mh*w+Dg+C+1];for(let C=0;C<E;C++)T[C+2]=T[C]+x[o++]}return{areContours:p,thickness:m,outlines:b,width:h,height:f}}catch(t){return Le(`decompressSignature: ${t}`),null}}}Nc=new WeakMap,et=new WeakSet,eS=function(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r},Vr=new WeakMap,vR=function(e,t,n,r,i,a,o){const l=k(this,et,eS).call(this,n,r,i,a);for(let u=0;u<8;u++){const h=(-u+l-o+16)%8,f=d(this,Vr)[2*h],p=d(this,Vr)[2*h+1];if(e[(n+f)*t+(r+p)]!==0)return h}return-1},xR=function(e,t,n,r,i,a,o){const l=k(this,et,eS).call(this,n,r,i,a);for(let u=0;u<8;u++){const h=(u+l+o+16)%8,f=d(this,Vr)[2*h],p=d(this,Vr)[2*h+1];if(e[(n+f)*t+(r+p)]!==0)return h}return-1},tS=function(e,t,n,r){const i=e.length,a=new Int32Array(i);for(let h=0;h<i;h++)a[h]=e[h]<=r?1:0;for(let h=1;h<n-1;h++)a[h*t]=a[h*t+t-1]=0;for(let h=0;h<t;h++)a[h]=a[t*n-1-h]=0;let o=1,l;const u=[];for(let h=1;h<n-1;h++){l=1;for(let f=1;f<t-1;f++){const p=h*t+f,m=a[p];if(m===0)continue;let g=h,y=f;if(m===1&&a[p-1]===0)o+=1,y-=1;else if(m>=1&&a[p+1]===0)o+=1,y+=1,m>1&&(l=m);else{m!==1&&(l=Math.abs(m));continue}const b=[f,h],v=y===f+1,x={isHole:v,points:b,id:o,parent:0};u.push(x);let w;for(const V of u)if(V.id===l){w=V;break}w?w.isHole?x.parent=v?w.parent:l:x.parent=v?l:w.parent:x.parent=v?l:0;const E=k(this,et,vR).call(this,a,t,h,f,g,y,0);if(E===-1){a[p]=-o,a[p]!==1&&(l=Math.abs(a[p]));continue}let T=d(this,Vr)[2*E],C=d(this,Vr)[2*E+1];const N=h+T,j=f+C;g=N,y=j;let P=h,M=f;for(;;){const V=k(this,et,xR).call(this,a,t,P,M,g,y,1);T=d(this,Vr)[2*V],C=d(this,Vr)[2*V+1];const L=P+T,I=M+C;b.push(I,L);const O=P*t+M;if(a[O+1]===0?a[O]=-o:a[O]===1&&(a[O]=o),L===h&&I===f&&P===N&&M===j){a[p]!==1&&(l=Math.abs(a[p]));break}else g=P,y=M,P=L,M=I}}}return u},x0=function(e,t,n,r){if(n-t<=4){for(let N=t;N<n-2;N+=2)r.push(e[N],e[N+1]);return}const i=e[t],a=e[t+1],o=e[n-4]-i,l=e[n-3]-a,u=Math.hypot(o,l),h=o/u,f=l/u,p=h*a-f*i,m=l/o,g=1/u,y=Math.atan(m),b=Math.cos(y),v=Math.sin(y),x=g*(Math.abs(b)+Math.abs(v)),w=g*(1-x+x**2),E=Math.max(Math.atan(Math.abs(v+b)*w),Math.atan(Math.abs(v-b)*w));let T=0,C=t;for(let N=t+2;N<n-2;N+=2){const j=Math.abs(p-h*e[N+1]+f*e[N]);j>T&&(C=N,T=j)}T>(u*E)**2?(k(this,et,x0).call(this,e,t,C+2,r),k(this,et,x0).call(this,e,C,n,r)):r.push(i,a)},wR=function(e){const t=[],n=e.length;return k(this,et,x0).call(this,e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t},bR=function(e,t,n,r,i,a){const o=new Float32Array(a**2),l=-2*r**2,u=a>>1;for(let y=0;y<a;y++){const b=(y-u)**2;for(let v=0;v<a;v++)o[y*a+v]=Math.exp((b+(v-u)**2)/l)}const h=new Float32Array(256),f=-2*i**2;for(let y=0;y<256;y++)h[y]=Math.exp(y**2/f);const p=e.length,m=new Uint8Array(p),g=new Uint32Array(256);for(let y=0;y<n;y++)for(let b=0;b<t;b++){const v=y*t+b,x=e[v];let w=0,E=0;for(let C=0;C<a;C++){const N=y+C-u;if(!(N<0||N>=n))for(let j=0;j<a;j++){const P=b+j-u;if(P<0||P>=t)continue;const M=e[N*t+P],V=o[C*a+j]*h[Math.abs(M-x)];w+=M*V,E+=V}}const T=m[v]=Math.round(w/E);g[T]++}return[m,g]},SR=function(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t},sS=function(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,i=1/0;for(let o=0,l=n.length;o<l;o++){if(e[(o<<2)+3]===0){r=n[o]=255;continue}const h=n[o]=e[o<<2];h>r&&(r=h),h<i&&(i=h)}const a=255/(r-i);for(let o=0;o<t;o++)n[o]=(n[o]-i)*a;return n},nS=function(e){let t,n=-1/0,r=-1/0;const i=e.findIndex(l=>l!==0);let a=i,o=i;for(t=i;t<256;t++){const l=e[t];l>n&&(t-a>r&&(r=t-a,o=t-1),n=l,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},_R=function(e){const t=e,{width:n,height:r}=e,{maxDim:i}=d(this,Nc);let a=n,o=r;if(n>i||r>i){let p=n,m=r,g=Math.log2(Math.max(n,r)/i);const y=Math.floor(g);g=g===y?y-1:y;for(let v=0;v<g;v++){a=Math.ceil(p/2),o=Math.ceil(m/2);const x=new OffscreenCanvas(a,o);x.getContext("2d").drawImage(e,0,0,p,m,0,0,a,o),p=a,m=o,e!==t&&e.close(),e=x.transferToImageBitmap()}const b=Math.min(i/a,i/o);a=Math.round(a*b),o=Math.round(o*b)}const u=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});u.filter="grayscale(1)",u.drawImage(e,0,0,e.width,e.height,0,0,a,o);const h=u.getImageData(0,0,a,o).data;return[k(this,et,sS).call(this,h),a,o]},A(Ni,et),A(Ni,Nc,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),A(Ni,Vr,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class J_ extends hR{constructor(){super(),super.updateProperties({fill:gt._defaultLineColor,"stroke-width":0})}clone(){const e=new J_;return e.updateAll(this),e}}class Q_ extends wv{constructor(e){super(e),super.updateProperties({stroke:gt._defaultLineColor,"stroke-width":1})}clone(){const e=new Q_(this._viewParameters);return e.updateAll(this),e}}var ko,Ei,To,jc;const Nn=class Nn extends fy{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});A(this,ko,!1);A(this,Ei,null);A(this,To,null);A(this,jc,null);this._willKeepAspectRatio=!0,S(this,To,t.signatureData||null),S(this,Ei,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,n){gt.initialize(t,n),this._defaultDrawingOptions=new J_,this._defaultDrawnSignatureOptions=new Q_(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return Ve(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!d(this,Ei)}}static computeTelemetryFinalData(t){const n=t.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n;const{_isCopy:r}=this;if(r&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(d(this,To)){const{lines:i,mustSmooth:a,areContours:o,description:l,uuid:u,heightInPage:h}=d(this,To),{rawDims:{pageWidth:f,pageHeight:p},rotation:m}=this.parent.viewport,g=Ni.processDrawnLines({lines:i,pageWidth:f,pageHeight:p,rotation:m,innerMargin:Nn._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(g,h,l,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return r&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(t){S(this,jc,t),this.addEditToolbar()}getUuid(){return d(this,jc)}get description(){return d(this,Ei)}set description(t){S(this,Ei,t),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:n,thickness:r,width:i,height:a}=d(this,To),o=Math.max(i,a),l=Ni.processDrawnLines({lines:{curves:t.map(u=>({points:u})),thickness:r,width:i,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,r,i){const{x:a,y:o}=this,{outline:l}=S(this,To,t);S(this,ko,l instanceof Zb),this.description=r,this.div.setAttribute("data-l10n-args",JSON.stringify({description:r}));let u;d(this,ko)?u=Nn.getDefaultDrawingOptions():(u=Nn._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:u});const[h,f]=this.parentDimensions,[,p]=this.pageDimensions;let m=n/p;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(h*this.width,f*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return Ni.process(t,n,r,i,Nn._INNER_MARGIN)}getFromText(t,n){const{rawDims:{pageWidth:r,pageHeight:i},rotation:a}=this.parent.viewport;return Ni.extractContoursFromText(t,n,r,i,a,Nn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return Ni.processDrawnLines({lines:t,pageWidth:n,pageHeight:r,rotation:i,innerMargin:Nn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=Nn.getDefaultDrawingOptions():(this._drawingOptions=Nn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:n,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:Pe.SIGNATURE,isSignature:!0,areContours:d(this,ko),color:[0,0,0],thickness:d(this,ko)?0:a,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.paths={lines:n,points:r},o.uuid=d(this,jc),o.isCopy=!0):o.lines=n,d(this,Ei)&&(o.accessibilityData={type:"Figure",alt:d(this,Ei)}),o}static deserializeDraw(t,n,r,i,a,o){return o.areContours?Zb.deserialize(t,n,r,i,a,o):Qm.deserialize(t,n,r,i,a,o)}static async deserialize(t,n,r){var a;const i=await super.deserialize(t,n,r);return S(i,ko,t.areContours),S(i,Ei,((a=t.accessibilityData)==null?void 0:a.alt)||""),S(i,jc,t.uuid),i}};ko=new WeakMap,Ei=new WeakMap,To=new WeakMap,jc=new WeakMap,re(Nn,"_type","signature"),re(Nn,"_editorType",Pe.SIGNATURE),re(Nn,"_defaultDrawingOptions",null);let rS=Nn;var Et,hs,Co,ma,No,Kd,ga,Pc,Ai,Hn,Xd,Ye,lf,cf,w0,b0,S0,aS,_0,ER;class iS extends gt{constructor(t){super({...t,name:"stampEditor"});A(this,Ye);A(this,Et,null);A(this,hs,null);A(this,Co,null);A(this,ma,null);A(this,No,null);A(this,Kd,"");A(this,ga,null);A(this,Pc,!1);A(this,Ai,null);A(this,Hn,!1);A(this,Xd,!1);S(this,ma,t.bitmapUrl),S(this,No,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,n){gt.initialize(t,n)}static isHandlingMimeForPasting(t){return cy.includes(t)}static paste(t,n){n.pasteEditor({mode:Pe.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await r.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),n&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;d(this,hs)&&(S(this,Et,null),this._uiManager.imageManager.deleteId(d(this,hs)),(t=d(this,ga))==null||t.remove(),S(this,ga,null),d(this,Ai)&&(clearTimeout(d(this,Ai)),S(this,Ai,null))),super.remove()}rebuild(){if(!this.parent){d(this,hs)&&k(this,Ye,w0).call(this);return}super.rebuild(),this.div!==null&&(d(this,hs)&&d(this,ga)===null&&k(this,Ye,w0).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(d(this,Co)||d(this,Et)||d(this,ma)||d(this,No)||d(this,hs)||d(this,Pc))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;return this._isCopy&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),d(this,Pc)||(d(this,Et)?k(this,Ye,b0).call(this):k(this,Ye,w0).call(this)),this._isCopy&&this._moveAfterPaste(t,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,n){const{id:r,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,n);n.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(S(this,hs,r),i&&S(this,Et,i),S(this,Pc,!1),k(this,Ye,b0).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;d(this,Ai)!==null&&clearTimeout(d(this,Ai)),S(this,Ai,setTimeout(()=>{S(this,Ai,null),k(this,Ye,aS).call(this)},200))}copyCanvas(t,n,r=!1){var m;t||(t=224);const{width:i,height:a}=d(this,Et),o=new ei;let l=d(this,Et),u=i,h=a,f=null;if(n){if(i>n||a>n){const j=Math.min(n/i,n/a);u=Math.floor(i*j),h=Math.floor(a*j)}f=document.createElement("canvas");const g=f.width=Math.ceil(u*o.sx),y=f.height=Math.ceil(h*o.sy);d(this,Hn)||(l=k(this,Ye,S0).call(this,g,y));const b=f.getContext("2d");b.filter=this._uiManager.hcmFilter;let v="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(v="#8f8f9d",x="#42414d");const w=15,E=w*o.sx,T=w*o.sy,C=new OffscreenCanvas(E*2,T*2),N=C.getContext("2d");N.fillStyle=v,N.fillRect(0,0,E*2,T*2),N.fillStyle=x,N.fillRect(0,0,E,T),N.fillRect(E,T,E,T),b.fillStyle=b.createPattern(C,"repeat"),b.fillRect(0,0,g,y),b.drawImage(l,0,0,l.width,l.height,0,0,g,y)}let p=null;if(r){let g,y;if(o.symmetric&&l.width<t&&l.height<t)g=l.width,y=l.height;else if(l=d(this,Et),i>t||a>t){const x=Math.min(t/i,t/a);g=Math.floor(i*x),y=Math.floor(a*x),d(this,Hn)||(l=k(this,Ye,S0).call(this,g,y))}const v=new OffscreenCanvas(g,y).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,g,y),p={width:g,height:y,data:v.getImageData(0,0,g,y).data}}return{canvas:f,width:u,height:h,imageData:p}}static async deserialize(t,n,r){var b;let i=null,a=!1;if(t instanceof $P){const{data:{rect:v,rotation:x,id:w,structParent:E,popupRef:T},container:C,parent:{page:{pageNumber:N}},canvas:j}=t;let P,M;j?(delete t.canvas,{id:P,bitmap:M}=r.imageManager.getFromCanvas(C.id,j),j.remove()):(a=!0,t._hasNoCanvas=!0);const V=((b=await n._structTree.getAriaAttributes(`${B_}${w}`))==null?void 0:b.get("aria-label"))||"";i=t={annotationType:Pe.STAMP,bitmapId:P,bitmap:M,pageIndex:N-1,rect:v.slice(0),rotation:x,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:V},isSvg:!1,structParent:E,popupRef:T}}const o=await super.deserialize(t,n,r),{rect:l,bitmap:u,bitmapUrl:h,bitmapId:f,isSvg:p,accessibilityData:m}=t;a?(r.addMissingCanvas(t.id,o),S(o,Pc,!0)):f&&r.imageManager.isValidId(f)?(S(o,hs,f),u&&S(o,Et,u)):S(o,ma,h),S(o,Hn,p);const[g,y]=o.pageDimensions;return o.width=(l[2]-l[0])/g,o.height=(l[3]-l[1])/y,m&&(o.altTextData=m),o._initialData=i,S(o,Xd,!!i),o}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:Pe.STAMP,bitmapId:d(this,hs),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:d(this,Hn),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=k(this,Ye,_0).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=k(this,Ye,ER).call(this,r);if(l.isSame)return null;l.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,n===null)return r;n.stamps||(n.stamps=new Map);const o=d(this,Hn)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!n.stamps.has(d(this,hs)))n.stamps.set(d(this,hs),{area:o,serialized:r}),r.bitmap=k(this,Ye,_0).call(this,!1);else if(d(this,Hn)){const l=n.stamps.get(d(this,hs));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=k(this,Ye,_0).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}Et=new WeakMap,hs=new WeakMap,Co=new WeakMap,ma=new WeakMap,No=new WeakMap,Kd=new WeakMap,ga=new WeakMap,Pc=new WeakMap,Ai=new WeakMap,Hn=new WeakMap,Xd=new WeakMap,Ye=new WeakSet,lf=function(t,n=!1){if(!t){this.remove();return}S(this,Et,t.bitmap),n||(S(this,hs,t.id),S(this,Hn,t.isSvg)),t.file&&S(this,Kd,t.file.name),k(this,Ye,b0).call(this)},cf=function(){if(S(this,Co,null),this._uiManager.enableWaiting(!1),!!d(this,ga)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Et)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Et)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},w0=function(){if(d(this,hs)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(d(this,hs)).then(r=>k(this,Ye,lf).call(this,r,!0)).finally(()=>k(this,Ye,cf).call(this));return}if(d(this,ma)){const r=d(this,ma);S(this,ma,null),this._uiManager.enableWaiting(!0),S(this,Co,this._uiManager.imageManager.getFromUrl(r).then(i=>k(this,Ye,lf).call(this,i)).finally(()=>k(this,Ye,cf).call(this)));return}if(d(this,No)){const r=d(this,No);S(this,No,null),this._uiManager.enableWaiting(!0),S(this,Co,this._uiManager.imageManager.getFromFile(r).then(i=>k(this,Ye,lf).call(this,i)).finally(()=>k(this,Ye,cf).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=cy.join(",");const n=this._uiManager._signal;S(this,Co,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),k(this,Ye,lf).call(this,i)}r()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:n})}).finally(()=>k(this,Ye,cf).call(this))),t.click()},b0=function(){var f;const{div:t}=this;let{width:n,height:r}=d(this,Et);const[i,a]=this.pageDimensions,o=.75;if(this.width)n=this.width*i,r=this.height*a;else if(n>o*i||r>o*a){const p=Math.min(o*i/n,o*a/r);n*=p,r*=p}const[l,u]=this.parentDimensions;this.setDims(n*l/i,r*u/a),this._uiManager.enableWaiting(!1);const h=S(this,ga,document.createElement("canvas"));h.setAttribute("role","img"),this.addContainer(h),this.width=n/i,this.height=r/a,(f=this._initialOptions)!=null&&f.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),k(this,Ye,aS).call(this),d(this,Xd)||(this.parent.addUndoableEditor(this),S(this,Xd,!0)),this._reportTelemetry({action:"inserted_image"}),d(this,Kd)&&this.div.setAttribute("aria-description",d(this,Kd)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},S0=function(t,n){const{width:r,height:i}=d(this,Et);let a=r,o=i,l=d(this,Et);for(;a>2*t||o>2*n;){const u=a,h=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*n&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const f=new OffscreenCanvas(a,o);f.getContext("2d").drawImage(l,0,0,u,h,0,0,a,o),l=f.transferToImageBitmap()}return l},aS=function(){const[t,n]=this.parentDimensions,{width:r,height:i}=this,a=new ei,o=Math.ceil(r*t*a.sx),l=Math.ceil(i*n*a.sy),u=d(this,ga);if(!u||u.width===o&&u.height===l)return;u.width=o,u.height=l;const h=d(this,Hn)?d(this,Et):k(this,Ye,S0).call(this,o,l),f=u.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(h,0,0,h.width,h.height,0,0,o,l)},_0=function(t){if(t){if(d(this,Hn)){const i=this._uiManager.imageManager.getSvgUrl(d(this,hs));if(i)return i}const n=document.createElement("canvas");return{width:n.width,height:n.height}=d(this,Et),n.getContext("2d").drawImage(d(this,Et),0,0),n.toDataURL()}if(d(this,Hn)){const[n,r]=this.pageDimensions,i=Math.round(this.width*n*Ma.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*Ma.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,a);return o.getContext("2d").drawImage(d(this,Et),0,0,d(this,Et).width,d(this,Et).height,0,0,i,a),o.transferToImageBitmap()}return structuredClone(d(this,Et))},ER=function(t){var o;const{pageIndex:n,accessibilityData:{altText:r}}=this._initialData,i=t.pageIndex===n,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},re(iS,"_type","stamp"),re(iS,"_editorType",Pe.STAMP);var Rc,Yd,ki,jo,ya,Vn,Po,Jd,Lc,zr,va,fs,xa,Ro,Qd,me,Lo,At,AR,oi,oS,lS,E0;const Rr=class Rr{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:i,annotationLayer:a,drawLayer:o,textLayer:l,viewport:u,l10n:h}){A(this,At);A(this,Rc);A(this,Yd,!1);A(this,ki,null);A(this,jo,null);A(this,ya,null);A(this,Vn,new Map);A(this,Po,!1);A(this,Jd,!1);A(this,Lc,!1);A(this,zr,null);A(this,va,null);A(this,fs,null);A(this,xa,null);A(this,Ro,null);A(this,Qd,-1);A(this,me);const f=[...d(Rr,Lo).values()];if(!Rr._initialized){Rr._initialized=!0;for(const p of f)p.initialize(h,e)}e.registerEditorTypes(f),S(this,me,e),this.pageIndex=t,this.div=n,S(this,Rc,i),S(this,ki,a),this.viewport=u,S(this,fs,l),this.drawLayer=o,this._structTree=r,d(this,me).addLayer(this)}get isEmpty(){return d(this,Vn).size===0}get isInvisible(){return this.isEmpty&&d(this,me).getMode()===Pe.NONE}updateToolbar(e){d(this,me).updateToolbar(e)}updateMode(e=d(this,me).getMode()){switch(k(this,At,E0).call(this),e){case Pe.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Pe.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Pe.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const n of d(Rr,Lo).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=d(this,fs))==null?void 0:t.div)}setEditingState(e){d(this,me).setEditingState(e)}addCommands(e){d(this,me).addCommands(e)}cleanUndoStack(e){d(this,me).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=d(this,ki))==null||t.div.classList.toggle("disabled",!e)}async enable(){var n;S(this,Lc,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),(n=d(this,Ro))==null||n.abort(),S(this,Ro,null);const e=new Set;for(const r of d(this,Vn).values())r.enableEditing(),r.show(!0),r.annotationElementId&&(d(this,me).removeChangedExistingAnnotation(r),e.add(r.annotationElementId));if(!d(this,ki)){S(this,Lc,!1);return}const t=d(this,ki).getEditableAnnotations();for(const r of t){if(r.hide(),d(this,me).isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;const i=await this.deserialize(r);i&&(this.addOrRebuild(i),i.enableEditing())}S(this,Lc,!1)}disable(){var r;if(S(this,Jd,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),d(this,fs)&&!d(this,Ro)){S(this,Ro,new AbortController);const i=d(this,me).combinedSignal(d(this,Ro));d(this,fs).div.addEventListener("pointerdown",a=>{const{clientX:l,clientY:u,timeStamp:h}=a,f=d(this,Qd);if(h-f>500){S(this,Qd,h);return}S(this,Qd,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const m=document.elementsFromPoint(l,u);if(p.toggle("getElements",!1),!this.div.contains(m[0]))return;let g;const y=new RegExp(`^${mj}[0-9]+$`);for(const v of m)if(y.test(v.id)){g=v.id;break}if(!g)return;const b=d(this,Vn).get(g);(b==null?void 0:b.annotationElementId)===null&&(a.stopPropagation(),a.preventDefault(),b.dblclick())},{signal:i,capture:!0})}const e=new Map,t=new Map;for(const i of d(this,Vn).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);(r=this.getEditableAnnotation(i.annotationElementId))==null||r.show(),i.remove()}if(d(this,ki)){const i=d(this,ki).getEditableAnnotations();for(const a of i){const{id:o}=a.data;if(d(this,me).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(d(this,me).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}k(this,At,E0).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const i of d(Rr,Lo).values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),S(this,Jd,!1)}getEditableAnnotation(e){var t;return((t=d(this,ki))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){d(this,me).getActive()!==e&&d(this,me).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=d(this,fs))!=null&&e.div&&!d(this,xa)){S(this,xa,new AbortController);const t=d(this,me).combinedSignal(d(this,xa));d(this,fs).div.addEventListener("pointerdown",k(this,At,AR).bind(this),{signal:t}),d(this,fs).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=d(this,fs))!=null&&e.div&&d(this,xa)&&(d(this,xa).abort(),S(this,xa,null),d(this,fs).div.classList.remove("highlighting"))}enableClick(){if(d(this,jo))return;S(this,jo,new AbortController);const e=d(this,me).combinedSignal(d(this,jo));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=d(this,jo))==null||e.abort(),S(this,jo,null)}attach(e){d(this,Vn).set(e.id,e);const{annotationElementId:t}=e;t&&d(this,me).isDeletedAnnotationElement(t)&&d(this,me).removeDeletedAnnotationElement(e)}detach(e){var t;d(this,Vn).delete(e.id),(t=d(this,Rc))==null||t.removePointerInTextLayer(e.contentDiv),!d(this,Jd)&&e.annotationElementId&&d(this,me).addDeletedAnnotationElement(e)}remove(e){this.detach(e),d(this,me).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(d(this,me).addDeletedAnnotationElement(e.annotationElementId),gt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),d(this,me).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!d(this,Lc)),d(this,me).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!d(this,ya)&&(e._focusEventsAllowed=!1,S(this,ya,setTimeout(()=>{S(this,ya,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:d(this,me)._signal}),t.focus())},0))),e._structTreeParentId=(n=d(this,Rc))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return d(this,me).getId()}combinedSignal(e){return d(this,me).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=d(this,At,oi))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await d(this,me).updateMode(e.mode);const{offsetX:n,offsetY:r}=k(this,At,lS).call(this),i=this.getNextId(),a=k(this,At,oS).call(this,{parent:this,id:i,x:n,y:r,uiManager:d(this,me),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=d(Rr,Lo).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,d(this,me)))||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),i=k(this,At,oS).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:d(this,me),isCentered:t,...n});return i&&this.add(i),i}addNewEditor(e={}){this.createAndAddNewEditor(k(this,At,lS).call(this),!0,e)}setSelected(e){d(this,me).setSelected(e)}toggleSelected(e){d(this,me).toggleSelected(e)}unselect(e){d(this,me).unselect(e)}pointerup(e){var r;const{isMac:t}=gs.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!d(this,Po)||(S(this,Po,!1),(r=d(this,At,oi))!=null&&r.isDrawer&&d(this,At,oi).supportMultipleDrawings))return;if(!d(this,Yd)){S(this,Yd,!0);return}const n=d(this,me).getMode();if(n===Pe.STAMP||n===Pe.SIGNATURE){d(this,me).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var r;if(d(this,me).getMode()===Pe.HIGHLIGHT&&this.enableTextSelection(),d(this,Po)){S(this,Po,!1);return}const{isMac:t}=gs.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(S(this,Po,!0),(r=d(this,At,oi))!=null&&r.isDrawer){this.startDrawingSession(e);return}const n=d(this,me).getActive();S(this,Yd,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),d(this,zr)){d(this,At,oi).startDrawing(this,d(this,me),!1,e);return}d(this,me).setCurrentDrawingSession(this),S(this,zr,new AbortController);const t=d(this,me).combinedSignal(d(this,zr));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(S(this,va,null),this.commitOrRemove())},{signal:t}),d(this,At,oi).startDrawing(this,d(this,me),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&S(this,va,t);return}d(this,va)&&setTimeout(()=>{var t;(t=d(this,va))==null||t.focus(),S(this,va,null)},0)}endDrawingSession(e=!1){return d(this,zr)?(d(this,me).setCurrentDrawingSession(null),d(this,zr).abort(),S(this,zr,null),S(this,va,null),d(this,At,oi).endDrawing(e)):null}findNewParent(e,t,n){const r=d(this,me).findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return d(this,zr)?(this.endDrawingSession(),!0):!1}onScaleChanging(){d(this,zr)&&d(this,At,oi).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=d(this,me).getActive())==null?void 0:e.parent)===this&&(d(this,me).commitOrRemove(),d(this,me).setActiveEditor(null)),d(this,ya)&&(clearTimeout(d(this,ya)),S(this,ya,null));for(const n of d(this,Vn).values())(t=d(this,Rc))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,d(this,Vn).clear(),d(this,me).removeLayer(this)}render({viewport:e}){this.viewport=e,Yo(this.div,e);for(const t of d(this,me).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){d(this,me).commitOrRemove(),k(this,At,E0).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Yo(this.div,{rotation:n}),t!==n)for(const r of d(this,Vn).values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return d(this,me).viewParameters.realScale}};Rc=new WeakMap,Yd=new WeakMap,ki=new WeakMap,jo=new WeakMap,ya=new WeakMap,Vn=new WeakMap,Po=new WeakMap,Jd=new WeakMap,Lc=new WeakMap,zr=new WeakMap,va=new WeakMap,fs=new WeakMap,xa=new WeakMap,Ro=new WeakMap,Qd=new WeakMap,me=new WeakMap,Lo=new WeakMap,At=new WeakSet,AR=function(e){d(this,me).unselectAll();const{target:t}=e;if(t===d(this,fs).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&d(this,fs).div.contains(t)){const{isMac:n}=gs.platform;if(e.button!==0||e.ctrlKey&&n)return;d(this,me).showAllEditors("highlight",!0,!0),d(this,fs).div.classList.add("free"),this.toggleDrawing(),hy.startHighlighting(this,d(this,me).direction==="ltr",{target:d(this,fs).div,x:e.x,y:e.y}),d(this,fs).div.addEventListener("pointerup",()=>{d(this,fs).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:d(this,me)._signal}),e.preventDefault()}},oi=function(){return d(Rr,Lo).get(d(this,me).getMode())},oS=function(e){const t=d(this,At,oi);return t?new t.prototype.constructor(e):null},lS=function(){const{x:e,y:t,width:n,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+r),u=(i+o)/2-e,h=(a+l)/2-t,[f,p]=this.viewport.rotation%180===0?[u,h]:[h,u];return{offsetX:f,offsetY:p}},E0=function(){for(const e of d(this,Vn).values())e.isEmpty()&&e.remove()},re(Rr,"_initialized",!1),A(Rr,Lo,new Map([$b,Qb,iS,hy,rS].map(e=>[e._editorType,e])));let py=Rr;var Wr,Zs,Dc,jm,Dy,kR,Li,cS,TR,uS;const Zt=class Zt{constructor({pageIndex:e}){A(this,Li);A(this,Wr,null);A(this,Zs,new Map);A(this,Dc,new Map);this.pageIndex=e}setParent(e){if(!d(this,Wr)){S(this,Wr,e);return}if(d(this,Wr)!==e){if(d(this,Zs).size>0)for(const t of d(this,Zs).values())t.remove(),e.append(t);S(this,Wr,e)}}static get _svgFactory(){return Ve(this,"_svgFactory",new tp)}draw(e,t=!1,n=!1){const r=Ks(Zt,jm)._++,i=k(this,Li,cS).call(this),a=Zt._svgFactory.createElement("defs");i.append(a);const o=Zt._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&d(this,Dc).set(r,o);const u=n?k(this,Li,TR).call(this,a,l):null,h=Zt._svgFactory.createElement("use");return i.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(i,e),d(this,Zs).set(r,i),{id:r,clipPathId:`url(#${u})`}}drawOutline(e,t){const n=Ks(Zt,jm)._++,r=k(this,Li,cS).call(this),i=Zt._svgFactory.createElement("defs");r.append(i);const a=Zt._svgFactory.createElement("path");i.append(a);const o=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const f=Zt._svgFactory.createElement("mask");i.append(f),l=`mask_p${this.pageIndex}_${n}`,f.setAttribute("id",l),f.setAttribute("maskUnits","objectBoundingBox");const p=Zt._svgFactory.createElement("rect");f.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const m=Zt._svgFactory.createElement("use");f.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const u=Zt._svgFactory.createElement("use");r.append(u),u.setAttribute("href",`#${o}`),l&&u.setAttribute("mask",`url(#${l})`);const h=u.cloneNode();return r.append(h),u.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(r,e),d(this,Zs).set(n,r),n}finalizeDraw(e,t){d(this,Dc).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:n,bbox:r,rootClass:i,path:a}=t,o=typeof e=="number"?d(this,Zs).get(e):e;if(o){if(n&&k(this,Li,uS).call(this,o,n),r&&k(l=Zt,Dy,kR).call(l,o,r),i){const{classList:u}=o;for(const[h,f]of Object.entries(i))u.toggle(h,f)}if(a){const h=o.firstChild.firstChild;k(this,Li,uS).call(this,h,a)}}}updateParent(e,t){if(t===this)return;const n=d(this,Zs).get(e);n&&(d(t,Wr).append(n),d(this,Zs).delete(e),d(t,Zs).set(e,n))}remove(e){d(this,Dc).delete(e),d(this,Wr)!==null&&(d(this,Zs).get(e).remove(),d(this,Zs).delete(e))}destroy(){S(this,Wr,null);for(const e of d(this,Zs).values())e.remove();d(this,Zs).clear(),d(this,Dc).clear()}};Wr=new WeakMap,Zs=new WeakMap,Dc=new WeakMap,jm=new WeakMap,Dy=new WeakSet,kR=function(e,[t,n,r,i]){const{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*i}%`},Li=new WeakSet,cS=function(){const e=Zt._svgFactory.create(1,1,!0);return d(this,Wr).append(e),e.setAttribute("aria-hidden",!0),e},TR=function(e,t){const n=Zt._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const i=Zt._svgFactory.createElement("use");return n.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),r},uS=function(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)},A(Zt,Dy),A(Zt,jm,0);let my=Zt;globalThis._pdfjsTestingUtils={HighlightOutliner:Bb};globalThis.pdfjsLib={AbortException:Da,AnnotationEditorLayer:py,AnnotationEditorParamsType:We,AnnotationEditorType:Pe,AnnotationEditorUIManager:Jo,AnnotationLayer:Y_,AnnotationMode:Ci,AnnotationType:Ot,build:TP,ColorPicker:sp,createValidAbsoluteUrl:F_,DOMSVGFactory:tp,DrawLayer:my,FeatureTest:gs,fetchData:vh,getDocument:G_,getFilenameFromUrl:bj,getPdfFilenameFromUrl:Sj,getUuid:U_,getXfaPageViewport:_j,GlobalWorkerOptions:Xr,ImageKind:kf,InvalidPDFException:ly,isDataScheme:Xm,isPdfFile:yv,isValidExplicitDest:nP,MathClamp:$s,noContextMenu:Er,normalizeUnicode:xj,OPS:Yf,OutputScale:ei,PasswordResponses:yj,PDFDataRangeTransport:q_,PDFDateString:vv,PDFWorker:ch,PermissionFlag:gj,PixelsPerInch:Ma,RenderingCancelledException:gv,ResponseException:Jf,setLayerDimensions:Yo,shadow:Ve,SignatureExtractor:Ni,stopEvent:Ut,SupportedImageMimeTypes:cy,TextLayer:Zf,TouchManager:Qf,updateUrlHash:$_,Util:ve,VerbosityLevel:Gm,version:kP,XfaLayer:K_};const $B=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Da,AnnotationEditorLayer:py,AnnotationEditorParamsType:We,AnnotationEditorType:Pe,AnnotationEditorUIManager:Jo,AnnotationLayer:Y_,AnnotationMode:Ci,AnnotationType:Ot,ColorPicker:sp,DOMSVGFactory:tp,DrawLayer:my,FeatureTest:gs,GlobalWorkerOptions:Xr,ImageKind:kf,InvalidPDFException:ly,MathClamp:$s,OPS:Yf,OutputScale:ei,PDFDataRangeTransport:q_,PDFDateString:vv,PDFWorker:ch,PasswordResponses:yj,PermissionFlag:gj,PixelsPerInch:Ma,RenderingCancelledException:gv,ResponseException:Jf,SignatureExtractor:Ni,SupportedImageMimeTypes:cy,TextLayer:Zf,TouchManager:Qf,Util:ve,VerbosityLevel:Gm,XfaLayer:K_,build:TP,createValidAbsoluteUrl:F_,fetchData:vh,getDocument:G_,getFilenameFromUrl:bj,getPdfFilenameFromUrl:Sj,getUuid:U_,getXfaPageViewport:_j,isDataScheme:Xm,isPdfFile:yv,isValidExplicitDest:nP,noContextMenu:Er,normalizeUnicode:xj,setLayerDimensions:Yo,shadow:Ve,stopEvent:Ut,updateUrlHash:$_,version:kP},Symbol.toStringTag,{value:"Module"}));function CR(s){var e,t,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(e=0;e<r;e++)s[e]&&(t=CR(s[e]))&&(n&&(n+=" "),n+=t)}else for(t in s)s[t]&&(n&&(n+=" "),n+=t);return n}function bv(){for(var s,e,t=0,n="",r=arguments.length;t<r;t++)(s=arguments[t])&&(e=CR(s))&&(n&&(n+=" "),n+=e);return n}var _k=Object.prototype.hasOwnProperty;function Ek(s,e,t){for(t of s.keys())if(Wu(t,e))return t}function Wu(s,e){var t,n,r;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((n=s.length)===e.length)for(;n--&&Wu(s[n],e[n]););return n===-1}if(t===Set){if(s.size!==e.size)return!1;for(n of s)if(r=n,r&&typeof r=="object"&&(r=Ek(e,r),!r)||!e.has(r))return!1;return!0}if(t===Map){if(s.size!==e.size)return!1;for(n of s)if(r=n[0],r&&typeof r=="object"&&(r=Ek(e,r),!r)||!Wu(n[1],e.get(r)))return!1;return!0}if(t===ArrayBuffer)s=new Uint8Array(s),e=new Uint8Array(e);else if(t===DataView){if((n=s.byteLength)===e.byteLength)for(;n--&&s.getInt8(n)===e.getInt8(n););return n===-1}if(ArrayBuffer.isView(s)){if((n=s.byteLength)===e.byteLength)for(;n--&&s[n]===e[n];);return n===-1}if(!t||typeof s=="object"){n=0;for(t in s)if(_k.call(s,t)&&++n&&!_k.call(e,t)||!(t in e)||!Wu(s[t],e[t]))return!1;return Object.keys(e).length===n}}return s!==s&&e!==e}function Zm(s){let e=!1;return{promise:new Promise((n,r)=>{s.then(i=>!e&&n(i)).catch(i=>!e&&r(i))}),cancel(){e=!0}}}const UB=["onCopy","onCut","onPaste"],BB=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],HB=["onFocus","onBlur"],VB=["onInput","onInvalid","onReset","onSubmit"],zB=["onLoad","onError"],WB=["onKeyDown","onKeyPress","onKeyUp"],GB=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],qB=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],KB=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],XB=["onSelect"],YB=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],JB=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],QB=["onScroll"],ZB=["onWheel"],eH=["onAnimationStart","onAnimationEnd","onAnimationIteration"],tH=["onTransitionEnd"],sH=["onToggle"],nH=["onChange"],rH=[...UB,...BB,...HB,...VB,...zB,...WB,...GB,...qB,...KB,...XB,...YB,...JB,...QB,...ZB,...eH,...tH,...nH,...sH];function NR(s,e){const t={};for(const n of rH){const r=s[n];r&&(e?t[n]=i=>r(i,e(n)):t[n]=r)}return t}var iH="Invariant failed";function ht(s,e){if(!s)throw new Error(iH)}var aH=function(){},oH=aH;const Bs=Ik(oH),jR=_.createContext(null),lH="noopener noreferrer nofollow";class cH{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return ht(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){ht(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}goToDestination(e){return new Promise(t=>{ht(this.pdfDocument),ht(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{ht(Array.isArray(t));const n=t[0];new Promise(r=>{ht(this.pdfDocument),n instanceof Object?this.pdfDocument.getPageIndex(n).then(i=>{r(i)}).catch(()=>{ht(!1)}):typeof n=="number"?r(n):ht(!1)}).then(r=>{const i=r+1;ht(this.pdfViewer),ht(i>=1&&i<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:r,pageNumber:i})})})}navigateTo(e){this.goToDestination(e)}goToPage(e){const t=e-1;ht(this.pdfViewer),ht(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}addLinkAttributes(e,t,n){e.href=t,e.rel=this.externalLinkRel||lH,e.target=n?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}function Gu({children:s,type:e}){return c.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:s})}const Ak={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function uH(s,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return s}}function uh(){return _.useReducer(uH,{value:void 0,error:void 0})}const Sv=typeof window<"u",PR=Sv&&window.location.protocol==="file:";function dH(s){return typeof s<"u"}function ul(s){return dH(s)&&s!==null}function hH(s){return typeof s=="string"}function fH(s){return s instanceof ArrayBuffer}function pH(s){return ht(Sv),s instanceof Blob}function dS(s){return hH(s)&&/^data:/.test(s)}function kk(s){ht(dS(s));const[e="",t=""]=s.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function mH(){return Sv&&window.devicePixelRatio||1}const RR="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Tk(){Bs(!PR,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${RR}`)}function gH(){Bs(!PR,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${RR}`)}function Gc(s){s!=null&&s.cancel&&s.cancel()}function hS(s,e){return Object.defineProperty(s,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(s,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(s,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(s,"originalHeight",{get(){return this.view[3]},configurable:!0}),s}function yH(s){return s.name==="RenderingCancelledException"}function vH(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{if(!n.result)return t(new Error("Error while reading a file."));e(n.result)},n.onerror=r=>{if(!r.target)return t(new Error("Error while reading a file."));const{error:i}=r.target;if(!i)return t(new Error("Error while reading a file."));switch(i.code){case i.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case i.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case i.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},n.readAsArrayBuffer(s)})}const{PDFDataRangeTransport:xH}=$B,wH=(s,e)=>{switch(e){case Ak.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");s(t);break}case Ak.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");s(t);break}}};function Ck(s){return typeof s=="object"&&s!==null&&("data"in s||"range"in s||"url"in s)}const bH=_.forwardRef(function({children:e,className:t,error:n="Failed to load PDF file.",externalLinkRel:r,externalLinkTarget:i,file:a,inputRef:o,imageResourcesPath:l,loading:u="Loading PDF",noData:h="No PDF file specified.",onItemClick:f,onLoadError:p,onLoadProgress:m,onLoadSuccess:g,onPassword:y=wH,onSourceError:b,onSourceSuccess:v,options:x,renderMode:w,rotate:E,scale:T,...C},N){const[j,P]=uh(),{value:M,error:V}=j,[L,I]=uh(),{value:O,error:X}=L,$=_.useRef(new cH),H=_.useRef([]),D=_.useRef(void 0),F=_.useRef(void 0);a&&a!==D.current&&Ck(a)&&(Bs(!Wu(a,D.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),D.current=a),x&&x!==F.current&&(Bs(!Wu(x,F.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),F.current=x);const q=_.useRef({scrollPageIntoView:Ae=>{const{dest:$e,pageNumber:ie,pageIndex:U=ie-1}=Ae;if(f){f({dest:$e,pageIndex:U,pageNumber:ie});return}const oe=H.current[U];if(oe){oe.scrollIntoView();return}Bs(!1,`An internal link leading to page ${ie} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});_.useImperativeHandle(N,()=>({linkService:$,pages:H,viewer:q}),[]);function J(){v&&v()}function ee(){V&&(Bs(!1,V.toString()),b&&b(V))}function de(){P({type:"RESET"})}_.useEffect(de,[a,P]);const ge=_.useCallback(async()=>{if(!a)return null;if(typeof a=="string")return dS(a)?{data:kk(a)}:(Tk(),{url:a});if(a instanceof xH)return{range:a};if(fH(a))return{data:a};if(Sv&&pH(a))return{data:await vH(a)};if(ht(typeof a=="object"),ht(Ck(a)),"url"in a&&typeof a.url=="string"){if(dS(a.url)){const{url:Ae,...$e}=a;return{data:kk(Ae),...$e}}Tk()}return a},[a]);_.useEffect(()=>{const Ae=Zm(ge());return Ae.promise.then($e=>{P({type:"RESOLVE",value:$e})}).catch($e=>{P({type:"REJECT",error:$e})}),()=>{Gc(Ae)}},[ge,P]),_.useEffect(()=>{if(!(typeof M>"u")){if(M===!1){ee();return}J()}},[M]);function Ce(){O&&(g&&g(O),H.current=new Array(O.numPages),$.current.setDocument(O))}function B(){X&&(Bs(!1,X.toString()),p&&p(X))}_.useEffect(function(){I({type:"RESET"})},[I,M]),_.useEffect(function(){if(!M)return;const $e=x?{...M,...x}:M,ie=G_($e);m&&(ie.onProgress=m),y&&(ie.onPassword=y);const U=ie,oe=U.promise.then(Ue=>{I({type:"RESOLVE",value:Ue})}).catch(Ue=>{U.destroyed||I({type:"REJECT",error:Ue})});return()=>{oe.finally(()=>U.destroy())}},[x,I,M]),_.useEffect(()=>{if(!(typeof O>"u")){if(O===!1){B();return}Ce()}},[O]),_.useEffect(function(){$.current.setViewer(q.current),$.current.setExternalLinkRel(r),$.current.setExternalLinkTarget(i)},[r,i]);const K=_.useCallback((Ae,$e)=>{H.current[Ae]=$e},[]),xe=_.useCallback(Ae=>{delete H.current[Ae]},[]),Re=_.useMemo(()=>({imageResourcesPath:l,linkService:$.current,onItemClick:f,pdf:O,registerPage:K,renderMode:w,rotate:E,scale:T,unregisterPage:xe}),[l,f,O,K,w,E,T,xe]),Se=_.useMemo(()=>NR(C,()=>O),[C,O]);function Ze(){function Ae(ie){return!!(ie!=null&&ie.pdf)}if(!Ae(Re))throw new Error("pdf is undefined");const $e=typeof e=="function"?e(Re):e;return c.jsx(jR.Provider,{value:Re,children:$e})}function lt(){return a?O==null?c.jsx(Gu,{type:"loading",children:typeof u=="function"?u():u}):O===!1?c.jsx(Gu,{type:"error",children:typeof n=="function"?n():n}):Ze():c.jsx(Gu,{type:"no-data",children:typeof h=="function"?h():h})}return c.jsx("div",{className:bv("react-pdf__Document",t),ref:o,...Se,children:lt()})});function LR(){return _.useContext(jR)}function DR(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var t=s.filter(Boolean);if(t.length<=1){var n=t[0];return n||null}return function(i){for(var a=0,o=t;a<o.length;a++){var l=o[a];typeof l=="function"?l(i):l&&(l.current=i)}}}const MR=_.createContext(null);function _v(){return _.useContext(MR)}function SH(){const s=LR(),e=_v();ht(e);const t={...s,...e},{imageResourcesPath:n,linkService:r,onGetAnnotationsError:i,onGetAnnotationsSuccess:a,onRenderAnnotationLayerError:o,onRenderAnnotationLayerSuccess:l,page:u,pdf:h,renderForms:f,rotate:p,scale:m=1}=t;ht(h),ht(u),ht(r);const[g,y]=uh(),{value:b,error:v}=g,x=_.useRef(null);Bs(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function w(){b&&a&&a(b)}function E(){v&&(Bs(!1,v.toString()),i&&i(v))}_.useEffect(function(){y({type:"RESET"})},[y,u]),_.useEffect(function(){if(!u)return;const P=Zm(u.getAnnotations()),M=P;return P.promise.then(V=>{y({type:"RESOLVE",value:V})}).catch(V=>{y({type:"REJECT",error:V})}),()=>{Gc(M)}},[y,u]),_.useEffect(()=>{if(b!==void 0){if(b===!1){E();return}w()}},[b]);function T(){l&&l()}function C(j){Bs(!1,`${j}`),o&&o(j)}const N=_.useMemo(()=>u.getViewport({scale:m,rotation:p}),[u,p,m]);return _.useEffect(function(){if(!h||!u||!r||!b)return;const{current:P}=x;if(!P)return;const M=N.clone({dontFlip:!0}),V={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:P,l10n:null,page:u,structTreeLayer:null,viewport:M},L={annotations:b,annotationStorage:h.annotationStorage,div:P,imageResourcesPath:n,linkService:r,page:u,renderForms:f,viewport:M};P.innerHTML="";try{new Y_(V).render(L),T()}catch(I){C(I)}return()=>{}},[b,n,r,u,h,f,N]),c.jsx("div",{className:bv("react-pdf__Page__annotations","annotationLayer"),ref:x})}const IR={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},_H=/^H(\d+)$/;function EH(s){return s in IR}function Ev(s){return"children"in s}function OR(s){return Ev(s)?s.children.length===1&&0 in s.children&&"id"in s.children[0]:!1}function AH(s){const e={};if(Ev(s)){const{role:t}=s,n=t.match(_H);if(n)e.role="heading",e["aria-level"]=Number(n[1]);else if(EH(t)){const r=IR[t];r&&(e.role=r)}}return e}function FR(s){const e={};if(Ev(s)){if(s.alt!==void 0&&(e["aria-label"]=s.alt),s.lang!==void 0&&(e.lang=s.lang),OR(s)){const[t]=s.children;if(t){const n=FR(t);return{...e,...n}}}}else"id"in s&&(e["aria-owns"]=s.id);return e}function kH(s){return s?{...AH(s),...FR(s)}:null}function $R({className:s,node:e}){const t=_.useMemo(()=>kH(e),[e]),n=_.useMemo(()=>!Ev(e)||OR(e)?null:e.children.map((r,i)=>c.jsx($R,{node:r},i)),[e]);return c.jsx("span",{className:s,...t,children:n})}function TH(){const s=_v();ht(s);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=s,[n,r]=uh(),{value:i,error:a}=n,{customTextRenderer:o,page:l}=s;function u(){i&&t&&t(i)}function h(){a&&(Bs(!1,a.toString()),e&&e(a))}return _.useEffect(function(){r({type:"RESET"})},[r,l]),_.useEffect(function(){if(o||!l)return;const p=Zm(l.getStructTree()),m=p;return p.promise.then(g=>{r({type:"RESOLVE",value:g})}).catch(g=>{r({type:"REJECT",error:g})}),()=>Gc(m)},[o,l,r]),_.useEffect(()=>{if(i!==void 0){if(i===!1){h();return}u()}},[i]),i?c.jsx($R,{className:"react-pdf__Page__structTree structTree",node:i}):null}const Nk=Ci;function CH(s){const e=_v();ht(e);const t={...e,...s},{_className:n,canvasBackground:r,devicePixelRatio:i=mH(),onRenderError:a,onRenderSuccess:o,page:l,renderForms:u,renderTextLayer:h,rotate:f,scale:p}=t,{canvasRef:m}=s;ht(l);const g=_.useRef(null);function y(){l&&o&&o(hS(l,p))}function b(E){yH(E)||(Bs(!1,E.toString()),a&&a(E))}const v=_.useMemo(()=>l.getViewport({scale:p*i,rotation:f}),[i,l,f,p]),x=_.useMemo(()=>l.getViewport({scale:p,rotation:f}),[l,f,p]);_.useEffect(function(){if(!l)return;l.cleanup();const{current:T}=g;if(!T)return;T.width=v.width,T.height=v.height,T.style.width=`${Math.floor(x.width)}px`,T.style.height=`${Math.floor(x.height)}px`,T.style.visibility="hidden";const C={annotationMode:u?Nk.ENABLE_FORMS:Nk.ENABLE,canvasContext:T.getContext("2d",{alpha:!1}),viewport:v};r&&(C.background=r);const N=l.render(C),j=N;return N.promise.then(()=>{T.style.visibility="",y()}).catch(b),()=>Gc(j)},[r,l,u,v,x]);const w=_.useCallback(()=>{const{current:E}=g;E&&(E.width=0,E.height=0)},[]);return _.useEffect(()=>w,[w]),c.jsx("canvas",{className:`${n}__canvas`,dir:"ltr",ref:DR(m,g),style:{display:"block",userSelect:"none"},children:h?c.jsx(TH,{}):null})}function NH(s){return"str"in s}function jH(){const s=_v();ht(s);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:n,onRenderTextLayerError:r,onRenderTextLayerSuccess:i,page:a,pageIndex:o,pageNumber:l,rotate:u,scale:h}=s;ht(a);const[f,p]=uh(),{value:m,error:g}=f,y=_.useRef(null);Bs(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function b(){m&&n&&n(m)}function v(){g&&(Bs(!1,g.toString()),t&&t(g))}_.useEffect(function(){p({type:"RESET"})},[a,p]),_.useEffect(function(){if(!a)return;const j=Zm(a.getTextContent()),P=j;return j.promise.then(M=>{p({type:"RESOLVE",value:M})}).catch(M=>{p({type:"REJECT",error:M})}),()=>Gc(P)},[a,p]),_.useEffect(()=>{if(m!==void 0){if(m===!1){v();return}b()}},[m]);const x=_.useCallback(()=>{i&&i()},[i]),w=_.useCallback(N=>{Bs(!1,N.toString()),r&&r(N)},[r]);function E(){const N=y.current;N&&N.classList.add("selecting")}function T(){const N=y.current;N&&N.classList.remove("selecting")}const C=_.useMemo(()=>a.getViewport({scale:h,rotation:u}),[a,u,h]);return _.useLayoutEffect(function(){if(!a||!m)return;const{current:j}=y;if(!j)return;j.innerHTML="";const P=a.streamTextContent({includeMarkedContent:!0}),M={container:j,textContentSource:P,viewport:C},V=new Zf(M),L=V;return V.render().then(()=>{const I=document.createElement("div");I.className="endOfContent",j.append(I);const O=j.querySelectorAll('[role="presentation"]');if(e){let X=0;m.items.forEach(($,H)=>{if(!NH($))return;const D=O[X];if(!D)return;const F=e({pageIndex:o,pageNumber:l,itemIndex:H,...$});D.innerHTML=F,X+=$.str&&$.hasEOL?2:1})}x()}).catch(w),()=>Gc(L)},[e,w,x,a,o,l,m,C]),c.jsx("div",{className:bv("react-pdf__Page__textContent","textLayer"),onMouseUp:T,onMouseDown:E,ref:y})}const jk=1;function PH(s){const t={...LR(),...s},{_className:n="react-pdf__Page",_enableRegisterUnregisterPage:r=!0,canvasBackground:i,canvasRef:a,children:o,className:l,customRenderer:u,customTextRenderer:h,devicePixelRatio:f,error:p="Failed to load the page.",height:m,inputRef:g,loading:y="Loading page",noData:b="No page specified.",onGetAnnotationsError:v,onGetAnnotationsSuccess:x,onGetStructTreeError:w,onGetStructTreeSuccess:E,onGetTextError:T,onGetTextSuccess:C,onLoadError:N,onLoadSuccess:j,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:M,onRenderError:V,onRenderSuccess:L,onRenderTextLayerError:I,onRenderTextLayerSuccess:O,pageIndex:X,pageNumber:$,pdf:H,registerPage:D,renderAnnotationLayer:F=!0,renderForms:q=!1,renderMode:J="canvas",renderTextLayer:ee=!0,rotate:de,scale:ge=jk,unregisterPage:Ce,width:B,...K}=t,[xe,Re]=uh(),{value:Se,error:Ze}=xe,lt=_.useRef(null);ht(H);const Ae=ul($)?$-1:X??null,$e=$??(ul(X)?X+1:null),ie=de??(Se?Se.rotate:null),U=_.useMemo(()=>{if(!Se)return null;let ct=1;const Ws=ge??jk;if(B||m){const vs=Se.getViewport({scale:1,rotation:ie});B?ct=B/vs.width:m&&(ct=m/vs.height)}return Ws*ct},[m,Se,ie,ge,B]);_.useEffect(function(){return()=>{ul(Ae)&&r&&Ce&&Ce(Ae)}},[r,H,Ae,Ce]);function oe(){if(j){if(!Se||!U)return;j(hS(Se,U))}if(r&&D){if(!ul(Ae)||!lt.current)return;D(Ae,lt.current)}}function Ue(){Ze&&(Bs(!1,Ze.toString()),N&&N(Ze))}_.useEffect(function(){Re({type:"RESET"})},[Re,H,Ae]),_.useEffect(function(){if(!H||!$e)return;const Ws=Zm(H.getPage($e)),vs=Ws;return Ws.promise.then(is=>{Re({type:"RESOLVE",value:is})}).catch(is=>{Re({type:"REJECT",error:is})}),()=>Gc(vs)},[Re,H,$e]),_.useEffect(()=>{if(Se!==void 0){if(Se===!1){Ue();return}oe()}},[Se,U]);const hn=_.useMemo(()=>ul(Ae)&&$e&&ul(ie)&&ul(U)?{_className:n,canvasBackground:i,customTextRenderer:h,devicePixelRatio:f,onGetAnnotationsError:v,onGetAnnotationsSuccess:x,onGetStructTreeError:w,onGetStructTreeSuccess:E,onGetTextError:T,onGetTextSuccess:C,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:M,onRenderError:V,onRenderSuccess:L,onRenderTextLayerError:I,onRenderTextLayerSuccess:O,page:Se,pageIndex:Ae,pageNumber:$e,renderForms:q,renderTextLayer:ee,rotate:ie,scale:U}:null,[n,i,h,f,v,x,w,E,T,C,P,M,V,L,I,O,Se,Ae,$e,q,ee,ie,U]),ys=_.useMemo(()=>NR(K,()=>Se&&(U?hS(Se,U):void 0)),[K,Se,U]),Vs=`${Ae}@${U}/${ie}`;function Ar(){switch(J){case"custom":return ht(u),c.jsx(u,{},`${Vs}_custom`);case"none":return null;case"canvas":default:return c.jsx(CH,{canvasRef:a},`${Vs}_canvas`)}}function tr(){return ee?c.jsx(jH,{},`${Vs}_text`):null}function zs(){return F?c.jsx(SH,{},`${Vs}_annotations`):null}function kr(){function ct(vs){return!!(vs!=null&&vs.page)}if(!ct(hn))throw new Error("page is undefined");const Ws=typeof o=="function"?o(hn):o;return c.jsxs(MR.Provider,{value:hn,children:[Ar(),tr(),zs(),Ws]})}function Cn(){return $e?H===null||Se===void 0||Se===null?c.jsx(Gu,{type:"loading",children:typeof y=="function"?y():y}):H===!1||Se===!1?c.jsx(Gu,{type:"error",children:typeof p=="function"?p():p}):kr():c.jsx(Gu,{type:"no-data",children:typeof b=="function"?b():b})}return c.jsx("div",{className:bv(n,l),"data-page-number":$e,ref:DR(g,lt),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${U}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:i||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...ys,children:Cn()})}gH();Xr.workerSrc="pdf.worker.mjs";function RH({file:s,onClose:e}){var b;console.log(" [PDF_VIEWER] Received file:",s),console.log(" [PDF_VIEWER] File URL:",s.url),console.log(" [PDF_VIEWER] File URL type:",typeof s.url),console.log(" [PDF_VIEWER] File URL length:",(b=s.url)==null?void 0:b.length);const[t,n]=_.useState(null),[r,i]=_.useState(1),[a,o]=_.useState(1),[l,u]=_.useState(!0),[h,f]=_.useState(null),[p,m]=_.useState(!1),g=({numPages:v})=>{n(v),u(!1)},y=v=>{console.error(" [PDF_VIEWER] Document load error:",v),console.error(" [PDF_VIEWER] File URL was:",s.url),console.error(" [PDF_VIEWER] Error details:",{message:v.message,name:v.name,stack:v.stack}),v.message.includes("worker")||v.message.includes("fake worker")?(console.log(" [PDF_VIEWER] PDF.js failed, trying iframe fallback"),m(!0),f(null),u(!1)):(f(`Failed to load PDF: ${v.message}`),u(!1))};return s.url?p?(console.log(" [PDF_VIEWER] Rendering iframe fallback"),c.jsxs("div",{className:"pdf-viewer-container",children:[c.jsxs("div",{className:"pdf-controls bg-gray-100 p-2 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"PDF Viewer (iframe)"}),c.jsx("button",{onClick:()=>m(!1),className:"btn-secondary text-sm",children:"Try PDF.js Again"})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"btn-primary text-sm",children:"Open in New Tab"})})]}),c.jsx("div",{className:"pdf-content bg-white",style:{height:"70vh"},children:c.jsx("iframe",{src:s.url,width:"100%",height:"100%",style:{border:"none"},title:`PDF: ${s.display_name}`,onError:()=>{console.error(" [PDF_VIEWER] Iframe also failed to load"),f("Failed to load PDF in both PDF.js and iframe")}})})]})):h?c.jsx("div",{className:"pdf-viewer-container p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-red-600 mb-4",children:h}),c.jsxs("div",{className:"space-x-2",children:[c.jsx("button",{onClick:()=>m(!0),className:"btn-secondary",children:"Try iframe"}),c.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"btn-primary",children:"Download PDF"})]})]})}):c.jsxs("div",{className:"pdf-viewer-container",children:[c.jsxs("div",{className:"pdf-controls bg-gray-100 p-2 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>i(v=>Math.max(1,v-1)),disabled:r<=1,className:"btn-secondary text-sm",children:"Previous"}),c.jsxs("span",{className:"text-sm text-gray-600",children:[r," of ",t||"?"]}),c.jsx("button",{onClick:()=>i(v=>Math.min(t||1,v+1)),disabled:r>=(t||1),className:"btn-secondary text-sm",children:"Next"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>o(v=>Math.max(.5,v-.1)),className:"btn-secondary text-sm",children:"Zoom Out"}),c.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(a*100),"%"]}),c.jsx("button",{onClick:()=>o(v=>Math.min(2,v+.1)),className:"btn-secondary text-sm",children:"Zoom In"})]})]}),c.jsx("div",{className:"pdf-content bg-white p-4 overflow-auto",style:{maxHeight:"70vh"},children:c.jsx(bH,{file:s.url,onLoadSuccess:g,onLoadError:y,loading:c.jsx("div",{className:"text-center p-8",children:"Loading PDF..."}),children:c.jsx(PH,{pageNumber:r,scale:a,renderTextLayer:!0,renderAnnotationLayer:!0})})})]}):(console.error(" [PDF_VIEWER] No file URL provided"),c.jsx("div",{className:"pdf-viewer-container p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-red-600 mb-4",children:"No file URL provided"}),c.jsx("button",{onClick:e,className:"btn-primary",children:"Close"})]})}))}function LH({file:s,onClose:e}){const[t,n]=_.useState(!1),[r,i]=_.useState(!1),a=`https://docs.google.com/gview?url=${encodeURIComponent(s.url)}&embedded=true`;return c.jsx("div",{className:"word-viewer-container",children:!t&&!r?c.jsx("div",{className:"relative",children:c.jsx("iframe",{src:a,width:"100%",height:"600px",style:{border:"none"},onError:()=>n(!0),onLoad:()=>{setTimeout(()=>{t||i(!0)},1e4)},title:`Preview of ${s.display_name}`})}):c.jsxs("div",{className:"fallback-viewer p-8 text-center",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),c.jsx("p",{className:"text-gray-600 mb-4",children:"Document preview not available"}),c.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Please download the document to view it"}),c.jsx("button",{onClick:async()=>{try{const o=await fetch(s.url);if(!o.ok)throw new Error(`Download failed: ${o.status}`);const l=await o.blob(),u=URL.createObjectURL(l),h=document.createElement("a");h.href=u,h.download=s.display_name||s.original_name,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u)}catch(o){console.error("Download failed:",o),alert("Download failed: "+o.message)}},className:"btn-primary",children:"Download Document"})]})})}const DH=({isOpen:s,onClose:e,title:t,children:n,size:r="md",showCloseButton:i=!0})=>{const a={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-6xl"};return s?c.jsx(cn,{children:c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e,children:c.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:`bg-white rounded-lg shadow-xl w-full ${a[r]} max-h-[90vh] overflow-y-auto`,onClick:o=>o.stopPropagation(),children:[(t||i)&&c.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[t&&c.jsx("h3",{className:"text-lg font-semibold text-neutral-800",children:t}),i&&c.jsx("button",{onClick:e,className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"p-6",children:n})]})})}):null};function UR({file:s,isOpen:e,onClose:t}){const n=a=>{var o;return((o=a.split(".").pop())==null?void 0:o.toLowerCase())||""},r=()=>s.url?s.url:s.cloudinary_url?s.cloudinary_url:"",i=()=>{const a=n(s.original_name||s.display_name),o=r(),l={...s,url:o};switch(a){case"pdf":return c.jsx(RH,{file:l,onClose:t});case"docx":case"doc":return c.jsx(LH,{file:l,onClose:t});case"jpg":case"jpeg":case"png":case"gif":case"webp":return c.jsx("div",{className:"image-viewer text-center",children:c.jsx("img",{src:o,alt:s.display_name,className:"max-w-full max-h-96 mx-auto",style:{maxHeight:"70vh"}})});case"mp3":case"wav":case"ogg":return c.jsx("div",{className:"audio-viewer text-center p-8",children:c.jsxs("audio",{controls:!0,className:"w-full max-w-md mx-auto",children:[c.jsx("source",{src:o,type:`audio/${a}`}),"Your browser does not support the audio element."]})});default:return c.jsxs("div",{className:"unsupported-file text-center p-8",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),c.jsx("p",{className:"text-gray-600 mb-4",children:"File type not supported for preview"}),c.jsx("button",{onClick:async()=>{try{const u=await fetch(o);if(!u.ok)throw new Error(`Download failed: ${u.status}`);const h=await u.blob(),f=URL.createObjectURL(h),p=document.createElement("a");p.href=f,p.download=s.display_name||s.original_name,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(f)}catch(u){console.error("Download failed:",u),alert("Download failed: "+u.message)}},className:"btn-primary",children:"Download File"})]})}};return e?c.jsx(DH,{isOpen:e,onClose:t,title:s.display_name,size:"xl",children:i()}):null}const MH=()=>{const[s,e]=_.useState("files"),[t,n]=_.useState([]),[r,i]=_.useState([]),[a,o]=_.useState(null),[l,u]=_.useState(null),[h,f]=_.useState(!0),[p,m]=_.useState(""),[g,y]=_.useState(""),[b,v]=_.useState(null),[x,w]=_.useState(!1);_.useEffect(()=>{E()},[]);const E=async()=>{try{f(!0);const[D,F]=await Promise.all([se.getFolders(),se.getFiles()]);D.success&&n(D.folders),F.success&&i(F.files)}catch(D){console.error("Error fetching file data:",D)}finally{f(!1)}},T=async D=>{console.log(" [FILE_SHARING] Folder selected:",D),o(D),await C(D)},C=async D=>{try{const F=await se.getFiles({folder_id:D});console.log(" [FILE_SHARING] Files response for folder",D,":",F),F.success&&(i(F.files),console.log(" [FILE_SHARING] Files updated:",F.files))}catch(F){console.error("Error fetching folder files:",F)}},N=async D=>{console.log(" [FILE_SHARING] Current folder changed to:",D),o(D),u(D),await C(D)},j=async()=>{try{const D={};p&&(D.search=p),g&&(D.file_type=g),a&&(D.folder_id=a);const F=await se.getFiles(D);F.success&&i(F.files)}catch(D){console.error("Error searching files:",D)}},P=D=>{console.log(" [FILE_SHARING] Adding new file to list:",D),i(F=>{const q=[D,...F];return console.log(" [FILE_SHARING] Updated file list:",q),q})},M=async D=>{console.log(" [FILE_SHARING] File selected for viewing:",D),console.log(" [FILE_SHARING] File cloudinary_url:",D.cloudinary_url),console.log(" [FILE_SHARING] File supabase_path:",D.supabase_path);try{if(D.supabase_path){console.log(" [FILE_SHARING] Getting signed URL for Supabase file");const F=await se.getFileViewUrl(D.id);if(console.log(" [FILE_SHARING] API response:",F),F.success){const q={...D,url:F.viewUrl,display_name:F.fileName,original_name:F.fileName};console.log(" [FILE_SHARING] Setting selectedFile with signed URL:",q),v(q)}else console.error("Failed to get file view URL:",F.error),alert("Failed to load file preview: "+F.error),v(null)}else console.log(" [FILE_SHARING] Using Cloudinary URL for file"),v(D)}catch(F){console.error("Failed to get file URL:",F),alert("Failed to load file preview: "+F.message),v(null)}};_.useEffect(()=>{console.log(" [FILE_SHARING] Files state updated:",r)},[r]),_.useEffect(()=>{console.log(" [FILE_SHARING] selectedFile state updated:",b)},[b]);const V=D=>{i(F=>F.map(q=>q.id===D.id?D:q))},L=async D=>{try{console.log(" [FILE_SHARING] Deleting file:",D);const F=await se.deleteFile(D.id);F.success?(console.log(" [FILE_SHARING] File deleted successfully"),i(q=>q.filter(J=>J.id!==D.id))):(console.error(" [FILE_SHARING] Failed to delete file:",F.error),alert("Failed to delete file: "+(F.error||"Unknown error")))}catch(F){console.error(" [FILE_SHARING] Error deleting file:",F),alert("Error deleting file: "+F.message)}},I=async D=>{try{console.log(" [FILE_SHARING] Moving file:",D);const F=await O(D);if(F!==null&&F!==D.folder_id){const q=await se.updateFile(D.id,{folder_id:F});q.success?(console.log(" [FILE_SHARING] File moved successfully"),i(J=>J.map(ee=>ee.id===D.id?{...ee,folder_id:F}:ee))):(console.error(" [FILE_SHARING] Failed to move file:",q.error),alert("Failed to move file: "+(q.error||"Unknown error")))}}catch(F){console.error(" [FILE_SHARING] Error moving file:",F),alert("Error moving file: "+F.message)}},O=D=>new Promise(F=>{const q=document.createElement("div");q.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",q.innerHTML=`
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
          <h3 class="text-lg font-semibold mb-4">Move "${D.display_name}" to:</h3>
          <div class="space-y-2 mb-4 max-h-60 overflow-y-auto">
            <button class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded border-2 border-dashed border-gray-300" data-folder-id="null">
               Root Folder
            </button>
            ${t.map(J=>`
              <button class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded" data-folder-id="${J.id}">
                 ${J.name}
              </button>
            `).join("")}
          </div>
          <div class="flex justify-end space-x-2">
            <button id="cancel-move" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">
              Cancel
            </button>
          </div>
        </div>
      `,document.body.appendChild(q),q.addEventListener("click",J=>{if(J.target.dataset.folderId!==void 0){const ee=J.target.dataset.folderId==="null"?null:parseInt(J.target.dataset.folderId);document.body.removeChild(q),F(ee)}else J.target.id==="cancel-move"&&(document.body.removeChild(q),F(null))})}),X=D=>{n(F=>F.map(q=>q.id===D.id?D:q))},$=D=>{n(F=>F.filter(q=>q.id!==D)),a===D&&(o(null),E())},H=D=>{n(F=>[D,...F])};return h?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-full overflow-hidden h-[calc(100vh-8rem)] flex flex-col",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center p-3 border-b border-gray-200",children:[c.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-800",children:"File Sharing"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>w(!x),className:"lg:hidden p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),c.jsxs("div",{className:"flex space-x-1 overflow-x-auto",children:[c.jsx("button",{onClick:()=>e("files"),className:`px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200 whitespace-nowrap ${s==="files"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Files"}),c.jsx("button",{onClick:()=>e("folders"),className:`px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200 whitespace-nowrap ${s==="folders"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Folders"})]})]})]}),s==="files"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:`
            ${x?"translate-x-0":"-translate-x-full lg:translate-x-0"}
            fixed lg:relative inset-y-0 left-0 z-40
            w-64 lg:w-64 flex-shrink-0 border-r border-gray-200 bg-white
            transition-transform duration-300 ease-in-out
            lg:transition-none
          `,children:c.jsx(tk,{folders:t,files:r,selectedFolder:a,onFolderSelect:T,onFolderCreate:H,onFolderUpdate:X,onFolderDelete:$,onSubfolderCreate:H,onCurrentFolderChange:N,onFileUpdate:V,onFileDelete:L,onFileMove:I,onFileSelect:M,onFileUpload:P})}),x&&c.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>w(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[c.jsx("div",{className:"p-2 sm:p-3 border-b border-gray-200 bg-gray-50",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[c.jsx("div",{className:"flex-1 min-w-0",children:c.jsx("input",{type:"text",placeholder:"Search files...",value:p,onChange:D=>m(D.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",onKeyPress:D=>D.key==="Enter"&&j()})}),c.jsx("div",{className:"w-full sm:w-32 md:w-40",children:c.jsxs("select",{value:g,onChange:D=>y(D.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",children:[c.jsx("option",{value:"",children:"All types"}),c.jsxs("optgroup",{label:"Documents",children:[c.jsx("option",{value:"pdf",children:"PDF"}),c.jsx("option",{value:"doc",children:"DOC"}),c.jsx("option",{value:"docx",children:"DOCX"}),c.jsx("option",{value:"txt",children:"TXT"}),c.jsx("option",{value:"xls",children:"XLS"}),c.jsx("option",{value:"xlsx",children:"XLSX"}),c.jsx("option",{value:"ppt",children:"PPT"}),c.jsx("option",{value:"pptx",children:"PPTX"})]}),c.jsxs("optgroup",{label:"Images",children:[c.jsx("option",{value:"jpg",children:"JPG"}),c.jsx("option",{value:"png",children:"PNG"}),c.jsx("option",{value:"gif",children:"GIF"}),c.jsx("option",{value:"webp",children:"WEBP"}),c.jsx("option",{value:"svg",children:"SVG"})]}),c.jsxs("optgroup",{label:"Audio",children:[c.jsx("option",{value:"mp3",children:"MP3"}),c.jsx("option",{value:"wav",children:"WAV"}),c.jsx("option",{value:"ogg",children:"OGG"}),c.jsx("option",{value:"m4a",children:"M4A"}),c.jsx("option",{value:"aac",children:"AAC"}),c.jsx("option",{value:"flac",children:"FLAC"})]}),c.jsxs("optgroup",{label:"Archives",children:[c.jsx("option",{value:"zip",children:"ZIP"}),c.jsx("option",{value:"rar",children:"RAR"})]})]})}),c.jsx("button",{onClick:j,className:"px-3 sm:px-4 py-1 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200 text-xs sm:text-sm whitespace-nowrap",children:"Search"})]})}),c.jsx("div",{className:"flex-1 overflow-hidden p-2 sm:p-4",children:(console.log(" [FILE_SHARING] Rendering preview area, selectedFile:",b),b?c.jsx("div",{className:"h-full",children:c.jsx(UR,{file:b,isOpen:!0,onClose:()=>v(null),showAsInline:!0})}):c.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:c.jsxs("div",{className:"text-center px-4",children:[c.jsx("div",{className:"text-4xl sm:text-6xl mb-4",children:""}),c.jsx("div",{className:"text-base sm:text-lg font-medium",children:"File Preview Area"}),c.jsx("div",{className:"text-xs sm:text-sm",children:"Click on a file in the folder tree to preview it here"})]})}))})]})]}),s==="folders"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 overflow-hidden",children:c.jsx(tk,{folders:t,selectedFolder:a,onFolderSelect:T,onFolderCreate:H,onFolderUpdate:X,onFileUpdate:V,onFileDelete:L,onFileMove:I,onFolderDelete:$,onSubfolderCreate:H,onFileSelect:M})})]})},IH=()=>{const{user:s,logout:e}=Fm(),[t,n]=_.useState(null),[r,i]=_.useState(null),[a,o]=_.useState(()=>{const j=$c();return console.log(" [AdminPage] Initial currentWeek:",j),j}),[l,u]=_.useState("schedule"),[h,f]=_.useState(!1),[p,m]=_.useState(null),[g,y]=_.useState(!1),b=j=>{n(j)},v=j=>{i(j)},x=j=>{console.log(" [AdminPage] handleWeekChange called with:",j),console.log(" [AdminPage] Previous currentWeek:",a),o(j),console.log(" [AdminPage] New currentWeek set to:",j)},w=j=>{ks.hasUnsavedChanges()?(m(j),f(!0)):u(j)},E=async()=>{console.log(" [ADMIN_SAVE] Save button clicked, processing draft...");try{y(!0);const j=ks.getDraftChanges();if(console.log(" [ADMIN_SAVE] Draft data:",j),!j)return;console.log(" [ADMIN_SAVE] Processing additions:",j.additions.length);for(const P of j.additions)console.log(" [ADMIN_SAVE] Addition weekStart:",P.weekStart),console.log(" [ADMIN_SAVE] Calling createSchedule with:",{student_id:P.studentId,teacher_id:P.teacherId,day_of_week:P.dayOfWeek,time_slot:P.timeSlot,week_start_date:P.weekStart}),await se.createSchedule({student_id:P.studentId,teacher_id:P.teacherId,day_of_week:P.dayOfWeek,time_slot:P.timeSlot,week_start_date:P.weekStart}),console.log(" [ADMIN_SAVE] createSchedule completed for addition");for(const P of j.deletions)await se.deleteSchedule(P.scheduleId);ks.clearDraftChanges(),console.log(" [ADMIN_PAGE] Changes saved successfully")}catch(j){console.error(" [ADMIN_PAGE] Failed to save changes:",j),alert("Failed to save changes. Please try again.")}finally{y(!1)}},T=()=>{ks.clearDraftChanges(),console.log(" [ADMIN_PAGE] Changes discarded")},C=j=>{j==="save"?E().then(()=>{u(p),m(null)}):j==="discard"&&(T(),u(p),m(null)),f(!1)},N=j=>{if(l==="schedule"&&!t&&j.length>0){const P=j[0];n(P),console.log(" [ADMIN_PAGE] Auto-selected first teacher:",P.name)}};return c.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-neutral-200",children:c.jsx("div",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8",children:c.jsxs("div",{className:"flex justify-between items-center h-16",children:[c.jsx("div",{className:"flex items-center",children:c.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-neutral-800",children:"RioTalk Admin Page"})}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("span",{className:"text-xs sm:text-sm text-neutral-600",children:["Welcome, ",(s==null?void 0:s.teacher_name)||(s==null?void 0:s.username),". Let's talk!"]}),c.jsx("button",{onClick:e,className:"btn-secondary text-xs sm:text-sm",children:"Logout"})]})]})})}),c.jsxs("main",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8",children:[c.jsx("div",{className:"flex space-x-1 sm:space-x-2 mb-3 sm:mb-4 md:mb-6",children:[{id:"schedule",label:"Schedule Management",shortLabel:"Schedule"},{id:"teachers",label:"Teachers",shortLabel:"Teachers"},{id:"students",label:"Students",shortLabel:"Students"},{id:"content",label:"Content Management",shortLabel:"Content"},{id:"files",label:"File Sharing",shortLabel:"Files"}].map(j=>c.jsxs("button",{onClick:()=>w(j.id),className:`flex-1 sm:flex-none px-1 sm:px-3 md:px-4 py-1 sm:py-1.5 md:py-2 rounded text-xs sm:text-sm md:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l===j.id?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[c.jsx("span",{className:"sm:hidden",children:j.shortLabel}),c.jsx("span",{className:"hidden sm:inline",children:j.label})]},j.id))}),l==="schedule"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsx(r$,{onTeacherSelect:b,selectedTeacher:t,onTeachersLoaded:N}),c.jsx(S$,{teacherId:t==null?void 0:t.id,weekStart:a,onWeekChange:x})]}),l==="teachers"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(j$,{onTeacherSelect:b,selectedTeacher:t})}),l==="students"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(N$,{onStudentSelect:v,selectedStudent:r})}),l==="content"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(L$,{})}),l==="files"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(MH,{})})]}),c.jsx(B2,{isOpen:h,onClose:()=>f(!1),onSave:()=>C("save"),onDiscard:()=>C("discard"),pendingAction:p?`Switch to ${p} tab`:null,changesSummary:ks.getChangesSummary()})]})},OH=({folders:s,selectedFolder:e,onFolderSelect:t})=>{const[n,r]=_.useState(new Set),i=u=>{r(h=>{const f=new Set(h);return f.has(u)?f.delete(u):f.add(u),f})},a=()=>s.filter(u=>!u.parent_id),o=u=>s.filter(h=>h.parent_id===u),l=(u,h=0)=>{const f=n.has(u.id),p=o(u.id),m=p.length>0;return c.jsxs("div",{className:"select-none",children:[c.jsxs("div",{className:`flex items-center py-2 px-3 sm:py-1 sm:px-2 hover:bg-gray-100 rounded cursor-pointer text-base sm:text-sm ${e===u.id?"bg-blue-100 text-blue-700":"text-gray-700"}`,style:{paddingLeft:`${h*16+8}px`},onClick:()=>t(u.id),children:[m?c.jsx("button",{onClick:g=>{g.stopPropagation(),i(u.id)},className:"mr-1 w-5 h-5 sm:w-4 sm:h-4 flex items-center justify-center",children:c.jsx(Q.svg,{className:"w-4 h-4 sm:w-3 sm:h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:f?90:0},transition:{duration:.2},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):c.jsx("div",{className:"w-5 h-5 sm:w-4 sm:h-4 mr-1"}),c.jsx("svg",{className:"w-5 h-5 sm:w-4 sm:h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1 truncate",children:u.name})]}),c.jsx(cn,{children:f&&m&&c.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:p.map(g=>l(g,h+1))})})]},u.id)};return c.jsxs("div",{className:"h-full flex flex-col bg-gray-50 border-r border-gray-200",children:[c.jsx("div",{className:"p-3 border-b border-gray-200",children:c.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"File Library"})}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[c.jsxs("div",{className:`flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm ${e===null?"bg-blue-100 text-blue-700":"text-gray-700"}`,onClick:()=>t(null),children:[c.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1",children:"All Files"})]}),a().map(u=>l(u))]})]})},FH=()=>{const[s,e]=_.useState([]),[t,n]=_.useState([]),[r,i]=_.useState(!0),[a,o]=_.useState(""),[l,u]=_.useState(""),[h,f]=_.useState(null),[p,m]=_.useState("name"),[g,y]=_.useState(null),[b,v]=_.useState(!1),[x,w]=_.useState(!1);_.useEffect(()=>{E()},[]);const E=async()=>{try{i(!0);const[L,I]=await Promise.all([se.getPublicFiles(),se.getFolders()]);L.success&&e(L.files),I.success&&n(I.folders)}catch(L){console.error("Error fetching data:",L)}finally{i(!1)}},T=()=>{},C=L=>new Date(L).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),N=L=>[...L].sort((I,O)=>{switch(p){case"name":return I.display_name.localeCompare(O.display_name);case"date":return new Date(O.created_at)-new Date(I.created_at);case"size":return O.file_size-I.file_size;case"downloads":return(O.download_count||0)-(I.download_count||0);default:return 0}}),j=async L=>{try{console.log(" [FILE_LIBRARY] Starting download for file:",L.id);let I,O;if(L.supabase_path){console.log(" [FILE_LIBRARY] Getting signed URL for Supabase file");const F=await se.downloadFile(L.id);if(!F.success)throw new Error(F.error||"Failed to get download URL");I=F.downloadUrl,O=F.fileName,console.log(" [FILE_LIBRARY] Got signed URL:",I.substring(0,50)+"...")}else I=L.cloudinary_url,O=L.display_name||L.original_name,console.log(" [FILE_LIBRARY] Using Cloudinary URL:",I.substring(0,50)+"...");console.log(" [FILE_LIBRARY] Fetching file content from URL");const X=await fetch(I);if(!X.ok)throw new Error(`Download failed: ${X.status} ${X.statusText}`);const $=await X.blob();if(console.log(" [FILE_LIBRARY] File blob size:",$.size,"bytes"),$.size===0)throw new Error("Downloaded file is empty");const H=URL.createObjectURL($),D=document.createElement("a");D.href=H,D.download=O,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(H),console.log(" [FILE_LIBRARY] Download initiated")}catch(I){console.error("Error downloading file:",I),alert("Failed to download file: "+I.message)}},P=L=>{y(L),v(!0)},M=s.filter(L=>{const I=L.display_name.toLowerCase().includes(a.toLowerCase()),O=!l||L.file_type===l,X=h===null||L.folder_id===h;return I&&O&&X}),V=N(M);return r?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-full overflow-hidden h-[600px] flex flex-col",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center p-3 border-b border-gray-200",children:[c.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-800",children:"File Library"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>w(!x),className:"lg:hidden p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),c.jsxs("div",{className:"text-xs sm:text-sm text-gray-500",children:[s.length," file",s.length!==1?"s":""," available"]})]})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:`
          ${x?"translate-x-0":"-translate-x-full lg:translate-x-0"}
          fixed lg:relative inset-y-0 left-0 z-40
          w-64 lg:w-64 flex-shrink-0 border-r border-gray-200 bg-white
          transition-transform duration-300 ease-in-out
          lg:transition-none
        `,children:c.jsx(OH,{folders:t,selectedFolder:h,onFolderSelect:f})}),x&&c.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>w(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[c.jsx("div",{className:"p-2 sm:p-3 border-b border-gray-200 bg-gray-50",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[c.jsx("div",{className:"flex-1 min-w-0",children:c.jsx("input",{type:"text",placeholder:"Search files...",value:a,onChange:L=>o(L.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",onKeyPress:L=>L.key==="Enter"&&T()})}),c.jsx("div",{className:"w-full sm:w-32 md:w-40",children:c.jsxs("select",{value:l,onChange:L=>u(L.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",children:[c.jsx("option",{value:"",children:"All file types"}),c.jsxs("optgroup",{label:"Documents",children:[c.jsx("option",{value:"pdf",children:"PDF"}),c.jsx("option",{value:"doc",children:"DOC"}),c.jsx("option",{value:"docx",children:"DOCX"}),c.jsx("option",{value:"txt",children:"TXT"}),c.jsx("option",{value:"xls",children:"XLS"}),c.jsx("option",{value:"xlsx",children:"XLSX"}),c.jsx("option",{value:"ppt",children:"PPT"}),c.jsx("option",{value:"pptx",children:"PPTX"})]}),c.jsxs("optgroup",{label:"Images",children:[c.jsx("option",{value:"jpg",children:"JPG"}),c.jsx("option",{value:"png",children:"PNG"}),c.jsx("option",{value:"gif",children:"GIF"}),c.jsx("option",{value:"webp",children:"WEBP"}),c.jsx("option",{value:"svg",children:"SVG"})]}),c.jsxs("optgroup",{label:"Audio",children:[c.jsx("option",{value:"mp3",children:"MP3"}),c.jsx("option",{value:"wav",children:"WAV"}),c.jsx("option",{value:"ogg",children:"OGG"}),c.jsx("option",{value:"m4a",children:"M4A"}),c.jsx("option",{value:"aac",children:"AAC"}),c.jsx("option",{value:"flac",children:"FLAC"})]}),c.jsxs("optgroup",{label:"Archives",children:[c.jsx("option",{value:"zip",children:"ZIP"}),c.jsx("option",{value:"rar",children:"RAR"})]})]})}),c.jsx("div",{className:"w-full sm:w-32 md:w-40",children:c.jsxs("select",{value:p,onChange:L=>m(L.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",children:[c.jsx("option",{value:"name",children:"Sort by Name"}),c.jsx("option",{value:"date",children:"Sort by Date"}),c.jsx("option",{value:"size",children:"Sort by Size"}),c.jsx("option",{value:"downloads",children:"Sort by Downloads"})]})})]})}),c.jsx("div",{className:"flex-1 overflow-hidden",children:c.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden h-full",children:[c.jsx("div",{className:"hidden sm:block bg-gray-50 border-b border-gray-200 px-4 py-2",children:c.jsxs("div",{className:"grid grid-cols-12 gap-4 text-xs font-medium text-gray-500 uppercase tracking-wider",children:[c.jsx("div",{className:"col-span-6",children:"Name"}),c.jsx("div",{className:"col-span-2",children:"Size"}),c.jsx("div",{className:"col-span-2",children:"Modified"}),c.jsx("div",{className:"col-span-2",children:"Actions"})]})}),c.jsx("div",{className:"divide-y divide-gray-200 overflow-y-auto h-full",children:V.map(L=>c.jsxs(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center px-2 sm:px-4 py-2 sm:py-3 hover:bg-gray-50 transition-colors",children:[c.jsx("div",{className:"sm:hidden flex-1 min-w-0",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"flex-shrink-0",children:oy(L.file_type)}),c.jsxs("div",{className:"min-w-0 flex-1",children:[c.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",title:L.display_name,children:L.display_name}),c.jsxs("div",{className:"text-xs text-gray-500",children:[L.folder_name||"Root","  ",L.file_type.toUpperCase()]}),c.jsxs("div",{className:"flex items-center justify-between mt-1",children:[c.jsxs("div",{className:"text-xs text-gray-500",children:[ek(L.file_size),"  ",C(L.created_at)]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>P(L),className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Preview",children:c.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),c.jsx("button",{onClick:()=>j(L),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Download",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})]})]})]})}),c.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 sm:gap-4 sm:w-full",children:[c.jsxs("div",{className:"col-span-6 flex items-center space-x-3 min-w-0",children:[c.jsx("span",{children:oy(L.file_type)}),c.jsxs("div",{className:"min-w-0 flex-1",children:[c.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",title:L.display_name,children:L.display_name}),c.jsxs("div",{className:"text-xs text-gray-500",children:[L.folder_name||"Root","  ",L.file_type.toUpperCase()]})]})]}),c.jsx("div",{className:"col-span-2 text-sm text-gray-500",children:ek(L.file_size)}),c.jsx("div",{className:"col-span-2 text-sm text-gray-500",children:C(L.created_at)}),c.jsxs("div",{className:"col-span-2 flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>P(L),className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Preview",children:c.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),c.jsx("button",{onClick:()=>j(L),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Download",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})]})]},L.id))}),V.length===0&&c.jsxs("div",{className:"text-center py-8 text-gray-500",children:[c.jsx("div",{className:"text-4xl mb-2",children:""}),c.jsx("p",{children:"No files found."})]})]})})]})]}),c.jsx(UR,{file:g,isOpen:b,onClose:()=>{v(!1),y(null)}})]})};function Pk(s){const e=new Date(s),t=e.getDay(),n=t===0?-6:1-t;return e.setDate(e.getDate()+n),e.setHours(0,0,0,0),e}function Lx(s){return s.toISOString().split("T")[0]}function Rk(s){if(!s)return!1;const e=Pk(new Date),t=new Date(e);t.setDate(t.getDate()-7);const n=new Date(s),r=Lx(Pk(n)),i=Lx(e),a=Lx(t);return r===i||r===a}const $H=()=>{var Fa,z,te;const{user:s,logout:e}=Fm(),[t,n]=_.useState($c()),[r,i]=_.useState([]),[a,o]=_.useState(!0),[l,u]=_.useState(!1),[h,f]=_.useState(null),[p,m]=_.useState(""),[g,y]=_.useState(null),[b,v]=_.useState(""),[x,w]=_.useState({completed:0,absent:0,warned:0}),[E,T]=_.useState(new Set),[C,N]=_.useState(!1),[j,P]=_.useState(null),[M,V]=_.useState(!1),[L,I]=_.useState(null),[O,X]=_.useState(!1),[$,H]=_.useState(new Set),[D,F]=_.useState(null),[q,J]=_.useState(!1),[ee,de]=_.useState([]),[ge,Ce]=_.useState("schedule"),[B,K]=_.useState(!1),[xe,Re]=_.useState(!1),[Se,Ze]=_.useState({visible:!1,type:"success",title:"",message:"",duration:4e3}),lt=(G,he,ye,be=4e3)=>{Ze({visible:!0,type:G,title:he,message:ye,duration:be})};_.useEffect(()=>{console.log(" [TEACHER_PAGE] useEffect triggered with user:",s),console.log(" [TEACHER_PAGE] user.teacherId:",s==null?void 0:s.teacherId),s&&s.teacherId?(console.log(" [TEACHER_PAGE] User and teacherId available, making API calls"),Ae(),$e(),ie()):console.log(" [TEACHER_PAGE] User or teacherId not available:",{user:!!s,teacherId:s==null?void 0:s.teacherId})},[t,s]);const Ae=async()=>{try{if(o(!0),console.log(" [TEACHER_PAGE] fetchSchedule called with user:",s),console.log(" [TEACHER_PAGE] user.teacherId:",s.teacherId,"currentWeek:",t),console.log(" [TEACHER_PAGE] user object keys:",Object.keys(s||{})),!s.teacherId){console.error(" [TEACHER_PAGE] teacherId is undefined, cannot fetch schedule");return}const G=await se.getTeacherSchedule(s.teacherId,t);console.log(" [TEACHER_PAGE] Schedule API response:",G),G.success&&(console.log(" [TEACHER_PAGE] Setting schedule:",G.schedules),i(G.schedules||[]))}catch(G){console.error("Error fetching schedule:",G)}finally{o(!1)}},$e=async()=>{try{console.log(" [TEACHER_PAGE] fetchAttendanceStats called with user:",s),console.log(" [TEACHER_PAGE] user.teacherId:",s.teacherId,"period:",`${t},${U(t)}`);const G=await se.getTeacherStats(s.teacherId,{week_start:t});G.success&&w({completed:G.stats.completed_lessons||0,absent:G.stats.absent_lessons||0,warned:0})}catch(G){console.error("Error fetching attendance stats:",G)}},ie=async()=>{try{console.log(" [TEACHER_PAGE] fetchExistingReports called");const G=await se.getReports({teacher_id:s.teacherId,date_from:t,date_to:U(t)});if(console.log(" [TEACHER_PAGE] Reports API response:",G),G.success&&G.reports){const he=G.reports.filter(be=>{const je=new Date(be.lesson_date),Je=je.getFullYear()+"-"+String(je.getMonth()+1).padStart(2,"0")+"-"+String(je.getDate()).padStart(2,"0");return DA(Je)===t}),ye=he.map(be=>{const je=new Date(be.lesson_date),Je=je.getFullYear()+"-"+String(je.getMonth()+1).padStart(2,"0")+"-"+String(je.getDate()).padStart(2,"0"),Y=`${be.student_id}-${Je}-${be.time_slot}`;return console.log(" [TEACHER_PAGE] Generated report key:",Y,"from report:",be),Y});T(new Set(ye)),de(he),console.log(" [TEACHER_PAGE] Loaded existing reports for current week:",ye)}else console.log(" [TEACHER_PAGE] No reports found or API failed")}catch(G){console.error("Error fetching existing reports:",G)}},U=G=>{const he=new Date(G);return he.setDate(he.getDate()+6),he.toISOString().split("T")[0]},oe=async()=>{if(!O){X(!0);const G=F2(t,7);n(G),setTimeout(()=>X(!1),300)}},Ue=async()=>{if(!O){X(!0);const G=O2(t,7);n(G),setTimeout(()=>X(!1),300)}},hn=async()=>{if(!O){X(!0);const he=DA(new Date);n(he),setTimeout(()=>X(!1),300)}},ys=async(G,he)=>{try{(await se.markAttendance(G,he)).success&&(Ae(),$e())}catch(ye){console.error("Error marking attendance:",ye),alert("Failed to mark attendance")}},Vs=(G,he,ye,be)=>{if(!Rk(be)){lt("warning","Action not allowed","Sorry, you are only allowed to edit current week or previous week.");return}I({scheduleId:G,status:he,studentName:ye}),V(!0)},Ar=async()=>{if(L)try{K(!0),await ys(L.scheduleId,L.status),await Ae(),V(!1),I(null)}finally{K(!1)}},tr=(G,he,ye,be)=>{if(!Rk(ye==null?void 0:ye.week_start_date)){lt("warning","Action not allowed","Sorry, you are only allowed to edit current week or previous week.");return}console.log(" [HANDLE_STUDENT_CLICK] Called with:",{student:G,timeSlot:he,scheduleItem:ye,dayIndex:be});const je=new Date(ye.week_start_date);je.setDate(je.getDate()+ye.day_of_week);const Je=`${je.getFullYear()}-${String(je.getMonth()+1).padStart(2,"0")}-${String(je.getDate()).padStart(2,"0")}`,Y=`${G.id}-${Je}-${he}`;if(console.log(" [HANDLE_STUDENT_CLICK] Checking lesson key:",Y),console.log(" [HANDLE_STUDENT_CLICK] Current reports set:",Array.from(E)),console.log(" [HANDLE_STUDENT_CLICK] Has report?",E.has(Y)),E.has(Y)){console.log(" [HANDLE_STUDENT_CLICK] Report already exists, showing alert"),lt("info","Already submitted","Report already submitted for this lesson.");return}console.log(" [HANDLE_STUDENT_CLICK] Setting up report modal with:",{student:G,timeSlot:he,dayIndex:be}),f(G),m(he),y(be),u(!0),console.log(" [HANDLE_STUDENT_CLICK] Report modal should now be visible")},zs=()=>{if(!b.trim()){alert("Please enter a comment");return}const G=r.find(be=>be.student_id===h.id&&be.time_slot===p&&be.day_of_week===g);if(!G){alert("Schedule item not found for this day and time slot");return}const he=new Date(G.week_start_date);he.setDate(he.getDate()+G.day_of_week);const ye=he.getFullYear()+"-"+String(he.getMonth()+1).padStart(2,"0")+"-"+String(he.getDate()).padStart(2,"0");P({student_id:h.id,lesson_date:ye,time_slot:p,comment:b}),N(!0)},kr=async()=>{try{Re(!0);const G=r.find(ye=>ye.student_id===j.student_id&&ye.time_slot===j.time_slot&&ye.day_of_week===g);if(G&&!(await se.markAttendance(G.id,"completed",new Date().toISOString().split("T")[0])).success){alert("Failed to mark attendance");return}if((await se.createReport(j)).success){const ye=`${j.student_id}-${j.lesson_date}-${j.time_slot}`;console.log(" [CONFIRM_SUBMIT] Adding lesson key to reports set:",ye),T(be=>{const je=new Set([...be,ye]);return console.log(" [CONFIRM_SUBMIT] Updated reports set:",Array.from(je)),je}),H(be=>new Set([...be,ye])),setTimeout(()=>{H(be=>{const je=new Set(be);return je.delete(ye),je})},2e3),await Ae(),u(!1),N(!1),v(""),f(null),m(""),y(null),P(null),lt("success","Success","Report submitted successfully!")}}catch(G){console.error("Error submitting report:",G),alert("Failed to submit report")}finally{Re(!1)}},Cn=G=>G.attendance_status==="completed"?"completed":G.attendance_status==="absent"?"absent":G.attendance_status==="absent_warned"?"absent_warned":"scheduled",ct=G=>{switch(G){case"completed":return"bg-green-100 text-green-800";case"absent":return"bg-red-100 text-red-800";case"absent_warned":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},Ws={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},vs=["8:00-8:30","8:30-9:00","9:00-9:30","9:30-10:00","10:00-10:30","10:30-11:00","11:00-11:30","11:30-12:00","12:00-12:30","12:30-13:00","13:00-13:30","13:30-14:00","14:00-14:30","14:30-15:00","15:00-15:30","15:30-16:00","16:00-16:30","16:30-17:00","17:00-17:30","17:30-18:00","18:00-18:30","18:30-19:00","19:00-19:30","19:30-20:00","20:00-20:30","20:30-21:00","21:00-21:30","21:30-22:00"],is=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],xs=t?P_(t):[],Tr=$2(),fn={};xs.forEach(G=>{const he=`${G.getFullYear()}-${G.getMonth()+1}`;fn[he]=(fn[he]||0)+1});const Cr=Object.keys(fn).reduce((G,he)=>fn[G]>fn[he]?G:he,Object.keys(fn)[0]),[as,al]=Cr?Cr.split("-").map(Number):[Tr.year,Tr.month],Tt=t?ov(t,al,as):null,bt=t?U2(t,al,as):null,Nr=xs.length>0?xs[0].toLocaleDateString("en-US",{month:"long",year:"numeric"}):Tr.name+" "+Tr.year;return console.log(" [TEACHER_PAGE] Render - schedule state:",r,"type:",typeof r,"isArray:",Array.isArray(r)),console.log(" [TEACHER_PAGE] Render - modal states:",{showReportModal:l,selectedStudent:!!h,showConfirmModal:C,pendingReport:!!j}),a?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your schedule..."})]})}):c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b",children:c.jsx("div",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8",children:c.jsxs("div",{className:"flex justify-between items-center h-16",children:[c.jsx("div",{className:"flex items-center",children:c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Teacher Dashboard"})}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("span",{className:"text-sm text-gray-700",children:["Welcome, ",(s==null?void 0:s.teacher_name)||(s==null?void 0:s.username),". Let's talk!"]}),c.jsx("button",{onClick:e,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Logout"})]})]})})}),c.jsxs("main",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8",children:[c.jsx("div",{className:"flex space-x-1 sm:space-x-2 mb-3 sm:mb-4 md:mb-6 overflow-x-auto",children:[{id:"schedule",label:"Schedule",shortLabel:"Schedule"},{id:"files",label:"Folder",shortLabel:"Folder"}].map(G=>c.jsxs("button",{onClick:()=>Ce(G.id),className:`px-3 sm:px-3 md:px-4 py-2 sm:py-1.5 md:py-2 rounded text-sm sm:text-sm md:text-base font-medium transition-colors duration-200 whitespace-nowrap ${ge===G.id?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[c.jsx("span",{className:"sm:hidden",children:G.shortLabel}),c.jsx("span",{className:"hidden sm:inline",children:G.label})]},G.id))}),ge==="schedule"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 md:gap-6 mb-4 sm:mb-6 md:mb-8",children:[c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow p-3 sm:p-4 md:p-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"p-1 sm:p-2 bg-green-100 rounded-lg",children:c.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-green-600 text-xs sm:text-sm md:text-base",children:""})}),c.jsxs("div",{className:"ml-2 sm:ml-3 md:ml-4",children:[c.jsx("p",{className:"text-2xs sm:text-xs md:text-sm font-medium text-gray-600",children:"Completed"}),c.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:x.completed})]})]})}),c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg shadow p-3 sm:p-4 md:p-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"p-1 sm:p-2 bg-red-100 rounded-lg",children:c.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-red-600 text-xs sm:text-sm md:text-base",children:""})}),c.jsxs("div",{className:"ml-2 sm:ml-3 md:ml-4",children:[c.jsx("p",{className:"text-2xs sm:text-xs md:text-sm font-medium text-gray-600",children:"UI"}),c.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:x.absent})]})]})}),c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg shadow p-3 sm:p-4 md:p-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"p-1 sm:p-2 bg-blue-100 rounded-lg",children:c.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-blue-600 text-xs sm:text-sm md:text-base",children:""})}),c.jsxs("div",{className:"ml-2 sm:ml-3 md:ml-4",children:[c.jsx("p",{className:"text-2xs sm:text-xs md:text-sm font-medium text-gray-600",children:"Total"}),c.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:Number(x.completed)+Number(x.absent)})]})]})})]}),c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[c.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 border-b border-gray-200",children:c.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:c.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[c.jsx("h2",{className:"text-sm sm:text-base md:text-lg font-semibold text-gray-900",children:"Weekly Schedule"}),c.jsxs(Q.div,{className:"flex items-center justify-center sm:justify-end space-x-1 sm:space-x-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:[c.jsx(Q.button,{onClick:oe,disabled:O,className:"p-1.5 sm:p-2 rounded border border-gray-300 hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:O?{x:[-2,2,-2]}:{x:0},transition:{duration:.1,repeat:O?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx(Q.button,{onClick:hn,disabled:O,className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${bt!=null&&bt.isCurrentWeek?"bg-blue-500 text-white":"text-gray-700 bg-gray-100 hover:bg-gray-200"}`,title:(bt==null?void 0:bt.weekLabel)||"Current Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:(bt==null?void 0:bt.weekLabel)||"Week 1"},(bt==null?void 0:bt.weekLabel)||"Week 1")}),c.jsx(Q.button,{onClick:Ue,disabled:O,className:"p-1.5 sm:p-2 rounded border border-gray-300 hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:O?{x:[2,-2,2]}:{x:0},transition:{duration:.1,repeat:O?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})})}),c.jsx("div",{className:"overflow-x-auto",children:c.jsx(cn,{mode:"wait",children:c.jsx(Q.div,{variants:Ws,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.3,ease:"easeInOut"},children:c.jsxs("table",{className:"w-full table-fixed",children:[c.jsxs("thead",{className:"bg-neutral-50",children:[c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-xs sm:text-sm font-semibold text-neutral-800 w-12 sm:w-16 md:w-24"}),c.jsx("th",{colSpan:"7",className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center text-sm sm:text-base md:text-lg font-bold text-neutral-800",children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:Nr},Nr)})]}),c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-medium text-neutral-700 w-10 sm:w-12 md:w-16",children:"Time"}),is.map((G,he)=>{var je;const ye=(je=Tt==null?void 0:Tt.days)==null?void 0:je[he],be=(ye==null?void 0:ye.isCurrentMonth)??!0;return ye==null||ye.isEditable,c.jsx(Q.th,{className:`px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center font-medium min-w-0 ${be?"text-neutral-700":"text-neutral-400 bg-neutral-100"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:he*.05},children:c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("div",{className:`font-semibold text-2xs sm:text-xs md:text-sm truncate ${be?"":"opacity-50"}`,children:G}),xs.length>he&&c.jsx(Q.div,{className:`text-2xs sm:text-xs mt-0.5 sm:mt-1 truncate ${be?"text-neutral-500":"text-neutral-400"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.1+he*.05},children:I2(xs[he],"short")})]})},`${G}-${t}`)})]})]}),c.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:vs.map((G,he)=>c.jsxs(Q.tr,{className:"border-b border-neutral-100",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:he*.02},children:[c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-2xs sm:text-xs md:text-sm text-neutral-600 font-medium",children:G}),is.map((ye,be)=>{var pe;const je=(r||[]).filter(ke=>ke.day_of_week===be&&ke.time_slot===G),Je=(pe=Tt==null?void 0:Tt.days)==null?void 0:pe[be],Y=(Je==null?void 0:Je.isCurrentMonth)??!0;return Je==null||Je.isEditable,c.jsx(Q.td,{className:`px-1 sm:px-2 py-1 h-10 sm:h-12 md:h-14 relative ${Y?"":"bg-neutral-50"}`,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2,delay:he*.02+be*.01},children:c.jsx(cn,{mode:"wait",children:je.length>0?je.map(ke=>{const Ie=Cn(ke),Ge=new Date(ke.week_start_date);Ge.setDate(Ge.getDate()+ke.day_of_week);const Gs=Ge.getFullYear()+"-"+String(Ge.getMonth()+1).padStart(2,"0")+"-"+String(Ge.getDate()).padStart(2,"0"),vt=`${ke.student_id}-${Gs}-${G}`,Jt=E.has(vt),ut=$.has(vt),dt=Jt||Ie==="completed"||Ie==="absent"||Ie==="absent_warned";return c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:dt?.7:1,scale:ut?1.05:1,boxShadow:ut?"0 0 20px rgba(34, 197, 94, 0.4)":void 0},transition:{duration:.3,ease:"easeOut",scale:{duration:.6,ease:"easeInOut"}},className:`p-1 rounded-lg text-2xs font-medium text-center transition-all duration-200 ${dt?"cursor-pointer border-2 border-green-200 hover:bg-gray-200":"cursor-pointer hover:shadow-lg hover:scale-105"} ${ut?"ring-2 ring-green-400 ring-opacity-50":""} ${ct(Ie)}`,onClick:()=>{if(dt){const qs=ee.find(tu=>{const su=new Date(tu.lesson_date),xh=su.getFullYear()+"-"+String(su.getMonth()+1).padStart(2,"0")+"-"+String(su.getDate()).padStart(2,"0");return`${tu.student_id}-${xh}-${tu.time_slot}`===vt});qs&&(F(qs),J(!0))}else tr({id:ke.student_id,name:ke.student_name},G,ke,be)},children:[c.jsxs("div",{className:"font-medium text-2xs sm:text-xs flex items-center justify-between",children:[c.jsx("span",{className:`truncate ${dt?"text-gray-500":""}`,children:ke.student_name}),dt&&c.jsx(Q.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:ut?[1,1.1,1]:1,backgroundColor:Ie==="completed"?"#10b981":Ie==="absent"?"#ef4444":Ie==="absent_warned"?"#eab308":"#3b82f6"},transition:{delay:.2,duration:.3,scale:ut?{duration:.8,repeat:2,ease:"easeInOut"}:{duration:.3}},className:`text-2xs sm:text-xs text-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full font-semibold shadow-sm ${Ie==="completed"?"bg-green-500":Ie==="absent"?"bg-red-500":Ie==="absent_warned"?"bg-yellow-500":"bg-blue-500"} ${ut?"animate-pulse":""}`,children:Ie==="completed"?c.jsx("span",{className:"text-xs",children:""}):Ie==="absent"?c.jsx("span",{className:"text-xs",children:""}):Ie==="absent_warned"?c.jsx("span",{className:"text-xs",children:""}):c.jsx("span",{className:"text-xs",style:{fontSize:"10px"},children:""})})]}),c.jsxs("div",{className:"flex flex-col md:flex-row space-y-0.5 md:space-y-0 md:space-x-1 mt-0.5",children:[c.jsxs("div",{className:"flex space-x-0.5",children:[c.jsx(Q.button,{whileHover:dt?{}:{scale:1.05},whileTap:dt?{}:{scale:.95},onClick:qs=>{dt||(qs.stopPropagation(),tr({id:ke.student_id,name:ke.student_name},G,ke,be))},disabled:dt,className:`px-0.5 py-0.5 md:px-2 md:py-1 rounded text-xs transition-all duration-200 ${dt?"bg-gray-200 text-gray-400 cursor-not-allowed":Ie==="completed"?"bg-green-200 text-green-800 hover:bg-green-300":"bg-gray-200 text-gray-600 hover:bg-green-200 hover:text-green-800"}`,children:c.jsx("span",{className:"text-xs md:text-sm",style:{fontSize:"10px"},children:""})}),c.jsx(Q.button,{whileHover:dt?{}:{scale:1.05},whileTap:dt?{}:{scale:.95},onClick:qs=>{if(console.log(" [ABSENT_BUTTON_CLICK] Button clicked! isMarked:",dt,"scheduleId:",ke.id),dt){console.log(" [ABSENT_BUTTON_CLICK] Returning early because isMarked=true");return}qs.stopPropagation(),console.log(" [ABSENT_BUTTON_CLICK] Calling handleAttendanceClick"),Vs(ke.id,"absent",ke.student_name,ke.week_start_date)},disabled:dt,className:`px-0.5 py-0.5 md:px-2 md:py-1 rounded text-xs transition-all duration-200 ${dt?"bg-gray-200 text-gray-400 cursor-not-allowed":Ie==="absent"?"bg-red-200 text-red-800 hover:bg-red-300":"bg-gray-200 text-gray-600 hover:bg-red-200 hover:text-red-800"}`,children:c.jsx("span",{className:"text-xs md:text-sm",style:{fontSize:"10px"},children:""})})]}),c.jsx(Q.button,{whileHover:dt?{}:{scale:1.05},whileTap:dt?{}:{scale:.95},onClick:qs=>{dt||(qs.stopPropagation(),Vs(ke.id,"absent_warned",ke.student_name,ke.week_start_date))},disabled:dt,className:`px-0.5 py-0.5 md:px-2 md:py-1 rounded text-xs transition-all duration-200 ${dt?"bg-gray-200 text-gray-400 cursor-not-allowed":Ie==="absent_warned"?"bg-yellow-200 text-yellow-800 hover:bg-yellow-300":"bg-gray-200 text-gray-600 hover:bg-yellow-200 hover:text-yellow-800"}`,children:c.jsx("span",{className:"text-xs md:text-sm",style:{fontSize:"10px"},children:""})})]})]},ke.id)}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-neutral-300 hover:text-neutral-400 transition-colors duration-200",children:c.jsx("span",{className:"text-2xs sm:text-xs font-light",children:""})})})},`${ye}-${G}`)})]},G))})]})},t)})})]})]}),ge==="files"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(FH,{})}),console.log(" [RENDER] Report modal check:",{showReportModal:l,selectedStudent:!!h}),l&&h&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Complete Lesson - ",h==null?void 0:h.name]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Slot"}),c.jsx("input",{type:"text",value:p,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comment"}),c.jsx("textarea",{value:b,onChange:G=>v(G.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your lesson report comment..."})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),c.jsx("button",{onClick:zs,className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:"Submit Report"})]})]})}),c.jsxs(ka,{isOpen:C,onClose:()=>{N(!1),P(null)},title:"Confirm Lesson Completion",loading:xe,loadingText:"Submitting...",confirmText:"Complete Lesson",confirmButtonColor:"bg-green-600 hover:bg-green-700",onConfirm:kr,children:[c.jsx("p",{className:"text-gray-700",children:"Are you sure you want to complete this lesson and submit the report? This will mark the lesson as completed and save the report."}),c.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Student:"})," ",h==null?void 0:h.name]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Time Slot:"})," ",j==null?void 0:j.time_slot]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Date:"})," ",j==null?void 0:j.lesson_date]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Comment:"})," ",j==null?void 0:j.comment]})]})]}),console.log(" [MODAL_RENDER] showAttendanceConfirmModal:",M,"pendingAttendance:",L),c.jsxs(ka,{isOpen:M,onClose:()=>{V(!1),I(null)},title:"Confirm Attendance Marking",loading:B,loadingText:"Marking...",confirmText:`Mark as ${(L==null?void 0:L.status)==="absent"?"UI":(L==null?void 0:L.status)==="absent_warned"?"I":(Fa=L==null?void 0:L.status)==null?void 0:Fa.replace("_"," ").toUpperCase()}`,confirmButtonColor:(L==null?void 0:L.status)==="absent"?"bg-red-600 hover:bg-red-700":"bg-yellow-600 hover:bg-yellow-700",onConfirm:Ar,children:[c.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to mark this lesson as ",c.jsx("strong",{children:(L==null?void 0:L.status)==="absent"?"UI":(L==null?void 0:L.status)==="absent_warned"?"I":(z=L==null?void 0:L.status)==null?void 0:z.replace("_"," ").toUpperCase()}),"?"]}),c.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Student:"})," ",L==null?void 0:L.studentName]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Status:"})," ",(L==null?void 0:L.status)==="absent"?"UI":(L==null?void 0:L.status)==="absent_warned"?"I":(te=L==null?void 0:L.status)==null?void 0:te.replace("_"," ").toUpperCase()]})]})]}),q&&D&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:c.jsx(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsx("h3",{className:"text-xl font-semibold text-neutral-800",children:"Your Lesson Report"}),c.jsx("button",{onClick:()=>J(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Student"}),c.jsx("p",{className:"text-lg font-semibold text-neutral-800",children:D.student_name})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Time Slot"}),c.jsx("p",{className:"text-lg font-semibold text-neutral-800",children:D.time_slot})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Lesson Date"}),c.jsx("p",{className:"text-neutral-800",children:new Date(D.lesson_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Submitted At"}),c.jsx("p",{className:"text-neutral-800",children:new Date(D.created_at).toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]}),D.comment&&c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Your Comment"}),c.jsx("div",{className:"mt-2 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:c.jsx("p",{className:"text-neutral-800 whitespace-pre-wrap",children:D.comment})})]}),!D.comment&&c.jsx("div",{className:"text-center py-8 text-gray-500",children:c.jsx("p",{children:"No comment provided for this lesson."})})]}),c.jsx("div",{className:"mt-6 flex justify-end",children:c.jsx("button",{onClick:()=>J(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Close"})})]})})})]}),c.jsx(mh,{isVisible:Se.visible,onClose:()=>Ze(G=>({...G,visible:!1})),title:Se.title,message:Se.message,type:Se.type,duration:Se.duration})]})},UH=()=>c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-neutral-50",children:c.jsxs(Q.div,{className:"flex flex-col items-center space-y-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[c.jsx(Q.div,{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-500 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),c.jsx("p",{className:"text-neutral-600 text-sm",children:"Loading..."})]})}),Lk=({children:s,role:e})=>{const{user:t,loading:n,isAuthenticated:r}=Fm();return n?c.jsx(UH,{}):r?e&&(t==null?void 0:t.role)!==e?(t==null?void 0:t.role)==="admin"?c.jsx(Uh,{to:"/admin",replace:!0}):(t==null?void 0:t.role)==="teacher"?c.jsx(Uh,{to:"/teacher",replace:!0}):c.jsx(Uh,{to:"/",replace:!0}):s:c.jsx(Uh,{to:"/",replace:!0})};function BH(){return c.jsx(jI,{children:c.jsx(PI,{children:c.jsx(SI,{children:c.jsxs("div",{className:"min-h-screen",children:[c.jsx(RI,{}),c.jsxs(xI,{children:[c.jsx(Bh,{path:"/",element:c.jsx(Q3,{})}),c.jsx(Bh,{path:"/admin",element:c.jsx(Lk,{role:"admin",children:c.jsx(IH,{})})}),c.jsx(Bh,{path:"/teacher",element:c.jsx(Lk,{role:"teacher",children:c.jsx($H,{})})}),c.jsx(Bh,{path:"*",element:c.jsx(Uh,{to:"/",replace:!0})})]}),!1]})})})})}YC(document.getElementById("root")).render(c.jsx(_.StrictMode,{children:c.jsx(BH,{})}));
