var sL=Object.defineProperty;var cE=s=>{throw TypeError(s)};var nL=(s,e,t)=>e in s?sL(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var re=(s,e,t)=>nL(s,typeof e!="symbol"?e+"":e,t),Nv=(s,e,t)=>e.has(s)||cE("Cannot "+t);var d=(s,e,t)=>(Nv(s,e,"read from private field"),t?t.call(s):e.get(s)),A=(s,e,t)=>e.has(s)?cE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),_=(s,e,t,n)=>(Nv(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),k=(s,e,t)=>(Nv(s,e,"access private method"),t);var Ws=(s,e,t,n)=>({set _(r){_(s,e,r,t)},get _(){return d(s,e,n)}});function rL(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function Ok(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function iL(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var r=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return s[n]}})}),t}var Fk={exports:{}},Fy={},$k={exports:{}},ze={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lm=Symbol.for("react.element"),aL=Symbol.for("react.portal"),oL=Symbol.for("react.fragment"),lL=Symbol.for("react.strict_mode"),cL=Symbol.for("react.profiler"),uL=Symbol.for("react.provider"),dL=Symbol.for("react.context"),hL=Symbol.for("react.forward_ref"),fL=Symbol.for("react.suspense"),pL=Symbol.for("react.memo"),mL=Symbol.for("react.lazy"),uE=Symbol.iterator;function gL(s){return s===null||typeof s!="object"?null:(s=uE&&s[uE]||s["@@iterator"],typeof s=="function"?s:null)}var Uk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bk=Object.assign,Hk={};function mh(s,e,t){this.props=s,this.context=e,this.refs=Hk,this.updater=t||Uk}mh.prototype.isReactComponent={};mh.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};mh.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function Vk(){}Vk.prototype=mh.prototype;function mS(s,e,t){this.props=s,this.context=e,this.refs=Hk,this.updater=t||Uk}var gS=mS.prototype=new Vk;gS.constructor=mS;Bk(gS,mh.prototype);gS.isPureReactComponent=!0;var dE=Array.isArray,zk=Object.prototype.hasOwnProperty,yS={current:null},Wk={key:!0,ref:!0,__self:!0,__source:!0};function Gk(s,e,t){var n,r={},i=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)zk.call(e,n)&&!Wk.hasOwnProperty(n)&&(r[n]=e[n]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];r.children=l}if(s&&s.defaultProps)for(n in o=s.defaultProps,o)r[n]===void 0&&(r[n]=o[n]);return{$$typeof:Lm,type:s,key:i,ref:a,props:r,_owner:yS.current}}function yL(s,e){return{$$typeof:Lm,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function vS(s){return typeof s=="object"&&s!==null&&s.$$typeof===Lm}function vL(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var hE=/\/+/g;function jv(s,e){return typeof s=="object"&&s!==null&&s.key!=null?vL(""+s.key):e.toString(36)}function Fg(s,e,t,n,r){var i=typeof s;(i==="undefined"||i==="boolean")&&(s=null);var a=!1;if(s===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(s.$$typeof){case Lm:case aL:a=!0}}if(a)return a=s,r=r(a),s=n===""?"."+jv(a,0):n,dE(r)?(t="",s!=null&&(t=s.replace(hE,"$&/")+"/"),Fg(r,e,t,"",function(u){return u})):r!=null&&(vS(r)&&(r=yL(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(hE,"$&/")+"/")+s)),e.push(r)),1;if(a=0,n=n===""?".":n+":",dE(s))for(var o=0;o<s.length;o++){i=s[o];var l=n+jv(i,o);a+=Fg(i,e,t,l,r)}else if(l=gL(s),typeof l=="function")for(s=l.call(s),o=0;!(i=s.next()).done;)i=i.value,l=n+jv(i,o++),a+=Fg(i,e,t,l,r);else if(i==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ng(s,e,t){if(s==null)return s;var n=[],r=0;return Fg(s,n,"","",function(i){return e.call(t,i,r++)}),n}function xL(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var an={current:null},$g={transition:null},wL={ReactCurrentDispatcher:an,ReactCurrentBatchConfig:$g,ReactCurrentOwner:yS};function qk(){throw Error("act(...) is not supported in production builds of React.")}ze.Children={map:ng,forEach:function(s,e,t){ng(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return ng(s,function(){e++}),e},toArray:function(s){return ng(s,function(e){return e})||[]},only:function(s){if(!vS(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};ze.Component=mh;ze.Fragment=oL;ze.Profiler=cL;ze.PureComponent=mS;ze.StrictMode=lL;ze.Suspense=fL;ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wL;ze.act=qk;ze.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var n=Bk({},s.props),r=s.key,i=s.ref,a=s._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=yS.current),e.key!==void 0&&(r=""+e.key),s.type&&s.type.defaultProps)var o=s.type.defaultProps;for(l in e)zk.call(e,l)&&!Wk.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];n.children=o}return{$$typeof:Lm,type:s.type,key:r,ref:i,props:n,_owner:a}};ze.createContext=function(s){return s={$$typeof:dL,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:uL,_context:s},s.Consumer=s};ze.createElement=Gk;ze.createFactory=function(s){var e=Gk.bind(null,s);return e.type=s,e};ze.createRef=function(){return{current:null}};ze.forwardRef=function(s){return{$$typeof:hL,render:s}};ze.isValidElement=vS;ze.lazy=function(s){return{$$typeof:mL,_payload:{_status:-1,_result:s},_init:xL}};ze.memo=function(s,e){return{$$typeof:pL,type:s,compare:e===void 0?null:e}};ze.startTransition=function(s){var e=$g.transition;$g.transition={};try{s()}finally{$g.transition=e}};ze.unstable_act=qk;ze.useCallback=function(s,e){return an.current.useCallback(s,e)};ze.useContext=function(s){return an.current.useContext(s)};ze.useDebugValue=function(){};ze.useDeferredValue=function(s){return an.current.useDeferredValue(s)};ze.useEffect=function(s,e){return an.current.useEffect(s,e)};ze.useId=function(){return an.current.useId()};ze.useImperativeHandle=function(s,e,t){return an.current.useImperativeHandle(s,e,t)};ze.useInsertionEffect=function(s,e){return an.current.useInsertionEffect(s,e)};ze.useLayoutEffect=function(s,e){return an.current.useLayoutEffect(s,e)};ze.useMemo=function(s,e){return an.current.useMemo(s,e)};ze.useReducer=function(s,e,t){return an.current.useReducer(s,e,t)};ze.useRef=function(s){return an.current.useRef(s)};ze.useState=function(s){return an.current.useState(s)};ze.useSyncExternalStore=function(s,e,t){return an.current.useSyncExternalStore(s,e,t)};ze.useTransition=function(){return an.current.useTransition()};ze.version="18.3.1";$k.exports=ze;var S=$k.exports;const Dm=Ok(S),bL=rL({__proto__:null,default:Dm},[S]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SL=S,_L=Symbol.for("react.element"),EL=Symbol.for("react.fragment"),AL=Object.prototype.hasOwnProperty,kL=SL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,TL={key:!0,ref:!0,__self:!0,__source:!0};function Kk(s,e,t){var n,r={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)AL.call(e,n)&&!TL.hasOwnProperty(n)&&(r[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:_L,type:s,key:i,ref:a,props:r,_owner:kL.current}}Fy.Fragment=EL;Fy.jsx=Kk;Fy.jsxs=Kk;Fk.exports=Fy;var c=Fk.exports,Xk={exports:{}},er={},Yk={exports:{}},Jk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(M,$){var K=M.length;M.push($);e:for(;0<K;){var J=K-1>>>1,Z=M[J];if(0<r(Z,$))M[J]=$,M[K]=Z,K=J;else break e}}function t(M){return M.length===0?null:M[0]}function n(M){if(M.length===0)return null;var $=M[0],K=M.pop();if(K!==$){M[0]=K;e:for(var J=0,Z=M.length,pe=Z>>>1;J<pe;){var Se=2*(J+1)-1,Pe=M[Se],H=Se+1,X=M[H];if(0>r(Pe,K))H<Z&&0>r(X,Pe)?(M[J]=X,M[H]=K,J=H):(M[J]=Pe,M[Se]=K,J=Se);else if(H<Z&&0>r(X,K))M[J]=X,M[H]=K,J=H;else break e}}return $}function r(M,$){var K=M.sortIndex-$.sortIndex;return K!==0?K:M.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,f=null,p=3,m=!1,g=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(M){for(var $=t(u);$!==null;){if($.callback===null)n(u);else if($.startTime<=M)n(u),$.sortIndex=$.expirationTime,e(l,$);else break;$=t(u)}}function E(M){if(y=!1,w(M),!g)if(t(l)!==null)g=!0,F(T);else{var $=t(u);$!==null&&B(E,$.startTime-M)}}function T(M,$){g=!1,y&&(y=!1,v(j),j=-1),m=!0;var K=p;try{for(w($),f=t(l);f!==null&&(!(f.expirationTime>$)||M&&!z());){var J=f.callback;if(typeof J=="function"){f.callback=null,p=f.priorityLevel;var Z=J(f.expirationTime<=$);$=s.unstable_now(),typeof Z=="function"?f.callback=Z:f===t(l)&&n(l),w($)}else n(l);f=t(l)}if(f!==null)var pe=!0;else{var Se=t(u);Se!==null&&B(E,Se.startTime-$),pe=!1}return pe}finally{f=null,p=K,m=!1}}var C=!1,N=null,j=-1,R=5,D=-1;function z(){return!(s.unstable_now()-D<R)}function L(){if(N!==null){var M=s.unstable_now();D=M;var $=!0;try{$=N(!0,M)}finally{$?I():(C=!1,N=null)}}else C=!1}var I;if(typeof x=="function")I=function(){x(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,Y=O.port2;O.port1.onmessage=L,I=function(){Y.postMessage(null)}}else I=function(){b(L,0)};function F(M){N=M,C||(C=!0,I())}function B(M,$){j=b(function(){M(s.unstable_now())},$)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(M){M.callback=null},s.unstable_continueExecution=function(){g||m||(g=!0,F(T))},s.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<M?Math.floor(1e3/M):5},s.unstable_getCurrentPriorityLevel=function(){return p},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(M){switch(p){case 1:case 2:case 3:var $=3;break;default:$=p}var K=p;p=$;try{return M()}finally{p=K}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(M,$){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var K=p;p=M;try{return $()}finally{p=K}},s.unstable_scheduleCallback=function(M,$,K){var J=s.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?J+K:J):K=J,M){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=K+Z,M={id:h++,callback:$,priorityLevel:M,startTime:K,expirationTime:Z,sortIndex:-1},K>J?(M.sortIndex=K,e(u,M),t(l)===null&&M===t(u)&&(y?(v(j),j=-1):y=!0,B(E,K-J))):(M.sortIndex=Z,e(l,M),g||m||(g=!0,F(T))),M},s.unstable_shouldYield=z,s.unstable_wrapCallback=function(M){var $=p;return function(){var K=p;p=$;try{return M.apply(this,arguments)}finally{p=K}}}})(Jk);Yk.exports=Jk;var CL=Yk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NL=S,Qn=CL;function ne(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Qk=new Set,Nf={};function Jc(s,e){sh(s,e),sh(s+"Capture",e)}function sh(s,e){for(Nf[s]=e,s=0;s<e.length;s++)Qk.add(e[s])}var Pa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ix=Object.prototype.hasOwnProperty,jL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fE={},pE={};function PL(s){return Ix.call(pE,s)?!0:Ix.call(fE,s)?!1:jL.test(s)?pE[s]=!0:(fE[s]=!0,!1)}function RL(s,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function LL(s,e,t,n){if(e===null||typeof e>"u"||RL(s,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function on(s,e,t,n,r,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Ts={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){Ts[s]=new on(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];Ts[e]=new on(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){Ts[s]=new on(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){Ts[s]=new on(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){Ts[s]=new on(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){Ts[s]=new on(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){Ts[s]=new on(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){Ts[s]=new on(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){Ts[s]=new on(s,5,!1,s.toLowerCase(),null,!1,!1)});var xS=/[\-:]([a-z])/g;function wS(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(xS,wS);Ts[e]=new on(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(xS,wS);Ts[e]=new on(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(xS,wS);Ts[e]=new on(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){Ts[s]=new on(s,1,!1,s.toLowerCase(),null,!1,!1)});Ts.xlinkHref=new on("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){Ts[s]=new on(s,1,!1,s.toLowerCase(),null,!0,!0)});function bS(s,e,t,n){var r=Ts.hasOwnProperty(e)?Ts[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(LL(e,t,r,n)&&(t=null),n||r===null?PL(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):r.mustUseProperty?s[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?s.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?s.setAttributeNS(n,e,t):s.setAttribute(e,t))))}var $a=NL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rg=Symbol.for("react.element"),Su=Symbol.for("react.portal"),_u=Symbol.for("react.fragment"),SS=Symbol.for("react.strict_mode"),Ox=Symbol.for("react.profiler"),Zk=Symbol.for("react.provider"),eT=Symbol.for("react.context"),_S=Symbol.for("react.forward_ref"),Fx=Symbol.for("react.suspense"),$x=Symbol.for("react.suspense_list"),ES=Symbol.for("react.memo"),Ka=Symbol.for("react.lazy"),tT=Symbol.for("react.offscreen"),mE=Symbol.iterator;function Sh(s){return s===null||typeof s!="object"?null:(s=mE&&s[mE]||s["@@iterator"],typeof s=="function"?s:null)}var Rt=Object.assign,Pv;function Fh(s){if(Pv===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Pv=e&&e[1]||""}return`
`+Pv+s}var Rv=!1;function Lv(s,e){if(!s||Rv)return"";Rv=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(s,[],e)}else{try{e.call()}catch(u){n=u}s.call(e.prototype)}else{try{throw Error()}catch(u){n=u}s()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=n.stack.split(`
`),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==i[o]){var l=`
`+r[a].replace(" at new "," at ");return s.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",s.displayName)),l}while(1<=a&&0<=o);break}}}finally{Rv=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?Fh(s):""}function DL(s){switch(s.tag){case 5:return Fh(s.type);case 16:return Fh("Lazy");case 13:return Fh("Suspense");case 19:return Fh("SuspenseList");case 0:case 2:case 15:return s=Lv(s.type,!1),s;case 11:return s=Lv(s.type.render,!1),s;case 1:return s=Lv(s.type,!0),s;default:return""}}function Ux(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case _u:return"Fragment";case Su:return"Portal";case Ox:return"Profiler";case SS:return"StrictMode";case Fx:return"Suspense";case $x:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case eT:return(s.displayName||"Context")+".Consumer";case Zk:return(s._context.displayName||"Context")+".Provider";case _S:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case ES:return e=s.displayName||null,e!==null?e:Ux(s.type)||"Memo";case Ka:e=s._payload,s=s._init;try{return Ux(s(e))}catch{}}return null}function ML(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ux(e);case 8:return e===SS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Yo(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function sT(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function IL(s){var e=sT(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),n=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,i=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function ig(s){s._valueTracker||(s._valueTracker=IL(s))}function nT(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return s&&(n=sT(s)?s.checked?"true":"false":s.value),s=n,s!==t?(e.setValue(s),!0):!1}function C0(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Bx(s,e){var t=e.checked;return Rt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function gE(s,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Yo(e.value!=null?e.value:t),s._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function rT(s,e){e=e.checked,e!=null&&bS(s,"checked",e,!1)}function Hx(s,e){rT(s,e);var t=Yo(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(n==="submit"||n==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?Vx(s,e.type,t):e.hasOwnProperty("defaultValue")&&Vx(s,e.type,Yo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function yE(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function Vx(s,e,t){(e!=="number"||C0(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var $h=Array.isArray;function Bu(s,e,t,n){if(s=s.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<s.length;t++)r=e.hasOwnProperty("$"+s[t].value),s[t].selected!==r&&(s[t].selected=r),r&&n&&(s[t].defaultSelected=!0)}else{for(t=""+Yo(t),e=null,r=0;r<s.length;r++){if(s[r].value===t){s[r].selected=!0,n&&(s[r].defaultSelected=!0);return}e!==null||s[r].disabled||(e=s[r])}e!==null&&(e.selected=!0)}}function zx(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return Rt({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function vE(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ne(92));if($h(t)){if(1<t.length)throw Error(ne(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:Yo(t)}}function iT(s,e){var t=Yo(e.value),n=Yo(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),n!=null&&(s.defaultValue=""+n)}function xE(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function aT(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wx(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?aT(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var ag,oT=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return s(e,t,n,r)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(ag=ag||document.createElement("div"),ag.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ag.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function jf(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var hf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},OL=["Webkit","ms","Moz","O"];Object.keys(hf).forEach(function(s){OL.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),hf[e]=hf[s]})});function lT(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||hf.hasOwnProperty(s)&&hf[s]?(""+e).trim():e+"px"}function cT(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=lT(t,e[t],n);t==="float"&&(t="cssFloat"),n?s.setProperty(t,r):s[t]=r}}var FL=Rt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gx(s,e){if(e){if(FL[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function qx(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kx=null;function AS(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Xx=null,Hu=null,Vu=null;function wE(s){if(s=Om(s)){if(typeof Xx!="function")throw Error(ne(280));var e=s.stateNode;e&&(e=Vy(e),Xx(s.stateNode,s.type,e))}}function uT(s){Hu?Vu?Vu.push(s):Vu=[s]:Hu=s}function dT(){if(Hu){var s=Hu,e=Vu;if(Vu=Hu=null,wE(s),e)for(s=0;s<e.length;s++)wE(e[s])}}function hT(s,e){return s(e)}function fT(){}var Dv=!1;function pT(s,e,t){if(Dv)return s(e,t);Dv=!0;try{return hT(s,e,t)}finally{Dv=!1,(Hu!==null||Vu!==null)&&(fT(),dT())}}function Pf(s,e){var t=s.stateNode;if(t===null)return null;var n=Vy(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(s=s.type,n=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!n;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(ne(231,e,typeof t));return t}var Yx=!1;if(Pa)try{var _h={};Object.defineProperty(_h,"passive",{get:function(){Yx=!0}}),window.addEventListener("test",_h,_h),window.removeEventListener("test",_h,_h)}catch{Yx=!1}function $L(s,e,t,n,r,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var ff=!1,N0=null,j0=!1,Jx=null,UL={onError:function(s){ff=!0,N0=s}};function BL(s,e,t,n,r,i,a,o,l){ff=!1,N0=null,$L.apply(UL,arguments)}function HL(s,e,t,n,r,i,a,o,l){if(BL.apply(this,arguments),ff){if(ff){var u=N0;ff=!1,N0=null}else throw Error(ne(198));j0||(j0=!0,Jx=u)}}function Qc(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function mT(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function bE(s){if(Qc(s)!==s)throw Error(ne(188))}function VL(s){var e=s.alternate;if(!e){if(e=Qc(s),e===null)throw Error(ne(188));return e!==s?null:s}for(var t=s,n=e;;){var r=t.return;if(r===null)break;var i=r.alternate;if(i===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===t)return bE(r),s;if(i===n)return bE(r),e;i=i.sibling}throw Error(ne(188))}if(t.return!==n.return)t=r,n=i;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,n=i;break}if(o===n){a=!0,n=r,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,n=r;break}if(o===n){a=!0,n=i,t=r;break}o=o.sibling}if(!a)throw Error(ne(189))}}if(t.alternate!==n)throw Error(ne(190))}if(t.tag!==3)throw Error(ne(188));return t.stateNode.current===t?s:e}function gT(s){return s=VL(s),s!==null?yT(s):null}function yT(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=yT(s);if(e!==null)return e;s=s.sibling}return null}var vT=Qn.unstable_scheduleCallback,SE=Qn.unstable_cancelCallback,zL=Qn.unstable_shouldYield,WL=Qn.unstable_requestPaint,Vt=Qn.unstable_now,GL=Qn.unstable_getCurrentPriorityLevel,kS=Qn.unstable_ImmediatePriority,xT=Qn.unstable_UserBlockingPriority,P0=Qn.unstable_NormalPriority,qL=Qn.unstable_LowPriority,wT=Qn.unstable_IdlePriority,$y=null,Pi=null;function KL(s){if(Pi&&typeof Pi.onCommitFiberRoot=="function")try{Pi.onCommitFiberRoot($y,s,void 0,(s.current.flags&128)===128)}catch{}}var Kr=Math.clz32?Math.clz32:JL,XL=Math.log,YL=Math.LN2;function JL(s){return s>>>=0,s===0?32:31-(XL(s)/YL|0)|0}var og=64,lg=4194304;function Uh(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function R0(s,e){var t=s.pendingLanes;if(t===0)return 0;var n=0,r=s.suspendedLanes,i=s.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?n=Uh(o):(i&=a,i!==0&&(n=Uh(i)))}else a=t&~r,a!==0?n=Uh(a):i!==0&&(n=Uh(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=n;0<e;)t=31-Kr(e),r=1<<t,n|=s[t],e&=~r;return n}function QL(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ZL(s,e){for(var t=s.suspendedLanes,n=s.pingedLanes,r=s.expirationTimes,i=s.pendingLanes;0<i;){var a=31-Kr(i),o=1<<a,l=r[a];l===-1?(!(o&t)||o&n)&&(r[a]=QL(o,e)):l<=e&&(s.expiredLanes|=o),i&=~o}}function Qx(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function bT(){var s=og;return og<<=1,!(og&4194240)&&(og=64),s}function Mv(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function Mm(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-Kr(e),s[e]=t}function eD(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var n=s.eventTimes;for(s=s.expirationTimes;0<t;){var r=31-Kr(t),i=1<<r;e[r]=0,n[r]=-1,s[r]=-1,t&=~i}}function TS(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var n=31-Kr(t),r=1<<n;r&e|s[n]&e&&(s[n]|=e),t&=~r}}var it=0;function ST(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var _T,CS,ET,AT,kT,Zx=!1,cg=[],Bo=null,Ho=null,Vo=null,Rf=new Map,Lf=new Map,Ja=[],tD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _E(s,e){switch(s){case"focusin":case"focusout":Bo=null;break;case"dragenter":case"dragleave":Ho=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":Rf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lf.delete(e.pointerId)}}function Eh(s,e,t,n,r,i){return s===null||s.nativeEvent!==i?(s={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Om(e),e!==null&&CS(e)),s):(s.eventSystemFlags|=n,e=s.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),s)}function sD(s,e,t,n,r){switch(e){case"focusin":return Bo=Eh(Bo,s,e,t,n,r),!0;case"dragenter":return Ho=Eh(Ho,s,e,t,n,r),!0;case"mouseover":return Vo=Eh(Vo,s,e,t,n,r),!0;case"pointerover":var i=r.pointerId;return Rf.set(i,Eh(Rf.get(i)||null,s,e,t,n,r)),!0;case"gotpointercapture":return i=r.pointerId,Lf.set(i,Eh(Lf.get(i)||null,s,e,t,n,r)),!0}return!1}function TT(s){var e=Tl(s.target);if(e!==null){var t=Qc(e);if(t!==null){if(e=t.tag,e===13){if(e=mT(t),e!==null){s.blockedOn=e,kT(s.priority,function(){ET(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Ug(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=ew(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var n=new t.constructor(t.type,t);Kx=n,t.target.dispatchEvent(n),Kx=null}else return e=Om(t),e!==null&&CS(e),s.blockedOn=t,!1;e.shift()}return!0}function EE(s,e,t){Ug(s)&&t.delete(e)}function nD(){Zx=!1,Bo!==null&&Ug(Bo)&&(Bo=null),Ho!==null&&Ug(Ho)&&(Ho=null),Vo!==null&&Ug(Vo)&&(Vo=null),Rf.forEach(EE),Lf.forEach(EE)}function Ah(s,e){s.blockedOn===e&&(s.blockedOn=null,Zx||(Zx=!0,Qn.unstable_scheduleCallback(Qn.unstable_NormalPriority,nD)))}function Df(s){function e(r){return Ah(r,s)}if(0<cg.length){Ah(cg[0],s);for(var t=1;t<cg.length;t++){var n=cg[t];n.blockedOn===s&&(n.blockedOn=null)}}for(Bo!==null&&Ah(Bo,s),Ho!==null&&Ah(Ho,s),Vo!==null&&Ah(Vo,s),Rf.forEach(e),Lf.forEach(e),t=0;t<Ja.length;t++)n=Ja[t],n.blockedOn===s&&(n.blockedOn=null);for(;0<Ja.length&&(t=Ja[0],t.blockedOn===null);)TT(t),t.blockedOn===null&&Ja.shift()}var zu=$a.ReactCurrentBatchConfig,L0=!0;function rD(s,e,t,n){var r=it,i=zu.transition;zu.transition=null;try{it=1,NS(s,e,t,n)}finally{it=r,zu.transition=i}}function iD(s,e,t,n){var r=it,i=zu.transition;zu.transition=null;try{it=4,NS(s,e,t,n)}finally{it=r,zu.transition=i}}function NS(s,e,t,n){if(L0){var r=ew(s,e,t,n);if(r===null)Wv(s,e,n,D0,t),_E(s,n);else if(sD(r,s,e,t,n))n.stopPropagation();else if(_E(s,n),e&4&&-1<tD.indexOf(s)){for(;r!==null;){var i=Om(r);if(i!==null&&_T(i),i=ew(s,e,t,n),i===null&&Wv(s,e,n,D0,t),i===r)break;r=i}r!==null&&n.stopPropagation()}else Wv(s,e,n,null,t)}}var D0=null;function ew(s,e,t,n){if(D0=null,s=AS(n),s=Tl(s),s!==null)if(e=Qc(s),e===null)s=null;else if(t=e.tag,t===13){if(s=mT(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return D0=s,null}function CT(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(GL()){case kS:return 1;case xT:return 4;case P0:case qL:return 16;case wT:return 536870912;default:return 16}default:return 16}}var Fo=null,jS=null,Bg=null;function NT(){if(Bg)return Bg;var s,e=jS,t=e.length,n,r="value"in Fo?Fo.value:Fo.textContent,i=r.length;for(s=0;s<t&&e[s]===r[s];s++);var a=t-s;for(n=1;n<=a&&e[t-n]===r[i-n];n++);return Bg=r.slice(s,1<n?1-n:void 0)}function Hg(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function ug(){return!0}function AE(){return!1}function tr(s){function e(t,n,r,i,a){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in s)s.hasOwnProperty(o)&&(t=s[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ug:AE,this.isPropagationStopped=AE,this}return Rt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ug)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ug)},persist:function(){},isPersistent:ug}),e}var gh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},PS=tr(gh),Im=Rt({},gh,{view:0,detail:0}),aD=tr(Im),Iv,Ov,kh,Uy=Rt({},Im,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RS,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==kh&&(kh&&s.type==="mousemove"?(Iv=s.screenX-kh.screenX,Ov=s.screenY-kh.screenY):Ov=Iv=0,kh=s),Iv)},movementY:function(s){return"movementY"in s?s.movementY:Ov}}),kE=tr(Uy),oD=Rt({},Uy,{dataTransfer:0}),lD=tr(oD),cD=Rt({},Im,{relatedTarget:0}),Fv=tr(cD),uD=Rt({},gh,{animationName:0,elapsedTime:0,pseudoElement:0}),dD=tr(uD),hD=Rt({},gh,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),fD=tr(hD),pD=Rt({},gh,{data:0}),TE=tr(pD),mD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vD(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=yD[s])?!!e[s]:!1}function RS(){return vD}var xD=Rt({},Im,{key:function(s){if(s.key){var e=mD[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=Hg(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?gD[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RS,charCode:function(s){return s.type==="keypress"?Hg(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Hg(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),wD=tr(xD),bD=Rt({},Uy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),CE=tr(bD),SD=Rt({},Im,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RS}),_D=tr(SD),ED=Rt({},gh,{propertyName:0,elapsedTime:0,pseudoElement:0}),AD=tr(ED),kD=Rt({},Uy,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),TD=tr(kD),CD=[9,13,27,32],LS=Pa&&"CompositionEvent"in window,pf=null;Pa&&"documentMode"in document&&(pf=document.documentMode);var ND=Pa&&"TextEvent"in window&&!pf,jT=Pa&&(!LS||pf&&8<pf&&11>=pf),NE=" ",jE=!1;function PT(s,e){switch(s){case"keyup":return CD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function RT(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Eu=!1;function jD(s,e){switch(s){case"compositionend":return RT(e);case"keypress":return e.which!==32?null:(jE=!0,NE);case"textInput":return s=e.data,s===NE&&jE?null:s;default:return null}}function PD(s,e){if(Eu)return s==="compositionend"||!LS&&PT(s,e)?(s=NT(),Bg=jS=Fo=null,Eu=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return jT&&e.locale!=="ko"?null:e.data;default:return null}}var RD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PE(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!RD[s.type]:e==="textarea"}function LT(s,e,t,n){uT(n),e=M0(e,"onChange"),0<e.length&&(t=new PS("onChange","change",null,t,n),s.push({event:t,listeners:e}))}var mf=null,Mf=null;function LD(s){zT(s,0)}function By(s){var e=Tu(s);if(nT(e))return s}function DD(s,e){if(s==="change")return e}var DT=!1;if(Pa){var $v;if(Pa){var Uv="oninput"in document;if(!Uv){var RE=document.createElement("div");RE.setAttribute("oninput","return;"),Uv=typeof RE.oninput=="function"}$v=Uv}else $v=!1;DT=$v&&(!document.documentMode||9<document.documentMode)}function LE(){mf&&(mf.detachEvent("onpropertychange",MT),Mf=mf=null)}function MT(s){if(s.propertyName==="value"&&By(Mf)){var e=[];LT(e,Mf,s,AS(s)),pT(LD,e)}}function MD(s,e,t){s==="focusin"?(LE(),mf=e,Mf=t,mf.attachEvent("onpropertychange",MT)):s==="focusout"&&LE()}function ID(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return By(Mf)}function OD(s,e){if(s==="click")return By(e)}function FD(s,e){if(s==="input"||s==="change")return By(e)}function $D(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Yr=typeof Object.is=="function"?Object.is:$D;function If(s,e){if(Yr(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!Ix.call(e,r)||!Yr(s[r],e[r]))return!1}return!0}function DE(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function ME(s,e){var t=DE(s);s=0;for(var n;t;){if(t.nodeType===3){if(n=s+t.textContent.length,s<=e&&n>=e)return{node:t,offset:e-s};s=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=DE(t)}}function IT(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?IT(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function OT(){for(var s=window,e=C0();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=C0(s.document)}return e}function DS(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function UD(s){var e=OT(),t=s.focusedElem,n=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&IT(t.ownerDocument.documentElement,t)){if(n!==null&&DS(t)){if(e=n.start,s=n.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var r=t.textContent.length,i=Math.min(n.start,r);n=n.end===void 0?i:Math.min(n.end,r),!s.extend&&i>n&&(r=n,n=i,i=r),r=ME(t,i);var a=ME(t,n);r&&a&&(s.rangeCount!==1||s.anchorNode!==r.node||s.anchorOffset!==r.offset||s.focusNode!==a.node||s.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),s.removeAllRanges(),i>n?(s.addRange(e),s.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var BD=Pa&&"documentMode"in document&&11>=document.documentMode,Au=null,tw=null,gf=null,sw=!1;function IE(s,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;sw||Au==null||Au!==C0(n)||(n=Au,"selectionStart"in n&&DS(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),gf&&If(gf,n)||(gf=n,n=M0(tw,"onSelect"),0<n.length&&(e=new PS("onSelect","select",null,e,t),s.push({event:e,listeners:n}),e.target=Au)))}function dg(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var ku={animationend:dg("Animation","AnimationEnd"),animationiteration:dg("Animation","AnimationIteration"),animationstart:dg("Animation","AnimationStart"),transitionend:dg("Transition","TransitionEnd")},Bv={},FT={};Pa&&(FT=document.createElement("div").style,"AnimationEvent"in window||(delete ku.animationend.animation,delete ku.animationiteration.animation,delete ku.animationstart.animation),"TransitionEvent"in window||delete ku.transitionend.transition);function Hy(s){if(Bv[s])return Bv[s];if(!ku[s])return s;var e=ku[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in FT)return Bv[s]=e[t];return s}var $T=Hy("animationend"),UT=Hy("animationiteration"),BT=Hy("animationstart"),HT=Hy("transitionend"),VT=new Map,OE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function il(s,e){VT.set(s,e),Jc(e,[s])}for(var Hv=0;Hv<OE.length;Hv++){var Vv=OE[Hv],HD=Vv.toLowerCase(),VD=Vv[0].toUpperCase()+Vv.slice(1);il(HD,"on"+VD)}il($T,"onAnimationEnd");il(UT,"onAnimationIteration");il(BT,"onAnimationStart");il("dblclick","onDoubleClick");il("focusin","onFocus");il("focusout","onBlur");il(HT,"onTransitionEnd");sh("onMouseEnter",["mouseout","mouseover"]);sh("onMouseLeave",["mouseout","mouseover"]);sh("onPointerEnter",["pointerout","pointerover"]);sh("onPointerLeave",["pointerout","pointerover"]);Jc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Jc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Jc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Jc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Jc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Jc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zD=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bh));function FE(s,e,t){var n=s.type||"unknown-event";s.currentTarget=t,HL(n,e,void 0,s),s.currentTarget=null}function zT(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var n=s[t],r=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&r.isPropagationStopped())break e;FE(r,o,u),i=l}else for(a=0;a<n.length;a++){if(o=n[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&r.isPropagationStopped())break e;FE(r,o,u),i=l}}}if(j0)throw s=Jx,j0=!1,Jx=null,s}function xt(s,e){var t=e[ow];t===void 0&&(t=e[ow]=new Set);var n=s+"__bubble";t.has(n)||(WT(e,s,2,!1),t.add(n))}function zv(s,e,t){var n=0;e&&(n|=4),WT(t,s,n,e)}var hg="_reactListening"+Math.random().toString(36).slice(2);function Of(s){if(!s[hg]){s[hg]=!0,Qk.forEach(function(t){t!=="selectionchange"&&(zD.has(t)||zv(t,!1,s),zv(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[hg]||(e[hg]=!0,zv("selectionchange",!1,e))}}function WT(s,e,t,n){switch(CT(e)){case 1:var r=rD;break;case 4:r=iD;break;default:r=NS}t=r.bind(null,e,t,s),r=void 0,!Yx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?s.addEventListener(e,t,{capture:!0,passive:r}):s.addEventListener(e,t,!0):r!==void 0?s.addEventListener(e,t,{passive:r}):s.addEventListener(e,t,!1)}function Wv(s,e,t,n,r){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=Tl(o),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}o=o.parentNode}}n=n.return}pT(function(){var u=i,h=AS(t),f=[];e:{var p=VT.get(s);if(p!==void 0){var m=PS,g=s;switch(s){case"keypress":if(Hg(t)===0)break e;case"keydown":case"keyup":m=wD;break;case"focusin":g="focus",m=Fv;break;case"focusout":g="blur",m=Fv;break;case"beforeblur":case"afterblur":m=Fv;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=kE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=lD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=_D;break;case $T:case UT:case BT:m=dD;break;case HT:m=AD;break;case"scroll":m=aD;break;case"wheel":m=TD;break;case"copy":case"cut":case"paste":m=fD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=CE}var y=(e&4)!==0,b=!y&&s==="scroll",v=y?p!==null?p+"Capture":null:p;y=[];for(var x=u,w;x!==null;){w=x;var E=w.stateNode;if(w.tag===5&&E!==null&&(w=E,v!==null&&(E=Pf(x,v),E!=null&&y.push(Ff(x,E,w)))),b)break;x=x.return}0<y.length&&(p=new m(p,g,null,t,h),f.push({event:p,listeners:y}))}}if(!(e&7)){e:{if(p=s==="mouseover"||s==="pointerover",m=s==="mouseout"||s==="pointerout",p&&t!==Kx&&(g=t.relatedTarget||t.fromElement)&&(Tl(g)||g[Ra]))break e;if((m||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,m?(g=t.relatedTarget||t.toElement,m=u,g=g?Tl(g):null,g!==null&&(b=Qc(g),g!==b||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=u),m!==g)){if(y=kE,E="onMouseLeave",v="onMouseEnter",x="mouse",(s==="pointerout"||s==="pointerover")&&(y=CE,E="onPointerLeave",v="onPointerEnter",x="pointer"),b=m==null?p:Tu(m),w=g==null?p:Tu(g),p=new y(E,x+"leave",m,t,h),p.target=b,p.relatedTarget=w,E=null,Tl(h)===u&&(y=new y(v,x+"enter",g,t,h),y.target=w,y.relatedTarget=b,E=y),b=E,m&&g)t:{for(y=m,v=g,x=0,w=y;w;w=au(w))x++;for(w=0,E=v;E;E=au(E))w++;for(;0<x-w;)y=au(y),x--;for(;0<w-x;)v=au(v),w--;for(;x--;){if(y===v||v!==null&&y===v.alternate)break t;y=au(y),v=au(v)}y=null}else y=null;m!==null&&$E(f,p,m,y,!1),g!==null&&b!==null&&$E(f,b,g,y,!0)}}e:{if(p=u?Tu(u):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var T=DD;else if(PE(p))if(DT)T=FD;else{T=ID;var C=MD}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(T=OD);if(T&&(T=T(s,u))){LT(f,T,t,h);break e}C&&C(s,p,u),s==="focusout"&&(C=p._wrapperState)&&C.controlled&&p.type==="number"&&Vx(p,"number",p.value)}switch(C=u?Tu(u):window,s){case"focusin":(PE(C)||C.contentEditable==="true")&&(Au=C,tw=u,gf=null);break;case"focusout":gf=tw=Au=null;break;case"mousedown":sw=!0;break;case"contextmenu":case"mouseup":case"dragend":sw=!1,IE(f,t,h);break;case"selectionchange":if(BD)break;case"keydown":case"keyup":IE(f,t,h)}var N;if(LS)e:{switch(s){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else Eu?PT(s,t)&&(j="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(j="onCompositionStart");j&&(jT&&t.locale!=="ko"&&(Eu||j!=="onCompositionStart"?j==="onCompositionEnd"&&Eu&&(N=NT()):(Fo=h,jS="value"in Fo?Fo.value:Fo.textContent,Eu=!0)),C=M0(u,j),0<C.length&&(j=new TE(j,s,null,t,h),f.push({event:j,listeners:C}),N?j.data=N:(N=RT(t),N!==null&&(j.data=N)))),(N=ND?jD(s,t):PD(s,t))&&(u=M0(u,"onBeforeInput"),0<u.length&&(h=new TE("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=N))}zT(f,e)})}function Ff(s,e,t){return{instance:s,listener:e,currentTarget:t}}function M0(s,e){for(var t=e+"Capture",n=[];s!==null;){var r=s,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Pf(s,t),i!=null&&n.unshift(Ff(s,i,r)),i=Pf(s,e),i!=null&&n.push(Ff(s,i,r))),s=s.return}return n}function au(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function $E(s,e,t,n,r){for(var i=e._reactName,a=[];t!==null&&t!==n;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===n)break;o.tag===5&&u!==null&&(o=u,r?(l=Pf(t,i),l!=null&&a.unshift(Ff(t,l,o))):r||(l=Pf(t,i),l!=null&&a.push(Ff(t,l,o)))),t=t.return}a.length!==0&&s.push({event:e,listeners:a})}var WD=/\r\n?/g,GD=/\u0000|\uFFFD/g;function UE(s){return(typeof s=="string"?s:""+s).replace(WD,`
`).replace(GD,"")}function fg(s,e,t){if(e=UE(e),UE(s)!==e&&t)throw Error(ne(425))}function I0(){}var nw=null,rw=null;function iw(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var aw=typeof setTimeout=="function"?setTimeout:void 0,qD=typeof clearTimeout=="function"?clearTimeout:void 0,BE=typeof Promise=="function"?Promise:void 0,KD=typeof queueMicrotask=="function"?queueMicrotask:typeof BE<"u"?function(s){return BE.resolve(null).then(s).catch(XD)}:aw;function XD(s){setTimeout(function(){throw s})}function Gv(s,e){var t=e,n=0;do{var r=t.nextSibling;if(s.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){s.removeChild(r),Df(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);Df(e)}function zo(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function HE(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var yh=Math.random().toString(36).slice(2),Ci="__reactFiber$"+yh,$f="__reactProps$"+yh,Ra="__reactContainer$"+yh,ow="__reactEvents$"+yh,YD="__reactListeners$"+yh,JD="__reactHandles$"+yh;function Tl(s){var e=s[Ci];if(e)return e;for(var t=s.parentNode;t;){if(e=t[Ra]||t[Ci]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=HE(s);s!==null;){if(t=s[Ci])return t;s=HE(s)}return e}s=t,t=s.parentNode}return null}function Om(s){return s=s[Ci]||s[Ra],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Tu(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(ne(33))}function Vy(s){return s[$f]||null}var lw=[],Cu=-1;function al(s){return{current:s}}function wt(s){0>Cu||(s.current=lw[Cu],lw[Cu]=null,Cu--)}function gt(s,e){Cu++,lw[Cu]=s.current,s.current=e}var Jo={},Vs=al(Jo),bn=al(!1),zc=Jo;function nh(s,e){var t=s.type.contextTypes;if(!t)return Jo;var n=s.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in t)r[i]=e[i];return n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=r),r}function Sn(s){return s=s.childContextTypes,s!=null}function O0(){wt(bn),wt(Vs)}function VE(s,e,t){if(Vs.current!==Jo)throw Error(ne(168));gt(Vs,e),gt(bn,t)}function GT(s,e,t){var n=s.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(ne(108,ML(s)||"Unknown",r));return Rt({},t,n)}function F0(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Jo,zc=Vs.current,gt(Vs,s),gt(bn,bn.current),!0}function zE(s,e,t){var n=s.stateNode;if(!n)throw Error(ne(169));t?(s=GT(s,e,zc),n.__reactInternalMemoizedMergedChildContext=s,wt(bn),wt(Vs),gt(Vs,s)):wt(bn),gt(bn,t)}var Wi=null,zy=!1,qv=!1;function qT(s){Wi===null?Wi=[s]:Wi.push(s)}function QD(s){zy=!0,qT(s)}function ol(){if(!qv&&Wi!==null){qv=!0;var s=0,e=it;try{var t=Wi;for(it=1;s<t.length;s++){var n=t[s];do n=n(!0);while(n!==null)}Wi=null,zy=!1}catch(r){throw Wi!==null&&(Wi=Wi.slice(s+1)),vT(kS,ol),r}finally{it=e,qv=!1}}return null}var Nu=[],ju=0,$0=null,U0=0,gr=[],yr=0,Wc=null,Sa=1,_a="";function ml(s,e){Nu[ju++]=U0,Nu[ju++]=$0,$0=s,U0=e}function KT(s,e,t){gr[yr++]=Sa,gr[yr++]=_a,gr[yr++]=Wc,Wc=s;var n=Sa;s=_a;var r=32-Kr(n)-1;n&=~(1<<r),t+=1;var i=32-Kr(e)+r;if(30<i){var a=r-r%5;i=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Sa=1<<32-Kr(e)+r|t<<r|n,_a=i+s}else Sa=1<<i|t<<r|n,_a=s}function MS(s){s.return!==null&&(ml(s,1),KT(s,1,0))}function IS(s){for(;s===$0;)$0=Nu[--ju],Nu[ju]=null,U0=Nu[--ju],Nu[ju]=null;for(;s===Wc;)Wc=gr[--yr],gr[yr]=null,_a=gr[--yr],gr[yr]=null,Sa=gr[--yr],gr[yr]=null}var Yn=null,Xn=null,kt=!1,Wr=null;function XT(s,e){var t=xr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function WE(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,Yn=s,Xn=zo(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,Yn=s,Xn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Wc!==null?{id:Sa,overflow:_a}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=xr(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,Yn=s,Xn=null,!0):!1;default:return!1}}function cw(s){return(s.mode&1)!==0&&(s.flags&128)===0}function uw(s){if(kt){var e=Xn;if(e){var t=e;if(!WE(s,e)){if(cw(s))throw Error(ne(418));e=zo(t.nextSibling);var n=Yn;e&&WE(s,e)?XT(n,t):(s.flags=s.flags&-4097|2,kt=!1,Yn=s)}}else{if(cw(s))throw Error(ne(418));s.flags=s.flags&-4097|2,kt=!1,Yn=s}}}function GE(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Yn=s}function pg(s){if(s!==Yn)return!1;if(!kt)return GE(s),kt=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!iw(s.type,s.memoizedProps)),e&&(e=Xn)){if(cw(s))throw YT(),Error(ne(418));for(;e;)XT(s,e),e=zo(e.nextSibling)}if(GE(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ne(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){Xn=zo(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}Xn=null}}else Xn=Yn?zo(s.stateNode.nextSibling):null;return!0}function YT(){for(var s=Xn;s;)s=zo(s.nextSibling)}function rh(){Xn=Yn=null,kt=!1}function OS(s){Wr===null?Wr=[s]:Wr.push(s)}var ZD=$a.ReactCurrentBatchConfig;function Th(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ne(309));var n=t.stateNode}if(!n)throw Error(ne(147,s));var r=n,i=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=r.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof s!="string")throw Error(ne(284));if(!t._owner)throw Error(ne(290,s))}return s}function mg(s,e){throw s=Object.prototype.toString.call(e),Error(ne(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function qE(s){var e=s._init;return e(s._payload)}function JT(s){function e(v,x){if(s){var w=v.deletions;w===null?(v.deletions=[x],v.flags|=16):w.push(x)}}function t(v,x){if(!s)return null;for(;x!==null;)e(v,x),x=x.sibling;return null}function n(v,x){for(v=new Map;x!==null;)x.key!==null?v.set(x.key,x):v.set(x.index,x),x=x.sibling;return v}function r(v,x){return v=Ko(v,x),v.index=0,v.sibling=null,v}function i(v,x,w){return v.index=w,s?(w=v.alternate,w!==null?(w=w.index,w<x?(v.flags|=2,x):w):(v.flags|=2,x)):(v.flags|=1048576,x)}function a(v){return s&&v.alternate===null&&(v.flags|=2),v}function o(v,x,w,E){return x===null||x.tag!==6?(x=ex(w,v.mode,E),x.return=v,x):(x=r(x,w),x.return=v,x)}function l(v,x,w,E){var T=w.type;return T===_u?h(v,x,w.props.children,E,w.key):x!==null&&(x.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Ka&&qE(T)===x.type)?(E=r(x,w.props),E.ref=Th(v,x,w),E.return=v,E):(E=Xg(w.type,w.key,w.props,null,v.mode,E),E.ref=Th(v,x,w),E.return=v,E)}function u(v,x,w,E){return x===null||x.tag!==4||x.stateNode.containerInfo!==w.containerInfo||x.stateNode.implementation!==w.implementation?(x=tx(w,v.mode,E),x.return=v,x):(x=r(x,w.children||[]),x.return=v,x)}function h(v,x,w,E,T){return x===null||x.tag!==7?(x=Uc(w,v.mode,E,T),x.return=v,x):(x=r(x,w),x.return=v,x)}function f(v,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return x=ex(""+x,v.mode,w),x.return=v,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case rg:return w=Xg(x.type,x.key,x.props,null,v.mode,w),w.ref=Th(v,null,x),w.return=v,w;case Su:return x=tx(x,v.mode,w),x.return=v,x;case Ka:var E=x._init;return f(v,E(x._payload),w)}if($h(x)||Sh(x))return x=Uc(x,v.mode,w,null),x.return=v,x;mg(v,x)}return null}function p(v,x,w,E){var T=x!==null?x.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return T!==null?null:o(v,x,""+w,E);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case rg:return w.key===T?l(v,x,w,E):null;case Su:return w.key===T?u(v,x,w,E):null;case Ka:return T=w._init,p(v,x,T(w._payload),E)}if($h(w)||Sh(w))return T!==null?null:h(v,x,w,E,null);mg(v,w)}return null}function m(v,x,w,E,T){if(typeof E=="string"&&E!==""||typeof E=="number")return v=v.get(w)||null,o(x,v,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case rg:return v=v.get(E.key===null?w:E.key)||null,l(x,v,E,T);case Su:return v=v.get(E.key===null?w:E.key)||null,u(x,v,E,T);case Ka:var C=E._init;return m(v,x,w,C(E._payload),T)}if($h(E)||Sh(E))return v=v.get(w)||null,h(x,v,E,T,null);mg(x,E)}return null}function g(v,x,w,E){for(var T=null,C=null,N=x,j=x=0,R=null;N!==null&&j<w.length;j++){N.index>j?(R=N,N=null):R=N.sibling;var D=p(v,N,w[j],E);if(D===null){N===null&&(N=R);break}s&&N&&D.alternate===null&&e(v,N),x=i(D,x,j),C===null?T=D:C.sibling=D,C=D,N=R}if(j===w.length)return t(v,N),kt&&ml(v,j),T;if(N===null){for(;j<w.length;j++)N=f(v,w[j],E),N!==null&&(x=i(N,x,j),C===null?T=N:C.sibling=N,C=N);return kt&&ml(v,j),T}for(N=n(v,N);j<w.length;j++)R=m(N,v,j,w[j],E),R!==null&&(s&&R.alternate!==null&&N.delete(R.key===null?j:R.key),x=i(R,x,j),C===null?T=R:C.sibling=R,C=R);return s&&N.forEach(function(z){return e(v,z)}),kt&&ml(v,j),T}function y(v,x,w,E){var T=Sh(w);if(typeof T!="function")throw Error(ne(150));if(w=T.call(w),w==null)throw Error(ne(151));for(var C=T=null,N=x,j=x=0,R=null,D=w.next();N!==null&&!D.done;j++,D=w.next()){N.index>j?(R=N,N=null):R=N.sibling;var z=p(v,N,D.value,E);if(z===null){N===null&&(N=R);break}s&&N&&z.alternate===null&&e(v,N),x=i(z,x,j),C===null?T=z:C.sibling=z,C=z,N=R}if(D.done)return t(v,N),kt&&ml(v,j),T;if(N===null){for(;!D.done;j++,D=w.next())D=f(v,D.value,E),D!==null&&(x=i(D,x,j),C===null?T=D:C.sibling=D,C=D);return kt&&ml(v,j),T}for(N=n(v,N);!D.done;j++,D=w.next())D=m(N,v,j,D.value,E),D!==null&&(s&&D.alternate!==null&&N.delete(D.key===null?j:D.key),x=i(D,x,j),C===null?T=D:C.sibling=D,C=D);return s&&N.forEach(function(L){return e(v,L)}),kt&&ml(v,j),T}function b(v,x,w,E){if(typeof w=="object"&&w!==null&&w.type===_u&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case rg:e:{for(var T=w.key,C=x;C!==null;){if(C.key===T){if(T=w.type,T===_u){if(C.tag===7){t(v,C.sibling),x=r(C,w.props.children),x.return=v,v=x;break e}}else if(C.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Ka&&qE(T)===C.type){t(v,C.sibling),x=r(C,w.props),x.ref=Th(v,C,w),x.return=v,v=x;break e}t(v,C);break}else e(v,C);C=C.sibling}w.type===_u?(x=Uc(w.props.children,v.mode,E,w.key),x.return=v,v=x):(E=Xg(w.type,w.key,w.props,null,v.mode,E),E.ref=Th(v,x,w),E.return=v,v=E)}return a(v);case Su:e:{for(C=w.key;x!==null;){if(x.key===C)if(x.tag===4&&x.stateNode.containerInfo===w.containerInfo&&x.stateNode.implementation===w.implementation){t(v,x.sibling),x=r(x,w.children||[]),x.return=v,v=x;break e}else{t(v,x);break}else e(v,x);x=x.sibling}x=tx(w,v.mode,E),x.return=v,v=x}return a(v);case Ka:return C=w._init,b(v,x,C(w._payload),E)}if($h(w))return g(v,x,w,E);if(Sh(w))return y(v,x,w,E);mg(v,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,x!==null&&x.tag===6?(t(v,x.sibling),x=r(x,w),x.return=v,v=x):(t(v,x),x=ex(w,v.mode,E),x.return=v,v=x),a(v)):t(v,x)}return b}var ih=JT(!0),QT=JT(!1),B0=al(null),H0=null,Pu=null,FS=null;function $S(){FS=Pu=H0=null}function US(s){var e=B0.current;wt(B0),s._currentValue=e}function dw(s,e,t){for(;s!==null;){var n=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),s===t)break;s=s.return}}function Wu(s,e){H0=s,FS=Pu=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(wn=!0),s.firstContext=null)}function _r(s){var e=s._currentValue;if(FS!==s)if(s={context:s,memoizedValue:e,next:null},Pu===null){if(H0===null)throw Error(ne(308));Pu=s,H0.dependencies={lanes:0,firstContext:s}}else Pu=Pu.next=s;return e}var Cl=null;function BS(s){Cl===null?Cl=[s]:Cl.push(s)}function ZT(s,e,t,n){var r=e.interleaved;return r===null?(t.next=t,BS(e)):(t.next=r.next,r.next=t),e.interleaved=t,La(s,n)}function La(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var Xa=!1;function HS(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eC(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Aa(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function Wo(s,e,t){var n=s.updateQueue;if(n===null)return null;if(n=n.shared,Ke&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,La(s,t)}return r=n.interleaved,r===null?(e.next=e,BS(n)):(e.next=r.next,r.next=e),n.interleaved=e,La(s,t)}function Vg(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,TS(s,t)}}function KE(s,e){var t=s.updateQueue,n=s.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?r=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?r=i=e:i=i.next=e}else r=i=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:n.shared,effects:n.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function V0(s,e,t,n){var r=s.updateQueue;Xa=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var h=s.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=r.baseState;a=0,h=u=l=null,o=i;do{var p=o.lane,m=o.eventTime;if((n&p)===p){h!==null&&(h=h.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=s,y=o;switch(p=e,m=t,y.tag){case 1:if(g=y.payload,typeof g=="function"){f=g.call(m,f,p);break e}f=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,p=typeof g=="function"?g.call(m,f,p):g,p==null)break e;f=Rt({},f,p);break e;case 2:Xa=!0}}o.callback!==null&&o.lane!==0&&(s.flags|=64,p=r.effects,p===null?r.effects=[o]:p.push(o))}else m={eventTime:m,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=m,l=f):h=h.next=m,a|=p;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;p=o,o=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(!0);if(h===null&&(l=f),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);qc|=a,s.lanes=a,s.memoizedState=f}}function XE(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var n=s[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(ne(191,r));r.call(n)}}}var Fm={},Ri=al(Fm),Uf=al(Fm),Bf=al(Fm);function Nl(s){if(s===Fm)throw Error(ne(174));return s}function VS(s,e){switch(gt(Bf,e),gt(Uf,s),gt(Ri,Fm),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Wx(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=Wx(e,s)}wt(Ri),gt(Ri,e)}function ah(){wt(Ri),wt(Uf),wt(Bf)}function tC(s){Nl(Bf.current);var e=Nl(Ri.current),t=Wx(e,s.type);e!==t&&(gt(Uf,s),gt(Ri,t))}function zS(s){Uf.current===s&&(wt(Ri),wt(Uf))}var Nt=al(0);function z0(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Kv=[];function WS(){for(var s=0;s<Kv.length;s++)Kv[s]._workInProgressVersionPrimary=null;Kv.length=0}var zg=$a.ReactCurrentDispatcher,Xv=$a.ReactCurrentBatchConfig,Gc=0,Pt=null,ns=null,ps=null,W0=!1,yf=!1,Hf=0,eM=0;function Rs(){throw Error(ne(321))}function GS(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!Yr(s[t],e[t]))return!1;return!0}function qS(s,e,t,n,r,i){if(Gc=i,Pt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,zg.current=s===null||s.memoizedState===null?rM:iM,s=t(n,r),yf){i=0;do{if(yf=!1,Hf=0,25<=i)throw Error(ne(301));i+=1,ps=ns=null,e.updateQueue=null,zg.current=aM,s=t(n,r)}while(yf)}if(zg.current=G0,e=ns!==null&&ns.next!==null,Gc=0,ps=ns=Pt=null,W0=!1,e)throw Error(ne(300));return s}function KS(){var s=Hf!==0;return Hf=0,s}function ci(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ps===null?Pt.memoizedState=ps=s:ps=ps.next=s,ps}function Er(){if(ns===null){var s=Pt.alternate;s=s!==null?s.memoizedState:null}else s=ns.next;var e=ps===null?Pt.memoizedState:ps.next;if(e!==null)ps=e,ns=s;else{if(s===null)throw Error(ne(310));ns=s,s={memoizedState:ns.memoizedState,baseState:ns.baseState,baseQueue:ns.baseQueue,queue:ns.queue,next:null},ps===null?Pt.memoizedState=ps=s:ps=ps.next=s}return ps}function Vf(s,e){return typeof e=="function"?e(s):e}function Yv(s){var e=Er(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=s;var n=ns,r=n.baseQueue,i=t.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}n.baseQueue=r=i,t.pending=null}if(r!==null){i=r.next,n=n.baseState;var o=a=null,l=null,u=i;do{var h=u.lane;if((Gc&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:s(n,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=f,a=n):l=l.next=f,Pt.lanes|=h,qc|=h}u=u.next}while(u!==null&&u!==i);l===null?a=n:l.next=o,Yr(n,e.memoizedState)||(wn=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=l,t.lastRenderedState=n}if(s=t.interleaved,s!==null){r=s;do i=r.lane,Pt.lanes|=i,qc|=i,r=r.next;while(r!==s)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Jv(s){var e=Er(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=s;var n=t.dispatch,r=t.pending,i=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do i=s(i,a.action),a=a.next;while(a!==r);Yr(i,e.memoizedState)||(wn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function sC(){}function nC(s,e){var t=Pt,n=Er(),r=e(),i=!Yr(n.memoizedState,r);if(i&&(n.memoizedState=r,wn=!0),n=n.queue,XS(aC.bind(null,t,n,s),[s]),n.getSnapshot!==e||i||ps!==null&&ps.memoizedState.tag&1){if(t.flags|=2048,zf(9,iC.bind(null,t,n,r,e),void 0,null),ms===null)throw Error(ne(349));Gc&30||rC(t,e,r)}return r}function rC(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Pt.updateQueue,e===null?(e={lastEffect:null,stores:null},Pt.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function iC(s,e,t,n){e.value=t,e.getSnapshot=n,oC(e)&&lC(s)}function aC(s,e,t){return t(function(){oC(e)&&lC(s)})}function oC(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Yr(s,t)}catch{return!0}}function lC(s){var e=La(s,1);e!==null&&Xr(e,s,1,-1)}function YE(s){var e=ci();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vf,lastRenderedState:s},e.queue=s,s=s.dispatch=nM.bind(null,Pt,s),[e.memoizedState,s]}function zf(s,e,t,n){return s={tag:s,create:e,destroy:t,deps:n,next:null},e=Pt.updateQueue,e===null?(e={lastEffect:null,stores:null},Pt.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(n=t.next,t.next=s,s.next=n,e.lastEffect=s)),s}function cC(){return Er().memoizedState}function Wg(s,e,t,n){var r=ci();Pt.flags|=s,r.memoizedState=zf(1|e,t,void 0,n===void 0?null:n)}function Wy(s,e,t,n){var r=Er();n=n===void 0?null:n;var i=void 0;if(ns!==null){var a=ns.memoizedState;if(i=a.destroy,n!==null&&GS(n,a.deps)){r.memoizedState=zf(e,t,i,n);return}}Pt.flags|=s,r.memoizedState=zf(1|e,t,i,n)}function JE(s,e){return Wg(8390656,8,s,e)}function XS(s,e){return Wy(2048,8,s,e)}function uC(s,e){return Wy(4,2,s,e)}function dC(s,e){return Wy(4,4,s,e)}function hC(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function fC(s,e,t){return t=t!=null?t.concat([s]):null,Wy(4,4,hC.bind(null,e,s),t)}function YS(){}function pC(s,e){var t=Er();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&GS(e,n[1])?n[0]:(t.memoizedState=[s,e],s)}function mC(s,e){var t=Er();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&GS(e,n[1])?n[0]:(s=s(),t.memoizedState=[s,e],s)}function gC(s,e,t){return Gc&21?(Yr(t,e)||(t=bT(),Pt.lanes|=t,qc|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,wn=!0),s.memoizedState=t)}function tM(s,e){var t=it;it=t!==0&&4>t?t:4,s(!0);var n=Xv.transition;Xv.transition={};try{s(!1),e()}finally{it=t,Xv.transition=n}}function yC(){return Er().memoizedState}function sM(s,e,t){var n=qo(s);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},vC(s))xC(e,t);else if(t=ZT(s,e,t,n),t!==null){var r=nn();Xr(t,s,n,r),wC(t,e,n)}}function nM(s,e,t){var n=qo(s),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(vC(s))xC(e,r);else{var i=s.alternate;if(s.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(r.hasEagerState=!0,r.eagerState=o,Yr(o,a)){var l=e.interleaved;l===null?(r.next=r,BS(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=ZT(s,e,r,n),t!==null&&(r=nn(),Xr(t,s,n,r),wC(t,e,n))}}function vC(s){var e=s.alternate;return s===Pt||e!==null&&e===Pt}function xC(s,e){yf=W0=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function wC(s,e,t){if(t&4194240){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,TS(s,t)}}var G0={readContext:_r,useCallback:Rs,useContext:Rs,useEffect:Rs,useImperativeHandle:Rs,useInsertionEffect:Rs,useLayoutEffect:Rs,useMemo:Rs,useReducer:Rs,useRef:Rs,useState:Rs,useDebugValue:Rs,useDeferredValue:Rs,useTransition:Rs,useMutableSource:Rs,useSyncExternalStore:Rs,useId:Rs,unstable_isNewReconciler:!1},rM={readContext:_r,useCallback:function(s,e){return ci().memoizedState=[s,e===void 0?null:e],s},useContext:_r,useEffect:JE,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,Wg(4194308,4,hC.bind(null,e,s),t)},useLayoutEffect:function(s,e){return Wg(4194308,4,s,e)},useInsertionEffect:function(s,e){return Wg(4,2,s,e)},useMemo:function(s,e){var t=ci();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var n=ci();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},n.queue=s,s=s.dispatch=sM.bind(null,Pt,s),[n.memoizedState,s]},useRef:function(s){var e=ci();return s={current:s},e.memoizedState=s},useState:YE,useDebugValue:YS,useDeferredValue:function(s){return ci().memoizedState=s},useTransition:function(){var s=YE(!1),e=s[0];return s=tM.bind(null,s[1]),ci().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var n=Pt,r=ci();if(kt){if(t===void 0)throw Error(ne(407));t=t()}else{if(t=e(),ms===null)throw Error(ne(349));Gc&30||rC(n,e,t)}r.memoizedState=t;var i={value:t,getSnapshot:e};return r.queue=i,JE(aC.bind(null,n,i,s),[s]),n.flags|=2048,zf(9,iC.bind(null,n,i,t,e),void 0,null),t},useId:function(){var s=ci(),e=ms.identifierPrefix;if(kt){var t=_a,n=Sa;t=(n&~(1<<32-Kr(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Hf++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=eM++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},iM={readContext:_r,useCallback:pC,useContext:_r,useEffect:XS,useImperativeHandle:fC,useInsertionEffect:uC,useLayoutEffect:dC,useMemo:mC,useReducer:Yv,useRef:cC,useState:function(){return Yv(Vf)},useDebugValue:YS,useDeferredValue:function(s){var e=Er();return gC(e,ns.memoizedState,s)},useTransition:function(){var s=Yv(Vf)[0],e=Er().memoizedState;return[s,e]},useMutableSource:sC,useSyncExternalStore:nC,useId:yC,unstable_isNewReconciler:!1},aM={readContext:_r,useCallback:pC,useContext:_r,useEffect:XS,useImperativeHandle:fC,useInsertionEffect:uC,useLayoutEffect:dC,useMemo:mC,useReducer:Jv,useRef:cC,useState:function(){return Jv(Vf)},useDebugValue:YS,useDeferredValue:function(s){var e=Er();return ns===null?e.memoizedState=s:gC(e,ns.memoizedState,s)},useTransition:function(){var s=Jv(Vf)[0],e=Er().memoizedState;return[s,e]},useMutableSource:sC,useSyncExternalStore:nC,useId:yC,unstable_isNewReconciler:!1};function jr(s,e){if(s&&s.defaultProps){e=Rt({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}function hw(s,e,t,n){e=s.memoizedState,t=t(n,e),t=t==null?e:Rt({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var Gy={isMounted:function(s){return(s=s._reactInternals)?Qc(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var n=nn(),r=qo(s),i=Aa(n,r);i.payload=e,t!=null&&(i.callback=t),e=Wo(s,i,r),e!==null&&(Xr(e,s,r,n),Vg(e,s,r))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var n=nn(),r=qo(s),i=Aa(n,r);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Wo(s,i,r),e!==null&&(Xr(e,s,r,n),Vg(e,s,r))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=nn(),n=qo(s),r=Aa(t,n);r.tag=2,e!=null&&(r.callback=e),e=Wo(s,r,n),e!==null&&(Xr(e,s,n,t),Vg(e,s,n))}};function QE(s,e,t,n,r,i,a){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(n,i,a):e.prototype&&e.prototype.isPureReactComponent?!If(t,n)||!If(r,i):!0}function bC(s,e,t){var n=!1,r=Jo,i=e.contextType;return typeof i=="object"&&i!==null?i=_r(i):(r=Sn(e)?zc:Vs.current,n=e.contextTypes,i=(n=n!=null)?nh(s,r):Jo),e=new e(t,i),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Gy,s.stateNode=e,e._reactInternals=s,n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=i),e}function ZE(s,e,t,n){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==s&&Gy.enqueueReplaceState(e,e.state,null)}function fw(s,e,t,n){var r=s.stateNode;r.props=t,r.state=s.memoizedState,r.refs={},HS(s);var i=e.contextType;typeof i=="object"&&i!==null?r.context=_r(i):(i=Sn(e)?zc:Vs.current,r.context=nh(s,i)),r.state=s.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(hw(s,e,i,t),r.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Gy.enqueueReplaceState(r,r.state,null),V0(s,t,r,n),r.state=s.memoizedState),typeof r.componentDidMount=="function"&&(s.flags|=4194308)}function oh(s,e){try{var t="",n=e;do t+=DL(n),n=n.return;while(n);var r=t}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:s,source:e,stack:r,digest:null}}function Qv(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function pw(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var oM=typeof WeakMap=="function"?WeakMap:Map;function SC(s,e,t){t=Aa(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){K0||(K0=!0,Ew=n),pw(s,e)},t}function _C(s,e,t){t=Aa(-1,t),t.tag=3;var n=s.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){pw(s,e)}}var i=s.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){pw(s,e),typeof n!="function"&&(Go===null?Go=new Set([this]):Go.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function e1(s,e,t){var n=s.pingCache;if(n===null){n=s.pingCache=new oM;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),s=bM.bind(null,s,e,t),e.then(s,s))}function t1(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function s1(s,e,t,n,r){return s.mode&1?(s.flags|=65536,s.lanes=r,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Aa(-1,1),e.tag=2,Wo(t,e,1))),t.lanes|=1),s)}var lM=$a.ReactCurrentOwner,wn=!1;function Zs(s,e,t,n){e.child=s===null?QT(e,null,t,n):ih(e,s.child,t,n)}function n1(s,e,t,n,r){t=t.render;var i=e.ref;return Wu(e,r),n=qS(s,e,t,n,i,r),t=KS(),s!==null&&!wn?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,Da(s,e,r)):(kt&&t&&MS(e),e.flags|=1,Zs(s,e,n,r),e.child)}function r1(s,e,t,n,r){if(s===null){var i=t.type;return typeof i=="function"&&!r_(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,EC(s,e,i,n,r)):(s=Xg(t.type,null,n,e,e.mode,r),s.ref=e.ref,s.return=e,e.child=s)}if(i=s.child,!(s.lanes&r)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:If,t(a,n)&&s.ref===e.ref)return Da(s,e,r)}return e.flags|=1,s=Ko(i,n),s.ref=e.ref,s.return=e,e.child=s}function EC(s,e,t,n,r){if(s!==null){var i=s.memoizedProps;if(If(i,n)&&s.ref===e.ref)if(wn=!1,e.pendingProps=n=i,(s.lanes&r)!==0)s.flags&131072&&(wn=!0);else return e.lanes=s.lanes,Da(s,e,r)}return mw(s,e,t,n,r)}function AC(s,e,t){var n=e.pendingProps,r=n.children,i=s!==null?s.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},gt(Lu,Gn),Gn|=t;else{if(!(t&1073741824))return s=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,gt(Lu,Gn),Gn|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,gt(Lu,Gn),Gn|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,gt(Lu,Gn),Gn|=n;return Zs(s,e,r,t),e.child}function kC(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function mw(s,e,t,n,r){var i=Sn(t)?zc:Vs.current;return i=nh(e,i),Wu(e,r),t=qS(s,e,t,n,i,r),n=KS(),s!==null&&!wn?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,Da(s,e,r)):(kt&&n&&MS(e),e.flags|=1,Zs(s,e,t,r),e.child)}function i1(s,e,t,n,r){if(Sn(t)){var i=!0;F0(e)}else i=!1;if(Wu(e,r),e.stateNode===null)Gg(s,e),bC(e,t,n),fw(e,t,n,r),n=!0;else if(s===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=_r(u):(u=Sn(t)?zc:Vs.current,u=nh(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||l!==u)&&ZE(e,a,n,u),Xa=!1;var p=e.memoizedState;a.state=p,V0(e,n,a,r),l=e.memoizedState,o!==n||p!==l||bn.current||Xa?(typeof h=="function"&&(hw(e,t,h,n),l=e.memoizedState),(o=Xa||QE(e,t,o,n,p,l,u))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),a.props=n,a.state=l,a.context=u,n=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,eC(s,e),o=e.memoizedProps,u=e.type===e.elementType?o:jr(e.type,o),a.props=u,f=e.pendingProps,p=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=_r(l):(l=Sn(t)?zc:Vs.current,l=nh(e,l));var m=t.getDerivedStateFromProps;(h=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||p!==l)&&ZE(e,a,n,l),Xa=!1,p=e.memoizedState,a.state=p,V0(e,n,a,r);var g=e.memoizedState;o!==f||p!==g||bn.current||Xa?(typeof m=="function"&&(hw(e,t,m,n),g=e.memoizedState),(u=Xa||QE(e,t,u,n,p,g,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=g),a.props=n,a.state=g,a.context=l,n=u):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=1024),n=!1)}return gw(s,e,t,n,i,r)}function gw(s,e,t,n,r,i){kC(s,e);var a=(e.flags&128)!==0;if(!n&&!a)return r&&zE(e,t,!1),Da(s,e,i);n=e.stateNode,lM.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,s!==null&&a?(e.child=ih(e,s.child,null,i),e.child=ih(e,null,o,i)):Zs(s,e,o,i),e.memoizedState=n.state,r&&zE(e,t,!0),e.child}function TC(s){var e=s.stateNode;e.pendingContext?VE(s,e.pendingContext,e.pendingContext!==e.context):e.context&&VE(s,e.context,!1),VS(s,e.containerInfo)}function a1(s,e,t,n,r){return rh(),OS(r),e.flags|=256,Zs(s,e,t,n),e.child}var yw={dehydrated:null,treeContext:null,retryLane:0};function vw(s){return{baseLanes:s,cachePool:null,transitions:null}}function CC(s,e,t){var n=e.pendingProps,r=Nt.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=s!==null&&s.memoizedState===null?!1:(r&2)!==0),o?(i=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(r|=1),gt(Nt,r&1),s===null)return uw(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,s=n.fallback,i?(n=e.mode,i=e.child,a={mode:"hidden",children:a},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Xy(a,n,0,null),s=Uc(s,n,t,null),i.return=e,s.return=e,i.sibling=s,e.child=i,e.child.memoizedState=vw(t),e.memoizedState=yw,s):JS(e,a));if(r=s.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return cM(s,e,a,n,o,r,t);if(i){i=n.fallback,a=e.mode,r=s.child,o=r.sibling;var l={mode:"hidden",children:n.children};return!(a&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Ko(r,l),n.subtreeFlags=r.subtreeFlags&14680064),o!==null?i=Ko(o,i):(i=Uc(i,a,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,a=s.child.memoizedState,a=a===null?vw(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=s.childLanes&~t,e.memoizedState=yw,n}return i=s.child,s=i.sibling,n=Ko(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=n,e.memoizedState=null,n}function JS(s,e){return e=Xy({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function gg(s,e,t,n){return n!==null&&OS(n),ih(e,s.child,null,t),s=JS(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function cM(s,e,t,n,r,i,a){if(t)return e.flags&256?(e.flags&=-257,n=Qv(Error(ne(422))),gg(s,e,a,n)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(i=n.fallback,r=e.mode,n=Xy({mode:"visible",children:n.children},r,0,null),i=Uc(i,r,a,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&ih(e,s.child,null,a),e.child.memoizedState=vw(a),e.memoizedState=yw,i);if(!(e.mode&1))return gg(s,e,a,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(ne(419)),n=Qv(i,n,void 0),gg(s,e,a,n)}if(o=(a&s.childLanes)!==0,wn||o){if(n=ms,n!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,La(s,r),Xr(n,s,r,-1))}return n_(),n=Qv(Error(ne(421))),gg(s,e,a,n)}return r.data==="$?"?(e.flags|=128,e.child=s.child,e=SM.bind(null,s),r._reactRetry=e,null):(s=i.treeContext,Xn=zo(r.nextSibling),Yn=e,kt=!0,Wr=null,s!==null&&(gr[yr++]=Sa,gr[yr++]=_a,gr[yr++]=Wc,Sa=s.id,_a=s.overflow,Wc=e),e=JS(e,n.children),e.flags|=4096,e)}function o1(s,e,t){s.lanes|=e;var n=s.alternate;n!==null&&(n.lanes|=e),dw(s.return,e,t)}function Zv(s,e,t,n,r){var i=s.memoizedState;i===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=r)}function NC(s,e,t){var n=e.pendingProps,r=n.revealOrder,i=n.tail;if(Zs(s,e,n.children,t),n=Nt.current,n&2)n=n&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&o1(s,t,e);else if(s.tag===19)o1(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}n&=1}if(gt(Nt,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)s=t.alternate,s!==null&&z0(s)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Zv(e,!1,r,t,i);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(s=r.alternate,s!==null&&z0(s)===null){e.child=r;break}s=r.sibling,r.sibling=t,t=r,r=s}Zv(e,!0,t,null,i);break;case"together":Zv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gg(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function Da(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),qc|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(ne(153));if(e.child!==null){for(s=e.child,t=Ko(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=Ko(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function uM(s,e,t){switch(e.tag){case 3:TC(e),rh();break;case 5:tC(e);break;case 1:Sn(e.type)&&F0(e);break;case 4:VS(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;gt(B0,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(gt(Nt,Nt.current&1),e.flags|=128,null):t&e.child.childLanes?CC(s,e,t):(gt(Nt,Nt.current&1),s=Da(s,e,t),s!==null?s.sibling:null);gt(Nt,Nt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,s.flags&128){if(n)return NC(s,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),gt(Nt,Nt.current),n)break;return null;case 22:case 23:return e.lanes=0,AC(s,e,t)}return Da(s,e,t)}var jC,xw,PC,RC;jC=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};xw=function(){};PC=function(s,e,t,n){var r=s.memoizedProps;if(r!==n){s=e.stateNode,Nl(Ri.current);var i=null;switch(t){case"input":r=Bx(s,r),n=Bx(s,n),i=[];break;case"select":r=Rt({},r,{value:void 0}),n=Rt({},n,{value:void 0}),i=[];break;case"textarea":r=zx(s,r),n=zx(s,n),i=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(s.onclick=I0)}Gx(t,n);var a;t=null;for(u in r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var o=r[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Nf.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(o=r!=null?r[u]:void 0,n.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Nf.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&xt("scroll",s),i||o===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};RC=function(s,e,t,n){t!==n&&(e.flags|=4)};function Ch(s,e){if(!kt)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:n.sibling=null}}function Ls(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,n=0;if(e)for(var r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=s,r=r.sibling;else for(r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=s,r=r.sibling;return s.subtreeFlags|=n,s.childLanes=t,e}function dM(s,e,t){var n=e.pendingProps;switch(IS(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ls(e),null;case 1:return Sn(e.type)&&O0(),Ls(e),null;case 3:return n=e.stateNode,ah(),wt(bn),wt(Vs),WS(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(s===null||s.child===null)&&(pg(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Wr!==null&&(Tw(Wr),Wr=null))),xw(s,e),Ls(e),null;case 5:zS(e);var r=Nl(Bf.current);if(t=e.type,s!==null&&e.stateNode!=null)PC(s,e,t,n,r),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ne(166));return Ls(e),null}if(s=Nl(Ri.current),pg(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[Ci]=e,n[$f]=i,s=(e.mode&1)!==0,t){case"dialog":xt("cancel",n),xt("close",n);break;case"iframe":case"object":case"embed":xt("load",n);break;case"video":case"audio":for(r=0;r<Bh.length;r++)xt(Bh[r],n);break;case"source":xt("error",n);break;case"img":case"image":case"link":xt("error",n),xt("load",n);break;case"details":xt("toggle",n);break;case"input":gE(n,i),xt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},xt("invalid",n);break;case"textarea":vE(n,i),xt("invalid",n)}Gx(t,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&fg(n.textContent,o,s),r=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&fg(n.textContent,o,s),r=["children",""+o]):Nf.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&xt("scroll",n)}switch(t){case"input":ig(n),yE(n,i,!0);break;case"textarea":ig(n),xE(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=I0)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=aT(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=a.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof n.is=="string"?s=a.createElement(t,{is:n.is}):(s=a.createElement(t),t==="select"&&(a=s,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):s=a.createElementNS(s,t),s[Ci]=e,s[$f]=n,jC(s,e,!1,!1),e.stateNode=s;e:{switch(a=qx(t,n),t){case"dialog":xt("cancel",s),xt("close",s),r=n;break;case"iframe":case"object":case"embed":xt("load",s),r=n;break;case"video":case"audio":for(r=0;r<Bh.length;r++)xt(Bh[r],s);r=n;break;case"source":xt("error",s),r=n;break;case"img":case"image":case"link":xt("error",s),xt("load",s),r=n;break;case"details":xt("toggle",s),r=n;break;case"input":gE(s,n),r=Bx(s,n),xt("invalid",s);break;case"option":r=n;break;case"select":s._wrapperState={wasMultiple:!!n.multiple},r=Rt({},n,{value:void 0}),xt("invalid",s);break;case"textarea":vE(s,n),r=zx(s,n),xt("invalid",s);break;default:r=n}Gx(t,r),o=r;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?cT(s,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&oT(s,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&jf(s,l):typeof l=="number"&&jf(s,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Nf.hasOwnProperty(i)?l!=null&&i==="onScroll"&&xt("scroll",s):l!=null&&bS(s,i,l,a))}switch(t){case"input":ig(s),yE(s,n,!1);break;case"textarea":ig(s),xE(s);break;case"option":n.value!=null&&s.setAttribute("value",""+Yo(n.value));break;case"select":s.multiple=!!n.multiple,i=n.value,i!=null?Bu(s,!!n.multiple,i,!1):n.defaultValue!=null&&Bu(s,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(s.onclick=I0)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ls(e),null;case 6:if(s&&e.stateNode!=null)RC(s,e,s.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ne(166));if(t=Nl(Bf.current),Nl(Ri.current),pg(e)){if(n=e.stateNode,t=e.memoizedProps,n[Ci]=e,(i=n.nodeValue!==t)&&(s=Yn,s!==null))switch(s.tag){case 3:fg(n.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&fg(n.nodeValue,t,(s.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Ci]=e,e.stateNode=n}return Ls(e),null;case 13:if(wt(Nt),n=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(kt&&Xn!==null&&e.mode&1&&!(e.flags&128))YT(),rh(),e.flags|=98560,i=!1;else if(i=pg(e),n!==null&&n.dehydrated!==null){if(s===null){if(!i)throw Error(ne(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ne(317));i[Ci]=e}else rh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ls(e),i=!1}else Wr!==null&&(Tw(Wr),Wr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(s!==null&&s.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(s===null||Nt.current&1?rs===0&&(rs=3):n_())),e.updateQueue!==null&&(e.flags|=4),Ls(e),null);case 4:return ah(),xw(s,e),s===null&&Of(e.stateNode.containerInfo),Ls(e),null;case 10:return US(e.type._context),Ls(e),null;case 17:return Sn(e.type)&&O0(),Ls(e),null;case 19:if(wt(Nt),i=e.memoizedState,i===null)return Ls(e),null;if(n=(e.flags&128)!==0,a=i.rendering,a===null)if(n)Ch(i,!1);else{if(rs!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(a=z0(s),a!==null){for(e.flags|=128,Ch(i,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,s=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,s=a.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return gt(Nt,Nt.current&1|2),e.child}s=s.sibling}i.tail!==null&&Vt()>lh&&(e.flags|=128,n=!0,Ch(i,!1),e.lanes=4194304)}else{if(!n)if(s=z0(a),s!==null){if(e.flags|=128,n=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ch(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!kt)return Ls(e),null}else 2*Vt()-i.renderingStartTime>lh&&t!==1073741824&&(e.flags|=128,n=!0,Ch(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Vt(),e.sibling=null,t=Nt.current,gt(Nt,n?t&1|2:t&1),e):(Ls(e),null);case 22:case 23:return s_(),n=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Gn&1073741824&&(Ls(e),e.subtreeFlags&6&&(e.flags|=8192)):Ls(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function hM(s,e){switch(IS(e),e.tag){case 1:return Sn(e.type)&&O0(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return ah(),wt(bn),wt(Vs),WS(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return zS(e),null;case 13:if(wt(Nt),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));rh()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return wt(Nt),null;case 4:return ah(),null;case 10:return US(e.type._context),null;case 22:case 23:return s_(),null;case 24:return null;default:return null}}var yg=!1,Bs=!1,fM=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Ru(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){It(s,e,n)}else t.current=null}function ww(s,e,t){try{t()}catch(n){It(s,e,n)}}var l1=!1;function pM(s,e){if(nw=L0,s=OT(),DS(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,h=0,f=s,p=null;t:for(;;){for(var m;f!==t||r!==0&&f.nodeType!==3||(o=a+r),f!==i||n!==0&&f.nodeType!==3||(l=a+n),f.nodeType===3&&(a+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===s)break t;if(p===t&&++u===r&&(o=a),p===i&&++h===n&&(l=a),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(rw={focusedElem:s,selectionRange:t},L0=!1,ue=e;ue!==null;)if(e=ue,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,ue=s;else for(;ue!==null;){e=ue;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,b=g.memoizedState,v=e.stateNode,x=v.getSnapshotBeforeUpdate(e.elementType===e.type?y:jr(e.type,y),b);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(E){It(e,e.return,E)}if(s=e.sibling,s!==null){s.return=e.return,ue=s;break}ue=e.return}return g=l1,l1=!1,g}function vf(s,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&s)===s){var i=r.destroy;r.destroy=void 0,i!==void 0&&ww(e,t,i)}r=r.next}while(r!==n)}}function qy(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function bw(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function LC(s){var e=s.alternate;e!==null&&(s.alternate=null,LC(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[Ci],delete e[$f],delete e[ow],delete e[YD],delete e[JD])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function DC(s){return s.tag===5||s.tag===3||s.tag===4}function c1(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||DC(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Sw(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=I0));else if(n!==4&&(s=s.child,s!==null))for(Sw(s,e,t),s=s.sibling;s!==null;)Sw(s,e,t),s=s.sibling}function _w(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(n!==4&&(s=s.child,s!==null))for(_w(s,e,t),s=s.sibling;s!==null;)_w(s,e,t),s=s.sibling}var Ss=null,Vr=!1;function Va(s,e,t){for(t=t.child;t!==null;)MC(s,e,t),t=t.sibling}function MC(s,e,t){if(Pi&&typeof Pi.onCommitFiberUnmount=="function")try{Pi.onCommitFiberUnmount($y,t)}catch{}switch(t.tag){case 5:Bs||Ru(t,e);case 6:var n=Ss,r=Vr;Ss=null,Va(s,e,t),Ss=n,Vr=r,Ss!==null&&(Vr?(s=Ss,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):Ss.removeChild(t.stateNode));break;case 18:Ss!==null&&(Vr?(s=Ss,t=t.stateNode,s.nodeType===8?Gv(s.parentNode,t):s.nodeType===1&&Gv(s,t),Df(s)):Gv(Ss,t.stateNode));break;case 4:n=Ss,r=Vr,Ss=t.stateNode.containerInfo,Vr=!0,Va(s,e,t),Ss=n,Vr=r;break;case 0:case 11:case 14:case 15:if(!Bs&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&ww(t,e,a),r=r.next}while(r!==n)}Va(s,e,t);break;case 1:if(!Bs&&(Ru(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(o){It(t,e,o)}Va(s,e,t);break;case 21:Va(s,e,t);break;case 22:t.mode&1?(Bs=(n=Bs)||t.memoizedState!==null,Va(s,e,t),Bs=n):Va(s,e,t);break;default:Va(s,e,t)}}function u1(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new fM),e.forEach(function(n){var r=_M.bind(null,s,n);t.has(n)||(t.add(n),n.then(r,r))})}}function Tr(s,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var i=s,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Ss=o.stateNode,Vr=!1;break e;case 3:Ss=o.stateNode.containerInfo,Vr=!0;break e;case 4:Ss=o.stateNode.containerInfo,Vr=!0;break e}o=o.return}if(Ss===null)throw Error(ne(160));MC(i,a,r),Ss=null,Vr=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){It(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)IC(e,s),e=e.sibling}function IC(s,e){var t=s.alternate,n=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Tr(e,s),ni(s),n&4){try{vf(3,s,s.return),qy(3,s)}catch(y){It(s,s.return,y)}try{vf(5,s,s.return)}catch(y){It(s,s.return,y)}}break;case 1:Tr(e,s),ni(s),n&512&&t!==null&&Ru(t,t.return);break;case 5:if(Tr(e,s),ni(s),n&512&&t!==null&&Ru(t,t.return),s.flags&32){var r=s.stateNode;try{jf(r,"")}catch(y){It(s,s.return,y)}}if(n&4&&(r=s.stateNode,r!=null)){var i=s.memoizedProps,a=t!==null?t.memoizedProps:i,o=s.type,l=s.updateQueue;if(s.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&rT(r,i),qx(o,a);var u=qx(o,i);for(a=0;a<l.length;a+=2){var h=l[a],f=l[a+1];h==="style"?cT(r,f):h==="dangerouslySetInnerHTML"?oT(r,f):h==="children"?jf(r,f):bS(r,h,f,u)}switch(o){case"input":Hx(r,i);break;case"textarea":iT(r,i);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Bu(r,!!i.multiple,m,!1):p!==!!i.multiple&&(i.defaultValue!=null?Bu(r,!!i.multiple,i.defaultValue,!0):Bu(r,!!i.multiple,i.multiple?[]:"",!1))}r[$f]=i}catch(y){It(s,s.return,y)}}break;case 6:if(Tr(e,s),ni(s),n&4){if(s.stateNode===null)throw Error(ne(162));r=s.stateNode,i=s.memoizedProps;try{r.nodeValue=i}catch(y){It(s,s.return,y)}}break;case 3:if(Tr(e,s),ni(s),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Df(e.containerInfo)}catch(y){It(s,s.return,y)}break;case 4:Tr(e,s),ni(s);break;case 13:Tr(e,s),ni(s),r=s.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(e_=Vt())),n&4&&u1(s);break;case 22:if(h=t!==null&&t.memoizedState!==null,s.mode&1?(Bs=(u=Bs)||h,Tr(e,s),Bs=u):Tr(e,s),ni(s),n&8192){if(u=s.memoizedState!==null,(s.stateNode.isHidden=u)&&!h&&s.mode&1)for(ue=s,h=s.child;h!==null;){for(f=ue=h;ue!==null;){switch(p=ue,m=p.child,p.tag){case 0:case 11:case 14:case 15:vf(4,p,p.return);break;case 1:Ru(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){It(n,t,y)}}break;case 5:Ru(p,p.return);break;case 22:if(p.memoizedState!==null){h1(f);continue}}m!==null?(m.return=p,ue=m):h1(f)}h=h.sibling}e:for(h=null,f=s;;){if(f.tag===5){if(h===null){h=f;try{r=f.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=f.stateNode,l=f.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=lT("display",a))}catch(y){It(s,s.return,y)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){It(s,s.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===s)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===s)break e;for(;f.sibling===null;){if(f.return===null||f.return===s)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Tr(e,s),ni(s),n&4&&u1(s);break;case 21:break;default:Tr(e,s),ni(s)}}function ni(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if(DC(t)){var n=t;break e}t=t.return}throw Error(ne(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(jf(r,""),n.flags&=-33);var i=c1(s);_w(s,i,r);break;case 3:case 4:var a=n.stateNode.containerInfo,o=c1(s);Sw(s,o,a);break;default:throw Error(ne(161))}}catch(l){It(s,s.return,l)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function mM(s,e,t){ue=s,OC(s)}function OC(s,e,t){for(var n=(s.mode&1)!==0;ue!==null;){var r=ue,i=r.child;if(r.tag===22&&n){var a=r.memoizedState!==null||yg;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||Bs;o=yg;var u=Bs;if(yg=a,(Bs=l)&&!u)for(ue=r;ue!==null;)a=ue,l=a.child,a.tag===22&&a.memoizedState!==null?f1(r):l!==null?(l.return=a,ue=l):f1(r);for(;i!==null;)ue=i,OC(i),i=i.sibling;ue=r,yg=o,Bs=u}d1(s)}else r.subtreeFlags&8772&&i!==null?(i.return=r,ue=i):d1(s)}}function d1(s){for(;ue!==null;){var e=ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Bs||qy(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Bs)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:jr(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&XE(e,i,n);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}XE(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Df(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}Bs||e.flags&512&&bw(e)}catch(p){It(e,e.return,p)}}if(e===s){ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}}function h1(s){for(;ue!==null;){var e=ue;if(e===s){ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ue=t;break}ue=e.return}}function f1(s){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{qy(4,e)}catch(l){It(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(l){It(e,r,l)}}var i=e.return;try{bw(e)}catch(l){It(e,i,l)}break;case 5:var a=e.return;try{bw(e)}catch(l){It(e,a,l)}}}catch(l){It(e,e.return,l)}if(e===s){ue=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ue=o;break}ue=e.return}}var gM=Math.ceil,q0=$a.ReactCurrentDispatcher,QS=$a.ReactCurrentOwner,wr=$a.ReactCurrentBatchConfig,Ke=0,ms=null,Xt=null,ks=0,Gn=0,Lu=al(0),rs=0,Wf=null,qc=0,Ky=0,ZS=0,xf=null,vn=null,e_=0,lh=1/0,Bi=null,K0=!1,Ew=null,Go=null,vg=!1,$o=null,X0=0,wf=0,Aw=null,qg=-1,Kg=0;function nn(){return Ke&6?Vt():qg!==-1?qg:qg=Vt()}function qo(s){return s.mode&1?Ke&2&&ks!==0?ks&-ks:ZD.transition!==null?(Kg===0&&(Kg=bT()),Kg):(s=it,s!==0||(s=window.event,s=s===void 0?16:CT(s.type)),s):1}function Xr(s,e,t,n){if(50<wf)throw wf=0,Aw=null,Error(ne(185));Mm(s,t,n),(!(Ke&2)||s!==ms)&&(s===ms&&(!(Ke&2)&&(Ky|=t),rs===4&&Qa(s,ks)),_n(s,n),t===1&&Ke===0&&!(e.mode&1)&&(lh=Vt()+500,zy&&ol()))}function _n(s,e){var t=s.callbackNode;ZL(s,e);var n=R0(s,s===ms?ks:0);if(n===0)t!==null&&SE(t),s.callbackNode=null,s.callbackPriority=0;else if(e=n&-n,s.callbackPriority!==e){if(t!=null&&SE(t),e===1)s.tag===0?QD(p1.bind(null,s)):qT(p1.bind(null,s)),KD(function(){!(Ke&6)&&ol()}),t=null;else{switch(ST(n)){case 1:t=kS;break;case 4:t=xT;break;case 16:t=P0;break;case 536870912:t=wT;break;default:t=P0}t=WC(t,FC.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function FC(s,e){if(qg=-1,Kg=0,Ke&6)throw Error(ne(327));var t=s.callbackNode;if(Gu()&&s.callbackNode!==t)return null;var n=R0(s,s===ms?ks:0);if(n===0)return null;if(n&30||n&s.expiredLanes||e)e=Y0(s,n);else{e=n;var r=Ke;Ke|=2;var i=UC();(ms!==s||ks!==e)&&(Bi=null,lh=Vt()+500,$c(s,e));do try{xM();break}catch(o){$C(s,o)}while(!0);$S(),q0.current=i,Ke=r,Xt!==null?e=0:(ms=null,ks=0,e=rs)}if(e!==0){if(e===2&&(r=Qx(s),r!==0&&(n=r,e=kw(s,r))),e===1)throw t=Wf,$c(s,0),Qa(s,n),_n(s,Vt()),t;if(e===6)Qa(s,n);else{if(r=s.current.alternate,!(n&30)&&!yM(r)&&(e=Y0(s,n),e===2&&(i=Qx(s),i!==0&&(n=i,e=kw(s,i))),e===1))throw t=Wf,$c(s,0),Qa(s,n),_n(s,Vt()),t;switch(s.finishedWork=r,s.finishedLanes=n,e){case 0:case 1:throw Error(ne(345));case 2:gl(s,vn,Bi);break;case 3:if(Qa(s,n),(n&130023424)===n&&(e=e_+500-Vt(),10<e)){if(R0(s,0)!==0)break;if(r=s.suspendedLanes,(r&n)!==n){nn(),s.pingedLanes|=s.suspendedLanes&r;break}s.timeoutHandle=aw(gl.bind(null,s,vn,Bi),e);break}gl(s,vn,Bi);break;case 4:if(Qa(s,n),(n&4194240)===n)break;for(e=s.eventTimes,r=-1;0<n;){var a=31-Kr(n);i=1<<a,a=e[a],a>r&&(r=a),n&=~i}if(n=r,n=Vt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*gM(n/1960))-n,10<n){s.timeoutHandle=aw(gl.bind(null,s,vn,Bi),n);break}gl(s,vn,Bi);break;case 5:gl(s,vn,Bi);break;default:throw Error(ne(329))}}}return _n(s,Vt()),s.callbackNode===t?FC.bind(null,s):null}function kw(s,e){var t=xf;return s.current.memoizedState.isDehydrated&&($c(s,e).flags|=256),s=Y0(s,e),s!==2&&(e=vn,vn=t,e!==null&&Tw(e)),s}function Tw(s){vn===null?vn=s:vn.push.apply(vn,s)}function yM(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],i=r.getSnapshot;r=r.value;try{if(!Yr(i(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qa(s,e){for(e&=~ZS,e&=~Ky,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-Kr(e),n=1<<t;s[t]=-1,e&=~n}}function p1(s){if(Ke&6)throw Error(ne(327));Gu();var e=R0(s,0);if(!(e&1))return _n(s,Vt()),null;var t=Y0(s,e);if(s.tag!==0&&t===2){var n=Qx(s);n!==0&&(e=n,t=kw(s,n))}if(t===1)throw t=Wf,$c(s,0),Qa(s,e),_n(s,Vt()),t;if(t===6)throw Error(ne(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,gl(s,vn,Bi),_n(s,Vt()),null}function t_(s,e){var t=Ke;Ke|=1;try{return s(e)}finally{Ke=t,Ke===0&&(lh=Vt()+500,zy&&ol())}}function Kc(s){$o!==null&&$o.tag===0&&!(Ke&6)&&Gu();var e=Ke;Ke|=1;var t=wr.transition,n=it;try{if(wr.transition=null,it=1,s)return s()}finally{it=n,wr.transition=t,Ke=e,!(Ke&6)&&ol()}}function s_(){Gn=Lu.current,wt(Lu)}function $c(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,qD(t)),Xt!==null)for(t=Xt.return;t!==null;){var n=t;switch(IS(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&O0();break;case 3:ah(),wt(bn),wt(Vs),WS();break;case 5:zS(n);break;case 4:ah();break;case 13:wt(Nt);break;case 19:wt(Nt);break;case 10:US(n.type._context);break;case 22:case 23:s_()}t=t.return}if(ms=s,Xt=s=Ko(s.current,null),ks=Gn=e,rs=0,Wf=null,ZS=Ky=qc=0,vn=xf=null,Cl!==null){for(e=0;e<Cl.length;e++)if(t=Cl[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,i=t.pending;if(i!==null){var a=i.next;i.next=r,n.next=a}t.pending=n}Cl=null}return s}function $C(s,e){do{var t=Xt;try{if($S(),zg.current=G0,W0){for(var n=Pt.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}W0=!1}if(Gc=0,ps=ns=Pt=null,yf=!1,Hf=0,QS.current=null,t===null||t.return===null){rs=1,Wf=e,Xt=null;break}e:{var i=s,a=t.return,o=t,l=e;if(e=ks,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=o,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=t1(a);if(m!==null){m.flags&=-257,s1(m,a,o,i,e),m.mode&1&&e1(i,u,e),e=m,l=u;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){e1(i,u,e),n_();break e}l=Error(ne(426))}}else if(kt&&o.mode&1){var b=t1(a);if(b!==null){!(b.flags&65536)&&(b.flags|=256),s1(b,a,o,i,e),OS(oh(l,o));break e}}i=l=oh(l,o),rs!==4&&(rs=2),xf===null?xf=[i]:xf.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=SC(i,l,e);KE(i,v);break e;case 1:o=l;var x=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Go===null||!Go.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var E=_C(i,o,e);KE(i,E);break e}}i=i.return}while(i!==null)}HC(t)}catch(T){e=T,Xt===t&&t!==null&&(Xt=t=t.return);continue}break}while(!0)}function UC(){var s=q0.current;return q0.current=G0,s===null?G0:s}function n_(){(rs===0||rs===3||rs===2)&&(rs=4),ms===null||!(qc&268435455)&&!(Ky&268435455)||Qa(ms,ks)}function Y0(s,e){var t=Ke;Ke|=2;var n=UC();(ms!==s||ks!==e)&&(Bi=null,$c(s,e));do try{vM();break}catch(r){$C(s,r)}while(!0);if($S(),Ke=t,q0.current=n,Xt!==null)throw Error(ne(261));return ms=null,ks=0,rs}function vM(){for(;Xt!==null;)BC(Xt)}function xM(){for(;Xt!==null&&!zL();)BC(Xt)}function BC(s){var e=zC(s.alternate,s,Gn);s.memoizedProps=s.pendingProps,e===null?HC(s):Xt=e,QS.current=null}function HC(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=hM(t,e),t!==null){t.flags&=32767,Xt=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{rs=6,Xt=null;return}}else if(t=dM(t,e,Gn),t!==null){Xt=t;return}if(e=e.sibling,e!==null){Xt=e;return}Xt=e=s}while(e!==null);rs===0&&(rs=5)}function gl(s,e,t){var n=it,r=wr.transition;try{wr.transition=null,it=1,wM(s,e,t,n)}finally{wr.transition=r,it=n}return null}function wM(s,e,t,n){do Gu();while($o!==null);if(Ke&6)throw Error(ne(327));t=s.finishedWork;var r=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error(ne(177));s.callbackNode=null,s.callbackPriority=0;var i=t.lanes|t.childLanes;if(eD(s,i),s===ms&&(Xt=ms=null,ks=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||vg||(vg=!0,WC(P0,function(){return Gu(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=wr.transition,wr.transition=null;var a=it;it=1;var o=Ke;Ke|=4,QS.current=null,pM(s,t),IC(t,s),UD(rw),L0=!!nw,rw=nw=null,s.current=t,mM(t),WL(),Ke=o,it=a,wr.transition=i}else s.current=t;if(vg&&(vg=!1,$o=s,X0=r),i=s.pendingLanes,i===0&&(Go=null),KL(t.stateNode),_n(s,Vt()),e!==null)for(n=s.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(K0)throw K0=!1,s=Ew,Ew=null,s;return X0&1&&s.tag!==0&&Gu(),i=s.pendingLanes,i&1?s===Aw?wf++:(wf=0,Aw=s):wf=0,ol(),null}function Gu(){if($o!==null){var s=ST(X0),e=wr.transition,t=it;try{if(wr.transition=null,it=16>s?16:s,$o===null)var n=!1;else{if(s=$o,$o=null,X0=0,Ke&6)throw Error(ne(331));var r=Ke;for(Ke|=4,ue=s.current;ue!==null;){var i=ue,a=i.child;if(ue.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(ue=u;ue!==null;){var h=ue;switch(h.tag){case 0:case 11:case 15:vf(8,h,i)}var f=h.child;if(f!==null)f.return=h,ue=f;else for(;ue!==null;){h=ue;var p=h.sibling,m=h.return;if(LC(h),h===u){ue=null;break}if(p!==null){p.return=m,ue=p;break}ue=m}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var b=y.sibling;y.sibling=null,y=b}while(y!==null)}}ue=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ue=a;else e:for(;ue!==null;){if(i=ue,i.flags&2048)switch(i.tag){case 0:case 11:case 15:vf(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,ue=v;break e}ue=i.return}}var x=s.current;for(ue=x;ue!==null;){a=ue;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,ue=w;else e:for(a=x;ue!==null;){if(o=ue,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:qy(9,o)}}catch(T){It(o,o.return,T)}if(o===a){ue=null;break e}var E=o.sibling;if(E!==null){E.return=o.return,ue=E;break e}ue=o.return}}if(Ke=r,ol(),Pi&&typeof Pi.onPostCommitFiberRoot=="function")try{Pi.onPostCommitFiberRoot($y,s)}catch{}n=!0}return n}finally{it=t,wr.transition=e}}return!1}function m1(s,e,t){e=oh(t,e),e=SC(s,e,1),s=Wo(s,e,1),e=nn(),s!==null&&(Mm(s,1,e),_n(s,e))}function It(s,e,t){if(s.tag===3)m1(s,s,t);else for(;e!==null;){if(e.tag===3){m1(e,s,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Go===null||!Go.has(n))){s=oh(t,s),s=_C(e,s,1),e=Wo(e,s,1),s=nn(),e!==null&&(Mm(e,1,s),_n(e,s));break}}e=e.return}}function bM(s,e,t){var n=s.pingCache;n!==null&&n.delete(e),e=nn(),s.pingedLanes|=s.suspendedLanes&t,ms===s&&(ks&t)===t&&(rs===4||rs===3&&(ks&130023424)===ks&&500>Vt()-e_?$c(s,0):ZS|=t),_n(s,e)}function VC(s,e){e===0&&(s.mode&1?(e=lg,lg<<=1,!(lg&130023424)&&(lg=4194304)):e=1);var t=nn();s=La(s,e),s!==null&&(Mm(s,e,t),_n(s,t))}function SM(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),VC(s,t)}function _M(s,e){var t=0;switch(s.tag){case 13:var n=s.stateNode,r=s.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=s.stateNode;break;default:throw Error(ne(314))}n!==null&&n.delete(e),VC(s,t)}var zC;zC=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||bn.current)wn=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return wn=!1,uM(s,e,t);wn=!!(s.flags&131072)}else wn=!1,kt&&e.flags&1048576&&KT(e,U0,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Gg(s,e),s=e.pendingProps;var r=nh(e,Vs.current);Wu(e,t),r=qS(null,e,n,s,r,t);var i=KS();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Sn(n)?(i=!0,F0(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,HS(e),r.updater=Gy,e.stateNode=r,r._reactInternals=e,fw(e,n,s,t),e=gw(null,e,n,!0,i,t)):(e.tag=0,kt&&i&&MS(e),Zs(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Gg(s,e),s=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=AM(n),s=jr(n,s),r){case 0:e=mw(null,e,n,s,t);break e;case 1:e=i1(null,e,n,s,t);break e;case 11:e=n1(null,e,n,s,t);break e;case 14:e=r1(null,e,n,jr(n.type,s),t);break e}throw Error(ne(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:jr(n,r),mw(s,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:jr(n,r),i1(s,e,n,r,t);case 3:e:{if(TC(e),s===null)throw Error(ne(387));n=e.pendingProps,i=e.memoizedState,r=i.element,eC(s,e),V0(e,n,null,t);var a=e.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=oh(Error(ne(423)),e),e=a1(s,e,n,t,r);break e}else if(n!==r){r=oh(Error(ne(424)),e),e=a1(s,e,n,t,r);break e}else for(Xn=zo(e.stateNode.containerInfo.firstChild),Yn=e,kt=!0,Wr=null,t=QT(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(rh(),n===r){e=Da(s,e,t);break e}Zs(s,e,n,t)}e=e.child}return e;case 5:return tC(e),s===null&&uw(e),n=e.type,r=e.pendingProps,i=s!==null?s.memoizedProps:null,a=r.children,iw(n,r)?a=null:i!==null&&iw(n,i)&&(e.flags|=32),kC(s,e),Zs(s,e,a,t),e.child;case 6:return s===null&&uw(e),null;case 13:return CC(s,e,t);case 4:return VS(e,e.stateNode.containerInfo),n=e.pendingProps,s===null?e.child=ih(e,null,n,t):Zs(s,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:jr(n,r),n1(s,e,n,r,t);case 7:return Zs(s,e,e.pendingProps,t),e.child;case 8:return Zs(s,e,e.pendingProps.children,t),e.child;case 12:return Zs(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,i=e.memoizedProps,a=r.value,gt(B0,n._currentValue),n._currentValue=a,i!==null)if(Yr(i.value,a)){if(i.children===r.children&&!bn.current){e=Da(s,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Aa(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),dw(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(ne(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),dw(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Zs(s,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Wu(e,t),r=_r(r),n=n(r),e.flags|=1,Zs(s,e,n,t),e.child;case 14:return n=e.type,r=jr(n,e.pendingProps),r=jr(n.type,r),r1(s,e,n,r,t);case 15:return EC(s,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:jr(n,r),Gg(s,e),e.tag=1,Sn(n)?(s=!0,F0(e)):s=!1,Wu(e,t),bC(e,n,r),fw(e,n,r,t),gw(null,e,n,!0,s,t);case 19:return NC(s,e,t);case 22:return AC(s,e,t)}throw Error(ne(156,e.tag))};function WC(s,e){return vT(s,e)}function EM(s,e,t,n){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(s,e,t,n){return new EM(s,e,t,n)}function r_(s){return s=s.prototype,!(!s||!s.isReactComponent)}function AM(s){if(typeof s=="function")return r_(s)?1:0;if(s!=null){if(s=s.$$typeof,s===_S)return 11;if(s===ES)return 14}return 2}function Ko(s,e){var t=s.alternate;return t===null?(t=xr(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function Xg(s,e,t,n,r,i){var a=2;if(n=s,typeof s=="function")r_(s)&&(a=1);else if(typeof s=="string")a=5;else e:switch(s){case _u:return Uc(t.children,r,i,e);case SS:a=8,r|=8;break;case Ox:return s=xr(12,t,e,r|2),s.elementType=Ox,s.lanes=i,s;case Fx:return s=xr(13,t,e,r),s.elementType=Fx,s.lanes=i,s;case $x:return s=xr(19,t,e,r),s.elementType=$x,s.lanes=i,s;case tT:return Xy(t,r,i,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Zk:a=10;break e;case eT:a=9;break e;case _S:a=11;break e;case ES:a=14;break e;case Ka:a=16,n=null;break e}throw Error(ne(130,s==null?s:typeof s,""))}return e=xr(a,t,e,r),e.elementType=s,e.type=n,e.lanes=i,e}function Uc(s,e,t,n){return s=xr(7,s,n,e),s.lanes=t,s}function Xy(s,e,t,n){return s=xr(22,s,n,e),s.elementType=tT,s.lanes=t,s.stateNode={isHidden:!1},s}function ex(s,e,t){return s=xr(6,s,null,e),s.lanes=t,s}function tx(s,e,t){return e=xr(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function kM(s,e,t,n,r){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mv(0),this.expirationTimes=Mv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mv(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function i_(s,e,t,n,r,i,a,o,l){return s=new kM(s,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=xr(3,null,null,e),s.current=i,i.stateNode=s,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},HS(i),s}function TM(s,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Su,key:n==null?null:""+n,children:s,containerInfo:e,implementation:t}}function GC(s){if(!s)return Jo;s=s._reactInternals;e:{if(Qc(s)!==s||s.tag!==1)throw Error(ne(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Sn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(s.tag===1){var t=s.type;if(Sn(t))return GT(s,t,e)}return e}function qC(s,e,t,n,r,i,a,o,l){return s=i_(t,n,!0,s,r,i,a,o,l),s.context=GC(null),t=s.current,n=nn(),r=qo(t),i=Aa(n,r),i.callback=e??null,Wo(t,i,r),s.current.lanes=r,Mm(s,r,n),_n(s,n),s}function Yy(s,e,t,n){var r=e.current,i=nn(),a=qo(r);return t=GC(t),e.context===null?e.context=t:e.pendingContext=t,e=Aa(i,a),e.payload={element:s},n=n===void 0?null:n,n!==null&&(e.callback=n),s=Wo(r,e,a),s!==null&&(Xr(s,r,a,i),Vg(s,r,a)),a}function J0(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function g1(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function a_(s,e){g1(s,e),(s=s.alternate)&&g1(s,e)}function CM(){return null}var KC=typeof reportError=="function"?reportError:function(s){console.error(s)};function o_(s){this._internalRoot=s}Jy.prototype.render=o_.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(ne(409));Yy(s,e,null,null)};Jy.prototype.unmount=o_.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;Kc(function(){Yy(null,s,null,null)}),e[Ra]=null}};function Jy(s){this._internalRoot=s}Jy.prototype.unstable_scheduleHydration=function(s){if(s){var e=AT();s={blockedOn:null,target:s,priority:e};for(var t=0;t<Ja.length&&e!==0&&e<Ja[t].priority;t++);Ja.splice(t,0,s),t===0&&TT(s)}};function l_(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Qy(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function y1(){}function NM(s,e,t,n,r){if(r){if(typeof n=="function"){var i=n;n=function(){var u=J0(a);i.call(u)}}var a=qC(e,n,s,0,null,!1,!1,"",y1);return s._reactRootContainer=a,s[Ra]=a.current,Of(s.nodeType===8?s.parentNode:s),Kc(),a}for(;r=s.lastChild;)s.removeChild(r);if(typeof n=="function"){var o=n;n=function(){var u=J0(l);o.call(u)}}var l=i_(s,0,!1,null,null,!1,!1,"",y1);return s._reactRootContainer=l,s[Ra]=l.current,Of(s.nodeType===8?s.parentNode:s),Kc(function(){Yy(e,l,t,n)}),l}function Zy(s,e,t,n,r){var i=t._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var o=r;r=function(){var l=J0(a);o.call(l)}}Yy(e,a,s,r)}else a=NM(t,e,s,r,n);return J0(a)}_T=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=Uh(e.pendingLanes);t!==0&&(TS(e,t|1),_n(e,Vt()),!(Ke&6)&&(lh=Vt()+500,ol()))}break;case 13:Kc(function(){var n=La(s,1);if(n!==null){var r=nn();Xr(n,s,1,r)}}),a_(s,1)}};CS=function(s){if(s.tag===13){var e=La(s,134217728);if(e!==null){var t=nn();Xr(e,s,134217728,t)}a_(s,134217728)}};ET=function(s){if(s.tag===13){var e=qo(s),t=La(s,e);if(t!==null){var n=nn();Xr(t,s,e,n)}a_(s,e)}};AT=function(){return it};kT=function(s,e){var t=it;try{return it=s,e()}finally{it=t}};Xx=function(s,e,t){switch(e){case"input":if(Hx(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==s&&n.form===s.form){var r=Vy(n);if(!r)throw Error(ne(90));nT(n),Hx(n,r)}}}break;case"textarea":iT(s,t);break;case"select":e=t.value,e!=null&&Bu(s,!!t.multiple,e,!1)}};hT=t_;fT=Kc;var jM={usingClientEntryPoint:!1,Events:[Om,Tu,Vy,uT,dT,t_]},Nh={findFiberByHostInstance:Tl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PM={bundleType:Nh.bundleType,version:Nh.version,rendererPackageName:Nh.rendererPackageName,rendererConfig:Nh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$a.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=gT(s),s===null?null:s.stateNode},findFiberByHostInstance:Nh.findFiberByHostInstance||CM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xg.isDisabled&&xg.supportsFiber)try{$y=xg.inject(PM),Pi=xg}catch{}}er.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jM;er.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l_(e))throw Error(ne(200));return TM(s,e,null,t)};er.createRoot=function(s,e){if(!l_(s))throw Error(ne(299));var t=!1,n="",r=KC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=i_(s,1,!1,null,null,t,!1,n,r),s[Ra]=e.current,Of(s.nodeType===8?s.parentNode:s),new o_(e)};er.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(ne(188)):(s=Object.keys(s).join(","),Error(ne(268,s)));return s=gT(e),s=s===null?null:s.stateNode,s};er.flushSync=function(s){return Kc(s)};er.hydrate=function(s,e,t){if(!Qy(e))throw Error(ne(200));return Zy(null,s,e,!0,t)};er.hydrateRoot=function(s,e,t){if(!l_(s))throw Error(ne(405));var n=t!=null&&t.hydratedSources||null,r=!1,i="",a=KC;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=qC(e,null,s,1,t??null,r,!1,i,a),s[Ra]=e.current,Of(s),n)for(s=0;s<n.length;s++)t=n[s],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Jy(e)};er.render=function(s,e,t){if(!Qy(e))throw Error(ne(200));return Zy(null,s,e,!1,t)};er.unmountComponentAtNode=function(s){if(!Qy(s))throw Error(ne(40));return s._reactRootContainer?(Kc(function(){Zy(null,null,s,!1,function(){s._reactRootContainer=null,s[Ra]=null})}),!0):!1};er.unstable_batchedUpdates=t_;er.unstable_renderSubtreeIntoContainer=function(s,e,t,n){if(!Qy(t))throw Error(ne(200));if(s==null||s._reactInternals===void 0)throw Error(ne(38));return Zy(s,e,t,!1,n)};er.version="18.3.1-next-f1338f8080-20240426";function XC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(XC)}catch(s){console.error(s)}}XC(),Xk.exports=er;var YC=Xk.exports,JC,v1=YC;JC=v1.createRoot,v1.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gf(){return Gf=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},Gf.apply(this,arguments)}var Uo;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Uo||(Uo={}));const x1="popstate";function RM(s){s===void 0&&(s={});function e(n,r){let{pathname:i,search:a,hash:o}=n.location;return Cw("",{pathname:i,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:ZC(r)}return DM(e,t,null,s)}function Jt(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function QC(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function LM(){return Math.random().toString(36).substr(2,8)}function w1(s,e){return{usr:s.state,key:s.key,idx:e}}function Cw(s,e,t,n){return t===void 0&&(t=null),Gf({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?vh(e):e,{state:t,key:e&&e.key||n||LM()})}function ZC(s){let{pathname:e="/",search:t="",hash:n=""}=s;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function vh(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substr(t),s=s.substr(0,t));let n=s.indexOf("?");n>=0&&(e.search=s.substr(n),s=s.substr(0,n)),s&&(e.pathname=s)}return e}function DM(s,e,t,n){n===void 0&&(n={});let{window:r=document.defaultView,v5Compat:i=!1}=n,a=r.history,o=Uo.Pop,l=null,u=h();u==null&&(u=0,a.replaceState(Gf({},a.state,{idx:u}),""));function h(){return(a.state||{idx:null}).idx}function f(){o=Uo.Pop;let b=h(),v=b==null?null:b-u;u=b,l&&l({action:o,location:y.location,delta:v})}function p(b,v){o=Uo.Push;let x=Cw(y.location,b,v);u=h()+1;let w=w1(x,u),E=y.createHref(x);try{a.pushState(w,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;r.location.assign(E)}i&&l&&l({action:o,location:y.location,delta:1})}function m(b,v){o=Uo.Replace;let x=Cw(y.location,b,v);u=h();let w=w1(x,u),E=y.createHref(x);a.replaceState(w,"",E),i&&l&&l({action:o,location:y.location,delta:0})}function g(b){let v=r.location.origin!=="null"?r.location.origin:r.location.href,x=typeof b=="string"?b:ZC(b);return x=x.replace(/ $/,"%20"),Jt(v,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,v)}let y={get action(){return o},get location(){return s(r,a)},listen(b){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(x1,f),l=b,()=>{r.removeEventListener(x1,f),l=null}},createHref(b){return e(r,b)},createURL:g,encodeLocation(b){let v=g(b);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:p,replace:m,go(b){return a.go(b)}};return y}var b1;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(b1||(b1={}));function MM(s,e,t){return t===void 0&&(t="/"),IM(s,e,t)}function IM(s,e,t,n){let r=typeof e=="string"?vh(e):e,i=sN(r.pathname||"/",t);if(i==null)return null;let a=eN(s);OM(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=XM(i);o=GM(a[l],u)}return o}function eN(s,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let r=(i,a,o)=>{let l={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};l.relativePath.startsWith("/")&&(Jt(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=Bc([n,l.relativePath]),h=t.concat(l);i.children&&i.children.length>0&&(Jt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),eN(i.children,e,h,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:zM(u,i.index),routesMeta:h})};return s.forEach((i,a)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))r(i,a);else for(let l of tN(i.path))r(i,a,l)}),e}function tN(s){let e=s.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return r?[i,""]:[i];let a=tN(n.join("/")),o=[];return o.push(...a.map(l=>l===""?i:[i,l].join("/"))),r&&o.push(...a),o.map(l=>s.startsWith("/")&&l===""?"/":l)}function OM(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:WM(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const FM=/^:[\w-]+$/,$M=3,UM=2,BM=1,HM=10,VM=-2,S1=s=>s==="*";function zM(s,e){let t=s.split("/"),n=t.length;return t.some(S1)&&(n+=VM),e&&(n+=UM),t.filter(r=>!S1(r)).reduce((r,i)=>r+(FM.test(i)?$M:i===""?BM:HM),n)}function WM(s,e){return s.length===e.length&&s.slice(0,-1).every((n,r)=>n===e[r])?s[s.length-1]-e[e.length-1]:0}function GM(s,e,t){let{routesMeta:n}=s,r={},i="/",a=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=qM({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},h),p=l.route;if(!f)return null;Object.assign(r,f.params),a.push({params:r,pathname:Bc([i,f.pathname]),pathnameBase:ZM(Bc([i,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(i=Bc([i,f.pathnameBase]))}return a}function qM(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,n]=KM(s.path,s.caseSensitive,s.end),r=e.match(t);if(!r)return null;let i=r[0],a=i.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce((u,h,f)=>{let{paramName:p,isOptional:m}=h;if(p==="*"){let y=o[f]||"";a=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const g=o[f];return m&&!g?u[p]=void 0:u[p]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:a,pattern:s}}function KM(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),QC(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let n=[],r="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(n.push({paramName:"*"}),r+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":s!==""&&s!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function XM(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return QC(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),s}}function sN(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=s.charAt(t);return n&&n!=="/"?null:s.slice(t)||"/"}function YM(s,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:r=""}=typeof s=="string"?vh(s):s;return{pathname:t?t.startsWith("/")?t:JM(t,e):e,search:eI(n),hash:tI(r)}}function JM(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function sx(s,e,t,n){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function QM(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function nN(s,e){let t=QM(s);return e?t.map((n,r)=>r===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function rN(s,e,t,n){n===void 0&&(n=!1);let r;typeof s=="string"?r=vh(s):(r=Gf({},s),Jt(!r.pathname||!r.pathname.includes("?"),sx("?","pathname","search",r)),Jt(!r.pathname||!r.pathname.includes("#"),sx("#","pathname","hash",r)),Jt(!r.search||!r.search.includes("#"),sx("#","search","hash",r)));let i=s===""||r.pathname==="",a=i?"/":r.pathname,o;if(a==null)o=t;else{let f=e.length-1;if(!n&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),f-=1;r.pathname=p.join("/")}o=f>=0?e[f]:"/"}let l=YM(r,o),u=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||h)&&(l.pathname+="/"),l}const Bc=s=>s.join("/").replace(/\/\/+/g,"/"),ZM=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),eI=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,tI=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function sI(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const iN=["post","put","patch","delete"];new Set(iN);const nI=["get",...iN];new Set(nI);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qf(){return qf=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},qf.apply(this,arguments)}const c_=S.createContext(null),rI=S.createContext(null),$m=S.createContext(null),ev=S.createContext(null),Zc=S.createContext({outlet:null,matches:[],isDataRoute:!1}),aN=S.createContext(null);function Um(){return S.useContext(ev)!=null}function u_(){return Um()||Jt(!1),S.useContext(ev).location}function oN(s){S.useContext($m).static||S.useLayoutEffect(s)}function lN(){let{isDataRoute:s}=S.useContext(Zc);return s?yI():iI()}function iI(){Um()||Jt(!1);let s=S.useContext(c_),{basename:e,future:t,navigator:n}=S.useContext($m),{matches:r}=S.useContext(Zc),{pathname:i}=u_(),a=JSON.stringify(nN(r,t.v7_relativeSplatPath)),o=S.useRef(!1);return oN(()=>{o.current=!0}),S.useCallback(function(u,h){if(h===void 0&&(h={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let f=rN(u,JSON.parse(a),i,h.relative==="path");s==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Bc([e,f.pathname])),(h.replace?n.replace:n.push)(f,h.state,h)},[e,n,a,i,s])}function aI(s,e){return oI(s,e)}function oI(s,e,t,n){Um()||Jt(!1);let{navigator:r}=S.useContext($m),{matches:i}=S.useContext(Zc),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let u=u_(),h;if(e){var f;let b=typeof e=="string"?vh(e):e;l==="/"||(f=b.pathname)!=null&&f.startsWith(l)||Jt(!1),h=b}else h=u;let p=h.pathname||"/",m=p;if(l!=="/"){let b=l.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(b.length).join("/")}let g=MM(s,{pathname:m}),y=hI(g&&g.map(b=>Object.assign({},b,{params:Object.assign({},o,b.params),pathname:Bc([l,r.encodeLocation?r.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?l:Bc([l,r.encodeLocation?r.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),i,t,n);return e&&y?S.createElement(ev.Provider,{value:{location:qf({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Uo.Pop}},y):y}function lI(){let s=gI(),e=sI(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),t?S.createElement("pre",{style:r},t):null,null)}const cI=S.createElement(lI,null);class uI extends S.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?S.createElement(Zc.Provider,{value:this.props.routeContext},S.createElement(aN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function dI(s){let{routeContext:e,match:t,children:n}=s,r=S.useContext(c_);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),S.createElement(Zc.Provider,{value:e},n)}function hI(s,e,t,n){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),s==null){var i;if(!t)return null;if(t.errors)s=t.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let a=s,o=(r=t)==null?void 0:r.errors;if(o!=null){let h=a.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);h>=0||Jt(!1),a=a.slice(0,Math.min(a.length,h+1))}let l=!1,u=-1;if(t&&n&&n.v7_partialHydration)for(let h=0;h<a.length;h++){let f=a[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=h),f.route.id){let{loaderData:p,errors:m}=t,g=f.route.loader&&p[f.route.id]===void 0&&(!m||m[f.route.id]===void 0);if(f.route.lazy||g){l=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((h,f,p)=>{let m,g=!1,y=null,b=null;t&&(m=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||cI,l&&(u<0&&p===0?(vI("route-fallback"),g=!0,b=null):u===p&&(g=!0,b=f.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,p+1)),x=()=>{let w;return m?w=y:g?w=b:f.route.Component?w=S.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=h,S.createElement(dI,{match:f,routeContext:{outlet:h,matches:v,isDataRoute:t!=null},children:w})};return t&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?S.createElement(uI,{location:t.location,revalidation:t.revalidation,component:y,error:m,children:x(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):x()},null)}var cN=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(cN||{}),uN=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(uN||{});function fI(s){let e=S.useContext(c_);return e||Jt(!1),e}function pI(s){let e=S.useContext(rI);return e||Jt(!1),e}function mI(s){let e=S.useContext(Zc);return e||Jt(!1),e}function dN(s){let e=mI(),t=e.matches[e.matches.length-1];return t.route.id||Jt(!1),t.route.id}function gI(){var s;let e=S.useContext(aN),t=pI(),n=dN();return e!==void 0?e:(s=t.errors)==null?void 0:s[n]}function yI(){let{router:s}=fI(cN.UseNavigateStable),e=dN(uN.UseNavigateStable),t=S.useRef(!1);return oN(()=>{t.current=!0}),S.useCallback(function(r,i){i===void 0&&(i={}),t.current&&(typeof r=="number"?s.navigate(r):s.navigate(r,qf({fromRouteId:e},i)))},[s,e])}const _1={};function vI(s,e,t){_1[s]||(_1[s]=!0)}function xI(s,e){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function Hh(s){let{to:e,replace:t,state:n,relative:r}=s;Um()||Jt(!1);let{future:i,static:a}=S.useContext($m),{matches:o}=S.useContext(Zc),{pathname:l}=u_(),u=lN(),h=rN(e,nN(o,i.v7_relativeSplatPath),l,r==="path"),f=JSON.stringify(h);return S.useEffect(()=>u(JSON.parse(f),{replace:t,state:n,relative:r}),[u,f,r,t,n]),null}function Vh(s){Jt(!1)}function wI(s){let{basename:e="/",children:t=null,location:n,navigationType:r=Uo.Pop,navigator:i,static:a=!1,future:o}=s;Um()&&Jt(!1);let l=e.replace(/^\/*/,"/"),u=S.useMemo(()=>({basename:l,navigator:i,static:a,future:qf({v7_relativeSplatPath:!1},o)}),[l,o,i,a]);typeof n=="string"&&(n=vh(n));let{pathname:h="/",search:f="",hash:p="",state:m=null,key:g="default"}=n,y=S.useMemo(()=>{let b=sN(h,l);return b==null?null:{location:{pathname:b,search:f,hash:p,state:m,key:g},navigationType:r}},[l,h,f,p,m,g,r]);return y==null?null:S.createElement($m.Provider,{value:u},S.createElement(ev.Provider,{children:t,value:y}))}function bI(s){let{children:e,location:t}=s;return aI(Nw(e),t)}new Promise(()=>{});function Nw(s,e){e===void 0&&(e=[]);let t=[];return S.Children.forEach(s,(n,r)=>{if(!S.isValidElement(n))return;let i=[...e,r];if(n.type===S.Fragment){t.push.apply(t,Nw(n.props.children,i));return}n.type!==Vh&&Jt(!1),!n.props.index||!n.props.children||Jt(!1);let a={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=Nw(n.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const SI="6";try{window.__reactRouterVersion=SI}catch{}const _I="startTransition",E1=bL[_I];function EI(s){let{basename:e,children:t,future:n,window:r}=s,i=S.useRef();i.current==null&&(i.current=RM({window:r,v5Compat:!0}));let a=i.current,[o,l]=S.useState({action:a.action,location:a.location}),{v7_startTransition:u}=n||{},h=S.useCallback(f=>{u&&E1?E1(()=>l(f)):l(f)},[l,u]);return S.useLayoutEffect(()=>a.listen(h),[a,h]),S.useEffect(()=>xI(n),[n]),S.createElement(wI,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:n})}var A1;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(A1||(A1={}));var k1;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(k1||(k1={}));const wg="accessToken",bg="refreshToken",Sg="userData",en={storeTokens(s,e){localStorage.setItem(wg,s),localStorage.setItem(bg,e)},getStoredTokens(){return{accessToken:localStorage.getItem(wg),refreshToken:localStorage.getItem(bg)}},getStoredAccessToken(){return localStorage.getItem(wg)},getStoredRefreshToken(){return localStorage.getItem(bg)},clearStoredTokens(){localStorage.removeItem(wg),localStorage.removeItem(bg),localStorage.removeItem(Sg)},isTokensStored(){const s=this.getStoredTokens();return!!(s.accessToken&&s.refreshToken)},storeUserData(s){localStorage.setItem(Sg,JSON.stringify(s))},getUserData(){const s=localStorage.getItem(Sg);return s?JSON.parse(s):null},clearUserData(){localStorage.removeItem(Sg)},decodeToken(s){try{const t=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}catch(e){return console.error("Error decoding token:",e),null}},isTokenExpired(s){if(!s)return!0;const e=this.decodeToken(s);if(!e||!e.exp)return!0;const t=Date.now()/1e3;return e.exp<t},getTokenExpiration(s){const e=this.decodeToken(s);return e?e.exp*1e3:null},shouldRefreshToken(s){if(!s)return!0;const e=this.decodeToken(s);if(!e||!e.exp)return!0;const t=Date.now()/1e3;return e.exp-t<300},async autoRefreshToken(){const s=this.getStoredTokens();if(!s.accessToken||!s.refreshToken)return!1;if(this.shouldRefreshToken(s.accessToken))try{const e=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s.refreshToken})});if(e.ok){const t=await e.json();return this.storeTokens(t.accessToken,t.refreshToken),!0}else return this.clearStoredTokens(),!1}catch(e){return console.error("Token refresh error:",e),this.clearStoredTokens(),!1}return!0}};class AI{constructor(){this.isEnabled=localStorage.getItem("api-debug")==="true",this.logs=[],this.maxLogs=100}log(e,t,n,r=null){if(!this.isEnabled)return;const i=new Date().toISOString(),a={timestamp:i,level:e,category:t,message:n,data:r?JSON.parse(JSON.stringify(r)):null};this.logs.unshift(a),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs));const o={info:"color: #3B82F6; font-weight: bold;",success:"color: #10B981; font-weight: bold;",warning:"color: #F59E0B; font-weight: bold;",error:"color: #EF4444; font-weight: bold;",debug:"color: #8B5CF6; font-weight: bold;"};console.group(`%c[API ${e.toUpperCase()}] ${t}`,o[e]),console.log(`%c${n}`,"color: #374151;"),r&&console.log("%cData:","color: #6B7280; font-weight: bold;",r),console.log(`%cTime: ${i}`,"color: #9CA3AF; font-size: 0.8em;"),console.groupEnd()}info(e,t,n=null){this.log("info",e,t,n)}success(e,t,n=null){this.log("success",e,t,n)}warning(e,t,n=null){this.log("warning",e,t,n)}error(e,t,n=null){this.log("error",e,t,n)}debug(e,t,n=null){this.log("debug",e,t,n)}logRequest(e,t,n=null){this.info("REQUEST",`${e} ${t}`,{method:e,url:t,body:n,timestamp:Date.now()})}logResponse(e,t,n,r=null){const a=n.status>=200&&n.status<300?"success":"error";this[a]("RESPONSE",`${e} ${t} - ${n.status}`,{status:n.status,statusText:n.statusText,data:n.data||n,duration:r?`${r}ms`:null,timestamp:Date.now()})}logError(e,t,n){this.error("ERROR",`${e} ${t} - ${n.message}`,{error:n.message,stack:n.stack,timestamp:Date.now()})}getLogs(){return this.logs}clearLogs(){this.logs=[]}exportLogs(){const e=JSON.stringify(this.logs,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`api-debug-logs-${new Date().toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(n)}enable(){this.isEnabled=!0,localStorage.setItem("api-debug","true"),this.info("DEBUG","API debugging enabled")}disable(){this.isEnabled=!1,localStorage.setItem("api-debug","false"),this.info("DEBUG","API debugging disabled")}}const P=new AI;typeof window<"u"&&(window.apiDebugger=P);const kI="lang-school-cache",Q0="kv",T1=1,C1="app_cache_version";function TI(){return new Promise((s,e)=>{if(!("indexedDB"in window))return s(null);const t=indexedDB.open(kI,1);t.onupgradeneeded=()=>{const n=t.result;if(!n.objectStoreNames.contains(Q0)){const r=n.createObjectStore(Q0,{keyPath:"key"});r.createIndex("lastAccessed","lastAccessed"),r.createIndex("size","size")}},t.onsuccess=()=>s(t.result),t.onerror=()=>s(null)})}async function Cr(s,e,t){return s?new Promise((n,r)=>{const i=s.transaction(Q0,e),a=i.objectStore(Q0),o=t(a);i.oncomplete=()=>n(o),i.onerror=()=>r(i.error)}):null}function CI(s){try{return new Blob([JSON.stringify(s)]).size}catch{return 0}}function _g(){return Date.now()}class NI{constructor(e={}){this.db=null,this.maxBytes=e.maxBytes||100*1024*1024,this.namespace=e.namespace||"default",this.fallback=window.localStorage}async init(){this.db=await TI();const e=this.fallback.getItem(C1);return String(e)!==String(T1)&&(await this.clearAll(),this.fallback.setItem(C1,String(T1))),this}buildKey(e){return`${this.namespace}:${e}`}async get(e){const t=this.buildKey(e);if(!this.db){const r=this.fallback.getItem(t);if(!r)return null;const i=JSON.parse(r);return i.expiresAt&&Date.now()>i.expiresAt?(this.fallback.removeItem(t),null):i.value}const n=await Cr(this.db,"readonly",r=>r.get(t));if(n){if(n.expiresAt&&Date.now()>n.expiresAt)return await Cr(this.db,"readwrite",i=>i.delete(t)),null;const r={key:t,value:n.value,size:n.size,lastAccessed:_g(),createdAt:n.createdAt,ttl:n.ttl,expiresAt:n.expiresAt};return await Cr(this.db,"readwrite",i=>i.put(r)),n.value}return null}async set(e,t,n=null){const r=this.buildKey(e),i={key:r,value:t,size:CI(t),lastAccessed:_g(),createdAt:_g(),ttl:n,expiresAt:n?_g()+n:null};try{if(!this.db){this.fallback.setItem(r,JSON.stringify(i));return}await Cr(this.db,"readwrite",a=>a.put(i)),await this.ensureWithinQuota()}catch{await this.evictLeastRecentlyUsed();try{this.db?await Cr(this.db,"readwrite",o=>o.put(i)):this.fallback.setItem(r,JSON.stringify(i))}catch{await this.clearAll()}}}async remove(e){const t=this.buildKey(e);if(!this.db){this.fallback.removeItem(t);return}await Cr(this.db,"readwrite",n=>n.delete(t))}async clearAll(){this.db&&await Cr(this.db,"readwrite",t=>t.clear());const e=`${this.namespace}:
`;for(let t=this.fallback.length-1;t>=0;t--){const n=this.fallback.key(t);n&&n.startsWith(e)&&this.fallback.removeItem(n)}}async ensureWithinQuota(){if(!this.db)return;let e=0;const t=[];if(await Cr(this.db,"readonly",r=>new Promise((i,a)=>{const o=r.openCursor();o.onsuccess=()=>{const l=o.result;if(l){const u=l.value;e+=u.size||0,t.push(u),l.continue()}else i()},o.onerror=()=>i()})),e<=this.maxBytes)return;t.sort((r,i)=>(r.lastAccessed||0)-(i.lastAccessed||0));let n=0;for(;e>this.maxBytes&&n<t.length;){const r=t[n++];await Cr(this.db,"readwrite",i=>i.delete(r.key)),e-=r.size||0}}async evictLeastRecentlyUsed(e=5){if(!this.db)return;const t=[];await Cr(this.db,"readonly",n=>new Promise((r,i)=>{const a=n.openCursor();a.onsuccess=()=>{const o=a.result;o?(t.push(o.value),o.continue()):r()},a.onerror=()=>r()})),t.sort((n,r)=>(n.lastAccessed||0)-(r.lastAccessed||0));for(let n=0;n<Math.min(e,t.length);n++)await Cr(this.db,"readwrite",r=>r.delete(t[n].key))}}function N1(s,e=""){const t=e?`:${e}`:"";return{dataKey:`cache:${s}${t}`,etagKey:`etag:${s}${t}`,versionKey:`version:${s}${t}`}}async function hN(s="default"){const e=new NI({namespace:s});return await e.init(),e}const jI="/api",j1=(()=>{try{const s=en.getUserData();return s!=null&&s.id?`user:${s.id}`:"anon"}catch{return"anon"}})(),ul=hN(j1).then(s=>(console.log(`🔧 [CACHE] Initialized cache for namespace: ${j1}`),s)).catch(s=>{throw console.error("❌ [CACHE] Failed to initialize cache:",s),s});class PI{constructor(){this.baseURL=jI}getAuthHeaders(){const e=en.getStoredAccessToken(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}async makePublicRequest(e,t={}){const n=`${this.baseURL}${e}`,r={...t,headers:{"Content-Type":"application/json",...t.headers}},i=Date.now(),a=t.method||"GET";P.logRequest(a,n,t.body?JSON.parse(t.body):null);try{const o=await fetch(n,r),l=Date.now()-i;if(P.debug("NETWORK",`Response received for ${a} ${n}`,{status:o.status,statusText:o.statusText,duration:`${l}ms`,headers:Object.fromEntries(o.headers.entries())}),!o.ok){if(o.status===502){const p=new Error("Service temporarily unavailable. Please try again later.");throw P.logError(a,n,p),p}const h=await o.json().catch(()=>({error:"Unknown error"})),f=new Error(h.error||`HTTP ${o.status}`);throw f.status=o.status,P.logError(a,n,f),f}const u=await o.json();return P.logResponse(a,n,{status:o.status,data:u},l),u}catch(o){const l=Date.now()-i;if(P.logError(a,n,o),o.message.includes("Service temporarily unavailable")){const u={success:!1,error:"Service temporarily unavailable",status:502};return P.logResponse(a,n,u,l),u}if(o.name==="TypeError"&&o.message.includes("fetch")){P.warning("API","Backend server not available, using fallback data",{endpoint:e,error:o.message});const u={success:!1,error:"Backend server not available",status:0};return P.logResponse(a,n,u,l),u}throw o}}async makeRequest(e,t={}){const n=`${this.baseURL}${e}`,r={...t,headers:{...this.getAuthHeaders(),...t.headers}};t.body&&typeof t.body=="string"&&(r.headers["Content-Type"]="application/json");const i=Date.now(),a=t.method||"GET";P.logRequest(a,n,t.body?JSON.parse(t.body):null);try{const o=await fetch(n,r),l=Date.now()-i;if(P.debug("NETWORK",`Response received for ${a} ${n}`,{status:o.status,statusText:o.statusText,duration:`${l}ms`,headers:Object.fromEntries(o.headers.entries())}),!o.ok){if(o.status===502){const p=new Error("Service temporarily unavailable. Please try again later.");throw P.logError(a,n,p),p}const h=await o.json().catch(()=>({error:"Unknown error"})),f=new Error(h.error||`HTTP ${o.status}`);throw f.status=o.status,P.logError(a,n,f),f}const u=await o.json();return P.logResponse(a,n,{status:o.status,data:u},l),u}catch(o){const l=Date.now()-i;if(P.logError(a,n,o),o.message.includes("Service temporarily unavailable")){const u={success:!1,error:"Service temporarily unavailable",status:502};return P.logResponse(a,n,u,l),u}throw o}}async fetchWithCache(e,t={},n={}){const r=`${this.baseURL}${e}`,i=t.method||"GET",a=n.resource||e.split("?")[0].replace(/^\//,"").replace(/\//g,":"),o=e.includes("?")?e.split("?")[1]:"",l=o?`?${o}`:"",u=n.cacheKey||`${a}${l}`,{dataKey:h,etagKey:f}=N1(a,u),p=5*60*1e3,m=await ul,g=await m.get(h),y=await m.get(f);console.log(`🔍 [CACHE] ${e}`,{hasCachedData:!!g,hasCachedEtag:!!y,dataKey:h,etagKey:f,resource:a,cacheKeyHint:u,cachedDataSize:g?JSON.stringify(g).length:0});const b={...this.getAuthHeaders(),...t.headers||{}};y&&typeof y=="string"&&(b["If-None-Match"]=y);const v=Date.now();P.logRequest(i,r,t.body?JSON.parse(t.body):null);try{const x=await fetch(r,{...t,headers:b}),w=Date.now()-v,E=Object.fromEntries(x.headers.entries());if(P.debug("NETWORK",`Response received for ${i} ${r}`,{status:x.status,statusText:x.statusText,duration:`${w}ms`,headers:E}),x.status===304&&g)return P.success("CACHE","Serving cached data (304)",{endpoint:e}),g;if(!x.ok){const j=await x.json().catch(()=>({error:"Unknown error"})),R=new Error(j.error||`HTTP ${x.status}`);if(R.status=x.status,P.logError(i,r,R),g)return console.log(`⚠️ [CACHE] Network error, returning cached data for ${e}`,{status:x.status,hasCachedData:!!g,cachedDataSize:JSON.stringify(g).length}),window.dispatchEvent(new CustomEvent("cache:fallback",{detail:{endpoint:e,resource:a,reason:"network_error"}})),P.warning("CACHE","Network error, returning cached data",{endpoint:e}),g;throw console.log(`❌ [CACHE] Network error and no cached data for ${e}`,{status:x.status,hasCachedData:!!g}),R}const T=await x.json();P.logResponse(i,r,{status:x.status,data:T},w);const C=x.headers.get("ETag")||x.headers.get("Etag")||x.headers.get("etag"),N=JSON.parse(JSON.stringify(T));return console.log(`💾 [CACHE] Storing data for ${e}`,{dataKey:h,etagKey:f,dataSize:JSON.stringify(N).length,hasEtag:!!C}),await m.set(h,N,p),C&&await m.set(f,C,p),await this.warmCacheForResource(a,N,C,m),T}catch(x){if(console.log(`💥 [CACHE] Exception occurred for ${e}`,{error:x.message,hasCachedData:!!g,cachedDataSize:g?JSON.stringify(g).length:0}),P.logError(i,r,x),g)return console.log(`✅ [CACHE] Exception fallback, returning cached data for ${e}`),window.dispatchEvent(new CustomEvent("cache:fallback",{detail:{endpoint:e,resource:a,reason:"exception"}})),P.warning("CACHE","Error occurred, returning cached data",{endpoint:e}),g;throw console.log(`❌ [CACHE] Exception and no cached data for ${e}`),x}}async invalidateListCache(e){try{const t=await ul,n=await this.getCacheKeys(e);for(const r of n)r.includes(e)&&await t.remove(r)}catch(t){console.warn("Cache invalidation failed:",t)}}async getCacheKeys(e){return[`cache:${e}`,`etag:${e}`,`version:${e}`]}async warmCacheForResource(e,t,n,r){try{const a={teachers:["?status=active","?status=inactive",""],students:["?status=active&limit=100","?status=active&page=1&limit=50&sort_by=added_date&sort_order=desc","?status=active"]}[e]||[];for(const o of a){const l=`${e}${o}`,{dataKey:u,etagKey:h}=N1(e,l);await r.get(u)||(console.log(`🔥 [CACHE] Warming cache for ${l}`),await r.set(u,t,this.TTL),n&&await r.set(h,n,this.TTL))}}catch(i){console.warn("Cache warming failed:",i)}}async getVersions(){return this.makeRequest("/versions")}async login(e,t){var n,r;P.info("AUTH","Attempting login",{username:e,hasPassword:!!t});try{const i=await this.makeRequest("/auth/login",{method:"POST",body:JSON.stringify({username:e,password:t})});return i.success?P.success("AUTH","Login successful",{username:e,role:(n=i.user)==null?void 0:n.role,userId:(r=i.user)==null?void 0:r.id}):P.warning("AUTH","Login failed",{username:e,error:i.error}),i}catch(i){throw P.error("AUTH","Login error",{username:e,error:i.message}),i}}async refreshToken(e){P.debug("AUTH","Refreshing token",{hasToken:!!e});try{const t=await this.makeRequest("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return t.success?P.success("AUTH","Token refreshed successfully"):P.warning("AUTH","Token refresh failed",{error:t.error}),t}catch(t){throw P.error("AUTH","Token refresh error",{error:t.message}),t}}async logout(){return this.makeRequest("/auth/logout",{method:"POST"})}async verifyToken(){return this.makeRequest("/auth/verify")}async changePassword(e,t){return this.makeRequest("/auth/change-password",{method:"POST",body:JSON.stringify({oldPassword:e,newPassword:t})})}async getProfile(){return this.makeRequest("/auth/profile")}async validateCredentials(e,t){return this.makeRequest("/auth/validate-credentials",{method:"POST",body:JSON.stringify({username:e,password:t})})}async checkUsername(e){return this.makeRequest(`/auth/check-username/${encodeURIComponent(e)}`)}async getTeachers(e={}){console.log("🔍 [API] getTeachers called with filters:",e);const t=new URLSearchParams;Object.entries(e).forEach(([a,o])=>{o!=null&&o!==""&&t.append(a,o)}),t.append("_t",Date.now());const n=t.toString(),r=`/teachers${n?`?${n}`:""}`;console.log("🔍 [API] getTeachers URL:",r);const i=await this.fetchWithCache(r,{method:"GET"},{resource:"teachers",cacheKey:n});return console.log("🔍 [API] getTeachers result:",i),i}async getTeacher(e){const t=`/teachers/${e}?_t=${Date.now()}`;return this.fetchWithCache(t,{method:"GET"},{resource:"teacher",cacheKey:`${e}-${Date.now()}`})}async createTeacher(e){return this.makeRequest("/teachers",{method:"POST",body:JSON.stringify(e)})}async updateTeacher(e,t){const n=await this.makeRequest(`/teachers/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success&&(await(await ul).remove(`cache:teacher:${e}`),await this.invalidateListCache("teachers")),n}async deactivateTeacher(e){return this.makeRequest(`/teachers/${e}/deactivate`,{method:"POST"})}async deleteTeacher(e){return this.makeRequest(`/teachers/${e}`,{method:"DELETE"})}async reactivateTeacher(e){return this.makeRequest(`/teachers/${e}/reactivate`,{method:"POST"})}async getTeacherStudents(e){const t=`/teachers/${e}/students?_t=${Date.now()}`;return this.fetchWithCache(t,{method:"GET"},{resource:"teachers",cacheKey:`students-${e}-${Date.now()}`})}async getTeacherSchedule(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/teachers/${e}/schedule${n}`)}async getTeacherStats(e,t={}){const n=new URLSearchParams(t).toString(),r=`/teachers/${e}/stats${n?`?${n}`:""}`;return this.fetchWithCache(r,{method:"GET"},{resource:"teachers",cacheKey:`stats-${e}-${n||"all"}`})}async getMonthlyLessonStats(e,t){const r=`/teachers/monthly-stats?${new URLSearchParams({month:e,year:t}).toString()}`;return this.fetchWithCache(r,{method:"GET"},{resource:"teachers",cacheKey:`monthly-stats-${t}-${e}`})}async getRandomTeachers(e=3){var t,n;P.info("TEACHERS","Fetching random teachers (public)",{count:e});try{const r=await this.makePublicRequest(`/teachers/random/${e}`);if(r.success)return P.success("TEACHERS","Random teachers fetched",{count:((t=r.teachers)==null?void 0:t.length)||0,teacherIds:((n=r.teachers)==null?void 0:n.map(i=>i.id))||[]}),r;{P.warning("TEACHERS","Failed to fetch random teachers from API",{count:e,error:r.error});const i=[{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience. Specializes in business English and conversation practice.",photo_url:"/pics/teachers/sarah.jpg"},{id:2,name:"Michael Chen",description:"Native Mandarin speaker teaching Chinese language and culture. Patient and encouraging teaching style.",photo_url:"/pics/teachers/michael.jpg"},{id:3,name:"Elena Rodriguez",description:"Spanish teacher from Madrid with expertise in grammar and pronunciation. Loves teaching through music and culture.",photo_url:"/pics/teachers/elena.jpg"}].slice(0,e);return P.info("TEACHERS","Using fallback teacher data",{count:i.length,reason:"API unavailable"}),{success:!0,teachers:i,fallback:!0}}}catch(r){P.error("TEACHERS","Error fetching random teachers",{count:e,error:r.message});const i=[{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience. Specializes in business English and conversation practice.",photo_url:"/pics/teachers/sarah.jpg"},{id:2,name:"Michael Chen",description:"Native Mandarin speaker teaching Chinese language and culture. Patient and encouraging teaching style.",photo_url:"/pics/teachers/michael.jpg"},{id:3,name:"Elena Rodriguez",description:"Spanish teacher from Madrid with expertise in grammar and pronunciation. Loves teaching through music and culture.",photo_url:"/pics/teachers/elena.jpg"}].slice(0,e);return P.info("TEACHERS","Using fallback teacher data due to error",{count:i.length,error:r.message}),{success:!0,teachers:i,fallback:!0}}}async getTeacherMonthlyStats(e,t,n){return this.makeRequest(`/teachers/${e}/monthly-stats/${t}/${n}`)}async getTeacherAttendance(e,t,n){const r=new URLSearchParams;t&&r.append("start_date",t),n&&r.append("end_date",n);const i=r.toString();return this.makeRequest(`/teachers/${e}/attendance${i?`?${i}`:""}`)}async getTeacherLessons(e,t,n,r,i){const a=new URLSearchParams;t&&a.append("start_date",t),n&&a.append("end_date",n),r&&a.append("page",r),i&&a.append("limit",i);const o=a.toString();return this.makeRequest(`/teachers/${e}/lessons${o?`?${o}`:""}`)}async uploadTeacherPhoto(e,t){return this.makeRequest(`/teachers/${e}/upload-photo`,{method:"POST",body:JSON.stringify({photo_url:t})})}async searchTeachers(e,t=1,n=50){const r=new URLSearchParams({q:e,page:t,limit:n});return this.makeRequest(`/teachers/search?${r}`)}async getInactiveTeachers(){return this.makeRequest("/teachers/inactive")}async bulkUpdateTeachers(e,t){return this.makeRequest("/teachers/bulk-update",{method:"POST",body:JSON.stringify({teacherIds:e,updates:t})})}async reactivateStudent(e){return this.makeRequest(`/students/${e}/reactivate`,{method:"POST"})}async getStudentSchedule(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/students/${e}/schedule${n}`)}async getStudentLessons(e){return this.makeRequest(`/students/${e}/lessons`)}async reassignStudent(e,t){return this.makeRequest(`/students/${e}/reassign`,{method:"POST",body:JSON.stringify({new_teacher_id:t})})}async searchStudents(e,t=1,n=50){const r=new URLSearchParams({q:e,page:t,limit:n});return this.makeRequest(`/students/search?${r}`)}async getStudentAttendance(e,t){const n=t?`?period=${t}`:"";return this.makeRequest(`/students/${e}/attendance${n}`)}async getStudentProgress(e){return this.makeRequest(`/students/${e}/progress`)}async getStudentsByTeacher(e){return this.makeRequest(`/students/teacher/${e}`)}async getCurrentStudents(e){var t;P.info("STUDENTS","Fetching current students for teacher",{teacherId:e});try{const n=await this.makeRequest(`/students/teacher/${e}/current`);return n.success?P.success("STUDENTS","Current students fetched successfully",{count:((t=n.students)==null?void 0:t.length)||0,teacherId:e}):P.warning("STUDENTS","Failed to fetch current students",{error:n.error}),n}catch(n){throw P.error("STUDENTS","Error fetching current students",{error:n.message}),n}}async getInactiveStudents(){return this.makeRequest("/students/inactive")}async exportStudents(){return this.makeRequest("/students/export")}async getStudentTeachers(e){return this.makeRequest(`/students/${e}/teachers`)}async bulkUpdateStudents(e,t){return this.makeRequest("/students/bulk-update",{method:"POST",body:JSON.stringify({studentIds:e,updates:t})})}async getSchedules(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.fetchWithCache(`/schedules${n?`?${n}`:""}`,{method:"GET"},{resource:"schedules",cacheKey:n})}async getWeeklySchedule(e){return this.makeRequest(`/schedules/week/${e}`)}async createSchedule(e){const t=await this.makeRequest("/schedules",{method:"POST",body:JSON.stringify(e)});return t.success&&await this.invalidateListCache("teachers"),t}async updateSchedule(e,t){return this.makeRequest(`/schedules/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteSchedule(e){const t=await this.makeRequest(`/schedules/${e}`,{method:"DELETE"});return t.success&&await this.invalidateListCache("teachers"),t}async bulkUpdateSchedules(e){return this.makeRequest("/schedules/bulk",{method:"POST",body:JSON.stringify({schedules:e})})}async getScheduleConflicts(e){const t=e?`?week_start=${e}`:"";return this.makeRequest(`/schedules/conflicts${t}`)}async getTeacherSchedules(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/schedules/teacher/${e}${n}`)}async getStudentSchedules(e,t){const n=t?`?week_start=${t}`:"";return this.makeRequest(`/schedules/student/${e}${n}`)}async getMonthlySchedules(e,t){return this.makeRequest(`/schedules/month/${e}/${t}`)}async saveWeekSchedule(e,t){return this.makeRequest("/schedules/save-week",{method:"POST",body:JSON.stringify({week_start_date:e,schedules:t})})}async discardChanges(){return this.makeRequest("/schedules/discard-changes",{method:"POST"})}async getAvailableSlots(e,t,n){const r=new URLSearchParams({teacher_id:e,day_of_week:t,week_start_date:n});return this.makeRequest(`/schedules/available-slots?${r}`)}async reassignStudentSchedules(e,t,n){return this.makeRequest("/schedules/reassign-student",{method:"POST",body:JSON.stringify({student_id:e,new_teacher_id:t,schedule_ids:n})})}async reassignStudentInSchedule(e,t,n){return this.makeRequest("/schedules/reassign-student",{method:"POST",body:JSON.stringify({student_id:e,new_teacher_id:t,schedule_ids:n})})}async getAttendance(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.makeRequest(`/attendance${n?`?${n}`:""}`)}async markAttendance(e,t,n){return this.makeRequest("/attendance/mark",{method:"POST",body:JSON.stringify({schedule_id:e,status:t,attendance_date:n})})}async updateAttendance(e,t,n){return this.makeRequest(`/attendance/${e}`,{method:"PUT",body:JSON.stringify({status:t,attendance_date:n})})}async getTeacherAttendance(e,t){const n=t?`?period=${t}`:"";return this.makeRequest(`/attendance/teacher/${e}${n}`)}async getStudentAttendance(e,t){const n=t?`?period=${t}`:"";return this.makeRequest(`/attendance/student/${e}${n}`)}async getAttendanceStats(e,t,n){const r=new URLSearchParams;e&&r.append("teacher_id",e),t&&r.append("student_id",t),n&&r.append("period",n);const i=r.toString();return this.makeRequest(`/attendance/stats${i?`?${i}`:""}`)}async getWeeklyAttendance(e){return this.makeRequest(`/attendance/week/${e}`)}async getMonthlyAttendance(e,t){return this.makeRequest(`/attendance/month/${e}/${t}`)}async bulkMarkAttendance(e){return this.makeRequest("/attendance/bulk-mark",{method:"POST",body:JSON.stringify({attendance_updates:e})})}async exportAttendance(e){const t=e?`?period=${e}`:"";return this.makeRequest(`/attendance/export${t}`)}async getStudentAttendanceAnalytics(e,t,n,r="week"){const i=new URLSearchParams;return t&&i.append("from",t),n&&i.append("to",n),i.append("bucket",r),this.fetchWithCache(`/analytics/students/${e}/attendance?${i.toString()}`,{method:"GET"},{resource:"analytics",cacheKey:`student_${e}_${t}_${n}`})}async getTeacherAttendanceAnalytics(e,t,n,r="week"){const i=new URLSearchParams;return t&&i.append("from",t),n&&i.append("to",n),i.append("bucket",r),this.fetchWithCache(`/analytics/teachers/${e}/attendance?${i.toString()}`,{method:"GET"},{resource:"analytics",cacheKey:`teacher_${e}_${t}_${n}`})}async getMyTeacherAttendanceAnalytics(e,t,n="week"){const r=new URLSearchParams;return e&&r.append("from",e),t&&r.append("to",t),r.append("bucket",n),this.fetchWithCache(`/analytics/teachers/me/attendance?${r.toString()}`,{method:"GET"},{resource:"analytics",cacheKey:`teacher_me_${e}_${t}`})}async getReports(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.makeRequest(`/reports${n?`?${n}`:""}`)}async getReport(e){return this.makeRequest(`/reports/${e}`)}async createReport(e){return this.makeRequest("/reports",{method:"POST",body:JSON.stringify(e)})}async updateReport(e,t){return this.makeRequest(`/reports/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteReport(e){return this.makeRequest(`/reports/${e}`,{method:"DELETE"})}async getTeacherReports(e,t={}){const n=new URLSearchParams;Object.entries(t).forEach(([i,a])=>{a!=null&&a!==""&&n.append(i,a)});const r=n.toString();return this.makeRequest(`/reports/teacher/${e}${r?`?${r}`:""}`)}async getStudentReports(e,t={}){const n=new URLSearchParams;Object.entries(t).forEach(([i,a])=>{a!=null&&a!==""&&n.append(i,a)});const r=n.toString();return this.makeRequest(`/reports/student/${e}${r?`?${r}`:""}`)}async getReportsByDate(e){return this.makeRequest(`/reports/date/${e}`)}async getWeeklyReports(e){return this.makeRequest(`/reports/week/${e}`)}async getMonthlyReports(e,t){return this.makeRequest(`/reports/month/${e}/${t}`)}async bulkCreateReports(e){return this.makeRequest("/reports/bulk-create",{method:"POST",body:JSON.stringify({reports:e})})}async exportReports(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const n=t.toString();return this.makeRequest(`/reports/export${n?`?${n}`:""}`)}async setFeaturedTeachers(e){return this.makeRequest("/content/featured-teachers",{method:"POST",body:JSON.stringify({teacher_ids:e})})}async reorderCourses(e){return this.makeRequest("/content/courses/reorder",{method:"POST",body:JSON.stringify({course_orders:e})})}async exportContent(){return this.makeRequest("/content/export")}async getTeacherPassword(e){return this.makeRequest(`/passwords/teacher/${e}`)}async changeTeacherPassword(e,t){return this.makeRequest(`/passwords/teacher/${e}`,{method:"PUT",body:JSON.stringify({new_password:t})})}async resetTeacherPassword(e,t){return this.makeRequest(`/passwords/teacher/${e}/reset`,{method:"POST",body:JSON.stringify({new_password:t})})}async bulkResetPasswords(e,t){return this.makeRequest("/passwords/bulk-reset",{method:"POST",body:JSON.stringify({teacher_ids:e,new_password:t})})}async getPasswordHistory(e){return this.makeRequest(`/passwords/history/${e}`)}async validatePassword(e){return this.makeRequest("/passwords/validate",{method:"POST",body:JSON.stringify({password:e})})}async getPasswordPolicy(){return this.makeRequest("/passwords/policy")}async checkCurrentPassword(e){return this.makeRequest("/passwords/check-current",{method:"POST",body:JSON.stringify({password:e})})}async uploadImage(e){return this.makeRequest("/cloudinary/upload",{method:"POST",body:JSON.stringify(e)})}async deleteImage(e){return this.makeRequest("/cloudinary/delete",{method:"DELETE",body:JSON.stringify({public_id:e})})}async uploadTeacherPhoto(e,t){return this.makeRequest("/cloudinary/upload-teacher-photo",{method:"POST",body:JSON.stringify({teacher_id:e,image:t})})}async uploadCourseImage(e,t){return this.makeRequest("/cloudinary/upload-course-image",{method:"POST",body:JSON.stringify({course_id:e,image:t})})}async uploadMissionBanner(e){return this.makeRequest("/cloudinary/upload-mission-banner",{method:"POST",body:JSON.stringify({image:e})})}async getTransformedImageUrl(e,t){const n=new URLSearchParams;e&&n.append("public_id",e),t&&n.append("transformations",t);const r=n.toString();return this.makeRequest(`/cloudinary/transform${r?`?${r}`:""}`)}async bulkUploadImages(e,t){return this.makeRequest("/cloudinary/bulk-upload",{method:"POST",body:JSON.stringify({images:e,folder:t})})}async listImages(e,t,n){const r=new URLSearchParams;e&&r.append("folder",e),t&&r.append("max_results",t),n&&r.append("next_cursor",n);const i=r.toString();return this.makeRequest(`/cloudinary/images${i?`?${i}`:""}`)}async getStudents(e={}){var t;P.info("STUDENTS","Fetching students",{filters:e});try{const n=new URLSearchParams;Object.entries(e).forEach(([a,o])=>{o!==void 0&&o!==""&&n.append(a,o)}),n.append("_t",Date.now());const r=n.toString(),i=await this.fetchWithCache(`/students${r?`?${r}`:""}`,{method:"GET"},{resource:"students",cacheKey:r});return i.success?P.success("STUDENTS","Students fetched successfully",{count:((t=i.students)==null?void 0:t.length)||0,total:i.total||0}):P.warning("STUDENTS","Failed to fetch students",{error:i.error}),i}catch(n){throw P.error("STUDENTS","Error fetching students",{error:n.message}),n}}async getStudentMonthlyLessons(e,t){var n;P.info("STUDENTS","Fetching monthly lessons",{month:e,year:t});try{const i=`/students/monthly-lessons?${new URLSearchParams({month:e,year:t}).toString()}`,a=await this.fetchWithCache(i,{method:"GET"},{resource:"students",cacheKey:`monthly-lessons-${t}-${e}`});return a.success?P.success("STUDENTS","Monthly lessons fetched successfully",{count:((n=a.monthlyLessons)==null?void 0:n.length)||0,month:a.month,year:a.year}):P.warning("STUDENTS","Failed to fetch monthly lessons",{error:a.error}),a}catch(r){throw P.error("STUDENTS","Error fetching monthly lessons",{error:r.message}),r}}async getInactiveStudents(){var e;P.info("STUDENTS","Fetching inactive students");try{const t=await this.makeRequest("/students/inactive");return t.success?P.success("STUDENTS","Inactive students fetched",{count:((e=t.students)==null?void 0:e.length)||0}):P.warning("STUDENTS","Failed to fetch inactive students",{error:t.error}),t}catch(t){throw P.error("STUDENTS","Error fetching inactive students",{error:t.message}),t}}async getStudent(e){P.info("STUDENTS","Fetching student",{studentId:e});try{const t=await this.fetchWithCache(`/students/${e}`,{method:"GET"},{resource:"student",cacheKey:e});return t.success?P.success("STUDENTS","Student fetched successfully",{studentId:e}):P.warning("STUDENTS","Failed to fetch student",{studentId:e,error:t.error}),t}catch(t){throw P.error("STUDENTS","Error fetching student",{studentId:e,error:t.message}),t}}async createStudent(e){var t;P.info("STUDENTS","Creating student",{studentData:e});try{const n=await this.makeRequest("/students",{method:"POST",body:JSON.stringify(e)});return n.success?P.success("STUDENTS","Student created successfully",{studentId:(t=n.student)==null?void 0:t.id}):P.warning("STUDENTS","Failed to create student",{error:n.error}),n}catch(n){throw P.error("STUDENTS","Error creating student",{error:n.message}),n}}async updateStudent(e,t){P.info("STUDENTS","Updating student",{studentId:e,studentData:t});try{const n=await this.makeRequest(`/students/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?P.success("STUDENTS","Student updated successfully",{studentId:e}):P.warning("STUDENTS","Failed to update student",{studentId:e,error:n.error}),n}catch(n){throw P.error("STUDENTS","Error updating student",{studentId:e,error:n.message}),n}}async getStudentLevel(e){P.info("STUDENTS","Fetching student level",{studentId:e});const t=await ul,n=`student-level:${e}`,r=await t.get(n);if(r)return P.debug("STUDENTS","Student level found in cache",{studentId:e,level:r.student_level}),r;try{const i=await this.makeRequest(`/students/${e}/level`);return i.success?(await t.set(n,i.student,3e5),P.success("STUDENTS","Student level fetched and cached",{studentId:e,level:i.student.student_level})):P.warning("STUDENTS","Failed to fetch student level",{studentId:e,error:i.error}),i}catch(i){throw P.error("STUDENTS","Error fetching student level",{studentId:e,error:i.message}),i}}async updateStudentLevel(e,t){P.info("STUDENTS","Updating student level",{studentId:e,studentLevel:t});try{const n=await this.makeRequest(`/students/${e}/level`,{method:"PUT",body:JSON.stringify({student_level:t})});if(n.success){const r=await ul,i=`student-level:${e}`;await r.set(i,n.student,3e5),await this.invalidateListCache("students"),P.success("STUDENTS","Student level updated successfully",{studentId:e,studentLevel:t})}else P.warning("STUDENTS","Failed to update student level",{studentId:e,error:n.error});return n}catch(n){throw P.error("STUDENTS","Error updating student level",{studentId:e,error:n.message}),n}}async getTeacherLevel(e){P.info("TEACHERS","Fetching teacher level",{teacherId:e});const t=await ul,n=`teacher-level:${e}`,r=await t.get(n);if(r)return P.debug("TEACHERS","Teacher level found in cache",{teacherId:e,level:r.teacher_level}),r;try{const i=await this.makeRequest(`/teachers/${e}/level`);return i.success?(await t.set(n,i.teacher,3e5),P.success("TEACHERS","Teacher level fetched and cached",{teacherId:e,level:i.teacher.teacher_level})):P.warning("TEACHERS","Failed to fetch teacher level",{teacherId:e,error:i.error}),i}catch(i){throw P.error("TEACHERS","Error fetching teacher level",{teacherId:e,error:i.message}),i}}async updateTeacherLevel(e,t){P.info("TEACHERS","Updating teacher level",{teacherId:e,teacherLevel:t});try{const n=await this.makeRequest(`/teachers/${e}/level`,{method:"PUT",body:JSON.stringify({teacher_level:t})});if(n.success){const r=await ul,i=`teacher-level:${e}`;await r.set(i,n.teacher,3e5),await this.invalidateListCache("teachers"),P.success("TEACHERS","Teacher level updated successfully",{teacherId:e,teacherLevel:t})}else P.warning("TEACHERS","Failed to update teacher level",{teacherId:e,error:n.error});return n}catch(n){throw P.error("TEACHERS","Error updating teacher level",{teacherId:e,error:n.message}),n}}async deactivateStudent(e){P.info("STUDENTS","Deactivating student",{studentId:e});try{const t=await this.makeRequest(`/students/${e}/deactivate`,{method:"POST"});return t.success?P.success("STUDENTS","Student deactivated successfully",{studentId:e}):P.warning("STUDENTS","Failed to deactivate student",{studentId:e,error:t.error}),t}catch(t){throw P.error("STUDENTS","Error deactivating student",{studentId:e,error:t.message}),t}}async deleteStudent(e){P.info("STUDENTS","Deleting student",{studentId:e});try{const t=await this.makeRequest(`/students/${e}`,{method:"DELETE"});return t.success?P.success("STUDENTS","Student deleted successfully",{studentId:e}):P.warning("STUDENTS","Failed to delete student",{studentId:e,error:t.error}),t}catch(t){throw P.error("STUDENTS","Error deleting student",{studentId:e,error:t.message}),t}}async getMissionContent(){P.info("CONTENT","Fetching mission content");try{const e=await this.makeRequest("/content/mission");return e.success?P.success("CONTENT","Mission content fetched successfully"):P.warning("CONTENT","Failed to fetch mission content",{error:e.error}),e}catch(e){throw P.error("CONTENT","Error fetching mission content",{error:e.message}),e}}async updateMissionContent(e){P.info("CONTENT","Updating mission content",{missionData:e});try{const t=await this.makeRequest("/content/mission",{method:"PUT",body:JSON.stringify(e)});return t.success?P.success("CONTENT","Mission content updated successfully"):P.warning("CONTENT","Failed to update mission content",{error:t.error}),t}catch(t){throw P.error("CONTENT","Error updating mission content",{error:t.message}),t}}async getCourses(){var e;P.info("CONTENT","Fetching courses");try{const t=await this.makeRequest("/content/courses");return t.success?P.success("CONTENT","Courses fetched successfully",{count:((e=t.courses)==null?void 0:e.length)||0}):P.warning("CONTENT","Failed to fetch courses",{error:t.error}),t}catch(t){throw P.error("CONTENT","Error fetching courses",{error:t.message}),t}}async createCourse(e){var t;P.info("CONTENT","Creating course",{courseData:e});try{const n=await this.makeRequest("/content/courses",{method:"POST",body:JSON.stringify(e)});return n.success?P.success("CONTENT","Course created successfully",{courseId:(t=n.course)==null?void 0:t.id}):P.warning("CONTENT","Failed to create course",{error:n.error}),n}catch(n){throw P.error("CONTENT","Error creating course",{error:n.message}),n}}async updateCourse(e,t){P.info("CONTENT","Updating course",{courseId:e,courseData:t});try{const n=await this.makeRequest(`/content/courses/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?P.success("CONTENT","Course updated successfully",{courseId:e}):P.warning("CONTENT","Failed to update course",{courseId:e,error:n.error}),n}catch(n){throw P.error("CONTENT","Error updating course",{courseId:e,error:n.message}),n}}async deleteCourse(e){P.info("CONTENT","Deleting course",{courseId:e});try{const t=await this.makeRequest(`/content/courses/${e}`,{method:"DELETE"});return t.success?P.success("CONTENT","Course deleted successfully",{courseId:e}):P.warning("CONTENT","Failed to delete course",{courseId:e,error:t.error}),t}catch(t){throw P.error("CONTENT","Error deleting course",{courseId:e,error:t.message}),t}}async toggleCourse(e,t){P.info("CONTENT","Toggling course",{courseId:e,isActive:t});try{const n=await this.makeRequest(`/content/courses/${e}/toggle`,{method:"PUT",body:JSON.stringify({is_active:t})});return n.success?P.success("CONTENT","Course toggled successfully",{courseId:e,isActive:t}):P.warning("CONTENT","Failed to toggle course",{courseId:e,error:n.error}),n}catch(n){throw P.error("CONTENT","Error toggling course",{courseId:e,error:n.message}),n}}async uploadImage(e,t="lang-school",n=null,r=null){P.info("CLOUDINARY","Uploading image",{folder:t,hasPublicId:!!n});try{const i=await this.makeRequest("/cloudinary/upload",{method:"POST",body:JSON.stringify({image:e,folder:t,public_id:n,transformations:r})});return i.success?P.success("CLOUDINARY","Image uploaded successfully",{publicId:i.public_id,url:i.secure_url}):P.warning("CLOUDINARY","Failed to upload image",{error:i.error}),i}catch(i){throw P.error("CLOUDINARY","Error uploading image",{error:i.message}),i}}async deleteImage(e){P.info("CLOUDINARY","Deleting image",{publicId:e});try{const t=await this.makeRequest("/cloudinary/delete",{method:"DELETE",body:JSON.stringify({public_id:e})});return t.success?P.success("CLOUDINARY","Image deleted successfully",{publicId:e}):P.warning("CLOUDINARY","Failed to delete image",{publicId:e,error:t.error}),t}catch(t){throw P.error("CLOUDINARY","Error deleting image",{publicId:e,error:t.message}),t}}async uploadCourseImage(e,t){P.info("CLOUDINARY","Uploading course image",{courseId:e});try{const n=await this.makeRequest("/cloudinary/upload-course-image",{method:"POST",body:JSON.stringify({course_id:e,image:t})});return n.success?P.success("CLOUDINARY","Course image uploaded successfully",{courseId:e,publicId:n.public_id,url:n.secure_url}):P.warning("CLOUDINARY","Failed to upload course image",{courseId:e,error:n.error}),n}catch(n){throw P.error("CLOUDINARY","Error uploading course image",{courseId:e,error:n.message}),n}}async uploadMissionBanner(e){P.info("CLOUDINARY","Uploading mission banner",{});try{const t=await this.makeRequest("/cloudinary/upload-mission-banner",{method:"POST",body:JSON.stringify({image:e})});return t.success?P.success("CLOUDINARY","Mission banner uploaded successfully",{publicId:t.public_id,url:t.secure_url}):P.warning("CLOUDINARY","Failed to upload mission banner",{error:t.error}),t}catch(t){throw P.error("CLOUDINARY","Error uploading mission banner",{error:t.message}),t}}async getShowcaseSettings(){P.info("CONTENT","Fetching showcase settings");try{const e=await this.makeRequest("/content/showcase");return e.success?P.success("CONTENT","Showcase settings fetched successfully"):P.warning("CONTENT","Failed to fetch showcase settings",{error:e.error}),e}catch(e){throw P.error("CONTENT","Error fetching showcase settings",{error:e.message}),e}}async getShowcaseSettingsPublic(){P.info("CONTENT","Fetching showcase settings (public)");try{const e=await this.makePublicRequest("/content/showcase/public");return e.success?P.success("CONTENT","Showcase settings fetched successfully (public)"):P.warning("CONTENT","Failed to fetch showcase settings (public)",{error:e.error}),e}catch(e){throw P.error("CONTENT","Error fetching showcase settings (public)",{error:e.message}),e}}async updateShowcaseSettings(e){P.info("CONTENT","Updating showcase settings",{settings:e});try{const t=await this.makeRequest("/content/showcase",{method:"PUT",body:JSON.stringify(e)});return t.success?P.success("CONTENT","Showcase settings updated successfully"):P.warning("CONTENT","Failed to update showcase settings",{error:t.error}),t}catch(t){throw P.error("CONTENT","Error updating showcase settings",{error:t.message}),t}}async getStudentTeachers(e){var t;try{P.info("TEACHER_MGMT","Fetching student teachers",{studentId:e});const n=await this.makeRequest(`/students/${e}/teachers`,{method:"GET"});return n.success?P.success("TEACHER_MGMT","Student teachers fetched successfully",{count:((t=n.teachers)==null?void 0:t.length)||0}):P.warning("TEACHER_MGMT","Failed to fetch student teachers",{error:n.error}),n}catch(n){throw P.error("TEACHER_MGMT","Error fetching student teachers",{error:n.message}),n}}async addStudentTeacher(e,t){try{P.info("TEACHER_MGMT","Adding teacher to student",{studentId:e,teacherData:t});const n=await this.makeRequest(`/students/${e}/teachers`,{method:"POST",body:JSON.stringify(t)});return n.success?(P.success("TEACHER_MGMT","Teacher added successfully"),await this.invalidateListCache("teachers")):P.warning("TEACHER_MGMT","Failed to add teacher",{error:n.error}),n}catch(n){throw P.error("TEACHER_MGMT","Error adding teacher",{error:n.message}),n}}async removeStudentTeacher(e,t){try{P.info("TEACHER_MGMT","Removing teacher from student",{studentId:e,teacherId:t});const n=await this.makeRequest(`/students/${e}/teachers/${t}`,{method:"DELETE"});return n.success?(P.success("TEACHER_MGMT","Teacher removed successfully"),await this.invalidateListCache("teachers")):P.warning("TEACHER_MGMT","Failed to remove teacher",{error:n.error}),n}catch(n){throw P.error("TEACHER_MGMT","Error removing teacher",{error:n.message}),n}}async getCurrentStudents(e){var t;try{P.info("STUDENT_SUGGESTIONS","Fetching current students",{teacherId:e});const n=await this.makeRequest(`/students/teacher/${e}/current`);return n.success?P.success("STUDENT_SUGGESTIONS","Current students fetched successfully",{count:((t=n.students)==null?void 0:t.length)||0}):P.warning("STUDENT_SUGGESTIONS","Failed to fetch current students",{error:n.error}),n}catch(n){throw P.error("STUDENT_SUGGESTIONS","Error fetching current students",{error:n.message}),n}}async getHistoryStudents(e){var t;try{P.info("STUDENT_SUGGESTIONS","Fetching history students",{teacherId:e});const n=await this.makeRequest(`/students/teacher/${e}/history`);return n.success?P.success("STUDENT_SUGGESTIONS","History students fetched successfully",{count:((t=n.students)==null?void 0:t.length)||0}):P.warning("STUDENT_SUGGESTIONS","Failed to fetch history students",{error:n.error}),n}catch(n){throw P.error("STUDENT_SUGGESTIONS","Error fetching history students",{error:n.message}),n}}async getFolders(){var e;P.info("FILES","Fetching folders");try{const t=await this.makeRequest("/files/folders");return t.success?P.success("FILES","Folders fetched successfully",{count:((e=t.folders)==null?void 0:e.length)||0}):P.warning("FILES","Failed to fetch folders",{error:t.error}),t}catch(t){throw P.error("FILES","Error fetching folders",{error:t.message}),t}}async createFolder(e){var t;P.info("FILES","Creating folder",{folderData:e});try{const n=await this.makeRequest("/files/folders",{method:"POST",body:JSON.stringify(e)});return n.success?P.success("FILES","Folder created successfully",{folderId:(t=n.folder)==null?void 0:t.id}):P.warning("FILES","Failed to create folder",{error:n.error}),n}catch(n){throw P.error("FILES","Error creating folder",{error:n.message}),n}}async updateFolder(e,t){P.info("FILES","Updating folder",{folderId:e,folderData:t});try{const n=await this.makeRequest(`/files/folders/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?P.success("FILES","Folder updated successfully",{folderId:e}):P.warning("FILES","Failed to update folder",{error:n.error}),n}catch(n){throw P.error("FILES","Error updating folder",{error:n.message}),n}}async deleteFolder(e){P.info("FILES","Deleting folder",{folderId:e});try{const t=await this.makeRequest(`/files/folders/${e}`,{method:"DELETE"});return t.success?P.success("FILES","Folder deleted successfully",{folderId:e}):P.warning("FILES","Failed to delete folder",{error:t.error}),t}catch(t){throw P.error("FILES","Error deleting folder",{error:t.message}),t}}async uploadFile(e){var t;P.info("FILES","Uploading file",{fileName:e.display_name});try{const n=await this.makeRequest("/files/upload",{method:"POST",body:JSON.stringify(e)});return n.success?P.success("FILES","File uploaded successfully",{fileId:(t=n.file)==null?void 0:t.id}):P.warning("FILES","Failed to upload file",{error:n.error}),n}catch(n){throw P.error("FILES","Error uploading file",{error:n.message}),n}}async updateFile(e,t){P.info("FILES","Updating file",{fileId:e,fileData:t});try{const n=await this.makeRequest(`/files/${e}`,{method:"PUT",body:JSON.stringify(t)});return n.success?P.success("FILES","File updated successfully",{fileId:e}):P.warning("FILES","Failed to update file",{error:n.error}),n}catch(n){throw P.error("FILES","Error updating file",{error:n.message}),n}}async deleteFile(e){P.info("FILES","Deleting file",{fileId:e});try{const t=await this.makeRequest(`/files/${e}`,{method:"DELETE"});return t.success?P.success("FILES","File deleted successfully",{fileId:e}):P.warning("FILES","Failed to delete file",{error:t.error}),t}catch(t){throw P.error("FILES","Error deleting file",{error:t.message}),t}}async getFiles(e={}){var t;P.info("FILES","Fetching files",{filters:e});try{const n=new URLSearchParams(e).toString(),r=await this.makeRequest(`/files${n?`?${n}`:""}`);return r.success?P.success("FILES","Files fetched successfully",{count:((t=r.files)==null?void 0:t.length)||0}):P.warning("FILES","Failed to fetch files",{error:r.error}),r}catch(n){throw P.error("FILES","Error fetching files",{error:n.message}),n}}async downloadFile(e){P.info("FILES","Downloading file",{fileId:e});try{const t=await this.makePublicRequest(`/files/${e}/download/public`);return t.success?P.success("FILES","File download initiated",{fileId:e}):P.warning("FILES","Failed to download file",{error:t.error}),t}catch(t){throw P.error("FILES","Error downloading file",{error:t.message}),t}}async getPublicFiles(e={}){var t;P.info("FILES","Fetching public files",{filters:e});try{const n=new URLSearchParams(e).toString(),r=await this.makePublicRequest(`/files/public${n?`?${n}`:""}`);return r.success?P.success("FILES","Public files fetched successfully",{count:((t=r.files)==null?void 0:t.length)||0}):P.warning("FILES","Failed to fetch public files",{error:r.error}),r}catch(n){throw P.error("FILES","Error fetching public files",{error:n.message}),n}}async getUploadToken(e){var t,n;P.info("UPLOAD","Getting upload token",{uploadData:e});try{const r=await this.makeRequest("/upload-token",{method:"POST",body:JSON.stringify(e)});return r.success?P.success("UPLOAD","Upload token received",{cloudName:(t=r.data)==null?void 0:t.cloudName,hasSignature:!!((n=r.data)!=null&&n.signature)}):P.warning("UPLOAD","Failed to get upload token",{error:r.error}),r}catch(r){throw P.error("UPLOAD","Error getting upload token",{error:r.message}),r}}async extendSchedules(){return this.makeRequest("/schedules/extend",{method:"POST"})}async checkExtensionReminder(){return this.makeRequest("/schedules/extension-reminder",{method:"POST"})}async getStudentPackages(e={}){var t;P.info("PACKAGES","Fetching student packages",{filters:e});try{const n=new URLSearchParams;Object.entries(e).forEach(([a,o])=>{o!==void 0&&o!==""&&n.append(a,o)});const r=n.toString(),i=await this.makeRequest(`/students/packages${r?`?${r}`:""}`);return i.success?P.success("PACKAGES","Student packages fetched successfully",{count:((t=i.packages)==null?void 0:t.length)||0,total:i.total||0}):P.warning("PACKAGES","Failed to fetch student packages",{error:i.error}),i}catch(n){throw P.error("PACKAGES","Error fetching student packages",{error:n.message}),n}}async addStudentPackage(e){var t;P.info("PACKAGES","Adding student package",{packageData:e});try{const n=await this.makeRequest("/students/packages",{method:"POST",body:JSON.stringify(e)});return n.success?P.success("PACKAGES","Student package added successfully",{packageId:(t=n.package)==null?void 0:t.id}):P.warning("PACKAGES","Failed to add student package",{error:n.error}),n}catch(n){throw P.error("PACKAGES","Error adding student package",{error:n.message}),n}}async deleteStudentPackage(e){P.info("PACKAGES","Deleting student package",{packageId:e});try{const t=await this.makeRequest(`/students/packages/${e}`,{method:"DELETE"});return t.success?P.success("PACKAGES","Student package deleted successfully",{packageId:e}):P.warning("PACKAGES","Failed to delete student package",{error:t.error}),t}catch(t){throw P.error("PACKAGES","Error deleting student package",{error:t.message}),t}}async getExhaustedPackages(){var e;P.info("PACKAGES","Fetching exhausted packages");try{const t=await this.makeRequest("/students/packages/exhausted");return t.success?P.success("PACKAGES","Exhausted packages fetched successfully",{count:((e=t.packages)==null?void 0:e.length)||0}):P.warning("PACKAGES","Failed to fetch exhausted packages",{error:t.error}),t}catch(t){throw P.error("PACKAGES","Error fetching exhausted packages",{error:t.message}),t}}async uploadFile(e){var t;P.info("SUPABASE_FILES","Uploading file",{fileName:e.display_name});try{const n=await this.makeRequest("/supabase-files/upload",{method:"POST",body:JSON.stringify(e)});return n.success?P.success("SUPABASE_FILES","File uploaded successfully",{fileId:(t=n.file)==null?void 0:t.id}):P.warning("SUPABASE_FILES","Failed to upload file",{error:n.error}),n}catch(n){throw P.error("SUPABASE_FILES","Error uploading file",{error:n.message}),n}}async downloadFile(e){P.info("SUPABASE_FILES","Downloading file",{fileId:e});try{const t=await this.makeRequest(`/supabase-files/${e}/download`);return t.success?P.success("SUPABASE_FILES","File download initiated",{fileId:e}):P.warning("SUPABASE_FILES","Failed to download file",{error:t.error}),t}catch(t){throw P.error("SUPABASE_FILES","Error downloading file",{error:t.message}),t}}async downloadFilePublic(e){P.info("SUPABASE_FILES","Downloading file (public)",{fileId:e});try{const t=await this.makeRequest(`/supabase-files/${e}/download/public`);return t.success?P.success("SUPABASE_FILES","Public file download initiated",{fileId:e}):P.warning("SUPABASE_FILES","Failed to download public file",{error:t.error}),t}catch(t){throw P.error("SUPABASE_FILES","Error downloading public file",{error:t.message}),t}}async getFileViewUrl(e){P.info("SUPABASE_FILES","Getting file view URL",{fileId:e});try{const t=await this.makeRequest(`/supabase-files/${e}/view`);return t.success?P.success("SUPABASE_FILES","File view URL generated",{fileId:e}):P.warning("SUPABASE_FILES","Failed to get file view URL",{error:t.error}),t}catch(t){throw P.error("SUPABASE_FILES","Error getting file view URL",{error:t.message}),t}}async getFileViewUrlPublic(e){P.info("SUPABASE_FILES","Getting public file view URL",{fileId:e});try{const t=await this.makeRequest(`/supabase-files/${e}/view/public`);return t.success?P.success("SUPABASE_FILES","Public file view URL generated",{fileId:e}):P.warning("SUPABASE_FILES","Failed to get public file view URL",{error:t.error}),t}catch(t){throw P.error("SUPABASE_FILES","Error getting public file view URL",{error:t.message}),t}}async getPublicFiles(e=""){var t;P.info("SUPABASE_FILES","Fetching public files",{queryParams:e});try{const n=await this.makeRequest(`/supabase-files/public?${e}`);return n.success?P.success("SUPABASE_FILES","Public files fetched successfully",{count:((t=n.files)==null?void 0:t.length)||0}):P.warning("SUPABASE_FILES","Failed to fetch public files",{error:n.error}),n}catch(n){throw P.error("SUPABASE_FILES","Error fetching public files",{error:n.message}),n}}}const te=new PI,fN=S.createContext(),Bm=()=>{const s=S.useContext(fN);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},RI=({children:s})=>{const[e,t]=S.useState(null),[n,r]=S.useState(!0);S.useEffect(()=>{(async()=>{var h,f,p,m,g,y,b,v,x,w,E,T,C;P.info("AUTH_CONTEXT","Initializing authentication");try{const N=en.getStoredTokens();if(P.debug("AUTH_CONTEXT","Stored tokens check",{hasAccessToken:!!N.accessToken,hasRefreshToken:!!N.refreshToken}),N.accessToken&&N.refreshToken)try{P.info("AUTH_CONTEXT","Verifying existing token");const j=await te.verifyToken(),R={id:(h=j.user)==null?void 0:h.id,username:(f=j.user)==null?void 0:f.username,role:(p=j.user)==null?void 0:p.role,teacherId:(m=j.user)==null?void 0:m.teacher_id,teacherName:(g=j.user)==null?void 0:g.teacher_name,isAdmin:((y=j.user)==null?void 0:y.role)==="admin",isTeacher:((b=j.user)==null?void 0:b.role)==="teacher"};t(R),P.success("AUTH_CONTEXT","Token verified successfully",{userId:R.id,role:R.role,teacherId:R.teacherId,teacherName:R.teacherName,isAdmin:R.isAdmin,isTeacher:R.isTeacher})}catch(j){if(P.warning("AUTH_CONTEXT","Token verification failed",{error:j.message,isNetworkError:j.message.includes("fetch")||j.message.includes("Backend server not available")}),j.message.includes("fetch")||j.message.includes("Backend server not available")){P.info("AUTH_CONTEXT","Backend not available, skipping token refresh"),en.clearStoredTokens();return}P.info("AUTH_CONTEXT","Attempting token refresh");try{const R=await te.refreshToken(N.refreshToken);en.storeTokens(R.accessToken,R.refreshToken);const D=await te.verifyToken();t(D.user),P.success("AUTH_CONTEXT","Token refreshed successfully",{userId:(v=D.user)==null?void 0:v.id,role:(x=D.user)==null?void 0:x.role,teacherId:(w=D.user)==null?void 0:w.teacher_id,teacherName:(E=D.user)==null?void 0:E.teacher_name,isAdmin:((T=D.user)==null?void 0:T.role)==="admin",isTeacher:((C=D.user)==null?void 0:C.role)==="teacher"})}catch(R){P.error("AUTH_CONTEXT","Token refresh failed, clearing tokens",{error:R.message}),en.clearStoredTokens()}}else P.info("AUTH_CONTEXT","No stored tokens found")}catch(N){P.error("AUTH_CONTEXT","Auth initialization error",{error:N.message}),en.clearStoredTokens()}finally{r(!1),P.info("AUTH_CONTEXT","Auth initialization complete",{isAuthenticated:!!e,loading:!1})}})()},[]);const i=async(u,h)=>{var f,p,m,g,y,b,v,x;P.info("AUTH_CONTEXT","Login attempt initiated",{username:u,hasPassword:!!h,apiService:typeof te,tokenManager:typeof en});try{P.info("AUTH_CONTEXT","Calling apiService.login",{username:u});const w=await te.login(u,h);if(P.info("AUTH_CONTEXT","API login response received",{success:w==null?void 0:w.success,hasAccessToken:!!(w!=null&&w.accessToken),hasRefreshToken:!!(w!=null&&w.refreshToken),hasUser:!!(w!=null&&w.user),userRole:(f=w==null?void 0:w.user)==null?void 0:f.role}),w.success&&w.accessToken&&w.refreshToken){P.info("AUTH_CONTEXT","Storing tokens and setting user",{username:u}),en.storeTokens(w.accessToken,w.refreshToken);const E={id:(p=w.user)==null?void 0:p.id,username:(m=w.user)==null?void 0:m.username,role:(g=w.user)==null?void 0:g.role,teacherId:(y=w.user)==null?void 0:y.teacher_id,teacherName:(b=w.user)==null?void 0:b.teacher_name,isAdmin:((v=w.user)==null?void 0:v.role)==="admin",isTeacher:((x=w.user)==null?void 0:x.role)==="teacher"};return t(E),P.success("AUTH_CONTEXT","Login successful",{username:u,userId:E.id,role:E.role,teacherId:E.teacherId,teacherName:E.teacherName,isAdmin:E.isAdmin,isTeacher:E.isTeacher}),{success:!0}}else return P.warning("AUTH_CONTEXT","API login returned unsuccessful response",{data:w,success:w==null?void 0:w.success,error:w==null?void 0:w.error}),{success:!1,error:(w==null?void 0:w.error)||"Login failed"}}catch(w){return P.error("AUTH_CONTEXT","Login failed with error",{username:u,error:w.message,stack:w.stack}),{success:!1,error:w.message||"Login failed"}}},a=async u=>{try{P.info("AUTH_CONTEXT","Refreshing tokens");const h=await te.refreshToken(u);if(h.success&&h.accessToken&&h.refreshToken){en.storeTokens(h.accessToken,h.refreshToken);const f=await te.verifyToken();return t(f.user),P.success("AUTH_CONTEXT","Tokens refreshed successfully"),!0}else return P.warning("AUTH_CONTEXT","Token refresh failed - invalid response"),!1}catch(h){return P.error("AUTH_CONTEXT","Token refresh failed",{error:h.message}),!1}},l={user:e,login:i,logout:()=>{P.info("AUTH_CONTEXT","Logout initiated",{userId:e==null?void 0:e.id,role:e==null?void 0:e.role}),en.clearStoredTokens(),t(null),P.success("AUTH_CONTEXT","Logout completed")},refreshTokens:a,refreshToken:a,loading:n,isAuthenticated:!!e,isAdmin:(e==null?void 0:e.role)==="admin",isTeacher:(e==null?void 0:e.role)==="teacher"};return c.jsx(fN.Provider,{value:l,children:s})},LI=({children:s})=>{const{refreshTokens:e,logout:t}=Bm(),[n,r]=S.useState(!1);return S.useEffect(()=>{const i=async()=>{const o=en.getStoredTokens();if(!(!o.accessToken||!o.refreshToken)&&(en.isTokenExpired(o.accessToken)||en.shouldRefreshToken(o.accessToken))){if(n)return;try{r(!0),await e(o.refreshToken)||t()}catch(l){console.error("Token refresh error:",l),t()}finally{r(!1)}}};i();const a=setInterval(i,5*60*1e3);return()=>clearInterval(a)},[e,t,n]),S.useEffect(()=>{const i=te.makeRequest;te.makeRequest=async function(a,o={}){try{return await i.call(this,a,o)}catch(l){if(l.status===401){const u=en.getStoredTokens();if(u.refreshToken)try{if(await e(u.refreshToken))return await i.call(this,a,o)}catch(h){console.error("Token refresh failed:",h),t()}}throw l}}},[e,t]),n?c.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),c.jsx("p",{className:"text-neutral-600",children:"Refreshing session..."})]})}):c.jsx(c.Fragment,{children:s})},DI=()=>{const[s,e]=S.useState(!navigator.onLine),[t,n]=S.useState(!1);return S.useEffect(()=>{const r=()=>{e(!1),n(!1)},i=()=>{e(!0),n(!0)};return window.addEventListener("online",r),window.addEventListener("offline",i),navigator.onLine||n(!0),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",i)}},[]),S.useEffect(()=>{const r=i=>{s&&n(!0)};return window.addEventListener("cache:fallback",r),()=>{window.removeEventListener("cache:fallback",r)}},[s]),t?c.jsx("div",{className:"fixed top-4 right-4 z-50",children:c.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2",children:[c.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-pulse"}),c.jsx("span",{className:"text-sm font-medium",children:s?"Offline - Using cached data":"Using cached data"}),c.jsx("button",{onClick:()=>n(!1),className:"text-yellow-600 hover:text-yellow-800 ml-2",children:"×"})]})}):null},pN=S.createContext({transformPagePoint:s=>s,isStatic:!1,reducedMotion:"never"}),tv=S.createContext({}),sv=S.createContext(null),nv=typeof document<"u",d_=nv?S.useLayoutEffect:S.useEffect,mN=S.createContext({strict:!1}),h_=s=>s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),MI="framerAppearId",gN="data-"+h_(MI);function II(s,e,t,n){const{visualElement:r}=S.useContext(tv),i=S.useContext(mN),a=S.useContext(sv),o=S.useContext(pN).reducedMotion,l=S.useRef();n=n||i.renderer,!l.current&&n&&(l.current=n(s,{visualState:e,parent:r,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:o}));const u=l.current;S.useInsertionEffect(()=>{u&&u.update(t,a)});const h=S.useRef(!!(t[gN]&&!window.HandoffComplete));return d_(()=>{u&&(u.render(),h.current&&u.animationState&&u.animationState.animateChanges())}),S.useEffect(()=>{u&&(u.updateFeatures(),!h.current&&u.animationState&&u.animationState.animateChanges(),h.current&&(h.current=!1,window.HandoffComplete=!0))}),u}function Du(s){return s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function OI(s,e,t){return S.useCallback(n=>{n&&s.mount&&s.mount(n),e&&(n?e.mount(n):e.unmount()),t&&(typeof t=="function"?t(n):Du(t)&&(t.current=n))},[e])}function Kf(s){return typeof s=="string"||Array.isArray(s)}function rv(s){return s!==null&&typeof s=="object"&&typeof s.start=="function"}const f_=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],p_=["initial",...f_];function iv(s){return rv(s.animate)||p_.some(e=>Kf(s[e]))}function yN(s){return!!(iv(s)||s.variants)}function FI(s,e){if(iv(s)){const{initial:t,animate:n}=s;return{initial:t===!1||Kf(t)?t:void 0,animate:Kf(n)?n:void 0}}return s.inherit!==!1?e:{}}function $I(s){const{initial:e,animate:t}=FI(s,S.useContext(tv));return S.useMemo(()=>({initial:e,animate:t}),[P1(e),P1(t)])}function P1(s){return Array.isArray(s)?s.join(" "):s}const R1={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Xf={};for(const s in R1)Xf[s]={isEnabled:e=>R1[s].some(t=>!!e[t])};function UI(s){for(const e in s)Xf[e]={...Xf[e],...s[e]}}const m_=S.createContext({}),vN=S.createContext({}),BI=Symbol.for("motionComponentSymbol");function HI({preloadedFeatures:s,createVisualElement:e,useRender:t,useVisualState:n,Component:r}){s&&UI(s);function i(o,l){let u;const h={...S.useContext(pN),...o,layoutId:VI(o)},{isStatic:f}=h,p=$I(o),m=n(o,f);if(!f&&nv){p.visualElement=II(r,m,h,e);const g=S.useContext(vN),y=S.useContext(mN).strict;p.visualElement&&(u=p.visualElement.loadFeatures(h,y,s,g))}return S.createElement(tv.Provider,{value:p},u&&p.visualElement?S.createElement(u,{visualElement:p.visualElement,...h}):null,t(r,o,OI(m,p.visualElement,l),m,f,p.visualElement))}const a=S.forwardRef(i);return a[BI]=r,a}function VI({layoutId:s}){const e=S.useContext(m_).id;return e&&s!==void 0?e+"-"+s:s}function zI(s){function e(n,r={}){return HI(s(n,r))}if(typeof Proxy>"u")return e;const t=new Map;return new Proxy(e,{get:(n,r)=>(t.has(r)||t.set(r,e(r)),t.get(r))})}const WI=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function g_(s){return typeof s!="string"||s.includes("-")?!1:!!(WI.indexOf(s)>-1||/[A-Z]/.test(s))}const Z0={};function GI(s){Object.assign(Z0,s)}const Hm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],eu=new Set(Hm);function xN(s,{layout:e,layoutId:t}){return eu.has(s)||s.startsWith("origin")||(e||t!==void 0)&&(!!Z0[s]||s==="opacity")}const En=s=>!!(s&&s.getVelocity),qI={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},KI=Hm.length;function XI(s,{enableHardwareAcceleration:e=!0,allowTransformNone:t=!0},n,r){let i="";for(let a=0;a<KI;a++){const o=Hm[a];if(s[o]!==void 0){const l=qI[o]||o;i+=`${l}(${s[o]}) `}}return e&&!s.z&&(i+="translateZ(0)"),i=i.trim(),r?i=r(s,n?"":i):t&&n&&(i="none"),i}const wN=s=>e=>typeof e=="string"&&e.startsWith(s),bN=wN("--"),jw=wN("var(--"),YI=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,JI=(s,e)=>e&&typeof s=="number"?e.transform(s):s,Qo=(s,e,t)=>Math.min(Math.max(t,s),e),tu={test:s=>typeof s=="number",parse:parseFloat,transform:s=>s},bf={...tu,transform:s=>Qo(0,1,s)},Eg={...tu,default:1},Sf=s=>Math.round(s*1e5)/1e5,av=/(-)?([\d]*\.?[\d])+/g,SN=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,QI=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Vm(s){return typeof s=="string"}const zm=s=>({test:e=>Vm(e)&&e.endsWith(s)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${s}`}),Wa=zm("deg"),Li=zm("%"),Te=zm("px"),ZI=zm("vh"),eO=zm("vw"),L1={...Li,parse:s=>Li.parse(s)/100,transform:s=>Li.transform(s*100)},D1={...tu,transform:Math.round},_N={borderWidth:Te,borderTopWidth:Te,borderRightWidth:Te,borderBottomWidth:Te,borderLeftWidth:Te,borderRadius:Te,radius:Te,borderTopLeftRadius:Te,borderTopRightRadius:Te,borderBottomRightRadius:Te,borderBottomLeftRadius:Te,width:Te,maxWidth:Te,height:Te,maxHeight:Te,size:Te,top:Te,right:Te,bottom:Te,left:Te,padding:Te,paddingTop:Te,paddingRight:Te,paddingBottom:Te,paddingLeft:Te,margin:Te,marginTop:Te,marginRight:Te,marginBottom:Te,marginLeft:Te,rotate:Wa,rotateX:Wa,rotateY:Wa,rotateZ:Wa,scale:Eg,scaleX:Eg,scaleY:Eg,scaleZ:Eg,skew:Wa,skewX:Wa,skewY:Wa,distance:Te,translateX:Te,translateY:Te,translateZ:Te,x:Te,y:Te,z:Te,perspective:Te,transformPerspective:Te,opacity:bf,originX:L1,originY:L1,originZ:Te,zIndex:D1,fillOpacity:bf,strokeOpacity:bf,numOctaves:D1};function y_(s,e,t,n){const{style:r,vars:i,transform:a,transformOrigin:o}=s;let l=!1,u=!1,h=!0;for(const f in e){const p=e[f];if(bN(f)){i[f]=p;continue}const m=_N[f],g=JI(p,m);if(eu.has(f)){if(l=!0,a[f]=g,!h)continue;p!==(m.default||0)&&(h=!1)}else f.startsWith("origin")?(u=!0,o[f]=g):r[f]=g}if(e.transform||(l||n?r.transform=XI(s.transform,t,h,n):r.transform&&(r.transform="none")),u){const{originX:f="50%",originY:p="50%",originZ:m=0}=o;r.transformOrigin=`${f} ${p} ${m}`}}const v_=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function EN(s,e,t){for(const n in e)!En(e[n])&&!xN(n,t)&&(s[n]=e[n])}function tO({transformTemplate:s},e,t){return S.useMemo(()=>{const n=v_();return y_(n,e,{enableHardwareAcceleration:!t},s),Object.assign({},n.vars,n.style)},[e])}function sO(s,e,t){const n=s.style||{},r={};return EN(r,n,s),Object.assign(r,tO(s,e,t)),s.transformValues?s.transformValues(r):r}function nO(s,e,t){const n={},r=sO(s,e,t);return s.drag&&s.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=s.drag===!0?"none":`pan-${s.drag==="x"?"y":"x"}`),s.tabIndex===void 0&&(s.onTap||s.onTapStart||s.whileTap)&&(n.tabIndex=0),n.style=r,n}const rO=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ey(s){return s.startsWith("while")||s.startsWith("drag")&&s!=="draggable"||s.startsWith("layout")||s.startsWith("onTap")||s.startsWith("onPan")||s.startsWith("onLayout")||rO.has(s)}let AN=s=>!ey(s);function iO(s){s&&(AN=e=>e.startsWith("on")?!ey(e):s(e))}try{iO(require("@emotion/is-prop-valid").default)}catch{}function aO(s,e,t){const n={};for(const r in s)r==="values"&&typeof s.values=="object"||(AN(r)||t===!0&&ey(r)||!e&&!ey(r)||s.draggable&&r.startsWith("onDrag"))&&(n[r]=s[r]);return n}function M1(s,e,t){return typeof s=="string"?s:Te.transform(e+t*s)}function oO(s,e,t){const n=M1(e,s.x,s.width),r=M1(t,s.y,s.height);return`${n} ${r}`}const lO={offset:"stroke-dashoffset",array:"stroke-dasharray"},cO={offset:"strokeDashoffset",array:"strokeDasharray"};function uO(s,e,t=1,n=0,r=!0){s.pathLength=1;const i=r?lO:cO;s[i.offset]=Te.transform(-n);const a=Te.transform(e),o=Te.transform(t);s[i.array]=`${a} ${o}`}function x_(s,{attrX:e,attrY:t,attrScale:n,originX:r,originY:i,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...u},h,f,p){if(y_(s,u,h,p),f){s.style.viewBox&&(s.attrs.viewBox=s.style.viewBox);return}s.attrs=s.style,s.style={};const{attrs:m,style:g,dimensions:y}=s;m.transform&&(y&&(g.transform=m.transform),delete m.transform),y&&(r!==void 0||i!==void 0||g.transform)&&(g.transformOrigin=oO(y,r!==void 0?r:.5,i!==void 0?i:.5)),e!==void 0&&(m.x=e),t!==void 0&&(m.y=t),n!==void 0&&(m.scale=n),a!==void 0&&uO(m,a,o,l,!1)}const kN=()=>({...v_(),attrs:{}}),w_=s=>typeof s=="string"&&s.toLowerCase()==="svg";function dO(s,e,t,n){const r=S.useMemo(()=>{const i=kN();return x_(i,e,{enableHardwareAcceleration:!1},w_(n),s.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(s.style){const i={};EN(i,s.style,s),r.style={...i,...r.style}}return r}function hO(s=!1){return(t,n,r,{latestValues:i},a)=>{const l=(g_(t)?dO:nO)(n,i,a,t),h={...aO(n,typeof t=="string",s),...l,ref:r},{children:f}=n,p=S.useMemo(()=>En(f)?f.get():f,[f]);return S.createElement(t,{...h,children:p})}}function TN(s,{style:e,vars:t},n,r){Object.assign(s.style,e,r&&r.getProjectionStyles(n));for(const i in t)s.style.setProperty(i,t[i])}const CN=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function NN(s,e,t,n){TN(s,e,void 0,n);for(const r in e.attrs)s.setAttribute(CN.has(r)?r:h_(r),e.attrs[r])}function b_(s,e){const{style:t}=s,n={};for(const r in t)(En(t[r])||e.style&&En(e.style[r])||xN(r,s))&&(n[r]=t[r]);return n}function jN(s,e){const t=b_(s,e);for(const n in s)if(En(s[n])||En(e[n])){const r=Hm.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;t[r]=s[n]}return t}function S_(s,e,t,n={},r={}){return typeof e=="function"&&(e=e(t!==void 0?t:s.custom,n,r)),typeof e=="string"&&(e=s.variants&&s.variants[e]),typeof e=="function"&&(e=e(t!==void 0?t:s.custom,n,r)),e}function PN(s){const e=S.useRef(null);return e.current===null&&(e.current=s()),e.current}const ty=s=>Array.isArray(s),fO=s=>!!(s&&typeof s=="object"&&s.mix&&s.toValue),pO=s=>ty(s)?s[s.length-1]||0:s;function Yg(s){const e=En(s)?s.get():s;return fO(e)?e.toValue():e}function mO({scrapeMotionValuesFromProps:s,createRenderState:e,onMount:t},n,r,i){const a={latestValues:gO(n,r,i,s),renderState:e()};return t&&(a.mount=o=>t(n,o,a)),a}const RN=s=>(e,t)=>{const n=S.useContext(tv),r=S.useContext(sv),i=()=>mO(s,e,n,r);return t?i():PN(i)};function gO(s,e,t,n){const r={},i=n(s,{});for(const p in i)r[p]=Yg(i[p]);let{initial:a,animate:o}=s;const l=iv(s),u=yN(s);e&&u&&!l&&s.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let h=t?t.initial===!1:!1;h=h||a===!1;const f=h?o:a;return f&&typeof f!="boolean"&&!rv(f)&&(Array.isArray(f)?f:[f]).forEach(m=>{const g=S_(s,m);if(!g)return;const{transitionEnd:y,transition:b,...v}=g;for(const x in v){let w=v[x];if(Array.isArray(w)){const E=h?w.length-1:0;w=w[E]}w!==null&&(r[x]=w)}for(const x in y)r[x]=y[x]}),r}const zt=s=>s;class I1{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function yO(s){let e=new I1,t=new I1,n=0,r=!1,i=!1;const a=new WeakSet,o={schedule:(l,u=!1,h=!1)=>{const f=h&&r,p=f?e:t;return u&&a.add(l),p.add(l)&&f&&r&&(n=e.order.length),l},cancel:l=>{t.remove(l),a.delete(l)},process:l=>{if(r){i=!0;return}if(r=!0,[e,t]=[t,e],t.clear(),n=e.order.length,n)for(let u=0;u<n;u++){const h=e.order[u];h(l),a.has(h)&&(o.schedule(h),s())}r=!1,i&&(i=!1,o.process(l))}};return o}const Ag=["prepare","read","update","preRender","render","postRender"],vO=40;function xO(s,e){let t=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=Ag.reduce((f,p)=>(f[p]=yO(()=>t=!0),f),{}),a=f=>i[f].process(r),o=()=>{const f=performance.now();t=!1,r.delta=n?1e3/60:Math.max(Math.min(f-r.timestamp,vO),1),r.timestamp=f,r.isProcessing=!0,Ag.forEach(a),r.isProcessing=!1,t&&e&&(n=!1,s(o))},l=()=>{t=!0,n=!0,r.isProcessing||s(o)};return{schedule:Ag.reduce((f,p)=>{const m=i[p];return f[p]=(g,y=!1,b=!1)=>(t||l(),m.schedule(g,y,b)),f},{}),cancel:f=>Ag.forEach(p=>i[p].cancel(f)),state:r,steps:i}}const{schedule:vt,cancel:Ma,state:$s,steps:nx}=xO(typeof requestAnimationFrame<"u"?requestAnimationFrame:zt,!0),wO={useVisualState:RN({scrapeMotionValuesFromProps:jN,createRenderState:kN,onMount:(s,e,{renderState:t,latestValues:n})=>{vt.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),vt.render(()=>{x_(t,n,{enableHardwareAcceleration:!1},w_(e.tagName),s.transformTemplate),NN(e,t)})}})},bO={useVisualState:RN({scrapeMotionValuesFromProps:b_,createRenderState:v_})};function SO(s,{forwardMotionProps:e=!1},t,n){return{...g_(s)?wO:bO,preloadedFeatures:t,useRender:hO(e),createVisualElement:n,Component:s}}function Ea(s,e,t,n={passive:!0}){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t)}const LN=s=>s.pointerType==="mouse"?typeof s.button!="number"||s.button<=0:s.isPrimary!==!1;function ov(s,e="page"){return{point:{x:s[e+"X"],y:s[e+"Y"]}}}const _O=s=>e=>LN(e)&&s(e,ov(e));function ka(s,e,t,n){return Ea(s,e,_O(t),n)}const EO=(s,e)=>t=>e(s(t)),Xo=(...s)=>s.reduce(EO);function DN(s){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=s,t):!1}}const O1=DN("dragHorizontal"),F1=DN("dragVertical");function MN(s){let e=!1;if(s==="y")e=F1();else if(s==="x")e=O1();else{const t=O1(),n=F1();t&&n?e=()=>{t(),n()}:(t&&t(),n&&n())}return e}function IN(){const s=MN(!0);return s?(s(),!1):!0}class ll{constructor(e){this.isMounted=!1,this.node=e}update(){}}function $1(s,e){const t="pointer"+(e?"enter":"leave"),n="onHover"+(e?"Start":"End"),r=(i,a)=>{if(i.pointerType==="touch"||IN())return;const o=s.getProps();s.animationState&&o.whileHover&&s.animationState.setActive("whileHover",e),o[n]&&vt.update(()=>o[n](i,a))};return ka(s.current,t,r,{passive:!s.getProps()[n]})}class AO extends ll{mount(){this.unmount=Xo($1(this.node,!0),$1(this.node,!1))}unmount(){}}class kO extends ll{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Xo(Ea(this.node.current,"focus",()=>this.onFocus()),Ea(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const ON=(s,e)=>e?s===e?!0:ON(s,e.parentElement):!1;function rx(s,e){if(!e)return;const t=new PointerEvent("pointer"+s);e(t,ov(t))}class TO extends ll{constructor(){super(...arguments),this.removeStartListeners=zt,this.removeEndListeners=zt,this.removeAccessibleListeners=zt,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),i=ka(window,"pointerup",(o,l)=>{if(!this.checkPressEnd())return;const{onTap:u,onTapCancel:h,globalTapTarget:f}=this.node.getProps();vt.update(()=>{!f&&!ON(this.node.current,o.target)?h&&h(o,l):u&&u(o,l)})},{passive:!(n.onTap||n.onPointerUp)}),a=ka(window,"pointercancel",(o,l)=>this.cancelPress(o,l),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Xo(i,a),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const a=o=>{o.key!=="Enter"||!this.checkPressEnd()||rx("up",(l,u)=>{const{onTap:h}=this.node.getProps();h&&vt.update(()=>h(l,u))})};this.removeEndListeners(),this.removeEndListeners=Ea(this.node.current,"keyup",a),rx("down",(o,l)=>{this.startPress(o,l)})},t=Ea(this.node.current,"keydown",e),n=()=>{this.isPressing&&rx("cancel",(i,a)=>this.cancelPress(i,a))},r=Ea(this.node.current,"blur",n);this.removeAccessibleListeners=Xo(t,r)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&vt.update(()=>n(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!IN()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&vt.update(()=>n(e,t))}mount(){const e=this.node.getProps(),t=ka(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=Ea(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Xo(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Pw=new WeakMap,ix=new WeakMap,CO=s=>{const e=Pw.get(s.target);e&&e(s)},NO=s=>{s.forEach(CO)};function jO({root:s,...e}){const t=s||document;ix.has(t)||ix.set(t,{});const n=ix.get(t),r=JSON.stringify(e);return n[r]||(n[r]=new IntersectionObserver(NO,{root:s,...e})),n[r]}function PO(s,e,t){const n=jO(e);return Pw.set(s,t),n.observe(s),()=>{Pw.delete(s),n.unobserve(s)}}const RO={some:0,all:1};class LO extends ll{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:i}=e,a={root:t?t.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:RO[r]},o=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),p=u?h:f;p&&p(l)};return PO(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(DO(e,t))&&this.startObserver()}unmount(){}}function DO({viewport:s={}},{viewport:e={}}={}){return t=>s[t]!==e[t]}const MO={inView:{Feature:LO},tap:{Feature:TO},focus:{Feature:kO},hover:{Feature:AO}};function FN(s,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==s.length)return!1;for(let n=0;n<t;n++)if(e[n]!==s[n])return!1;return!0}function IO(s){const e={};return s.values.forEach((t,n)=>e[n]=t.get()),e}function OO(s){const e={};return s.values.forEach((t,n)=>e[n]=t.getVelocity()),e}function lv(s,e,t){const n=s.getProps();return S_(n,e,t!==void 0?t:n.custom,IO(s),OO(s))}let __=zt;const Hc=s=>s*1e3,Ta=s=>s/1e3,FO={current:!1},$N=s=>Array.isArray(s)&&typeof s[0]=="number";function UN(s){return!!(!s||typeof s=="string"&&BN[s]||$N(s)||Array.isArray(s)&&s.every(UN))}const zh=([s,e,t,n])=>`cubic-bezier(${s}, ${e}, ${t}, ${n})`,BN={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:zh([0,.65,.55,1]),circOut:zh([.55,0,1,.45]),backIn:zh([.31,.01,.66,-.59]),backOut:zh([.33,1.53,.69,.99])};function HN(s){if(s)return $N(s)?zh(s):Array.isArray(s)?s.map(HN):BN[s]}function $O(s,e,t,{delay:n=0,duration:r,repeat:i=0,repeatType:a="loop",ease:o,times:l}={}){const u={[e]:t};l&&(u.offset=l);const h=HN(o);return Array.isArray(h)&&(u.easing=h),s.animate(u,{delay:n,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:i+1,direction:a==="reverse"?"alternate":"normal"})}function UO(s,{repeat:e,repeatType:t="loop"}){const n=e&&t!=="loop"&&e%2===1?0:s.length-1;return s[n]}const VN=(s,e,t)=>(((1-3*t+3*e)*s+(3*t-6*e))*s+3*e)*s,BO=1e-7,HO=12;function VO(s,e,t,n,r){let i,a,o=0;do a=e+(t-e)/2,i=VN(a,n,r)-s,i>0?t=a:e=a;while(Math.abs(i)>BO&&++o<HO);return a}function Wm(s,e,t,n){if(s===e&&t===n)return zt;const r=i=>VO(i,0,1,s,t);return i=>i===0||i===1?i:VN(r(i),e,n)}const zO=Wm(.42,0,1,1),WO=Wm(0,0,.58,1),zN=Wm(.42,0,.58,1),GO=s=>Array.isArray(s)&&typeof s[0]!="number",WN=s=>e=>e<=.5?s(2*e)/2:(2-s(2*(1-e)))/2,GN=s=>e=>1-s(1-e),E_=s=>1-Math.sin(Math.acos(s)),qN=GN(E_),qO=WN(E_),KN=Wm(.33,1.53,.69,.99),A_=GN(KN),KO=WN(A_),XO=s=>(s*=2)<1?.5*A_(s):.5*(2-Math.pow(2,-10*(s-1))),YO={linear:zt,easeIn:zO,easeInOut:zN,easeOut:WO,circIn:E_,circInOut:qO,circOut:qN,backIn:A_,backInOut:KO,backOut:KN,anticipate:XO},U1=s=>{if(Array.isArray(s)){__(s.length===4);const[e,t,n,r]=s;return Wm(e,t,n,r)}else if(typeof s=="string")return YO[s];return s},k_=(s,e)=>t=>!!(Vm(t)&&QI.test(t)&&t.startsWith(s)||e&&Object.prototype.hasOwnProperty.call(t,e)),XN=(s,e,t)=>n=>{if(!Vm(n))return n;const[r,i,a,o]=n.match(av);return{[s]:parseFloat(r),[e]:parseFloat(i),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},JO=s=>Qo(0,255,s),ax={...tu,transform:s=>Math.round(JO(s))},jl={test:k_("rgb","red"),parse:XN("red","green","blue"),transform:({red:s,green:e,blue:t,alpha:n=1})=>"rgba("+ax.transform(s)+", "+ax.transform(e)+", "+ax.transform(t)+", "+Sf(bf.transform(n))+")"};function QO(s){let e="",t="",n="",r="";return s.length>5?(e=s.substring(1,3),t=s.substring(3,5),n=s.substring(5,7),r=s.substring(7,9)):(e=s.substring(1,2),t=s.substring(2,3),n=s.substring(3,4),r=s.substring(4,5),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const Rw={test:k_("#"),parse:QO,transform:jl.transform},Mu={test:k_("hsl","hue"),parse:XN("hue","saturation","lightness"),transform:({hue:s,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(s)+", "+Li.transform(Sf(e))+", "+Li.transform(Sf(t))+", "+Sf(bf.transform(n))+")"},Js={test:s=>jl.test(s)||Rw.test(s)||Mu.test(s),parse:s=>jl.test(s)?jl.parse(s):Mu.test(s)?Mu.parse(s):Rw.parse(s),transform:s=>Vm(s)?s:s.hasOwnProperty("red")?jl.transform(s):Mu.transform(s)},jt=(s,e,t)=>-t*s+t*e+s;function ox(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*(2/3-t)*6:s}function ZO({hue:s,saturation:e,lightness:t,alpha:n}){s/=360,e/=100,t/=100;let r=0,i=0,a=0;if(!e)r=i=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;r=ox(l,o,s+1/3),i=ox(l,o,s),a=ox(l,o,s-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(a*255),alpha:n}}const lx=(s,e,t)=>{const n=s*s;return Math.sqrt(Math.max(0,t*(e*e-n)+n))},eF=[Rw,jl,Mu],tF=s=>eF.find(e=>e.test(s));function B1(s){const e=tF(s);let t=e.parse(s);return e===Mu&&(t=ZO(t)),t}const YN=(s,e)=>{const t=B1(s),n=B1(e),r={...t};return i=>(r.red=lx(t.red,n.red,i),r.green=lx(t.green,n.green,i),r.blue=lx(t.blue,n.blue,i),r.alpha=jt(t.alpha,n.alpha,i),jl.transform(r))};function sF(s){var e,t;return isNaN(s)&&Vm(s)&&(((e=s.match(av))===null||e===void 0?void 0:e.length)||0)+(((t=s.match(SN))===null||t===void 0?void 0:t.length)||0)>0}const JN={regex:YI,countKey:"Vars",token:"${v}",parse:zt},QN={regex:SN,countKey:"Colors",token:"${c}",parse:Js.parse},ZN={regex:av,countKey:"Numbers",token:"${n}",parse:tu.parse};function cx(s,{regex:e,countKey:t,token:n,parse:r}){const i=s.tokenised.match(e);i&&(s["num"+t]=i.length,s.tokenised=s.tokenised.replace(e,n),s.values.push(...i.map(r)))}function sy(s){const e=s.toString(),t={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return t.value.includes("var(--")&&cx(t,JN),cx(t,QN),cx(t,ZN),t}function e2(s){return sy(s).values}function t2(s){const{values:e,numColors:t,numVars:n,tokenised:r}=sy(s),i=e.length;return a=>{let o=r;for(let l=0;l<i;l++)l<n?o=o.replace(JN.token,a[l]):l<n+t?o=o.replace(QN.token,Js.transform(a[l])):o=o.replace(ZN.token,Sf(a[l]));return o}}const nF=s=>typeof s=="number"?0:s;function rF(s){const e=e2(s);return t2(s)(e.map(nF))}const Zo={test:sF,parse:e2,createTransformer:t2,getAnimatableNone:rF},s2=(s,e)=>t=>`${t>0?e:s}`;function n2(s,e){return typeof s=="number"?t=>jt(s,e,t):Js.test(s)?YN(s,e):s.startsWith("var(")?s2(s,e):i2(s,e)}const r2=(s,e)=>{const t=[...s],n=t.length,r=s.map((i,a)=>n2(i,e[a]));return i=>{for(let a=0;a<n;a++)t[a]=r[a](i);return t}},iF=(s,e)=>{const t={...s,...e},n={};for(const r in t)s[r]!==void 0&&e[r]!==void 0&&(n[r]=n2(s[r],e[r]));return r=>{for(const i in n)t[i]=n[i](r);return t}},i2=(s,e)=>{const t=Zo.createTransformer(e),n=sy(s),r=sy(e);return n.numVars===r.numVars&&n.numColors===r.numColors&&n.numNumbers>=r.numNumbers?Xo(r2(n.values,r.values),t):s2(s,e)},Yf=(s,e,t)=>{const n=e-s;return n===0?1:(t-s)/n},H1=(s,e)=>t=>jt(s,e,t);function aF(s){return typeof s=="number"?H1:typeof s=="string"?Js.test(s)?YN:i2:Array.isArray(s)?r2:typeof s=="object"?iF:H1}function oF(s,e,t){const n=[],r=t||aF(s[0]),i=s.length-1;for(let a=0;a<i;a++){let o=r(s[a],s[a+1]);if(e){const l=Array.isArray(e)?e[a]||zt:e;o=Xo(l,o)}n.push(o)}return n}function a2(s,e,{clamp:t=!0,ease:n,mixer:r}={}){const i=s.length;if(__(i===e.length),i===1)return()=>e[0];s[0]>s[i-1]&&(s=[...s].reverse(),e=[...e].reverse());const a=oF(e,n,r),o=a.length,l=u=>{let h=0;if(o>1)for(;h<s.length-2&&!(u<s[h+1]);h++);const f=Yf(s[h],s[h+1],u);return a[h](f)};return t?u=>l(Qo(s[0],s[i-1],u)):l}function lF(s,e){const t=s[s.length-1];for(let n=1;n<=e;n++){const r=Yf(0,e,n);s.push(jt(t,1,r))}}function cF(s){const e=[0];return lF(e,s.length-1),e}function uF(s,e){return s.map(t=>t*e)}function dF(s,e){return s.map(()=>e||zN).splice(0,s.length-1)}function ny({duration:s=300,keyframes:e,times:t,ease:n="easeInOut"}){const r=GO(n)?n.map(U1):U1(n),i={done:!1,value:e[0]},a=uF(t&&t.length===e.length?t:cF(e),s),o=a2(a,e,{ease:Array.isArray(r)?r:dF(e,r)});return{calculatedDuration:s,next:l=>(i.value=o(l),i.done=l>=s,i)}}function o2(s,e){return e?s*(1e3/e):0}const hF=5;function l2(s,e,t){const n=Math.max(e-hF,0);return o2(t-s(n),e-n)}const ux=.001,fF=.01,pF=10,mF=.05,gF=1;function yF({duration:s=800,bounce:e=.25,velocity:t=0,mass:n=1}){let r,i,a=1-e;a=Qo(mF,gF,a),s=Qo(fF,pF,Ta(s)),a<1?(r=u=>{const h=u*a,f=h*s,p=h-t,m=Lw(u,a),g=Math.exp(-f);return ux-p/m*g},i=u=>{const f=u*a*s,p=f*t+t,m=Math.pow(a,2)*Math.pow(u,2)*s,g=Math.exp(-f),y=Lw(Math.pow(u,2),a);return(-r(u)+ux>0?-1:1)*((p-m)*g)/y}):(r=u=>{const h=Math.exp(-u*s),f=(u-t)*s+1;return-ux+h*f},i=u=>{const h=Math.exp(-u*s),f=(t-u)*(s*s);return h*f});const o=5/s,l=xF(r,i,o);if(s=Hc(s),isNaN(l))return{stiffness:100,damping:10,duration:s};{const u=Math.pow(l,2)*n;return{stiffness:u,damping:a*2*Math.sqrt(n*u),duration:s}}}const vF=12;function xF(s,e,t){let n=t;for(let r=1;r<vF;r++)n=n-s(n)/e(n);return n}function Lw(s,e){return s*Math.sqrt(1-e*e)}const wF=["duration","bounce"],bF=["stiffness","damping","mass"];function V1(s,e){return e.some(t=>s[t]!==void 0)}function SF(s){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...s};if(!V1(s,bF)&&V1(s,wF)){const t=yF(s);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function c2({keyframes:s,restDelta:e,restSpeed:t,...n}){const r=s[0],i=s[s.length-1],a={done:!1,value:r},{stiffness:o,damping:l,mass:u,duration:h,velocity:f,isResolvedFromDuration:p}=SF({...n,velocity:-Ta(n.velocity||0)}),m=f||0,g=l/(2*Math.sqrt(o*u)),y=i-r,b=Ta(Math.sqrt(o/u)),v=Math.abs(y)<5;t||(t=v?.01:2),e||(e=v?.005:.5);let x;if(g<1){const w=Lw(b,g);x=E=>{const T=Math.exp(-g*b*E);return i-T*((m+g*b*y)/w*Math.sin(w*E)+y*Math.cos(w*E))}}else if(g===1)x=w=>i-Math.exp(-b*w)*(y+(m+b*y)*w);else{const w=b*Math.sqrt(g*g-1);x=E=>{const T=Math.exp(-g*b*E),C=Math.min(w*E,300);return i-T*((m+g*b*y)*Math.sinh(C)+w*y*Math.cosh(C))/w}}return{calculatedDuration:p&&h||null,next:w=>{const E=x(w);if(p)a.done=w>=h;else{let T=m;w!==0&&(g<1?T=l2(x,w,E):T=0);const C=Math.abs(T)<=t,N=Math.abs(i-E)<=e;a.done=C&&N}return a.value=a.done?i:E,a}}}function z1({keyframes:s,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:a,min:o,max:l,restDelta:u=.5,restSpeed:h}){const f=s[0],p={done:!1,value:f},m=j=>o!==void 0&&j<o||l!==void 0&&j>l,g=j=>o===void 0?l:l===void 0||Math.abs(o-j)<Math.abs(l-j)?o:l;let y=t*e;const b=f+y,v=a===void 0?b:a(b);v!==b&&(y=v-f);const x=j=>-y*Math.exp(-j/n),w=j=>v+x(j),E=j=>{const R=x(j),D=w(j);p.done=Math.abs(R)<=u,p.value=p.done?v:D};let T,C;const N=j=>{m(p.value)&&(T=j,C=c2({keyframes:[p.value,g(p.value)],velocity:l2(w,j,p.value),damping:r,stiffness:i,restDelta:u,restSpeed:h}))};return N(0),{calculatedDuration:null,next:j=>{let R=!1;return!C&&T===void 0&&(R=!0,E(j),N(j)),T!==void 0&&j>T?C.next(j-T):(!R&&E(j),p)}}}const _F=s=>{const e=({timestamp:t})=>s(t);return{start:()=>vt.update(e,!0),stop:()=>Ma(e),now:()=>$s.isProcessing?$s.timestamp:performance.now()}},W1=2e4;function G1(s){let e=0;const t=50;let n=s.next(e);for(;!n.done&&e<W1;)e+=t,n=s.next(e);return e>=W1?1/0:e}const EF={decay:z1,inertia:z1,tween:ny,keyframes:ny,spring:c2};function ry({autoplay:s=!0,delay:e=0,driver:t=_F,keyframes:n,type:r="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:o="loop",onPlay:l,onStop:u,onComplete:h,onUpdate:f,...p}){let m=1,g=!1,y,b;const v=()=>{b=new Promise(J=>{y=J})};v();let x;const w=EF[r]||ny;let E;w!==ny&&typeof n[0]!="number"&&(E=a2([0,100],n,{clamp:!1}),n=[0,100]);const T=w({...p,keyframes:n});let C;o==="mirror"&&(C=w({...p,keyframes:[...n].reverse(),velocity:-(p.velocity||0)}));let N="idle",j=null,R=null,D=null;T.calculatedDuration===null&&i&&(T.calculatedDuration=G1(T));const{calculatedDuration:z}=T;let L=1/0,I=1/0;z!==null&&(L=z+a,I=L*(i+1)-a);let O=0;const Y=J=>{if(R===null)return;m>0&&(R=Math.min(R,J)),m<0&&(R=Math.min(J-I/m,R)),j!==null?O=j:O=Math.round(J-R)*m;const Z=O-e*(m>=0?1:-1),pe=m>=0?Z<0:Z>I;O=Math.max(Z,0),N==="finished"&&j===null&&(O=I);let Se=O,Pe=T;if(i){const Re=Math.min(O,I)/L;let Ee=Math.floor(Re),q=Re%1;!q&&Re>=1&&(q=1),q===1&&Ee--,Ee=Math.min(Ee,i+1),!!(Ee%2)&&(o==="reverse"?(q=1-q,a&&(q-=a/L)):o==="mirror"&&(Pe=C)),Se=Qo(0,1,q)*L}const H=pe?{done:!1,value:n[0]}:Pe.next(Se);E&&(H.value=E(H.value));let{done:X}=H;!pe&&z!==null&&(X=m>=0?O>=I:O<=0);const we=j===null&&(N==="finished"||N==="running"&&X);return f&&f(H.value),we&&M(),H},F=()=>{x&&x.stop(),x=void 0},B=()=>{N="idle",F(),y(),v(),R=D=null},M=()=>{N="finished",h&&h(),F(),y()},$=()=>{if(g)return;x||(x=t(Y));const J=x.now();l&&l(),j!==null?R=J-j:(!R||N==="finished")&&(R=J),N==="finished"&&v(),D=R,j=null,N="running",x.start()};s&&$();const K={then(J,Z){return b.then(J,Z)},get time(){return Ta(O)},set time(J){J=Hc(J),O=J,j!==null||!x||m===0?j=J:R=x.now()-J/m},get duration(){const J=T.calculatedDuration===null?G1(T):T.calculatedDuration;return Ta(J)},get speed(){return m},set speed(J){J===m||!x||(m=J,K.time=Ta(O))},get state(){return N},play:$,pause:()=>{N="paused",j=O},stop:()=>{g=!0,N!=="idle"&&(N="idle",u&&u(),B())},cancel:()=>{D!==null&&Y(D),B()},complete:()=>{N="finished"},sample:J=>(R=0,Y(J))};return K}function AF(s){let e;return()=>(e===void 0&&(e=s()),e)}const kF=AF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),TF=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),kg=10,CF=2e4,NF=(s,e)=>e.type==="spring"||s==="backgroundColor"||!UN(e.ease);function jF(s,e,{onUpdate:t,onComplete:n,...r}){if(!(kF()&&TF.has(e)&&!r.repeatDelay&&r.repeatType!=="mirror"&&r.damping!==0&&r.type!=="inertia"))return!1;let a=!1,o,l,u=!1;const h=()=>{l=new Promise(w=>{o=w})};h();let{keyframes:f,duration:p=300,ease:m,times:g}=r;if(NF(e,r)){const w=ry({...r,repeat:0,delay:0});let E={done:!1,value:f[0]};const T=[];let C=0;for(;!E.done&&C<CF;)E=w.sample(C),T.push(E.value),C+=kg;g=void 0,f=T,p=C-kg,m="linear"}const y=$O(s.owner.current,e,f,{...r,duration:p,ease:m,times:g}),b=()=>{u=!1,y.cancel()},v=()=>{u=!0,vt.update(b),o(),h()};return y.onfinish=()=>{u||(s.set(UO(f,r)),n&&n(),v())},{then(w,E){return l.then(w,E)},attachTimeline(w){return y.timeline=w,y.onfinish=null,zt},get time(){return Ta(y.currentTime||0)},set time(w){y.currentTime=Hc(w)},get speed(){return y.playbackRate},set speed(w){y.playbackRate=w},get duration(){return Ta(p)},play:()=>{a||(y.play(),Ma(b))},pause:()=>y.pause(),stop:()=>{if(a=!0,y.playState==="idle")return;const{currentTime:w}=y;if(w){const E=ry({...r,autoplay:!1});s.setWithVelocity(E.sample(w-kg).value,E.sample(w).value,kg)}v()},complete:()=>{u||y.finish()},cancel:v}}function PF({keyframes:s,delay:e,onUpdate:t,onComplete:n}){const r=()=>(t&&t(s[s.length-1]),n&&n(),{time:0,speed:1,duration:0,play:zt,pause:zt,stop:zt,then:i=>(i(),Promise.resolve()),cancel:zt,complete:zt});return e?ry({keyframes:[0,1],duration:0,delay:e,onComplete:r}):r()}const RF={type:"spring",stiffness:500,damping:25,restSpeed:10},LF=s=>({type:"spring",stiffness:550,damping:s===0?2*Math.sqrt(550):30,restSpeed:10}),DF={type:"keyframes",duration:.8},MF={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},IF=(s,{keyframes:e})=>e.length>2?DF:eu.has(s)?s.startsWith("scale")?LF(e[1]):RF:MF,Dw=(s,e)=>s==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Zo.test(e)||e==="0")&&!e.startsWith("url(")),OF=new Set(["brightness","contrast","saturate","opacity"]);function FF(s){const[e,t]=s.slice(0,-1).split("(");if(e==="drop-shadow")return s;const[n]=t.match(av)||[];if(!n)return s;const r=t.replace(n,"");let i=OF.has(e)?1:0;return n!==t&&(i*=100),e+"("+i+r+")"}const $F=/([a-z-]*)\(.*?\)/g,Mw={...Zo,getAnimatableNone:s=>{const e=s.match($F);return e?e.map(FF).join(" "):s}},UF={..._N,color:Js,backgroundColor:Js,outlineColor:Js,fill:Js,stroke:Js,borderColor:Js,borderTopColor:Js,borderRightColor:Js,borderBottomColor:Js,borderLeftColor:Js,filter:Mw,WebkitFilter:Mw},T_=s=>UF[s];function u2(s,e){let t=T_(s);return t!==Mw&&(t=Zo),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const d2=s=>/^0[^.\s]+$/.test(s);function BF(s){if(typeof s=="number")return s===0;if(s!==null)return s==="none"||s==="0"||d2(s)}function HF(s,e,t,n){const r=Dw(e,t);let i;Array.isArray(t)?i=[...t]:i=[null,t];const a=n.from!==void 0?n.from:s.get();let o;const l=[];for(let u=0;u<i.length;u++)i[u]===null&&(i[u]=u===0?a:i[u-1]),BF(i[u])&&l.push(u),typeof i[u]=="string"&&i[u]!=="none"&&i[u]!=="0"&&(o=i[u]);if(r&&l.length&&o)for(let u=0;u<l.length;u++){const h=l[u];i[h]=u2(e,o)}return i}function VF({when:s,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:r,repeat:i,repeatType:a,repeatDelay:o,from:l,elapsed:u,...h}){return!!Object.keys(h).length}function C_(s,e){return s[e]||s.default||s}const zF={skipAnimations:!1},N_=(s,e,t,n={})=>r=>{const i=C_(n,s)||{},a=i.delay||n.delay||0;let{elapsed:o=0}=n;o=o-Hc(a);const l=HF(e,s,t,i),u=l[0],h=l[l.length-1],f=Dw(s,u),p=Dw(s,h);let m={keyframes:l,velocity:e.getVelocity(),ease:"easeOut",...i,delay:-o,onUpdate:g=>{e.set(g),i.onUpdate&&i.onUpdate(g)},onComplete:()=>{r(),i.onComplete&&i.onComplete()}};if(VF(i)||(m={...m,...IF(s,m)}),m.duration&&(m.duration=Hc(m.duration)),m.repeatDelay&&(m.repeatDelay=Hc(m.repeatDelay)),!f||!p||FO.current||i.type===!1||zF.skipAnimations)return PF(m);if(!n.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const g=jF(e,s,m);if(g)return g}return ry(m)};function iy(s){return!!(En(s)&&s.add)}const h2=s=>/^\-?\d*\.?\d+$/.test(s);function j_(s,e){s.indexOf(e)===-1&&s.push(e)}function P_(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}class R_{constructor(){this.subscriptions=[]}add(e){return j_(this.subscriptions,e),()=>P_(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){const a=this.subscriptions[i];a&&a(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const WF=s=>!isNaN(parseFloat(s));class GF{constructor(e,t={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(n,r=!0)=>{this.prev=this.current,this.current=n;const{delta:i,timestamp:a}=$s;this.lastUpdated!==a&&(this.timeDelta=i,this.lastUpdated=a,vt.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>vt.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{n!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=WF(this.current),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new R_);const n=this.events[e].add(t);return e==="change"?()=>{n(),vt.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,n){this.set(t),this.prev=e,this.timeDelta=n}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?o2(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ch(s,e){return new GF(s,e)}const f2=s=>e=>e.test(s),qF={test:s=>s==="auto",parse:s=>s},p2=[tu,Te,Li,Wa,eO,ZI,qF],jh=s=>p2.find(f2(s)),KF=[...p2,Js,Zo],XF=s=>KF.find(f2(s));function YF(s,e,t){s.hasValue(e)?s.getValue(e).set(t):s.addValue(e,ch(t))}function JF(s,e){const t=lv(s,e);let{transitionEnd:n={},transition:r={},...i}=t?s.makeTargetAnimatable(t,!1):{};i={...i,...n};for(const a in i){const o=pO(i[a]);YF(s,a,o)}}function QF(s,e,t){var n,r;const i=Object.keys(e).filter(o=>!s.hasValue(o)),a=i.length;if(a)for(let o=0;o<a;o++){const l=i[o],u=e[l];let h=null;Array.isArray(u)&&(h=u[0]),h===null&&(h=(r=(n=t[l])!==null&&n!==void 0?n:s.readValue(l))!==null&&r!==void 0?r:e[l]),h!=null&&(typeof h=="string"&&(h2(h)||d2(h))?h=parseFloat(h):!XF(h)&&Zo.test(u)&&(h=u2(l,u)),s.addValue(l,ch(h,{owner:s})),t[l]===void 0&&(t[l]=h),h!==null&&s.setBaseTarget(l,h))}}function ZF(s,e){return e?(e[s]||e.default||e).from:void 0}function e4(s,e,t){const n={};for(const r in s){const i=ZF(r,e);if(i!==void 0)n[r]=i;else{const a=t.getValue(r);a&&(n[r]=a.get())}}return n}function t4({protectedKeys:s,needsAnimating:e},t){const n=s.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function s4(s,e){const t=s.get();if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}else return t!==e}function m2(s,e,{delay:t=0,transitionOverride:n,type:r}={}){let{transition:i=s.getDefaultTransition(),transitionEnd:a,...o}=s.makeTargetAnimatable(e);const l=s.getValue("willChange");n&&(i=n);const u=[],h=r&&s.animationState&&s.animationState.getState()[r];for(const f in o){const p=s.getValue(f),m=o[f];if(!p||m===void 0||h&&t4(h,f))continue;const g={delay:t,elapsed:0,...C_(i||{},f)};if(window.HandoffAppearAnimations){const v=s.getProps()[gN];if(v){const x=window.HandoffAppearAnimations(v,f,p,vt);x!==null&&(g.elapsed=x,g.isHandoff=!0)}}let y=!g.isHandoff&&!s4(p,m);if(g.type==="spring"&&(p.getVelocity()||g.velocity)&&(y=!1),p.animation&&(y=!1),y)continue;p.start(N_(f,p,m,s.shouldReduceMotion&&eu.has(f)?{type:!1}:g));const b=p.animation;iy(l)&&(l.add(f),b.then(()=>l.remove(f))),u.push(b)}return a&&Promise.all(u).then(()=>{a&&JF(s,a)}),u}function Iw(s,e,t={}){const n=lv(s,e,t.custom);let{transition:r=s.getDefaultTransition()||{}}=n||{};t.transitionOverride&&(r=t.transitionOverride);const i=n?()=>Promise.all(m2(s,n,t)):()=>Promise.resolve(),a=s.variantChildren&&s.variantChildren.size?(l=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:f}=r;return n4(s,e,u+l,h,f,t)}:()=>Promise.resolve(),{when:o}=r;if(o){const[l,u]=o==="beforeChildren"?[i,a]:[a,i];return l().then(()=>u())}else return Promise.all([i(),a(t.delay)])}function n4(s,e,t=0,n=0,r=1,i){const a=[],o=(s.variantChildren.size-1)*n,l=r===1?(u=0)=>u*n:(u=0)=>o-u*n;return Array.from(s.variantChildren).sort(r4).forEach((u,h)=>{u.notify("AnimationStart",e),a.push(Iw(u,e,{...i,delay:t+l(h)}).then(()=>u.notify("AnimationComplete",e)))}),Promise.all(a)}function r4(s,e){return s.sortNodePosition(e)}function i4(s,e,t={}){s.notify("AnimationStart",e);let n;if(Array.isArray(e)){const r=e.map(i=>Iw(s,i,t));n=Promise.all(r)}else if(typeof e=="string")n=Iw(s,e,t);else{const r=typeof e=="function"?lv(s,e,t.custom):e;n=Promise.all(m2(s,r,t))}return n.then(()=>s.notify("AnimationComplete",e))}const a4=[...f_].reverse(),o4=f_.length;function l4(s){return e=>Promise.all(e.map(({animation:t,options:n})=>i4(s,t,n)))}function c4(s){let e=l4(s);const t=d4();let n=!0;const r=(l,u)=>{const h=lv(s,u);if(h){const{transition:f,transitionEnd:p,...m}=h;l={...l,...m,...p}}return l};function i(l){e=l(s)}function a(l,u){const h=s.getProps(),f=s.getVariantContext(!0)||{},p=[],m=new Set;let g={},y=1/0;for(let v=0;v<o4;v++){const x=a4[v],w=t[x],E=h[x]!==void 0?h[x]:f[x],T=Kf(E),C=x===u?w.isActive:null;C===!1&&(y=v);let N=E===f[x]&&E!==h[x]&&T;if(N&&n&&s.manuallyAnimateOnMount&&(N=!1),w.protectedKeys={...g},!w.isActive&&C===null||!E&&!w.prevProp||rv(E)||typeof E=="boolean")continue;let R=u4(w.prevProp,E)||x===u&&w.isActive&&!N&&T||v>y&&T,D=!1;const z=Array.isArray(E)?E:[E];let L=z.reduce(r,{});C===!1&&(L={});const{prevResolvedValues:I={}}=w,O={...I,...L},Y=F=>{R=!0,m.has(F)&&(D=!0,m.delete(F)),w.needsAnimating[F]=!0};for(const F in O){const B=L[F],M=I[F];if(g.hasOwnProperty(F))continue;let $=!1;ty(B)&&ty(M)?$=!FN(B,M):$=B!==M,$?B!==void 0?Y(F):m.add(F):B!==void 0&&m.has(F)?Y(F):w.protectedKeys[F]=!0}w.prevProp=E,w.prevResolvedValues=L,w.isActive&&(g={...g,...L}),n&&s.blockInitialAnimation&&(R=!1),R&&(!N||D)&&p.push(...z.map(F=>({animation:F,options:{type:x,...l}})))}if(m.size){const v={};m.forEach(x=>{const w=s.getBaseTarget(x);w!==void 0&&(v[x]=w)}),p.push({animation:v})}let b=!!p.length;return n&&(h.initial===!1||h.initial===h.animate)&&!s.manuallyAnimateOnMount&&(b=!1),n=!1,b?e(p):Promise.resolve()}function o(l,u,h){var f;if(t[l].isActive===u)return Promise.resolve();(f=s.variantChildren)===null||f===void 0||f.forEach(m=>{var g;return(g=m.animationState)===null||g===void 0?void 0:g.setActive(l,u)}),t[l].isActive=u;const p=a(h,l);for(const m in t)t[m].protectedKeys={};return p}return{animateChanges:a,setActive:o,setAnimateFunction:i,getState:()=>t}}function u4(s,e){return typeof e=="string"?e!==s:Array.isArray(e)?!FN(e,s):!1}function dl(s=!1){return{isActive:s,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function d4(){return{animate:dl(!0),whileInView:dl(),whileHover:dl(),whileTap:dl(),whileDrag:dl(),whileFocus:dl(),exit:dl()}}class h4 extends ll{constructor(e){super(e),e.animationState||(e.animationState=c4(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),rv(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}let f4=0;class p4 extends ll{constructor(){super(...arguments),this.id=f4++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e,{custom:n??this.node.getProps().custom});t&&!e&&i.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const m4={animation:{Feature:h4},exit:{Feature:p4}},q1=(s,e)=>Math.abs(s-e);function g4(s,e){const t=q1(s.x,e.x),n=q1(s.y,e.y);return Math.sqrt(t**2+n**2)}class g2{constructor(e,t,{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=hx(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=g4(f.offset,{x:0,y:0})>=3;if(!p&&!m)return;const{point:g}=f,{timestamp:y}=$s;this.history.push({...g,timestamp:y});const{onStart:b,onMove:v}=this.handlers;p||(b&&b(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,f)},this.handlePointerMove=(f,p)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=dx(p,this.transformPagePoint),vt.update(this.updatePoint,!0)},this.handlePointerUp=(f,p)=>{this.end();const{onEnd:m,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=hx(f.type==="pointercancel"?this.lastMoveEventInfo:dx(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(f,b),g&&g(f,b)},!LN(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.contextWindow=r||window;const a=ov(e),o=dx(a,this.transformPagePoint),{point:l}=o,{timestamp:u}=$s;this.history=[{...l,timestamp:u}];const{onSessionStart:h}=t;h&&h(e,hx(o,this.history)),this.removeListeners=Xo(ka(this.contextWindow,"pointermove",this.handlePointerMove),ka(this.contextWindow,"pointerup",this.handlePointerUp),ka(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ma(this.updatePoint)}}function dx(s,e){return e?{point:e(s.point)}:s}function K1(s,e){return{x:s.x-e.x,y:s.y-e.y}}function hx({point:s},e){return{point:s,delta:K1(s,y2(e)),offset:K1(s,y4(e)),velocity:v4(e,.1)}}function y4(s){return s[0]}function y2(s){return s[s.length-1]}function v4(s,e){if(s.length<2)return{x:0,y:0};let t=s.length-1,n=null;const r=y2(s);for(;t>=0&&(n=s[t],!(r.timestamp-n.timestamp>Hc(e)));)t--;if(!n)return{x:0,y:0};const i=Ta(r.timestamp-n.timestamp);if(i===0)return{x:0,y:0};const a={x:(r.x-n.x)/i,y:(r.y-n.y)/i};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Zn(s){return s.max-s.min}function Ow(s,e=0,t=.01){return Math.abs(s-e)<=t}function X1(s,e,t,n=.5){s.origin=n,s.originPoint=jt(e.min,e.max,s.origin),s.scale=Zn(t)/Zn(e),(Ow(s.scale,1,1e-4)||isNaN(s.scale))&&(s.scale=1),s.translate=jt(t.min,t.max,s.origin)-s.originPoint,(Ow(s.translate)||isNaN(s.translate))&&(s.translate=0)}function _f(s,e,t,n){X1(s.x,e.x,t.x,n?n.originX:void 0),X1(s.y,e.y,t.y,n?n.originY:void 0)}function Y1(s,e,t){s.min=t.min+e.min,s.max=s.min+Zn(e)}function x4(s,e,t){Y1(s.x,e.x,t.x),Y1(s.y,e.y,t.y)}function J1(s,e,t){s.min=e.min-t.min,s.max=s.min+Zn(e)}function Ef(s,e,t){J1(s.x,e.x,t.x),J1(s.y,e.y,t.y)}function w4(s,{min:e,max:t},n){return e!==void 0&&s<e?s=n?jt(e,s,n.min):Math.max(s,e):t!==void 0&&s>t&&(s=n?jt(t,s,n.max):Math.min(s,t)),s}function Q1(s,e,t){return{min:e!==void 0?s.min+e:void 0,max:t!==void 0?s.max+t-(s.max-s.min):void 0}}function b4(s,{top:e,left:t,bottom:n,right:r}){return{x:Q1(s.x,t,r),y:Q1(s.y,e,n)}}function Z1(s,e){let t=e.min-s.min,n=e.max-s.max;return e.max-e.min<s.max-s.min&&([t,n]=[n,t]),{min:t,max:n}}function S4(s,e){return{x:Z1(s.x,e.x),y:Z1(s.y,e.y)}}function _4(s,e){let t=.5;const n=Zn(s),r=Zn(e);return r>n?t=Yf(e.min,e.max-n,s.min):n>r&&(t=Yf(s.min,s.max-r,e.min)),Qo(0,1,t)}function E4(s,e){const t={};return e.min!==void 0&&(t.min=e.min-s.min),e.max!==void 0&&(t.max=e.max-s.min),t}const Fw=.35;function A4(s=Fw){return s===!1?s=0:s===!0&&(s=Fw),{x:eA(s,"left","right"),y:eA(s,"top","bottom")}}function eA(s,e,t){return{min:tA(s,e),max:tA(s,t)}}function tA(s,e){return typeof s=="number"?s:s[e]||0}const sA=()=>({translate:0,scale:1,origin:0,originPoint:0}),Iu=()=>({x:sA(),y:sA()}),nA=()=>({min:0,max:0}),qt=()=>({x:nA(),y:nA()});function lr(s){return[s("x"),s("y")]}function v2({top:s,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:s,max:n}}}function k4({x:s,y:e}){return{top:e.min,right:s.max,bottom:e.max,left:s.min}}function T4(s,e){if(!e)return s;const t=e({x:s.left,y:s.top}),n=e({x:s.right,y:s.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}function fx(s){return s===void 0||s===1}function $w({scale:s,scaleX:e,scaleY:t}){return!fx(s)||!fx(e)||!fx(t)}function yl(s){return $w(s)||x2(s)||s.z||s.rotate||s.rotateX||s.rotateY}function x2(s){return rA(s.x)||rA(s.y)}function rA(s){return s&&s!=="0%"}function ay(s,e,t){const n=s-t,r=e*n;return t+r}function iA(s,e,t,n,r){return r!==void 0&&(s=ay(s,r,n)),ay(s,t,n)+e}function Uw(s,e=0,t=1,n,r){s.min=iA(s.min,e,t,n,r),s.max=iA(s.max,e,t,n,r)}function w2(s,{x:e,y:t}){Uw(s.x,e.translate,e.scale,e.originPoint),Uw(s.y,t.translate,t.scale,t.originPoint)}function C4(s,e,t,n=!1){const r=t.length;if(!r)return;e.x=e.y=1;let i,a;for(let o=0;o<r;o++){i=t[o],a=i.projectionDelta;const l=i.instance;l&&l.style&&l.style.display==="contents"||(n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Ou(s,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,w2(s,a)),n&&yl(i.latestValues)&&Ou(s,i.latestValues))}e.x=aA(e.x),e.y=aA(e.y)}function aA(s){return Number.isInteger(s)||s>1.0000000000001||s<.999999999999?s:1}function Ya(s,e){s.min=s.min+e,s.max=s.max+e}function oA(s,e,[t,n,r]){const i=e[r]!==void 0?e[r]:.5,a=jt(s.min,s.max,i);Uw(s,e[t],e[n],a,e.scale)}const N4=["x","scaleX","originX"],j4=["y","scaleY","originY"];function Ou(s,e){oA(s.x,e,N4),oA(s.y,e,j4)}function b2(s,e){return v2(T4(s.getBoundingClientRect(),e))}function P4(s,e,t){const n=b2(s,t),{scroll:r}=e;return r&&(Ya(n.x,r.offset.x),Ya(n.y,r.offset.y)),n}const S2=({current:s})=>s?s.ownerDocument.defaultView:null,R4=new WeakMap;class L4{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=qt(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const r=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ov(h,"page").point)},i=(h,f)=>{const{drag:p,dragPropagation:m,onDragStart:g}=this.getProps();if(p&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=MN(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),lr(b=>{let v=this.getAxisMotionValue(b).get()||0;if(Li.test(v)){const{projection:x}=this.visualElement;if(x&&x.layout){const w=x.layout.layoutBox[b];w&&(v=Zn(w)*(parseFloat(v)/100))}}this.originPoint[b]=v}),g&&vt.update(()=>g(h,f),!1,!0);const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(h,f)=>{const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:g,onDrag:y}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:b}=f;if(m&&this.currentDirection===null){this.currentDirection=D4(b),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",f.point,b),this.updateAxis("y",f.point,b),this.visualElement.render(),y&&y(h,f)},o=(h,f)=>this.stop(h,f),l=()=>lr(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:u}=this.getProps();this.panSession=new g2(e,{onSessionStart:r,onStart:i,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,contextWindow:S2(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&vt.update(()=>i(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!Tg(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=w4(a,this.constraints[e],this.elastic[e])),i.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;t&&Du(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=b4(r.layoutBox,t):this.constraints=!1,this.elastic=A4(n),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&lr(a=>{this.getAxisMotionValue(a)&&(this.constraints[a]=E4(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Du(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=P4(n,r.root,this.visualElement.getTransformPagePoint());let a=S4(r.layout.layoutBox,i);if(t){const o=t(k4(a));this.hasMutatedConstraints=!!o,o&&(a=v2(o))}return a}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},u=lr(h=>{if(!Tg(h,t,this.currentDirection))return;let f=l&&l[h]||{};a&&(f={min:0,max:0});const p=r?200:1e6,m=r?40:1e7,g={type:"inertia",velocity:n?e[h]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(h,g)});return Promise.all(u).then(o)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(N_(e,n,0,t))}stopAnimation(){lr(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){lr(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){lr(t=>{const{drag:n}=this.getProps();if(!Tg(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:a,max:o}=r.layout.layoutBox[t];i.set(e[t]-jt(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Du(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};lr(a=>{const o=this.getAxisMotionValue(a);if(o){const l=o.get();r[a]=_4({min:l,max:l},this.constraints[a])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),lr(a=>{if(!Tg(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:u}=this.constraints[a];o.set(jt(l,u,r[a]))})}addListeners(){if(!this.visualElement.current)return;R4.set(this.visualElement,this);const e=this.visualElement.current,t=ka(e,"pointerdown",l=>{const{drag:u,dragListener:h=!0}=this.getProps();u&&h&&this.start(l)}),n=()=>{const{dragConstraints:l}=this.getProps();Du(l)&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),n();const a=Ea(window,"resize",()=>this.scalePositionWithinConstraints()),o=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(lr(h=>{const f=this.getAxisMotionValue(h);f&&(this.originPoint[h]+=l[h].translate,f.set(f.get()+l[h].translate))}),this.visualElement.render())});return()=>{a(),t(),i(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:a=Fw,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:a,dragMomentum:o}}}function Tg(s,e,t){return(e===!0||e===s)&&(t===null||t===s)}function D4(s,e=10){let t=null;return Math.abs(s.y)>e?t="y":Math.abs(s.x)>e&&(t="x"),t}class M4 extends ll{constructor(e){super(e),this.removeGroupControls=zt,this.removeListeners=zt,this.controls=new L4(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||zt}unmount(){this.removeGroupControls(),this.removeListeners()}}const lA=s=>(e,t)=>{s&&vt.update(()=>s(e,t))};class I4 extends ll{constructor(){super(...arguments),this.removePointerDownListener=zt}onPointerDown(e){this.session=new g2(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:S2(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:lA(e),onStart:lA(t),onMove:n,onEnd:(i,a)=>{delete this.session,r&&vt.update(()=>r(i,a))}}}mount(){this.removePointerDownListener=ka(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function O4(){const s=S.useContext(sv);if(s===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:n}=s,r=S.useId();return S.useEffect(()=>n(r),[]),!e&&t?[!1,()=>t&&t(r)]:[!0]}const Jg={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function cA(s,e){return e.max===e.min?0:s/(e.max-e.min)*100}const Ph={correct:(s,e)=>{if(!e.target)return s;if(typeof s=="string")if(Te.test(s))s=parseFloat(s);else return s;const t=cA(s,e.target.x),n=cA(s,e.target.y);return`${t}% ${n}%`}},F4={correct:(s,{treeScale:e,projectionDelta:t})=>{const n=s,r=Zo.parse(s);if(r.length>5)return n;const i=Zo.createTransformer(s),a=typeof r[0]!="number"?1:0,o=t.x.scale*e.x,l=t.y.scale*e.y;r[0+a]/=o,r[1+a]/=l;const u=jt(o,l,.5);return typeof r[2+a]=="number"&&(r[2+a]/=u),typeof r[3+a]=="number"&&(r[3+a]/=u),i(r)}};class $4 extends Dm.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;GI(U4),i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Jg.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,a=n.projection;return a&&(a.isPresent=i,r||e.layoutDependency!==t||t===void 0?a.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?a.promote():a.relegate()||vt.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function _2(s){const[e,t]=O4(),n=S.useContext(m_);return Dm.createElement($4,{...s,layoutGroup:n,switchLayoutGroup:S.useContext(vN),isPresent:e,safeToRemove:t})}const U4={borderRadius:{...Ph,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ph,borderTopRightRadius:Ph,borderBottomLeftRadius:Ph,borderBottomRightRadius:Ph,boxShadow:F4},E2=["TopLeft","TopRight","BottomLeft","BottomRight"],B4=E2.length,uA=s=>typeof s=="string"?parseFloat(s):s,dA=s=>typeof s=="number"||Te.test(s);function H4(s,e,t,n,r,i){r?(s.opacity=jt(0,t.opacity!==void 0?t.opacity:1,V4(n)),s.opacityExit=jt(e.opacity!==void 0?e.opacity:1,0,z4(n))):i&&(s.opacity=jt(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,n));for(let a=0;a<B4;a++){const o=`border${E2[a]}Radius`;let l=hA(e,o),u=hA(t,o);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||dA(l)===dA(u)?(s[o]=Math.max(jt(uA(l),uA(u),n),0),(Li.test(u)||Li.test(l))&&(s[o]+="%")):s[o]=u}(e.rotate||t.rotate)&&(s.rotate=jt(e.rotate||0,t.rotate||0,n))}function hA(s,e){return s[e]!==void 0?s[e]:s.borderRadius}const V4=A2(0,.5,qN),z4=A2(.5,.95,zt);function A2(s,e,t){return n=>n<s?0:n>e?1:t(Yf(s,e,n))}function fA(s,e){s.min=e.min,s.max=e.max}function ir(s,e){fA(s.x,e.x),fA(s.y,e.y)}function pA(s,e,t,n,r){return s-=e,s=ay(s,1/t,n),r!==void 0&&(s=ay(s,1/r,n)),s}function W4(s,e=0,t=1,n=.5,r,i=s,a=s){if(Li.test(e)&&(e=parseFloat(e),e=jt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=jt(i.min,i.max,n);s===i&&(o-=e),s.min=pA(s.min,e,t,o,r),s.max=pA(s.max,e,t,o,r)}function mA(s,e,[t,n,r],i,a){W4(s,e[t],e[n],e[r],e.scale,i,a)}const G4=["x","scaleX","originX"],q4=["y","scaleY","originY"];function gA(s,e,t,n){mA(s.x,e,G4,t?t.x:void 0,n?n.x:void 0),mA(s.y,e,q4,t?t.y:void 0,n?n.y:void 0)}function yA(s){return s.translate===0&&s.scale===1}function k2(s){return yA(s.x)&&yA(s.y)}function K4(s,e){return s.x.min===e.x.min&&s.x.max===e.x.max&&s.y.min===e.y.min&&s.y.max===e.y.max}function T2(s,e){return Math.round(s.x.min)===Math.round(e.x.min)&&Math.round(s.x.max)===Math.round(e.x.max)&&Math.round(s.y.min)===Math.round(e.y.min)&&Math.round(s.y.max)===Math.round(e.y.max)}function vA(s){return Zn(s.x)/Zn(s.y)}class X4{constructor(){this.members=[]}add(e){j_(this.members,e),e.scheduleRender()}remove(e){if(P_(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let n;for(let r=t;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){n=i;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function xA(s,e,t){let n="";const r=s.x.translate/e.x,i=s.y.translate/e.y;if((r||i)&&(n=`translate3d(${r}px, ${i}px, 0) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{rotate:l,rotateX:u,rotateY:h}=t;l&&(n+=`rotate(${l}deg) `),u&&(n+=`rotateX(${u}deg) `),h&&(n+=`rotateY(${h}deg) `)}const a=s.x.scale*e.x,o=s.y.scale*e.y;return(a!==1||o!==1)&&(n+=`scale(${a}, ${o})`),n||"none"}const Y4=(s,e)=>s.depth-e.depth;class J4{constructor(){this.children=[],this.isDirty=!1}add(e){j_(this.children,e),this.isDirty=!0}remove(e){P_(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Y4),this.isDirty=!1,this.children.forEach(e)}}function Q4(s,e){const t=performance.now(),n=({timestamp:r})=>{const i=r-t;i>=e&&(Ma(n),s(i-e))};return vt.read(n,!0),()=>Ma(n)}function Z4(s){window.MotionDebug&&window.MotionDebug.record(s)}function e3(s){return s instanceof SVGElement&&s.tagName!=="svg"}function t3(s,e,t){const n=En(s)?s:ch(s);return n.start(N_("",n,e,t)),n.animation}const wA=["","X","Y","Z"],s3={visibility:"hidden"},bA=1e3;let n3=0;const vl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function C2({attachResizeListener:s,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(a={},o=e==null?void 0:e()){this.id=n3++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,vl.totalNodes=vl.resolvedTargetDeltas=vl.recalculatedProjection=0,this.nodes.forEach(a3),this.nodes.forEach(d3),this.nodes.forEach(h3),this.nodes.forEach(o3),Z4(vl)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new J4)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new R_),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=e3(a),this.instance=a;const{layoutId:l,layout:u,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(u||l)&&(this.isLayoutDirty=!0),s){let f;const p=()=>this.root.updateBlockedByResize=!1;s(a,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=Q4(p,250),Jg.hasAnimatedSinceResize&&(Jg.hasAnimatedSinceResize=!1,this.nodes.forEach(_A))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&h&&(l||u)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeTargetChanged:m,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||h.getDefaultTransition()||y3,{onLayoutAnimationStart:b,onLayoutAnimationComplete:v}=h.getProps(),x=!this.targetLayout||!T2(this.targetLayout,g)||m,w=!p&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||p&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,w);const E={...C_(y,"layout"),onPlay:b,onComplete:v};(h.shouldReduceMotion||this.options.layoutRoot)&&(E.delay=0,E.type=!1),this.startAnimation(E)}else p||_A(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ma(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(f3),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(SA);return}this.isUpdating||this.nodes.forEach(c3),this.isUpdating=!1,this.nodes.forEach(u3),this.nodes.forEach(r3),this.nodes.forEach(i3),this.clearAllSnapshots();const o=performance.now();$s.delta=Qo(0,1e3/60,o-$s.timestamp),$s.timestamp=o,$s.isProcessing=!0,nx.update.process($s),nx.preRender.process($s),nx.render.process($s),$s.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(l3),this.sharedNodes.forEach(p3)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,vt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){vt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=qt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&(this.scroll={animationId:this.root.animationId,phase:a,isRoot:n(this.instance),offset:t(this.instance)})}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform,o=this.projectionDelta&&!k2(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,h=u!==this.prevTransformTemplateValue;a&&(o||yl(this.latestValues)||h)&&(r(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),v3(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return qt();const o=a.measureViewportBox(),{scroll:l}=this.root;return l&&(Ya(o.x,l.offset.x),Ya(o.y,l.offset.y)),o}removeElementScroll(a){const o=qt();ir(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l],{scroll:h,options:f}=u;if(u!==this.root&&h&&f.layoutScroll){if(h.isRoot){ir(o,a);const{scroll:p}=this.root;p&&(Ya(o.x,-p.offset.x),Ya(o.y,-p.offset.y))}Ya(o.x,h.offset.x),Ya(o.y,h.offset.y)}}return o}applyTransform(a,o=!1){const l=qt();ir(l,a);for(let u=0;u<this.path.length;u++){const h=this.path[u];!o&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Ou(l,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),yl(h.latestValues)&&Ou(l,h.latestValues)}return yl(this.latestValues)&&Ou(l,this.latestValues),l}removeTransform(a){const o=qt();ir(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!yl(u.latestValues))continue;$w(u.latestValues)&&u.updateSnapshot();const h=qt(),f=u.measurePageBox();ir(h,f),gA(o,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,h)}return yl(this.latestValues)&&gA(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==$s.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==l;if(!(a||u&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=$s.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=qt(),this.relativeTargetOrigin=qt(),Ef(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),ir(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=qt(),this.targetWithTransforms=qt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),x4(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ir(this.target,this.layout.layoutBox),w2(this.target,this.targetDelta)):ir(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=qt(),this.relativeTargetOrigin=qt(),Ef(this.relativeTargetOrigin,this.target,m.target),ir(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}vl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||$w(this.parent.latestValues)||x2(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let u=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(u=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===$s.timestamp&&(u=!1),u)return;const{layout:h,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||f))return;ir(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,m=this.treeScale.y;C4(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox);const{target:g}=o;if(!g){this.projectionTransform&&(this.projectionDelta=Iu(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Iu(),this.projectionDeltaWithTransform=Iu());const y=this.projectionTransform;_f(this.projectionDelta,this.layoutCorrected,g,this.latestValues),this.projectionTransform=xA(this.projectionDelta,this.treeScale),(this.projectionTransform!==y||this.treeScale.x!==p||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),vl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(a,o=!1){const l=this.snapshot,u=l?l.latestValues:{},h={...this.latestValues},f=Iu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const p=qt(),m=l?l.source:void 0,g=this.layout?this.layout.source:void 0,y=m!==g,b=this.getStack(),v=!b||b.members.length<=1,x=!!(y&&!v&&this.options.crossfade===!0&&!this.path.some(g3));this.animationProgress=0;let w;this.mixTargetDelta=E=>{const T=E/1e3;EA(f.x,a.x,T),EA(f.y,a.y,T),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ef(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),m3(this.relativeTarget,this.relativeTargetOrigin,p,T),w&&K4(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=qt()),ir(w,this.relativeTarget)),y&&(this.animationValues=h,H4(h,u,this.latestValues,T,x,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ma(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=vt.update(()=>{Jg.hasAnimatedSinceResize=!0,this.currentAnimation=t3(0,bA,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(bA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:u,latestValues:h}=a;if(!(!o||!l||!u)){if(this!==a&&this.layout&&u&&N2(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||qt();const f=Zn(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+f;const p=Zn(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}ir(o,l),Ou(o,h),_f(this.projectionDeltaWithTransform,this.layoutCorrected,o,h)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new X4),this.sharedNodes.get(a).add(o);const u=o.options.initialPromotionConfig;o.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.rotate||l.rotateX||l.rotateY||l.rotateZ)&&(o=!0),!o)return;const u={};for(let h=0;h<wA.length;h++){const f="rotate"+wA[h];l[f]&&(u[f]=l[f],a.setStaticValue(f,0))}a.render();for(const h in u)a.setStaticValue(h,u[h]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return s3;const u={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,u.opacity="",u.pointerEvents=Yg(a==null?void 0:a.pointerEvents)||"",u.transform=h?h(this.latestValues,""):"none",u;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=Yg(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!yl(this.latestValues)&&(y.transform=h?h({},""):"none",this.hasProjected=!1),y}const p=f.animationValues||f.latestValues;this.applyTransformsToTarget(),u.transform=xA(this.projectionDeltaWithTransform,this.treeScale,p),h&&(u.transform=h(p,u.transform));const{x:m,y:g}=this.projectionDelta;u.transformOrigin=`${m.origin*100}% ${g.origin*100}% 0`,f.animationValues?u.opacity=f===this?(l=(o=p.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:u.opacity=f===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const y in Z0){if(p[y]===void 0)continue;const{correct:b,applyTo:v}=Z0[y],x=u.transform==="none"?p[y]:b(p[y],f);if(v){const w=v.length;for(let E=0;E<w;E++)u[v[E]]=x}else u[y]=x}return this.options.layoutId&&(u.pointerEvents=f===this?Yg(a==null?void 0:a.pointerEvents)||"":"none"),u}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(SA),this.root.sharedNodes.clear()}}}function r3(s){s.updateLayout()}function i3(s){var e;const t=((e=s.resumeFrom)===null||e===void 0?void 0:e.snapshot)||s.snapshot;if(s.isLead()&&s.layout&&t&&s.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=s.layout,{animationType:i}=s.options,a=t.source!==s.layout.source;i==="size"?lr(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],m=Zn(p);p.min=n[f].min,p.max=p.min+m}):N2(i,t.layoutBox,n)&&lr(f=>{const p=a?t.measuredBox[f]:t.layoutBox[f],m=Zn(n[f]);p.max=p.min+m,s.relativeTarget&&!s.currentAnimation&&(s.isProjectionDirty=!0,s.relativeTarget[f].max=s.relativeTarget[f].min+m)});const o=Iu();_f(o,n,t.layoutBox);const l=Iu();a?_f(l,s.applyTransform(r,!0),t.measuredBox):_f(l,n,t.layoutBox);const u=!k2(o);let h=!1;if(!s.resumeFrom){const f=s.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:m}=f;if(p&&m){const g=qt();Ef(g,t.layoutBox,p.layoutBox);const y=qt();Ef(y,n,m.layoutBox),T2(g,y)||(h=!0),f.options.layoutRoot&&(s.relativeTarget=y,s.relativeTargetOrigin=g,s.relativeParent=f)}}}s.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:l,layoutDelta:o,hasLayoutChanged:u,hasRelativeTargetChanged:h})}else if(s.isLead()){const{onExitComplete:n}=s.options;n&&n()}s.options.transition=void 0}function a3(s){vl.totalNodes++,s.parent&&(s.isProjecting()||(s.isProjectionDirty=s.parent.isProjectionDirty),s.isSharedProjectionDirty||(s.isSharedProjectionDirty=!!(s.isProjectionDirty||s.parent.isProjectionDirty||s.parent.isSharedProjectionDirty)),s.isTransformDirty||(s.isTransformDirty=s.parent.isTransformDirty))}function o3(s){s.isProjectionDirty=s.isSharedProjectionDirty=s.isTransformDirty=!1}function l3(s){s.clearSnapshot()}function SA(s){s.clearMeasurements()}function c3(s){s.isLayoutDirty=!1}function u3(s){const{visualElement:e}=s.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),s.resetTransform()}function _A(s){s.finishAnimation(),s.targetDelta=s.relativeTarget=s.target=void 0,s.isProjectionDirty=!0}function d3(s){s.resolveTargetDelta()}function h3(s){s.calcProjection()}function f3(s){s.resetRotation()}function p3(s){s.removeLeadSnapshot()}function EA(s,e,t){s.translate=jt(e.translate,0,t),s.scale=jt(e.scale,1,t),s.origin=e.origin,s.originPoint=e.originPoint}function AA(s,e,t,n){s.min=jt(e.min,t.min,n),s.max=jt(e.max,t.max,n)}function m3(s,e,t,n){AA(s.x,e.x,t.x,n),AA(s.y,e.y,t.y,n)}function g3(s){return s.animationValues&&s.animationValues.opacityExit!==void 0}const y3={duration:.45,ease:[.4,0,.1,1]},kA=s=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(s),TA=kA("applewebkit/")&&!kA("chrome/")?Math.round:zt;function CA(s){s.min=TA(s.min),s.max=TA(s.max)}function v3(s){CA(s.x),CA(s.y)}function N2(s,e,t){return s==="position"||s==="preserve-aspect"&&!Ow(vA(e),vA(t),.2)}const x3=C2({attachResizeListener:(s,e)=>Ea(s,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),px={current:void 0},j2=C2({measureScroll:s=>({x:s.scrollLeft,y:s.scrollTop}),defaultParent:()=>{if(!px.current){const s=new x3({});s.mount(window),s.setOptions({layoutScroll:!0}),px.current=s}return px.current},resetTransform:(s,e)=>{s.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:s=>window.getComputedStyle(s).position==="fixed"}),w3={pan:{Feature:I4},drag:{Feature:M4,ProjectionNode:j2,MeasureLayout:_2}},b3=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function S3(s){const e=b3.exec(s);if(!e)return[,];const[,t,n]=e;return[t,n]}function Bw(s,e,t=1){const[n,r]=S3(s);if(!n)return;const i=window.getComputedStyle(e).getPropertyValue(n);if(i){const a=i.trim();return h2(a)?parseFloat(a):a}else return jw(r)?Bw(r,e,t+1):r}function _3(s,{...e},t){const n=s.current;if(!(n instanceof Element))return{target:e,transitionEnd:t};t&&(t={...t}),s.values.forEach(r=>{const i=r.get();if(!jw(i))return;const a=Bw(i,n);a&&r.set(a)});for(const r in e){const i=e[r];if(!jw(i))continue;const a=Bw(i,n);a&&(e[r]=a,t||(t={}),t[r]===void 0&&(t[r]=i))}return{target:e,transitionEnd:t}}const E3=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),P2=s=>E3.has(s),A3=s=>Object.keys(s).some(P2),NA=s=>s===tu||s===Te,jA=(s,e)=>parseFloat(s.split(", ")[e]),PA=(s,e)=>(t,{transform:n})=>{if(n==="none"||!n)return 0;const r=n.match(/^matrix3d\((.+)\)$/);if(r)return jA(r[1],e);{const i=n.match(/^matrix\((.+)\)$/);return i?jA(i[1],s):0}},k3=new Set(["x","y","z"]),T3=Hm.filter(s=>!k3.has(s));function C3(s){const e=[];return T3.forEach(t=>{const n=s.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e.length&&s.render(),e}const uh={width:({x:s},{paddingLeft:e="0",paddingRight:t="0"})=>s.max-s.min-parseFloat(e)-parseFloat(t),height:({y:s},{paddingTop:e="0",paddingBottom:t="0"})=>s.max-s.min-parseFloat(e)-parseFloat(t),top:(s,{top:e})=>parseFloat(e),left:(s,{left:e})=>parseFloat(e),bottom:({y:s},{top:e})=>parseFloat(e)+(s.max-s.min),right:({x:s},{left:e})=>parseFloat(e)+(s.max-s.min),x:PA(4,13),y:PA(5,14)};uh.translateX=uh.x;uh.translateY=uh.y;const N3=(s,e,t)=>{const n=e.measureViewportBox(),r=e.current,i=getComputedStyle(r),{display:a}=i,o={};a==="none"&&e.setStaticValue("display",s.display||"block"),t.forEach(u=>{o[u]=uh[u](n,i)}),e.render();const l=e.measureViewportBox();return t.forEach(u=>{const h=e.getValue(u);h&&h.jump(o[u]),s[u]=uh[u](l,i)}),s},j3=(s,e,t={},n={})=>{e={...e},n={...n};const r=Object.keys(e).filter(P2);let i=[],a=!1;const o=[];if(r.forEach(l=>{const u=s.getValue(l);if(!s.hasValue(l))return;let h=t[l],f=jh(h);const p=e[l];let m;if(ty(p)){const g=p.length,y=p[0]===null?1:0;h=p[y],f=jh(h);for(let b=y;b<g&&p[b]!==null;b++)m?__(jh(p[b])===m):m=jh(p[b])}else m=jh(p);if(f!==m)if(NA(f)&&NA(m)){const g=u.get();typeof g=="string"&&u.set(parseFloat(g)),typeof p=="string"?e[l]=parseFloat(p):Array.isArray(p)&&m===Te&&(e[l]=p.map(parseFloat))}else f!=null&&f.transform&&(m!=null&&m.transform)&&(h===0||p===0)?h===0?u.set(m.transform(h)):e[l]=f.transform(p):(a||(i=C3(s),a=!0),o.push(l),n[l]=n[l]!==void 0?n[l]:e[l],u.jump(p))}),o.length){const l=o.indexOf("height")>=0?window.pageYOffset:null,u=N3(e,s,o);return i.length&&i.forEach(([h,f])=>{s.getValue(h).set(f)}),s.render(),nv&&l!==null&&window.scrollTo({top:l}),{target:u,transitionEnd:n}}else return{target:e,transitionEnd:n}};function P3(s,e,t,n){return A3(e)?j3(s,e,t,n):{target:e,transitionEnd:n}}const R3=(s,e,t,n)=>{const r=_3(s,e,n);return e=r.target,n=r.transitionEnd,P3(s,e,t,n)},Hw={current:null},R2={current:!1};function L3(){if(R2.current=!0,!!nv)if(window.matchMedia){const s=window.matchMedia("(prefers-reduced-motion)"),e=()=>Hw.current=s.matches;s.addListener(e),e()}else Hw.current=!1}function D3(s,e,t){const{willChange:n}=e;for(const r in e){const i=e[r],a=t[r];if(En(i))s.addValue(r,i),iy(n)&&n.add(r);else if(En(a))s.addValue(r,ch(i,{owner:s})),iy(n)&&n.remove(r);else if(a!==i)if(s.hasValue(r)){const o=s.getValue(r);!o.hasAnimated&&o.set(i)}else{const o=s.getStaticValue(r);s.addValue(r,ch(o!==void 0?o:i,{owner:s}))}}for(const r in t)e[r]===void 0&&s.removeValue(r);return e}const RA=new WeakMap,L2=Object.keys(Xf),M3=L2.length,LA=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],I3=p_.length;class O3{constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,visualState:i},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>vt.render(this.render,!1,!0);const{latestValues:o,renderState:l}=i;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.isControllingVariants=iv(t),this.isVariantNode=yN(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{});for(const f in h){const p=h[f];o[f]!==void 0&&En(p)&&(p.set(o[f],!1),iy(u)&&u.add(f))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,RA.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,n)=>this.bindToMotionValue(n,t)),R2.current||L3(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Hw.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){RA.delete(this.current),this.projection&&this.projection.unmount(),Ma(this.notifyUpdate),Ma(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const n=eu.has(e),r=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&vt.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),i=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{r(),i()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...t},n,r,i){let a,o;for(let l=0;l<M3;l++){const u=L2[l],{isEnabled:h,Feature:f,ProjectionNode:p,MeasureLayout:m}=Xf[u];p&&(a=p),h(t)&&(!this.features[u]&&f&&(this.features[u]=new f(this)),m&&(o=m))}if((this.type==="html"||this.type==="svg")&&!this.projection&&a){this.projection=new a(this.latestValues,this.parent&&this.parent.projection);const{layoutId:l,layout:u,drag:h,dragConstraints:f,layoutScroll:p,layoutRoot:m}=t;this.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!h||f&&Du(f),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof u=="string"?u:"both",initialPromotionConfig:i,layoutScroll:p,layoutRoot:m})}return o}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):qt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<LA.length;n++){const r=LA[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i=e["on"+r];i&&(this.propEventSubscriptions[r]=this.on(r,i))}this.prevMotionValues=D3(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const n=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(n.initial=this.props.initial),n}const t={};for(let n=0;n<I3;n++){const r=p_[n],i=this.props[r];(Kf(i)||i===!1)&&(t[r]=i)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ch(t,{owner:this}),this.addValue(e,n)),n}readValue(e){var t;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(t=this.getBaseTargetFromProps(this.props,e))!==null&&t!==void 0?t:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props,r=typeof n=="string"||typeof n=="object"?(t=S_(this.props,n))===null||t===void 0?void 0:t[e]:void 0;if(n&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!En(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new R_),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class D2 extends O3{sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...n},{transformValues:r},i){let a=e4(n,e||{},this);if(r&&(t&&(t=r(t)),n&&(n=r(n)),a&&(a=r(a))),i){QF(this,n,a);const o=R3(this,n,a,t);t=o.transitionEnd,n=o.target}return{transition:e,transitionEnd:t,...n}}}function F3(s){return window.getComputedStyle(s)}class $3 extends D2{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(eu.has(t)){const n=T_(t);return n&&n.default||0}else{const n=F3(e),r=(bN(t)?n.getPropertyValue(t):n[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return b2(e,t)}build(e,t,n,r){y_(e,t,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,t){return b_(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;En(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}renderInstance(e,t,n,r){TN(e,t,n,r)}}class U3 extends D2{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(eu.has(t)){const n=T_(t);return n&&n.default||0}return t=CN.has(t)?t:h_(t),e.getAttribute(t)}measureInstanceViewportBox(){return qt()}scrapeMotionValuesFromProps(e,t){return jN(e,t)}build(e,t,n,r){x_(e,t,n,this.isSVGTag,r.transformTemplate)}renderInstance(e,t,n,r){NN(e,t,n,r)}mount(e){this.isSVGTag=w_(e.tagName),super.mount(e)}}const B3=(s,e)=>g_(s)?new U3(e,{enableHardwareAcceleration:!1}):new $3(e,{enableHardwareAcceleration:!0}),H3={layout:{ProjectionNode:j2,MeasureLayout:_2}},V3={...m4,...MO,...w3,...H3},Q=zI((s,e)=>SO(s,e,V3,B3));function M2(){const s=S.useRef(!1);return d_(()=>(s.current=!0,()=>{s.current=!1}),[]),s}function z3(){const s=M2(),[e,t]=S.useState(0),n=S.useCallback(()=>{s.current&&t(e+1)},[e]);return[S.useCallback(()=>vt.postRender(n),[n]),e]}class W3 extends S.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function G3({children:s,isPresent:e}){const t=S.useId(),n=S.useRef(null),r=S.useRef({width:0,height:0,top:0,left:0});return S.useInsertionEffect(()=>{const{width:i,height:a,top:o,left:l}=r.current;if(e||!n.current||!i||!a)return;n.current.dataset.motionPopId=t;const u=document.createElement("style");return document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${a}px !important;
            top: ${o}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[e]),S.createElement(W3,{isPresent:e,childRef:n,sizeRef:r},S.cloneElement(s,{ref:n}))}const mx=({children:s,initial:e,isPresent:t,onExitComplete:n,custom:r,presenceAffectsLayout:i,mode:a})=>{const o=PN(q3),l=S.useId(),u=S.useMemo(()=>({id:l,initial:e,isPresent:t,custom:r,onExitComplete:h=>{o.set(h,!0);for(const f of o.values())if(!f)return;n&&n()},register:h=>(o.set(h,!1),()=>o.delete(h))}),i?void 0:[t]);return S.useMemo(()=>{o.forEach((h,f)=>o.set(f,!1))},[t]),S.useEffect(()=>{!t&&!o.size&&n&&n()},[t]),a==="popLayout"&&(s=S.createElement(G3,{isPresent:t},s)),S.createElement(sv.Provider,{value:u},s)};function q3(){return new Map}function K3(s){return S.useEffect(()=>()=>s(),[])}const xl=s=>s.key||"";function X3(s,e){s.forEach(t=>{const n=xl(t);e.set(n,t)})}function Y3(s){const e=[];return S.Children.forEach(s,t=>{S.isValidElement(t)&&e.push(t)}),e}const Cs=({children:s,custom:e,initial:t=!0,onExitComplete:n,exitBeforeEnter:r,presenceAffectsLayout:i=!0,mode:a="sync"})=>{const o=S.useContext(m_).forceRender||z3()[0],l=M2(),u=Y3(s);let h=u;const f=S.useRef(new Map).current,p=S.useRef(h),m=S.useRef(new Map).current,g=S.useRef(!0);if(d_(()=>{g.current=!1,X3(u,m),p.current=h}),K3(()=>{g.current=!0,m.clear(),f.clear()}),g.current)return S.createElement(S.Fragment,null,h.map(x=>S.createElement(mx,{key:xl(x),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:a},x)));h=[...h];const y=p.current.map(xl),b=u.map(xl),v=y.length;for(let x=0;x<v;x++){const w=y[x];b.indexOf(w)===-1&&!f.has(w)&&f.set(w,void 0)}return a==="wait"&&f.size&&(h=[]),f.forEach((x,w)=>{if(b.indexOf(w)!==-1)return;const E=m.get(w);if(!E)return;const T=y.indexOf(w);let C=x;if(!C){const N=()=>{f.delete(w);const j=Array.from(m.keys()).filter(R=>!b.includes(R));if(j.forEach(R=>m.delete(R)),p.current=u.filter(R=>{const D=xl(R);return D===w||j.includes(D)}),!f.size){if(l.current===!1)return;o(),n&&n()}};C=S.createElement(mx,{key:xl(E),isPresent:!1,onExitComplete:N,custom:e,presenceAffectsLayout:i,mode:a},E),f.set(w,C)}h.splice(T,0,C)}),h=h.map(x=>{const w=x.key;return f.has(w)?x:S.createElement(mx,{key:xl(x),isPresent:!0,presenceAffectsLayout:i,mode:a},x)}),S.createElement(S.Fragment,null,f.size?h:h.map(x=>S.cloneElement(x)))},Ii={info:(s,e,t)=>console.log(`[${s}] ${e}`,t||""),warning:(s,e,t)=>console.warn(`[${s}] ${e}`,t||""),error:(s,e,t)=>console.error(`[${s}] ${e}`,t||""),success:(s,e,t)=>console.log(`✅ [${s}] ${e}`,t||""),debug:(s,e,t)=>console.log(`🐛 [${s}] ${e}`,t||""),enable:()=>console.log("Debug enabled")},J3=({onLogin:s,loginError:e})=>{const[t,n]=S.useState(!1),[r,i]=S.useState(""),[a,o]=S.useState(""),[l,u]=S.useState(!1),h=S.useRef(null);S.useEffect(()=>{const p=m=>{h.current&&!h.current.contains(m.target)&&n(!1)};return t&&document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[t]);const f=async p=>{if(p.preventDefault(),Ii.info("HEADER","Login form submitted",{username:r.trim(),hasPassword:!!a.trim(),onLoginFunction:typeof s}),!r.trim()||!a.trim()){Ii.warning("HEADER","Login form validation failed",{usernameEmpty:!r.trim(),passwordEmpty:!a.trim()});return}if(!s||typeof s!="function"){Ii.error("HEADER","onLogin function not provided or invalid",{onLogin:s,type:typeof s});return}u(!0),Ii.info("HEADER","Calling onLogin function",{username:r.trim()});try{const m=await s(r.trim(),a);Ii.success("HEADER","onLogin function completed",{result:m,success:m==null?void 0:m.success})}catch(m){Ii.error("HEADER","onLogin function failed",{error:m.message,stack:m.stack})}finally{u(!1),Ii.info("HEADER","Login process completed",{loading:!1})}};return c.jsxs("header",{className:"bg-white/95 backdrop-blur-sm shadow-sm border-b border-neutral-200 sticky top-0 z-50",children:[c.jsxs("div",{className:"relative w-full h-32 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(/pics/large.jpg)"},children:[c.jsx("div",{className:"w-full h-full bg-black bg-opacity-10"})," "]}),c.jsxs("div",{className:"absolute top-0 right-0 p-4",children:[!1,c.jsx("div",{className:"relative",ref:h,children:t?c.jsxs(Q.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"absolute right-0 top-0 bg-white rounded-lg shadow-lg border border-neutral-200 p-4 w-80 max-w-[calc(100vw-2rem)] sm:w-80 z-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"text-lg font-semibold text-neutral-800",children:"Login"}),c.jsx("button",{onClick:()=>n(!1),className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("form",{onSubmit:f,className:"space-y-3",children:[e&&c.jsx(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-xs",children:e}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"header-username",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Username"}),c.jsx("input",{type:"text",id:"header-username",value:r,onChange:p=>i(p.target.value),placeholder:"Enter username",className:"w-full px-3 py-2 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent transition-all duration-200",required:!0,disabled:l,autoComplete:"username"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"header-password",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Password"}),c.jsx("input",{type:"password",id:"header-password",value:a,onChange:p=>o(p.target.value),placeholder:"Enter password",className:"w-full px-3 py-2 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent transition-all duration-200",required:!0,disabled:l,autoComplete:"current-password"})]}),c.jsx(Q.button,{type:"submit",disabled:l||!r.trim()||!a.trim(),className:"w-full bg-primary-500 hover:bg-primary-600 disabled:bg-neutral-300 disabled:cursor-not-allowed text-white text-sm font-medium py-2 rounded transition-colors duration-200",whileHover:{scale:1.01},whileTap:{scale:.99},onClick:p=>{Ii.info("HEADER","Submit button clicked",{loading:l,username:r.trim(),hasPassword:!!a.trim(),disabled:l||!r.trim()||!a.trim()})},children:l?c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Logging in..."]}):"Login"})]})]}):c.jsxs(Q.button,{onClick:()=>{Ii.info("HEADER","Login button clicked",{showLogin:!1}),n(!0)},className:"bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 sm:px-4",whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx("span",{className:"hidden sm:inline",children:"Login"}),c.jsx("span",{className:"sm:hidden",children:"🔑"})]})})]})]})},I2=({teachers:s=[],title:e="Meet Our Teachers",subtitle:t="Our experienced and passionate teachers are here to help you achieve your language learning goals",showSelection:n=!1,selectedTeachers:r=[],onSelectionChange:i,displayCount:a=null})=>{const[o,l]=S.useState(0),u=S.useRef(null),[h,f]=S.useState(a),p=Math.max(0,s.length-h),m=()=>{o<p?l(v=>Math.min(v+1,p)):l(0)},g=()=>{o>0?l(v=>Math.max(v-1,0)):l(p)};S.useEffect(()=>{const v=()=>{if(u.current){const w=u.current.offsetWidth,E=n?192:256,T=32,N=w-32,j=Math.floor(N/(E+T));if(a&&a>0){const R=Math.min(a,j,s.length);f(R)}else{const R=Math.max(1,Math.min(j,s.length));f(R)}}};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[s.length,n,a]),S.useEffect(()=>{if(u.current){const v=u.current,E=o*((n?192:256)+32);v.scrollTo({left:E,behavior:"smooth"})}},[o,n]);const y=s.slice(o,o+h),b=v=>{if(!i)return;const x=r.includes(v);let w;x?w=r.filter(E=>E!==v):w=[...r,v],i(w)};return c.jsxs("div",{className:"text-center mb-16",children:[c.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-4",children:e}),c.jsx("p",{className:"text-neutral-600 mb-8 max-w-2xl mx-auto",children:t}),c.jsxs("div",{className:"relative w-full px-4 md:px-8 lg:px-16 xl:px-24",children:[s.length>h&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:g,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full bg-white shadow-lg border border-gray-200 flex items-center justify-center transition-all duration-200 hover:bg-gray-50 hover:shadow-xl",title:"Previous teachers",children:c.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx("button",{onClick:m,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full bg-white shadow-lg border border-gray-200 flex items-center justify-center transition-all duration-200 hover:bg-gray-50 hover:shadow-xl",title:"Next teachers",children:c.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),c.jsx("div",{ref:u,className:`flex gap-8 transition-all duration-500 ease-in-out overflow-x-auto overflow-y-hidden pb-4 scrollbar-hide ${n?"justify-start":"justify-center"}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:y.map((v,x)=>{const w=n&&r.includes(v.id);return c.jsxs(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:x*.1},className:`bg-transparent rounded-lg p-4 hover:shadow-xl transition-all duration-300 flex-shrink-0 ${n?`cursor-pointer w-48 ${w?"ring-2 ring-primary-500 ring-offset-2":""}`:"clickable w-64"}`,onClick:n?()=>b(v.id):void 0,children:[c.jsx("div",{className:`mx-auto mb-4 rounded-full overflow-hidden shadow-lg ${n?"w-32 h-32":"w-40 h-40"}`,style:{background:"linear-gradient(135deg, #fefce8 0%, #faf5ff 100%)"},children:c.jsx("img",{src:v.photo_url||"/pics/teachers/default.jpg",alt:v.name,className:"w-full h-full object-cover",onError:E=>{E.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDgiIGN5PSI0OCIgcj0iNDgiIGZpbGw9IiNGM0Y0RjYiLz4KPHBhdGggZD0iTTQ4IDI0QzM5LjE2NDkgMjQgMzIgMzEuMTY0OSAzMiA0MEMzMiA0OC44MzUxIDM5LjE2NDkgNTYgNDggNTZDNTYuODM1MSA1NiA2NCA0OC44MzUxIDY0IDQwQzY0IDMxLjE2NDkgNTYuODM1MSAyNCA0OCAyNFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHBhdGggZD0iTTQ4IDY0QzM5LjE2NDkgNjQgMzIgNzEuMTY0OSAzMiA4MEMzMiA4OC44MzUxIDM5LjE2NDkgOTYgNDggOTZDNTYuODM1MSA5NiA2NCA4OC44MzUxIDY0IDgwQzY0IDcxLjE2NDkgNTYuODM1MSA2NCA0OCA2NFoiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+"}})}),c.jsx("h3",{className:`font-semibold text-neutral-800 mb-2 text-center ${n?"text-lg":"text-xl"}`,children:v.name}),n?c.jsx("div",{className:"flex justify-center",children:c.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${w?"bg-primary-500 border-primary-500":"border-gray-300 hover:border-primary-400"}`,children:w&&c.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}):c.jsx("p",{className:"text-neutral-600 text-sm leading-relaxed",children:v.description})]},v.id)})}),s.length>h&&c.jsx("div",{className:"flex justify-center mt-6 space-x-2",children:Array.from({length:p+1},(v,x)=>c.jsx("button",{onClick:()=>l(x),className:`w-3 h-3 rounded-full transition-all duration-200 ${x===o?"bg-primary-500":"bg-gray-300 hover:bg-gray-400"}`,title:`View teachers ${x+1}-${Math.min(x+h,s.length)}`},x))}),n&&c.jsx("div",{className:"mt-6 text-center",children:c.jsxs("p",{className:"text-sm text-gray-600",children:[r.length," of ",s.length," teachers selected"]})})]})]})},Q3=({mission:s})=>{const e=s;return c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},className:"bg-white rounded-2xl shadow-xl overflow-hidden max-w-4xl mx-auto",children:c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"h-64 bg-gradient-to-r from-primary-500 to-secondary-500 flex items-center justify-center relative",style:{backgroundImage:e.banner_image?`url(${e.banner_image})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[c.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40"}),c.jsxs("div",{className:"text-center text-white relative z-10",children:[c.jsx("h2",{className:"text-4xl font-bold mb-4",children:e.title}),c.jsx("div",{className:"w-16 h-1 bg-white mx-auto rounded-full"})]})]}),c.jsx("div",{className:"p-8 md:p-12",children:c.jsx("div",{className:"max-w-3xl mx-auto text-center",children:c.jsx("p",{className:"text-lg text-neutral-600 leading-relaxed",children:e.content})})})]})})},Z3=({courses:s=[],title:e="Our Courses",subtitle:t="Choose from our wide range of language courses designed to meet your learning goals"})=>{const[n,r]=S.useState(0),[i,a]=S.useState(!1),o=()=>{r(h=>(h+1)%s.length)},l=()=>{r(h=>(h-1+s.length)%s.length)};if(!s||s.length===0)return c.jsxs("div",{className:"text-center py-12",children:[c.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-4",children:e}),c.jsx("p",{className:"text-neutral-600",children:"No courses available at the moment."})]});const u=s[n];return c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-4",children:e}),c.jsx("p",{className:"text-neutral-600 mb-8 max-w-2xl mx-auto",children:t}),c.jsxs("div",{className:"max-w-4xl mx-auto",children:[c.jsxs(Q.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.5},className:"relative bg-white rounded-2xl shadow-xl overflow-hidden cursor-pointer",onClick:()=>a(!0),children:[c.jsxs("div",{className:"h-80 bg-gradient-to-r from-primary-500 to-secondary-500 relative",style:{backgroundImage:u.background_image?`url(${u.background_image})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[c.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("h3",{className:"text-4xl font-bold mb-4",children:u.name}),c.jsx("p",{className:"text-xl max-w-2xl mx-auto px-4",children:u.description})]})})]}),c.jsx("button",{onClick:h=>{h.stopPropagation(),l()},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-full transition-all duration-200 clickable",title:"Previous course",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx("button",{onClick:h=>{h.stopPropagation(),o()},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-full transition-all duration-200 clickable",title:"Next course",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),c.jsxs("div",{className:"absolute bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm",children:[n+1," / ",s.length]})]},n),s.length>1&&c.jsx("div",{className:"flex justify-center mt-6 space-x-2",children:s.map((h,f)=>c.jsx("button",{onClick:()=>r(f),className:`w-3 h-3 rounded-full transition-all duration-200 ${f===n?"bg-primary-500":"bg-gray-300 hover:bg-gray-400"}`,title:`View course ${f+1}: ${s[f].name}`},f))}),c.jsx(Cs,{children:i&&c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>a(!1),children:c.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto",onClick:h=>h.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-start mb-6",children:[c.jsx("h3",{className:"text-3xl font-bold text-neutral-800",children:u.name}),c.jsx("button",{onClick:()=>a(!1),className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("p",{className:"text-lg text-neutral-600",children:u.description}),c.jsx("p",{className:"text-neutral-700 leading-relaxed",children:u.detailed_description})]}),c.jsx("div",{className:"mt-8 flex justify-end",children:c.jsx("button",{onClick:()=>a(!1),className:"btn-primary",children:"Close"})})]})})})]})]})},ou={title:"Welcome to RioTalk",subtitle:"Master English Language with our experienced teachers and innovative teaching methods",teacherShowcaseTitle:"Meet Our Teachers",teacherShowcaseSubtitle:"Our experienced and passionate teachers are here to help you achieve your language learning goals",coursesTitle:"Our Courses",coursesSubtitle:"Choose from our wide range of language courses designed to meet your learning goals"},ri={info:(s,e,t)=>console.log(`[${s}] ${e}`,t||""),warning:(s,e,t)=>console.warn(`[${s}] ${e}`,t||""),error:(s,e,t)=>console.error(`[${s}] ${e}`,t||""),success:(s,e,t)=>console.log(`✅ [${s}] ${e}`,t||""),debug:(s,e,t)=>console.log(`🐛 [${s}] ${e}`,t||""),enable:()=>console.log("Debug enabled")},e$=()=>{const{login:s,user:e}=Bm(),t=lN(),[n,r]=S.useState(""),[i,a]=S.useState([]),[o,l]=S.useState(null),[u,h]=S.useState([]),[f,p]=S.useState(!0);S.useEffect(()=>{m()},[]);const m=async()=>{try{p(!0);const y=await te.getShowcaseSettingsPublic(),b=y.success?y.settings.display_count:3,[v,x,w]=await Promise.all([te.getRandomTeachers(b),te.getMissionContent(),te.getCourses()]);v.success?a(v.teachers):a([{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience. Specializes in business English and conversation practice.",photo_url:"/pics/teachers/sarah.jpg"},{id:2,name:"Michael Chen",description:"Native Mandarin speaker teaching Chinese language and culture. Patient and encouraging teaching style.",photo_url:"/pics/teachers/michael.jpg"},{id:3,name:"Elena Rodriguez",description:"Spanish teacher from Madrid with expertise in grammar and pronunciation. Loves teaching through music and culture.",photo_url:"/pics/teachers/elena.jpg"}]),x.success?l(x.mission):l({title:"Our Mission",content:"At Rio talk, we believe that language learning should be engaging, practical, and accessible to everyone. Our mission is to break down language barriers and connect people across cultures through innovative teaching methods, experienced instructors, and a supportive learning environment.",banner_image:"/pics/banners/mission-banner.jpg"}),w.success?h(w.courses):h([{id:1,name:"English for Beginners",description:"Start your English learning journey with our comprehensive beginner course.",background_image:"/pics/courses/english-beginner.jpg",detailed_description:"Our English for Beginners course is designed to take you from zero to conversational level in just 6 months."},{id:2,name:"Business English Mastery",description:"Advanced business communication skills for professionals.",background_image:"/pics/courses/business-english.jpg",detailed_description:"Master the art of professional communication with our Business English course."},{id:3,name:"Spanish Conversation Club",description:"Improve your speaking skills through interactive conversations.",background_image:"/pics/courses/spanish-conversation.jpg",detailed_description:"Join our dynamic Spanish Conversation Club for engaging discussions."}])}catch(y){console.error("Error fetching data:",y),a([{id:1,name:"Sarah Johnson",description:"Experienced English teacher with 10+ years of experience.",photo_url:"/pics/teachers/sarah.jpg"}]),l({title:"Our Mission",content:"At Rio talk, we believe that language learning should be engaging, practical, and accessible to everyone.",banner_image:"/pics/banners/mission-banner.jpg"}),h([{id:1,name:"English for Beginners",description:"Start your English learning journey.",background_image:"/pics/courses/english-beginner.jpg",detailed_description:"Learn English from zero to conversational level."}])}finally{p(!1)}};S.useEffect(()=>{e&&(ri.info("LOGIN_PAGE","User logged in, navigating to dashboard",{role:e.role,userId:e.id}),e.role==="admin"?(ri.success("LOGIN_PAGE","Navigating to admin dashboard"),t("/admin")):e.role==="teacher"&&(ri.success("LOGIN_PAGE","Navigating to teacher dashboard"),t("/teacher")))},[e,t]);const g=async(y,b)=>{if(ri.info("LOGIN_PAGE","handleLogin called",{username:y,hasPassword:!!b,loginFunction:typeof s}),r(""),!s||typeof s!="function"){ri.error("LOGIN_PAGE","Login function not available from useAuth",{login:s,type:typeof s}),r("Login function not available");return}try{ri.info("LOGIN_PAGE","Calling login function from AuthContext",{username:y});const v=await s(y,b);ri.info("LOGIN_PAGE","Login result received",{result:v,success:v==null?void 0:v.success,error:v==null?void 0:v.error}),v.success?ri.success("LOGIN_PAGE","Login successful, waiting for user state update",{username:y,result:v}):(ri.warning("LOGIN_PAGE","Login failed",{error:v.error,username:y}),r(v.error))}catch(v){ri.error("LOGIN_PAGE","Login function threw error",{error:v.message,stack:v.stack,username:y}),r(v.message||"Login failed")}};return f?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50 flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50",children:[c.jsx(J3,{onLogin:g,loginError:n}),c.jsxs("div",{className:"w-full px-4 py-8",children:[c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-12 mx-auto",children:[c.jsx("h1",{className:"text-5xl font-bold text-neutral-800 mb-4",children:ou.title}),c.jsx("p",{className:"text-xl text-neutral-600 max-w-2xl mx-auto",children:ou.subtitle})]}),c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-16 mx-auto",children:c.jsx(I2,{teachers:i,title:ou.teacherShowcaseTitle,subtitle:ou.teacherShowcaseSubtitle})}),o&&c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"mb-16 mx-auto",children:c.jsx(Q3,{mission:o})}),u.length>0&&c.jsx(Q.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},className:"mx-auto",children:c.jsx(Z3,{courses:u,title:ou.coursesTitle,subtitle:ou.coursesSubtitle})})]})]})},t$=()=>{const[s,e]=S.useState([]),[t,n]=S.useState({}),[r,i]=S.useState({}),[a,o]=S.useState(new Set),[l,u]=S.useState(!0),[h,f]=S.useState(!1),[p,m]=S.useState(""),[g,y]=S.useState(new Date),[b,v]=S.useState(null),[x,w]=S.useState([]),[E,T]=S.useState(!1),[C,N]=S.useState({});S.useEffect(()=>{(async()=>{try{u(!0),m("");const O=await te.getTeachers();if(O.success)console.log("🔍 [TEACHERS_TABLE] Teachers data:",O.teachers.map(Y=>({id:Y.id,name:Y.name,student_count:Y.student_count}))),O.teachers.forEach(Y=>{console.log(`🔍 [TEACHER] ${Y.name} (ID: ${Y.id}): ${Y.student_count||0} students`)}),e(O.teachers||[]);else throw new Error(O.error||"Failed to load teachers")}catch(O){console.error("Error fetching teachers:",O),m(`Failed to load teachers: ${O.message}`),e([])}finally{u(!1)}})()},[]);const j=async I=>{if(!r[I])try{const O=await te.getTeacherStudents(I);O.success&&i(Y=>({...Y,[I]:O.students||[]}))}catch(O){console.error(`Error fetching students for teacher ${I}:`,O)}},R=async I=>{const O=new Set;a.has(I)||(O.add(I),await j(I)),o(O)},D=I=>I?new Date(I).toLocaleDateString():"",z=I=>{const O=I.getFullYear(),Y=I.getMonth(),F=new Date(O,Y,1),B=new Date(O,Y+1,0),M=[];let $=new Date(F),K=1;const J=F.getDay(),Z=J===0?-6:1-J;for($.setDate(F.getDate()+Z);$<=B;){const pe=new Date($);pe.setDate($.getDate()+6),pe>=F&&$<=B&&M.push({weekNumber:K,start:$.getFullYear()+"-"+String($.getMonth()+1).padStart(2,"0")+"-"+String($.getDate()).padStart(2,"0"),end:pe.getFullYear()+"-"+String(pe.getMonth()+1).padStart(2,"0")+"-"+String(pe.getDate()).padStart(2,"0"),label:`${$.getDate()}-${pe.getDate()} ${I.toLocaleString("default",{month:"short"})}`}),$.setDate($.getDate()+7),K++}return M},L=I=>{if(b){const F=C[I];if(!F)return console.log(`🔍 [GET_LESSON_COUNT] No monthly stats for teacher ${I}`),0;const B=b.start;console.log(`🔍 [GET_LESSON_COUNT] Looking for week ${B} in teacher ${I} stats:`,F);for(const[M,$]of Object.entries(F)){const K=new Date(M),J=K.getFullYear()+"-"+String(K.getMonth()+1).padStart(2,"0")+"-"+String(K.getDate()).padStart(2,"0");if(J===B)return console.log(`🔍 [GET_LESSON_COUNT] Found matching week ${M} (${J}):`,$),$.total_lessons||0}return console.log(`🔍 [GET_LESSON_COUNT] No matching week found for ${B}`),0}const O=C[I];if(!O)return 0;let Y=0;return Object.values(O).forEach(F=>{Y+=F.total_lessons||0}),Y};return S.useEffect(()=>{const I=z(g);w(I),v(null),(async()=>{try{f(!0);const Y=g.getMonth()+1,F=g.getFullYear();console.log("🔍 [TEACHERS_TABLE] Fetching monthly stats for:",F,Y);const B=await te.getMonthlyLessonStats(Y,F);if(B.success){const M={};B.monthlyStats.forEach($=>{const K=$.teacher_id,J=$.week_start_date;M[K]||(M[K]={}),M[K][J]={completed_lessons:Number($.completed_lessons),absent_lessons:Number($.absent_lessons),total_lessons:Number($.completed_lessons)+Number($.absent_lessons)}}),N(M),console.log("🔍 [TEACHERS_TABLE] Monthly stats loaded:",M)}}catch(Y){console.error("Error fetching monthly stats:",Y)}finally{f(!1)}})()},[g]),l?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"})}):p?c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-4",children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-error text-sm mb-4",children:p}),c.jsx("button",{onClick:()=>window.location.reload(),className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Retry"})]})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-4 sm:p-6",children:[c.jsxs("div",{className:"mb-4 sm:mb-6",children:[c.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-neutral-800 mb-4",children:"Teachers Overview"}),c.jsxs("div",{className:"flex items-center justify-start space-x-2 sm:space-x-4",children:[c.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[c.jsx("button",{onClick:()=>y(I=>new Date(I.getFullYear(),I.getMonth()-1)),className:"px-2 py-1 sm:px-3 sm:py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"←"}),c.jsx("h3",{className:"text-sm sm:text-lg font-semibold text-gray-800",children:g.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),c.jsx("button",{onClick:()=>y(I=>new Date(I.getFullYear(),I.getMonth()+1)),className:"px-2 py-1 sm:px-3 sm:py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors text-sm sm:text-base",children:"→"})]}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>T(!E),className:"px-2 py-1 sm:px-3 sm:py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-xs sm:text-sm",children:b?b.label:"All Weeks"}),E&&c.jsxs("div",{className:"absolute mt-1 bg-white border rounded shadow-lg z-10 min-w-64 right-0",children:[c.jsx("button",{onClick:()=>{v(null),T(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:"All Weeks"}),x.map((I,O)=>c.jsxs("button",{onClick:()=>{console.log("🔍 [WEEK_SELECT] Selected week:",I),v(I),T(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:["Week ",I.weekNumber,": ",new Date(I.start).toLocaleDateString()," - ",new Date(I.end).toLocaleDateString()]},O))]})]})]}),b&&c.jsxs("p",{className:"text-xs sm:text-base text-neutral-600 mt-2",children:["Showing lessons for week: ",b.label,h&&c.jsx("span",{className:"ml-2 text-primary-600",children:"(Filtering...)"})]})]}),c.jsx("div",{className:"w-full",children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"w-full min-w-[320px]",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"border-b border-neutral-200",children:[c.jsx("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/3 sm:w-auto",children:"Teacher"}),c.jsxs("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/6 sm:w-1/4",children:[c.jsx("span",{className:"sm:hidden",children:"s"}),c.jsx("span",{className:"hidden sm:inline",children:"Students"})]}),c.jsxs("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/6 sm:w-1/6",children:[c.jsx("span",{className:"sm:hidden",children:"l"}),c.jsx("span",{className:"hidden sm:inline",children:"Lessons"})]}),c.jsx("th",{className:"text-left py-2 px-2 sm:py-3 sm:px-3 font-semibold text-xs sm:text-sm text-neutral-700 w-1/3 sm:w-auto",children:"Actions"})]})}),c.jsx("tbody",{children:s.map(I=>{t[I.id];const O=a.has(I.id);return r[I.id],c.jsxs(Q.tr,{className:"border-b border-neutral-100 hover:bg-neutral-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:[c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-neutral-800 truncate",children:I.name})}),c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-neutral-600",children:I.student_count||0})}),c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-neutral-600",children:L(I.id)})}),c.jsx("td",{className:"py-1 px-2 sm:py-2 sm:px-3",children:c.jsxs("button",{onClick:()=>R(I.id),className:"inline-flex items-center px-1.5 py-1 sm:px-2 sm:py-1.5 border border-neutral-300 rounded text-xs sm:text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 focus:outline-none focus:ring-1 focus:ring-primary-500 w-auto justify-center sm:justify-start",children:[c.jsx("span",{className:"hidden sm:inline",children:O?"Hide Students":"Show Students"}),c.jsx("span",{className:"sm:hidden",children:O?"Hide":"Show"}),c.jsx(Q.svg,{className:"ml-0.5 sm:ml-1 w-2.5 h-2.5 sm:w-3 sm:h-3",animate:{rotate:O?180:0},transition:{duration:.2},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]},I.id)})})]})})}),c.jsx(Cs,{children:s.map(I=>{const O=a.has(I.id),Y=r[I.id]||[];return O?c.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t border-neutral-200 bg-neutral-50",children:c.jsxs("div",{className:"p-3 sm:p-6",children:[c.jsxs("h4",{className:"text-base sm:text-lg font-semibold text-neutral-800 mb-3 sm:mb-4",children:["Students for ",I.name]}),Y.length===0?c.jsxs("div",{className:"text-center py-6 sm:py-8 text-neutral-500",children:[c.jsx("div",{className:"mb-3 sm:mb-4",children:c.jsx("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-sm sm:text-base",children:"No students assigned to this teacher"})]}):c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:Y.map(F=>c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},className:"bg-white rounded-lg border border-neutral-200 p-3 sm:p-4 hover:shadow-md transition-shadow",children:c.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[c.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-secondary-100 flex items-center justify-center flex-shrink-0",children:c.jsx("span",{className:"text-xs font-semibold text-secondary-700",children:F.name.split(" ").map(B=>B[0]).join("")})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-neutral-800 text-sm sm:text-base truncate",children:F.name}),c.jsxs("div",{className:"text-xs sm:text-sm text-neutral-500",children:[F.lessons_per_week," lessons/week (auto)"]}),c.jsxs("div",{className:"text-xs text-neutral-400",children:["Added: ",D(F.added_date)]})]})]})},F.id))})]})},`students-${I.id}`):null})}),s.length===0&&!l&&c.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-neutral-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-lg font-medium mb-2",children:"No teachers found"}),c.jsx("p",{className:"text-sm text-neutral-400",children:"There are no teachers in the database yet."})]})]})},s$=hN("photos").then(s=>(s.maxBytes=500*1024*1024,console.log("🖼️ [PHOTO_CACHE] Initialized photo cache with 500MB limit"),s)).catch(s=>{throw console.error("❌ [PHOTO_CACHE] Failed to initialize photo cache:",s),s}),DA="photo_metadata";class n${constructor(){this.cache=null,this.metadata=new Map}async init(){this.cache=await s$,await this.loadMetadata()}async loadMetadata(){try{const e=await this.cache.get(DA);e&&(this.metadata=new Map(e),console.log(`🖼️ [PHOTO_CACHE] Loaded metadata for ${this.metadata.size} photos`))}catch(e){console.warn("Failed to load photo metadata:",e),this.metadata=new Map}}async saveMetadata(){try{await this.cache.set(DA,Array.from(this.metadata.entries()))}catch(e){console.warn("Failed to save photo metadata:",e)}}getPhotoKey(e,t){return`photo:${t||this.extractFileId(e)}`}extractFileId(e){try{const t=e.match(/\/([^\/]+)\.(jpg|jpeg|png|gif|webp|svg)$/i);return t?t[1]:e.split("/").pop()}catch{return e.split("/").pop()}}needsFetch(e,t){const n=this.getPhotoKey(e,t),r=this.metadata.get(n);if(!r)return console.log(`🖼️ [PHOTO_CACHE] Photo not cached: ${n}`),!0;if(r.url!==e)return console.log(`🖼️ [PHOTO_CACHE] Photo URL changed: ${n}`),!0;const i=Date.now()-7*24*60*60*1e3;return r.cachedAt<i?(console.log(`🖼️ [PHOTO_CACHE] Photo is old, refreshing: ${n}`),!0):(console.log(`🖼️ [PHOTO_CACHE] Photo is cached and up-to-date: ${n}`),!1)}async getCachedPhoto(e,t){this.cache||await this.init();const n=this.getPhotoKey(e,t);if(!this.metadata.get(n))return null;try{const i=await this.cache.get(n);if(i)return console.log(`✅ [PHOTO_CACHE] Retrieved cached photo: ${n}`),i}catch(i){console.warn(`Failed to get cached photo ${n}:`,i)}return null}async cachePhoto(e,t,n){this.cache||await this.init();const r=this.getPhotoKey(e,t);try{return await this.cache.set(r,n),this.metadata.set(r,{url:e,fileId:t,cachedAt:Date.now(),size:n.length||0}),await this.saveMetadata(),console.log(`💾 [PHOTO_CACHE] Cached photo: ${r} (${n.length||0} bytes)`),!0}catch(i){return console.error(`Failed to cache photo ${r}:`,i),!1}}async getPhoto(e,t,n=!1){if(this.cache||await this.init(),!n&&!this.needsFetch(e,t)){const r=await this.getCachedPhoto(e,t);if(r)return r}try{console.log(`🌐 [PHOTO_CACHE] Fetching photo: ${e}`);const r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch photo: ${r.status}`);const i=await r.arrayBuffer(),a=new Uint8Array(i);return await this.cachePhoto(e,t,a),a}catch(r){console.error(`Failed to fetch photo ${e}:`,r);const i=await this.getCachedPhoto(e,t);if(i)return console.log(`🔄 [PHOTO_CACHE] Using cached fallback for: ${e}`),i;throw r}}createBlobUrl(e){if(!e)return null;const t=new Blob([e]);return URL.createObjectURL(t)}revokeBlobUrl(e){e&&URL.revokeObjectURL(e)}async getStats(){return this.cache||await this.init(),{photoCount:this.metadata.size,totalSize:Array.from(this.metadata.values()).reduce((e,t)=>e+(t.size||0),0),oldestPhoto:Math.min(...Array.from(this.metadata.values()).map(e=>e.cachedAt)),newestPhoto:Math.max(...Array.from(this.metadata.values()).map(e=>e.cachedAt))}}}const Oi=new n$;function r$(s,e,t={}){const[n,r]=S.useState(null),[i,a]=S.useState(null),[o,l]=S.useState(!1),[u,h]=S.useState(null),[f,p]=S.useState(!1),m=S.useRef(null),{forceRefresh:g=!1,autoLoad:y=!0,onLoad:b=null,onError:v=null}=t;S.useEffect(()=>()=>{m.current&&Oi.revokeBlobUrl(m.current)},[s]);const x=async()=>{if(s){l(!0),h(null);try{const T=Oi.needsFetch(s,e);p(!T);const C=await Oi.getPhoto(s,e,g);if(C){r(C);const N=Oi.createBlobUrl(C);m.current&&Oi.revokeBlobUrl(m.current),m.current=N,a(N),b&&b(C,N)}}catch(T){console.error("Failed to load photo:",T),h(T.message),v&&v(T)}finally{l(!1)}}};return S.useEffect(()=>{y&&s&&x()},[s,e,g,y]),{photoData:n,blobUrl:i,loading:o,error:u,isCached:f,refresh:()=>{x()},clearCache:async()=>{if(s&&e){const T=Oi.getPhotoKey(s,e);await Oi.cache.remove(T),Oi.metadata.delete(T),await Oi.saveMetadata(),p(!1)}},loadPhoto:x}}const i$=({src:s,fileId:e,alt:t="",className:n="",style:r={},fallback:i=null,onLoad:a=null,onError:o=null,...l})=>{const[u,h]=S.useState(!1),{blobUrl:f,loading:p,error:m}=r$(s,e,{forceRefresh:!1,onLoad:(y,b)=>{h(!1),a&&a(y,b)},onError:y=>{h(!0),o&&o(y)}});return f&&!p&&!m?c.jsx("img",{src:f,alt:t,className:n,style:r,...l}):i||c.jsx("div",{className:`flex items-center justify-center bg-gray-100 ${n}`,style:r,children:c.jsx("div",{className:"flex flex-col items-center space-y-2 text-center",children:c.jsx("div",{className:"w-8 h-8 text-gray-400",children:c.jsx("svg",{className:"w-full h-full",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})})})})},a$=({selectedTeacher:s,onTeacherSelect:e,onTeachersLoaded:t})=>{const[n,r]=S.useState([]),[i,a]=S.useState(!0),[o,l]=S.useState(""),[u,h]=S.useState("management"),[f,p]=S.useState(!1),m=()=>{const g=document.getElementById("teachers-scroll-container");if(g){const y=g.scrollWidth>g.clientWidth;p(y)}};return S.useEffect(()=>{(async()=>{try{a(!0),l(""),console.log("🔍 [TEACHER_TABS] Fetching teachers...");const y=new Promise((v,x)=>setTimeout(()=>x(new Error("Request timeout")),1e4)),b=await Promise.race([te.getTeachers(),y]);if(console.log("📋 [TEACHER_TABS] Teachers response:",b),console.log("📋 [TEACHER_TABS] Response type:",typeof b),console.log("📋 [TEACHER_TABS] Response success:",b.success),console.log("📋 [TEACHER_TABS] Response teachers:",b.teachers),b.success){const v=b.teachers||[];r(v),console.log("✅ [TEACHER_TABS] Teachers loaded successfully:",v.length),t&&t(v),v.length===0&&console.log("⚠️ [TEACHER_TABS] No teachers found in database")}else throw new Error(b.error||"Failed to load teachers")}catch(y){console.error("❌ [TEACHER_TABS] Error fetching teachers:",y),y.message.includes("Backend server not available")||y.message.includes("fetch")||y.message.includes("NetworkError")||y.message.includes("Failed to fetch")?l("Backend server is not available. Please check if the development server is running and environment variables are configured."):y.message.includes("Request timeout")?l("Request timed out. The server may be slow or unresponsive."):l(`Failed to load teachers: ${y.message}`),r([])}finally{a(!1)}})()},[]),S.useEffect(()=>{if(n.length>0){const g=setTimeout(m,100);return()=>clearTimeout(g)}},[n]),S.useEffect(()=>{const g=()=>{m()};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),c.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200",children:[c.jsx("style",{jsx:!0,children:`
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-top {
          scrollbar-width: thin;
          scrollbar-color: #d1d5db transparent;
        }
        .scrollbar-top::-webkit-scrollbar {
          height: 6px;
          display: block;
        }
        .scrollbar-top::-webkit-scrollbar-track {
          background: transparent;
        }
        .scrollbar-top::-webkit-scrollbar-thumb {
          background-color: #d1d5db;
          border-radius: 3px;
        }
        .scrollbar-top::-webkit-scrollbar-thumb:hover {
          background-color: #9ca3af;
        }
      `}),c.jsx("div",{className:"border-b border-neutral-200",children:c.jsxs("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:[c.jsx("button",{onClick:()=>h("management"),className:`py-4 px-1 border-b-2 font-medium text-sm ${u==="management"?"border-primary-500 text-primary-600":"border-transparent text-neutral-500 hover:text-neutral-700 hover:border-neutral-300"}`,children:"Teacher Management"}),c.jsx("button",{onClick:()=>h("overview"),className:`py-4 px-1 border-b-2 font-medium text-sm ${u==="overview"?"border-primary-500 text-primary-600":"border-transparent text-neutral-500 hover:text-neutral-700 hover:border-neutral-300"}`,children:"Lesson Overview"})]})}),c.jsxs("div",{className:"p-6",children:[u==="management"&&c.jsx("div",{children:i?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"})}):o?c.jsx("div",{children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-error text-sm mb-4 max-w-md mx-auto",children:o}),c.jsxs("div",{className:"text-xs text-neutral-500 mb-4 max-w-md mx-auto",children:[c.jsx("strong",{children:"Development Setup:"}),c.jsx("br",{}),"1. Create a ",c.jsx("code",{children:".env"})," file with required environment variables",c.jsx("br",{}),"2. Run ",c.jsx("code",{children:"npm run netlify:dev"})," to start the backend server",c.jsx("br",{}),"3. Ensure database connection is configured"]}),c.jsxs("div",{className:"flex gap-2 justify-center",children:[c.jsx("button",{onClick:()=>window.location.reload(),className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Retry"}),c.jsx("button",{onClick:()=>{l(""),a(!0),window.location.reload()},className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Refresh"})]})]})}):c.jsxs("div",{children:[c.jsxs("div",{className:"relative flex items-center",children:[c.jsx("button",{onClick:()=>{const g=document.getElementById("teachers-scroll-container");g&&g.scrollBy({left:-150,behavior:"smooth"})},className:"lg:hidden p-1.5 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors mr-2 flex-shrink-0",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx("div",{id:"teachers-scroll-container",className:`flex space-x-1 sm:space-x-2 overflow-x-auto pb-2 flex-1 ${f?"scrollbar-top":"scrollbar-hide"}`,style:{scrollbarWidth:f?"thin":"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:n.map((g,y)=>c.jsx(Q.button,{onClick:()=>e(g),className:`flex-shrink-0 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 min-w-[120px] sm:min-w-0 ${(s==null?void 0:s.id)===g.id?"bg-primary-500 text-white shadow-md":"bg-neutral-100 text-neutral-700 hover:bg-primary-100 hover:text-primary-700"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:y*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:c.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[c.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-neutral-200 flex items-center justify-center overflow-hidden",children:g.photo_url?c.jsx(i$,{src:g.photo_url,fileId:`teacher-${g.id}`,alt:g.name,className:"w-full h-full object-cover",fallback:c.jsx("span",{className:"text-xs font-semibold text-neutral-600",children:g.name.split(" ").map(b=>b[0]).join("")})}):c.jsx("span",{className:"text-xs font-semibold text-neutral-600",children:g.name.split(" ").map(b=>b[0]).join("")})}),c.jsx("span",{className:"whitespace-nowrap text-xs sm:text-sm",children:g.name}),g.student_count>0&&c.jsx("span",{className:"bg-primary-100 text-primary-700 text-xs px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full",children:g.student_count})]})},g.id))}),c.jsx("button",{onClick:()=>{const g=document.getElementById("teachers-scroll-container");g&&g.scrollBy({left:150,behavior:"smooth"})},className:"lg:hidden p-1.5 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors ml-2 flex-shrink-0",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),n.length===0&&!i&&c.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-neutral-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-lg font-medium mb-2",children:"No teachers found"}),c.jsx("p",{className:"text-sm text-neutral-400 mb-4",children:"There are no teachers in the database yet."}),c.jsx("button",{onClick:()=>window.location.reload(),className:"text-primary-600 hover:text-primary-700 text-sm underline",children:"Refresh"})]})]})}),u==="overview"&&c.jsx("div",{children:c.jsx(t$,{})})]})]})},O2=(s,e="short")=>{if(!s)return"";const t=new Date(s);if(isNaN(t.getTime()))return"";const n={short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric"},time:{hour:"2-digit",minute:"2-digit"},datetime:{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}};return t.toLocaleDateString("en-US",n[e]||n.short)},Vc=()=>{const s=new Date,e=s.getFullYear(),t=s.getMonth(),n=s.getDate(),r=new Date(e,t,n),i=r.getDay(),a=`${e}-${String(t+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`;console.log("🔍 [getCurrentWeekStart] Today:",a),console.log("🔍 [getCurrentWeekStart] Day of week:",i);const o=i===0?6:i-1;console.log("🔍 [getCurrentWeekStart] Days to Monday:",o);const l=new Date(r);l.setDate(r.getDate()-o);const u=l.getFullYear(),h=l.getMonth(),f=l.getDate(),p=`${u}-${String(h+1).padStart(2,"0")}-${String(f).padStart(2,"0")}`;return console.log("🔍 [getCurrentWeekStart] Calculated Monday:",p),p},MA=s=>{const e=new Date(s),t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=new Date(t,n,r),a=i.getDay(),o=a===0?6:a-1,l=new Date(i);l.setDate(i.getDate()-o);const u=l.getFullYear(),h=l.getMonth(),f=l.getDate();return`${u}-${String(h+1).padStart(2,"0")}-${String(f).padStart(2,"0")}`},L_=s=>{const e=new Date(s),t=[];for(let n=0;n<7;n++){const r=new Date(e);r.setDate(e.getDate()+n),t.push(r)}return t},F2=(s,e)=>{const t=new Date(s);return t.setDate(t.getDate()+e),t.toISOString().split("T")[0]},$2=(s,e)=>{const t=new Date(s);return t.setDate(t.getDate()-e),t.toISOString().split("T")[0]},U2=()=>{const s=new Date;return{year:s.getFullYear(),month:s.getMonth()+1,name:s.toLocaleDateString("en-US",{month:"long"})}},o$=(s,e,t)=>{const n=new Date(s),r=n.getMonth()+1,i=n.getFullYear();if(r!==e||i!==t)return null;const o=new Date(t,e-1,1).getDay(),l=n.getDate();return Math.ceil((l+o)/7)},cv=(s,e,t)=>{const n=L_(s);if(!n.some(l=>l.getMonth()+1===e&&l.getFullYear()===t))return{weekNumber:null,isCurrentMonth:!1,days:n.map(l=>({date:l,isCurrentMonth:!1,isEditable:!0}))};const i=n.find(l=>l.getMonth()+1===e&&l.getFullYear()===t),a=o$(i,e,t),o=n.map(l=>{const u=l.getMonth()+1===e&&l.getFullYear()===t;return{date:l,isCurrentMonth:u,isEditable:!0}});return{weekNumber:a,isCurrentMonth:!0,days:o}},l$=(s,e)=>{const t=Vc();return cv(t,s,e)},B2=(s,e,t)=>{const n=cv(s,e,t);if(!n.isCurrentMonth)return{weekNumber:null,weekLabel:"Other Month",isCurrentWeek:!1};l$(e,t);const r=s===Vc();return{weekNumber:n.weekNumber,weekLabel:`Week ${n.weekNumber}`,isCurrentWeek:r}},gx="schedule_draft_changes",_s={getDraftChanges(){try{const s=localStorage.getItem(gx);return s?JSON.parse(s):null}catch(s){return console.error("Error loading draft changes:",s),null}},saveDraftChanges(s){try{const e={...s,hasUnsavedChanges:!0,lastModified:new Date().toISOString()};return localStorage.setItem(gx,JSON.stringify(e)),!0}catch(e){return console.error("Error saving draft changes:",e),!1}},clearDraftChanges(){try{return localStorage.removeItem(gx),!0}catch(s){return console.error("Error clearing draft changes:",s),!1}},hasUnsavedChanges(){const s=this.getDraftChanges();return s&&s.hasUnsavedChanges},initializeDraft(s,e){const t={teacherId:s,weekStart:e,additions:[],deletions:[],modifications:[],hasUnsavedChanges:!1,lastModified:new Date().toISOString()};return this.saveDraftChanges(t),t},addLesson(s){const e=this.getDraftChanges()||this.initializeDraft(s.teacherId,s.weekStart),t=e.additions.find(n=>n.dayOfWeek===s.dayOfWeek&&n.timeSlot===s.timeSlot);return t?Object.assign(t,s):e.additions.push({id:`temp_${Date.now()}_${Math.random()}`,...s,type:"addition"}),this.saveDraftChanges(e),e},deleteLesson(s,e){let t=this.getDraftChanges();return t||(t=this.initializeDraft(e.teacherId,e.weekStart)),t.additions=t.additions.filter(n=>n.dayOfWeek!==e.dayOfWeek||n.timeSlot!==e.timeSlot),t.deletions.push({scheduleId:s,...e,type:"deletion"}),this.saveDraftChanges(t),t},getChangesForTeacherWeek(s,e){const t=this.getDraftChanges();return!t||t.teacherId!==s||t.weekStart!==e?null:t},applyDraftToSchedule(s,e,t){const n=this.getChangesForTeacherWeek(e,t);if(!n)return s;let r=[...s];return n.deletions.forEach(i=>{r=r.filter(a=>!(a.day_of_week===i.dayOfWeek&&a.time_slot===i.timeSlot))}),n.additions.forEach(i=>{const a={id:i.id,student_id:i.studentId,student_name:i.studentName,teacher_id:i.teacherId,day_of_week:i.dayOfWeek,time_slot:i.timeSlot,week_start_date:i.weekStart,attendance_status:"scheduled",is_draft:!0};r.push(a)}),r},getChangesSummary(){const s=this.getDraftChanges();return s?{additions:s.additions.length,deletions:s.deletions.length,modifications:s.modifications.length,total:s.additions.length+s.deletions.length+s.modifications.length,lastModified:s.lastModified}:null}},H2=({isOpen:s,onClose:e,onSave:t,onDiscard:n,pendingAction:r,changesSummary:i})=>{if(!s)return null;const a=()=>{t(),e()},o=()=>{n(),e()};return c.jsx(Cs,{children:c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 shadow-xl",children:[c.jsxs("div",{className:"flex items-center mb-4",children:[c.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3",children:c.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Unsaved Changes"})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-gray-600 mb-3",children:"You have unsaved changes to the schedule. What would you like to do?"}),i&&c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Pending Changes:"}),c.jsxs("div",{className:"flex space-x-4 text-sm text-gray-600",children:[i.additions>0&&c.jsxs("span",{className:"flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1"}),i.additions," additions"]}),i.deletions>0&&c.jsxs("span",{className:"flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),i.deletions," deletions"]}),i.modifications>0&&c.jsxs("span",{className:"flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-1"}),i.modifications," modifications"]})]})]}),r&&c.jsxs("p",{className:"text-sm text-gray-500",children:[c.jsx("strong",{children:"Next action:"})," ",r]})]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Discard Changes"}),c.jsx("button",{onClick:a,className:"flex-1 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:"Save & Continue"}),c.jsx("button",{onClick:e,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Cancel"})]})]})})})};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c$=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),u$=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),IA=s=>{const e=u$(s);return e.charAt(0).toUpperCase()+e.slice(1)},V2=(...s)=>s.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),d$=s=>{for(const e in s)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var h$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f$=S.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:i,iconNode:a,...o},l)=>S.createElement("svg",{ref:l,...h$,width:e,height:e,stroke:s,strokeWidth:n?Number(t)*24/Number(e):t,className:V2("lucide",r),...!i&&!d$(o)&&{"aria-hidden":"true"},...o},[...a.map(([u,h])=>S.createElement(u,h)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uv=(s,e)=>{const t=S.forwardRef(({className:n,...r},i)=>S.createElement(f$,{ref:i,iconNode:e,className:V2(`lucide-${c$(IA(s))}`,`lucide-${s}`,n),...r}));return t.displayName=IA(s),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p$=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],m$=uv("clock",p$);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],y$=uv("user-plus",g$);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],x$=uv("users",v$);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w$=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],b$=uv("x",w$),S$=({isOpen:s,onClose:e,onSelect:t,teacherId:n,teacherName:r})=>{const[i,a]=S.useState([]),[o,l]=S.useState([]),[u,h]=S.useState([]),[f,p]=S.useState(!1),[m,g]=S.useState(""),[y,b]=S.useState(""),[v,x]=S.useState("current");S.useEffect(()=>{s&&n&&w()},[s,n]);const w=async()=>{try{p(!0),g("");const[R,D,z]=await Promise.all([te.getCurrentStudents(n),te.getHistoryStudents(n),te.getStudents({status:"active"})]);R.success&&a(R.students||[]),D.success&&l(D.students||[]),z.success&&h(z.students||[])}catch(R){console.error("Error fetching student suggestions:",R),g("Failed to load student suggestions")}finally{p(!1)}},E=R=>{t(R),e()},T=R=>y?R.filter(D=>D.name.toLowerCase().includes(y.toLowerCase())):R,C=R=>R.lesson_count!==void 0?`${R.lesson_count} lessons`:R.total_lessons!==void 0?`${R.total_lessons} total lessons`:"",N=R=>R.last_lesson_date?new Date(R.last_lesson_date).toLocaleDateString():"",j=(R,D,z,L,I)=>{const O=T(R);return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg ${I} bg-opacity-10`,children:[L,c.jsx("span",{className:"font-medium text-sm",children:z}),c.jsxs("span",{className:"text-xs text-gray-500",children:["(",O.length,")"]})]}),c.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:O.map(Y=>c.jsx(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>E(Y),className:`p-3 rounded-lg border cursor-pointer transition-all duration-200 hover:shadow-md ${I} border-opacity-30 hover:border-opacity-50`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-gray-900",children:Y.name}),c.jsxs("div",{className:"text-sm text-gray-500",children:[C(Y),N(Y)&&` • Last lesson: ${N(Y)}`]})]}),c.jsxs("div",{className:"text-xs text-gray-400",children:[D==="current"&&"Current",D==="history"&&"Previous",D==="all"&&"Available"]})]})},Y.id))})]})};return s?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[c.jsxs("div",{children:[c.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Select Student for ",r]}),c.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose from current, previous, or all available students"})]}),c.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:c.jsx(b$,{className:"w-5 h-5 text-gray-500"})})]}),c.jsx("div",{className:"p-6 border-b border-gray-200",children:c.jsx("input",{type:"text",placeholder:"Search students...",value:y,onChange:R=>b(R.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),c.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"current",label:"Current Students",count:i.length},{id:"history",label:"Previous Students",count:o.length},{id:"all",label:"All Students",count:u.length}].map(R=>c.jsxs("button",{onClick:()=>x(R.id),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors duration-200 ${v===R.id?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[R.label," (",R.count,")"]},R.id))}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:f?c.jsx("div",{className:"flex items-center justify-center py-8",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):m?c.jsxs("div",{className:"text-center py-8",children:[c.jsx("p",{className:"text-red-600",children:m}),c.jsx("button",{onClick:w,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"Retry"})]}):c.jsxs(Cs,{mode:"wait",children:[v==="current"&&c.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:j(i,"current","Current Students",c.jsx(x$,{className:"w-4 h-4 text-green-600"}),"border-green-200 bg-green-50")},"current"),v==="history"&&c.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:j(o,"history","Previous Students",c.jsx(m$,{className:"w-4 h-4 text-blue-600"}),"border-blue-200 bg-blue-50")},"history"),v==="all"&&c.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:j(u,"all","All Available Students",c.jsx(y$,{className:"w-4 h-4 text-gray-600"}),"border-gray-200 bg-gray-50")},"all")]})}),c.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:c.jsx("div",{className:"flex justify-end space-x-3",children:c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Cancel"})})})]})}):null},su=({isVisible:s,onClose:e,title:t,message:n,type:r="success",duration:i=4e3})=>{S.useEffect(()=>{if(s&&i>0){const l=setTimeout(()=>{e()},i);return()=>clearTimeout(l)}},[s,i,e]);const o=(()=>{switch(r){case"success":return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-400",title:"text-green-800",message:"text-green-700",iconSymbol:"✓"};case"error":return{bg:"bg-red-50",border:"border-red-200",icon:"text-red-400",title:"text-red-800",message:"text-red-700",iconSymbol:"✕"};case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",icon:"text-yellow-400",title:"text-yellow-800",message:"text-yellow-700",iconSymbol:"⚠"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",icon:"text-blue-400",title:"text-blue-800",message:"text-blue-700",iconSymbol:"ℹ"};default:return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-400",title:"text-green-800",message:"text-green-700",iconSymbol:"✓"}}})();return c.jsx(Cs,{children:s&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none",children:c.jsx(Q.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},transition:{duration:.3,ease:"easeOut"},className:`${o.bg} ${o.border} border rounded-lg shadow-lg p-6 max-w-md mx-4 pointer-events-auto`,children:c.jsxs("div",{className:"flex items-start",children:[c.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full ${o.bg} flex items-center justify-center`,children:c.jsx("span",{className:`text-lg font-bold ${o.icon}`,children:o.iconSymbol})}),c.jsxs("div",{className:"ml-4 flex-1",children:[c.jsx("h3",{className:`text-lg font-semibold ${o.title}`,children:t}),n&&c.jsx("p",{className:`mt-1 text-sm ${o.message}`,children:n})]}),c.jsxs("button",{onClick:e,className:`ml-4 flex-shrink-0 ${o.title} hover:opacity-70 transition-opacity`,children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})})})})},Ca=({isOpen:s,onClose:e,title:t,children:n,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:a,onCancel:o,loading:l=!1,loadingText:u="Saving...",confirmButtonColor:h="bg-primary-500 hover:bg-primary-600",disabled:f=!1})=>{if(!s)return null;const p=async()=>{l||f||a&&await a()},m=()=>{l||(o?o():e&&e())};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),!l&&c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"space-y-4",children:n}),c.jsxs("div",{className:"flex space-x-3 mt-6",children:[c.jsx("button",{onClick:m,disabled:l,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i}),c.jsx("button",{onClick:p,disabled:l||f,className:`flex-1 px-4 py-2 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors ${h}`,children:l?c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),u]}):r})]})]})})},dh=({level:s,size:e="sm"})=>{if(!s)return null;const t=(n,r)=>{const i="inline-flex items-center rounded-full font-medium",a={xs:"px-1.5 py-0.5 text-xs",sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm",lg:"px-3 py-1.5 text-sm"},o={A1:"bg-gray-100 text-gray-800","A1+":"bg-gray-100 text-gray-800",A2:"bg-gray-100 text-gray-800",B1:"bg-gray-100 text-gray-800",B2:"bg-gray-100 text-gray-800",C1:"bg-gray-100 text-gray-800",C2:"bg-gray-100 text-gray-800"};return`${i} ${a[r]} ${o[n]||"bg-gray-100 text-gray-800"}`};return c.jsx("span",{className:t(s,e),children:s})},_$=({onExtendSchedules:s})=>{const[e,t]=S.useState(!1),[n,r]=S.useState(0),[i,a]=S.useState(!0);S.useEffect(()=>{o()},[]);const o=async()=>{try{a(!0);const h=new Date().toDateString(),f=localStorage.getItem("extensionCheckData");if(f){const{date:m,needsExtension:g,count:y}=JSON.parse(f);if(m===h){console.log("✅ [EXTENSION_REMINDER] Using cached result from today:",{lastNeedsExtension:g,lastCount:y}),t(g),r(y),a(!1);return}else localStorage.removeItem("extensionCheckData"),console.log("🗑️ [EXTENSION_REMINDER] Deleted old check data from:",m)}console.log("🔍 [EXTENSION_REMINDER] Checking reminder for today:",h);const p=await te.checkExtensionReminder();if(p.success){t(p.needsExtension),r(p.count);const m={date:h,needsExtension:p.needsExtension,count:p.count};localStorage.setItem("extensionCheckData",JSON.stringify(m)),console.log("💾 [EXTENSION_REMINDER] Saved check data to localStorage:",m)}}catch(h){console.error("❌ [EXTENSION_REMINDER] Error checking extension reminder:",h)}finally{a(!1)}},l=async()=>{await s(),await o()},u=async()=>{localStorage.removeItem("extensionCheckData"),console.log("🗑️ [EXTENSION_REMINDER] Cleared cache, forcing fresh check"),await o()};return i?c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:c.jsxs("div",{className:"animate-pulse flex items-center space-x-3",children:[c.jsx("div",{className:"w-4 h-4 bg-blue-300 rounded-full"}),c.jsx("div",{className:"h-4 bg-blue-300 rounded w-1/3"})]})}):e?c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsxs("h3",{className:"font-medium text-yellow-800",children:["⚠️ ",n," schedules need extension"]}),c.jsx("p",{className:"text-sm text-yellow-600",children:"Some schedules have 2 weeks or less remaining"})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:l,className:"btn btn-primary text-sm",children:"Extend +1 Week"}),c.jsx("button",{onClick:u,className:"btn btn-secondary text-sm",title:"Force refresh to check updated count",children:"🔄"})]})]})}):null},E$=({teacherId:s,weekStart:e,onWeekChange:t})=>{console.log("🔍 [ScheduleTable] Received weekStart prop:",e),console.log("🔍 [ScheduleTable] Expected current week:",Vc());const[n,r]=S.useState([]),[i,a]=S.useState(!0),[o,l]=S.useState(""),[u,h]=S.useState(!1);S.useEffect(()=>{console.log("🔍 [EDIT_MODE] State changed to:",u)},[u]);const[f,p]=S.useState(!1),[m,g]=S.useState(null),[y,b]=S.useState(""),[v,x]=S.useState(!1),[w,E]=S.useState([]),[T,C]=S.useState(null),[N,j]=S.useState(""),[R,D]=S.useState([]),[z,L]=S.useState(!1),[I,O]=S.useState(null),[Y,F]=S.useState(!1),[B,M]=S.useState(null),[$,K]=S.useState(!1),[J,Z]=S.useState(null),[pe,Se]=S.useState(!1),[Pe,H]=S.useState(!1),[X,we]=S.useState(null),[Re,Ee]=S.useState(null),[q,oe]=S.useState(!1),[fe,He]=S.useState(null),[ie,me]=S.useState(!1),[Je,ft]=S.useState(!1),[ln,Zr]=S.useState(!1),[An,Ns]=S.useState(!1),[kn,Ot]=S.useState(!1),[kr,sr]=S.useState(!1),[dt,js]=S.useState(null),[as,cn]=S.useState(!1),[Tn,ei]=S.useState({title:"",message:"",type:"success"}),[zs,Ps]=S.useState(!1),Lt=(V,ee,be="success")=>{ei({title:V,message:ee,type:be}),cn(!0)},[Ua,Cn]=S.useState([]);S.useEffect(()=>{s?(bt(),Ba()):a(!1)},[s,e]),S.useEffect(()=>()=>{Re&&clearTimeout(Re)},[Re]);const bt=async()=>{try{console.log("🔍 [FETCH_SCHEDULE] Starting fetch for teacherId:",s,"weekStart:",e),a(!0);const V=await te.getTeacherSchedule(s,e);console.log("🔍 [FETCH_SCHEDULE] API response:",V);const ee=V.schedules||[];console.log("🔍 [FETCH_SCHEDULE] Original data:",ee),Cn(ee);const be=_s.applyDraftToSchedule(ee,s,e);console.log("🔍 [FETCH_SCHEDULE] Schedule with draft:",be),r(be);const ke=_s.hasUnsavedChanges();Ot(ke)}catch(V){l("Failed to load schedule"),console.error("❌ [FETCH_SCHEDULE] Error fetching schedule:",V)}finally{a(!1)}},Ba=async()=>{try{if(!s)return;const V=await te.getStudents({status:"active",limit:250});console.log("📊 [FETCH_STUDENTS] All students response:",V);const ee=[];V.success&&V.students&&ee.push(...V.students),E(ee)}catch(V){console.error("Error fetching available students:",V),alert("Failed to load students. Please refresh the page and try again.")}},Ha=V=>{var be;if(Re&&(clearTimeout(Re),Ee(null)),!V.trim()){D([]),L(!1),H(!1),we(null),O(null);return}const ee=w.map(ke=>({...ke,score:U(ke.name,V)})).filter(ke=>ke.score>0).sort((ke,nt)=>nt.score-ke.score);if(D(ee),L(!0),ee.length===1&&ee[0].score>=80&&V.trim().length>0){const ke=ee[0];console.log("🎯 [AUTOFILL] Showing tip for single match:",ke.name,"Score:",ke.score),O(ke),L(!1),H(!0),we(ke);const nt=ke.score>=100?8e3:5e3,Ce=setTimeout(()=>{console.log("⏰ [AUTOFILL] Hiding tip after timeout"),H(!1),we(null),O(null)},nt);Ee(Ce)}else console.log("❌ [AUTOFILL] No tip - filtered.length:",ee.length,"topScore:",(be=ee[0])==null?void 0:be.score),H(!1),we(null),O(null)},U=(V,ee)=>{const be=V.toLowerCase(),ke=ee.toLowerCase();return be.startsWith(ke)?100:be.includes(ke)?50:0},se=V=>{const ee=V.target.value;if(j(ee),O(null),Pe&&X){const be=ee.toLowerCase().trim(),ke=X.name.toLowerCase();(!ke.includes(be)||be.length<ke.length)&&(H(!1),we(null))}Ha(ee)},W=(V,ee)=>{console.log("🔍 [DOUBLE_CLICK] editMode:",u,"dayIndex:",V,"timeSlot:",ee);const be=Nn(V,ee);if(console.log("🔍 [DOUBLE_CLICK] existingSchedule:",be),be){if(be.is_deleted)return;u?(console.log("🔍 [DOUBLE_CLICK] Edit mode - calling handleDeleteLesson"),si(be)):(console.log("🔍 [DOUBLE_CLICK] Read mode - calling fetchLessonReport"),Mi(be))}else{if(!u)return;const ke=`${V}-${ee}`;C(ke),j(""),O(null),L(!1),H(!1),we(null),setTimeout(()=>{const nt=document.getElementById(`student-input-${ke}`);nt&&nt.focus()},0)}},de=()=>{C(null),j(""),O(null),L(!1),H(!1),we(null)},ve=V=>{const ee={Monday:0,Tuesday:1,Wednesday:2,Thursday:3,Friday:4,Saturday:5,Sunday:6};return ee[V]!==void 0?ee[V]:0},_e=V=>{if(console.log("🔍 [HANDLE_STUDENT_SELECT] Selected student:",V),!m){console.log("❌ [HANDLE_STUDENT_SELECT] No time slot selected");return}Ne(V,null,m)},Ne=async(V=null,ee=null,be=null)=>{console.log("🔍 [HANDLE_ADD_STUDENT] Called with:",{student:V==null?void 0:V.name,dayIndex:ee,timeSlot:be,selectedStudentId:y,selectedTimeSlot:m});const ke=V,nt=be||m;if(console.log("🔍 [HANDLE_ADD_STUDENT] Using:",{studentToUse:ke==null?void 0:ke.name,timeSlotToUse:nt}),!ke||!nt){console.log("❌ [HANDLE_ADD_STUDENT] Missing required data:",{hasStudent:!!ke,hasTimeSlot:!!nt});return}try{const Ce=ee!==null?ee:ve(nt.day);console.log("🔍 [HANDLE_ADD_STUDENT] dayNumber:",Ce,"timeSlotToUse:",nt);const Me={teacherId:s,studentId:ke.id,studentName:ke.name,dayOfWeek:Ce,timeSlot:nt.time||nt,weekStart:e};console.log("🔍 [HANDLE_ADD_STUDENT] Adding to draft:",Me);const qe=_s.addLesson(Me);console.log("🔍 [HANDLE_ADD_STUDENT] Draft result:",qe),Ot(!0);const nr={id:Me.id||`temp_${Date.now()}_${Math.random()}`,student_id:Me.studentId,student_name:Me.studentName,teacher_id:Me.teacherId,day_of_week:Me.dayOfWeek,time_slot:Me.timeSlot,week_start_date:Me.weekStart,attendance_status:"scheduled",is_draft:!0};r(rr=>[...rr,nr]),p(!1),b(""),g(null),C(null),j(""),O(null),L(!1),console.log("✅ [HANDLE_ADD_STUDENT] Added to draft successfully")}catch(Ce){console.error("❌ [HANDLE_ADD_STUDENT] Error adding student to schedule:",Ce),alert("Failed to add student to schedule: "+Ce.message)}},Qe=["8:00-8:30","8:30-9:00","9:00-9:30","9:30-10:00","10:00-10:30","10:30-11:00","11:00-11:30","11:30-12:00","12:00-12:30","12:30-13:00","13:00-13:30","13:30-14:00","14:00-14:30","14:30-15:00","15:00-15:30","15:30-16:00","16:00-16:30","16:30-17:00","17:00-17:30","17:30-18:00","18:00-18:30","18:30-19:00","19:00-19:30","19:30-20:00","20:00-20:30","20:30-21:00","21:00-21:30","21:30-22:00"],un=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ti=e?L_(e):[],st=U2(),G={};ti.forEach(V=>{const ee=`${V.getFullYear()}-${V.getMonth()+1}`;G[ee]=(G[ee]||0)+1});const ge=Object.keys(G).reduce((V,ee)=>G[V]>G[ee]?V:ee,Object.keys(G)[0]),[$e,at]=ge?ge.split("-").map(Number):[st.year,st.month],Ge=e?cv(e,at,$e):null,Ze=e?B2(e,at,$e):null,De=ti.length>0?ti[0].toLocaleDateString("en-US",{month:"long",year:"numeric"}):st.name+" "+st.year,Ft=(V,ee)=>n.find(be=>be.day_of_week===V&&be.time_slot===ee&&!be.is_deleted),Nn=(V,ee)=>n.find(be=>be.day_of_week===V&&be.time_slot===ee),Mi=async V=>{try{const ee=new Date(V.week_start_date),be=new Date(ee);be.setDate(ee.getDate()+V.day_of_week);const ke=be.getFullYear()+"-"+String(be.getMonth()+1).padStart(2,"0")+"-"+String(be.getDate()).padStart(2,"0");console.log("🔍 [ADMIN_FETCH_REPORT] Schedule:",V),console.log("🔍 [ADMIN_FETCH_REPORT] Week start:",V.week_start_date),console.log("🔍 [ADMIN_FETCH_REPORT] Day of week:",V.day_of_week),console.log("🔍 [ADMIN_FETCH_REPORT] Calculated lesson date:",ke);const nt=await te.getReports({student_id:V.student_id,teacher_id:V.teacher_id,lesson_date:ke,time_slot:V.time_slot});nt.reports&&nt.reports.length>0?Z({schedule:V,report:nt.reports[0]}):Z({schedule:V,report:null}),K(!0)}catch(ee){console.error("Error fetching lesson report:",ee),alert("Error fetching lesson report: "+ee.message)}},si=async V=>{const ee=new Date(V.week_start_date)<new Date;F(!0),M(V)},rE=async()=>{if(B){try{if(B.is_draft){const V=_s.getDraftChanges();V&&(V.additions=V.additions.filter(ee=>!(ee.dayOfWeek===B.day_of_week&&ee.timeSlot===B.time_slot)),_s.saveDraftChanges(V),Ot(V.additions.length>0||V.deletions.length>0))}else{const V={teacherId:s,dayOfWeek:B.day_of_week,timeSlot:B.time_slot,weekStart:e};console.log("🔍 [DELETE] Calling draftManager.deleteLesson with:",B.id,V);const ee=_s.deleteLesson(B.id,V);console.log("🔍 [DELETE] Delete result:",ee),Ot(!0);const be=_s.getDraftChanges();console.log("🔍 [DELETE] Draft after deletion:",be),be&&_s.saveDraftChanges(be)}}catch(V){console.error("Exception:",V),alert("Error deleting lesson: "+V.message),F(!1),M(null);return}B.is_draft?r(V=>V.filter(ee=>!(ee.day_of_week===B.day_of_week&&ee.time_slot===B.time_slot))):r(V=>V.map(ee=>ee.id===B.id?{...ee,is_deleted:!0,attendance_status:"deleted"}:ee)),F(!1),M(null)}},VR=async()=>{if(!(J!=null&&J.report)){Lt("Error","No report to delete","error");return}try{ft(!0);const V=await te.deleteReport(J.report.id);V.success?(await te.markAttendance(J.schedule.id,"scheduled",new Date().toISOString().split("T")[0]),await bt(),K(!1),Z(null),Se(!1),Lt("Success!","Report deleted successfully. Lesson has been reset for the teacher to submit a new report.","success")):(console.error("Delete report failed:",V.error),Lt("Error","Failed to delete report: "+V.error,"error"))}catch(V){console.error("Exception deleting report:",V),Lt("Error","Error deleting report: "+V.message,"error")}finally{ft(!1)}},zR=async V=>{try{const ee=await te.markAttendance(V.id,"scheduled");ee.success?(await bt(),Lt("Success!","Lesson has been reset for the teacher to submit a new report.","success")):(console.error("Failed to reset lesson:",ee.error),Lt("Error","Failed to reset lesson: "+(ee.error||"Unknown error"),"error"))}catch(ee){console.error("Error resetting lesson:",ee),Lt("Error","Error resetting lesson: "+ee.message,"error")}},iE=async()=>{try{Zr(!0);const V=await te.extendSchedules();V.success?(Lt("Success!",`Extended ${V.count} schedule templates by one week.`,"success"),await bt()):(console.error("Failed to extend schedules:",V.error),Lt("Error","Failed to extend schedules: "+(V.error||"Unknown error"),"error"))}catch(V){console.error("Error extending schedules:",V),Lt("Error","Error extending schedules: "+V.message,"error")}finally{Zr(!1),Ns(!1)}},WR=()=>{Ns(!0)},GR=V=>{He(V),oe(!0)},qR=async()=>{if(fe)try{me(!0),await zR(fe),oe(!1),He(null)}finally{me(!1)}},KR=(V,ee,be)=>{const ke=`${V}-${ee}`;if(T===ke)return c.jsxs("div",{className:"relative w-full",children:[c.jsx("input",{id:`student-input-${ke}`,type:"text",value:N,onChange:se,onFocus:()=>L(!0),onBlur:()=>setTimeout(()=>L(!1),200),placeholder:"Type student name...",className:"w-full px-2 py-1 text-sm border border-blue-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onKeyDown:Ce=>{Ce.key==="Enter"&&I?(Ne(I,V,ee),C(null)):Ce.key==="Escape"&&(C(null),j(""),O(null))}}),Pe&&X&&c.jsx(Q.div,{initial:{opacity:0,y:-5,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-5,scale:.95},transition:{duration:.15,ease:"easeOut"},className:"absolute z-50 w-full mt-1 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-lg px-3 py-2 cursor-pointer hover:from-blue-100 hover:to-indigo-100 hover:shadow-xl transition-all duration-200",onClick:()=>{console.log("🎯 [AUTOFILL_CLICK] Clicked autofill tip",{selectedStudent:I,autofillStudent:X,dayIndex:V,timeSlot:ee});const Ce=I||X;Ce?(console.log("✅ [AUTOFILL_CLICK] Calling handleAddStudentToSchedule with:",{student:Ce.name,dayIndex:V,timeSlot:ee}),Ne(Ce,V,ee),C(null)):console.log("❌ [AUTOFILL_CLICK] No student available for scheduling")},role:"button",tabIndex:0,"aria-label":`Select ${X.name} for this time slot`,onKeyDown:Ce=>{if(Ce.key==="Enter"||Ce.key===" "){Ce.preventDefault();const Me=I||X;Me&&(Ne(Me,V,ee),C(null))}else Ce.key==="Escape"&&(H(!1),we(null),O(null))},children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),c.jsxs("span",{className:"text-sm text-blue-800",children:[c.jsx("span",{className:"font-semibold",children:X.name}),c.jsx("span",{className:"text-blue-600 ml-2 text-xs",children:"Press Enter or click to select"})]})]}),c.jsx("button",{onClick:Ce=>{Ce.stopPropagation(),H(!1),we(null),O(null)},className:"text-blue-400 hover:text-blue-600 ml-2 p-1 rounded-full hover:bg-blue-100 transition-colors","aria-label":"Dismiss suggestion",children:c.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),z&&R.length>1&&R.length<=7&&c.jsx(Q.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.15},className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:R.map((Ce,Me)=>c.jsx("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 flex items-center justify-between",onClick:()=>{console.log("🎯 [SUGGESTION_CLICK] Selected student:",Ce.name),Ne(Ce,V,ee),C(null)},role:"button",tabIndex:0,"aria-label":`Select ${Ce.name} for this time slot`,onKeyDown:qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),Ne(Ce,V,ee),C(null))},children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${Ce.score>=100?"bg-green-500":Ce.score>=80?"bg-blue-500":"bg-yellow-500"}`}),c.jsx("span",{className:"text-sm font-medium text-gray-800",children:Ce.name})]})},Ce.id))})]});if(be){const Ce=be.is_deleted;return c.jsxs("div",{className:`flex items-center justify-between cursor-pointer hover:bg-gray-50 p-1 ${Ce?"opacity-50 bg-red-50 line-through":""}`,onDoubleClick:()=>!Ce&&W(V,ee),title:Ce?"Marked for deletion (will be removed when saved)":u?"Double-click to remove student":"Double-click to view lesson report",children:[c.jsxs("span",{className:`text-sm font-medium ${Ce?"text-red-600":""}`,children:[be.student_name,Ce&&c.jsx("span",{className:"ml-1 text-xs text-red-500",children:"(deleted)"})]}),u&&!Ce&&c.jsx("button",{onClick:()=>si(be),className:"text-red-500 hover:text-red-700 text-xs",children:"×"})]})}return c.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 cursor-pointer hover:bg-gray-50",onDoubleClick:()=>W(V,ee),children:c.jsx("span",{className:"text-xs",children:"Double-click to add student"})})},XR={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},YR=async()=>{t&&e&&!v&&Tv("previousWeek")},JR=async()=>{t&&e&&!v&&Tv("nextWeek")},QR=async()=>{t&&!v&&Tv("currentWeek")},aE=async()=>{var nt,Ce;console.log("🔍 [SAVE] Save button clicked, hasUnsavedChanges:",kn),console.log("🔍 [SAVE] Current date:",new Date().toISOString().split("T")[0]),console.log("🔍 [SAVE] Current date local:",new Date().toLocaleDateString("en-CA")),console.log("🔍 [SAVE] Current day of week:",new Date().getDay()),console.log("🔍 [SAVE] Expected current week start:",Vc());const V=new Date,ee=V.getDay(),be=ee===0?6:ee-1,ke=new Date(V);if(ke.setDate(V.getDate()-be),console.log("🔍 [SAVE] Manual calculation - daysToMonday:",be),console.log("🔍 [SAVE] Manual calculation - monday:",ke.toISOString().split("T")[0]),!kn){console.log("❌ [SAVE] No unsaved changes, returning early");return}try{Ps(!0);const Me=_s.getDraftChanges();if(console.log("🔍 [SAVE] Draft data:",Me),console.log("🔍 [SAVE] localStorage draft:",localStorage.getItem("schedule_draft_changes")),!Me){console.log("❌ [SAVE] No draft data found"),console.log("🔍 [SAVE] Checking if there are any changes in schedule state...");const qe=n.filter(rr=>rr.is_draft),nr=n.filter(rr=>rr.is_deleted);console.log("🔍 [SAVE] Draft items in schedule:",qe.length),console.log("🔍 [SAVE] Deleted items in schedule:",nr.length);return}console.log("🔍 [SAVE] Current weekStart prop:",e),console.log("🔍 [SAVE] Processing additions:",Me.additions.length);for(const qe of Me.additions){console.log("🔍 [SAVE] Addition weekStart:",qe.weekStart),console.log("🔍 [SAVE] Calling createSchedule with:",{student_id:qe.studentId,teacher_id:qe.teacherId,day_of_week:qe.dayOfWeek,time_slot:qe.timeSlot,week_start_date:qe.weekStart});try{const nr=await te.createSchedule({student_id:qe.studentId,teacher_id:qe.teacherId,day_of_week:qe.dayOfWeek,time_slot:qe.timeSlot,week_start_date:qe.weekStart});console.log("🔍 [SAVE] createSchedule result:",nr)}catch(nr){throw console.error("❌ [SAVE] createSchedule error:",nr),nr}}console.log("🔍 [SAVE] Processing deletions:",Me.deletions.length);for(const qe of Me.deletions)console.log("🔍 [SAVE] Deleting schedule:",qe.scheduleId),await te.deleteSchedule(qe.scheduleId);_s.clearDraftChanges(),Ot(!1),await bt(),console.log("✅ [DRAFT] Changes saved successfully")}catch(Me){console.error("❌ [DRAFT] Failed to save changes:",Me);let qe="Failed to save changes. Please try again.";Me.message?qe=Me.message:(Ce=(nt=Me.response)==null?void 0:nt.data)!=null&&Ce.message&&(qe=Me.response.data.message),Lt("Error",qe,"error")}finally{Ps(!1)}},ZR=async()=>{_s.clearDraftChanges(),Ot(!1),await bt(),console.log("🗑️ [DRAFT] Changes discarded")},Tv=V=>{kn?(js(V),sr(!0)):Cv(V)},Cv=V=>{if(V==="previousWeek"){if(t&&e&&!v){x(!0);const ee=$2(e,7);t(ee),setTimeout(()=>x(!1),300)}}else if(V==="nextWeek"){if(t&&e&&!v){x(!0);const ee=F2(e,7);t(ee),setTimeout(()=>x(!1),300)}}else if(V==="currentWeek"&&t&&!v){x(!0);const ee=Vc();t(ee),setTimeout(()=>x(!1),300)}},oE=V=>{V==="save"?aE().then(()=>Cv(dt)):V==="discard"&&(ZR(),Cv(dt)),sr(!1),js(null)},eL=V=>V&&V.attendance_status||"scheduled",tL=V=>{switch(V){case"completed":return"bg-success text-white";case"absent":return"bg-error text-white";case"absent_warned":return"bg-yellow-500 text-white";default:return"bg-neutral-200 text-neutral-700"}};return i?c.jsx("div",{className:"flex justify-center py-8",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"})}):o?c.jsx("div",{className:"text-center py-8",children:c.jsx("p",{className:"text-error text-sm",children:o})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200",children:[c.jsx(_$,{onExtendSchedules:iE}),c.jsx("div",{className:"p-4 border-b border-neutral-200",children:c.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[c.jsxs("h2",{className:"text-xs sm:text-lg font-semibold whitespace-nowrap",children:[c.jsx("span",{className:"sm:hidden",children:"Schedule"}),c.jsx("span",{className:"hidden sm:inline",children:"Weekly Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[t&&c.jsxs(Q.div,{className:"flex items-center gap-1",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:[c.jsx(Q.button,{onClick:YR,disabled:v,className:"p-2 rounded-lg border border-neutral-300 hover:bg-neutral-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:v?{x:[-2,2,-2]}:{x:0},transition:{duration:.1,repeat:v?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx(Q.button,{onClick:QR,disabled:v,className:`px-2 sm:px-3 py-1 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed ${Ze!=null&&Ze.isCurrentWeek?"bg-primary-500 text-white":"text-neutral-700 bg-neutral-100 hover:bg-neutral-200"}`,title:(Ze==null?void 0:Ze.weekLabel)||"Current Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:(Ze==null?void 0:Ze.weekLabel)||"Week 1"},(Ze==null?void 0:Ze.weekLabel)||"Week 1")}),c.jsx(Q.button,{onClick:JR,disabled:v,className:"p-2 rounded-lg border border-neutral-300 hover:bg-neutral-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:v?{x:[2,-2,2]}:{x:0},transition:{duration:.1,repeat:v?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),c.jsx("button",{onClick:WR,disabled:ln,className:"flex items-center justify-center p-1.5 sm:p-2 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white rounded transition-colors group relative ml-2 sm:ml-4",title:"Extend all schedules by one week",children:ln?c.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):c.jsx("img",{src:"/pics/extend-schedule.png",alt:"Extend Schedule",className:"w-3 h-3 sm:w-4 sm:h-4 group-hover:scale-110 transition-transform"})})]})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3 flex-shrink-0 pt-1 sm:pt-0",children:[c.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[c.jsxs("span",{className:"text-xs font-medium text-neutral-700 whitespace-nowrap",children:[c.jsx("span",{className:"sm:hidden",children:"Read"}),c.jsx("span",{className:"hidden sm:inline",children:"Read Mode"})]}),c.jsx("button",{onClick:()=>h(!u),className:`relative inline-flex h-5 w-10 sm:h-6 sm:w-11 items-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${u?"bg-primary-500":"bg-neutral-300"}`,children:c.jsx("span",{className:`inline-block h-3 w-3 sm:h-4 sm:w-4 transform rounded-full bg-white transition-transform duration-200 ${u?"translate-x-6 sm:translate-x-6":"translate-x-1"}`})}),c.jsxs("span",{className:"text-xs font-medium text-neutral-700 whitespace-nowrap",children:[c.jsx("span",{className:"sm:hidden",children:"Edit"}),c.jsx("span",{className:"hidden sm:inline",children:"Edit Mode"})]})]}),u&&c.jsx("button",{className:"btn-primary text-xs sm:text-sm px-2 sm:px-4 py-1 sm:py-2 w-full sm:w-auto",onClick:aE,disabled:zs,children:zs?c.jsxs("div",{className:"flex items-center justify-center space-x-1 sm:space-x-2",children:[c.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),c.jsx("span",{className:"text-xs sm:text-sm",children:"Saving..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sm:hidden",children:"Save"}),c.jsx("span",{className:"hidden sm:inline",children:"Save Changes"})]})})]})]})}),c.jsx("div",{className:"w-full",children:c.jsx(Cs,{mode:"wait",children:c.jsxs(Q.table,{className:"w-full table-fixed",variants:XR,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.3,ease:"easeInOut"},children:[c.jsxs("thead",{className:"bg-neutral-50",children:[c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-xs sm:text-sm font-semibold text-neutral-800 w-12 sm:w-16 md:w-24"}),c.jsx("th",{colSpan:"7",className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center text-sm sm:text-base md:text-lg font-bold text-neutral-800",children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:De},De)})]}),c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-medium text-neutral-700 w-10 sm:w-12 md:w-16",children:"Time"}),un.map((V,ee)=>{var nt;const be=(nt=Ge==null?void 0:Ge.days)==null?void 0:nt[ee],ke=(be==null?void 0:be.isCurrentMonth)??!0;return be==null||be.isEditable,c.jsx(Q.th,{className:`px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center font-medium min-w-0 ${ke?"text-neutral-700":"text-neutral-400 bg-neutral-100"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:ee*.05},children:c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("div",{className:`font-semibold text-2xs sm:text-xs md:text-sm truncate ${ke?"":"opacity-50"}`,children:V}),ti.length>ee&&c.jsx(Q.div,{className:`text-2xs sm:text-xs mt-0.5 sm:mt-1 truncate ${ke?"text-neutral-500":"text-neutral-400"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.1+ee*.05},children:O2(ti[ee],"short")})]})},`${V}-${e}`)})]})]}),c.jsx("tbody",{children:Qe.map((V,ee)=>c.jsxs(Q.tr,{className:"border-b border-neutral-100",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:ee*.02},children:[c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-2xs sm:text-xs md:text-sm text-neutral-600 font-medium",children:V}),un.map((be,ke)=>{var lE;const nt=ve(be),Ce=Ft(nt,V),Me=eL(Ce),qe=(lE=Ge==null?void 0:Ge.days)==null?void 0:lE[ke],nr=(qe==null?void 0:qe.isCurrentMonth)??!0,rr=(qe==null?void 0:qe.isEditable)??!0;return c.jsx(Q.td,{className:`px-1 sm:px-2 py-1 h-10 sm:h-12 md:h-14 relative ${nr?"":"bg-neutral-50"}`,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2,delay:ee*.02+ke*.01},onClick:de,children:c.jsx(Cs,{mode:"wait",children:Ce?c.jsxs(Q.div,{className:`p-1 rounded-lg text-2xs font-medium text-center transition-all duration-200 ${tL(Me)} ${u&&rr||Me==="completed"||Me==="absent"||Me==="absent_warned"?"cursor-pointer":""}`,whileHover:u&&rr?{scale:1.02}:Me==="completed"?{scale:1.02}:Me==="absent"||Me==="absent_warned"?{scale:1.02}:{},whileTap:u&&rr?{scale:.98}:Me==="completed"?{scale:.98}:Me==="absent"||Me==="absent_warned"?{scale:.98}:{},initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},onClick:u&&rr?()=>si(Ce):Me==="completed"?()=>Mi(Ce):Me==="absent"||Me==="absent_warned"?()=>GR(Ce):void 0,children:[c.jsx("div",{className:"truncate text-2xs",children:Ce.student_name}),u&&rr?c.jsx("div",{className:"mt-1 text-2xs opacity-75",children:"Click to remove"}):Me==="completed"?c.jsx("div",{className:"mt-1 text-2xs opacity-75",children:"Click to view report"}):Me==="absent"||Me==="absent_warned"?c.jsx("div",{className:"mt-1 text-2xs opacity-75",children:"Click to reset"}):null]},`student-${Ce.id}-${e}`):u&&rr?c.jsx(Q.div,{className:"w-full h-full",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:KR(nt,V,Nn(nt,V))},`enhanced-cell-${ke}-${ee}-${e}`):c.jsx(Q.div,{className:`w-full h-12 flex items-center justify-center ${nr?"text-neutral-300":"text-neutral-200"}`,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:nr?"-":""},`empty-${ke}-${ee}-${e}`)})},`${ke}-${ee}-${e}`)})]},V))})]},e)})}),c.jsx("div",{className:"p-4 border-t border-neutral-200",children:c.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-success rounded"}),c.jsx("span",{children:"Completed"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-error rounded"}),c.jsx("span",{children:"UI"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),c.jsx("span",{children:"I"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-4 bg-neutral-200 rounded"}),c.jsx("span",{children:"Scheduled"})]})]})}),c.jsx(S$,{isOpen:f,onClose:()=>{p(!1),b(""),g(null)},onSelect:_e,teacherId:s,teacherName:"Teacher"}),$&&J&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"Lesson Report"}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Student:"})," ",J.schedule.student_name,J.schedule.student_level&&c.jsx("span",{className:"ml-2",children:c.jsx(dh,{level:J.schedule.student_level,size:"xs"})})]}),c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Date:"})," ",(()=>{const V=new Date(J.schedule.week_start_date),ee=new Date(V);return ee.setDate(V.getDate()+J.schedule.day_of_week),ee.toLocaleDateString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit"})})()]}),c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Time:"})," ",J.schedule.time_slot]}),c.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.jsx("strong",{children:"Status:"})," ",J.schedule.attendance_status]})]}),J.report?c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Teacher's Report:"}),c.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:c.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:J.report.comment})}),c.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Report created: ",new Date(J.report.created_at).toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})]})]}):c.jsx("div",{className:"mb-4",children:c.jsx("p",{className:"text-gray-500 italic",children:"No lesson report available for this lesson."})}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:()=>K(!1),className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Close"}),J.report&&c.jsx("button",{onClick:()=>Se(!0),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete Report"})]})]})}),c.jsxs(Ca,{isOpen:pe,onClose:()=>Se(!1),title:"Delete Lesson Report",loading:Je,loadingText:"Deleting...",confirmText:"Delete Report",confirmButtonColor:"bg-red-500 hover:bg-red-600",onConfirm:VR,children:[c.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to delete this lesson report?"}),c.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[c.jsx("p",{className:"text-sm text-yellow-800",children:c.jsx("strong",{children:"This will:"})}),c.jsxs("ul",{className:"text-sm text-yellow-700 mt-2 list-disc list-inside",children:[c.jsx("li",{children:"Delete the report from the database"}),c.jsx("li",{children:'Reset the lesson status to "Scheduled"'}),c.jsx("li",{children:"Allow the teacher to submit a new report"}),c.jsx("li",{children:"Reset attendance status "})]})]})]}),c.jsxs(Ca,{isOpen:q,onClose:()=>{oe(!1),He(null)},title:"Reset Lesson",loading:ie,loadingText:"Resetting...",confirmText:"Reset Lesson",confirmButtonColor:"bg-blue-500 hover:bg-blue-600",onConfirm:qR,children:[c.jsx("p",{className:"text-gray-600 mb-4",children:'Are you sure you want to reset this lesson to "Scheduled"?'}),c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[c.jsx("p",{className:"text-sm text-blue-800",children:c.jsx("strong",{children:"This will:"})}),c.jsxs("ul",{className:"text-sm text-blue-700 mt-2 list-disc list-inside",children:[c.jsx("li",{children:'Reset the lesson status to "Scheduled"'}),c.jsx("li",{children:"Allow the teacher to mark attendance again"})]})]})]}),c.jsxs(Ca,{isOpen:An,onClose:()=>Ns(!1),title:"Extend All Schedules",loading:ln,loadingText:"Extending...",confirmText:"Extend Schedules",confirmButtonColor:"bg-blue-500 hover:bg-blue-600",onConfirm:iE,children:[c.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to extend all schedules by 1 week?"}),c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[c.jsx("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"This will:"}),c.jsxs("ul",{className:"text-sm text-blue-700 list-disc list-inside",children:[c.jsx("li",{children:"Add one new week after the last scheduled week for each active schedule pattern"}),c.jsx("li",{children:"Extend all active student/teacher/day/time combinations"}),c.jsx("li",{children:'Create new schedule entries with "scheduled" status'})]})]})]}),Y&&B&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4 text-red-600",children:"Delete Future Lessons"}),c.jsxs("p",{className:"text-gray-600 mb-4",children:["This will delete ",c.jsx("strong",{children:"all future lessons"})," with the same pattern."]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Past lessons will be ",c.jsx("strong",{children:"preserved"})," for historical records."]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{onClick:rE,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg",children:"Delete Future Lessons"})]})]})}),c.jsx(H2,{isOpen:kr,onClose:()=>sr(!1),onSave:()=>oE("save"),onDiscard:()=>oE("discard"),pendingAction:dt,changesSummary:_s.getChangesSummary()}),c.jsx(su,{isVisible:as,onClose:()=>cn(!1),title:Tn.title,message:Tn.message,type:Tn.type})]})},A$=({teacher:s,loading:e=!1})=>c.jsxs(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center justify-between p-3 border rounded-lg transition-all duration-200 bg-gray-50 border-gray-200 hover:bg-gray-100",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"flex-shrink-0",children:s.photo_url?c.jsx("img",{src:s.photo_url,alt:s.name,className:"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"}):c.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center border-2 border-white shadow-sm",children:c.jsx("span",{className:"text-sm font-medium text-gray-600",children:s.name.charAt(0).toUpperCase()})})}),c.jsxs("div",{children:[c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("span",{className:"font-medium text-gray-900",children:s.name})}),c.jsxs("div",{className:"text-sm text-gray-500",children:["Assigned: ",new Date(s.assigned_date).toLocaleDateString()]})]})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("span",{className:"text-xs text-gray-500",children:"Connected"})})]}),k$=({student:s,isOpen:e,onClose:t,assignedTeachers:n=[],loading:r=!1})=>!e||!s?null:c.jsx(Cs,{children:c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[c.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Teachers for ",s.name]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),c.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:c.jsxs("div",{className:"mb-6",children:[c.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:["Currently Assigned Teachers (",n.length,")"]}),c.jsx("div",{className:"space-y-2",children:n.length===0?c.jsxs("div",{className:"text-center py-8 text-gray-500",children:[c.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),c.jsx("p",{className:"text-sm",children:"No teachers assigned"})]}):c.jsx(Cs,{children:n.map(i=>c.jsx(A$,{teacher:i,loading:r},i.id))})})]})}),c.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end",children:c.jsx("button",{onClick:t,disabled:r,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Close"})})]})})}),T$=({packages:s,loading:e,onDeletePackage:t,onSort:n,sortConfig:r,onPageChange:i,pagination:a})=>{const o=l=>{switch(l){case"exhausted":return"text-red-600 bg-red-50";case"low":return"text-yellow-600 bg-yellow-50";case"active":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};return c.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[c.jsxs("table",{className:"w-full",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50",children:[c.jsxs("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>n("student_name"),children:["Student Name",r.key==="student_name"&&c.jsx("span",{className:"ml-1",children:r.direction==="asc"?"↑":"↓"})]}),c.jsxs("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>n("lessons_remaining"),children:["Package",r.key==="lessons_remaining"&&c.jsx("span",{className:"ml-1",children:r.direction==="asc"?"↑":"↓"})]}),c.jsxs("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>n("date_added"),children:["Date Added",r.key==="date_added"&&c.jsx("span",{className:"ml-1",children:r.direction==="asc"?"↑":"↓"})]}),c.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e?c.jsx("tr",{children:c.jsx("td",{colSpan:"4",className:"px-4 py-8 text-center text-gray-500",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"})})}):s.length===0?c.jsx("tr",{children:c.jsx("td",{colSpan:"4",className:"px-4 py-8 text-center text-sm text-gray-500",children:"No packages found"})}):s.map(l=>c.jsxs(Q.tr,{className:"hover:bg-gray-50",whileHover:{scale:1.01},transition:{duration:.2},children:[c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:l.student_name}),c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o(l.package_status)}`,children:[l.lessons_remaining," / ",l.number_of_lessons]}),c.jsxs("span",{className:"text-gray-500",children:["(",l.lessons_taken," used)"]})]})}),c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(l.date_added).toLocaleDateString()}),c.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm",children:c.jsx("button",{onClick:()=>t(l),className:"text-red-600 hover:text-red-800 transition-colors",children:"Delete"})})]},l.package_id))})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mt-4 gap-2",children:[c.jsxs("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(a.page-1)*a.limit+1," to ",Math.min(a.page*a.limit,a.total||0)," of ",a.total||0," packages"]}),c.jsxs("div",{className:"flex space-x-2 justify-center sm:justify-end",children:[c.jsx("button",{onClick:()=>i(Math.max(1,a.page-1)),disabled:a.page===1,className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),c.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",a.page," of ",Math.ceil((a.total||0)/a.limit)]}),c.jsx("button",{onClick:()=>i(a.page+1),disabled:a.page>=Math.ceil((a.total||0)/a.limit),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})},C$=({isOpen:s,onClose:e,onAddPackage:t,loading:n,availableStudents:r,onStudentNameChange:i,onStudentSelect:a,newPackage:o,setNewPackage:l,showSuggestions:u,filteredStudents:h,showAutofillTip:f,autofillStudent:p})=>c.jsx(Ca,{isOpen:s,onClose:e,title:"Add New Package",onConfirm:t,loading:n,loadingText:"Adding package...",confirmText:"Add Package",cancelText:"Cancel",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student Name *"}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",placeholder:"Type student name...",value:o.studentName,onChange:m=>i(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),u&&h.length>0&&c.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:h.map(m=>c.jsx("div",{onClick:()=>a(m),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",children:m.name},m.id))}),f&&p&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:["Press Enter to select: ",p.name]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Lessons *"}),c.jsx("input",{type:"number",min:"1",placeholder:"Enter number of lessons",value:o.numberOfLessons,onChange:m=>l(g=>({...g,numberOfLessons:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Added *"}),c.jsx("input",{type:"date",value:o.dateAdded,onChange:m=>l(g=>({...g,dateAdded:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]})}),N$=({isOpen:s,onClose:e,onConfirm:t,loading:n,packageData:r})=>c.jsx(Ca,{isOpen:s&&!!r,onClose:e,title:"Delete Package",confirmText:"Delete Package",cancelText:"Cancel",onConfirm:t,loading:n,loadingText:"Deleting...",confirmButtonColor:"bg-red-500 hover:bg-red-600",disabled:n,children:r&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to delete the package for ",c.jsx("strong",{children:r.student_name}),"?"]}),c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:c.jsx("p",{className:"text-yellow-800 text-sm",children:"This will permanently remove the package and all associated data."})})]})}),j$=()=>{const[s,e]=S.useState([]),[t,n]=S.useState(!1),[r,i]=S.useState({name:"",status:"all"}),[a,o]=S.useState({key:"date_added",direction:"desc"}),[l,u]=S.useState({page:1,limit:20,total:0}),[h,f]=S.useState(!1),[p,m]=S.useState(!1),[g,y]=S.useState(null),[b,v]=S.useState(!1),[x,w]=S.useState(!1),[E,T]=S.useState([]),[C,N]=S.useState([]),[j,R]=S.useState(!1),[D,z]=S.useState(!1),[L,I]=S.useState(null),[O,Y]=S.useState(null),[F,B]=S.useState({studentName:"",studentId:null,numberOfLessons:"",dateAdded:new Date().toISOString().split("T")[0]}),[M,$]=S.useState(!1),[K,J]=S.useState({title:"",message:"",type:"success"}),Z=(ie,me,Je="success")=>{J({title:ie,message:me,type:Je}),$(!0)},pe=async()=>{try{n(!0);const ie=await te.getStudentPackages({...r,page:l.page,limit:l.limit,sort:a.key,direction:a.direction});ie.success?(e(ie.packages),u(me=>({...me,total:ie.total||ie.packages.length}))):Z("Error",`Failed to fetch packages: ${ie.error||"Unknown error"}`,"error")}catch(ie){console.error("❌ [FETCH_PACKAGES] Error fetching packages:",ie),Z("Error","Error fetching packages","error")}finally{n(!1)}},Se=async()=>{try{const ie=await te.getStudents({status:"active"});ie.success&&T(ie.students)}catch(ie){console.error("❌ [FETCH_AVAILABLE_STUDENTS] Error fetching students:",ie)}},Pe=ie=>{if(!ie.trim()){N([]),R(!1),z(!1),I(null);return}const me=E.filter(Je=>Je.name.toLowerCase().includes(ie.toLowerCase()));N(me),R(!0),me.length<=3&&me.length>0?(z(!0),I(me[0])):(z(!1),I(null))},H=ie=>{B(Je=>({...Je,studentName:ie,studentId:null})),O&&clearTimeout(O);const me=setTimeout(()=>{ie.trim()&&D&&L&&(B(Je=>({...Je,studentName:L.name,studentId:L.id})),R(!1),z(!1),I(null))},2e3);Y(me),Pe(ie)},X=ie=>{B(me=>({...me,studentName:ie.name,studentId:ie.id})),R(!1),z(!1),I(null)},we=ie=>{o(me=>({key:ie,direction:me.key===ie&&me.direction==="asc"?"desc":"asc"}))},Re=ie=>{u(me=>({...me,page:ie}))},Ee=(ie,me)=>{i(Je=>({...Je,[ie]:me})),u(Je=>({...Je,page:1}))},q=async()=>{try{if(v(!0),!F.studentId||!F.numberOfLessons||!F.dateAdded){Z("Error","Please fill in all fields","error");return}if(s.find(ft=>ft.student_id===F.studentId&&ft.package_status!=="exhausted")){Z("Error","This student already has an active package. Please delete the existing package first.","error");return}const me={student_id:F.studentId,number_of_lessons:parseInt(F.numberOfLessons),date_added:F.dateAdded},Je=await te.addStudentPackage(me);Je.success?(Z("Success!","Package added successfully","success"),f(!1),B({studentName:"",studentId:null,numberOfLessons:"",dateAdded:new Date().toISOString().split("T")[0]}),await pe()):Z("Error",`Failed to add package: ${Je.error||"Unknown error"}`,"error")}catch(ie){console.error("❌ [ADD_PACKAGE] Error adding package:",ie),Z("Error","Error adding package","error")}finally{v(!1)}},oe=ie=>{y(ie),m(!0)},fe=async()=>{try{w(!0);const ie=await te.deleteStudentPackage(g.package_id);ie.success?(Z("Success!","Package deleted successfully","success"),m(!1),y(null),await pe()):Z("Error",`Failed to delete package: ${ie.error||"Unknown error"}`,"error")}catch(ie){console.error("❌ [DELETE_PACKAGE] Error deleting package:",ie),Z("Error","Error deleting package","error")}finally{w(!1)}},He=async()=>{var Je;const ie=new Date().toISOString().split("T")[0],me=localStorage.getItem("exhaustedPackagesChecked");if(console.log("🔍 [CHECK_EXHAUSTED_PACKAGES] Starting check...",{today:ie,lastChecked:me,shouldCheck:me!==ie}),me!==ie){console.log("✅ [CHECK_EXHAUSTED_PACKAGES] Need to check today - proceeding with API call"),me&&me!==ie&&(console.log("🧹 [CHECK_EXHAUSTED_PACKAGES] Clearing previous day record:",me),localStorage.removeItem("exhaustedPackagesChecked"));try{console.log("📡 [CHECK_EXHAUSTED_PACKAGES] Calling getExhaustedPackages API...");const ft=await te.getExhaustedPackages();console.log("📦 [CHECK_EXHAUSTED_PACKAGES] API Response:",{success:ft.success,packageCount:((Je=ft.packages)==null?void 0:Je.length)||0,packages:ft.packages}),ft.success&&ft.packages.length>0?(console.log("⚠️ [CHECK_EXHAUSTED_PACKAGES] Found exhausted packages - showing notification"),Z("Exhausted Packages",`${ft.packages.length} packages have been exhausted`,"warning")):console.log("✅ [CHECK_EXHAUSTED_PACKAGES] No exhausted packages found"),localStorage.setItem("exhaustedPackagesChecked",ie),console.log("💾 [CHECK_EXHAUSTED_PACKAGES] Saved check date to localStorage:",ie)}catch(ft){console.error("❌ [CHECK_EXHAUSTED_PACKAGES] Error checking exhausted packages:",ft)}}else console.log("⏭️ [CHECK_EXHAUSTED_PACKAGES] Already checked today - skipping")};return S.useEffect(()=>{pe()},[r,a,l.page]),S.useEffect(()=>{Se()},[]),S.useEffect(()=>{He()},[]),c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 sm:p-4",children:c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0",children:[c.jsxs("div",{className:"flex-1 max-w-md",children:[c.jsx("label",{className:"block text-xs sm:text-sm text-gray-600 mb-1",children:"Search by name"}),c.jsx("input",{type:"text",placeholder:"Search packages by student name...",value:r.name,onChange:ie=>Ee("name",ie.target.value),className:"px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent w-full text-sm"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("select",{value:r.status,onChange:ie=>Ee("status",ie.target.value),className:"px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",children:[c.jsx("option",{value:"all",children:"All"}),c.jsx("option",{value:"low",children:"Low"}),c.jsx("option",{value:"exhausted",children:"Exhausted"})]}),c.jsx("button",{onClick:()=>f(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-3 sm:px-4 py-1 sm:py-2 rounded-lg text-sm transition-colors duration-200",children:"Add Package"})]})]})}),c.jsx(T$,{packages:s,loading:t,onDeletePackage:oe,onSort:we,sortConfig:a,onPageChange:Re,pagination:l}),c.jsx(C$,{isOpen:h,onClose:()=>f(!1),onAddPackage:q,loading:b,availableStudents:E,onStudentNameChange:H,onStudentSelect:X,newPackage:F,setNewPackage:B,showSuggestions:j,filteredStudents:C,showAutofillTip:D,autofillStudent:L}),c.jsx(N$,{isOpen:p,onClose:()=>m(!1),onConfirm:fe,loading:x,packageData:g}),c.jsx(su,{isVisible:M,onClose:()=>$(!1),title:K.title,message:K.message,type:K.type,duration:4e3})]})},P$=({isOpen:s,onClose:e,student:t,onUpdate:n})=>{const[r,i]=S.useState(""),[a,o]=S.useState(!1),[l,u]=S.useState(""),h=[{value:"",label:"No Level Assigned"},{value:"A1",label:"A1 – Beginner"},{value:"A1+",label:"A1+ – High Beginner / Pre-A2"},{value:"A2",label:"A2 – Pre-Intermediate"},{value:"B1",label:"B1 – Intermediate"},{value:"B2",label:"B2 – Upper-Intermediate"},{value:"C1",label:"C1 – Advanced"},{value:"C2",label:"C2 – Proficient"}];S.useEffect(()=>{t&&(i(t.student_level||""),u(""),(async()=>{try{const y=await te.getStudentLevel(t.id);y.success&&i(y.student.student_level||"")}catch(y){console.error("Error fetching current student level:",y)}})())},[t]);const f=async()=>{if(!t)return;if(r&&!["A1","A1+","A2","B1","B2","C1","C2"].includes(r)){u("Invalid student level");return}try{o(!0),u("");const y=await te.updateStudentLevel(t.id,r);y.success?(n(y.student),e()):u(y.error||"Failed to update student level")}catch(y){console.error("Error updating student level:",y),u("Failed to update student level")}finally{o(!1)}},p=g=>{i(g),u("")},m=()=>{a||e()};return!s||!t?null:c.jsxs(c.Fragment,{children:[c.jsx(Cs,{children:s&&c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:m,children:c.jsx(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",onClick:g=>g.stopPropagation(),children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Student Level"}),c.jsx("button",{onClick:m,disabled:a,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-gray-900",children:t.name}),c.jsx("p",{className:"text-sm text-gray-600",children:"Current Level"})]}),t.student_level&&c.jsx(dh,{level:t.student_level})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select New Level"}),c.jsx("select",{value:r,onChange:g=>p(g.target.value),disabled:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:h.map(g=>c.jsx("option",{value:g.value,children:g.label},g.value))})]}),l&&c.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md",children:c.jsx("p",{className:"text-sm text-red-600",children:l})})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{onClick:m,disabled:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:f,disabled:a,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Saving...":"Save"})]})]})})})}),a&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"}),c.jsx("span",{className:"text-gray-700",children:"Updating student level..."})]})})})]})},R$=({onStudentSelect:s,selectedStudent:e})=>{const[t,n]=S.useState([]),[r,i]=S.useState([]),[a,o]=S.useState(!0),[l,u]=S.useState("active"),[h,f]=S.useState({name:"",status:"active"}),[p,m]=S.useState({page:1,limit:50,total:0}),[g,y]=S.useState(!1),[b,v]=S.useState({name:""}),[x,w]=S.useState(!1),[E,T]=S.useState([]),[C,N]=S.useState({key:"added_date",direction:"desc"}),[j,R]=S.useState(!1),[D,z]=S.useState(null),[L,I]=S.useState([]),[O,Y]=S.useState([]),[F,B]=S.useState(!1),[M,$]=S.useState(!1),[K,J]=S.useState(null),[Z,pe]=S.useState(!1),[Se,Pe]=S.useState(!1),[H,X]=S.useState(null),[we,Re]=S.useState(!1),[Ee,q]=S.useState(null),[oe,fe]=S.useState(!1),[He,ie]=S.useState(!1),[me,Je]=S.useState({title:"",message:"",type:"success"}),[ft,ln]=S.useState(!1),[Zr,An]=S.useState(null),[Ns,kn]=S.useState(new Date),[Ot,kr]=S.useState(null),[sr,dt]=S.useState([]),[js,as]=S.useState(!1),[cn,Tn]=S.useState({}),[ei,zs]=S.useState(!1);S.useEffect(()=>{l==="active"?Ps():Lt(),Ua()},[p.page,h,C,l]),S.useEffect(()=>{Ps(),Lt(),Ua()},[]),S.useEffect(()=>{const G=Cn(Ns);dt(G),kr(null),(async()=>{try{zs(!0);const $e=Ns.getMonth()+1,at=Ns.getFullYear();console.log("🔍 [STUDENT_MANAGEMENT] Fetching monthly lessons for:",at,$e);const Ge=await te.getStudentMonthlyLessons($e,at);if(Ge.success){const Ze={};Ge.monthlyLessons.forEach(De=>{const Ft=De.student_id,Nn=De.week_start_date;Ze[Ft]||(Ze[Ft]={}),Ze[Ft][Nn]={completed_lessons:Number(De.completed_lessons),absent_lessons:Number(De.absent_lessons),total_lessons:Number(De.total_lessons)}}),Tn(Ze),console.log("🔍 [STUDENT_MANAGEMENT] Monthly lessons loaded:",Ze)}}catch($e){console.error("Error fetching monthly lessons:",$e)}finally{zs(!1)}})()},[Ns]);const Ps=async()=>{var G,ge;try{o(!0);const $e=await te.getStudents({...h,status:"active",page:p.page,limit:p.limit,sort_by:C.key,sort_order:C.direction});if($e.success){console.log("📊 [STUDENTS] API Response:",{studentsCount:(G=$e.students)==null?void 0:G.length,total:$e.total});const at=(ge=$e.students)==null?void 0:ge[0];at&&console.log("🔍 [STUDENTS] First student data:",{id:at.id,name:at.name,student_level:at.student_level,hasStudentLevel:"student_level"in at}),n($e.students),m(Ge=>({...Ge,total:$e.total}))}}catch($e){console.error("Error fetching students:",$e)}finally{o(!1)}},Lt=async()=>{try{o(!0);const G=await te.getInactiveStudents();G.success&&i(G.students||[])}catch(G){console.error("Error fetching inactive students:",G),G.status===401&&(window.location.href="/login")}finally{o(!1)}},Ua=async()=>{try{const G=await te.getTeachers();G.success&&T(G.teachers)}catch(G){console.error("Error fetching teachers:",G),G.status===401&&(window.location.href="/login")}},Cn=G=>{const ge=G.getFullYear(),$e=G.getMonth(),at=[],Ge=new Date(ge,$e,1),Ze=new Date(ge,$e+1,0);let De=new Date(Ge);const Ft=Ge.getDay(),Nn=Ft===0?1:(8-Ft)%7;De.setDate(Ge.getDate()+Nn);let Mi=1;for(;De<=Ze;){const si=new Date(De);si.setDate(De.getDate()+6),at.push({weekNumber:Mi,start:De.getFullYear()+"-"+String(De.getMonth()+1).padStart(2,"0")+"-"+String(De.getDate()).padStart(2,"0"),end:si.getFullYear()+"-"+String(si.getMonth()+1).padStart(2,"0")+"-"+String(si.getDate()).padStart(2,"0")}),De.setDate(De.getDate()+7),Mi++}return at},bt=()=>{kn(G=>new Date(G.getFullYear(),G.getMonth()-1))},Ba=()=>{kn(G=>new Date(G.getFullYear(),G.getMonth()+1))},Ha=G=>{if(Ot){const at=cn[G];if(!at)return console.log(`🔍 [GET_LESSON_COUNT] No monthly lessons for student ${G}`),0;const Ge=Ot.start;console.log(`🔍 [GET_LESSON_COUNT] Looking for week ${Ge} in student ${G} lessons:`,at);for(const[Ze,De]of Object.entries(at)){const Ft=new Date(Ze),Nn=Ft.getFullYear()+"-"+String(Ft.getMonth()+1).padStart(2,"0")+"-"+String(Ft.getDate()).padStart(2,"0");if(Nn===Ge)return console.log(`🔍 [GET_LESSON_COUNT] Found matching week ${Ze} (${Nn}):`,De),De.total_lessons||0}return console.log(`🔍 [GET_LESSON_COUNT] No matching week found for ${Ge}`),0}const ge=cn[G];if(!ge)return 0;let $e=0;return Object.values(ge).forEach(at=>{$e+=at.total_lessons||0}),$e},U=(G,ge,$e="success")=>{Je({title:G,message:ge,type:$e}),ie(!0)},se=(G,ge)=>{f($e=>({...$e,[G]:ge})),m($e=>({...$e,page:1}))},W=G=>{N(ge=>({key:G,direction:ge.key===G&&ge.direction==="asc"?"desc":"asc"})),m(ge=>({...ge,page:1}))},de=(G,ge)=>{X({student:G,newStatus:ge}),Pe(!0)},ve=async()=>{try{const{student:G,newStatus:ge}=H;ge===!1?(await te.updateStudent(G.id,{name:G.name,teacher_id:null,lessons_per_week:G.lessons_per_week,is_active:!1}),await Promise.all([Ps(),Lt()]),U("Success!","Student deactivated successfully","success"),Pe(!1),X(null)):ge===!0&&(await te.updateStudent(G.id,{name:G.name,teacher_id:null,lessons_per_week:G.lessons_per_week,is_active:!0}),await Promise.all([Ps(),Lt()]),U("Success!","Student reactivated successfully","success"),Pe(!1),X(null))}catch(G){console.error("Error updating student status:",G),U("Error","Error updating student status","error")}},_e=async()=>{try{if(!b.name){U("Validation Error","Please fill in the student name","error");return}w(!0),(await te.createStudent({name:b.name,lessons_per_week:1,added_date:new Date().toISOString().split("T")[0]})).success&&(v({name:""}),y(!1),Ps(),U("Success!","Student added successfully","success"))}catch(G){console.error("Error adding student:",G),U("Error","Failed to add student","error")}finally{w(!1)}},Ne=async G=>{try{B(!0);const ge=await te.getStudentTeachers(G);if(ge.success){I(ge.teachers||[]);const $e=(ge.teachers||[]).map(Ge=>Ge.id),at=E.filter(Ge=>!$e.includes(Ge.id)&&Ge.is_active===!0);console.log("🔍 [TEACHER_MANAGEMENT] Available teachers calculation:",{assignedTeachers:ge.teachers||[],assignedIds:$e,allTeachers:E.length,activeTeachers:E.filter(Ge=>Ge.is_active===!0).length,availableTeachers:at.length,availableIds:at.map(Ge=>Ge.id),inactiveTeachers:E.filter(Ge=>Ge.is_active===!1).map(Ge=>({id:Ge.id,name:Ge.name}))}),Y(at)}else console.error("❌ [TEACHER_MANAGEMENT] Failed to fetch student teachers:",ge),U("Error","Failed to load teacher assignments. Please run the database migration script.","error"),I([]),Y([])}catch(ge){console.error("❌ [TEACHER_MANAGEMENT] Error fetching student teachers:",ge),console.error("🔍 [DEBUG] Student ID:",G),console.error("🔍 [DEBUG] Error details:",{message:ge.message,status:ge.status,stack:ge.stack}),U("Error",`Failed to load teacher assignments: ${ge.message}`,"error"),I([]),Y([])}finally{B(!1)}},Qe=async G=>{z(G),R(!0),await Ne(G.id)},un=()=>{R(!1),z(null),I([]),Y([])},ti=G=>{q(G),Re(!0)},st=async()=>{try{fe(!0),(await te.deleteStudent(Ee.id)).success&&(await Promise.all([Ps(),Lt()]),U("Success!","Student deleted successfully - all data removed","success")),Re(!1),q(null)}catch(G){console.error("Error deleting student:",G),U("Error","Error deleting student","error")}finally{fe(!1)}};return c.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-3 sm:p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-4",children:[c.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800",children:"Student Management"}),c.jsx("button",{onClick:()=>y(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-3 sm:px-4 py-2 rounded-lg text-sm sm:text-base transition-colors duration-200",children:"Add New Student"})]}),c.jsxs("div",{className:"flex space-x-1 mb-4 sm:mb-6 overflow-x-auto",children:[c.jsxs("button",{onClick:()=>u("active"),className:`px-1.5 sm:px-4 py-0.5 sm:py-2 rounded-lg text-xs sm:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l==="active"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Active (",t.length,")"]}),c.jsx("button",{onClick:()=>u("packages"),className:`px-1.5 sm:px-4 py-0.5 sm:py-2 rounded-lg text-xs sm:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l==="packages"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Packages"}),c.jsxs("button",{onClick:()=>u("inactive"),className:`px-1.5 sm:px-4 py-0.5 sm:py-2 rounded-lg text-xs sm:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l==="inactive"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Inactive (",r.length,")"]})]}),l==="active"&&c.jsx("div",{className:"mb-4 sm:mb-6",children:c.jsxs("div",{className:"flex items-center justify-start space-x-4",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:bt,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"←"}),c.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:Ns.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),c.jsx("button",{onClick:Ba,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"→"})]}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>as(!js),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:Ot?`Week ${Ot.weekNumber}`:"All Weeks"}),js&&c.jsxs("div",{className:"absolute mt-1 bg-white border rounded shadow-lg z-10 min-w-64 right-0",children:[c.jsx("button",{onClick:()=>{kr(null),as(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:"All Weeks"}),sr.map(G=>c.jsxs("button",{onClick:()=>{kr(G),as(!1)},className:"block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors",children:["Week ",G.weekNumber,": ",new Date(G.start).toLocaleDateString()," - ",new Date(G.end).toLocaleDateString()]},G.weekNumber))]})]})]})}),l==="active"&&c.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0",children:[c.jsxs("div",{className:"flex-1 max-w-md",children:[c.jsx("label",{className:"block text-xs sm:text-sm text-gray-600 mb-1",children:"Search by name"}),c.jsx("input",{type:"text",placeholder:"Search by name...",value:h.name,onChange:G=>se("name",G.target.value),className:"px-2 sm:px-3 py-1 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent w-full text-sm"})]}),c.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:Ot?`Showing lesson counts for Week ${Ot.weekNumber} (${new Date(Ot.start).toLocaleDateString()} - ${new Date(Ot.end).toLocaleDateString()})`:`Showing lesson counts for ${Ns.toLocaleDateString("en-US",{month:"long",year:"numeric"})}`})]})}),c.jsxs("div",{className:"w-full overflow-x-auto",children:[ei&&c.jsxs("div",{className:"flex items-center justify-center py-4 text-gray-500",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-500 mr-2"}),"Loading lesson data..."]}),c.jsxs("table",{className:"w-full table-fixed min-w-full",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50",children:[c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none w-1/3 sm:w-auto",onClick:()=>W("name"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{children:"Name"}),C.key==="name"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"↑":"↓"})]})}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none w-1/6 sm:w-auto",onClick:()=>W("teacher_name"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{className:"sm:hidden",children:"T"}),c.jsx("span",{className:"hidden sm:inline",children:"Teacher"}),C.key==="teacher_name"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"↑":"↓"})]})}),c.jsxs("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider w-1/6 sm:w-auto",children:[c.jsx("span",{className:"sm:hidden",children:"L"}),c.jsx("span",{className:"hidden sm:inline",children:"Total Lessons"})]}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none hidden xl:table-cell",onClick:()=>W("added_date"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{children:"Added Date"}),C.key==="added_date"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"↑":"↓"})]})}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none w-1/6 sm:w-auto",onClick:()=>W("is_active"),children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{className:"sm:hidden",children:"A"}),c.jsx("span",{className:"hidden sm:inline",children:"Status"}),C.key==="is_active"&&c.jsx("span",{className:"text-primary-500",children:C.direction==="asc"?"↑":"↓"})]})}),c.jsx("th",{className:"px-2 sm:px-3 py-2 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider w-1/3 sm:w-auto",children:"Actions"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a?c.jsx("tr",{children:c.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"})})}):(l==="active"?t:r).length===0?c.jsx("tr",{children:c.jsxs("td",{colSpan:"6",className:"px-4 py-8 text-center text-sm sm:text-base text-gray-500",children:["No ",l," students found"]})}):(l==="active"?t:r).map(G=>c.jsxs(Q.tr,{className:`hover:bg-gray-50 cursor-pointer ${(e==null?void 0:e.id)===G.id?"bg-primary-50":""}`,onClick:()=>{s(G)},whileHover:{scale:1.01},transition:{duration:.2},children:[c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-xs sm:text-base font-medium text-gray-900",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:ge=>{ge.stopPropagation(),An(G),ln(!0)},className:"text-blue-600 hover:text-blue-800 hover:underline font-medium cursor-pointer truncate",children:G.name}),G.student_level&&c.jsx(dh,{level:G.student_level,size:"xs"})]})}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-xs sm:text-base text-gray-500",children:G.is_active?c.jsxs("button",{onClick:ge=>{ge.stopPropagation(),Qe(G)},className:"text-blue-600 hover:text-blue-800 text-xs px-1 py-0.5 rounded hover:bg-blue-50",children:[c.jsx("span",{className:"sm:hidden",children:"T"}),c.jsx("span",{className:"hidden sm:inline",children:"Teachers"})]}):c.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-xs sm:text-base text-gray-500",children:c.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600",children:Ha(G.id)})}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3 text-sm sm:text-base text-gray-500 hidden xl:table-cell",children:new Date(G.added_date).toLocaleDateString()}),c.jsx("td",{className:"px-2 py-1 sm:px-3 sm:py-3",children:c.jsx("div",{className:"flex items-center space-x-4 sm:space-x-2",children:c.jsxs("span",{className:`inline-flex px-1 py-0.5 sm:px-2 sm:py-1 text-xs sm:text-sm font-semibold rounded-full ${G.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[c.jsx("span",{className:"sm:hidden",children:G.is_active?"A":"I"}),c.jsx("span",{className:"hidden sm:inline",children:G.is_active?"Active":"Inactive"})]})})}),c.jsx("td",{className:"px-1 py-1 sm:px-1 sm:py-3 text-xs sm:text-base text-gray-500",children:c.jsxs("div",{className:"flex space-x-1 sm:space-x-2 sm:justify-start",children:[c.jsxs("button",{type:"button",onClick:ge=>{ge.stopPropagation(),de(G,!G.is_active)},className:`text-xs px-1 py-0.5 sm:px-2 sm:py-1 rounded transition-colors ${G.is_active?"text-red-600 hover:text-red-800 hover:bg-red-50":"text-green-600 hover:text-green-800 hover:bg-green-50"}`,children:[c.jsx("span",{className:"sm:hidden",children:G.is_active?"Deac":"React"}),c.jsx("span",{className:"hidden sm:inline",children:G.is_active?"Deactivate":"Reactivate"})]}),G.is_active&&c.jsxs("button",{type:"button",onClick:ge=>{ge.preventDefault(),ge.stopPropagation(),ti(G)},className:"text-red-600 hover:text-red-800 text-xs px-1 py-0.5 sm:px-2 sm:py-1 rounded hover:bg-red-50",children:[c.jsx("span",{className:"sm:hidden",children:"Del"}),c.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})})]},G.id))})]})]}),l==="packages"&&c.jsx(j$,{}),(l==="active"||l==="inactive")&&c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mt-4 sm:mt-6 gap-2 sm:gap-0",children:[c.jsxs("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(p.page-1)*p.limit+1," to ",Math.min(p.page*p.limit,p.total||0)," of ",p.total||0," students"]}),c.jsxs("div",{className:"flex space-x-2 justify-center sm:justify-end",children:[c.jsx("button",{onClick:()=>m(G=>({...G,page:Math.max(1,G.page-1)})),disabled:p.page===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),c.jsx("button",{onClick:()=>m(G=>({...G,page:G.page+1})),disabled:p.page*p.limit>=p.total,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]}),g&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Student"}),c.jsx("div",{className:"space-y-4",children:c.jsx("input",{type:"text",placeholder:"Student Name",value:b.name,onChange:G=>v(ge=>({...ge,name:G.target.value})),disabled:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>y(!1),disabled:x,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:_e,disabled:x||!b.name.trim(),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[120px]",children:x?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):"Add Student"})]})]})}),Se&&H&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Status Change"}),c.jsx("button",{onClick:()=>Pe(!1),className:"text-gray-400 hover:text-gray-600",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("p",{className:"text-gray-600 mb-4",children:["Are you sure you want to ",H.newStatus?"reactivate":"deactivate"," student"," ",c.jsx("span",{className:"font-semibold",children:H.student.name}),"?"]}),H.newStatus&&c.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:c.jsxs("p",{className:"text-green-800 text-sm",children:[c.jsx("strong",{children:"Note:"})," Student will be reactivated without a teacher assignment. You can assign a teacher later."]})}),!H.newStatus&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:c.jsxs("p",{className:"text-red-800 text-sm",children:[c.jsx("strong",{children:"Warning:"})," Deactivating will remove the student from their current teacher and all active schedules."]})})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{onClick:()=>Pe(!1),className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg transition-colors duration-200",children:"Cancel"}),c.jsx("button",{onClick:ve,className:`px-4 py-2 rounded-lg transition-colors duration-200 ${H.newStatus?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:H.newStatus?"Reactivate":"Deactivate"})]})]})})}),c.jsx(Ca,{isOpen:we&&!!Ee,onClose:()=>Re(!1),title:"⚠️ Permanent Deletion",confirmText:"Delete Permanently",cancelText:"Cancel",onConfirm:st,loading:oe,loadingText:"Deleting...",confirmButtonColor:"bg-red-500 hover:bg-red-600",disabled:oe,children:Ee&&c.jsxs("div",{className:"mb-2",children:[c.jsxs("p",{className:"text-gray-600 mb-4",children:["Are you sure you want to ",c.jsx("strong",{children:"permanently delete"})," student"," ",c.jsx("span",{className:"font-semibold text-red-600",children:Ee.name}),"?"]}),c.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[c.jsx("p",{className:"text-red-800 text-sm font-semibold mb-2",children:"This action will permanently delete:"}),c.jsxs("ul",{className:"text-red-700 text-sm space-y-1",children:[c.jsx("li",{children:"• Student record and all personal data"}),c.jsx("li",{children:"• All lesson reports and attendance data"}),c.jsx("li",{children:"• All schedules (past and future)"}),c.jsx("li",{children:"• All lesson tracking records"}),c.jsx("li",{children:"• All schedule templates"})]}),c.jsx("p",{className:"text-red-800 text-sm font-semibold mt-2",children:"This action cannot be undone!"})]})]})}),c.jsx(su,{isVisible:He,onClose:()=>ie(!1),title:me.title,message:me.message,type:me.type,duration:4e3}),c.jsx(k$,{student:D,isOpen:j,onClose:un,assignedTeachers:L,loading:F}),c.jsx(P$,{isOpen:ft,onClose:()=>ln(!1),student:Zr,onUpdate:G=>{n(ge=>ge.map($e=>$e.id===G.id?G:$e)),i(ge=>ge.map($e=>$e.id===G.id?G:$e))}})]})},oy=({onUpload:s,onError:e,folder:t="lang-school",maxSize:n=5*1024*1024,acceptedTypes:r=["image/jpeg","image/png","image/webp"],transformations:i=null,className:a="",showUploadArea:o=!0,uploadedImageUrl:l=null})=>{const[u,h]=S.useState(!1),[f,p]=S.useState(null),[m,g]=S.useState(!1),[y,b]=S.useState(l),[v,x]=S.useState(!1),w=S.useRef(null);S.useEffect(()=>{b(l)},[l]),S.useEffect(()=>{l!==y&&b(l)},[l,y]);const E=async L=>{if(!L)return;if(!r.includes(L.type)){e==null||e("Invalid file type. Please select a JPEG, PNG, or WebP image.");return}if(L.size>n){e==null||e(`File too large. Maximum size is ${Math.round(n/1024/1024)}MB.`);return}const I=new FileReader;I.onload=O=>p(O.target.result),I.readAsDataURL(L);try{h(!0);const O=await T(L),Y=await te.uploadImage(O,t,null,i);if(Y.success){const F=Y.secure_url||Y.data,B=Y.public_id;b(F),s==null||s(F,B),p(null)}else e==null||e(Y.error||"Upload failed")}catch(O){console.error("Upload error:",O),e==null||e("Upload failed. Please try again.")}finally{h(!1)}},T=L=>new Promise((I,O)=>{const Y=new FileReader;Y.readAsDataURL(L),Y.onload=()=>I(Y.result),Y.onerror=F=>O(F)}),C=L=>{if(!L)return null;try{const I=L.split("/");return I[I.length-1].split(".")[0]}catch(I){return console.error("Error extracting public ID from URL:",I),null}},N=async L=>{if(L.preventDefault(),L.stopPropagation(),!y){e==null||e("No image to delete");return}if(window.confirm("Are you sure you want to delete this image?")){x(!0);try{const I=C(y);if(I){const O=await te.deleteImage(I);if(!O.success){e==null||e(O.error||"Failed to delete image from Cloudinary");return}}b(null),s==null||s(""),alert("Image deleted successfully!")}catch(I){console.error("Delete error:",I),e==null||e("Failed to delete image. Please try again.")}finally{x(!1)}}},j=L=>{L.preventDefault(),L.stopPropagation(),L.type==="dragenter"||L.type==="dragover"?g(!0):L.type==="dragleave"&&g(!1)},R=L=>{L.preventDefault(),L.stopPropagation(),g(!1),L.dataTransfer.files&&L.dataTransfer.files[0]&&E(L.dataTransfer.files[0])},D=()=>{var L;(L=w.current)==null||L.click()},z=L=>{L.target.files&&L.target.files[0]&&E(L.target.files[0])};return c.jsxs("div",{className:`relative ${a}`,children:[y&&y!==""&&y!==null&&y!==void 0&&y.startsWith("http")&&c.jsx("div",{className:"mb-4 flex justify-center",children:c.jsxs("div",{className:"relative",children:[c.jsx("img",{src:y,alt:"Course background image",className:"w-full h-64 object-cover rounded-lg shadow-md"}),c.jsx("button",{type:"button",onClick:N,disabled:v,className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-200",children:v?"Deleting...":"Delete"})]})}),o&&(!y||y===""||y===null||y===void 0||y&&!y.startsWith("http"))&&c.jsxs(Q.div,{className:`
            border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-all duration-200
            ${m?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-400 hover:bg-gray-50"}
            ${u?"pointer-events-none opacity-50":""}
          `,onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:R,onClick:D,whileHover:{scale:1.02},whileTap:{scale:.98},children:[c.jsx("input",{ref:w,type:"file",accept:r.join(","),onChange:z,className:"hidden"}),u?c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Uploading..."})]}):f?c.jsxs("div",{className:"space-y-2",children:[c.jsx("img",{src:f,alt:"Preview",className:"max-h-32 mx-auto rounded-lg"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Processing..."})]}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"w-12 h-12 mx-auto bg-gray-100 rounded-full flex items-center justify-center",children:c.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Click to upload or drag and drop"}),c.jsxs("p",{className:"text-xs text-gray-500",children:["PNG, JPG, WebP up to ",Math.round(n/1024/1024),"MB"]})]})]})]})]})},z2=({level:s,size:e="sm"})=>{if(!s)return null;const t={xs:"px-1.5 py-0.5 text-xs",sm:"px-2 py-1 text-sm",md:"px-3 py-1.5 text-base",lg:"px-4 py-2 text-lg"};return c.jsx("span",{className:`inline-flex items-center rounded-full font-medium bg-gray-100 text-gray-700 ${t[e]}`,children:s})},L$=({isOpen:s,onClose:e,teacher:t,onUpdate:n})=>{const[r,i]=S.useState(""),[a,o]=S.useState(!1),[l,u]=S.useState(""),[h,f]=S.useState(!1),p=[{value:"",label:"No Level Assigned"},{value:"A1",label:"A1 – Beginner"},{value:"A1+",label:"A1+ – High Beginner / Pre-A2"},{value:"A2",label:"A2 – Pre-Intermediate"},{value:"B1",label:"B1 – Intermediate"},{value:"B2",label:"B2 – Upper-Intermediate"},{value:"C1",label:"C1 – Advanced"},{value:"C2",label:"C2 – Proficient"}];S.useEffect(()=>{t&&(i(t.teacher_level||""),u(""))},[t]);const m=()=>{if(console.log("🔍 [TEACHER LEVEL] handleSave called - showing confirmation popup"),!t)return;if(r&&!["A1","A1+","A2","B1","B2","C1","C2"].includes(r)){u("Invalid teacher level");return}f(!0)},g=async()=>{if(t)try{o(!0),u(""),f(!1);const v=await te.updateTeacherLevel(t.id,r);v.success?(n(v.teacher),e()):u(v.error||"Failed to update teacher level")}catch(v){console.error("Error updating teacher level:",v),u("Failed to update teacher level")}finally{o(!1)}},y=v=>{i(v),u("")},b=()=>{a||e()};return!s||!t?null:c.jsxs(c.Fragment,{children:[c.jsx(Cs,{children:s&&c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:b,children:c.jsx(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",onClick:v=>v.stopPropagation(),children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Teacher Level"}),c.jsx("button",{onClick:b,disabled:a,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-gray-900",children:t.name}),c.jsx("p",{className:"text-sm text-gray-600",children:"Current Level"})]}),t.teacher_level&&c.jsx(z2,{level:t.teacher_level})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select New Level"}),c.jsx("select",{value:r,onChange:v=>y(v.target.value),disabled:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:p.map(v=>c.jsx("option",{value:v.value,children:v.label},v.value))})]}),l&&c.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md",children:c.jsx("p",{className:"text-sm text-red-600",children:l})})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{onClick:b,disabled:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:m,disabled:a,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Saving...":"Save"})]})]})})})}),h&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Confirm Level Change"}),c.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to change ",t==null?void 0:t.name,"'s level to ",c.jsx("strong",{children:r||"No Level"}),"?"]}),c.jsxs("div",{className:"flex justify-center space-x-3",children:[c.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{onClick:g,disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Saving...":"Confirm"})]})]})})})]})},D$=({onTeacherSelect:s,selectedTeacher:e})=>{const[t,n]=S.useState([]),[r,i]=S.useState([]),[a,o]=S.useState(!0),[l,u]=S.useState("active"),[h,f]=S.useState(!1),[p,m]=S.useState(!1),[g,y]=S.useState(!1),[b,v]=S.useState(!1),[x,w]=S.useState(null),[E,T]=S.useState({name:"",username:"",password:"",description:"",photo_url:"",meeting_id:"",meeting_password:""}),[C,N]=S.useState(!1),[j,R]=S.useState(!1),[D,z]=S.useState({title:"",message:"",type:"success"}),[L,I]=S.useState(!1),[O,Y]=S.useState(!1),[F,B]=S.useState(!1),[M,$]=S.useState(null);S.useEffect(()=>{l==="active"?K():l==="inactive"&&J()},[l]),S.useEffect(()=>{(async()=>{await Promise.all([K(),J()])})()},[]);const K=async()=>{try{o(!0);const q=await te.getTeachers({status:"active"});q.success&&n(q.teachers)}catch(q){console.error("Error fetching teachers:",q)}finally{o(!1)}},J=async()=>{try{o(!0);const q=await te.getTeachers({status:"inactive"});q.success&&i(q.teachers)}catch(q){console.error("Error fetching inactive teachers:",q)}finally{o(!1)}},Z=(q,oe,fe="success")=>{z({title:q,message:oe,type:fe}),R(!0)},pe=async()=>{try{if(!E.name||!E.username||!E.password){Z("Validation Error","Please fill in all required fields","error");return}I(!0),(await te.createTeacher({name:E.name,username:E.username,password:E.password,description:E.description,photo_url:E.photo_url,meeting_id:E.meeting_id,meeting_password:E.meeting_password})).success&&(T({name:"",username:"",password:"",description:"",photo_url:"",meeting_id:"",meeting_password:""}),f(!1),K(),Z("Success!","Teacher added successfully","success"))}catch(q){console.error("Error adding teacher:",q),Z("Error","Failed to add teacher","error")}finally{I(!1)}},Se=async()=>{try{if(!x.name){Z("Validation Error","Please fill in all required fields","error");return}Y(!0),(await te.updateTeacher(x.id,{name:x.name,description:x.description,photo_url:x.photo_url,meeting_id:x.meeting_id,meeting_password:x.meeting_password})).success&&(w(null),m(!1),await K(),Z("Success!","Teacher updated successfully","success"))}catch(q){console.error("Error updating teacher:",q),Z("Error","Failed to update teacher","error")}finally{Y(!1)}},Pe=async(q,oe)=>{try{oe===!1?(await te.deactivateTeacher(q.id)).success&&(await Promise.all([K(),J()]),Z("Success!","Teacher deactivated successfully - future schedules removed","success")):oe===!0&&(await te.reactivateTeacher(q.id)).success&&(await Promise.all([K(),J()]),Z("Success!","Teacher reactivated successfully","success"))}catch(fe){console.error("Error updating teacher status:",fe),Z("Error","Error updating teacher status","error")}},H=async q=>{try{N(!0),(await te.deleteTeacher(q.id)).success&&(await Promise.all([K(),J()]),Z("Success!","Teacher deleted successfully - all data removed","success"))}catch(oe){console.error("Error deleting teacher:",oe),Z("Error","Error deleting teacher","error")}finally{N(!1)}},X=async(q,oe)=>{try{(await te.changeTeacherPassword(q,oe)).success&&(Z("Success!","Password changed successfully","success"),y(!1))}catch(fe){console.error("Error changing password:",fe),Z("Error","Failed to change password","error")}},we=q=>{w({...q}),m(!0)},Re=q=>{w(q),v(!0)},Ee=q=>{n(oe=>oe.map(fe=>fe.id===q.id?{...fe,teacher_level:q.teacher_level}:fe)),i(oe=>oe.map(fe=>fe.id===q.id?{...fe,teacher_level:q.teacher_level}:fe))};return c.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0 mb-6",children:[c.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-gray-800 text-center sm:text-left",children:"Teacher Management"}),c.jsx("button",{onClick:()=>f(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-3 sm:px-4 py-1.5 sm:py-2 rounded text-sm sm:text-base transition-colors duration-200",children:"Add New Teacher"})]}),c.jsxs("div",{className:"flex space-x-1 mb-6",children:[c.jsxs("button",{onClick:()=>u("active"),className:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${l==="active"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Active Teachers (",t.length,")"]}),c.jsx("button",{onClick:()=>u("idpass"),className:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${l==="idpass"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ID/Pass"}),c.jsxs("button",{onClick:()=>u("inactive"),className:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${l==="inactive"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["Inactive Teachers (",r.length,")"]})]}),l==="idpass"?c.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"w-full",children:[c.jsx("thead",{className:"bg-gray-50",children:c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-semibold text-neutral-800",children:"Teacher"}),c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-semibold text-neutral-800",children:"Meeting ID"}),c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-semibold text-neutral-800",children:"Meeting Pass"})]})}),c.jsx("tbody",{children:a?c.jsx("tr",{children:c.jsx("td",{colSpan:"3",className:"px-4 py-8 text-center",children:c.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-500 mx-auto"})})}):t.length===0?c.jsx("tr",{children:c.jsx("td",{colSpan:"3",className:"px-4 py-8 text-center text-gray-500",children:"No teachers found"})}):t.map(q=>c.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:q.photo_url?c.jsx("img",{src:q.photo_url,alt:q.name,className:"w-8 h-8 rounded-full object-cover"}):c.jsx("span",{className:"text-primary-600 font-semibold text-sm",children:q.name.charAt(0)})}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:oe=>{oe.stopPropagation(),$(q),B(!0)},className:"text-blue-600 hover:text-blue-800 hover:underline font-medium cursor-pointer truncate text-2xs sm:text-xs md:text-sm",children:q.name}),q.teacher_level&&c.jsx(z2,{level:q.teacher_level,size:"xs"})]})]})}),c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2",children:c.jsx("span",{className:"text-2xs sm:text-xs md:text-sm text-neutral-600",children:q.meeting_id||"-"})}),c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2",children:c.jsx("span",{className:"text-2xs sm:text-xs md:text-sm text-neutral-600",children:q.meeting_password||"-"})})]},q.id))})]})})}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a?c.jsx("div",{className:"col-span-full flex justify-center py-8",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):(l==="active"?t:r).length===0?c.jsxs("div",{className:"col-span-full text-center text-gray-500 py-8",children:["No ",l," teachers found"]}):(l==="active"?t:r).map(q=>c.jsxs(Q.div,{className:`border rounded-lg p-4 cursor-pointer transition-all duration-200 ${(e==null?void 0:e.id)===q.id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-primary-300 hover:shadow-md"}`,onClick:()=>s(q),whileHover:{scale:1.02},transition:{duration:.2},children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[c.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:q.photo_url?c.jsx("img",{src:q.photo_url,alt:q.name,className:"w-12 h-12 rounded-full object-cover"}):c.jsx("span",{className:"text-primary-600 font-semibold text-lg",children:q.name.charAt(0)})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:q.name}),c.jsx("p",{className:"text-sm text-gray-500 truncate",children:q.meeting_id||"No Meeting ID"})]})]}),q.description&&c.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:q.description}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${q.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:q.is_active?"Active":"Inactive"}),c.jsx("button",{onClick:oe=>{oe.stopPropagation(),Pe(q,!q.is_active)},className:`text-xs px-2 py-1 rounded transition-colors ${q.is_active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:q.is_active?"Deactivate":"Reactivate"})]}),c.jsxs("div",{className:"flex space-x-1",children:[c.jsx("button",{onClick:oe=>{oe.stopPropagation(),we(q)},className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50",children:"Edit"}),c.jsx("button",{onClick:oe=>{oe.stopPropagation(),Re(q)},className:"text-yellow-600 hover:text-yellow-800 text-xs px-2 py-1 rounded hover:bg-yellow-50",children:"Password"}),q.is_active&&c.jsx("button",{onClick:oe=>{oe.stopPropagation(),H(q)},className:"text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded hover:bg-red-50",children:"Delete"})]})]})]},q.id))}),h&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Teacher"}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"Teacher Name *",value:E.name,onChange:q=>T(oe=>({...oe,name:q.target.value})),disabled:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"text",placeholder:"Meeting ID",value:E.meeting_id,onChange:q=>T(oe=>({...oe,meeting_id:q.target.value})),disabled:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"text",placeholder:"Meeting Password",value:E.meeting_password,onChange:q=>T(oe=>({...oe,meeting_password:q.target.value})),disabled:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"text",placeholder:"Username *",value:E.username,onChange:q=>T(oe=>({...oe,username:q.target.value})),disabled:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("input",{type:"password",placeholder:"Password *",value:E.password,onChange:q=>T(oe=>({...oe,password:q.target.value})),disabled:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("textarea",{placeholder:"Description",value:E.description,onChange:q=>T(oe=>({...oe,description:q.target.value})),rows:3,disabled:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Teacher Photo"}),c.jsx("div",{className:L?"pointer-events-none opacity-50":"",children:c.jsx(oy,{onUpload:q=>T(oe=>({...oe,photo_url:q})),onError:q=>console.error("Upload error:",q),folder:"lang-school/teachers",className:"w-full",uploadedImageUrl:E.photo_url,showUploadArea:!E.photo_url})})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>f(!1),disabled:L,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:pe,disabled:L||!E.name.trim()||!E.username.trim()||!E.password.trim(),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[140px]",children:L?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):"Add Teacher"})]})]})}),p&&x&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Teacher"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),c.jsx("input",{type:"text",placeholder:"Teacher Name *",value:x.name,onChange:q=>w(oe=>({...oe,name:q.target.value})),disabled:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meeting ID"}),c.jsx("input",{type:"text",placeholder:"Meeting ID",value:x.meeting_id||"",onChange:q=>w(oe=>({...oe,meeting_id:q.target.value})),disabled:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meeting Password"}),c.jsx("input",{type:"text",placeholder:"Meeting Password",value:x.meeting_password||"",onChange:q=>w(oe=>({...oe,meeting_password:q.target.value})),disabled:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),c.jsx("textarea",{placeholder:"Description",value:x.description||"",onChange:q=>w(oe=>({...oe,description:q.target.value})),rows:3,disabled:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Teacher Photo"}),c.jsx("div",{className:O?"pointer-events-none opacity-50":"",children:c.jsx(oy,{onUpload:q=>w(oe=>({...oe,photo_url:q})),onError:q=>console.error("Upload error:",q),folder:"lang-school/teachers",className:"w-full",uploadedImageUrl:x.photo_url,showUploadArea:!0})}),x.photo_url&&c.jsx("p",{className:"text-sm text-neutral-600 mt-2",children:"Click above to upload a new photo"})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>m(!1),disabled:O,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{onClick:Se,disabled:O||!x.name.trim(),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[140px]",children:O?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):"Update Teacher"})]})]})}),b&&x&&c.jsx(I$,{teacher:x,onClose:()=>v(!1),onEditPassword:()=>{v(!1),y(!0)}}),g&&x&&c.jsx(M$,{teacher:x,onClose:()=>y(!1),onChangePassword:X}),c.jsx(su,{isVisible:j,onClose:()=>R(!1),title:D.title,message:D.message,type:D.type,duration:4e3}),c.jsx(L$,{isOpen:F,onClose:()=>B(!1),teacher:M,onUpdate:Ee})]})},M$=({teacher:s,onClose:e,onChangePassword:t})=>{const[n,r]=S.useState(""),[i,a]=S.useState(""),[o,l]=S.useState(!1),u=h=>{if(h.preventDefault(),n!==i){alert("Passwords do not match");return}if(n.length<6){alert("Password must be at least 6 characters long");return}t(s.id,n)};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Change Password for ",s.name]}),c.jsxs("form",{onSubmit:u,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:o?"text":"password",value:n,onChange:h=>r(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent pr-10",required:!0}),c.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:o?"👁️":"👁️‍🗨️"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),c.jsx("input",{type:"password",value:i,onChange:h=>a(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:"Change Password"})]})]})]})})},I$=({teacher:s,onClose:e,onEditPassword:t})=>{const[n,r]=S.useState(""),[i,a]=S.useState(!1),[o,l]=S.useState(""),[u,h]=S.useState(!1);S.useEffect(()=>{s?(r(""),l(""),h(!1),a(!1),f()):(r(""),l(""),h(!1),a(!1))},[s]);const f=async()=>{try{a(!0),l("");const m=await te.getTeacherPassword(s.id);m.success?r(m.password_info.password):l(m.error||"Failed to fetch password")}catch(m){console.error("Error fetching password:",m),l("Failed to fetch password")}finally{a(!1)}},p=async()=>{try{await navigator.clipboard.writeText(n)}catch(m){console.error("Failed to copy password:",m)}};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Current Password - ",s.name]}),i&&c.jsxs("div",{className:"text-center py-4",children:[c.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary-500"}),c.jsx("p",{className:"mt-2 text-gray-600",children:"Loading password..."})]}),o&&c.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-4",children:o}),!i&&!o&&n&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:u?"text":"password",value:n,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"}),c.jsx("button",{type:"button",onClick:()=>h(!u),className:"px-3 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:u?"Hide":"Show"}),c.jsx("button",{type:"button",onClick:p,className:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm",children:"Copy"})]})]}),c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:c.jsxs("p",{className:"text-yellow-800 text-sm",children:[c.jsx("strong",{children:"Note:"}),` This is the teacher's current password. Click "Change Password" below to set a new one.`]})})]}),c.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Close"}),c.jsx("button",{onClick:t,className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg",children:"Change Password"})]})]})})},O$=()=>{var Se,Pe;const[s,e]=S.useState("mission"),[t,n]=S.useState({title:"",content:"",banner_image:"",banner_image_public_id:""}),[r,i]=S.useState([]),[a,o]=S.useState({display_count:3,rotation_type:"random"}),[l,u]=S.useState([]),[h,f]=S.useState([]),[p,m]=S.useState(!0),[g,y]=S.useState(!1),[b,v]=S.useState(null),[x,w]=S.useState({name:"",description:"",detailed_description:"",background_image:"",background_image_public_id:"",display_order:0}),[E,T]=S.useState(!1),[C,N]=S.useState(!1),[j,R]=S.useState(!1),[D,z]=S.useState({title:"",message:"",type:"success"});S.useEffect(()=>{I()},[]);const L=(H,X,we="success")=>{z({title:H,message:X,type:we}),R(!0)},I=async()=>{try{m(!0);const[H,X,we,Re]=await Promise.all([te.getMissionContent(),te.getCourses(),te.getShowcaseSettings(),te.getTeachers()]);H.success&&n(H.mission),X.success&&i(X.courses),we.success&&o(we.settings),Re.success&&u(Re.teachers)}catch(H){console.error("Error fetching content:",H)}finally{m(!1)}},O=async()=>{try{T(!0),(await te.updateMissionContent(t)).success&&L("Success!","Mission content saved successfully","success")}catch(H){console.error("Error saving mission content:",H),L("Error","Failed to save mission content","error")}finally{T(!1)}},Y=async()=>{try{console.log("Saving showcase settings:",a),console.log("Selected teachers:",h);const H=await te.updateShowcaseSettings(a);if(console.log("Showcase settings response:",H),H.success)if(a.rotation_type==="featured")if(h.length>0){console.log("Saving featured teachers:",h);try{const X=await te.setFeaturedTeachers(h);console.log("Featured teachers response:",X),X&&X.success?alert("Showcase settings and featured teachers saved successfully"):(console.error("Featured teachers API failed:",X),alert(`Showcase settings saved, but failed to save featured teachers: ${(X==null?void 0:X.error)||"Unknown error"}`))}catch(X){console.error("Featured teachers API error:",X),alert(`Showcase settings saved, but failed to save featured teachers: ${X.message}`)}}else{alert("Please select at least one teacher for featured teachers mode");return}else alert("Showcase settings saved successfully");else alert("Failed to save showcase settings")}catch(H){console.error("Error saving showcase settings:",H),alert("Failed to save showcase settings")}},F=(H,X)=>{n(we=>({...we,banner_image:H,banner_image_public_id:X}))},B=(H,X)=>{b?v(we=>({...we,background_image:H,background_image_public_id:X})):w(we=>({...we,background_image:H,background_image_public_id:X}))},M=async()=>{try{if(!x.name||!x.description){alert("Please fill in required fields");return}N(!0),(await te.createCourse(x)).success&&(w({name:"",description:"",detailed_description:"",background_image:"",background_image_public_id:"",display_order:r.length+1}),y(!1),I(),L("Success!","Course added successfully","success"))}catch(H){console.error("Error adding course:",H),L("Error","Failed to add course","error")}finally{N(!1)}},$=async()=>{try{if(!b.name||!b.description){alert("Please fill in required fields");return}N(!0),(await te.updateCourse(b.id,b)).success&&(v(null),y(!1),I(),L("Success!","Course updated successfully","success"))}catch(H){console.error("Error updating course:",H),L("Error","Failed to update course","error")}finally{N(!1)}},K=async H=>{if(window.confirm("Are you sure you want to delete this course?"))try{(await te.deleteCourse(H)).success&&(I(),L("Success!","Course deleted successfully","success"))}catch(X){console.error("Error deleting course:",X),L("Error","Failed to delete course","error")}},J=async(H,X)=>{try{(await te.toggleCourse(H,X)).success&&I()}catch(we){console.error("Error toggling course:",we),L("Error","Failed to toggle course","error")}},Z=H=>{v({...H}),y(!0)},pe=()=>{v(null),w({name:"",description:"",detailed_description:"",background_image:"",background_image_public_id:"",display_order:r.length+1}),y(!0)};return p?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 sm:p-6",children:[c.jsx("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:c.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800",children:"Content Management"})}),c.jsx("div",{className:"flex space-x-1 mb-6 overflow-x-auto",children:[{id:"mission",label:"Mission Content"},{id:"courses",label:"Courses"},{id:"showcase",label:"Teacher Showcase"}].map(H=>c.jsx("button",{type:"button",onClick:()=>e(H.id),className:`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors duration-200 text-xs sm:text-sm whitespace-nowrap flex-shrink-0 ${s===H.id?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:H.label},H.id))}),s==="mission"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mission Title"}),c.jsx("input",{type:"text",value:t.title,onChange:H=>n(X=>({...X,title:H.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mission Content"}),c.jsx("textarea",{value:t.content,onChange:H=>n(X=>({...X,content:H.target.value})),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Banner Image"}),c.jsx(oy,{onUpload:(H,X)=>{if(console.log("🖼️ [CONTENT] Image upload callback",{url:H,publicId:X,currentBanner:t.banner_image}),F(H,X),H){const we={...t,banner_image:H,banner_image_public_id:X};console.log("💾 [CONTENT] Updating mission content with new image",we),te.updateMissionContent(we).then(Re=>{console.log("✅ [CONTENT] Mission content updated successfully",Re),n(we)}).catch(Re=>{console.error("❌ [CONTENT] Error updating mission content:",Re),alert("Failed to save image")})}else{const we={...t,banner_image:"",banner_image_public_id:null};console.log("🗑️ [CONTENT] Clearing mission image",we),te.updateMissionContent(we).then(()=>{n(we)}).catch(Re=>{console.error("Error deleting image:",Re),alert("Failed to delete image")})}},onError:H=>console.error("Mission image error:",H),folder:"lang-school/banners",transformations:[{width:1200,height:400,crop:"fill"}],uploadedImageUrl:t.banner_image,showUploadArea:!0,className:"mb-4"})]}),c.jsx("button",{type:"button",onClick:O,disabled:E,className:"w-full sm:w-auto bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-4 sm:px-6 py-2 sm:py-2 rounded-lg transition-colors duration-200 text-sm sm:text-base flex items-center justify-center min-w-[180px]",children:E?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Mission Content"})]}),s==="courses"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0",children:[c.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"Course Management"}),c.jsx("button",{type:"button",onClick:pe,disabled:C,className:"w-full sm:w-auto bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg transition-colors duration-200 text-sm sm:text-base",children:"Add New Course"})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(H=>c.jsxs(Q.div,{className:"border rounded-lg p-4 hover:shadow-md transition-shadow duration-200",whileHover:{scale:1.02},children:[c.jsx("div",{className:"aspect-video bg-gray-200 rounded-lg mb-3 overflow-hidden",children:H.background_image&&H.background_image.startsWith("http")?c.jsx("img",{src:H.background_image,alt:H.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"})}),c.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:H.name}),c.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:H.description}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${H.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:H.is_active?"Active":"Inactive"}),c.jsxs("div",{className:"flex space-x-1",children:[c.jsx("button",{type:"button",onClick:()=>Z(H),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50",children:"Edit"}),c.jsx("button",{type:"button",onClick:()=>J(H.id,!H.is_active),className:`text-xs px-2 py-1 rounded hover:bg-gray-50 ${H.is_active?"text-red-600 hover:text-red-800":"text-green-600 hover:text-green-800"}`,children:H.is_active?"Deactivate":"Activate"}),c.jsx("button",{type:"button",onClick:()=>K(H.id),className:"text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded hover:bg-red-50",children:"Delete"})]})]})]},H.id))})]}),s==="showcase"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Teachers to Display"}),c.jsx("input",{type:"number",min:"1",max:"10",value:a.display_count,onChange:H=>o(X=>({...X,display_count:parseInt(H.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rotation Type"}),c.jsxs("select",{value:a.rotation_type,onChange:H=>o(X=>({...X,rotation_type:H.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[c.jsx("option",{value:"random",children:"Random Selection"}),c.jsx("option",{value:"featured",children:"Featured Teachers Only"}),c.jsx("option",{value:"alphabetical",children:"Alphabetical Order"})]})]}),a.rotation_type==="featured"&&c.jsx("div",{className:"mt-8",children:c.jsx(I2,{teachers:l,showSelection:!0,selectedTeachers:h,onSelectionChange:f,title:"Select Featured Teachers",subtitle:"Choose which teachers to feature on the login page",displayCount:a.display_count})}),c.jsx("button",{type:"button",onClick:Y,className:"w-full sm:w-auto bg-primary-500 hover:bg-primary-600 text-white px-4 sm:px-6 py-2 rounded-lg transition-colors duration-200 text-sm sm:text-base",children:"Save Showcase Settings"})]}),g&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:b?"Edit Course":"Add New Course"}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"Course Name *",value:b?b.name:x.name,onChange:H=>{b?v(X=>({...X,name:H.target.value})):w(X=>({...X,name:H.target.value}))},disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("textarea",{placeholder:"Short Description *",value:b?b.description:x.description,onChange:H=>{b?v(X=>({...X,description:H.target.value})):w(X=>({...X,description:H.target.value}))},rows:3,disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsx("textarea",{placeholder:"Detailed Description (for popup)",value:b?b.detailed_description:x.detailed_description,onChange:H=>{b?v(X=>({...X,detailed_description:H.target.value})):w(X=>({...X,detailed_description:H.target.value}))},rows:4,disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Background Image"}),c.jsx("div",{className:C?"pointer-events-none opacity-50":"",children:c.jsx(oy,{onUpload:(H,X)=>B(H,X),onError:H=>console.error("Course image error:",H),folder:"lang-school/courses",transformations:[{width:800,height:600,crop:"fill"}],uploadedImageUrl:b?b.background_image:x.background_image,showUploadArea:!0})})]}),c.jsx("input",{type:"number",placeholder:"Display Order",value:b?b.display_order:x.display_order,onChange:H=>{b?v(X=>({...X,display_order:parseInt(H.target.value)})):w(X=>({...X,display_order:parseInt(H.target.value)}))},disabled:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>y(!1),disabled:C,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Cancel"}),c.jsx("button",{type:"button",onClick:b?$:M,disabled:C||!((Se=b?b.name:x.name)!=null&&Se.trim())||!((Pe=b?b.description:x.description)!=null&&Pe.trim()),className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200 flex items-center justify-center min-w-[140px]",children:C?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),b?"Updating...":"Adding..."]}):b?"Update Course":"Add Course"})]})]})}),c.jsx(su,{isOpen:j,onClose:()=>R(!1),title:D.title,message:D.message,type:D.type})]})},F$="modulepreload",$$=function(s){return"/"+s},OA={},Gm=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=$$(l),l in OA)return;OA[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":F$,u||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),u)return new Promise((p,m)=>{f.addEventListener("load",p),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},U$=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Gm(async()=>{const{default:n}=await Promise.resolve().then(()=>xh);return{default:n}},[]).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class D_ extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class FA extends D_{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class $A extends D_{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class UA extends D_{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Vw;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(Vw||(Vw={}));var B$=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};class H${constructor(e,{headers:t={},customFetch:n,region:r=Vw.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=U$(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return B$(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:a,signal:o}=t;let l={},{region:u}=t;u||(u=this.region);const h=new URL(`${this.url}/${e}`);u&&u!=="any"&&(l["x-region"]=u,h.searchParams.set("forceFunctionRegion",u));let f;a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",f=a):typeof a=="string"?(l["Content-Type"]="text/plain",f=a):typeof FormData<"u"&&a instanceof FormData?f=a:(l["Content-Type"]="application/json",f=JSON.stringify(a)));const p=yield this.fetch(h.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),r),body:f,signal:o}).catch(b=>{throw b.name==="AbortError"?b:new FA(b)}),m=p.headers.get("x-relay-error");if(m&&m==="true")throw new $A(p);if(!p.ok)throw new UA(p);let g=((n=p.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return g==="application/json"?y=yield p.json():g==="application/octet-stream"?y=yield p.blob():g==="text/event-stream"?y=p:g==="multipart/form-data"?y=yield p.formData():y=yield p.text(),{data:y,error:null,response:p}}catch(r){return r instanceof Error&&r.name==="AbortError"?{data:null,error:new FA(r)}:{data:null,error:r,response:r instanceof UA||r instanceof $A?r.context:void 0}}})}}var xn={},M_={},dv={},qm={},hv={},fv={},V$=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},hh=V$();const z$=hh.fetch,W2=hh.fetch.bind(hh),G2=hh.Headers,W$=hh.Request,G$=hh.Response,xh=Object.freeze(Object.defineProperty({__proto__:null,Headers:G2,Request:W$,Response:G$,default:W2,fetch:z$},Symbol.toStringTag,{value:"Module"})),q$=iL(xh);var pv={};Object.defineProperty(pv,"__esModule",{value:!0});let K$=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};pv.default=K$;var q2=Sr&&Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(fv,"__esModule",{value:!0});const X$=q2(q$),Y$=q2(pv);let J$=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=X$.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let r=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,l,u;let h=null,f=null,p=null,m=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((a=this.headers.get("Accept"))===null||a===void 0)&&a.includes("application/vnd.pgrst.plan+text"))?f=x:f=JSON.parse(x))}const b=(o=this.headers.get("Prefer"))===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");b&&v&&v.length>1&&(p=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(h={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,p=null,m=406,g="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const b=await i.text();try{h=JSON.parse(b),Array.isArray(h)&&i.status===404&&(f=[],h=null,m=200,g="OK")}catch{i.status===404&&b===""?(m=204,g="No Content"):h={message:b}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,m=200,g="OK"),h&&this.shouldThrowOnError)throw new Y$.default(h)}return{error:h,data:f,count:p,status:m,statusText:g}});return this.shouldThrowOnError||(r=r.catch(i=>{var a,o,l;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};fv.default=J$;var Q$=Sr&&Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(hv,"__esModule",{value:!0});const Z$=Q$(fv);let e5=class extends Z$.default{select(e){let t=!1;const n=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:i=r}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:r=n}={}){const i=typeof r>"u"?"offset":`${r}.offset`,a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:i=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${u}"; options=${l};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};hv.default=e5;var t5=Sr&&Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(qm,"__esModule",{value:!0});const s5=t5(hv);let n5=class extends s5.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const a=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};qm.default=n5;var r5=Sr&&Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(dv,"__esModule",{value:!0});const Rh=r5(qm);let i5=class{constructor(e,{headers:t={},schema:n,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=r}select(e,{head:t=!1,count:n}={}){const r=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),n&&this.headers.append("Prefer",`count=${n}`),new Rh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:n=!0}={}){var r;const i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new Rh.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:i=!0}={}){var a;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const l=e.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new Rh.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}update(e,{count:t}={}){var n;const r="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Rh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:e}={}){var t;const n="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Rh.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};dv.default=i5;var K2=Sr&&Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(M_,"__esModule",{value:!0});const a5=K2(dv),o5=K2(qm);let l5=class X2{constructor(e,{headers:t={},schema:n,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new a5.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new X2(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:r=!1,count:i}={}){var a;let o;const l=new URL(`${this.url}/rpc/${e}`);let u;n||r?(o=n?"HEAD":"GET",Object.entries(t).filter(([f,p])=>p!==void 0).map(([f,p])=>[f,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([f,p])=>{l.searchParams.append(f,p)})):(o="POST",u=t);const h=new Headers(this.headers);return i&&h.set("Prefer",`count=${i}`),new o5.default({method:o,url:l,headers:h,schema:this.schemaName,body:u,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};M_.default=l5;var wh=Sr&&Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(xn,"__esModule",{value:!0});xn.PostgrestError=xn.PostgrestBuilder=xn.PostgrestTransformBuilder=xn.PostgrestFilterBuilder=xn.PostgrestQueryBuilder=xn.PostgrestClient=void 0;const Y2=wh(M_);xn.PostgrestClient=Y2.default;const J2=wh(dv);xn.PostgrestQueryBuilder=J2.default;const Q2=wh(qm);xn.PostgrestFilterBuilder=Q2.default;const Z2=wh(hv);xn.PostgrestTransformBuilder=Z2.default;const ej=wh(fv);xn.PostgrestBuilder=ej.default;const tj=wh(pv);xn.PostgrestError=tj.default;var c5=xn.default={PostgrestClient:Y2.default,PostgrestQueryBuilder:J2.default,PostgrestFilterBuilder:Q2.default,PostgrestTransformBuilder:Z2.default,PostgrestBuilder:ej.default,PostgrestError:tj.default};const{PostgrestClient:u5,PostgrestQueryBuilder:eV,PostgrestFilterBuilder:tV,PostgrestTransformBuilder:sV,PostgrestBuilder:nV,PostgrestError:rV}=c5;class d5{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,r=parseInt(n.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const h5="2.15.5",f5=`realtime-js/${h5}`,p5="1.0.0",zw=1e4,m5=1e3,g5=100;var Af;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Af||(Af={}));var Zt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(Zt||(Zt={}));var zr;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(zr||(zr={}));var Ww;(function(s){s.websocket="websocket"})(Ww||(Ww={}));var El;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(El||(El={}));class y5{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const r=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=n.decode(e.slice(a,a+r));a=a+r;const l=n.decode(e.slice(a,a+i));a=a+i;const u=JSON.parse(n.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:u}}}class sj{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var pt;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(pt||(pt={}));const BA=(s,e,t={})=>{var n;const r=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,a)=>(i[a]=v5(a,s,e,r),i),{})},v5=(s,e,t,n)=>{const r=e.find(o=>o.name===s),i=r==null?void 0:r.type,a=t[s];return i&&!n.includes(i)?nj(i,a):Gw(a)},nj=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return S5(e,t)}switch(s){case pt.bool:return x5(e);case pt.float4:case pt.float8:case pt.int2:case pt.int4:case pt.int8:case pt.numeric:case pt.oid:return w5(e);case pt.json:case pt.jsonb:return b5(e);case pt.timestamp:return _5(e);case pt.abstime:case pt.date:case pt.daterange:case pt.int4range:case pt.int8range:case pt.money:case pt.reltime:case pt.text:case pt.time:case pt.timestamptz:case pt.timetz:case pt.tsrange:case pt.tstzrange:return Gw(e);default:return Gw(e)}},Gw=s=>s,x5=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},w5=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},b5=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},S5=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,n=s[t];if(s[0]==="{"&&n==="}"){let i;const a=s.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>nj(e,o))}return s},_5=s=>typeof s=="string"?s.replace(" ","T"):s,rj=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class yx{constructor(e,t,n={},r=zw){this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var HA;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(HA||(HA={}));class kf{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=kf.syncState(this.state,r,i,a),this.pendingDiffs.forEach(l=>{this.state=kf.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=kf.syncDiff(this.state,r,i,a),o())}),this.onJoin((r,i,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:a})}),this.onLeave((r,i,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(u,h)=>{a[u]||(l[u]=h)}),this.map(a,(u,h)=>{const f=i[u];if(f){const p=h.map(b=>b.presence_ref),m=f.map(b=>b.presence_ref),g=h.filter(b=>m.indexOf(b.presence_ref)<0),y=f.filter(b=>p.indexOf(b.presence_ref)<0);g.length>0&&(o[u]=g),y.length>0&&(l[u]=y)}else o[u]=h}),this.syncDiff(i,{joins:o,leaves:l},n,r)}static syncDiff(e,t,n,r){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(i,(o,l)=>{var u;const h=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(l),h.length>0){const f=e[o].map(m=>m.presence_ref),p=h.filter(m=>f.indexOf(m.presence_ref)<0);e[o].unshift(...p)}n(o,h,l)}),this.map(a,(o,l)=>{let u=e[o];if(!u)return;const h=l.map(f=>f.presence_ref);u=u.filter(f=>h.indexOf(f.presence_ref)<0),e[o]=u,r(o,u,l),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return"metas"in r?t[n]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var VA;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(VA||(VA={}));var Tf;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Tf||(Tf={}));var Hi;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Hi||(Hi={}));class I_{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Zt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new yx(this,zr.join,this.params,this.timeout),this.rejoinTimer=new sj(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Zt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Zt.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Zt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Zt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Zt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(zr.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new kf(this),this.broadcastEndpointURL=rj(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Zt.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,u=(r=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&r!==void 0?r:[],h=!!this.bindings[Tf.PRESENCE]&&this.bindings[Tf.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},p={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:h}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(m=>e==null?void 0:e(Hi.CHANNEL_ERROR,m)),this._onClose(()=>e==null?void 0:e(Hi.CLOSED)),this.updateJoinPayload(Object.assign({config:p},f)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:m})=>{var g;if(this.socket.setAuth(),m===void 0){e==null||e(Hi.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,b=(g=y==null?void 0:y.length)!==null&&g!==void 0?g:0,v=[];for(let x=0;x<b;x++){const w=y[x],{filter:{event:E,schema:T,table:C,filter:N}}=w,j=m&&m[x];if(j&&j.event===E&&j.schema===T&&j.table===C&&j.filter===N)v.push(Object.assign(Object.assign({},w),{id:j.id}));else{this.unsubscribe(),this.state=Zt.errored,e==null||e(Hi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(Hi.SUBSCRIBED);return}}).receive("error",m=>{this.state=Zt.errored,e==null||e(Hi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Hi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Zt.joined&&e===Tf.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((r=u.body)===null||r===void 0?void 0:r.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Zt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(zr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new yx(this,zr.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Zt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,i=setTimeout(()=>r.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),a}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new yx(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>g5){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:u,join:h}=zr;if(n&&[o,l,u,h].indexOf(a)>=0&&n!==this._joinRef())return;let p=this._onMessage(a,t,n);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(m=>{var g,y,b;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((b=(y=m.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===a}).map(m=>m.callback(p,n)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var g,y,b,v,x,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const E=m.id,T=(g=m.filter)===null||g===void 0?void 0:g.event;return E&&((y=t.ids)===null||y===void 0?void 0:y.includes(E))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const E=(x=(v=m==null?void 0:m.filter)===null||v===void 0?void 0:v.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return E==="*"||E===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof p=="object"&&"ids"in p){const g=p.data,{schema:y,table:b,commit_timestamp:v,type:x,errors:w}=g;p=Object.assign(Object.assign({},{schema:y,table:b,commit_timestamp:v,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(g))}m.callback(p,n)})}_isClosed(){return this.state===Zt.closed}_isJoined(){return this.state===Zt.joined}_isJoining(){return this.state===Zt.joining}_isLeaving(){return this.state===Zt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&I_.isEqual(r.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(zr.close,{},e)}_onError(e){this._on(zr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Zt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=BA(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=BA(e.columns,e.old_record)),t}}const vx=()=>{},Cg={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},E5=[1e3,2e3,5e3,1e4],A5=1e4,k5=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class T5{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=zw,this.transport=null,this.heartbeatIntervalMs=Cg.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=vx,this.ref=0,this.reconnectTimer=null,this.logger=vx,this.conn=null,this.sendBuffer=[],this.serializer=new y5,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>{let i;return r?i=r:typeof fetch>"u"?i=(...a)=>Gm(async()=>{const{default:o}=await Promise.resolve().then(()=>xh);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...a)=>i(...a)},!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ww.websocket}`,this.httpEndpoint=rj(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=d5.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:p5}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Af.connecting:return El.Connecting;case Af.open:return El.Open;case Af.closing:return El.Closing;default:return El.Closed}}isConnected(){return this.connectionState()===El.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,r=this.getChannels().find(i=>i.topic===n);if(r)return r;{const i=new I_(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:r,ref:i}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${n} (${i})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(m5,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Cg.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:r,payload:i,ref:a}=t,o=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${r} ${o}`.trim(),i),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(r,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(zr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${n}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([k5],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const r={access_token:t,version:f5};t&&n.updateJoinPayload(r),n.joinedOnce&&n._isJoined()&&n._push(zr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new sj(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Cg.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,i,a,o,l,u,h;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:zw,this.heartbeatIntervalMs=(r=e==null?void 0:e.heartbeatIntervalMs)!==null&&r!==void 0?r:Cg.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:vx,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:f=>E5[f-1]||A5,this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(f,p)=>p(JSON.stringify(f)),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class O_ extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Kt(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class C5 extends O_{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class qw extends O_{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var N5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const ij=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Gm(async()=>{const{default:n}=await Promise.resolve().then(()=>xh);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},j5=()=>N5(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Gm(()=>Promise.resolve().then(()=>xh),void 0)).Response:Response}),Kw=s=>{if(Array.isArray(s))return s.map(t=>Kw(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,n])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=Kw(n)}),e},P5=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)};var nu=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const xx=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),R5=(s,e,t)=>nu(void 0,void 0,void 0,function*(){const n=yield j5();s instanceof n&&!(t!=null&&t.noResolveJson)?s.json().then(r=>{const i=s.status||500,a=(r==null?void 0:r.statusCode)||i+"";e(new C5(xx(r),i,a))}).catch(r=>{e(new qw(xx(r),r))}):e(new qw(xx(s),s))}),L5=(s,e,t,n)=>{const r={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||!n?r:(P5(n)?(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(n)):r.body=n,e!=null&&e.duplex&&(r.duplex=e.duplex),Object.assign(Object.assign({},r),t))};function Km(s,e,t,n,r,i){return nu(this,void 0,void 0,function*(){return new Promise((a,o)=>{s(t,L5(e,n,r,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>R5(l,o,n))})})}function ly(s,e,t,n){return nu(this,void 0,void 0,function*(){return Km(s,"GET",e,t,n)})}function ui(s,e,t,n,r){return nu(this,void 0,void 0,function*(){return Km(s,"POST",e,n,r,t)})}function Xw(s,e,t,n,r){return nu(this,void 0,void 0,function*(){return Km(s,"PUT",e,n,r,t)})}function D5(s,e,t,n){return nu(this,void 0,void 0,function*(){return Km(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function aj(s,e,t,n,r){return nu(this,void 0,void 0,function*(){return Km(s,"DELETE",e,n,r,t)})}var M5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};class I5{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return M5(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Kt(e))return{data:null,error:e};throw e}})}}var O5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};class F5{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new I5(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return O5(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Kt(e))return{data:null,error:e};throw e}})}}var dn=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const $5={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},zA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class U5{constructor(e,t={},n,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=ij(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,r){return dn(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},zA),r);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),r!=null&&r.headers&&(o=Object.assign(Object.assign({},o),r.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),f=yield(e=="PUT"?Xw:ui)(this.fetch,`${this.url}/object/${h}`,i,Object.assign({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Kt(i))return{data:null,error:i};throw i}})}upload(e,t,n){return dn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,r){return dn(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:zA.upsert},r),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const f=yield Xw(this.fetch,o.toString(),l,{headers:h});return{data:{path:i,fullPath:f.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Kt(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return dn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const r=Object.assign({},this.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const i=yield ui(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:r}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new O_("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Kt(n))return{data:null,error:n};throw n}})}update(e,t,n){return dn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return dn(this,void 0,void 0,function*(){try{return{data:yield ui(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Kt(r))return{data:null,error:r};throw r}})}copy(e,t,n){return dn(this,void 0,void 0,function*(){try{return{data:{path:(yield ui(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Kt(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,n){return dn(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield ui(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Kt(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,n){return dn(this,void 0,void 0,function*(){try{const r=yield ui(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Kt(r))return{data:null,error:r};throw r}})}download(e,t){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"",o=this._getFinalPath(e),l=()=>ly(this.fetch,`${this.url}/${r}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new F5(l,this.shouldThrowOnError)}info(e){return dn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield ly(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Kw(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Kt(n))return{data:null,error:n};throw n}})}exists(e){return dn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield D5(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Kt(n)&&n instanceof qw){const r=n.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&r.push(l);let u=r.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${u}`)}}}remove(e){return dn(this,void 0,void 0,function*(){try{return{data:yield aj(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Kt(t))return{data:null,error:t};throw t}})}list(e,t,n){return dn(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},$5),t),{prefix:e||""});return{data:yield ui(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Kt(r))return{data:null,error:r};throw r}})}listV2(e,t){return dn(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield ui(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Kt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const B5="2.12.2",H5={"X-Client-Info":`storage-js/${B5}`};var lu=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,[])).next())})};class V5{constructor(e,t={},n,r){this.shouldThrowOnError=!1;const i=new URL(e);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},H5),t),this.fetch=ij(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return lu(this,void 0,void 0,function*(){try{return{data:yield ly(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Kt(e))return{data:null,error:e};throw e}})}getBucket(e){return lu(this,void 0,void 0,function*(){try{return{data:yield ly(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Kt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return lu(this,void 0,void 0,function*(){try{return{data:yield ui(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Kt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return lu(this,void 0,void 0,function*(){try{return{data:yield Xw(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Kt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return lu(this,void 0,void 0,function*(){try{return{data:yield ui(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Kt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return lu(this,void 0,void 0,function*(){try{return{data:yield aj(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Kt(t))return{data:null,error:t};throw t}})}}class z5 extends V5{constructor(e,t={},n,r){super(e,t,n,r)}from(e){return new U5(this.url,this.headers,e,this.fetch)}}const W5="2.58.0";let Wh="";typeof Deno<"u"?Wh="deno":typeof document<"u"?Wh="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Wh="react-native":Wh="node";const G5={"X-Client-Info":`supabase-js-${Wh}/${W5}`},q5={headers:G5},K5={schema:"public"},X5={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Y5={};var J5=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,e||[])).next())})};const Q5=s=>{let e;return s?e=s:typeof fetch>"u"?e=W2:e=fetch,(...t)=>e(...t)},Z5=()=>typeof Headers>"u"?G2:Headers,eU=(s,e,t)=>{const n=Q5(t),r=Z5();return(i,a)=>J5(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:s;let u=new r(a==null?void 0:a.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},a),{headers:u}))})};var tU=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,[])).next())})};function sU(s){return s.endsWith("/")?s:s+"/"}function nU(s,e){var t,n;const{db:r,auth:i,realtime:a,global:o}=s,{db:l,auth:u,realtime:h,global:f}=e,p={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},h),a),storage:{},global:Object.assign(Object.assign(Object.assign({},f),o),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>tU(this,void 0,void 0,function*(){return""})};return s.accessToken?p.accessToken=s.accessToken:delete p.accessToken,p}function rU(s){const e=s==null?void 0:s.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(sU(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const oj="2.72.0",fu=30*1e3,Yw=3,wx=Yw*fu,iU="http://localhost:9999",aU="supabase.auth.token",oU={"X-Client-Info":`gotrue-js/${oj}`},Jw="X-Supabase-Api-Version",lj={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},lU=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,cU=10*60*1e3;class F_ extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Ie(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class uU extends F_{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function dU(s){return Ie(s)&&s.name==="AuthApiError"}class cj extends F_{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class cl extends F_{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class Ga extends cl{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function hU(s){return Ie(s)&&s.name==="AuthSessionMissingError"}class Lh extends cl{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ng extends cl{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class jg extends cl{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function fU(s){return Ie(s)&&s.name==="AuthImplicitGrantRedirectError"}class WA extends cl{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Qw extends cl{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function bx(s){return Ie(s)&&s.name==="AuthRetryableFetchError"}class GA extends cl{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Zw extends cl{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const cy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),qA=` 	
\r=`.split(""),pU=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<qA.length;e+=1)s[qA[e].charCodeAt(0)]=-2;for(let e=0;e<cy.length;e+=1)s[cy[e].charCodeAt(0)]=e;return s})();function KA(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(cy[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(cy[n]),e.queuedBits-=6}}function uj(s,e,t){const n=pU[s];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function XA(s){const e=[],t=a=>{e.push(String.fromCodePoint(a))},n={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=a=>{yU(a,n,t)};for(let a=0;a<s.length;a+=1)uj(s.charCodeAt(a),r,i);return e.join("")}function mU(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function gU(s,e){for(let t=0;t<s.length;t+=1){let n=s.charCodeAt(t);if(n>55295&&n<=56319){const r=(n-55296)*1024&65535;n=(s.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}mU(n,e)}}function yU(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let n=1;n<6;n+=1)if(!(s>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function vU(s){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};for(let r=0;r<s.length;r+=1)uj(s.charCodeAt(r),t,n);return new Uint8Array(e)}function xU(s){const e=[];return gU(s,t=>e.push(t)),new Uint8Array(e)}function wU(s){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};return s.forEach(r=>KA(r,t,n)),KA(null,t,n),e.join("")}function bU(s){return Math.round(Date.now()/1e3)+s}function SU(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const or=()=>typeof window<"u"&&typeof document<"u",hl={tested:!1,writable:!1},dj=()=>{if(!or())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(hl.tested)return hl.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),hl.tested=!0,hl.writable=!0}catch{hl.tested=!0,hl.writable=!1}return hl.writable};function _U(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((n,r)=>{e[r]=n}),e}const hj=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Gm(async()=>{const{default:n}=await Promise.resolve().then(()=>xh);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},EU=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",pu=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},fl=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},za=async(s,e)=>{await s.removeItem(e)};class mv{constructor(){this.promise=new mv.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}mv.promiseConstructor=Promise;function Sx(s){const e=s.split(".");if(e.length!==3)throw new Zw("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!lU.test(e[n]))throw new Zw("JWT not in base64url format");return{header:JSON.parse(XA(e[0])),payload:JSON.parse(XA(e[1])),signature:vU(e[2]),raw:{header:e[0],payload:e[1]}}}async function AU(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function kU(s,e){return new Promise((n,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await s(i);if(!e(i,null,a)){n(a);return}}catch(a){if(!e(i,a)){r(a);return}}})()})}function TU(s){return("0"+s.toString(16)).substr(-2)}function CU(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}return crypto.getRandomValues(e),Array.from(e,TU).join("")}async function NU(s){const t=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function jU(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await NU(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function cu(s,e,t=!1){const n=CU();let r=n;t&&(r+="/PASSWORD_RECOVERY"),await pu(s,`${e}-code-verifier`,r);const i=await jU(n);return[i,n===i?"plain":"s256"]}const PU=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function RU(s){const e=s.headers.get(Jw);if(!e||!e.match(PU))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function LU(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function DU(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const MU=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function uu(s){if(!MU.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function _x(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function YA(s){return JSON.parse(JSON.stringify(s))}var IU=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t};const wl=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),OU=[502,503,504];async function JA(s){var e;if(!EU(s))throw new Qw(wl(s),0);if(OU.includes(s.status))throw new Qw(wl(s),s.status);let t;try{t=await s.json()}catch(i){throw new cj(wl(i),i)}let n;const r=RU(s);if(r&&r.getTime()>=lj["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new GA(wl(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ga}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new GA(wl(t),s.status,t.weak_password.reasons);throw new uU(wl(t),s.status||500,n)}const FU=(s,e,t,n)=>{const r={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(n),Object.assign(Object.assign({},r),t))};async function Be(s,e,t,n){var r;const i=Object.assign({},n==null?void 0:n.headers);i[Jw]||(i[Jw]=lj["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const a=(r=n==null?void 0:n.query)!==null&&r!==void 0?r:{};n!=null&&n.redirectTo&&(a.redirect_to=n.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await $U(s,e,t+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function $U(s,e,t,n,r,i){const a=FU(e,n,r,i);let o;try{o=await s(t,Object.assign({},a))}catch(l){throw console.error(l),new Qw(wl(l),0)}if(o.ok||await JA(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(l){await JA(l)}}function oi(s){var e;let t=null;VU(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=bU(s.expires_in)));const n=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:n},error:null}}function QA(s){const e=oi(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Za(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function UU(s){return{data:s,error:null}}function BU(s){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:i}=s,a=IU(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function HU(s){return s}function VU(s){return s.access_token&&s.refresh_token&&s.expires_in}const Ex=["global","local","others"];var zU=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t};class WU{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=hj(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Ex[0]){if(Ex.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ex.join(", ")}`);try{return await Be(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ie(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Be(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Za})}catch(n){if(Ie(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=zU(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=n==null?void 0:n.newEmail,delete r.newEmail),await Be(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:BU,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Ie(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Be(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Za})}catch(t){if(Ie(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,i,a,o,l;try{const u={nextPage:null,lastPage:0,total:0},h=await Be(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:HU});if(h.error)throw h.error;const f=await h.json(),p=(a=h.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(l=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(g.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(p)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Ie(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){uu(e);try{return await Be(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Za})}catch(t){if(Ie(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){uu(e);try{return await Be(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Za})}catch(n){if(Ie(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){uu(e);try{return await Be(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Za})}catch(n){if(Ie(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){uu(e.userId);try{const{data:t,error:n}=await Be(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:n}}catch(t){if(Ie(t))return{data:null,error:t};throw t}}async _deleteFactor(e){uu(e.userId),uu(e.id);try{return{data:await Be(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}}}function ZA(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function GU(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const du={debug:!!(globalThis&&dj()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fj extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class qU extends fj{}async function KU(s,e,t){du.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),du.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async r=>{if(r){du.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,r.name);try{return await t()}finally{du.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,r.name)}}else{if(e===0)throw du.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new qU(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(du.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function pj(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function XU(s){return parseInt(s,16)}function YU(s){const e=new TextEncoder().encode(s);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function JU(s){var e;const{chainId:t,domain:n,expirationTime:r,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:u,scheme:h,uri:f,version:p}=s;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=s.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const m=pj(s.address),g=h?`${h}://${n}`:n,y=s.statement?`${s.statement}
`:"",b=`${g} wants you to sign in with your Ethereum account:
${m}

${y}`;let v=`URI: ${f}
Version: ${p}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(r&&(v+=`
Expiration Time: ${r.toISOString()}`),o&&(v+=`
Not Before: ${o.toISOString()}`),l&&(v+=`
Request ID: ${l}`),u){let x=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);x+=`
- ${w}`}v+=x}return`${b}
${v}`}GU();const QU={url:iU,storageKey:aU,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:oU,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ek(s,e,t){return await t()}const hu={};class Jf{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jf.nextInstanceID,Jf.nextInstanceID+=1,this.instanceID>0&&or()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},QU),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new WU({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=hj(r.fetch),this.lock=r.lock||ek,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:or()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=KU:this.lock=ek,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:dj()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ZA(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=ZA(this.memoryStorage)),or()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=hu[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){hu[this.storageKey]=Object.assign(Object.assign({},hu[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=hu[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){hu[this.storageKey]=Object.assign(Object.assign({},hu[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${oj}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=_U(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),or()&&this.detectSessionInUrl&&n!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),fU(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ie(t)?{error:t}:{error:new cj("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const i=await Be(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:oi}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(Ie(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,n,r;try{let i;if("email"in e){const{email:h,password:f,options:p}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await cu(this.storage,this.storageKey)),i=await Be(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:h,password:f,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:m,code_challenge_method:g},xform:oi})}else if("phone"in e){const{phone:h,password:f,options:p}=e;i=await Be(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:f,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(r=p==null?void 0:p.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:oi})}else throw new Ng("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(Ie(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await Be(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:QA})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await Be(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:QA})}else throw new Ng("You must provide either an email or phone number and a password");const{data:n,error:r}=t;return r?{data:{user:null,session:null},error:r}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Lh}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(Ie(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,r,i,a,o,l,u,h,f,p;let m,g;if("message"in e)m=e.message,g=e.signature;else{const{chain:y,wallet:b,statement:v,options:x}=e;let w;if(or())if(typeof b=="object")w=b;else{const R=window;if("ethereum"in R&&typeof R.ethereum=="object"&&"request"in R.ethereum&&typeof R.ethereum.request=="function")w=R.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const E=new URL((t=x==null?void 0:x.url)!==null&&t!==void 0?t:window.location.href),T=await w.request({method:"eth_requestAccounts"}).then(R=>R).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!T||T.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=pj(T[0]);let N=(n=x==null?void 0:x.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!N){const R=await w.request({method:"eth_chainId"});N=XU(R)}const j={domain:E.host,address:C,statement:v,uri:E.href,version:"1",chainId:N,nonce:(r=x==null?void 0:x.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(a=(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=x==null?void 0:x.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=x==null?void 0:x.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=x==null?void 0:x.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(h=x==null?void 0:x.signInWithEthereum)===null||h===void 0?void 0:h.resources};m=JU(j),g=await w.request({method:"personal_sign",params:[YU(m),C]})}try{const{data:y,error:b}=await Be(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:g},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:oi});if(b)throw b;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new Lh}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:b})}catch(y){if(Ie(y))return{data:{user:null,session:null},error:y};throw y}}async signInWithSolana(e){var t,n,r,i,a,o,l,u,h,f,p,m;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:b,wallet:v,statement:x,options:w}=e;let E;if(or())if(typeof v=="object")E=v;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))E=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=v}const T=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const C=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),x?{statement:x}:null));let N;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")N=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)N=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in N&&"signature"in N&&(typeof N.signedMessage=="string"||N.signedMessage instanceof Uint8Array)&&N.signature instanceof Uint8Array)g=typeof N.signedMessage=="string"?N.signedMessage:new TextDecoder().decode(N.signedMessage),y=N.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${T.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(r=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(h=w==null?void 0:w.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(N=>`- ${N}`)]:[]].join(`
`);const C=await E.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=C}}try{const{data:b,error:v}=await Be(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:wU(y)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:oi});if(v)throw v;return!b||!b.session||!b.user?{data:{user:null,session:null},error:new Lh}:(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:v})}catch(b){if(Ie(b))return{data:{user:null,session:null},error:b};throw b}}async _exchangeCodeForSession(e){const t=await fl(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(t??"").split("/");try{const{data:i,error:a}=await Be(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:oi});if(await za(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Lh}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:a})}catch(i){if(Ie(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:i,nonce:a}=e,o=await Be(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:oi}),{data:l,error:u}=o;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Lh}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(Ie(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,r,i,a;try{if("email"in e){const{email:o,options:l}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await cu(this.storage,this.storageKey));const{error:f}=await Be(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:o,options:l}=e,{data:u,error:h}=await Be(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:h}}throw new Ng("You must provide either an email or phone number.")}catch(o){if(Ie(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,n;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:a,error:o}=await Be(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:oi});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,u=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(r){if(Ie(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,n,r;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await cu(this.storage,this.storageKey)),await Be(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:UU})}catch(i){if(Ie(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ga;const{error:r}=await Be(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(Ie(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:r,options:i}=e,{error:a}=await Be(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:n,type:r,options:i}=e,{data:a,error:o}=await Be(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Ng("You must provide either an email or phone number and a type")}catch(t){if(Ie(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await fl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<wx:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const a=await fl(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=_x()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,h)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,h))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Be(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Za}):await this._useSession(async t=>{var n,r,i;const{data:a,error:o}=t;if(o)throw o;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ga}:await Be(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:Za})})}catch(t){if(Ie(t))return hU(t)&&(await this._removeSession(),await za(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:r,error:i}=n;if(i)throw i;if(!r.session)throw new Ga;const a=r.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await cu(this.storage,this.storageKey));const{data:u,error:h}=await Be(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:Za});if(h)throw h;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(n){if(Ie(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ga;const t=Date.now()/1e3;let n=t,r=!0,i=null;const{payload:a}=Sx(e.access_token);if(a.exp&&(n=a.exp,r=n<=t),r){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(Ie(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(n=a.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Ga;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ie(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!or())throw new jg("No browser detected.");if(e.error||e.error_description||e.error_code)throw new jg(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new WA("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new jg("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new WA("No code detected.");const{data:x,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:u}=e;if(!i||!o||!a||!u)throw new jg("No session defined in URL");const h=Math.round(Date.now()/1e3),f=parseInt(o);let p=h+f;l&&(p=parseInt(l));const m=p-h;m*1e3<=fu&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const g=p-f;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,p,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,p,h);const{data:y,error:b}=await this._getUser(i);if(b)throw b;const v={provider_token:n,provider_refresh_token:r,access_token:i,expires_in:f,expires_at:p,refresh_token:a,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(n){if(Ie(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await fl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return{error:i};const a=(n=r.session)===null||n===void 0?void 0:n.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(dU(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await za(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=SU(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:i},error:a}=t;if(a)throw a;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,r=null;this.flowType==="pkce"&&([n,r]=await cu(this.storage,this.storageKey,!0));try{return await Be(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(Ie(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:r}=await this._useSession(async i=>{var a,o,l,u,h;const{data:f,error:p}=i;if(p)throw p;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Be(this.fetch,"GET",m,{headers:this.headers,jwt:(h=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(r)throw r;return or()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(Ie(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:a}=t;if(a)throw a;return await Be(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(Ie(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await kU(async r=>(r>0&&await AU(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Be(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:oi})),(r,i)=>{const a=200*Math.pow(2,r);return i&&bx(i)&&Date.now()+a-n<fu})}catch(n){if(this._debug(t,"error",n),Ie(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),or()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const r=await fl(this.storage,this.storageKey);if(r&&this.userStorage){let a=await fl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:r.user},await pu(this.userStorage,this.storageKey+"-user",a)),r.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:_x()}else if(r&&!r.user&&!r.user){const a=await fl(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(r.user=a.user,await za(this.storage,this.storageKey+"-user"),await pu(this.storage,this.storageKey,r)):r.user=_x()}if(this._debug(n,"session from storage",r),!this._isValidSession(r)){this._debug(n,"session is not valid"),r!==null&&await this._removeSession();return}const i=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<wx;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${wx}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),bx(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(r.access_token);!o&&(a!=null&&a.user)?(r.user=a.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(n,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(n,"error",r),console.error(r);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ga;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new mv;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Ga;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(r,"error",i),Ie(i)){const a={session:null,error:i};return bx(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,n=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await pu(this.userStorage,this.storageKey+"-user",{user:t.user});const r=Object.assign({},t);delete r.user;const i=YA(r);await pu(this.storage,this.storageKey,i)}else{const r=YA(t);await pu(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),await za(this.storage,this.storageKey),await za(this.storage,this.storageKey+"-code-verifier"),await za(this.storage,this.storageKey+"-user"),this.userStorage&&await za(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&or()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),fu);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((n.expires_at*1e3-e)/fu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${fu}ms, refresh threshold is ${Yw} ticks`),r<=Yw&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof fj)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!or()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,a]=await cu(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);r.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;return i?{data:null,error:i}:await Be(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Ie(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await Be(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((r=l==null?void 0:l.totp)===null||r===void 0)&&r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(Ie(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await Be(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;return i?{data:null,error:i}:await Be(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],r=n.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=n.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:n,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Sx(r.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((n=(t=r.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const h=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(o=>o.kid===e);if(n)return n;const r=Date.now();if(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+cU>r)return n;const{data:i,error:a}=await Be(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=r,n=i.keys.find(o=>o.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};n=m.session.access_token}const{header:r,payload:i,signature:a,raw:{header:o,payload:l}}=Sx(n);t!=null&&t.allowExpired||LU(i.exp);const u=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:i,header:r,signature:a},error:null}}const h=DU(r.alg),f=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,f,a,xU(`${o}.${l}`)))throw new Zw("Invalid JWT signature");return{data:{claims:i,header:r,signature:a},error:null}}catch(n){if(Ie(n))return{data:null,error:n};throw n}}}Jf.nextInstanceID=0;const ZU=Jf;class eB extends ZU{constructor(e){super(e)}}var tB=function(s,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{u(n.next(h))}catch(f){a(f)}}function l(h){try{u(n.throw(h))}catch(f){a(f)}}function u(h){h.done?i(h.value):r(h.value).then(o,l)}u((n=n.apply(s,[])).next())})};class sB{constructor(e,t,n){var r,i,a;this.supabaseUrl=e,this.supabaseKey=t;const o=rU(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,u={db:K5,realtime:Y5,auth:Object.assign(Object.assign({},X5),{storageKey:l}),global:q5},h=nU(n??{},u);this.storageKey=(r=h.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=h.auth)!==null&&a!==void 0?a:{},this.headers,h.global.fetch),this.fetch=eU(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new u5(new URL("rest/v1",o).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new z5(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new H$(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return tB(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:i,storageKey:a,flowType:o,lock:l,debug:u},h,f){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new eB({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),h),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:i,flowType:o,lock:l,debug:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new T5(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const nB=(s,e,t)=>new sB(s,e,t);function rB(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const e=s.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}rB()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const mj="https://carqvkbmbnqofizbbkjt.supabase.co",gj="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNhcnF2a2JtYm5xb2ZpemJia2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1Mjk0MTEsImV4cCI6MjA3NDEwNTQxMX0.2vzjY0M2fBEaOyfo5XVPqtF7ZZ0-WjZDXX0awA2U7uE";console.log("🔍 [SUPABASE] Environment check:",{hasSupabaseUrl:!0,hasAnonKey:!0,supabaseUrl:mj.substring(0,30)+"...",anonKey:gj.substring(0,20)+"...",source:"build-time"});let Ax=null;const kx=(Ax||(Ax=nB(mj,gj)),Ax);class iB{async uploadFile(e,t=null,n={}){const r=this.generateFilePath(e,t),{data:i,error:a}=await kx.storage.from("files").upload(r,e,{cacheControl:"3600",upsert:!1});if(a)throw a;return{path:i.path,bucket:"files",size:e.size,contentType:e.type}}generateFilePath(e,t){const r=`${Date.now()}-${e.name}`;return t?`folders/folder-${t}/${r}`:`root/${r}`}async getSignedUrl(e,t=3600){const{data:n,error:r}=await kx.storage.from("files").createSignedUrl(e,t);if(r)throw r;return n.signedUrl}async deleteFile(e){const{error:t}=await kx.storage.from("files").remove([e]);if(t)throw t}}const aB=new iB,oB=(s,e="")=>{var n;const t={"application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","text/plain":"txt","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.ms-powerpoint":"ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application/zip":"zip","application/x-zip-compressed":"zip","application/x-rar-compressed":"rar","image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/svg+xml":"svg","audio/mpeg":"mp3","audio/mp3":"mp3","audio/wav":"wav","audio/ogg":"ogg","audio/m4a":"m4a","audio/aac":"aac","audio/flac":"flac"};if(s&&t[s])return t[s];if(e){const r=(n=e.split(".").pop())==null?void 0:n.toLowerCase(),i={pdf:"pdf",doc:"doc",docx:"docx",txt:"txt",xls:"xls",xlsx:"xlsx",ppt:"ppt",pptx:"pptx",zip:"zip",rar:"rar",jpg:"jpg",jpeg:"jpg",png:"png",gif:"gif",webp:"webp",svg:"svg",mp3:"mp3",wav:"wav",ogg:"ogg",m4a:"m4a",aac:"aac",flac:"flac"};if(r&&i[r])return i[r]}return"unknown"},lB=()=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/zip","application/x-zip-compressed","application/x-rar-compressed","image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml","audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/aac","audio/flac"],tk=s=>{if(s===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,n)).toFixed(2))+" "+t[n]},uy=s=>{const e="w-8 h-8 text-blue-600";switch(s){case"pdf":return c.jsx("div",{className:`${e} flex items-center justify-center bg-red-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-red-600",children:"PDF"})]})});case"doc":case"docx":return c.jsx("div",{className:`${e} flex items-center justify-center bg-blue-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-blue-600",children:"DOC"})]})});case"xls":case"xlsx":return c.jsx("div",{className:`${e} flex items-center justify-center bg-green-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-green-600",children:"XLS"})]})});case"ppt":case"pptx":return c.jsx("div",{className:`${e} flex items-center justify-center bg-orange-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-orange-600",children:"PPT"})]})});case"jpg":case"jpeg":case"png":case"gif":case"webp":case"svg":return c.jsx("div",{className:`${e} flex items-center justify-center bg-purple-50 rounded-lg`,children:c.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"})})});case"mp3":case"wav":case"ogg":case"m4a":case"aac":case"flac":return c.jsx("div",{className:`${e} flex items-center justify-center bg-pink-50 rounded-lg`,children:c.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.01,19.86 21,16.28 21,12C21,7.72 18.01,4.14 14,3.23M16.5,12C16.5,10.23 15.48,8.71 14,7.97V16.02C15.48,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z"})})});case"zip":case"rar":return c.jsx("div",{className:`${e} flex items-center justify-center bg-yellow-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-yellow-600",children:"ZIP"})]})});case"txt":return c.jsx("div",{className:`${e} flex items-center justify-center bg-gray-50 rounded-lg`,children:c.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"}),c.jsx("text",{x:"12",y:"16",textAnchor:"middle",className:"text-xs font-bold fill-gray-600",children:"TXT"})]})});default:return c.jsx("div",{className:`${e} flex items-center justify-center bg-gray-50 rounded-lg`,children:c.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})})}},sk=({folders:s,files:e,selectedFolder:t,onFolderSelect:n,onFolderCreate:r,onFolderUpdate:i,onFolderDelete:a,onSubfolderCreate:o,onCurrentFolderChange:l,onFileUpdate:u,onFileDelete:h,onFileMove:f,onFileSelect:p,onFileUpload:m})=>{const[g,y]=S.useState(new Set),[b,v]=S.useState(!1),[x,w]=S.useState(null),[E,T]=S.useState({name:"",parent_id:null}),[C,N]=S.useState({name:"",parent_id:null}),[j,R]=S.useState(null),[D,z]=S.useState(null),[L,I]=S.useState({x:0,y:0}),[O,Y]=S.useState(null),[F,B]=S.useState(null),[M,$]=S.useState({name:""}),[K,J]=S.useState({x:0,y:0}),[Z,pe]=S.useState(null),[Se,Pe]=S.useState([]),H=S.useRef(null),[X,we]=S.useState(!1),[Re,Ee]=S.useState(0),[q,oe]=S.useState(!1),fe=S.useRef(null);S.useEffect(()=>{const U=se=>{H.current&&!H.current.contains(se.target)&&B(null),j&&!se.target.closest(".file-context-menu")&&(R(null),z(null))};return(F||j)&&document.addEventListener("mousedown",U),()=>{document.removeEventListener("mousedown",U)}},[F,j]),S.useEffect(()=>{console.log("📁 [FOLDER_TREE] currentFolderId changed:",Z)},[Z]),S.useEffect(()=>{console.log("📁 [FOLDER_TREE] folderPath changed:",Se)},[Se]);const He=async U=>{U.preventDefault();try{const se=await te.createFolder(E);se.success?(r(se.folder),T({name:"",parent_id:null}),v(!1)):alert("Failed to create folder: "+se.error)}catch(se){console.error("Error creating folder:",se),alert("Failed to create folder")}},ie=async U=>{U.preventDefault();try{const se=await te.createFolder(C);se.success?(r(se.folder),N({name:"",parent_id:null}),w(null)):alert("Failed to create subfolder: "+se.error)}catch(se){console.error("Error creating subfolder:",se),alert("Failed to create subfolder")}},me=async U=>{U.preventDefault();try{const se=await te.updateFolder(O.id,{name:M.name});se.success?(i(se.folder),Y(null),$({name:""})):alert("Failed to rename folder: "+se.error)}catch(se){console.error("Error renaming folder:",se),alert("Failed to rename folder")}},Je=async U=>{if(confirm("Are you sure you want to delete this folder? This will also delete all files in the folder. This action cannot be undone."))try{const se=await te.deleteFolder(U);se.success?(a(U),B(null)):alert("Failed to delete folder: "+se.error)}catch(se){console.error("Error deleting folder:",se),alert("Failed to delete folder")}},ft=(U,se)=>{var ve;U.preventDefault(),U.stopPropagation();const W=U.currentTarget.getBoundingClientRect();if((ve=U.currentTarget.closest(".folder-tree-container"))==null?void 0:ve.getBoundingClientRect()){let Ne=W.right,Qe=W.top;Ne+200>window.innerWidth&&(Ne=W.left-200),Qe<0&&(Qe=W.bottom),J({x:Ne,y:Qe})}B(se.id)},ln=U=>{Y(U),$({name:U.name}),B(null)},Zr=U=>{console.log("📁 [FOLDER_TREE] Single click on folder:",U.id,U.name),pe(U.id),Pe(se=>[...se,{id:U.id,name:U.name}]),n(U.id)},An=U=>{Ns(U)},Ns=U=>{console.log("📁 [FOLDER_TREE] Double click - navigating to folder:",U.id,U.name),pe(U.id),Pe(se=>[...se,{id:U.id,name:U.name}]),n(U.id),l&&l(U.id)},kn=()=>{if(console.log("📁 [FOLDER_TREE] navigateBack called",{folderPath:Se,currentFolderId:Z,folderPathLength:Se.length,folderPathContents:Se.map(U=>({id:U.id,name:U.name}))}),Se.length>0){const U=[...Se],se=U.pop();if(console.log("📁 [FOLDER_TREE] Removed folder from path:",se),console.log("📁 [FOLDER_TREE] New path after pop:",U),Pe(U),U.length===0)console.log("📁 [FOLDER_TREE] Navigating to root"),pe(null),console.log("📁 [FOLDER_TREE] Calling onFolderSelect(null)"),n(null),l&&(console.log("📁 [FOLDER_TREE] Calling onCurrentFolderChange(null)"),l(null));else{const W=U[U.length-1];console.log("📁 [FOLDER_TREE] Navigating to parent folder:",W),pe(W.id),console.log("📁 [FOLDER_TREE] Calling onFolderSelect with parent folder ID:",W.id),n(W.id),l&&(console.log("📁 [FOLDER_TREE] Calling onCurrentFolderChange with parent folder ID:",W.id),l(W.id))}}else console.log("📁 [FOLDER_TREE] Already at root, cannot go back")},Ot=()=>{pe(null),Pe([]),n(null),l&&l(null)},kr=U=>{y(se=>{const W=new Set(se);return W.has(U)?W.delete(U):W.add(U),W})},sr=(U,se)=>{U.preventDefault(),U.stopPropagation();const W=U.currentTarget.getBoundingClientRect();I({x:W.right+5,y:W.top}),z(se),R(se.id)},dt=()=>{R(null),z(null)},js=async U=>{if(U.preventDefault(),U.stopPropagation(),console.log("📁 [FOLDER_TREE] Download clicked for file:",D),console.log("📁 [FOLDER_TREE] Event:",U),console.log("📁 [FOLDER_TREE] Selected file ID:",D==null?void 0:D.id),!D){console.error("📁 [FOLDER_TREE] No file selected"),alert("Error: No file selected"),dt();return}try{console.log("📁 [FOLDER_TREE] Starting download");let se,W;if(D.supabase_path){console.log("📁 [FOLDER_TREE] Getting signed URL for Supabase file");const Qe=await te.downloadFile(D.id);if(!Qe.success)throw new Error(Qe.error||"Failed to get download URL");se=Qe.downloadUrl,W=Qe.fileName,console.log("📁 [FOLDER_TREE] Got signed URL:",se.substring(0,50)+"...")}else se=D.cloudinary_url,W=D.display_name||D.original_name,console.log("📁 [FOLDER_TREE] Using Cloudinary URL:",se.substring(0,50)+"...");console.log("📁 [FOLDER_TREE] Fetching file content from URL");const de=await fetch(se);if(!de.ok)throw new Error(`Download failed: ${de.status} ${de.statusText}`);const ve=await de.blob();if(console.log("📁 [FOLDER_TREE] File blob size:",ve.size,"bytes"),ve.size===0)throw new Error("Downloaded file is empty");const _e=URL.createObjectURL(ve),Ne=document.createElement("a");Ne.href=_e,Ne.download=W,document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),URL.revokeObjectURL(_e),console.log("✅ [FOLDER_TREE] Download initiated successfully")}catch(se){console.error("❌ [FOLDER_TREE] Download failed:",se),alert("Download failed: "+se.message)}dt()},as=U=>{if(U.preventDefault(),U.stopPropagation(),console.log("📁 [FOLDER_TREE] View clicked for file:",D),console.log("📁 [FOLDER_TREE] Event:",U),console.log("📁 [FOLDER_TREE] Selected file ID:",D==null?void 0:D.id),!D){console.error("📁 [FOLDER_TREE] No file selected"),alert("Error: No file selected"),dt();return}p?(console.log("📁 [FOLDER_TREE] Calling onFileSelect with file:",D),p(D)):(console.error("📁 [FOLDER_TREE] onFileSelect function not provided"),alert("Error: File preview not available")),dt()},cn=U=>{if(U.preventDefault(),U.stopPropagation(),console.log("📁 [FOLDER_TREE] Move clicked for file:",D),!D){console.error("📁 [FOLDER_TREE] No file selected"),alert("Error: No file selected"),dt();return}if(f)try{f(D),console.log("✅ [FOLDER_TREE] Move dialog opened successfully")}catch(se){console.error("❌ [FOLDER_TREE] Move failed:",se),alert("Failed to open move dialog: "+se.message)}else console.error("📁 [FOLDER_TREE] onFileMove prop not provided"),alert("Error: Move functionality not available");dt()},Tn=U=>{if(U.preventDefault(),U.stopPropagation(),console.log("📁 [FOLDER_TREE] Delete clicked for file:",D),!D){console.error("📁 [FOLDER_TREE] No file selected"),alert("Error: No file selected"),dt();return}if(!window.confirm(`Are you sure you want to delete "${D.display_name}"?

This action cannot be undone.`)){console.log("📁 [FOLDER_TREE] Delete cancelled by user"),dt();return}if(h)try{h(D),console.log("✅ [FOLDER_TREE] Delete initiated successfully")}catch(W){console.error("❌ [FOLDER_TREE] Delete failed:",W),alert("Failed to delete file: "+W.message)}else console.error("📁 [FOLDER_TREE] onFileDelete prop not provided"),alert("Error: Delete functionality not available");dt()},ei=()=>s.filter(U=>!U.parent_id),zs=U=>s.filter(se=>se.parent_id===U),Ps=(U,se=0)=>{const W=g.has(U.id),de=zs(U.id),ve=de.length>0;return c.jsxs("div",{className:"select-none",children:[c.jsxs("div",{className:`flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm ${t===U.id?"bg-blue-100 text-blue-700":"text-gray-700"}`,style:{paddingLeft:`${se*16+8}px`},onClick:()=>Zr(U),onDoubleClick:()=>An(U),tabIndex:0,children:[ve?c.jsx("button",{onClick:_e=>{_e.stopPropagation(),kr(U.id)},className:"mr-1 w-4 h-4 flex items-center justify-center",children:c.jsx(Q.svg,{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:W?90:0},transition:{duration:.2},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):c.jsx("div",{className:"w-4 h-4 mr-1"}),c.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1 truncate",children:U.name}),c.jsx("div",{className:"flex items-center space-x-1",children:c.jsx("button",{onClick:_e=>ft(_e,U),className:"p-1 hover:bg-gray-200 rounded text-gray-500 hover:text-gray-700",title:"Folder options",children:c.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),c.jsx(Cs,{children:W&&ve&&c.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:de.map(_e=>Ps(_e,se+1))})})]},U.id)},Lt=()=>{var U;(U=fe.current)==null||U.click()},Ua=U=>{const se=Array.from(U.target.files);se.length>0&&Cn(se)},Cn=async U=>{if(!(!U||U.length===0)){we(!0),Ee(0);try{for(let se=0;se<U.length;se++){const W=U[se],de=(se+1)/U.length*100;Ee(de);const ve=oB(W.type,W.name);if(ve==="unknown"){alert(`File "${W.name}" is not a supported file type.`);continue}const _e=await aB.uploadFile(W,Z),Ne={display_name:W.name,original_name:W.name,file_type:ve,file_size:W.size,supabase_path:_e.path,supabase_bucket:_e.bucket,content_type:_e.contentType,folder_id:Z},Qe=await te.uploadFile(Ne);Qe.success?(console.log("✅ File uploaded successfully:",Qe.file),m&&m(Qe.file)):(console.error("❌ Failed to save file metadata:",Qe.error),alert(`Failed to save file "${W.name}": ${Qe.error}`))}}catch(se){console.error("❌ Upload error:",se),alert("Upload failed: "+se.message)}finally{we(!1),Ee(0)}}},bt=U=>{U.preventDefault(),U.stopPropagation()},Ba=U=>{U.preventDefault(),U.stopPropagation()},Ha=U=>{U.preventDefault(),U.stopPropagation(),U.dataTransfer.files&&U.dataTransfer.files[0]&&Cn(Array.from(U.dataTransfer.files))};return c.jsxs("div",{className:"h-full flex flex-col bg-gray-50 border-r border-gray-200 folder-tree-container relative",onDragEnter:bt,onDragLeave:bt,onDragOver:Ba,onDrop:Ha,children:[c.jsxs("div",{className:"p-3 border-b border-gray-200",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Folders"}),Z!==null&&c.jsxs("div",{className:"mt-2 flex items-center space-x-1 text-xs",children:[c.jsxs("button",{onClick:Ot,className:"flex items-center px-2 py-1 text-blue-600 hover:bg-blue-100 rounded",title:"Go to root",children:[c.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Root"]}),c.jsx("span",{className:"text-gray-400",children:"/"}),c.jsxs("button",{onClick:kn,className:"flex items-center px-2 py-1 text-blue-600 hover:bg-blue-100 rounded",title:"Go back",children:[c.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),Se.map((U,se)=>c.jsxs(Dm.Fragment,{children:[c.jsx("span",{className:"text-gray-400",children:"/"}),c.jsx("span",{className:"px-2 py-1 text-gray-600",children:U.name})]},U.id))]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:Z===null?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:`flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm ${t===null?"bg-blue-100 text-blue-700":"text-gray-700"}`,onClick:()=>{console.log("📁 [FOLDER_TREE] All Files clicked - selecting root"),pe(null),n(null)},children:[c.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1",children:"All Files"})]}),ei().map(U=>Ps(U)),(()=>{const U=e?e.filter(se=>se.folder_id===null):[];return console.log("📁 [FOLDER_TREE] Root files:",{allFiles:(e==null?void 0:e.length)||0,rootFiles:U.length}),U.length>0?c.jsxs("div",{className:"mt-3",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-600 mb-2 px-2",children:["Files (",U.length,")"]}),U.map(se=>c.jsxs("div",{className:"flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm text-gray-700 group",children:[c.jsx("span",{className:"mr-2",children:uy(se.file_type)}),c.jsx("span",{className:"flex-1 truncate",title:se.display_name,children:se.display_name}),c.jsx("div",{className:"relative",children:c.jsx("button",{onClick:W=>sr(W,se),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 rounded",title:"File options",children:c.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})})})]},se.id))]}):c.jsx("div",{className:"mt-3 text-sm text-gray-500 italic p-2",children:"No files in root"})})()]}):c.jsx(c.Fragment,{children:(()=>{const U=s.find(W=>W.id===Z),se=zs(Z);return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:["📁 ",(U==null?void 0:U.name)||"Unknown Folder"]}),se.length>0?se.map(W=>Ps(W)):c.jsx("div",{className:"text-sm text-gray-500 italic p-2",children:"No subfolders in this folder"}),(()=>{const W=e?e.filter(de=>de.folder_id===Z||de.folder_id===null&&Z===null):[];return console.log("📁 [FOLDER_TREE] Current folder files:",{currentFolderId:Z,allFiles:(e==null?void 0:e.length)||0,filteredFiles:W.length}),W.length>0?c.jsxs("div",{className:"mt-3",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-600 mb-2 px-2",children:["Files (",W.length,")"]}),W.map(de=>c.jsxs("div",{className:"flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm text-gray-700 group",children:[c.jsx("span",{className:"mr-2",children:uy(de.file_type)}),c.jsx("span",{className:"flex-1 truncate",title:de.display_name,children:de.display_name}),c.jsx("div",{className:"relative",children:c.jsx("button",{onClick:ve=>sr(ve,de),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 rounded",title:"File options",children:c.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})})})]},de.id))]}):c.jsx("div",{className:"mt-3 text-sm text-gray-500 italic p-2",children:"No files in this folder"})})()]})})()})}),c.jsx("div",{className:"p-2 border-t border-gray-200",children:c.jsxs("button",{onClick:()=>v(!0),className:"w-full flex items-center justify-center py-2 px-3 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",children:[c.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Folder"]})}),c.jsxs("div",{className:"p-2 border-t border-gray-200",children:[c.jsx("button",{onClick:Lt,disabled:X,className:"w-full flex items-center justify-center py-2 px-3 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:X?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"}),"Uploading... ",Math.round(Re),"%"]}):c.jsxs(c.Fragment,{children:[c.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Files"]})}),c.jsx("input",{ref:fe,type:"file",multiple:!0,accept:lB().join(","),onChange:Ua,className:"hidden"}),X&&c.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-primary-500 h-2 rounded-full transition-all duration-300",style:{width:`${Re}%`}})})]}),b&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Create New Folder"}),c.jsxs("form",{onSubmit:He,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Folder Name *"}),c.jsx("input",{type:"text",value:E.name,onChange:U=>T(se=>({...se,name:U.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter folder name",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Create Folder"})]})]})]})}),x&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Create Subfolder"}),c.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subfolder Name *"}),c.jsx("input",{type:"text",value:C.name,onChange:U=>N(se=>({...se,name:U.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter subfolder name",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>w(null),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Create Subfolder"})]})]})]})}),c.jsx(Cs,{children:F&&c.jsxs(Q.div,{ref:H,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50 min-w-48",style:{top:`${K.y}px`,left:`${K.x}px`},children:[c.jsxs("button",{onClick:()=>{const U=s.find(se=>se.id===F);U&&(N({name:"",description:"",parent_id:U.id}),w(U.id)),B(null)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Subfolder"]}),c.jsxs("button",{onClick:()=>{const U=s.find(se=>se.id===F);U&&ln(U)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),c.jsx("div",{className:"border-t border-gray-200 my-1"}),c.jsxs("button",{onClick:()=>Je(F),className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})}),O&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Rename Folder"}),c.jsxs("form",{onSubmit:me,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Folder Name *"}),c.jsx("input",{type:"text",value:M.name,onChange:U=>$(se=>({...se,name:U.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter folder name",required:!0})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>{Y(null),$({name:""})},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Save Changes"})]})]})]})}),j&&YC.createPortal(c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-[99998]",onClick:dt}),c.jsxs("div",{className:"fixed bg-white border border-gray-200 rounded-lg shadow-lg z-[99999] py-1 min-w-[120px] file-context-menu",style:{left:L.x,top:L.y},children:[c.jsxs("button",{onClick:as,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsxs("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]}),c.jsxs("button",{onClick:js,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),c.jsx("div",{className:"border-t border-gray-200 my-1"}),c.jsxs("button",{onClick:cn,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),"Move"]}),c.jsxs("button",{onClick:Tn,className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 text-left",children:[c.jsx("svg",{className:"w-4 h-4 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]}),document.body)]})},Qs=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),eb=[.001,0,0,.001,0,0],Tx=1.35,Wn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ni={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},yj="pdfjs_internal_editor_",je={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},We={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},vj={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ds={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Cf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},$t={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},mu={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Xm={ERRORS:0,WARNINGS:1,INFOS:5},Qf={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Pg={moveTo:0,lineTo:1,curveTo:2,closePath:3},xj={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let gv=Xm.WARNINGS;function cB(s){Number.isInteger(s)&&(gv=s)}function uB(){return gv}function yv(s){gv>=Xm.INFOS&&console.log(`Info: ${s}`)}function Le(s){gv>=Xm.WARNINGS&&console.log(`Warning: ${s}`)}function ct(s){throw new Error(s)}function Yt(s,e){s||ct(e)}function dB(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function $_(s,e=null,t=null){if(!s)return null;if(t&&typeof s=="string"){if(t.addDefaultProtocol&&s.startsWith("www.")){const r=s.match(/\./g);(r==null?void 0:r.length)>=2&&(s=`http://${s}`)}if(t.tryConvertEncoding)try{s=gB(s)}catch{}}const n=e?URL.parse(s,e):URL.parse(s);return dB(n)?n:null}function U_(s,e,t=!1){const n=URL.parse(s);return n?(n.hash=e,n.href):t&&$_(s,"http://example.com")?s.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Ve(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const ru=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class nk extends ru{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Cx extends ru{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class dy extends ru{constructor(e){super(e,"InvalidPDFException")}}class Zf extends ru{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class hB extends ru{constructor(e){super(e,"FormatError")}}class Ia extends ru{constructor(e){super(e,"AbortException")}}function wj(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&ct("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let r=0;r<e;r+=t){const i=Math.min(r+t,e),a=s.subarray(r,i);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function Ym(s){typeof s!="string"&&ct("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function fB(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function pB(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function mB(){try{return new Function(""),!0}catch{return!1}}class gs{static get isLittleEndian(){return Ve(this,"isLittleEndian",pB())}static get isEvalSupported(){return Ve(this,"isEvalSupported",mB())}static get isOffscreenCanvasSupported(){return Ve(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ve(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Ve(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return Ve(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Nx=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));var Na,Qg,tb;class xe{static makeHexColor(e,t,n){return`#${Nx[e]}${Nx[t]}${Nx[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,n=0){const r=e[n],i=e[n+1];e[n]=r*t[0]+i*t[2]+t[4],e[n+1]=r*t[1]+i*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],i=t[1],a=t[2],o=t[3],l=t[4],u=t[5];for(let h=0;h<6;h+=2){const f=e[n+h],p=e[n+h+1];e[n+h]=f*r+p*a+l,e[n+h+1]=f*i+p*o+u}}static applyInverseTransform(e,t){const n=e[0],r=e[1],i=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/i,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/i}static axialAlignedBoundingBox(e,t,n){const r=t[0],i=t[1],a=t[2],o=t[3],l=t[4],u=t[5],h=e[0],f=e[1],p=e[2],m=e[3];let g=r*h+l,y=g,b=r*p+l,v=b,x=o*f+u,w=x,E=o*m+u,T=E;if(i!==0||a!==0){const C=i*h,N=i*p,j=a*f,R=a*m;g+=j,v+=j,b+=R,y+=R,x+=C,T+=C,E+=N,w+=N}n[0]=Math.min(n[0],g,b,y,v),n[1]=Math.min(n[1],x,E,w,T),n[2]=Math.max(n[2],g,b,y,v),n[3]=Math.max(n[3],x,E,w,T)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],o=n**2+r**2,l=n*i+r*a,u=i**2+a**2,h=(o+u)/2,f=Math.sqrt(h**2-(o*u-l**2));t[0]=Math.sqrt(h+f||1),t[1]=Math.sqrt(h-f||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[n,i,r,a]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,i){i[0]=Math.min(i[0],e,n),i[1]=Math.min(i[1],t,r),i[2]=Math.max(i[2],e,n),i[3]=Math.max(i[3],t,r)}static bezierBoundingBox(e,t,n,r,i,a,o,l,u){u[0]=Math.min(u[0],e,o),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,o),u[3]=Math.max(u[3],t,l),k(this,Na,tb).call(this,e,n,i,o,t,r,a,l,3*(-e+3*(n-i)+o),6*(e-2*n+i),3*(n-e),u),k(this,Na,tb).call(this,e,n,i,o,t,r,a,l,3*(-t+3*(r-a)+l),6*(t-2*r+a),3*(r-t),u)}}Na=new WeakSet,Qg=function(e,t,n,r,i,a,o,l,u,h){if(u<=0||u>=1)return;const f=1-u,p=u*u,m=p*u,g=f*(f*(f*e+3*u*t)+3*p*n)+m*r,y=f*(f*(f*i+3*u*a)+3*p*o)+m*l;h[0]=Math.min(h[0],g),h[1]=Math.min(h[1],y),h[2]=Math.max(h[2],g),h[3]=Math.max(h[3],y)},tb=function(e,t,n,r,i,a,o,l,u,h,f,p){if(Math.abs(u)<1e-12){Math.abs(h)>=1e-12&&k(this,Na,Qg).call(this,e,t,n,r,i,a,o,l,-f/h,p);return}const m=h**2-4*f*u;if(m<0)return;const g=Math.sqrt(m),y=2*u;k(this,Na,Qg).call(this,e,t,n,r,i,a,o,l,(-h+g)/y,p),k(this,Na,Qg).call(this,e,t,n,r,i,a,o,l,(-h-g)/y,p)},A(xe,Na);function gB(s){return decodeURIComponent(escape(s))}let jx=null,rk=null;function bj(s){return jx||(jx=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,rk=new Map([["ﬅ","ſt"]])),s.replaceAll(jx,(e,t,n)=>t?t.normalize("NFKC"):rk.get(n))}function B_(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),wj(s)}const H_="pdfjs_internal_id_";function yB(s,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...i]=t;if(!s(n)&&!Number.isInteger(n)||!e(r))return!1;const a=i.length;let o=!0;switch(r.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of i)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function Us(s,e,t){return Math.min(Math.max(s,e),t)}function Sj(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(wj(s))}function vB(s){return Uint8Array.fromBase64?Uint8Array.fromBase64(s):Ym(atob(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(s){return s.reduce((e,t)=>e+t,0)});const Fi="http://www.w3.org/2000/svg",Al=class Al{};re(Al,"CSS",96),re(Al,"PDF",72),re(Al,"PDF_TO_CSS_UNITS",Al.CSS/Al.PDF);let Oa=Al;async function bh(s,e="text"){if(Gh(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class Jm{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:i=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=i,this.offsetY=a,n*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let h,f,p,m;switch(r%=360,r<0&&(r+=360),r){case 180:h=-1,f=0,p=0,m=1;break;case 90:h=0,f=1,p=1,m=0;break;case 270:h=0,f=-1,p=-1,m=0;break;case 0:h=1,f=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,m=-m);let g,y,b,v;h===0?(g=Math.abs(u-e[1])*n+i,y=Math.abs(l-e[0])*n+a,b=(e[3]-e[1])*n,v=(e[2]-e[0])*n):(g=Math.abs(l-e[0])*n+i,y=Math.abs(u-e[1])*n+a,b=(e[2]-e[0])*n,v=(e[3]-e[1])*n),this.transform=[h*n,f*n,p*n,m*n,g-h*n*l-p*n*u,y-f*n*l-m*n*u],this.width=b,this.height=v}get rawDims(){const e=this.viewBox;return Ve(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new Jm({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){const n=[e,t];return xe.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];xe.applyTransform(t,this.transform);const n=[e[2],e[3]];return xe.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return xe.applyInverseTransform(n,this.transform),n}}class vv extends ru{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Qm(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function xv(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function _j(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function Ej(s,e="document.pdf"){if(typeof s!="string")return e;if(Qm(s))return Le('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(s);if(!n)return e;const r=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},i=/\.pdf$/i,a=n.pathname.split("/").at(-1);if(i.test(a))return r(a);if(n.searchParams.size>0){const o=Array.from(n.searchParams.values()).reverse();for(const u of o)if(i.test(u))return r(u);const l=Array.from(n.searchParams.keys()).reverse();for(const u of l)if(i.test(u))return r(u)}if(n.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(l)return r(l[0])}return e}class ik{constructor(){re(this,"started",Object.create(null));re(this,"times",[])}time(e){e in this.started&&Le(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Le(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:i}of this.times)e.push(`${n.padEnd(t)} ${i-r}ms
`);return e.join("")}}function Gh(s,e){const t=e?URL.parse(s,e):URL.parse(s);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Ar(s){s.preventDefault()}function Ht(s){s.preventDefault(),s.stopPropagation()}function xB(s){console.log("Deprecated API usage: "+s)}var ip;class wv{static toDateObject(e){if(!e||typeof e!="string")return null;d(this,ip)||_(this,ip,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=d(this,ip).exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,u==="-"?(a+=h,o+=f):u==="+"&&(a-=h,o-=f),new Date(Date.UTC(n,r,i,a,o,l))}}ip=new WeakMap,A(wv,ip);function Aj(s,{scale:e=1,rotation:t=0}){const{width:n,height:r}=s.attributes.style,i=[0,0,parseInt(n),parseInt(r)];return new Jm({viewBox:i,userUnit:1,scale:e,rotation:t})}function V_(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Le(`Not a valid color format: "${s}"`),[0,0,0])}function wB(s){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,V_(n))}e.remove()}function Ct(s){const{a:e,b:t,c:n,d:r,e:i,f:a}=s.getTransform();return[e,t,n,r,i,a]}function ii(s){const{a:e,b:t,c:n,d:r,e:i,f:a}=s.getTransform().invertSelf();return[e,t,n,r,i,a]}function el(s,e,t=!1,n=!0){if(e instanceof Jm){const{pageWidth:r,pageHeight:i}=e.rawDims,{style:a}=s,o=gs.isCSSRoundSupported,l=`var(--total-scale-factor) * ${r}px`,u=`var(--total-scale-factor) * ${i}px`,h=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,f=o?`round(down, ${u}, var(--scale-round-y))`:`calc(${u})`;!t||e.rotation%180===0?(a.width=h,a.height=f):(a.width=f,a.height=h)}n&&s.setAttribute("data-main-rotation",e.rotation)}class Jr{constructor(){const{pixelRatio:e}=Jr;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,i=-1){let a=1/0,o=1/0,l=1/0;n=Jr.capPixels(n,i),n>0&&(a=Math.sqrt(n/(e*t))),r!==-1&&(o=r/e,l=r/t);const u=Math.min(a,o,l);return this.sx>u||this.sy>u?(this.sx=u,this.sy=u,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const hy=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var eo,Pl,cr,to,ap,Yu,op,xy,kj,tn,Tj,Cj,qh,Zg;const Vi=class Vi{constructor(e){A(this,tn);A(this,eo,null);A(this,Pl,null);A(this,cr);A(this,to,null);A(this,ap,null);A(this,Yu,null);_(this,cr,e),d(Vi,op)||_(Vi,op,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=_(this,eo,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=d(this,cr)._uiManager._signal;e.addEventListener("contextmenu",Ar,{signal:t}),e.addEventListener("pointerdown",k(Vi,xy,kj),{signal:t});const n=_(this,to,document.createElement("div"));n.className="buttons",e.append(n);const r=d(this,cr).toolbarPosition;if(r){const{style:i}=e,a=d(this,cr)._uiManager.direction==="ltr"?1-r[0]:r[0];i.insetInlineEnd=`${100*a}%`,i.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return d(this,eo)}hide(){var e;d(this,eo).classList.add("hidden"),(e=d(this,Pl))==null||e.hideDropdown()}show(){var e;d(this,eo).classList.remove("hidden"),(e=d(this,ap))==null||e.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=d(this,cr),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",d(Vi,op)[e]),k(this,tn,qh).call(this,n),n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),d(this,to).append(n)}async addAltText(e){const t=await e.render();k(this,tn,qh).call(this,t),d(this,to).append(t,d(this,tn,Zg)),_(this,ap,e)}addColorPicker(e){_(this,Pl,e);const t=e.renderButton();k(this,tn,qh).call(this,t),d(this,to).append(t,d(this,tn,Zg))}async addEditSignatureButton(e){const t=_(this,Yu,await e.renderEditButton(d(this,cr)));k(this,tn,qh).call(this,t),d(this,to).append(t,d(this,tn,Zg))}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break}}updateEditSignatureButton(e){d(this,Yu)&&(d(this,Yu).title=e)}remove(){var e;d(this,eo).remove(),(e=d(this,Pl))==null||e.destroy(),_(this,Pl,null)}};eo=new WeakMap,Pl=new WeakMap,cr=new WeakMap,to=new WeakMap,ap=new WeakMap,Yu=new WeakMap,op=new WeakMap,xy=new WeakSet,kj=function(e){e.stopPropagation()},tn=new WeakSet,Tj=function(e){d(this,cr)._focusEventsAllowed=!1,Ht(e)},Cj=function(e){d(this,cr)._focusEventsAllowed=!0,Ht(e)},qh=function(e){const t=d(this,cr)._uiManager._signal;e.addEventListener("focusin",k(this,tn,Tj).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",k(this,tn,Cj).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ar,{signal:t})},Zg=function(){const e=document.createElement("div");return e.className="divider",e},A(Vi,xy),A(Vi,op,null);let sb=Vi;var lp,Rl,Ll,sl,Nj,jj,Pj;class bB{constructor(e){A(this,sl);A(this,lp,null);A(this,Rl,null);A(this,Ll);_(this,Ll,e)}show(e,t,n){const[r,i]=k(this,sl,jj).call(this,t,n),{style:a}=d(this,Rl)||_(this,Rl,k(this,sl,Nj).call(this));e.append(d(this,Rl)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){d(this,Rl).remove()}}lp=new WeakMap,Rl=new WeakMap,Ll=new WeakMap,sl=new WeakSet,Nj=function(){const e=_(this,Rl,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Ar,{signal:d(this,Ll)._signal});const t=_(this,lp,document.createElement("div"));return t.className="buttons",e.append(t),k(this,sl,Pj).call(this),e},jj=function(e,t){let n=0,r=0;for(const i of e){const a=i.y+i.height;if(a<n)continue;const o=i.x+(t?i.width:0);if(a>n){r=o,n=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,n]},Pj=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=d(this,Ll)._signal;e.addEventListener("contextmenu",Ar,{signal:n}),e.addEventListener("click",()=>{d(this,Ll).highlightSelection("floating_button")},{signal:n}),d(this,lp).append(e)};function Rj(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}var wy;class SB{constructor(){A(this,wy,0)}get id(){return`${yj}${Ws(this,wy)._++}`}}wy=new WeakMap;var Ju,cp,Is,Qu,e0;const eE=class eE{constructor(){A(this,Qu);A(this,Ju,B_());A(this,cp,0);A(this,Is,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const i=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Ve(this,"_isSVGFittingCanvas",i)}async getFromFile(e){const{lastModified:t,name:n,size:r,type:i}=e;return k(this,Qu,e0).call(this,`${t}_${n}_${r}_${i}`,e)}async getFromUrl(e){return k(this,Qu,e0).call(this,e,e)}async getFromBlob(e,t){const n=await t;return k(this,Qu,e0).call(this,e,n)}async getFromId(e){d(this,Is)||_(this,Is,new Map);const t=d(this,Is).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){d(this,Is)||_(this,Is,new Map);let n=d(this,Is).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${d(this,Ju)}_${Ws(this,cp)._++}`,refCounter:1,isSvg:!1},d(this,Is).set(e,n),d(this,Is).set(n.id,n),n}getSvgUrl(e){const t=d(this,Is).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;d(this,Is)||_(this,Is,new Map);const t=d(this,Is).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(n.width,n.height);i.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=i.convertToBlob()}(r=n.close)==null||r.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${d(this,Ju)}_`)}};Ju=new WeakMap,cp=new WeakMap,Is=new WeakMap,Qu=new WeakSet,e0=async function(e,t){d(this,Is)||_(this,Is,new Map);let n=d(this,Is).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${d(this,Ju)}_${Ws(this,cp)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(n.url=t,r=await bh(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const i=eE._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((u,h)=>{o.onload=()=>{n.bitmap=o,n.isSvg=!0,u()},a.onload=async()=>{const f=n.svgUrl=a.result;o.src=await i?`${f}#svgView(preserveAspectRatio(none))`:f},o.onerror=a.onerror=h});a.readAsDataURL(r),await l}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){Le(r),n=null}return d(this,Is).set(e,n),n&&d(this,Is).set(n.id,n),n};let nb=eE;var Ut,so,up,Tt;class _B{constructor(e=128){A(this,Ut,[]);A(this,so,!1);A(this,up);A(this,Tt,-1);_(this,up,e)}add({cmd:e,undo:t,post:n,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),d(this,so))return;const l={cmd:e,undo:t,post:n,type:i};if(d(this,Tt)===-1){d(this,Ut).length>0&&(d(this,Ut).length=0),_(this,Tt,0),d(this,Ut).push(l);return}if(a&&d(this,Ut)[d(this,Tt)].type===i){o&&(l.undo=d(this,Ut)[d(this,Tt)].undo),d(this,Ut)[d(this,Tt)]=l;return}const u=d(this,Tt)+1;u===d(this,up)?d(this,Ut).splice(0,1):(_(this,Tt,u),u<d(this,Ut).length&&d(this,Ut).splice(u)),d(this,Ut).push(l)}undo(){if(d(this,Tt)===-1)return;_(this,so,!0);const{undo:e,post:t}=d(this,Ut)[d(this,Tt)];e(),t==null||t(),_(this,so,!1),_(this,Tt,d(this,Tt)-1)}redo(){if(d(this,Tt)<d(this,Ut).length-1){_(this,Tt,d(this,Tt)+1),_(this,so,!0);const{cmd:e,post:t}=d(this,Ut)[d(this,Tt)];e(),t==null||t(),_(this,so,!1)}}hasSomethingToUndo(){return d(this,Tt)!==-1}hasSomethingToRedo(){return d(this,Tt)<d(this,Ut).length-1}cleanType(e){if(d(this,Tt)!==-1){for(let t=d(this,Tt);t>=0;t--)if(d(this,Ut)[t].type!==e){d(this,Ut).splice(t+1,d(this,Tt)-t),_(this,Tt,t);return}d(this,Ut).length=0,_(this,Tt,-1)}}destroy(){_(this,Ut,null)}}Ut=new WeakMap,so=new WeakMap,up=new WeakMap,Tt=new WeakMap;var by,Lj;class Zm{constructor(e){A(this,by);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=gs.platform;for(const[n,r,i={}]of e)for(const a of n){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(k(this,by,Lj).call(this,t));if(!n)return;const{callback:r,options:{bubbles:i=!1,args:a=[],checker:o=null}}=n;o&&!o(e,t)||(r.bind(e,...a,t)(),i||Ht(t))}}by=new WeakSet,Lj=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Sy=class Sy{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return wB(e),Ve(this,"_colors",e)}convert(e){const t=V_(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((i,a)=>i===t[a]))return Sy._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?xe.makeHexColor(...t):e}};re(Sy,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let rb=Sy;var Zu,Pn,ts,ys,ed,Gi,td,ur,no,ro,sd,Dl,di,Pr,Ml,dp,hp,nd,fp,hi,io,rd,ao,fi,_y,oo,pp,lo,Il,Ol,co,mp,os,rt,qi,uo,Fl,gp,yp,ho,pi,Ki,vp,xp,dr,ae,t0,ib,Dj,Mj,s0,Ij,Oj,Fj,ab,$j,ob,lb,Uj,Gs,$i,Bj,Hj,cb,Vj,Kh,ub;const $u=class $u{constructor(e,t,n,r,i,a,o,l,u,h,f,p,m,g,y){A(this,ae);A(this,Zu,new AbortController);A(this,Pn,null);A(this,ts,new Map);A(this,ys,new Map);A(this,ed,null);A(this,Gi,null);A(this,td,null);A(this,ur,new _B);A(this,no,null);A(this,ro,null);A(this,sd,0);A(this,Dl,new Set);A(this,di,null);A(this,Pr,null);A(this,Ml,new Set);re(this,"_editorUndoBar",null);A(this,dp,!1);A(this,hp,!1);A(this,nd,!1);A(this,fp,null);A(this,hi,null);A(this,io,null);A(this,rd,null);A(this,ao,!1);A(this,fi,null);A(this,_y,new SB);A(this,oo,!1);A(this,pp,!1);A(this,lo,null);A(this,Il,null);A(this,Ol,null);A(this,co,null);A(this,mp,null);A(this,os,je.NONE);A(this,rt,new Set);A(this,qi,null);A(this,uo,null);A(this,Fl,null);A(this,gp,null);A(this,yp,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});A(this,ho,[0,0]);A(this,pi,null);A(this,Ki,null);A(this,vp,null);A(this,xp,null);A(this,dr,null);const b=this._signal=d(this,Zu).signal;_(this,Ki,e),_(this,vp,t),_(this,xp,n),_(this,ed,r),_(this,uo,i),this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:b}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),a._on("setpreference",this.onSetPreference.bind(this),{signal:b}),a._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:b}),k(this,ae,Ij).call(this),k(this,ae,Uj).call(this),k(this,ae,ab).call(this),_(this,Gi,o.annotationStorage),_(this,fp,o.filterFactory),_(this,Fl,l),_(this,rd,u||null),_(this,dp,h),_(this,hp,f),_(this,nd,p),_(this,mp,m||null),this.viewParameters={realScale:Oa.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=y!==!1}static get _keyboardManager(){const e=$u.prototype,t=a=>d(a,Ki).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),n=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},r=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return Ve(this,"_keyboardManager",new Zm([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,Ki).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,Ki).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}destroy(){var e,t,n,r,i,a,o,l;(e=d(this,dr))==null||e.resolve(),_(this,dr,null),(t=d(this,Zu))==null||t.abort(),_(this,Zu,null),this._signal=null;for(const u of d(this,ys).values())u.destroy();d(this,ys).clear(),d(this,ts).clear(),d(this,Ml).clear(),(n=d(this,co))==null||n.clear(),_(this,Pn,null),d(this,rt).clear(),d(this,ur).destroy(),(r=d(this,ed))==null||r.destroy(),(i=d(this,uo))==null||i.destroy(),(a=d(this,fi))==null||a.hide(),_(this,fi,null),(o=d(this,Ol))==null||o.destroy(),_(this,Ol,null),d(this,hi)&&(clearTimeout(d(this,hi)),_(this,hi,null)),d(this,pi)&&(clearTimeout(d(this,pi)),_(this,pi,null)),(l=this._editorUndoBar)==null||l.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return d(this,mp)}get useNewAltTextFlow(){return d(this,hp)}get useNewAltTextWhenAddingImage(){return d(this,nd)}get hcmFilter(){return Ve(this,"hcmFilter",d(this,Fl)?d(this,fp).addHCMFilter(d(this,Fl).foreground,d(this,Fl).background):"none")}get direction(){return Ve(this,"direction",getComputedStyle(d(this,Ki)).direction)}get highlightColors(){return Ve(this,"highlightColors",d(this,rd)?new Map(d(this,rd).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColorNames(){return Ve(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),_(this,ro,e)}setMainHighlightColorPicker(e){_(this,Ol,e)}editAltText(e,t=!1){var n;(n=d(this,ed))==null||n.editAltText(this,e,t)}getSignature(e){var t;(t=d(this,uo))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return d(this,uo)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":_(this,nd,t);break}}onPageChanging({pageNumber:e}){_(this,sd,e-1)}focusMainContainer(){d(this,Ki).focus()}findParent(e,t){for(const n of d(this,ys).values()){const{x:r,y:i,width:a,height:o}=n.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return n}return null}disableUserSelect(e=!1){d(this,vp).classList.toggle("noUserSelect",e)}addShouldRescale(e){d(this,Ml).add(e)}removeShouldRescale(e){d(this,Ml).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Oa.PDF_TO_CSS_UNITS;for(const n of d(this,Ml))n.onScaleChanging();(t=d(this,ro))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}=t,o=t.toString(),u=k(this,ae,t0).call(this,t).closest(".textLayer"),h=this.getSelectionBoxes(u);if(!h)return;t.empty();const f=k(this,ae,ib).call(this,u),p=d(this,os)===je.NONE,m=()=>{f==null||f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(je.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&d(this,Gi)&&!d(this,Gi).has(e.id)&&d(this,Gi).setValue(e.id,e)}a11yAlert(e,t=null){const n=d(this,xp);n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,d(this,ao)&&(_(this,ao,!1),k(this,ae,s0).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of d(this,rt))if(t.div.contains(e)){_(this,Il,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!d(this,Il))return;const[e,t]=d(this,Il);_(this,Il,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){k(this,ae,ab).call(this),k(this,ae,ob).call(this)}removeEditListeners(){k(this,ae,$j).call(this),k(this,ae,lb).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of d(this,Pr))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of d(this,Pr))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=d(this,Pn))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of d(this,rt)){const i=r.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const a of d(this,Pr))if(a.isHandlingMimeForPasting(i.type)){a.paste(i,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(i){Le(`paste: "${i.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const i=[];for(const l of n){const u=await r.deserialize(l);if(!u)return;i.push(u)}const a=()=>{for(const l of i)k(this,ae,cb).call(this,l);k(this,ae,ub).call(this,i)},o=()=>{for(const l of i)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(i){Le(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),d(this,os)!==je.NONE&&!this.isEditorHandlingKeyboard&&$u._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,d(this,ao)&&(_(this,ao,!1),k(this,ae,s0).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(k(this,ae,Oj).call(this),k(this,ae,ob).call(this),k(this,ae,Gs).call(this,{isEditing:d(this,os)!==je.NONE,isEmpty:k(this,ae,Kh).call(this),hasSomethingToUndo:d(this,ur).hasSomethingToUndo(),hasSomethingToRedo:d(this,ur).hasSomethingToRedo(),hasSelectedEditor:!1})):(k(this,ae,Fj).call(this),k(this,ae,lb).call(this),k(this,ae,Gs).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!d(this,Pr)){_(this,Pr,e);for(const t of d(this,Pr))k(this,ae,$i).call(this,t.defaultPropertiesToUpdate)}}getId(){return d(this,_y).id}get currentLayer(){return d(this,ys).get(d(this,sd))}getLayer(e){return d(this,ys).get(e)}get currentPageIndex(){return d(this,sd)}addLayer(e){d(this,ys).set(e.pageIndex,e),d(this,oo)?e.enable():e.disable()}removeLayer(e){d(this,ys).delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1){var i,a,o;if(d(this,os)!==e&&!(d(this,dr)&&(await d(this,dr).promise,!d(this,dr)))){if(_(this,dr,Promise.withResolvers()),(i=d(this,ro))==null||i.commitOrRemove(),_(this,os,e),e===je.NONE){this.setEditingState(!1),k(this,ae,Hj).call(this),(a=this._editorUndoBar)==null||a.hide(),d(this,dr).resolve();return}e===je.SIGNATURE&&await((o=d(this,uo))==null?void 0:o.loadSignatures()),this.setEditingState(!0),await k(this,ae,Bj).call(this),this.unselectAll();for(const l of d(this,ys).values())l.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),d(this,dr).resolve();return}for(const l of d(this,ts).values())l.annotationElementId===t||l.id===t?(this.setSelected(l),r&&l.enterInEditMode()):l.unselect();d(this,dr).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==d(this,os)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){var n;if(d(this,Pr)){switch(e){case We.CREATE:this.currentLayer.addNewEditor(t);return;case We.HIGHLIGHT_DEFAULT_COLOR:(n=d(this,Ol))==null||n.updateColor(t);break;case We.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(d(this,gp)||_(this,gp,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of d(this,rt))r.updateParams(e,t);for(const r of d(this,Pr))r.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var i;for(const a of d(this,ts).values())a.editorType===e&&a.show(t);(((i=d(this,gp))==null?void 0:i.get(We.HIGHLIGHT_SHOW_ALL))??!0)!==t&&k(this,ae,$i).call(this,[[We.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(d(this,pp)!==e){_(this,pp,e);for(const t of d(this,ys).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const n of d(this,ts).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return d(this,ts).get(e)}addEditor(e){d(this,ts).set(e.id,e)}removeEditor(e){var t,n;e.div.contains(document.activeElement)&&(d(this,hi)&&clearTimeout(d(this,hi)),_(this,hi,setTimeout(()=>{this.focusMainContainer(),_(this,hi,null)},0))),d(this,ts).delete(e.id),e.annotationElementId&&((t=d(this,co))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!d(this,Dl).has(e.annotationElementId))&&((n=d(this,Gi))==null||n.remove(e.id))}addDeletedAnnotationElement(e){d(this,Dl).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return d(this,Dl).has(e)}removeDeletedAnnotationElement(e){d(this,Dl).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){d(this,Pn)!==e&&(_(this,Pn,e),e&&k(this,ae,$i).call(this,e.propertiesToUpdate))}updateUI(e){d(this,ae,Vj)===e&&k(this,ae,$i).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){k(this,ae,$i).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(d(this,rt).has(e)){d(this,rt).delete(e),e.unselect(),k(this,ae,Gs).call(this,{hasSelectedEditor:this.hasSelection});return}d(this,rt).add(e),e.select(),k(this,ae,$i).call(this,e.propertiesToUpdate),k(this,ae,Gs).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.id}),(t=d(this,ro))==null||t.commitOrRemove();for(const n of d(this,rt))n!==e&&n.unselect();d(this,rt).clear(),d(this,rt).add(e),e.select(),k(this,ae,$i).call(this,e.propertiesToUpdate),k(this,ae,Gs).call(this,{hasSelectedEditor:!0})}isSelected(e){return d(this,rt).has(e)}get firstSelectedEditor(){return d(this,rt).values().next().value}unselect(e){e.unselect(),d(this,rt).delete(e),k(this,ae,Gs).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return d(this,rt).size!==0}get isEnterHandled(){return d(this,rt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;d(this,ur).undo(),k(this,ae,Gs).call(this,{hasSomethingToUndo:d(this,ur).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:k(this,ae,Kh).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){d(this,ur).redo(),k(this,ae,Gs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:d(this,ur).hasSomethingToRedo(),isEmpty:k(this,ae,Kh).call(this)})}addCommands(e){d(this,ur).add(e),k(this,ae,Gs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:k(this,ae,Kh).call(this)})}cleanUndoStack(e){d(this,ur).cleanType(e)}delete(){var i;this.commitOrRemove();const e=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...d(this,rt)],n=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)k(this,ae,cb).call(this,a)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=d(this,Pn))==null||e.commitOrRemove()}hasSomethingToControl(){return d(this,Pn)||this.hasSelection}selectAll(){for(const e of d(this,rt))e.commit();k(this,ae,ub).call(this,d(this,ts).values())}unselectAll(){var e;if(!(d(this,Pn)&&(d(this,Pn).commitOrRemove(),d(this,os)!==je.NONE))&&!((e=d(this,ro))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of d(this,rt))t.unselect();d(this,rt).clear(),k(this,ae,Gs).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;d(this,ho)[0]+=e,d(this,ho)[1]+=t;const[r,i]=d(this,ho),a=[...d(this,rt)],o=1e3;d(this,pi)&&clearTimeout(d(this,pi)),_(this,pi,setTimeout(()=>{_(this,pi,null),d(this,ho)[0]=d(this,ho)[1]=0,this.addCommands({cmd:()=>{for(const l of a)d(this,ts).has(l.id)&&(l.translateInPage(r,i),l.translationDone())},undo:()=>{for(const l of a)d(this,ts).has(l.id)&&(l.translateInPage(-r,-i),l.translationDone())},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),_(this,di,new Map);for(const e of d(this,rt))d(this,di).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!d(this,di))return!1;this.disableUserSelect(!1);const e=d(this,di);_(this,di,null);let t=!1;for(const[{x:r,y:i,pageIndex:a},o]of e)o.newX=r,o.newY=i,o.newPageIndex=a,t||(t=r!==o.savedX||i!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const n=(r,i,a,o)=>{if(d(this,ts).has(r.id)){const l=d(this,ys).get(o);l?r._setParentAndPosition(l,i,a):(r.pageIndex=o,r.x=i,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:i,newY:a,newPageIndex:o}]of e)n(r,i,a,o)},undo:()=>{for(const[r,{savedX:i,savedY:a,savedPageIndex:o}]of e)n(r,i,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(d(this,di))for(const n of d(this,di).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||d(this,rt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return d(this,Pn)===e}getActive(){return d(this,Pn)}getMode(){return d(this,os)}get imageManager(){return Ve(this,"imageManager",new nb)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,h=t.rangeCount;u<h;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:n,y:r,width:i,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(u,h,f,p)=>({x:(h-r)/a,y:1-(u+f-n)/i,width:p/a,height:f/i});break;case"180":o=(u,h,f,p)=>({x:1-(u+f-n)/i,y:1-(h+p-r)/a,width:f/i,height:p/a});break;case"270":o=(u,h,f,p)=>({x:1-(h+p-r)/a,y:(u-n)/i,width:p/a,height:f/i});break;default:o=(u,h,f,p)=>({x:(u-n)/i,y:(h-r)/a,width:f/i,height:p/a});break}const l=[];for(let u=0,h=t.rangeCount;u<h;u++){const f=t.getRangeAt(u);if(!f.collapsed)for(const{x:p,y:m,width:g,height:y}of f.getClientRects())g===0||y===0||l.push(o(p,m,g,y))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(d(this,td)||_(this,td,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=d(this,td))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=d(this,td))==null?void 0:r.get(e.data.id);if(!t)return;const n=d(this,Gi).getRawValue(t);n&&(d(this,os)===je.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){var i;const r=(i=d(this,co))==null?void 0:i.get(e);r&&(r.setCanvas(t,n),d(this,co).delete(e))}addMissingCanvas(e,t){(d(this,co)||_(this,co,new Map)).set(e,t)}};Zu=new WeakMap,Pn=new WeakMap,ts=new WeakMap,ys=new WeakMap,ed=new WeakMap,Gi=new WeakMap,td=new WeakMap,ur=new WeakMap,no=new WeakMap,ro=new WeakMap,sd=new WeakMap,Dl=new WeakMap,di=new WeakMap,Pr=new WeakMap,Ml=new WeakMap,dp=new WeakMap,hp=new WeakMap,nd=new WeakMap,fp=new WeakMap,hi=new WeakMap,io=new WeakMap,rd=new WeakMap,ao=new WeakMap,fi=new WeakMap,_y=new WeakMap,oo=new WeakMap,pp=new WeakMap,lo=new WeakMap,Il=new WeakMap,Ol=new WeakMap,co=new WeakMap,mp=new WeakMap,os=new WeakMap,rt=new WeakMap,qi=new WeakMap,uo=new WeakMap,Fl=new WeakMap,gp=new WeakMap,yp=new WeakMap,ho=new WeakMap,pi=new WeakMap,Ki=new WeakMap,vp=new WeakMap,xp=new WeakMap,dr=new WeakMap,ae=new WeakSet,t0=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},ib=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of d(this,ys).values())if(n.hasTextLayer(e))return n;return null},Dj=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=k(this,ae,t0).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(d(this,fi)||_(this,fi,new bB(this)),d(this,fi).show(n,r,this.direction==="ltr"))},Mj=function(){var i,a,o;const e=document.getSelection();if(!e||e.isCollapsed){d(this,qi)&&((i=d(this,fi))==null||i.hide(),_(this,qi,null),k(this,ae,Gs).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===d(this,qi))return;const r=k(this,ae,t0).call(this,e).closest(".textLayer");if(!r){d(this,qi)&&((a=d(this,fi))==null||a.hide(),_(this,qi,null),k(this,ae,Gs).call(this,{hasSelectedText:!1}));return}if((o=d(this,fi))==null||o.hide(),_(this,qi,t),k(this,ae,Gs).call(this,{hasSelectedText:!0}),!(d(this,os)!==je.HIGHLIGHT&&d(this,os)!==je.NONE)&&(d(this,os)===je.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(this,ao,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=d(this,os)===je.HIGHLIGHT?k(this,ae,ib).call(this,r):null;l==null||l.toggleDrawing();const u=new AbortController,h=this.combinedSignal(u),f=p=>{p.type==="pointerup"&&p.button!==0||(u.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&k(this,ae,s0).call(this,"main_toolbar"))};window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("blur",f,{signal:h})}},s0=function(e=""){d(this,os)===je.HIGHLIGHT?this.highlightSelection(e):d(this,dp)&&k(this,ae,Dj).call(this)},Ij=function(){document.addEventListener("selectionchange",k(this,ae,Mj).bind(this),{signal:this._signal})},Oj=function(){if(d(this,io))return;_(this,io,new AbortController);const e=this.combinedSignal(d(this,io));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Fj=function(){var e;(e=d(this,io))==null||e.abort(),_(this,io,null)},ab=function(){if(d(this,lo))return;_(this,lo,new AbortController);const e=this.combinedSignal(d(this,lo));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},$j=function(){var e;(e=d(this,lo))==null||e.abort(),_(this,lo,null)},ob=function(){if(d(this,no))return;_(this,no,new AbortController);const e=this.combinedSignal(d(this,no));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},lb=function(){var e;(e=d(this,no))==null||e.abort(),_(this,no,null)},Uj=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Gs=function(e){Object.entries(e).some(([n,r])=>d(this,yp)[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(d(this,yp),e)}),d(this,os)===je.HIGHLIGHT&&e.hasSelectedEditor===!1&&k(this,ae,$i).call(this,[[We.HIGHLIGHT_FREE,!0]]))},$i=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Bj=async function(){if(!d(this,oo)){_(this,oo,!0);const e=[];for(const t of d(this,ys).values())e.push(t.enable());await Promise.all(e);for(const t of d(this,ts).values())t.enable()}},Hj=function(){if(this.unselectAll(),d(this,oo)){_(this,oo,!1);for(const e of d(this,ys).values())e.disable();for(const e of d(this,ts).values())e.disable()}},cb=function(e){const t=d(this,ys).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Vj=function(){let e=null;for(e of d(this,rt));return e},Kh=function(){if(d(this,ts).size===0)return!0;if(d(this,ts).size===1)for(const e of d(this,ts).values())return e.isEmpty();return!1},ub=function(e){for(const t of d(this,rt))t.unselect();d(this,rt).clear();for(const t of e)t.isEmpty()||(d(this,rt).add(t),t.select());k(this,ae,Gs).call(this,{hasSelectedEditor:this.hasSelection})},re($u,"TRANSLATE_SMALL",1),re($u,"TRANSLATE_BIG",10);let tl=$u;var ls,mi,Rr,id,gi,Rn,ad,yi,pn,Xi,$l,vi,fo,qr,Xh,n0;const qs=class qs{constructor(e){A(this,qr);A(this,ls,null);A(this,mi,!1);A(this,Rr,null);A(this,id,null);A(this,gi,null);A(this,Rn,null);A(this,ad,!1);A(this,yi,null);A(this,pn,null);A(this,Xi,null);A(this,$l,null);A(this,vi,!1);_(this,pn,e),_(this,vi,e._uiManager.useNewAltTextFlow),d(qs,fo)||_(qs,fo,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){qs._l10n??(qs._l10n=e)}async render(){const e=_(this,Rr,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=_(this,id,document.createElement("span"));e.append(t),d(this,vi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",d(qs,fo).missing),t.setAttribute("data-l10n-id",d(qs,fo)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=d(this,pn)._uiManager._signal;e.addEventListener("contextmenu",Ar,{signal:n}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:n});const r=i=>{i.preventDefault(),d(this,pn)._uiManager.editAltText(d(this,pn)),d(this,vi)&&d(this,pn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:d(this,qr,Xh)}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(_(this,ad,!0),r(i))},{signal:n}),await k(this,qr,n0).call(this),e}finish(){d(this,Rr)&&(d(this,Rr).focus({focusVisible:d(this,ad)}),_(this,ad,!1))}isEmpty(){return d(this,vi)?d(this,ls)===null:!d(this,ls)&&!d(this,mi)}hasData(){return d(this,vi)?d(this,ls)!==null||!!d(this,Xi):this.isEmpty()}get guessedText(){return d(this,Xi)}async setGuessedText(e){d(this,ls)===null&&(_(this,Xi,e),_(this,$l,await qs._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),k(this,qr,n0).call(this))}toggleAltTextBadge(e=!1){var t;if(!d(this,vi)||d(this,ls)){(t=d(this,yi))==null||t.remove(),_(this,yi,null);return}if(!d(this,yi)){const n=_(this,yi,document.createElement("div"));n.className="noAltTextBadge",d(this,pn).div.append(n)}d(this,yi).classList.toggle("hidden",!e)}serialize(e){let t=d(this,ls);return!e&&d(this,Xi)===t&&(t=d(this,$l)),{altText:t,decorative:d(this,mi),guessedText:d(this,Xi),textWithDisclaimer:d(this,$l)}}get data(){return{altText:d(this,ls),decorative:d(this,mi)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:i=!1}){n&&(_(this,Xi,n),_(this,$l,r)),!(d(this,ls)===e&&d(this,mi)===t)&&(i||(_(this,ls,e),_(this,mi,t)),k(this,qr,n0).call(this))}toggle(e=!1){d(this,Rr)&&(!e&&d(this,Rn)&&(clearTimeout(d(this,Rn)),_(this,Rn,null)),d(this,Rr).disabled=!e)}shown(){d(this,pn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:d(this,qr,Xh)}})}destroy(){var e,t;(e=d(this,Rr))==null||e.remove(),_(this,Rr,null),_(this,id,null),_(this,gi,null),(t=d(this,yi))==null||t.remove(),_(this,yi,null)}};ls=new WeakMap,mi=new WeakMap,Rr=new WeakMap,id=new WeakMap,gi=new WeakMap,Rn=new WeakMap,ad=new WeakMap,yi=new WeakMap,pn=new WeakMap,Xi=new WeakMap,$l=new WeakMap,vi=new WeakMap,fo=new WeakMap,qr=new WeakSet,Xh=function(){return d(this,ls)&&"added"||d(this,ls)===null&&this.guessedText&&"review"||"missing"},n0=async function(){var r,i,a;const e=d(this,Rr);if(!e)return;if(d(this,vi)){if(e.classList.toggle("done",!!d(this,ls)),e.setAttribute("data-l10n-id",d(qs,fo)[d(this,qr,Xh)]),(r=d(this,id))==null||r.setAttribute("data-l10n-id",d(qs,fo)[`${d(this,qr,Xh)}-label`]),!d(this,ls)){(i=d(this,gi))==null||i.remove();return}}else{if(!d(this,ls)&&!d(this,mi)){e.classList.remove("done"),(a=d(this,gi))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=d(this,gi);if(!t){_(this,gi,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${d(this,pn).id}`;const o=100,l=d(this,pn)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(d(this,Rn)),_(this,Rn,null)},{once:!0}),e.addEventListener("mouseenter",()=>{_(this,Rn,setTimeout(()=>{_(this,Rn,null),d(this,gi).classList.add("show"),d(this,pn)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var u;d(this,Rn)&&(clearTimeout(d(this,Rn)),_(this,Rn,null)),(u=d(this,gi))==null||u.classList.remove("show")},{signal:l})}d(this,mi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=d(this,ls)),t.parentNode||e.append(t);const n=d(this,pn).getElementForAltText();n==null||n.setAttribute("aria-describedby",t.id)},A(qs,fo,null),re(qs,"_l10n",null);let fy=qs;var od,Ul,wp,bp,Sp,_p,Ep,Yi,Bl,Ji,Hl,Qi,nl,zj,Wj,Gj;const tE=class tE{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:a=null,signal:o}){A(this,nl);A(this,od);A(this,Ul,!1);A(this,wp,null);A(this,bp);A(this,Sp);A(this,_p);A(this,Ep);A(this,Yi,null);A(this,Bl);A(this,Ji,null);A(this,Hl);A(this,Qi,null);_(this,od,e),_(this,wp,n),_(this,bp,t),_(this,Sp,r),_(this,_p,i),_(this,Ep,a),_(this,Hl,new AbortController),_(this,Bl,AbortSignal.any([o,d(this,Hl).signal])),e.addEventListener("touchstart",k(this,nl,zj).bind(this),{passive:!1,signal:d(this,Bl)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Jr.pixelRatio}destroy(){var e,t;(e=d(this,Hl))==null||e.abort(),_(this,Hl,null),(t=d(this,Yi))==null||t.abort(),_(this,Yi,null)}};od=new WeakMap,Ul=new WeakMap,wp=new WeakMap,bp=new WeakMap,Sp=new WeakMap,_p=new WeakMap,Ep=new WeakMap,Yi=new WeakMap,Bl=new WeakMap,Ji=new WeakMap,Hl=new WeakMap,Qi=new WeakMap,nl=new WeakSet,zj=function(e){var r,i,a;if((r=d(this,bp))!=null&&r.call(this))return;if(e.touches.length===1){if(d(this,Yi))return;const o=_(this,Yi,new AbortController),l=AbortSignal.any([d(this,Bl),o.signal]),u=d(this,od),h={capture:!0,signal:l,passive:!1},f=p=>{var m;p.pointerType==="touch"&&((m=d(this,Yi))==null||m.abort(),_(this,Yi,null))};u.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(Ht(p),f(p))},h),u.addEventListener("pointerup",f,h),u.addEventListener("pointercancel",f,h);return}if(!d(this,Qi)){_(this,Qi,new AbortController);const o=AbortSignal.any([d(this,Bl),d(this,Qi).signal]),l=d(this,od),u={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",k(this,nl,Wj).bind(this),u);const h=k(this,nl,Gj).bind(this);l.addEventListener("touchend",h,u),l.addEventListener("touchcancel",h,u),u.capture=!0,l.addEventListener("pointerdown",Ht,u),l.addEventListener("pointermove",Ht,u),l.addEventListener("pointercancel",Ht,u),l.addEventListener("pointerup",Ht,u),(i=d(this,Sp))==null||i.call(this)}if(Ht(e),e.touches.length!==2||(a=d(this,wp))!=null&&a.call(this)){_(this,Ji,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),_(this,Ji,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},Wj=function(e){var E;if(!d(this,Ji)||e.touches.length!==2)return;Ht(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:i}=t,{screenX:a,screenY:o}=n,l=d(this,Ji),{touch0X:u,touch0Y:h,touch1X:f,touch1Y:p}=l,m=f-u,g=p-h,y=a-r,b=o-i,v=Math.hypot(y,b)||1,x=Math.hypot(m,g)||1;if(!d(this,Ul)&&Math.abs(x-v)<=tE.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=r,l.touch0Y=i,l.touch1X=a,l.touch1Y=o,!d(this,Ul)){_(this,Ul,!0);return}const w=[(r+a)/2,(i+o)/2];(E=d(this,_p))==null||E.call(this,w,x,v)},Gj=function(e){var t;e.touches.length>=2||(d(this,Qi)&&(d(this,Qi).abort(),_(this,Qi,null),(t=d(this,Ep))==null||t.call(this)),d(this,Ji)&&(Ht(e),_(this,Ji,null),_(this,Ul,!1)))};let ep=tE;var Vl,Lr,_t,ld,po,Ap,zl,vs,Wl,Zi,mo,kp,Gl,Ln,Tp,ql,ea,xi,cd,ud,hr,Kl,Cp,Ey,Ae,db,Np,hb,r0,qj,Kj,fb,i0,pb,Xj,Yj,Jj,mb,Qj,gb,Zj,eP,tP,yb,Yh;const Fe=class Fe{constructor(e){A(this,Ae);A(this,Vl,null);A(this,Lr,null);A(this,_t,null);A(this,ld,!1);A(this,po,null);A(this,Ap,"");A(this,zl,!1);A(this,vs,null);A(this,Wl,null);A(this,Zi,null);A(this,mo,null);A(this,kp,"");A(this,Gl,!1);A(this,Ln,null);A(this,Tp,!1);A(this,ql,!1);A(this,ea,!1);A(this,xi,null);A(this,cd,0);A(this,ud,0);A(this,hr,null);A(this,Kl,null);re(this,"isSelected",!1);re(this,"_isCopy",!1);re(this,"_editToolbar",null);re(this,"_initialOptions",Object.create(null));re(this,"_initialData",null);re(this,"_isVisible",!0);re(this,"_uiManager",null);re(this,"_focusEventsAllowed",!0);A(this,Cp,!1);A(this,Ey,Fe._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[i,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Fe.prototype._resizeWithKeyboard,t=tl.TRANSLATE_SMALL,n=tl.TRANSLATE_BIG;return Ve(this,"_resizerKeyboardManager",new Zm([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Fe.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Ve(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new EB({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Fe._l10n??(Fe._l10n=e),Fe._l10nResizer||(Fe._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Fe._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);Fe._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ct("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return d(this,Cp)}set _isDraggable(e){var t;_(this,Cp,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=d(this,Ey)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):k(this,Ae,Yh).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(d(this,Gl)?_(this,Gl,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[i,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}translate(e,t){k(this,Ae,db).call(this,this.parentDimensions,e,t)}translateInPage(e,t){d(this,Ln)||_(this,Ln,[this.x,this.y,this.width,this.height]),k(this,Ae,db).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){d(this,Ln)||_(this,Ln,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,u]=this.getBaseTranslation();a+=l,o+=u;const{style:h}=n;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!d(this,Ln)&&(d(this,Ln)[0]!==this.x||d(this,Ln)[1]!==this.y)}get _hasBeenResized(){return!!d(this,Ln)&&(d(this,Ln)[2]!==this.width||d(this,Ln)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=Fe,r=n/e,i=n/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:i,y:a,width:o,height:l}=this;if(o*=n,l*=r,i*=n,a*=r,this._mustFixPosition)switch(e){case 0:i=Us(i,0,n-o),a=Us(a,0,r-l);break;case 90:i=Us(i,0,n-l),a=Us(a,o,r);break;case 180:i=Us(i,o,n),a=Us(a,l,r);break;case 270:i=Us(i,l,n),a=Us(a,0,r-o);break}this.x=i/=n,this.y=a/=r;const[u,h]=this.getBaseTranslation();i+=u,a+=h,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return k(n=Fe,Np,hb).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return k(n=Fe,Np,hb).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){const[n,r]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/n).toFixed(2)}%`,d(this,zl)||(i.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:n}=e,r=n.endsWith("%"),i=!d(this,zl)&&t.endsWith("%");if(r&&i)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(n)/a).toFixed(2)}%`),!d(this,zl)&&!i&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=d(this,_t))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||d(this,ql))return this._editToolbar;this._editToolbar=new sb(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=d(this,_t))==null||e.destroy())}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return d(this,_t)||(fy.initialize(Fe._l10n),_(this,_t,new fy(this)),d(this,Vl)&&(d(this,_t).data=d(this,Vl),_(this,Vl,null))),d(this,_t)}get altTextData(){var e;return(e=d(this,_t))==null?void 0:e.data}set altTextData(e){d(this,_t)&&(d(this,_t).data=e)}get guessedAltText(){var e;return(e=d(this,_t))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=d(this,_t))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=d(this,_t))==null?void 0:t.serialize(e)}hasAltText(){return!!d(this,_t)&&!d(this,_t).isEmpty()}hasAltTextData(){var e;return((e=d(this,_t))==null?void 0:e.hasData())??!1}render(){var a;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=d(this,ld)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),k(this,Ae,gb).call(this);const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,i]=this.getInitialTranslation();return this.translate(r,i),Rj(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(d(this,Kl)||_(this,Kl,new ep({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:k(this,Ae,Xj).bind(this),onPinching:k(this,Ae,Yj).bind(this),onPinchEnd:k(this,Ae,Jj).bind(this),signal:this._uiManager._signal}))),(a=this._uiManager._editorUndoBar)==null||a.hide(),e}pointerdown(e){const{isMac:t}=gs.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(_(this,Gl,!0),this._isDraggable){k(this,Ae,Qj).call(this,e);return}k(this,Ae,mb).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){d(this,xi)&&clearTimeout(d(this,xi)),_(this,xi,setTimeout(()=>{var e;_(this,xi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[i,a]=this.pageDimensions,[o,l]=this.pageTranslation,u=e/r,h=t/r,f=this.x*i,p=this.y*a,m=this.width*i,g=this.height*a;switch(n){case 0:return[f+u+o,a-p-h-g+l,f+u+m+o,a-p-h+l];case 90:return[f+h+o,a-p+u+l,f+h+g+o,a-p+u+m+l];case 180:return[f-u-m+o,a-p+h+l,f-u+o,a-p+h+g+l];case 270:return[f-h-g+o,a-p-u-m+l,f-h+o,a-p-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,i,a]=e,o=i-n,l=a-r;switch(this.rotation){case 0:return[n,t-a,o,l];case 90:return[n,t-r,l,o];case 180:return[i,t-r,o,l];case 270:return[i,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),_(this,ql,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),_(this,ql,!1),!0):!1}isInEditMode(){return d(this,ql)}shouldGetKeyboardEvents(){return d(this,ea)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return t<a&&r>0&&e<i&&n>0}rebuild(){k(this,Ae,gb).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){ct("An editor must be serializable")}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId});r.rotation=e.rotation,_(r,Vl,e.accessibilityData),r._isCopy=e.isCopy||!1;const[i,a]=r.pageDimensions,[o,l,u,h]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=l/a,r.width=u/i,r.height=h/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=d(this,mo))==null||e.abort(),_(this,mo,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),d(this,xi)&&(clearTimeout(d(this,xi)),_(this,xi,null)),k(this,Ae,Yh).call(this),this.removeEditToolbar(),d(this,hr)){for(const n of d(this,hr).values())clearTimeout(n);_(this,hr,null)}this.parent=null,(t=d(this,Kl))==null||t.destroy(),_(this,Kl,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(k(this,Ae,qj).call(this),d(this,vs).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),_(this,Zi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=d(this,vs).children;if(!d(this,Lr)){_(this,Lr,Array.from(t));const a=k(this,Ae,Zj).bind(this),o=k(this,Ae,eP).bind(this),l=this._uiManager._signal;for(const u of d(this,Lr)){const h=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:l}),u.addEventListener("blur",o,{signal:l}),u.addEventListener("focus",k(this,Ae,tP).bind(this,h),{signal:l}),u.setAttribute("data-l10n-id",Fe._l10nResizer[h])}}const n=d(this,Lr)[0];let r=0;for(const a of t){if(a===n)break;r++}const i=(360-this.rotation+this.parentRotation)%360/90*(d(this,Lr).length/4);if(i!==r){if(i<r)for(let o=0;o<r-i;o++)d(this,vs).append(d(this,vs).firstChild);else if(i>r)for(let o=0;o<i-r;o++)d(this,vs).firstChild.before(d(this,vs).lastChild);let a=0;for(const o of t){const u=d(this,Lr)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",Fe._l10nResizer[u])}}k(this,Ae,yb).call(this,0),_(this,ea,!0),d(this,vs).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){d(this,ea)&&k(this,Ae,pb).call(this,d(this,kp),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){k(this,Ae,Yh).call(this),this.div.focus()}select(){var e,t,n;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,i;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(t=this._editToolbar)==null||t.show(),(n=d(this,_t))==null||n.toggleAltTextBadge(!1)}}unselect(){var e,t,n,r,i;this.isSelected&&(this.isSelected=!1,(e=d(this,vs))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(i=d(this,_t))==null||i.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return d(this,Tp)}set isEditing(e){_(this,Tp,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){_(this,zl,!0);const n=e/t,{style:r}=this.div;r.aspectRatio=n,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){d(this,hr)||_(this,hr,new Map);const{action:n}=e;let r=d(this,hr).get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),d(this,hr).delete(n),d(this,hr).size===0&&_(this,hr,null)},Fe._telemetryTimeout),d(this,hr).set(n,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),_(this,ld,!1)}disable(){this.div&&(this.div.tabIndex=-1),_(this,ld,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Vl=new WeakMap,Lr=new WeakMap,_t=new WeakMap,ld=new WeakMap,po=new WeakMap,Ap=new WeakMap,zl=new WeakMap,vs=new WeakMap,Wl=new WeakMap,Zi=new WeakMap,mo=new WeakMap,kp=new WeakMap,Gl=new WeakMap,Ln=new WeakMap,Tp=new WeakMap,ql=new WeakMap,ea=new WeakMap,xi=new WeakMap,cd=new WeakMap,ud=new WeakMap,hr=new WeakMap,Kl=new WeakMap,Cp=new WeakMap,Ey=new WeakMap,Ae=new WeakSet,db=function([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Np=new WeakSet,hb=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},r0=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},qj=function(){if(d(this,vs))return;_(this,vs,document.createElement("div")),d(this,vs).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");d(this,vs).append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",k(this,Ae,Kj).bind(this,n),{signal:t}),r.addEventListener("contextmenu",Ar,{signal:t}),r.tabIndex=-1}this.div.prepend(d(this,vs))},Kj=function(e,t){var h;t.preventDefault();const{isMac:n}=gs.platform;if(t.button!==0||t.ctrlKey&&n)return;(h=d(this,_t))==null||h.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,_(this,Wl,[t.screenX,t.screenY]);const i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",k(this,Ae,pb).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Ht,{passive:!1,signal:a}),window.addEventListener("contextmenu",Ar,{signal:a}),_(this,Zi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var f;i.abort(),this.parent.togglePointerEvents(!0),(f=d(this,_t))==null||f.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=l,k(this,Ae,i0).call(this)};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})},fb=function(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t;const[i,a]=this.parentDimensions;this.setDims(i*n,a*r),this.fixAndSetPosition(),this._onResized()},i0=function(){if(!d(this,Zi))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=d(this,Zi);_(this,Zi,null);const i=this.x,a=this.y,o=this.width,l=this.height;i===e&&a===t&&o===n&&l===r||this.addCommands({cmd:k(this,Ae,fb).bind(this,i,a,o,l),undo:k(this,Ae,fb).bind(this,e,t,n,r),mustExec:!0})},pb=function(e,t){const[n,r]=this.parentDimensions,i=this.x,a=this.y,o=this.width,l=this.height,u=Fe.MIN_SIZE/n,h=Fe.MIN_SIZE/r,f=k(this,Ae,r0).call(this,this.rotation),p=(F,B)=>[f[0]*F+f[2]*B,f[1]*F+f[3]*B],m=k(this,Ae,r0).call(this,360-this.rotation),g=(F,B)=>[m[0]*F+m[2]*B,m[1]*F+m[3]*B];let y,b,v=!1,x=!1;switch(e){case"topLeft":v=!0,y=(F,B)=>[0,0],b=(F,B)=>[F,B];break;case"topMiddle":y=(F,B)=>[F/2,0],b=(F,B)=>[F/2,B];break;case"topRight":v=!0,y=(F,B)=>[F,0],b=(F,B)=>[0,B];break;case"middleRight":x=!0,y=(F,B)=>[F,B/2],b=(F,B)=>[0,B/2];break;case"bottomRight":v=!0,y=(F,B)=>[F,B],b=(F,B)=>[0,0];break;case"bottomMiddle":y=(F,B)=>[F/2,B],b=(F,B)=>[F/2,0];break;case"bottomLeft":v=!0,y=(F,B)=>[0,B],b=(F,B)=>[F,0];break;case"middleLeft":x=!0,y=(F,B)=>[0,B/2],b=(F,B)=>[F,B/2];break}const w=y(o,l),E=b(o,l);let T=p(...E);const C=Fe._round(i+T[0]),N=Fe._round(a+T[1]);let j=1,R=1,D,z;if(t.fromKeyboard)({deltaX:D,deltaY:z}=t);else{const{screenX:F,screenY:B}=t,[M,$]=d(this,Wl);[D,z]=this.screenToPageTranslation(F-M,B-$),d(this,Wl)[0]=F,d(this,Wl)[1]=B}if([D,z]=g(D/n,z/r),v){const F=Math.hypot(o,l);j=R=Math.max(Math.min(Math.hypot(E[0]-w[0]-D,E[1]-w[1]-z)/F,1/o,1/l),u/o,h/l)}else x?j=Us(Math.abs(E[0]-w[0]-D),u,1)/o:R=Us(Math.abs(E[1]-w[1]-z),h,1)/l;const L=Fe._round(o*j),I=Fe._round(l*R);T=p(...b(L,I));const O=C-T[0],Y=N-T[1];d(this,Ln)||_(this,Ln,[this.x,this.y,this.width,this.height]),this.width=L,this.height=I,this.x=O,this.y=Y,this.setDims(n*L,r*I),this.fixAndSetPosition(),this._onResizing()},Xj=function(){var e;_(this,Zi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=d(this,_t))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Yj=function(e,t,n){let i=.7*(n/t)+1-.7;if(i===1)return;const a=k(this,Ae,r0).call(this,this.rotation),o=(C,N)=>[a[0]*C+a[2]*N,a[1]*C+a[3]*N],[l,u]=this.parentDimensions,h=this.x,f=this.y,p=this.width,m=this.height,g=Fe.MIN_SIZE/l,y=Fe.MIN_SIZE/u;i=Math.max(Math.min(i,1/p,1/m),g/p,y/m);const b=Fe._round(p*i),v=Fe._round(m*i);if(b===p&&v===m)return;d(this,Ln)||_(this,Ln,[h,f,p,m]);const x=o(p/2,m/2),w=Fe._round(h+x[0]),E=Fe._round(f+x[1]),T=o(b/2,v/2);this.x=w-T[0],this.y=E-T[1],this.width=b,this.height=v,this.setDims(l*b,u*v),this.fixAndSetPosition(),this._onResizing()},Jj=function(){var e;(e=d(this,_t))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),k(this,Ae,i0).call(this)},mb=function(e){const{isMac:t}=gs.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Qj=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,i=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:i},o=u=>{r.abort(),_(this,po,null),_(this,Gl,!1),this._uiManager.endDragSession()||k(this,Ae,mb).call(this,u),n&&this._onStopDragging()};t&&(_(this,cd,e.clientX),_(this,ud,e.clientY),_(this,po,e.pointerId),_(this,Ap,e.pointerType),window.addEventListener("pointermove",u=>{n||(n=!0,this._onStartDragging());const{clientX:h,clientY:f,pointerId:p}=u;if(p!==d(this,po)){Ht(u);return}const[m,g]=this.screenToPageTranslation(h-d(this,cd),f-d(this,ud));_(this,cd,h),_(this,ud,f),this._uiManager.dragSelectedEditors(m,g)},a),window.addEventListener("touchmove",Ht,a),window.addEventListener("pointerdown",u=>{u.pointerType===d(this,Ap)&&(d(this,Kl)||u.isPrimary)&&o(u),Ht(u)},a));const l=u=>{if(!d(this,po)||d(this,po)===u.pointerId){o(u);return}Ht(u)};window.addEventListener("pointerup",l,{signal:i}),window.addEventListener("blur",l,{signal:i})},gb=function(){if(d(this,mo)||!this.div)return;_(this,mo,new AbortController);const e=this._uiManager.combinedSignal(d(this,mo));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Zj=function(e){Fe._resizerKeyboardManager.exec(this,e)},eP=function(e){var t;d(this,ea)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==d(this,vs)&&k(this,Ae,Yh).call(this)},tP=function(e){_(this,kp,d(this,ea)?e:"")},yb=function(e){if(d(this,Lr))for(const t of d(this,Lr))t.tabIndex=e},Yh=function(){_(this,ea,!1),k(this,Ae,yb).call(this,-1),k(this,Ae,i0).call(this)},A(Fe,Np),re(Fe,"_l10n",null),re(Fe,"_l10nResizer",null),re(Fe,"_borderLineWidth",-1),re(Fe,"_colorManager",new rb),re(Fe,"_zIndex",1),re(Fe,"_telemetryTimeout",1e3);let yt=Fe;class EB extends yt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ak=3285377520,ar=4294901760,ai=65535;class sP{constructor(e){this.h1=e?e&4294967295:ak,this.h2=e?e&4294967295:ak}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let y=0,b=e.length;y<b;y++){const v=e.charCodeAt(y);v<=255?t[n++]=v:(t[n++]=v>>>8,t[n++]=v&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,i=n-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,l=0,u=this.h1,h=this.h2;const f=3432918353,p=461845907,m=f&ai,g=p&ai;for(let y=0;y<r;y++)y&1?(o=a[y],o=o*f&ar|o*m&ai,o=o<<15|o>>>17,o=o*p&ar|o*g&ai,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(l=a[y],l=l*f&ar|l*m&ai,l=l<<15|l>>>17,l=l*p&ar|l*g&ai,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*f&ar|o*m&ai,o=o<<15|o>>>17,o=o*p&ar|o*g&ai,r&1?u^=o:h^=o}this.h1=u,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&ar|e*36045&ai,t=t*4283543511&ar|((t<<16|e>>>16)*2950163797&ar)>>>16,e^=t>>>1,e=e*444984403&ar|e*60499&ai,t=t*3301882366&ar|((t<<16|e>>>16)*3120437893&ar)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const vb=Object.freeze({map:null,hash:"",transfer:void 0});var Xl,Yl,xs,Ay,nP;class z_{constructor(){A(this,Ay);A(this,Xl,!1);A(this,Yl,null);A(this,xs,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=d(this,xs).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return d(this,xs).get(e)}remove(e){if(d(this,xs).delete(e),d(this,xs).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of d(this,xs).values())if(t instanceof yt)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=d(this,xs).get(e);let r=!1;if(n!==void 0)for(const[i,a]of Object.entries(t))n[i]!==a&&(r=!0,n[i]=a);else r=!0,d(this,xs).set(e,t);r&&k(this,Ay,nP).call(this),t instanceof yt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return d(this,xs).has(e)}get size(){return d(this,xs).size}resetModified(){d(this,Xl)&&(_(this,Xl,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new rP(this)}get serializable(){if(d(this,xs).size===0)return vb;const e=new Map,t=new sP,n=[],r=Object.create(null);let i=!1;for(const[a,o]of d(this,xs)){const l=o instanceof yt?o.serialize(!1,r):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),i||(i=!!l.bitmap))}if(i)for(const a of e.values())a.bitmap&&n.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:vb}get editorStats(){let e=null;const t=new Map;for(const n of d(this,xs).values()){if(!(n instanceof yt))continue;const r=n.telemetryFinalData;if(!r)continue;const{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));const a=e[i]||(e[i]=new Map);for(const[o,l]of Object.entries(r)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));const h=u.get(l)??0;u.set(l,h+1)}}for(const[n,r]of t)e[n]=r.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){_(this,Yl,null)}get modifiedIds(){if(d(this,Yl))return d(this,Yl);const e=[];for(const t of d(this,xs).values())!(t instanceof yt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return _(this,Yl,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return d(this,xs).entries()}}Xl=new WeakMap,Yl=new WeakMap,xs=new WeakMap,Ay=new WeakSet,nP=function(){d(this,Xl)||(_(this,Xl,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var jp;class rP extends z_{constructor(t){super();A(this,jp);const{map:n,hash:r,transfer:i}=t.serializable,a=structuredClone(n,i?{transfer:i}:null);_(this,jp,{map:a,hash:r,transfer:i})}get print(){ct("Should not call PrintAnnotationStorage.print")}get serializable(){return d(this,jp)}get modifiedIds(){return Ve(this,"modifiedIds",{ids:new Set,hash:""})}}jp=new WeakMap;var dd;class AB{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){A(this,dd,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),d(this,dd).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||d(this,dd).has(e.loadedName))){if(Yt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:i,style:a}=e,o=new FontFace(r,i,a);this.addNativeFontFace(o);try{await o.load(),d(this,dd).add(r),n==null||n(e)}catch{Le(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}ct("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw Le(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Ve(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Ve(this,"isSyncFontLoadingSupported",Qs||gs.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Yt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const i=n.shift();setTimeout(i.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ve(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(E,T){return E.charCodeAt(T)<<24|E.charCodeAt(T+1)<<16|E.charCodeAt(T+2)<<8|E.charCodeAt(T+3)&255}function r(E,T,C,N){const j=E.substring(0,T),R=E.substring(T+C);return j+N+R}let i,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let u=0;function h(E,T){if(++u>30){Le("Load test font never loaded."),T();return}if(l.font="30px "+E,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){T();return}setTimeout(h.bind(null,E,T))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=r(p,976,f.length,f);const g=16,y=1482184792;let b=n(p,g);for(i=0,a=f.length-3;i<a;i+=4)b=b-y+n(f,i)|0;i<f.length&&(b=b-y+n(f+"XXX",i)|0),p=r(p,g,4,fB(b));const v=`url(data:font/opentype;base64,${btoa(p)});`,x=`@font-face {font-family:"${f}";src:${v}}`;this.insertRule(x);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const E of[e.loadedName,f]){const T=this._document.createElement("span");T.textContent="Hi",T.style.fontFamily=E,w.append(T)}this._document.body.append(w),h(f,()=>{w.remove(),t.complete()})}}dd=new WeakMap;class kB{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const n in e)this[n]=e[n];this._inspectFont=t}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Sj(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(a){Le(`getPathGenerator - ignoring character: "${a}".`)}const i=new Path2D(r||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=i}}function TB(s){if(s instanceof URL)return s.href;if(typeof s=="string"){if(Qs)return s;const e=URL.parse(s,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function CB(s){if(Qs&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return Ym(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Rg(s){if(typeof s!="string")return null;if(s.endsWith("/"))return s;throw new Error(`Invalid factory url: "${s}" must include trailing slash.`)}const xb=s=>typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0,NB=s=>typeof s=="object"&&typeof(s==null?void 0:s.name)=="string",iP=yB.bind(null,xb,NB);var ta,ky;class jB{constructor(){A(this,ta,new Map);A(this,ky,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};d(this,ky).then(()=>{for(const[r]of d(this,ta))r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:i}=n;if(i.aborted){Le("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener("abort",a),i.addEventListener("abort",a)}d(this,ta).set(t,r)}removeEventListener(e,t){const n=d(this,ta).get(t);n==null||n(),d(this,ta).delete(t)}terminate(){for(const[,e]of d(this,ta))e==null||e();d(this,ta).clear()}}ta=new WeakMap,ky=new WeakMap;const Lg={DATA:1,ERROR:2},Gt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function ok(){}function hn(s){if(s instanceof Ia||s instanceof dy||s instanceof nk||s instanceof Zf||s instanceof Cx)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||ct('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Ia(s.message);case"InvalidPDFException":return new dy(s.message);case"PasswordException":return new nk(s.message,s.code);case"ResponseException":return new Zf(s.message,s.status,s.missing);case"UnknownErrorException":return new Cx(s.message,s.details)}return new Cx(s.message,s.toString())}var hd,br,aP,oP,lP,a0;class Jh{constructor(e,t,n){A(this,br);A(this,hd,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",k(this,br,aP).bind(this),{signal:d(this,hd).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(a){i.reject(a)}return i.promise}sendWithStream(e,t,n,r){const i=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const h=Promise.withResolvers();return this.streamControllers[i]={controller:u,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:i,data:t,desiredSize:u.desiredSize},r),h.promise},pull:u=>{const h=Promise.withResolvers();return this.streamControllers[i].pullCall=h,l.postMessage({sourceName:a,targetName:o,stream:Gt.PULL,streamId:i,desiredSize:u.desiredSize}),h.promise},cancel:u=>{Yt(u instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[i].cancelCall=h,this.streamControllers[i].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:Gt.CANCEL,streamId:i,reason:hn(u)}),h.promise}},n)}destroy(){var e;(e=d(this,hd))==null||e.abort(),_(this,hd,null)}}hd=new WeakMap,br=new WeakSet,aP=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){k(this,br,lP).call(this,e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Lg.DATA)r.resolve(e.data);else if(e.callback===Lg.ERROR)r.reject(hn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(a){i.postMessage({sourceName:n,targetName:r,callback:Lg.DATA,callbackId:e.callbackId,data:a})},function(a){i.postMessage({sourceName:n,targetName:r,callback:Lg.ERROR,callbackId:e.callbackId,reason:hn(a)})});return}if(e.streamId){k(this,br,oP).call(this,e);return}t(e.data)},oP=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(u,h=1,f){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=h,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:r,stream:Gt.ENQUEUE,streamId:t,chunk:u},f)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Gt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(u){Yt(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Gt.ERROR,streamId:t,reason:hn(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Gt.START_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:n,targetName:r,stream:Gt.START_COMPLETE,streamId:t,reason:hn(u)})})},lP=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Gt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(hn(e.reason));break;case Gt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(hn(e.reason));break;case Gt.PULL:if(!o){i.postMessage({sourceName:n,targetName:r,stream:Gt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||ok).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Gt.PULL_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:n,targetName:r,stream:Gt.PULL_COMPLETE,streamId:t,reason:hn(u)})});break;case Gt.ENQUEUE:if(Yt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Gt.CLOSE:if(Yt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),k(this,br,a0).call(this,a,t);break;case Gt.ERROR:Yt(a,"error should have stream controller"),a.controller.error(hn(e.reason)),k(this,br,a0).call(this,a,t);break;case Gt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(hn(e.reason)),k(this,br,a0).call(this,a,t);break;case Gt.CANCEL:if(!o)break;const l=hn(e.reason);Promise.try(o.onCancel||ok,l).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Gt.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:n,targetName:r,stream:Gt.CANCEL_COMPLETE,streamId:t,reason:hn(u)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},a0=async function(e,t){var n,r,i;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(r=e.pullCall)==null?void 0:r.promise,(i=e.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var Pp;class cP{constructor({enableHWA:e=!1}){A(this,Pp,!1);_(this,Pp,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!d(this,Pp)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ct("Abstract method `_createCanvas` called.")}}Pp=new WeakMap;class PB extends cP{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class uP{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ct("Abstract method `_fetch` called.")}}class lk extends uP{async _fetch(e){const t=await bh(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ym(t)}}class dP{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,i){return"none"}destroy(e=!1){}}var Jl,fd,sa,na,Os,Ql,Zl,le,Ms,Qh,gu,o0,yu,hP,wb,vu,Zh,ef,bb,tf;class RB extends dP{constructor({docId:t,ownerDocument:n=globalThis.document}){super();A(this,le);A(this,Jl);A(this,fd);A(this,sa);A(this,na);A(this,Os);A(this,Ql);A(this,Zl,0);_(this,na,t),_(this,Os,n)}addFilter(t){if(!t)return"none";let n=d(this,le,Ms).get(t);if(n)return n;const[r,i,a]=k(this,le,o0).call(this,t),o=t.length===1?r:`${r}${i}${a}`;if(n=d(this,le,Ms).get(o),n)return d(this,le,Ms).set(t,n),n;const l=`g_${d(this,na)}_transfer_map_${Ws(this,Zl)._++}`,u=k(this,le,yu).call(this,l);d(this,le,Ms).set(t,u),d(this,le,Ms).set(o,u);const h=k(this,le,vu).call(this,l);return k(this,le,ef).call(this,r,i,a,h),u}addHCMFilter(t,n){var g;const r=`${t}-${n}`,i="base";let a=d(this,le,Qh).get(i);if((a==null?void 0:a.key)===r||(a?((g=a.filter)==null||g.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},d(this,le,Qh).set(i,a)),!t||!n))return a.url;const o=k(this,le,tf).call(this,t);t=xe.makeHexColor(...o);const l=k(this,le,tf).call(this,n);if(n=xe.makeHexColor(...l),d(this,le,gu).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return a.url;const u=new Array(256);for(let y=0;y<=255;y++){const b=y/255;u[y]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const h=u.join(","),f=`g_${d(this,na)}_hcm_filter`,p=a.filter=k(this,le,vu).call(this,f);k(this,le,ef).call(this,h,h,h,p),k(this,le,wb).call(this,p);const m=(y,b)=>{const v=o[y]/255,x=l[y]/255,w=new Array(b+1);for(let E=0;E<=b;E++)w[E]=v+E/b*(x-v);return w.join(",")};return k(this,le,ef).call(this,m(0,5),m(1,5),m(2,5),p),a.url=k(this,le,yu).call(this,f),a.url}addAlphaFilter(t){let n=d(this,le,Ms).get(t);if(n)return n;const[r]=k(this,le,o0).call(this,[t]),i=`alpha_${r}`;if(n=d(this,le,Ms).get(i),n)return d(this,le,Ms).set(t,n),n;const a=`g_${d(this,na)}_alpha_map_${Ws(this,Zl)._++}`,o=k(this,le,yu).call(this,a);d(this,le,Ms).set(t,o),d(this,le,Ms).set(i,o);const l=k(this,le,vu).call(this,a);return k(this,le,bb).call(this,r,l),o}addLuminosityFilter(t){let n=d(this,le,Ms).get(t||"luminosity");if(n)return n;let r,i;if(t?([r]=k(this,le,o0).call(this,[t]),i=`luminosity_${r}`):i="luminosity",n=d(this,le,Ms).get(i),n)return d(this,le,Ms).set(t,n),n;const a=`g_${d(this,na)}_luminosity_map_${Ws(this,Zl)._++}`,o=k(this,le,yu).call(this,a);d(this,le,Ms).set(t,o),d(this,le,Ms).set(i,o);const l=k(this,le,vu).call(this,a);return k(this,le,hP).call(this,l),t&&k(this,le,bb).call(this,r,l),o}addHighlightHCMFilter(t,n,r,i,a){var x;const o=`${n}-${r}-${i}-${a}`;let l=d(this,le,Qh).get(t);if((l==null?void 0:l.key)===o||(l?((x=l.filter)==null||x.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},d(this,le,Qh).set(t,l)),!n||!r))return l.url;const[u,h]=[n,r].map(k(this,le,tf).bind(this));let f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),p=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[m,g]=[i,a].map(k(this,le,tf).bind(this));p<f&&([f,p,m,g]=[p,f,g,m]),d(this,le,gu).style.color="";const y=(w,E,T)=>{const C=new Array(256),N=(p-f)/T,j=w/255,R=(E-w)/(255*T);let D=0;for(let z=0;z<=T;z++){const L=Math.round(f+z*N),I=j+z*R;for(let O=D;O<=L;O++)C[O]=I;D=L+1}for(let z=D;z<256;z++)C[z]=C[D-1];return C.join(",")},b=`g_${d(this,na)}_hcm_${t}_filter`,v=l.filter=k(this,le,vu).call(this,b);return k(this,le,wb).call(this,v),k(this,le,ef).call(this,y(m[0],g[0],5),y(m[1],g[1],5),y(m[2],g[2],5),v),l.url=k(this,le,yu).call(this,b),l.url}destroy(t=!1){var n,r,i,a;t&&((n=d(this,Ql))!=null&&n.size)||((r=d(this,sa))==null||r.parentNode.parentNode.remove(),_(this,sa,null),(i=d(this,fd))==null||i.clear(),_(this,fd,null),(a=d(this,Ql))==null||a.clear(),_(this,Ql,null),_(this,Zl,0))}}Jl=new WeakMap,fd=new WeakMap,sa=new WeakMap,na=new WeakMap,Os=new WeakMap,Ql=new WeakMap,Zl=new WeakMap,le=new WeakSet,Ms=function(){return d(this,fd)||_(this,fd,new Map)},Qh=function(){return d(this,Ql)||_(this,Ql,new Map)},gu=function(){if(!d(this,sa)){const t=d(this,Os).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const r=d(this,Os).createElementNS(Fi,"svg");r.setAttribute("width",0),r.setAttribute("height",0),_(this,sa,d(this,Os).createElementNS(Fi,"defs")),t.append(r),r.append(d(this,sa)),d(this,Os).body.append(t)}return d(this,sa)},o0=function(t){if(t.length===1){const u=t[0],h=new Array(256);for(let p=0;p<256;p++)h[p]=u[p]/255;const f=h.join(",");return[f,f,f]}const[n,r,i]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let u=0;u<256;u++)a[u]=n[u]/255,o[u]=r[u]/255,l[u]=i[u]/255;return[a.join(","),o.join(","),l.join(",")]},yu=function(t){if(d(this,Jl)===void 0){_(this,Jl,"");const n=d(this,Os).URL;n!==d(this,Os).baseURI&&(Qm(n)?Le('#createUrl: ignore "data:"-URL for performance reasons.'):_(this,Jl,U_(n,"")))}return`url(${d(this,Jl)}#${t})`},hP=function(t){const n=d(this,Os).createElementNS(Fi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},wb=function(t){const n=d(this,Os).createElementNS(Fi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},vu=function(t){const n=d(this,Os).createElementNS(Fi,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),d(this,le,gu).append(n),n},Zh=function(t,n,r){const i=d(this,Os).createElementNS(Fi,n);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),t.append(i)},ef=function(t,n,r,i){const a=d(this,Os).createElementNS(Fi,"feComponentTransfer");i.append(a),k(this,le,Zh).call(this,a,"feFuncR",t),k(this,le,Zh).call(this,a,"feFuncG",n),k(this,le,Zh).call(this,a,"feFuncB",r)},bb=function(t,n){const r=d(this,Os).createElementNS(Fi,"feComponentTransfer");n.append(r),k(this,le,Zh).call(this,r,"feFuncA",t)},tf=function(t){return d(this,le,gu).style.color=t,V_(getComputedStyle(d(this,le,gu)).getPropertyValue("color"))};class fP{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ct("Abstract method `_fetch` called.")}}class ck extends fP{async _fetch(e){const t=await bh(e,"arraybuffer");return new Uint8Array(t)}}class pP{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){ct("Abstract method `_fetch` called.")}}class uk extends pP{async _fetch(e){const t=await bh(e,"arraybuffer");return new Uint8Array(t)}}Qs&&Le("Please use the `legacy` build in Node.js environments.");async function W_(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class LB extends dP{}class DB extends cP{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class MB extends uP{async _fetch(e){return W_(e)}}class IB extends fP{async _fetch(e){return W_(e)}}class OB extends pP{async _fetch(e){return W_(e)}}const Es={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Sb(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),s.clip(r)}class G_{isModifyingCurrentTransform(){return!1}getPattern(){ct("Abstract method `getPattern` called.")}}class FB extends G_{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let i;if(r===Es.STROKE||r===Es.FILL){const a=t.current.getClippedPathBoundingBox(r,Ct(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",o,l),h=u.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),n=xe.transform(n,[1,0,0,1,a[0],a[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),Sb(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),i=e.createPattern(u.canvas,"no-repeat");const f=new DOMMatrix(n);i.setTransform(f)}else Sb(e,this._bbox),i=this._createGradient(e);return i}}function Px(s,e,t,n,r,i,a,o){const l=e.coords,u=e.colors,h=s.data,f=s.width*4;let p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=i,i=a,a=p),l[n+1]>l[r+1]&&(p=n,n=r,r=p,p=a,a=o,o=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=i,i=a,a=p);const m=(l[t]+e.offsetX)*e.scaleX,g=(l[t+1]+e.offsetY)*e.scaleY,y=(l[n]+e.offsetX)*e.scaleX,b=(l[n+1]+e.offsetY)*e.scaleY,v=(l[r]+e.offsetX)*e.scaleX,x=(l[r+1]+e.offsetY)*e.scaleY;if(g>=x)return;const w=u[i],E=u[i+1],T=u[i+2],C=u[a],N=u[a+1],j=u[a+2],R=u[o],D=u[o+1],z=u[o+2],L=Math.round(g),I=Math.round(x);let O,Y,F,B,M,$,K,J;for(let Z=L;Z<=I;Z++){if(Z<b){const X=Z<g?0:(g-Z)/(g-b);O=m-(m-y)*X,Y=w-(w-C)*X,F=E-(E-N)*X,B=T-(T-j)*X}else{let X;Z>x?X=1:b===x?X=0:X=(b-Z)/(b-x),O=y-(y-v)*X,Y=C-(C-R)*X,F=N-(N-D)*X,B=j-(j-z)*X}let pe;Z<g?pe=0:Z>x?pe=1:pe=(g-Z)/(g-x),M=m-(m-v)*pe,$=w-(w-R)*pe,K=E-(E-D)*pe,J=T-(T-z)*pe;const Se=Math.round(Math.min(O,M)),Pe=Math.round(Math.max(O,M));let H=f*Z+Se*4;for(let X=Se;X<=Pe;X++)pe=(O-X)/(O-M),pe<0?pe=0:pe>1&&(pe=1),h[H++]=Y-(Y-$)*pe|0,h[H++]=F-(F-K)*pe|0,h[H++]=B-(B-J)*pe|0,h[H++]=255}}function $B(s,e,t){const n=e.coords,r=e.colors;let i,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(n.length/o)-1,u=o-1;for(i=0;i<l;i++){let h=i*o;for(let f=0;f<u;f++,h++)Px(s,t,n[h],n[h+1],n[h+o],r[h],r[h+1],r[h+o]),Px(s,t,n[h+o+1],n[h+1],n[h+o],r[h+o+1],r[h+1],r[h+o])}break;case"triangles":for(i=0,a=n.length;i<a;i+=3)Px(s,t,n[i],n[i+1],n[i+2],r[i],r[i+1],r[i+2]);break;default:throw new Error("illegal figure")}}class UB extends G_{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,h=Math.ceil(this._bounds[3])-l,f=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),m=u/f,g=h/p,y={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/m,scaleY:1/g},b=f+2*2,v=p+2*2,x=n.getCanvas("mesh",b,v),w=x.context,E=w.createImageData(f,p);if(t){const C=E.data;for(let N=0,j=C.length;N<j;N+=4)C[N]=t[0],C[N+1]=t[1],C[N+2]=t[2],C[N+3]=255}for(const C of this._figures)$B(E,C,y);return w.putImageData(E,2,2),{canvas:x.canvas,offsetX:o-2*m,offsetY:l-2*g,scaleX:m,scaleY:g}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){Sb(e,this._bbox);const i=new Float32Array(2);if(r===Es.SHADING)xe.singularValueDecompose2dScale(Ct(e),i);else if(this.matrix){xe.singularValueDecompose2dScale(this.matrix,i);const[o,l]=i;xe.singularValueDecompose2dScale(t.baseTransform,i),i[0]*=o,i[1]*=l}else xe.singularValueDecompose2dScale(t.baseTransform,i);const a=this._createMeshCanvas(i,r===Es.SHADING?null:this._background,t.cachedCanvases);return r!==Es.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class BB extends G_{getPattern(){return"hotpink"}}function HB(s){switch(s[0]){case"RadialAxial":return new FB(s);case"Mesh":return new UB(s);case"Dummy":return new BB}throw new Error(`Unknown IR type: ${s[0]}`)}const dk={COLORED:1,UNCOLORED:2},Ty=class Ty{constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:n,paintType:r,tilingType:i,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),yv("TilingType: "+i);const h=t[0],f=t[1],p=t[2],m=t[3],g=p-h,y=m-f,b=new Float32Array(2);xe.singularValueDecompose2dScale(this.matrix,b);const[v,x]=b;xe.singularValueDecompose2dScale(this.baseTransform,b);const w=v*b[0],E=x*b[1];let T=g,C=y,N=!1,j=!1;const R=Math.ceil(l*w),D=Math.ceil(u*E),z=Math.ceil(g*w),L=Math.ceil(y*E);R>=z?T=l:N=!0,D>=L?C=u:j=!0;const I=this.getSizeAndScale(T,this.ctx.canvas.width,w),O=this.getSizeAndScale(C,this.ctx.canvas.height,E),Y=e.cachedCanvases.getCanvas("pattern",I.size,O.size),F=Y.context,B=o.createCanvasGraphics(F);if(B.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(B,r,a),F.translate(-I.scale*h,-O.scale*f),B.transform(I.scale,0,0,O.scale,0,0),F.save(),this.clipBbox(B,h,f,p,m),B.baseTransform=Ct(B.ctx),B.executeOperatorList(n),B.endDrawing(),F.restore(),N||j){const M=Y.canvas;N&&(T=l),j&&(C=u);const $=this.getSizeAndScale(T,this.ctx.canvas.width,w),K=this.getSizeAndScale(C,this.ctx.canvas.height,E),J=$.size,Z=K.size,pe=e.cachedCanvases.getCanvas("pattern-workaround",J,Z),Se=pe.context,Pe=N?Math.floor(g/l):0,H=j?Math.floor(y/u):0;for(let X=0;X<=Pe;X++)for(let we=0;we<=H;we++)Se.drawImage(M,J*X,Z*we,J,Z,0,0,J,Z);return{canvas:pe.canvas,scaleX:$.scale,scaleY:K.scale,offsetX:h,offsetY:f}}return{canvas:Y.canvas,scaleX:I.scale,scaleY:O.scale,offsetX:h,offsetY:f}}getSizeAndScale(e,t,n){const r=Math.max(Ty.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,r,i){const a=r-t,o=i-n;e.ctx.rect(t,n,a,o),xe.axialAlignedBoundingBox([t,n,r,i],Ct(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,i=e.current;switch(t){case dk.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;r.fillStyle=i.fillColor=a,r.strokeStyle=i.strokeColor=o;break;case dk.UNCOLORED:r.fillStyle=r.strokeStyle=n,i.fillColor=i.strokeColor=n;break;default:throw new hB(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r){let i=n;r!==Es.SHADING&&(i=xe.transform(i,t.baseTransform),this.matrix&&(i=xe.transform(i,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};re(Ty,"MAX_PATTERN_SIZE",3e3);let _b=Ty;function VB({src:s,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:i=4294967295,inverseDecode:a=!1}){const o=gs.isLittleEndian?4278190080:255,[l,u]=a?[i,o]:[o,i],h=n>>3,f=n&7,p=s.length;t=new Uint32Array(t.buffer);let m=0;for(let g=0;g<r;g++){for(const b=e+h;e<b;e++){const v=e<p?s[e]:255;t[m++]=v&128?u:l,t[m++]=v&64?u:l,t[m++]=v&32?u:l,t[m++]=v&16?u:l,t[m++]=v&8?u:l,t[m++]=v&4?u:l,t[m++]=v&2?u:l,t[m++]=v&1?u:l}if(f===0)continue;const y=e<p?s[e++]:255;for(let b=0;b<f;b++)t[m++]=y&1<<7-b?u:l}return{srcPos:e,destPos:m}}const hk=16,fk=100,zB=15,pk=10,yn=16,Rx=new DOMMatrix,qn=new Float32Array(2),Fu=new Float32Array([1/0,1/0,-1/0,-1/0]);function WB(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},s.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},s.transform=function(t,n,r,i,a,o){e.transform(t,n,r,i,a,o),this.__originalTransform(t,n,r,i,a,o)},s.setTransform=function(t,n,r,i,a,o){e.setTransform(t,n,r,i,a,o),this.__originalSetTransform(t,n,r,i,a,o)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(t){e.rotate(t),this.__originalRotate(t)},s.clip=function(t){e.clip(t),this.__originalClip(t)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,r,i,a,o){e.bezierCurveTo(t,n,r,i,a,o),this.__originalBezierCurveTo(t,n,r,i,a,o)},s.rect=function(t,n,r,i){e.rect(t,n,r,i),this.__originalRect(t,n,r,i)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class GB{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Dg(s,e,t,n,r,i,a,o,l,u){const[h,f,p,m,g,y]=Ct(s);if(f===0&&p===0){const x=a*h+g,w=Math.round(x),E=o*m+y,T=Math.round(E),C=(a+l)*h+g,N=Math.abs(Math.round(C)-w)||1,j=(o+u)*m+y,R=Math.abs(Math.round(j)-T)||1;return s.setTransform(Math.sign(h),0,0,Math.sign(m),w,T),s.drawImage(e,t,n,r,i,0,0,N,R),s.setTransform(h,f,p,m,g,y),[N,R]}if(h===0&&m===0){const x=o*p+g,w=Math.round(x),E=a*f+y,T=Math.round(E),C=(o+u)*p+g,N=Math.abs(Math.round(C)-w)||1,j=(a+l)*f+y,R=Math.abs(Math.round(j)-T)||1;return s.setTransform(0,Math.sign(f),Math.sign(p),0,w,T),s.drawImage(e,t,n,r,i,0,0,R,N),s.setTransform(h,f,p,m,g,y),[R,N]}s.drawImage(e,t,n,r,i,a,o,l,u);const b=Math.hypot(h,f),v=Math.hypot(p,m);return[b*l,v*u]}class mk{constructor(e,t){re(this,"alphaIsShape",!1);re(this,"fontSize",0);re(this,"fontSizeScale",1);re(this,"textMatrix",null);re(this,"textMatrixScale",1);re(this,"fontMatrix",eb);re(this,"leading",0);re(this,"x",0);re(this,"y",0);re(this,"lineX",0);re(this,"lineY",0);re(this,"charSpacing",0);re(this,"wordSpacing",0);re(this,"textHScale",1);re(this,"textRenderingMode",Ds.FILL);re(this,"textRise",0);re(this,"fillColor","#000000");re(this,"strokeColor","#000000");re(this,"patternFill",!1);re(this,"patternStroke",!1);re(this,"fillAlpha",1);re(this,"strokeAlpha",1);re(this,"lineWidth",1);re(this,"activeSMask",null);re(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Fu.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Es.FILL,t=null){const n=this.minMax.slice();if(e===Es.STROKE){t||ct("Stroke bounding box must include transform."),xe.singularValueDecompose2dScale(t,qn);const r=qn[0]*this.lineWidth/2,i=qn[1]*this.lineWidth/2;n[0]-=r,n[1]-=i,n[2]+=r,n[3]+=i}return n}updateClipFromPath(){const e=xe.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Fu,0)}getClippedPathBoundingBox(e=Es.FILL,t=null){return xe.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function gk(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%yn,i=(t-r)/yn,a=r===0?i:i+1,o=s.createImageData(n,yn);let l=0,u;const h=e.data,f=o.data;let p,m,g,y;if(e.kind===Cf.GRAYSCALE_1BPP){const b=h.byteLength,v=new Uint32Array(f.buffer,0,f.byteLength>>2),x=v.length,w=n+7>>3,E=4294967295,T=gs.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(g=p<i?yn:r,u=0,m=0;m<g;m++){const C=b-l;let N=0;const j=C>w?n:C*8-7,R=j&-8;let D=0,z=0;for(;N<R;N+=8)z=h[l++],v[u++]=z&128?E:T,v[u++]=z&64?E:T,v[u++]=z&32?E:T,v[u++]=z&16?E:T,v[u++]=z&8?E:T,v[u++]=z&4?E:T,v[u++]=z&2?E:T,v[u++]=z&1?E:T;for(;N<j;N++)D===0&&(z=h[l++],D=128),v[u++]=z&D?E:T,D>>=1}for(;u<x;)v[u++]=0;s.putImageData(o,0,p*yn)}}else if(e.kind===Cf.RGBA_32BPP){for(m=0,y=n*yn*4,p=0;p<i;p++)f.set(h.subarray(l,l+y)),l+=y,s.putImageData(o,0,m),m+=yn;p<a&&(y=n*r*4,f.set(h.subarray(l,l+y)),s.putImageData(o,0,m))}else if(e.kind===Cf.RGB_24BPP)for(g=yn,y=n*g,p=0;p<a;p++){for(p>=i&&(g=r,y=n*g),u=0,m=y;m--;)f[u++]=h[l++],f[u++]=h[l++],f[u++]=h[l++],f[u++]=255;s.putImageData(o,0,p*yn)}else throw new Error(`bad image kind: ${e.kind}`)}function yk(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%yn,i=(t-r)/yn,a=r===0?i:i+1,o=s.createImageData(n,yn);let l=0;const u=e.data,h=o.data;for(let f=0;f<a;f++){const p=f<i?yn:r;({srcPos:l}=VB({src:u,srcPos:l,dest:h,width:n,height:p,nonBlackColor:0})),s.putImageData(o,0,f*yn)}}function Dh(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function Mg(s){s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0);const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}function vk(s,e){if(e)return!0;xe.singularValueDecompose2dScale(s,qn);const t=Math.fround(Jr.pixelRatio*Oa.PDF_TO_CSS_UNITS);return qn[0]<=t&&qn[1]<=t}const qB=["butt","round","square"],KB=["miter","round","bevel"],XB={},xk={};var Qr,Eb,Ab,kb;const sE=class sE{constructor(e,t,n,r,i,{optionalContentConfig:a,markedContentStack:o=null},l,u){A(this,Qr);this.ctx=e,this.current=new mk(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new GB(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,n){const l=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Ct(this.compositeCtx))}this.ctx.save(),Mg(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ct(this.ctx)}executeOperatorList(e,t,n,r){const i=e.argsArray,a=e.fnArray;let o=t||0;const l=i.length;if(l===o)return o;const u=l-o>pk&&typeof n=="function",h=u?Date.now()+zB:0;let f=0;const p=this.commonObjs,m=this.objs;let g;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,n),o;if(g=a[o],g!==Qf.dependency)this[g].apply(this,i[o]);else for(const y of i[o]){const b=y.startsWith("g_")?p:m;if(!b.has(y))return b.get(y,n),o}if(o++,o===l)return o;if(u&&++f>pk){if(Date.now()>h)return n(),o;f=0}}}endDrawing(){k(this,Qr,Eb).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),k(this,Qr,Ab).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=n,l=r,u="prescale1",h,f;for(;i>2&&o>1||a>2&&l>1;){let p=o,m=l;i>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/p),a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/m),h=this.cachedCanvases.getCanvas(u,p,m),f=h.context,f.clearRect(0,0,p,m),f.drawImage(e,0,0,o,l,0,0,p,m),e=h.canvas,o=p,l=m,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:r}=e,i=this.current.fillColor,a=this.current.patternFill,o=Ct(t);let l,u,h,f;if((e.bitmap||e.data)&&e.count>1){const R=e.bitmap||e.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),i]),l=this._cachedBitmapsMap.get(R),l||(l=new Map,this._cachedBitmapsMap.set(R,l));const D=l.get(u);if(D&&!a){const z=Math.round(Math.min(o[0],o[2])+o[4]),L=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:D,offsetX:z,offsetY:L}}h=D}h||(f=this.cachedCanvases.getCanvas("maskCanvas",n,r),yk(f.context,e));let p=xe.transform(o,[1/n,0,0,-1/r,0,0]);p=xe.transform(p,[1,0,0,1,0,-r]);const m=Fu.slice();xe.axialAlignedBoundingBox([0,0,n,r],p,m);const[g,y,b,v]=m,x=Math.round(b-g)||1,w=Math.round(v-y)||1,E=this.cachedCanvases.getCanvas("fillCanvas",x,w),T=E.context,C=g,N=y;T.translate(-C,-N),T.transform(...p),h||(h=this._scaleImage(f.canvas,ii(T)),h=h.img,l&&a&&l.set(u,h)),T.imageSmoothingEnabled=vk(Ct(T),e.interpolate),Dg(T,h,0,0,h.width,h.height,0,0,n,r),T.globalCompositeOperation="source-in";const j=xe.transform(ii(T),[1,0,0,1,-C,-N]);return T.fillStyle=a?i.getPattern(t,this,j,Es.FILL):i,T.fillRect(0,0,n,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round(C),offsetY:Math.round(N)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=qB[e]}setLineJoin(e){this.ctx.lineJoin=KB[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx;const i=this.ctx=r.context;i.setTransform(this.suspendedCtx.getTransform()),Dh(this.suspendedCtx,i),WB(i,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Dh(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const i=r[0],a=r[1],o=r[2]-i,l=r[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,n,o,l,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,i,a,o,l,u,h,f){let p=e.canvas,m=l-h,g=u-f;if(a)if(m<0||g<0||m+n>p.width||g+r>p.height){const b=this.cachedCanvases.getCanvas("maskExtension",n,r),v=b.context;v.drawImage(p,-m,-g),v.globalCompositeOperation="destination-atop",v.fillStyle=a,v.fillRect(0,0,n,r),v.globalCompositeOperation="source-over",p=b.canvas,m=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(m,g,n,r),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(m,g,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const y=new Path2D;y.rect(l,u,n,r),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(p,m,g,n,r,l,u,n,r),t.restore()}save(){this.inSMaskMode&&Dh(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Dh(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,i,a){this.ctx.transform(e,t,n,r,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let[r]=t;if(!n){r||(r=t[0]=new Path2D),this[e](r);return}if(!(r instanceof Path2D)){const i=t[0]=new Path2D;for(let a=0,o=r.length;a<o;)switch(r[a++]){case Pg.moveTo:i.moveTo(r[a++],r[a++]);break;case Pg.lineTo:i.lineTo(r[a++],r[a++]);break;case Pg.curveTo:i.bezierCurveTo(r[a++],r[a++],r[a++],r[a++],r[a++],r[a++]);break;case Pg.closePath:i.closePath();break;default:Le(`Unrecognized drawing path operator: ${r[a-1]}`);break}r=i}xe.axialAlignedBoundingBox(n,Ct(this.ctx),this.current.minMax),this[e](r)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const n=this.ctx,r=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const i=r.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=r.getPattern(n,this,ii(n),Es.STROKE),i){const a=new Path2D;a.addPath(e,n.getTransform().invertSelf().multiplySelf(i)),e=a}this.rescaleAndStroke(e,!1),n.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Es.STROKE,Ct(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const n=this.ctx,r=this.current.fillColor,i=this.current.patternFill;let a=!1;if(i){const l=r.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.fillStyle=r.getPattern(n,this,ii(n),Es.FILL),l){const u=new Path2D;u.addPath(e,n.getTransform().invertSelf().multiplySelf(l)),e=u}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(n.fill(e,"evenodd"),this.pendingEOFill=!1):n.fill(e)),a&&n.restore(),t&&this.consumePath(e,o)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=XB}eoClip(){this.pendingClip=xk}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const n=new Path2D,r=t.getTransform().invertSelf();for(const{transform:i,x:a,y:o,fontSize:l,path:u}of e)n.addPath(u,new DOMMatrix(i).preMultiplySelf(r).translate(a,o).scale(l,-l));t.clip(n),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var h;const n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=n.fontMatrix||eb,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Le("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const i=n.loadedName||"sans-serif",a=((h=n.systemFontInfo)==null?void 0:h.css)||`"${i}", ${n.fallbackName}`;let o="normal";n.black?o="900":n.bold&&(o="bold");const l=n.italic?"italic":"normal";let u=t;t<hk?u=hk:t>fk&&(u=fk),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${o} ${u}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,r,i){const a=this.ctx,o=this.current,l=o.font,u=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,f=u&Ds.FILL_STROKE_MASK,p=!!(u&Ds.ADD_TO_PATH_FLAG),m=o.patternFill&&!l.missingFile,g=o.patternStroke&&!l.missingFile;let y;if((l.disableFontFace||p||m||g)&&(y=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||g){a.save(),a.translate(t,n),a.scale(h,-h);let b;if((f===Ds.FILL||f===Ds.FILL_STROKE)&&(r?(b=a.getTransform(),a.setTransform(...r),a.fill(k(this,Qr,kb).call(this,y,b,r))):a.fill(y)),f===Ds.STROKE||f===Ds.FILL_STROKE)if(i){b||(b=a.getTransform()),a.setTransform(...i);const{a:v,b:x,c:w,d:E}=b,T=xe.inverseTransform(i),C=xe.transform([v,x,w,E,0,0],T);xe.singularValueDecompose2dScale(C,qn),a.lineWidth*=Math.max(qn[0],qn[1])/h,a.stroke(k(this,Qr,kb).call(this,y,b,i))}else a.lineWidth/=h,a.stroke(y);a.restore()}else(f===Ds.FILL||f===Ds.FILL_STROKE)&&a.fillText(e,t,n),(f===Ds.STROKE||f===Ds.FILL_STROKE)&&a.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ct(a),x:t,y:n,fontSize:h,path:y})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return Ve(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const i=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,h=t.textHScale*u,f=e.length,p=n.vertical,m=p?1:-1,g=n.defaultVMetrics,y=r*t.fontMatrix[0],b=t.textRenderingMode===Ds.FILL&&!n.disableFontFace&&!t.patternFill;i.save(),t.textMatrix&&i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),u>0?i.scale(h,-1):i.scale(h,1);let v,x;if(t.patternFill){i.save();const N=t.fillColor.getPattern(i,this,ii(i),Es.FILL);v=Ct(i),i.restore(),i.fillStyle=N}if(t.patternStroke){i.save();const N=t.strokeColor.getPattern(i,this,ii(i),Es.STROKE);x=Ct(i),i.restore(),i.strokeStyle=N}let w=t.lineWidth;const E=t.textMatrixScale;if(E===0||w===0){const N=t.textRenderingMode&Ds.FILL_STROKE_MASK;(N===Ds.STROKE||N===Ds.FILL_STROKE)&&(w=this.getSinglePixelWidth())}else w/=E;if(a!==1&&(i.scale(a,a),w/=a),i.lineWidth=w,n.isInvalidPDFjsFont){const N=[];let j=0;for(const R of e)N.push(R.unicode),j+=R.width;i.fillText(N.join(""),0,0),t.x+=j*y*h,i.restore(),this.compose();return}let T=0,C;for(C=0;C<f;++C){const N=e[C];if(typeof N=="number"){T+=m*N*r/1e3;continue}let j=!1;const R=(N.isSpace?l:0)+o,D=N.fontChar,z=N.accent;let L,I,O=N.width;if(p){const F=N.vmetric||g,B=-(N.vmetric?F[1]:O*.5)*y,M=F[2]*y;O=F?-F[0]:O,L=B/a,I=(T+M)/a}else L=T/a,I=0;if(n.remeasure&&O>0){const F=i.measureText(D).width*1e3/r*a;if(O<F&&this.isFontSubpixelAAEnabled){const B=O/F;j=!0,i.save(),i.scale(B,1),L/=B}else O!==F&&(L+=(O-F)/2e3*r/a)}if(this.contentVisible&&(N.isInFont||n.missingFile)){if(b&&!z)i.fillText(D,L,I);else if(this.paintChar(D,L,I,v,x),z){const F=L+r*z.offset.x/a,B=I-r*z.offset.y/a;this.paintChar(z.fontChar,F,B,v,x)}}const Y=p?O*y-R*u:O*y+R*u;T+=Y,j&&i.restore()}p?t.y-=T:t.x+=T*h,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,r=n.font,i=n.fontSize,a=n.fontDirection,o=r.vertical?1:-1,l=n.charSpacing,u=n.wordSpacing,h=n.textHScale*a,f=n.fontMatrix||eb,p=e.length,m=n.textRenderingMode===Ds.INVISIBLE;let g,y,b,v;if(!(m||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),n.textMatrix&&t.transform(...n.textMatrix),t.translate(n.x,n.y+n.textRise),t.scale(h,a),g=0;g<p;++g){if(y=e[g],typeof y=="number"){v=o*y*i/1e3,this.ctx.translate(v,0),n.x+=v*h;continue}const x=(y.isSpace?u:0)+l,w=r.charProcOperatorList[y.operatorListId];w?this.contentVisible&&(this.save(),t.scale(i,i),t.transform(...f),this.executeOperatorList(w),this.restore()):Le(`Type3 character "${y.operatorListId}" is not available.`);const E=[y.width,0];xe.applyTransform(E,f),b=E[0]*i+x,t.translate(b,0),n.x+=b*h}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,r,i,a){const o=new Path2D;o.rect(n,r,i-n,a-r),this.ctx.clip(o),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const n=this.baseTransform||Ct(this.ctx),r={createCanvasGraphics:i=>new sE(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new _b(e,this.ctx,r,n)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=HB(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,ii(t),Es.SHADING);const r=ii(t);if(r){const{width:i,height:a}=t.canvas,o=Fu.slice();xe.axialAlignedBoundingBox([0,0,i,a],r,o);const[l,u,h,f]=o;this.ctx.fillRect(l,u,h-l,f-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ct("Should not call beginInlineImage")}beginImageData(){ct("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Ct(this.ctx),t)){xe.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[n,r,i,a]=t,o=new Path2D;o.rect(n,r,i-n,a-r),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||yv("TODO: Support non-isolated groups."),e.knockout&&Le("Knockout groups not supported.");const n=Ct(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Fu.slice();xe.axialAlignedBoundingBox(e.bbox,Ct(t),r);const i=[0,0,t.canvas.width,t.canvas.height];r=xe.intersect(r,i)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,u]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(h,l,u),p=f.context;p.translate(-a,-o),p.transform(...n);let m=new Path2D;const[g,y,b,v]=e.bbox;if(m.rect(g,y,b-g,v-y),e.matrix){const x=new Path2D;x.addPath(m,new DOMMatrix(e.matrix)),m=x}p.clip(m),e.smask?this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),Dh(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=Ct(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const i=Fu.slice();xe.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r,i),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,n,r,i){if(k(this,Qr,Eb).call(this),Mg(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(i&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o,xe.singularValueDecompose2dScale(Ct(this.ctx),qn);const{viewportScale:l}=this,u=Math.ceil(a*this.outputScaleX*l),h=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(u,h);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(qn[0],0,0,-qn[1],0,o*qn[1]),Mg(this.ctx)}else{Mg(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],a,o),this.ctx.clip(l)}}this.current=new mk(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),k(this,Qr,Ab).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const n=this.ctx,r=this._createMaskCanvas(e),i=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(i,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,r=0,i,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=Ct(o);o.transform(t,n,r,i,0,0);const u=this._createMaskCanvas(e);o.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let h=0,f=a.length;h<f;h+=2){const p=xe.transform(l,[t,n,r,i,a[h],a[h+1]]);o.drawImage(u.canvas,p[4],p[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;for(const i of e){const{data:a,width:o,height:l,transform:u}=i,h=this.cachedCanvases.getCanvas("maskCanvas",o,l),f=h.context;f.save();const p=this.getObject(a,i);yk(f,p),f.globalCompositeOperation="source-in",f.fillStyle=r?n.getPattern(f,this,ii(t),Es.FILL):n,f.fillRect(0,0,o,l),f.restore(),t.save(),t.transform(...u),t.scale(1,-1),Dg(t,h.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Le("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,r){if(!this.contentVisible)return;const i=this.getObject(e);if(!i){Le("Dependent image isn't ready yet");return}const a=i.width,o=i.height,l=[];for(let u=0,h=r.length;u<h;u+=2)l.push({transform:[t,0,0,n,r[u],r[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(i,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",n,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,r=this.ctx;this.save();const{filter:i}=r;i!=="none"&&i!==""&&(r.filter="none"),r.scale(1/t,-1/n);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const u=this.cachedCanvases.getCanvas("inlineImage",t,n).context;gk(u,e),a=this.applyTransferMapsToCanvas(u)}const o=this._scaleImage(a,ii(r));r.imageSmoothingEnabled=vk(Ct(r),e.interpolate),Dg(r,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const i=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",i,a).context;gk(l,e),r=this.applyTransferMapsToCanvas(l)}for(const i of t)n.save(),n.transform(...i.transform),n.scale(1,-1),Dg(n,r,i.x,i.y,i.w,i.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const r=this.ctx;this.pendingClip&&(n||(this.pendingClip===xk?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Ct(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:i}=this.ctx.getTransform();let a,o;if(n===0&&r===0){const l=Math.abs(t),u=Math.abs(i);if(l===u)if(e===0)a=o=1/l;else{const h=l*e;a=o=h<1?1/h:1}else if(e===0)a=1/l,o=1/u;else{const h=l*e,f=u*e;a=h<1?1/h:1,o=f<1?1/f:1}}else{const l=Math.abs(t*i-n*r),u=Math.hypot(t,n),h=Math.hypot(r,i);if(e===0)a=h/l,o=u/l;else{const f=e*l;a=h>f?h/f:1,o=u>f?u/f:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[i,a]=this.getScaleForStroking();if(i===a){n.lineWidth=(r||1)*i,n.stroke(e);return}const o=n.getLineDash();t&&n.save(),n.scale(i,a),Rx.a=1/i,Rx.d=1/a;const l=new Path2D;if(l.addPath(e,Rx),o.length>0){const u=Math.max(i,a);n.setLineDash(o.map(h=>h/u)),n.lineDashOffset/=u}n.lineWidth=r||1,n.stroke(l),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Qr=new WeakSet,Eb=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Ab=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},kb=function(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r};let qu=sE;for(const s in Qf)qu.prototype[s]!==void 0&&(qu.prototype[Qf[s]]=qu.prototype[s]);var Rp,Lp;class Gr{static get workerPort(){return d(this,Rp)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");_(this,Rp,e)}static get workerSrc(){return d(this,Lp)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");_(this,Lp,e)}}Rp=new WeakMap,Lp=new WeakMap,A(Gr,Rp,null),A(Gr,Lp,"");var pd,Dp;class YB{constructor({parsedData:e,rawData:t}){A(this,pd);A(this,Dp);_(this,pd,e),_(this,Dp,t)}getRaw(){return d(this,Dp)}get(e){return d(this,pd).get(e)??null}[Symbol.iterator](){return d(this,pd).entries()}}pd=new WeakMap,Dp=new WeakMap;const xu=Symbol("INTERNAL");var Mp,Ip,Op,md;class JB{constructor(e,{name:t,intent:n,usage:r,rbGroups:i}){A(this,Mp,!1);A(this,Ip,!1);A(this,Op,!1);A(this,md,!0);_(this,Mp,!!(e&Wn.DISPLAY)),_(this,Ip,!!(e&Wn.PRINT)),this.name=t,this.intent=n,this.usage=r,this.rbGroups=i}get visible(){if(d(this,Op))return d(this,md);if(!d(this,md))return!1;const{print:e,view:t}=this.usage;return d(this,Mp)?(t==null?void 0:t.viewState)!=="OFF":d(this,Ip)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==xu&&ct("Internal method `_setVisible` called."),_(this,Op,n),_(this,md,t)}}Mp=new WeakMap,Ip=new WeakMap,Op=new WeakMap,md=new WeakMap;var go,ot,gd,yd,Fp,Tb;class QB{constructor(e,t=Wn.DISPLAY){A(this,Fp);A(this,go,null);A(this,ot,new Map);A(this,gd,null);A(this,yd,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,_(this,yd,e.order);for(const n of e.groups)d(this,ot).set(n.id,new JB(t,n));if(e.baseState==="OFF")for(const n of d(this,ot).values())n._setVisible(xu,!1);for(const n of e.on)d(this,ot).get(n)._setVisible(xu,!0);for(const n of e.off)d(this,ot).get(n)._setVisible(xu,!1);_(this,gd,this.getHash())}}isVisible(e){if(d(this,ot).size===0)return!0;if(!e)return yv("Optional content group not defined."),!0;if(e.type==="OCG")return d(this,ot).has(e.id)?d(this,ot).get(e.id).visible:(Le(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return k(this,Fp,Tb).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!d(this,ot).has(t))return Le(`Optional content group not found: ${t}`),!0;if(d(this,ot).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!d(this,ot).has(t))return Le(`Optional content group not found: ${t}`),!0;if(!d(this,ot).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!d(this,ot).has(t))return Le(`Optional content group not found: ${t}`),!0;if(!d(this,ot).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!d(this,ot).has(t))return Le(`Optional content group not found: ${t}`),!0;if(d(this,ot).get(t).visible)return!1}return!0}return Le(`Unknown optional content policy ${e.policy}.`),!0}return Le(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var i;const r=d(this,ot).get(e);if(!r){Le(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((i=d(this,ot).get(o))==null||i._setVisible(xu,!1,!0));r._setVisible(xu,!!t,!0),_(this,go,null)}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const i=d(this,ot).get(r);if(i)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!i.visible,t);break}}_(this,go,null)}get hasInitialVisibility(){return d(this,gd)===null||this.getHash()===d(this,gd)}getOrder(){return d(this,ot).size?d(this,yd)?d(this,yd).slice():[...d(this,ot).keys()]:null}getGroup(e){return d(this,ot).get(e)||null}getHash(){if(d(this,go)!==null)return d(this,go);const e=new sP;for(const[t,n]of d(this,ot))e.update(`${t}:${n.visible}`);return _(this,go,e.hexdigest())}[Symbol.iterator](){return d(this,ot).entries()}}go=new WeakMap,ot=new WeakMap,gd=new WeakMap,yd=new WeakMap,Fp=new WeakSet,Tb=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const i=e[r];let a;if(Array.isArray(i))a=k(this,Fp,Tb).call(this,i);else if(d(this,ot).has(i))a=d(this,ot).get(i).visible;else return Le(`Optional content group not found: ${i}`),!0;switch(n){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return n==="And"};class ZB{constructor(e,{disableRange:t=!1,disableStream:n=!1}){Yt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:i,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(i==null?void 0:i.length)>0){const l=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(i){return i._begin!==e?!1:(i._enqueue(n),!0)});Yt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,r,i;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(i=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||i.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Yt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new e6(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new t6(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class e6{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=xv(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class t6{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function s6(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let h=o(t);return h=unescape(h),h=l(h),h=u(h),i(h)}if(t=a(s),t){const h=u(t);return i(h)}if(t=n("filename","i").exec(s),t){t=t[1];let h=o(t);return h=u(h),i(h)}function n(h,f){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function r(h,f){if(h){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const p=new TextDecoder(h,{fatal:!0}),m=Ym(f);f=p.decode(m),e=!1}catch{}}return f}function i(h){return e&&/[\x80-\xff]/.test(h)&&(h=r("utf-8",h),e&&(h=r("iso-8859-1",h))),h}function a(h){const f=[];let p;const m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(h))!==null;){let[,y,b,v]=p;if(y=parseInt(y,10),y in f){if(y===0)break;continue}f[y]=[b,v]}const g=[];for(let y=0;y<f.length&&y in f;++y){let[b,v]=f[y];v=o(v),b&&(v=unescape(v),y===0&&(v=l(v))),g.push(v)}return g.join("")}function o(h){if(h.startsWith('"')){const f=h.slice(1).split('\\"');for(let p=0;p<f.length;++p){const m=f[p].indexOf('"');m!==-1&&(f[p]=f[p].slice(0,m),f.length=p+1),f[p]=f[p].replaceAll(/\\(.)/g,"$1")}h=f.join('"')}return h}function l(h){const f=h.indexOf("'");if(f===-1)return h;const p=h.slice(0,f),g=h.slice(f+1).replace(/^[^']*'/,"");return r(p,g)}function u(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,p,m,g){if(m==="q"||m==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,b){return String.fromCharCode(parseInt(b,16))}),r(p,g);try{g=atob(g)}catch{}return r(p,g)})}return""}function mP(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function bv(s){var e;return((e=URL.parse(s))==null?void 0:e.origin)??null}function gP({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(s.get("Content-Length"),10);return!Number.isInteger(i)||(r.suggestedLength=i,i<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function yP(s){const e=s.get("Content-Disposition");if(e){let t=s6(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(xv(t))return t}return null}function eg(s,e){return new Zf(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s,s===404||s===0&&e.startsWith("file:"))}function vP(s){return s===200||s===206}function xP(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function wP(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Le(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class n6{constructor(e){re(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=mP(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Yt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new r6(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new i6(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class r6{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,xP(n,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=bv(i.url),!vP(i.status))throw eg(i.status,r);this._reader=i.body.getReader(),this._headersCapability.resolve();const a=i.headers,{allowRangeRequests:o,suggestedLength:l}=gP({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=yP(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ia("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:wP(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class i6{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range",`bytes=${t}-${n-1}`);const a=r.url;fetch(a,xP(i,this._withCredentials,this._abortController)).then(o=>{const l=bv(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!vP(o.status))throw eg(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:wP(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Lx=200,Dx=206;function a6(s){const e=s.response;return typeof e!="string"?e:Ym(e).buffer}class o6{constructor({url:e,httpHeaders:t,withCredentials:n}){re(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=mP(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,a]of this.headers)t.setRequestHeader(i,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Dx):r.expectedStatus=Lx,t.responseType="arraybuffer",Yt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var r;const n=this.pendingRequests[e];n&&((r=n.onProgress)==null||r.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const i=r.status||Lx;if(!(i===Lx&&n.expectedStatus===Dx)&&i!==n.expectedStatus){n.onError(r.status);return}const o=a6(r);if(i===Dx){const l=r.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?n.onDone({begin:parseInt(u[1],10),chunk:o}):(Le('Missing or invalid "Content-Range" header.'),n.onError(0))}else o?n.onDone({begin:0,chunk:o}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class l6{constructor(e){this._source=e,this._manager=new o6(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Yt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new c6(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new u6(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class c6{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=bv(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...u]=o.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:a}=gP({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=yP(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=eg(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class u6{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=bv((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=eg(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const d6=/^[a-z][a-z0-9\-+.]+:/i;function h6(s){if(d6.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}class f6{constructor(e){this.source=e,this.url=h6(e.url),Yt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Yt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new p6(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new m6(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class p6{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=eg(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ia("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class m6{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Mh=Symbol("INITIAL_DATA");var Dn,$p,Cb;class bP{constructor(){A(this,$p);A(this,Dn,Object.create(null))}get(e,t=null){if(t){const r=k(this,$p,Cb).call(this,e);return r.promise.then(()=>t(r.data)),null}const n=d(this,Dn)[e];if(!n||n.data===Mh)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=d(this,Dn)[e];return!!t&&t.data!==Mh}delete(e){const t=d(this,Dn)[e];return!t||t.data===Mh?!1:(delete d(this,Dn)[e],!0)}resolve(e,t=null){const n=k(this,$p,Cb).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in d(this,Dn)){const{data:n}=d(this,Dn)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}_(this,Dn,Object.create(null))}*[Symbol.iterator](){for(const e in d(this,Dn)){const{data:t}=d(this,Dn)[e];t!==Mh&&(yield[e,t])}}}Dn=new WeakMap,$p=new WeakSet,Cb=function(e){var t;return(t=d(this,Dn))[e]||(t[e]={...Promise.withResolvers(),data:Mh})};const g6=1e5,wk=30;var Mk,yo,mn,Up,Bp,ec,ra,Hp,Vp,tc,vd,xd,vo,wd,zp,bd,sc,Wp,Gp,Mt,Sd,nc,qp,xo,_d,Fa,SP,_P,Nb,Jn,l0,jb,EP,AP;let tp=(Mt=class{constructor({textContentSource:e,container:t,viewport:n}){A(this,Fa);A(this,yo,Promise.withResolvers());A(this,mn,null);A(this,Up,!1);A(this,Bp,!!((Mk=globalThis.FontInspector)!=null&&Mk.enabled));A(this,ec,null);A(this,ra,null);A(this,Hp,0);A(this,Vp,0);A(this,tc,null);A(this,vd,null);A(this,xd,0);A(this,vo,0);A(this,wd,Object.create(null));A(this,zp,[]);A(this,bd,null);A(this,sc,[]);A(this,Wp,new WeakMap);A(this,Gp,null);var l;if(e instanceof ReadableStream)_(this,bd,e);else if(typeof e=="object")_(this,bd,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');_(this,mn,_(this,vd,t)),_(this,vo,n.scale*Jr.pixelRatio),_(this,xd,n.rotation),_(this,ra,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:i,pageX:a,pageY:o}=n.rawDims;_(this,Gp,[1,0,0,-1,-a,o+i]),_(this,Vp,r),_(this,Hp,i),k(l=Mt,Jn,EP).call(l),el(t,n),d(this,yo).promise.finally(()=>{d(Mt,_d).delete(this),_(this,ra,null),_(this,wd,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=gs.platform;return Ve(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{d(this,tc).read().then(({value:t,done:n})=>{if(n){d(this,yo).resolve();return}d(this,ec)??_(this,ec,t.lang),Object.assign(d(this,wd),t.styles),k(this,Fa,SP).call(this,t.items),e()},d(this,yo).reject)};return _(this,tc,d(this,bd).getReader()),d(Mt,_d).add(this),e(),d(this,yo).promise}update({viewport:e,onBefore:t=null}){var i;const n=e.scale*Jr.pixelRatio,r=e.rotation;if(r!==d(this,xd)&&(t==null||t(),_(this,xd,r),el(d(this,vd),{rotation:r})),n!==d(this,vo)){t==null||t(),_(this,vo,n);const a={div:null,properties:null,ctx:k(i=Mt,Jn,l0).call(i,d(this,ec))};for(const o of d(this,sc))a.properties=d(this,Wp).get(o),a.div=o,k(this,Fa,Nb).call(this,a)}}cancel(){var t;const e=new Ia("TextLayer task cancelled.");(t=d(this,tc))==null||t.cancel(e).catch(()=>{}),_(this,tc,null),d(this,yo).reject(e)}get textDivs(){return d(this,sc)}get textContentItemsStr(){return d(this,zp)}static cleanup(){if(!(d(this,_d).size>0)){d(this,Sd).clear();for(const{canvas:e}of d(this,nc).values())e.remove();d(this,nc).clear()}}},yo=new WeakMap,mn=new WeakMap,Up=new WeakMap,Bp=new WeakMap,ec=new WeakMap,ra=new WeakMap,Hp=new WeakMap,Vp=new WeakMap,tc=new WeakMap,vd=new WeakMap,xd=new WeakMap,vo=new WeakMap,wd=new WeakMap,zp=new WeakMap,bd=new WeakMap,sc=new WeakMap,Wp=new WeakMap,Gp=new WeakMap,Sd=new WeakMap,nc=new WeakMap,qp=new WeakMap,xo=new WeakMap,_d=new WeakMap,Fa=new WeakSet,SP=function(e){var r,i;if(d(this,Up))return;(i=d(this,ra)).ctx??(i.ctx=k(r=Mt,Jn,l0).call(r,d(this,ec)));const t=d(this,sc),n=d(this,zp);for(const a of e){if(t.length>g6){Le("Ignoring additional textDivs for performance reasons."),_(this,Up,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=d(this,mn);_(this,mn,document.createElement("span")),d(this,mn).classList.add("markedContent"),a.id!==null&&d(this,mn).setAttribute("id",`${a.id}`),o.append(d(this,mn))}else a.type==="endMarkedContent"&&_(this,mn,d(this,mn).parentNode);continue}n.push(a.str),k(this,Fa,_P).call(this,a)}},_P=function(e){var y;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};d(this,sc).push(t);const r=xe.transform(d(this,Gp),e.transform);let i=Math.atan2(r[1],r[0]);const a=d(this,wd)[e.fontName];a.vertical&&(i+=Math.PI/2);let o=d(this,Bp)&&a.fontSubstitution||a.fontFamily;o=Mt.fontFamilyMap.get(o)||o;const l=Math.hypot(r[2],r[3]),u=l*k(y=Mt,Jn,AP).call(y,o,a,d(this,ec));let h,f;i===0?(h=r[4],f=r[5]-u):(h=r[4]+u*Math.sin(i),f=r[5]-u*Math.cos(i));const p="calc(var(--total-scale-factor) *",m=t.style;d(this,mn)===d(this,vd)?(m.left=`${(100*h/d(this,Vp)).toFixed(2)}%`,m.top=`${(100*f/d(this,Hp)).toFixed(2)}%`):(m.left=`${p}${h.toFixed(2)}px)`,m.top=`${p}${f.toFixed(2)}px)`),m.fontSize=`${p}${(d(Mt,xo)*l).toFixed(2)}px)`,m.fontFamily=o,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,d(this,Bp)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),i!==0&&(n.angle=i*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);b!==v&&Math.max(b,v)/Math.min(b,v)>1.5&&(g=!0)}if(g&&(n.canvasWidth=a.vertical?e.height:e.width),d(this,Wp).set(t,n),d(this,ra).div=t,d(this,ra).properties=n,k(this,Fa,Nb).call(this,d(this,ra)),n.hasText&&d(this,mn).append(t),n.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),d(this,mn).append(b)}},Nb=function(e){var o;const{div:t,properties:n,ctx:r}=e,{style:i}=t;let a="";if(d(Mt,xo)>1&&(a=`scale(${1/d(Mt,xo)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:l}=i,{canvasWidth:u,fontSize:h}=n;k(o=Mt,Jn,jb).call(o,r,h*d(this,vo),l);const{width:f}=r.measureText(t.textContent);f>0&&(a=`scaleX(${u*d(this,vo)/f}) ${a}`)}n.angle!==0&&(a=`rotate(${n.angle}deg) ${a}`),a.length>0&&(i.transform=a)},Jn=new WeakSet,l0=function(e=null){let t=d(this,nc).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),d(this,nc).set(e,t),d(this,qp).set(t,{size:0,family:""})}return t},jb=function(e,t,n){const r=d(this,qp).get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)},EP=function(){if(d(this,xo)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),_(this,xo,e.getBoundingClientRect().height),e.remove()},AP=function(e,t,n){const r=d(this,Sd).get(e);if(r)return r;const i=k(this,Jn,l0).call(this,n);i.canvas.width=i.canvas.height=wk,k(this,Jn,jb).call(this,i,wk,e);const a=i.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let u=.8;return o?u=o/(o+l):(gs.platform.isFirefox&&Le("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?u=t.ascent:t.descent&&(u=1+t.descent)),d(this,Sd).set(e,u),u},A(Mt,Jn),A(Mt,Sd,new Map),A(Mt,nc,new Map),A(Mt,qp,new WeakMap),A(Mt,xo,null),A(Mt,_d,new Set),Mt);class sp{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(i){var l;if(!i)return;let a=null;const o=i.name;if(o==="#text")a=i.value;else if(sp.shouldBuildText(o))(l=i==null?void 0:i.attributes)!=null&&l.textContent?a=i.attributes.textContent:i.value&&(a=i.value);else return;if(a!==null&&t.push({str:a}),!!i.children)for(const u of i.children)r(u)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const y6=100;function q_(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new Pb,{docId:t}=e,n=s.url?TB(s.url):null,r=s.data?CB(s.data):null,i=s.httpHeaders||null,a=s.withCredentials===!0,o=s.password??null,l=s.range instanceof K_?s.range:null,u=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:2**16;let h=s.worker instanceof fh?s.worker:null;const f=s.verbosity,p=typeof s.docBaseUrl=="string"&&!Qm(s.docBaseUrl)?s.docBaseUrl:null,m=Rg(s.cMapUrl),g=s.cMapPacked!==!1,y=s.CMapReaderFactory||(Qs?MB:lk),b=Rg(s.iccUrl),v=Rg(s.standardFontDataUrl),x=s.StandardFontDataFactory||(Qs?IB:ck),w=Rg(s.wasmUrl),E=s.WasmFactory||(Qs?OB:uk),T=s.stopAtErrors!==!0,C=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,N=s.isEvalSupported!==!1,j=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!Qs,R=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!Qs&&(gs.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,z=typeof s.disableFontFace=="boolean"?s.disableFontFace:Qs,L=s.fontExtraProperties===!0,I=s.enableXfa===!0,O=s.ownerDocument||globalThis.document,Y=s.disableRange===!0,F=s.disableStream===!0,B=s.disableAutoFetch===!0,M=s.pdfBug===!0,$=s.CanvasFactory||(Qs?DB:PB),K=s.FilterFactory||(Qs?LB:RB),J=s.enableHWA===!0,Z=s.useWasm!==!1,pe=l?l.length:s.length??NaN,Se=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!Qs&&!z,Pe=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:!!(y===lk&&x===ck&&E===uk&&m&&v&&w&&Gh(m,document.baseURI)&&Gh(v,document.baseURI)&&Gh(w,document.baseURI)),H=null;cB(f);const X={canvasFactory:new $({ownerDocument:O,enableHWA:J}),filterFactory:new K({docId:t,ownerDocument:O}),cMapReaderFactory:Pe?null:new y({baseUrl:m,isCompressed:g}),standardFontDataFactory:Pe?null:new x({baseUrl:v}),wasmFactory:Pe?null:new E({baseUrl:w})};h||(h=fh.create({verbosity:f,port:Gr.workerPort}),e._worker=h);const we={docId:t,apiVersion:"5.3.93",data:r,password:o,disableAutoFetch:B,rangeChunkSize:u,length:pe,docBaseUrl:p,enableXfa:I,evaluatorOptions:{maxImageSize:C,disableFontFace:z,ignoreErrors:T,isEvalSupported:N,isOffscreenCanvasSupported:j,isImageDecoderSupported:R,canvasMaxAreaInBytes:D,fontExtraProperties:L,useSystemFonts:Se,useWasm:Z,useWorkerFetch:Pe,cMapUrl:m,iccUrl:b,standardFontDataUrl:v,wasmUrl:w}},Re={ownerDocument:O,pdfBug:M,styleElement:H,loadingParams:{disableAutoFetch:B,enableXfa:I}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Ee=h.messageHandler.sendWithPromise("GetDocRequest",we,r?[r.buffer]:null);let q;if(l)q=new ZB(l,{disableRange:Y,disableStream:F});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const oe=Gh(n)?n6:Qs?f6:l6;q=new oe({url:n,length:pe,httpHeaders:i,withCredentials:a,rangeChunkSize:u,disableRange:Y,disableStream:F})}return Ee.then(oe=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const fe=new Jh(t,oe,h.port),He=new w6(fe,e,q,Re,X);e._transport=He,fe.send("Ready",null)})}).catch(e._capability.reject),e}var Cy;const Ny=class Ny{constructor(){re(this,"_capability",Promise.withResolvers());re(this,"_transport",null);re(this,"_worker",null);re(this,"docId",`d${Ws(Ny,Cy)._++}`);re(this,"destroyed",!1);re(this,"onPassword",null);re(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,n,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,i}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Cy=new WeakMap,A(Ny,Cy,0);let Pb=Ny;var rc,Kp,Xp,Yp,Jp,Ik;let K_=(Ik=class{constructor(e,t,n=!1,r=null){A(this,rc,Promise.withResolvers());A(this,Kp,[]);A(this,Xp,[]);A(this,Yp,[]);A(this,Jp,[]);this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){d(this,Jp).push(e)}addProgressListener(e){d(this,Yp).push(e)}addProgressiveReadListener(e){d(this,Xp).push(e)}addProgressiveDoneListener(e){d(this,Kp).push(e)}onDataRange(e,t){for(const n of d(this,Jp))n(e,t)}onDataProgress(e,t){d(this,rc).promise.then(()=>{for(const n of d(this,Yp))n(e,t)})}onDataProgressiveRead(e){d(this,rc).promise.then(()=>{for(const t of d(this,Xp))t(e)})}onDataProgressiveDone(){d(this,rc).promise.then(()=>{for(const e of d(this,Kp))e()})}transportReady(){d(this,rc).resolve()}requestDataRange(e,t){ct("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},rc=new WeakMap,Kp=new WeakMap,Xp=new WeakMap,Yp=new WeakMap,Jp=new WeakMap,Ik);class v6{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ve(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var ia,ic,sf;class x6{constructor(e,t,n,r=!1){A(this,ic);A(this,ia,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new ik:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new bP,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new Jm({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ve(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:r=Ni.ENABLE,transform:i=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:h=null,isEditing:f=!1}){var E,T;(E=this._stats)==null||E.time("Overall");const p=this._transport.getRenderingIntent(n,r,h,f),{renderingIntent:m,cacheKey:g}=p;_(this,ia,!1),o||(o=this._transport.getOptionalContentConfig(m));let y=this._intentStates.get(g);y||(y=Object.create(null),this._intentStates.set(g,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const b=!!(m&Wn.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(T=this._stats)==null||T.time("Page Request"),this._pumpOperatorList(p));const v=C=>{var N;y.renderTasks.delete(x),b&&_(this,ia,!0),k(this,ic,sf).call(this),C?(x.capability.reject(C),this._abortOperatorList({intentState:y,reason:C instanceof Error?C:new Error(C)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(N=globalThis.Stats)!=null&&N.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new Rb({callback:v,params:{canvasContext:e,viewport:t,transform:i,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:u});(y.renderTasks||(y.renderTasks=new Set)).add(x);const w=x.task;return Promise.all([y.displayReadyCapability.promise,o]).then(([C,N])=>{var j;if(this.destroyed){v();return}if((j=this._stats)==null||j.time("Rendering"),!(N.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:C,optionalContentConfig:N}),x.operatorListChanged()}).catch(v),w}getOperatorList({intent:e="display",annotationMode:t=Ni.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){var u;function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,n,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>sp.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function i(){a.read().then(function({value:l,done:u}){if(u){n(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),i()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),_(this,ia,!1),Promise.all(e)}cleanup(e=!1){_(this,ia,!0);const t=k(this,ic,sf).call(this);return e&&t&&this._stats&&(this._stats=new ik),t}_startRenderPage(e,t){var r,i;const n=this._intentStates.get(t);n&&((r=this._stats)==null||r.timeEnd("Page Request"),(i=n.displayReadyCapability)==null||i.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&k(this,ic,sf).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:i,transfer:a}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},a).getReader(),u=this._intentStates.get(t);u.streamReader=l;const h=()=>{l.read().then(({value:f,done:p})=>{if(p){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,u),h())},f=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const p of u.renderTasks)p.operatorListChanged();k(this,ic,sf).call(this)}if(u.displayReadyCapability)u.displayReadyCapability.reject(f);else if(u.opListReadCapability)u.opListReadCapability.reject(f);else throw f}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof vv){let r=y6;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Ia(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,i]of this._intentStates)if(i===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}ia=new WeakMap,ic=new WeakSet,sf=function(){if(!d(this,ia)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),_(this,ia,!1),!0};var wo,Dr,aa,ac,jy,oc,lc,sn,c0,kP,TP,nf,Ed,u0;const St=class St{constructor({name:e=null,port:t=null,verbosity:n=uB()}={}){A(this,sn);A(this,wo,Promise.withResolvers());A(this,Dr,null);A(this,aa,null);A(this,ac,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(d(St,lc).has(t))throw new Error("Cannot use more than one PDFWorker per port.");d(St,lc).set(t,this),k(this,sn,kP).call(this,t)}else k(this,sn,TP).call(this)}get promise(){return d(this,wo).promise}get port(){return d(this,aa)}get messageHandler(){return d(this,Dr)}destroy(){var e,t;this.destroyed=!0,(e=d(this,ac))==null||e.terminate(),_(this,ac,null),d(St,lc).delete(d(this,aa)),_(this,aa,null),(t=d(this,Dr))==null||t.destroy(),_(this,Dr,null)}static create(e){const t=d(this,lc).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new St(e)}static get workerSrc(){if(Gr.workerSrc)return Gr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ve(this,"_setupFakeWorkerGlobal",(async()=>d(this,Ed,u0)?d(this,Ed,u0):(await import(this.workerSrc)).WorkerMessageHandler)())}};wo=new WeakMap,Dr=new WeakMap,aa=new WeakMap,ac=new WeakMap,jy=new WeakMap,oc=new WeakMap,lc=new WeakMap,sn=new WeakSet,c0=function(){d(this,wo).resolve(),d(this,Dr).send("configure",{verbosity:this.verbosity})},kP=function(e){_(this,aa,e),_(this,Dr,new Jh("main","worker",e)),d(this,Dr).on("ready",()=>{}),k(this,sn,c0).call(this)},TP=function(){if(d(St,oc)||d(St,Ed,u0)){k(this,sn,nf).call(this);return}let{workerSrc:e}=St;try{St._isSameOrigin(window.location,e)||(e=St._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new Jh("main","worker",t),r=()=>{i.abort(),n.destroy(),t.terminate(),this.destroyed?d(this,wo).reject(new Error("Worker was destroyed")):k(this,sn,nf).call(this)},i=new AbortController;t.addEventListener("error",()=>{d(this,ac)||r()},{signal:i.signal}),n.on("test",o=>{if(i.abort(),this.destroyed||!o){r();return}_(this,Dr,n),_(this,aa,t),_(this,ac,t),k(this,sn,c0).call(this)}),n.on("ready",o=>{if(i.abort(),this.destroyed){r();return}try{a()}catch{k(this,sn,nf).call(this)}});const a=()=>{const o=new Uint8Array;n.send("test",o,[o.buffer])};a();return}catch{yv("The worker has been disabled.")}k(this,sn,nf).call(this)},nf=function(){d(St,oc)||(Le("Setting up fake worker."),_(St,oc,!0)),St._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){d(this,wo).reject(new Error("Worker was destroyed"));return}const t=new jB;_(this,aa,t);const n=`fake${Ws(St,jy)._++}`,r=new Jh(n+"_worker",n,t);e.setup(r,t),_(this,Dr,new Jh(n,n+"_worker",t)),k(this,sn,c0).call(this)}).catch(e=>{d(this,wo).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Ed=new WeakSet,u0=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},A(St,Ed),A(St,jy,0),A(St,oc,!1),A(St,lc,new WeakMap),Qs&&(_(St,oc,!0),Gr.workerSrc||(Gr.workerSrc="./pdf.worker.mjs")),St._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},St._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},St.fromPort=e=>{if(xB("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return St.create(e)};let fh=St;var oa,wi,Ad,kd,la,cc,rf;class w6{constructor(e,t,n,r,i){A(this,cc);A(this,oa,new Map);A(this,wi,new Map);A(this,Ad,new Map);A(this,kd,new Map);A(this,la,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new bP,this.fontLoader=new AB({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.wasmFactory=i.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Ve(this,"annotationStorage",new z_)}getRenderingIntent(e,t=Ni.ENABLE,n=null,r=!1,i=!1){let a=Wn.DISPLAY,o=vb;switch(e){case"any":a=Wn.ANY;break;case"display":break;case"print":a=Wn.PRINT;break;default:Le(`getRenderingIntent - invalid intent: ${e}`)}const l=a&Wn.PRINT&&n instanceof rP?n:this.annotationStorage;switch(t){case Ni.DISABLE:a+=Wn.ANNOTATIONS_DISABLE;break;case Ni.ENABLE:break;case Ni.ENABLE_FORMS:a+=Wn.ANNOTATIONS_FORMS;break;case Ni.ENABLE_STORAGE:a+=Wn.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Le(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=Wn.IS_EDITING),i&&(a+=Wn.OPLIST);const{ids:u,hash:h}=l.modifiedIds,f=[a,o.hash,h];return{renderingIntent:a,cacheKey:f.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=d(this,la))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of d(this,wi).values())e.push(r._destroy());d(this,wi).clear(),d(this,Ad).clear(),d(this,kd).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,i;this.commonObjs.clear(),this.fontLoader.clear(),d(this,oa).clear(),this.filterFactory.destroy(),tp.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new Ia("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{Yt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},r.onPull=()=>{this._fullReader.read().then(function({value:i,done:a}){if(a){r.close();return}Yt(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{r.error(i)})},r.onCancel=i=>{this._fullReader.cancel(i),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async n=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:i,contentLength:a}=this._fullReader;return(!r||!i)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:r,isRangeSupported:i,contentLength:a}}),e.on("GetRangeReader",(n,r)=>{Yt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(n.begin,n.end);if(!i){r.close();return}r.onPull=()=>{i.read().then(function({value:a,done:o}){if(o){r.close();return}Yt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{i.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new v6(n,this))}),e.on("DocException",n=>{t._capability.reject(hn(n))}),e.on("PasswordRequest",n=>{_(this,la,Promise.withResolvers());try{if(!t.onPassword)throw hn(n);const r=i=>{i instanceof Error?d(this,la).reject(i):d(this,la).resolve({password:i})};t.onPassword(r,n.code)}catch(r){d(this,la).reject(r)}return d(this,la).promise}),e.on("DataLoaded",n=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;d(this,wi).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,i])=>{var a;if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in i){const h=i.error;Le(`Error during font loading: ${h}`),this.commonObjs.resolve(n,h);break}const o=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(h,f)=>globalThis.FontInspector.fontAdded(h,f):null,l=new kB(i,o);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(n,l)});break;case"CopyLocalImage":const{imageRef:u}=i;Yt(u,"The imageRef must be defined.");for(const h of d(this,wi).values())for(const[,f]of h.objs)if((f==null?void 0:f.ref)===u)return f.dataLen?(this.commonObjs.resolve(n,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,i);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,i,a])=>{var l;if(this.destroyed)return;const o=d(this,wi).get(r);if(!o.objs.has(n)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(i){case"Image":case"Pattern":o.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",n=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&Le("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=d(this,Ad).get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&d(this,kd).set(i.refStr,e);const a=new x6(t,i,this,this._params.pdfBug);return d(this,wi).set(t,a),a});return d(this,Ad).set(t,r),r}getPageIndex(e){return xb(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return k(this,cc,rf).call(this,"GetFieldObjects")}hasJSActions(){return k(this,cc,rf).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return k(this,cc,rf).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return k(this,cc,rf).call(this,"GetOptionalContentConfig").then(t=>new QB(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=d(this,oa).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>{var i,a;return{info:r[0],metadata:r[1]?new YB(r[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return d(this,oa).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of d(this,wi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),d(this,oa).clear(),this.filterFactory.destroy(!0),tp.cleanup()}}cachedPageNumber(e){if(!xb(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return d(this,kd).get(t)??null}}oa=new WeakMap,wi=new WeakMap,Ad=new WeakMap,kd=new WeakMap,la=new WeakMap,cc=new WeakSet,rf=function(e,t=null){const n=d(this,oa).get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return d(this,oa).set(e,r),r};var bo;class b6{constructor(e){A(this,bo,null);re(this,"onContinue",null);re(this,"onError",null);_(this,bo,e)}get promise(){return d(this,bo).capability.promise}cancel(e=0){d(this,bo).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=d(this,bo).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=d(this,bo);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}bo=new WeakMap;var So,uc;const kl=class kl{constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:h=!1,pdfBug:f=!1,pageColors:p=null}){A(this,So,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=f,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new b6(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(d(kl,uc).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d(kl,uc).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:r,transform:i,background:a}=this.params;this.gfx=new qu(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n,r,i;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),d(this,So)&&(window.cancelAnimationFrame(d(this,So)),_(this,So,null)),d(kl,uc).delete(this._canvas),e||(e=new vv(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(i=(r=this.task).onError)==null||i.call(r,e)}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?_(this,So,window.requestAnimationFrame(()=>{_(this,So,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),d(kl,uc).delete(this._canvas),this.callback())))}};So=new WeakMap,uc=new WeakMap,A(kl,uc,new WeakSet);let Rb=kl;const CP="5.3.93",NP="cbeef3233";function bk(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function Ih(s){return Math.max(0,Math.min(255,255*s))}class Sk{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Ih(e),[e,e,e]}static G_HTML([e]){const t=bk(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Ih)}static RGB_HTML(e){return`#${e.map(bk).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[Ih(1-Math.min(1,e+r)),Ih(1-Math.min(1,n+r)),Ih(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,i=1-t,a=1-n,o=Math.min(r,i,a);return["CMYK",r,i,a,o]}}class S6{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ct("Abstract method `_createSVG` called.")}}class np extends S6{_createSVG(e){return document.createElementNS(Fi,e)}}class X_{static setupStorage(e,t,n,r,i){const a=r.getValue(t,{value:null});switch(n.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(a.value===n.attributes.xfaOn?e.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of n.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;r.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:i}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[l,u]of Object.entries(a))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}o&&i.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){var f,p;const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,i=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:i,linkService:n});const o=i!=="richText",l=e.div;if(l.append(a),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}o&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(r.children.length===0){if(r.value){const m=document.createTextNode(r.value);a.append(m),o&&sp.shouldBuildText(r.name)&&u.push(m)}return{textDivs:u}}const h=[[r,-1,a]];for(;h.length>0;){const[m,g,y]=h.at(-1);if(g+1===m.children.length){h.pop();continue}const b=m.children[++h.at(-1)[1]];if(b===null)continue;const{name:v}=b;if(v==="#text"){const w=document.createTextNode(b.value);u.push(w),y.append(w);continue}const x=(f=b==null?void 0:b.attributes)!=null&&f.xmlns?document.createElementNS(b.attributes.xmlns,v):document.createElement(v);if(y.append(x),b.attributes&&this.setAttributes({html:x,element:b,storage:t,intent:i,linkService:n}),((p=b.children)==null?void 0:p.length)>0)h.push([b,-1,x]);else if(b.value){const w=document.createTextNode(b.value);o&&sp.shouldBuildText(v)&&u.push(w),x.append(w)}}for(const m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const _6=9,Xc=new WeakSet;class _k{static create(e){switch(e.data.annotationType){case $t.LINK:return new jP(e);case $t.TEXT:return new E6(e);case $t.WIDGET:switch(e.data.fieldType){case"Tx":return new A6(e);case"Btn":return e.data.radioButton?new LP(e):e.data.checkBox?new T6(e):new C6(e);case"Ch":return new N6(e);case"Sig":return new k6(e)}return new iu(e);case $t.POPUP:return new Db(e);case $t.FREETEXT:return new FP(e);case $t.LINE:return new P6(e);case $t.SQUARE:return new R6(e);case $t.CIRCLE:return new L6(e);case $t.POLYLINE:return new $P(e);case $t.CARET:return new M6(e);case $t.INK:return new Y_(e);case $t.POLYGON:return new D6(e);case $t.HIGHLIGHT:return new UP(e);case $t.UNDERLINE:return new I6(e);case $t.SQUIGGLY:return new O6(e);case $t.STRIKEOUT:return new F6(e);case $t.STAMP:return new BP(e);case $t.FILEATTACHMENT:return new $6(e);default:return new Wt(e)}}}var dc,Td,Cd,Qp,Lb;const nE=class nE{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){A(this,Qp);A(this,dc,null);A(this,Td,!1);A(this,Cd,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return nE._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;d(this,dc)||_(this,dc,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&k(this,Qp,Lb).call(this,t),(n=d(this,Cd))==null||n.popup.updateEdited(e)}resetEdited(){var e;d(this,dc)&&(k(this,Qp,Lb).call(this,d(this,dc).rect),(e=d(this,Cd))==null||e.popup.resetEdited(),_(this,dc,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof iu||(i.tabIndex=0);const{style:a}=i;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof Db){const{rotation:y}=t;return!t.hasOwnCanvas&&y!==0&&this.setRotation(y,i),i}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const y=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(y>0||b>0){const x=`calc(${y}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;a.borderRadius=x}else if(this instanceof LP){const x=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=x}switch(t.borderStyle.style){case mu.SOLID:a.borderStyle="solid";break;case mu.DASHED:a.borderStyle="dashed";break;case mu.BEVELED:Le("Unimplemented border style: beveled");break;case mu.INSET:Le("Unimplemented border style: inset");break;case mu.UNDERLINE:a.borderBottomStyle="solid";break}const v=t.borderColor||null;v?(_(this,Td,!0),a.borderColor=xe.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):a.borderWidth=0}const u=xe.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:f,pageX:p,pageY:m}=r.rawDims;a.left=`${100*(u[0]-p)/h}%`,a.top=`${100*(u[1]-m)/f}%`;const{rotation:g}=t;return t.hasOwnCanvas||g===0?(a.width=`${100*o/h}%`,a.height=`${100*l/f}%`):this.setRotation(g,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:i,height:a}=this;e%180!==0&&([i,a]=[a,i]),t.style.width=`${100*i/n}%`,t.style.height=`${100*a/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const i=r.detail[t],a=i[0],o=i.slice(1);r.target.style[n]=Sk[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[n]:Sk[`${a}_rgb`](o)})};return Ve(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail)){const i=e[r]||n[r];i==null||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,i]of Object.entries(t)){const a=n[r];if(a){const o={detail:{[r]:i},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,i]=this.data.rect.map(y=>Math.fround(y));if(e.length===8){const[y,b,v,x]=e.subarray(2,6);if(r===y&&i===b&&t===v&&n===x)return}const{style:a}=this.container;let o;if(d(this,Td)){const{borderColor:y,borderWidth:b}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const l=r-t,u=i-n,{svgFactory:h}=this,f=h.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0),f.role="none";const p=h.createElement("defs");f.append(p);const m=h.createElement("clipPath"),g=`clippath_${this.data.id}`;m.setAttribute("id",g),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let y=2,b=e.length;y<b;y+=8){const v=e[y],x=e[y+1],w=e[y+2],E=e[y+3],T=h.createElement("rect"),C=(w-t)/l,N=(i-x)/u,j=(v-w)/l,R=(x-E)/u;T.setAttribute("x",C),T.setAttribute("y",N),T.setAttribute("width",j),T.setAttribute("height",R),m.append(T),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${N}" width="${j}" height="${R}"/>`)}d(this,Td)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(f),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:e}=this,t=_(this,Cd,new Db({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){ct("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:i,id:a,exportValues:o}of r){if(i===-1||a===t)continue;const l=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!Xc.has(u)){Le(`_getElementsByName - element not allowed: ${a}`);continue}n.push({id:a,exportValue:l,domElement:u})}return n}for(const r of document.getElementsByName(e)){const{exportValue:i}=r,a=r.getAttribute("data-element-id");a!==t&&Xc.has(r)&&n.push({id:a,exportValue:i,domElement:r})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};dc=new WeakMap,Td=new WeakMap,Cd=new WeakMap,Qp=new WeakSet,Lb=function(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}}}=this;n==null||n.splice(0,4,...e),t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+l)/a}%`,r===0?(t.width=`${100*(e[2]-e[0])/i}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(r)};let Wt=nE;var Kn,bl,PP,RP;class jP extends Wt{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});A(this,Kn);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let i=!1;return t.url?(n.addLinkAttributes(r,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(r,t.action),i=!0):t.attachment?(k(this,Kn,PP).call(this,r,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(k(this,Kn,RP).call(this,r,t.setOCGState),i=!0):t.dest?(this._bindLink(r,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),i=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&k(this,Kn,bl).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),k(this,Kn,bl).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(n.actions)){const a=r.get(i);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),k(this,Kn,bl).call(this)}_bindResetFormAction(t,n){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),k(this,Kn,bl).call(this),!this._fieldObjects){Le('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var f;r==null||r();const{fields:i,refs:a,include:o}=n,l=[];if(i.length!==0||a.length!==0){const p=new Set(a);for(const m of i){const g=this._fieldObjects[m]||[];for(const{id:y}of g)p.add(y)}for(const m of Object.values(this._fieldObjects))for(const g of m)p.has(g.id)===o&&l.push(g)}else for(const p of Object.values(this._fieldObjects))l.push(...p);const u=this.annotationStorage,h=[];for(const p of l){const{id:m}=p;switch(h.push(m),p.type){case"text":{const y=p.defaultValue||"";u.setValue(m,{value:y});break}case"checkbox":case"radiobutton":{const y=p.defaultValue===p.exportValues;u.setValue(m,{value:y});break}case"combobox":case"listbox":{const y=p.defaultValue||"";u.setValue(m,{value:y});break}default:continue}const g=document.querySelector(`[data-element-id="${m}"]`);if(g){if(!Xc.has(g)){Le(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}Kn=new WeakSet,bl=function(){this.container.setAttribute("data-internal-link","")},PP=function(t,n,r=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(n.content,n.filename,r),!1},k(this,Kn,bl).call(this)},RP=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),k(this,Kn,bl).call(this)};class E6 extends Wt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class iu extends Wt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return gs.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,i){n.includes("mouse")?e.addEventListener(n,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(n,a=>{var o;if(n==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}i&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a)}}))})}_setEventListeners(e,t,n,r){var i,a,o;for(const[l,u]of n)(u==="Action"||(i=this.data.actions)!=null&&i[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,u,r),u==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":xe.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||_6,i=e.style;let a;const o=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),h=Math.round(u/(Tx*r))||1,f=u/h;a=Math.min(r,l(f/Tx))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,l(u/Tx))}i.fontSize=`calc(${a}px * var(--total-scale-factor))`,i.color=xe.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class A6 extends iu{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const i=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),i.setValue(a.id,{[r]:n})}render(){var r,i;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let u=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=u??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",u??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Xc.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const f=this.data.dateFormat||this.data.timeFormat;f&&(n.title=f),this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",m=>{e.setValue(t,{value:m.target.value}),this.setPropertyOnSiblings(n,"value",m.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",m=>{const g=this.data.defaultFieldValue??"";n.value=h.userValue=g,h.formattedValue=null});let p=m=>{const{formattedValue:g}=h;g!=null&&(m.target.value=g),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",g=>{var b;if(h.focused)return;const{target:y}=g;h.userValue&&(y.value=h.userValue),h.lastCommittedValue=y.value,h.commitKey=1,(b=this.data.actions)!=null&&b.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const y={value(b){h.userValue=b.detail.value??"",e.setValue(t,{value:h.userValue.toString()}),b.target.value=h.userValue},formattedValue(b){const{formattedValue:v}=b.detail;h.formattedValue=v,v!=null&&b.target!==document.activeElement&&(b.target.value=v),e.setValue(t,{formattedValue:v})},selRange(b){b.target.setSelectionRange(...b.detail.selRange)},charLimit:b=>{var E;const{charLimit:v}=b.detail,{target:x}=b;if(v===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",v);let w=h.userValue;!w||w.length<=v||(w=w.slice(0,v),x.value=h.userValue=w,e.setValue(t,{value:w}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(y,g)}),n.addEventListener("keydown",g=>{var v;h.commitKey=1;let y=-1;if(g.key==="Escape"?y=0:g.key==="Enter"&&!this.data.multiLine?y=2:g.key==="Tab"&&(h.commitKey=3),y===-1)return;const{value:b}=g.target;h.lastCommittedValue!==b&&(h.lastCommittedValue=b,h.userValue=b,(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:y,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const m=p;p=null,n.addEventListener("blur",g=>{var b,v;if(!h.focused||!g.relatedTarget)return;(b=this.data.actions)!=null&&b.Blur||(h.focused=!1);const{value:y}=g.target;h.userValue=y,h.lastCommittedValue!==y&&((v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:h.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}})),m(g)}),(i=this.data.actions)!=null&&i.Keystroke&&n.addEventListener("beforeinput",g=>{var C;h.lastCommittedValue=null;const{data:y,target:b}=g,{value:v,selectionStart:x,selectionEnd:w}=b;let E=x,T=w;switch(g.inputType){case"deleteWordBackward":{const N=v.substring(0,x).match(/\w*[^\w]*$/);N&&(E-=N[0].length);break}case"deleteWordForward":{const N=v.substring(x).match(/^[^\w]*\w*/);N&&(T+=N[0].length);break}case"deleteContentBackward":x===w&&(E-=1);break;case"deleteContentForward":x===w&&(T+=1);break}g.preventDefault(),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,change:y||"",willCommit:!1,selStart:E,selEnd:T}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(p&&n.addEventListener("blur",p),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class k6 extends iu{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class T6 extends iu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return Xc.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=0,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,n)){const h=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=h),e.setValue(u.id,{value:h})}e.setValue(n,{value:l})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class LP extends iu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,n))e.setValue(a.id,{value:!1});const i=document.createElement("input");if(Xc.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=0,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,n))e.setValue(u.id,{value:!1});e.setValue(n,{value:l})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;i.addEventListener("updatefromsandbox",o=>{const l={value:u=>{const h=a===u.detail.value;for(const f of this._getElementsByName(u.target.name)){const p=h&&f.id===n;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class C6 extends jP{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class N6 extends iu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");Xc.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",h=>{const f=this.data.defaultFieldValue;for(const p of r.options)p.selected=p.value===f});for(const h of this.data.options){const f=document.createElement("option");f.textContent=h.displayValue,f.value=h.exportValue,n.value.includes(h.exportValue)&&(f.setAttribute("selected",!0),i=!1),r.append(f)}let a=null;if(i){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),r.prepend(h),a=()=>{h.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=h=>{const f=h?"value":"textContent",{options:p,multiple:m}=r;return m?Array.prototype.filter.call(p,g=>g.selected).map(g=>g[f]):p.selectedIndex===-1?null:p[p.selectedIndex][f]};let l=o(!1);const u=h=>{const f=h.target.options;return Array.prototype.map.call(f,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",h=>{const f={value(p){a==null||a();const m=p.detail.value,g=new Set(Array.isArray(m)?m:[m]);for(const y of r.options)y.selected=g.has(y.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(p){r.multiple=!0},remove(p){const m=r.options,g=p.detail.remove;m[g].selected=!1,r.remove(g),m.length>0&&Array.prototype.findIndex.call(m,b=>b.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:o(!0),items:u(p)}),l=o(!1)},clear(p){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(p){const{index:m,displayValue:g,exportValue:y}=p.detail.insert,b=r.children[m],v=document.createElement("option");v.textContent=g,v.value=y,b?b.before(v):r.append(v),e.setValue(t,{value:o(!0),items:u(p)}),l=o(!1)},items(p){const{items:m}=p.detail;for(;r.length!==0;)r.remove(0);for(const g of m){const{displayValue:y,exportValue:b}=g,v=document.createElement("option");v.textContent=y,v.value=b,r.append(v)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:u(p)}),l=o(!1)},indices(p){const m=new Set(p.detail.indices);for(const g of p.target.options)g.selected=m.has(g.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(f,h)}),r.addEventListener("input",h=>{var m;const f=o(!0),p=o(!1);e.setValue(t,{value:f}),h.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):r.addEventListener("input",function(h){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Db extends Wt{constructor(e){const{data:t,elements:n}=e;super(e,{isRenderable:Wt._hasPopupData(t)}),this.elements=n,this.popup=null}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=new j6({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[];for(const r of this.elements)r.popup=t,r.container.ariaHasPopup="dialog",n.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(r=>`${H_}${r}`).join(",")),this.container}}var Nd,Py,Ry,jd,Pd,Dt,ca,hc,Zp,em,Rd,ua,Mr,da,tm,ha,sm,fc,pc,ut,d0,Mb,DP,MP,IP,OP,h0,f0,Ib;class j6{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:l,rect:u,parentRect:h,open:f}){A(this,ut);A(this,Nd,k(this,ut,IP).bind(this));A(this,Py,k(this,ut,Ib).bind(this));A(this,Ry,k(this,ut,f0).bind(this));A(this,jd,k(this,ut,h0).bind(this));A(this,Pd,null);A(this,Dt,null);A(this,ca,null);A(this,hc,null);A(this,Zp,null);A(this,em,null);A(this,Rd,null);A(this,ua,!1);A(this,Mr,null);A(this,da,null);A(this,tm,null);A(this,ha,null);A(this,sm,null);A(this,fc,null);A(this,pc,!1);var p;_(this,Dt,e),_(this,sm,r),_(this,ca,a),_(this,ha,o),_(this,em,l),_(this,Pd,t),_(this,tm,u),_(this,Rd,h),_(this,Zp,n),_(this,hc,wv.toDateObject(i)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(const m of this.trigger)m.addEventListener("click",d(this,jd)),m.addEventListener("mouseenter",d(this,Ry)),m.addEventListener("mouseleave",d(this,Py)),m.classList.add("popupTriggerArea");for(const m of n)(p=m.container)==null||p.addEventListener("keydown",d(this,Nd));d(this,Dt).hidden=!0,f&&k(this,ut,h0).call(this)}render(){if(d(this,Mr))return;const e=_(this,Mr,document.createElement("div"));if(e.className="popup",d(this,Pd)){const i=e.style.outlineColor=xe.makeHexColor(...d(this,Pd));e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const t=document.createElement("span");t.className="header";const n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=d(this,sm),e.append(t),d(this,hc)){const i=document.createElement("time");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:d(this,hc).valueOf()})),i.dateTime=d(this,hc).toISOString(),t.append(i)}const r=d(this,ut,d0);if(r)X_.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(d(this,ca));e.append(i)}d(this,Dt).append(e)}_formatContents({str:e,dir:t}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let i=0,a=r.length;i<a;++i){const o=r[i];n.append(document.createTextNode(o)),i<a-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;d(this,fc)||_(this,fc,{contentsObj:d(this,ca),richText:d(this,ha)}),e&&_(this,da,null),t&&(_(this,ha,k(this,ut,MP).call(this,t)),_(this,ca,null)),(n=d(this,Mr))==null||n.remove(),_(this,Mr,null)}resetEdited(){var e;d(this,fc)&&({contentsObj:Ws(this,ca)._,richText:Ws(this,ha)._}=d(this,fc),_(this,fc,null),(e=d(this,Mr))==null||e.remove(),_(this,Mr,null),_(this,da,null))}forceHide(){_(this,pc,this.isVisible),d(this,pc)&&(d(this,Dt).hidden=!0)}maybeShow(){d(this,pc)&&(d(this,Mr)||k(this,ut,f0).call(this),_(this,pc,!1),d(this,Dt).hidden=!1)}get isVisible(){return d(this,Dt).hidden===!1}}Nd=new WeakMap,Py=new WeakMap,Ry=new WeakMap,jd=new WeakMap,Pd=new WeakMap,Dt=new WeakMap,ca=new WeakMap,hc=new WeakMap,Zp=new WeakMap,em=new WeakMap,Rd=new WeakMap,ua=new WeakMap,Mr=new WeakMap,da=new WeakMap,tm=new WeakMap,ha=new WeakMap,sm=new WeakMap,fc=new WeakMap,pc=new WeakMap,ut=new WeakSet,d0=function(){const e=d(this,ha),t=d(this,ca);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&d(this,ha).html||null},Mb=function(){var e,t,n;return((n=(t=(e=d(this,ut,d0))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},DP=function(){var e,t,n;return((n=(t=(e=d(this,ut,d0))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},MP=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:d(this,ut,DP),fontSize:d(this,ut,Mb)?`calc(${d(this,ut,Mb)}px * var(--total-scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:r});return n},IP=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&d(this,ua))&&k(this,ut,h0).call(this)},OP=function(){if(d(this,da)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=d(this,em);let a=!!d(this,Rd),o=a?d(this,Rd):d(this,tm);for(const g of d(this,Zp))if(!o||xe.intersect(g.data.rect,o)!==null){o=g.data.rect,a=!0;break}const l=xe.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),h=a?o[2]-o[0]+5:0,f=l[0]+h,p=l[1];_(this,da,[100*(f-r)/t,100*(p-i)/n]);const{style:m}=d(this,Dt);m.left=`${d(this,da)[0]}%`,m.top=`${d(this,da)[1]}%`},h0=function(){_(this,ua,!d(this,ua)),d(this,ua)?(k(this,ut,f0).call(this),d(this,Dt).addEventListener("click",d(this,jd)),d(this,Dt).addEventListener("keydown",d(this,Nd))):(k(this,ut,Ib).call(this),d(this,Dt).removeEventListener("click",d(this,jd)),d(this,Dt).removeEventListener("keydown",d(this,Nd)))},f0=function(){d(this,Mr)||this.render(),this.isVisible?d(this,ua)&&d(this,Dt).classList.add("focused"):(k(this,ut,OP).call(this),d(this,Dt).hidden=!1,d(this,Dt).style.zIndex=parseInt(d(this,Dt).style.zIndex)+1e3)},Ib=function(){d(this,Dt).classList.remove("focused"),!(d(this,ua)||!this.isVisible)&&(d(this,Dt).hidden=!0,d(this,Dt).style.zIndex=parseInt(d(this,Dt).style.zIndex)-1e3)};class FP extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=je.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var nm;class P6 extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,nm,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:n,height:r}=this,i=this.svgFactory.create(n,r,!0),a=_(this,nm,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,nm)}addHighlightArea(){this.container.classList.add("highlightArea")}}nm=new WeakMap;var rm;class R6 extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,rm,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:n,height:r}=this,i=this.svgFactory.create(n,r,!0),a=t.borderStyle.width,o=_(this,rm,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",n-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,rm)}addHighlightArea(){this.container.classList.add("highlightArea")}}rm=new WeakMap;var im;class L6 extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,im,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:n,height:r}=this,i=this.svgFactory.create(n,r,!0),a=t.borderStyle.width,o=_(this,im,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",n/2),o.setAttribute("cy",r/2),o.setAttribute("rx",n/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,im)}addHighlightArea(){this.container.classList.add("highlightArea")}}im=new WeakMap;var am;class $P extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,am,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:r,popupRef:i},width:a,height:o}=this;if(!n)return this.container;const l=this.svgFactory.create(a,o,!0);let u=[];for(let f=0,p=n.length;f<p;f+=2){const m=n[f]-t[0],g=t[3]-n[f+1];u.push(`${m},${g}`)}u=u.join(" ");const h=_(this,am,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",u),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),l.append(h),this.container.append(l),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,am)}addHighlightArea(){this.container.classList.add("highlightArea")}}am=new WeakMap;class D6 extends $P{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class M6 extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var om,mc,lm,Ob;class Y_ extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,lm);A(this,om,null);A(this,mc,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?je.HIGHLIGHT:je.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:r,borderStyle:i,popupRef:a}}=this,{transform:o,width:l,height:u}=k(this,lm,Ob).call(this,n,t),h=this.svgFactory.create(l,u,!0),f=_(this,om,this.svgFactory.createElement("svg:g"));h.append(f),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",o);for(let p=0,m=r.length;p<m;p++){const g=this.svgFactory.createElement(this.svgElementName);d(this,mc).push(g),g.setAttribute("points",r[p].join(",")),f.append(g)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:r,rect:i}=t,a=d(this,om);if(n>=0&&a.setAttribute("stroke-width",n||1),r)for(let o=0,l=d(this,mc).length;o<l;o++)d(this,mc)[o].setAttribute("points",r[o].join(","));if(i){const{transform:o,width:l,height:u}=k(this,lm,Ob).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return d(this,mc)}addHighlightArea(){this.container.classList.add("highlightArea")}}om=new WeakMap,mc=new WeakMap,lm=new WeakSet,Ob=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class UP extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=je.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class I6 extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class O6 extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class F6 extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class BP extends Wt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=je.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var cm,um,Fb;class $6 extends Wt{constructor(t){var r;super(t,{isRenderable:!0});A(this,um);A(this,cm,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let r;n.hasAppearance||n.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),r.addEventListener("dblclick",k(this,um,Fb).bind(this)),_(this,cm,r);const{isMac:i}=gs.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&k(this,um,Fb).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return d(this,cm)}addHighlightArea(){this.container.classList.add("highlightArea")}}cm=new WeakMap,um=new WeakSet,Fb=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var dm,gc,_o,hm,rl,$b,Ub,Ld;let J_=(Ld=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:i,viewport:a,structTreeLayer:o}){A(this,rl);A(this,dm,null);A(this,gc,null);A(this,_o,new Map);A(this,hm,null);this.div=e,_(this,dm,t),_(this,gc,n),_(this,hm,o||null),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return d(this,_o).size>0}async render(e){var a;const{annotations:t}=e,n=this.div;el(n,this.viewport);const r=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new np,annotationStorage:e.annotationStorage||new z_,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===$t.POPUP;if(l){const f=r.get(o.id);if(!f)continue;i.elements=f}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;i.data=o;const u=_k.create(i);if(!u.isRenderable)continue;if(!l&&o.popupRef){const f=r.get(o.popupRef);f?f.push(u):r.set(o.popupRef,[u])}const h=u.render();o.hidden&&(h.style.visibility="hidden"),await k(this,rl,$b).call(this,h,o.id,i.elements),u._isEditable&&(d(this,_o).set(u.data.id,u),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(u))}k(this,rl,Ub).call(this)}async addLinkAnnotations(e,t){const n={data:null,layer:this.div,linkService:t,svgFactory:new np,parent:this};for(const r of e){r.borderStyle||(r.borderStyle=Ld._defaultBorderStyle),n.data=r;const i=_k.create(n);if(!i.isRenderable)continue;const a=i.render();await k(this,rl,$b).call(this,a,r.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,el(t,{rotation:e.rotation}),k(this,rl,Ub).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(d(this,_o).values())}getEditableAnnotation(e){return d(this,_o).get(e)}static get _defaultBorderStyle(){return Ve(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:mu.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},dm=new WeakMap,gc=new WeakMap,_o=new WeakMap,hm=new WeakMap,rl=new WeakSet,$b=async function(e,t,n){var o,l;const r=e.firstChild||e,i=r.id=`${H_}${t}`,a=await((o=d(this,hm))==null?void 0:o.getAriaAttributes(i));if(a)for(const[u,h]of a)r.setAttribute(u,h);n?n.at(-1).container.after(e):(this.div.append(e),(l=d(this,dm))==null||l.moveElementInDOM(this.div,e,r,!1))},Ub=function(){var t;if(!d(this,gc))return;const e=this.div;for(const[n,r]of d(this,gc)){const i=e.querySelector(`[data-annotation-id="${n}"]`);if(!i)continue;r.className="annotationContent";const{firstChild:a}=i;a?a.nodeName==="CANVAS"?a.replaceWith(r):a.classList.contains("annotationContent")?a.after(r):a.before(r):i.append(r);const o=d(this,_o).get(n);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(n,i.id,r),o._hasNoCanvas=!1):o.canvas=r)}d(this,gc).clear()},Ld);const Ig=/\r\n?|\n/g;var Ir,Mn,fm,yc,In,Qt,HP,VP,zP,p0,ja,m0,g0,WP,Hb,GP;const mt=class mt extends yt{constructor(t){super({...t,name:"freeTextEditor"});A(this,Qt);A(this,Ir);A(this,Mn,"");A(this,fm,`${this.id}-editor`);A(this,yc,null);A(this,In);_(this,Ir,t.color||mt._defaultColor||yt._defaultLineColor),_(this,In,t.fontSize||mt._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const t=mt.prototype,n=a=>a.isEmpty(),r=tl.TRANSLATE_SMALL,i=tl.TRANSLATE_BIG;return Ve(this,"_keyboardManager",new Zm([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}]]))}static initialize(t,n){yt.initialize(t,n);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case We.FREETEXT_SIZE:mt._defaultFontSize=n;break;case We.FREETEXT_COLOR:mt._defaultColor=n;break}}updateParams(t,n){switch(t){case We.FREETEXT_SIZE:k(this,Qt,HP).call(this,n);break;case We.FREETEXT_COLOR:k(this,Qt,VP).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[We.FREETEXT_SIZE,mt._defaultFontSize],[We.FREETEXT_COLOR,mt._defaultColor||yt._defaultLineColor]]}get propertiesToUpdate(){return[[We.FREETEXT_SIZE,d(this,In)],[We.FREETEXT_COLOR,d(this,Ir)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-mt._internalPadding*t,-(mt._internalPadding+d(this,In))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),_(this,yc,new AbortController);const t=this._uiManager.combinedSignal(d(this,yc));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",d(this,fm)),this._isDraggable=!0,(t=d(this,yc))==null||t.abort(),_(this,yc,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=d(this,Mn),n=_(this,Mn,k(this,Qt,zP).call(this).trimEnd());if(t===n)return;const r=i=>{if(_(this,Mn,i),!i){this.remove();return}k(this,Qt,g0).call(this),this._uiManager.rebuild(this),k(this,Qt,p0).call(this)};this.addCommands({cmd:()=>{r(n)},undo:()=>{r(t)},mustExec:!1}),k(this,Qt,p0).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){mt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,n;(this._isCopy||this.annotationElementId)&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",d(this,fm)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${d(this,In)}px * var(--total-scale-factor))`,r.color=d(this,Ir),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[h,f]=this.pageDimensions,[p,m]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=t+(o[0]-p)/h,y=n+this.height-(o[1]-m)/f;break;case 90:g=t+(o[0]-p)/h,y=n-(o[1]-m)/f,[l,u]=[u,-l];break;case 180:g=t-this.width+(o[0]-p)/h,y=n-(o[1]-m)/f,[l,u]=[-l,-u];break;case 270:g=t+(o[0]-p-this.height*f)/h,y=n+(o[1]-m-this.width*h)/f,[l,u]=[-u,l];break}this.setAt(g*i,y*a,l,u)}else this._moveAfterPaste(t,n);k(this,Qt,g0).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var g,y,b;const n=t.clipboardData||window.clipboardData,{types:r}=n;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const i=k(g=mt,ja,Hb).call(g,n.getData("text")||"").replaceAll(Ig,`
`);if(!i)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:u}=o,h=[],f=[];if(l.nodeType===Node.TEXT_NODE){const v=l.parentElement;if(f.push(l.nodeValue.slice(u).replaceAll(Ig,"")),v!==this.editorDiv){let x=h;for(const w of this.editorDiv.childNodes){if(w===v){x=f;continue}x.push(k(y=mt,ja,m0).call(y,w))}}h.push(l.nodeValue.slice(0,u).replaceAll(Ig,""))}else if(l===this.editorDiv){let v=h,x=0;for(const w of this.editorDiv.childNodes)x++===u&&(v=f),v.push(k(b=mt,ja,m0).call(b,w))}_(this,Mn,`${h.join(`
`)}${i}${f.join(`
`)}`),k(this,Qt,g0).call(this);const p=new Range;let m=Math.sumPrecise(h.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const x=v.nodeValue.length;if(m<=x){p.setStart(v,m),p.setEnd(v,m);break}m-=x}a.removeAllRanges(),a.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,r){var o;let i=null;if(t instanceof FP){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:h,rotation:f,id:p,popupRef:m},textContent:g,textPosition:y,parent:{page:{pageNumber:b}}}=t;if(!g||g.length===0)return null;i=t={annotationType:je.FREETEXT,color:Array.from(u),fontSize:l,value:g.join(`
`),position:y,pageIndex:b-1,rect:h.slice(0),rotation:f,annotationElementId:p,id:p,deleted:!1,popupRef:m}}const a=await super.deserialize(t,n,r);return _(a,In,t.fontSize),_(a,Ir,xe.makeHexColor(...t.color)),_(a,Mn,k(o=mt,ja,Hb).call(o,t.value)),a._initialData=i,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=mt._internalPadding*this.parentScale,r=this.getRect(n,n),i=yt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:d(this,Ir)),a={annotationType:je.FREETEXT,color:i,fontSize:d(this,In),value:k(this,Qt,WP).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(a.isCopy=!0,a):this.annotationElementId&&!k(this,Qt,GP).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(this.deleted)return n;const{style:r}=n;r.fontSize=`calc(${d(this,In)}px * var(--total-scale-factor))`,r.color=d(this,Ir),n.replaceChildren();for(const a of d(this,Mn).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),n.append(o)}const i=mt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:d(this,Mn)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Ir=new WeakMap,Mn=new WeakMap,fm=new WeakMap,yc=new WeakMap,In=new WeakMap,Qt=new WeakSet,HP=function(t){const n=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-d(this,In))*this.parentScale),_(this,In,i),k(this,Qt,p0).call(this)},r=d(this,In);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},VP=function(t){const n=i=>{_(this,Ir,this.editorDiv.style.color=i)},r=d(this,Ir);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},zP=function(){var r;const t=[];this.editorDiv.normalize();let n=null;for(const i of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(k(r=mt,ja,m0).call(r,i)),n=i);return t.join(`
`)},p0=function(){const[t,n]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:i,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",i.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/n):(this.width=r.height/t,this.height=r.width/n),this.fixAndSetPosition()},ja=new WeakSet,m0=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ig,"")},g0=function(){if(this.editorDiv.replaceChildren(),!!d(this,Mn))for(const t of d(this,Mn).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},WP=function(){return d(this,Mn).replaceAll(" "," ")},Hb=function(t){return t.replaceAll(" "," ")},GP=function(t){const{value:n,fontSize:r,color:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==r||t.color.some((o,l)=>o!==i[l])||t.pageIndex!==a},A(mt,ja),re(mt,"_freeTextDefaultContent",""),re(mt,"_internalPadding",0),re(mt,"_defaultColor",null),re(mt,"_defaultFontSize",10),re(mt,"_type","freetext"),re(mt,"_editorType",je.FREETEXT);let Bb=mt;class ce{toSVGPath(){ct("Abstract method `toSVGPath` must be implemented.")}get box(){ct("Abstract getter `box` must be implemented.")}serialize(e,t){ct("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*r,a[o+1]=n+e[o+1]*i;return a}static _rescaleAndSwap(e,t,n,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*r,a[o+1]=n+e[o]*i;return a}static _translate(e,t,n,r){r||(r=new Float32Array(e.length));for(let i=0,a=e.length;i<a;i+=2)r[i]=t+e[i],r[i+1]=n+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,i){switch(i){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,i,a){return[(e+5*n)/6,(t+5*r)/6,(5*n+i)/6,(5*r+a)/6,(n+i)/2,(r+a)/2]}}re(ce,"PRECISION",1e-4);var On,Or,Dd,Md,bi,Ue,vc,xc,pm,mm,Id,Od,Eo,gm,Ly,Dy,is,af,qP,KP,XP,YP,JP,QP;const zi=class zi{constructor({x:e,y:t},n,r,i,a,o=0){A(this,is);A(this,On);A(this,Or,[]);A(this,Dd);A(this,Md);A(this,bi,[]);A(this,Ue,new Float32Array(18));A(this,vc);A(this,xc);A(this,pm);A(this,mm);A(this,Id);A(this,Od);A(this,Eo,[]);_(this,On,n),_(this,Od,i*r),_(this,Md,a),d(this,Ue).set([NaN,NaN,NaN,NaN,e,t],6),_(this,Dd,o),_(this,mm,d(zi,gm)*r),_(this,pm,d(zi,Dy)*r),_(this,Id,r),d(this,Eo).push(e,t)}isEmpty(){return isNaN(d(this,Ue)[8])}add({x:e,y:t}){var R;_(this,vc,e),_(this,xc,t);const[n,r,i,a]=d(this,On);let[o,l,u,h]=d(this,Ue).subarray(8,12);const f=e-u,p=t-h,m=Math.hypot(f,p);if(m<d(this,pm))return!1;const g=m-d(this,mm),y=g/m,b=y*f,v=y*p;let x=o,w=l;o=u,l=h,u+=b,h+=v,(R=d(this,Eo))==null||R.push(e,t);const E=-v/g,T=b/g,C=E*d(this,Od),N=T*d(this,Od);return d(this,Ue).set(d(this,Ue).subarray(2,8),0),d(this,Ue).set([u+C,h+N],4),d(this,Ue).set(d(this,Ue).subarray(14,18),12),d(this,Ue).set([u-C,h-N],16),isNaN(d(this,Ue)[6])?(d(this,bi).length===0&&(d(this,Ue).set([o+C,l+N],2),d(this,bi).push(NaN,NaN,NaN,NaN,(o+C-n)/i,(l+N-r)/a),d(this,Ue).set([o-C,l-N],14),d(this,Or).push(NaN,NaN,NaN,NaN,(o-C-n)/i,(l-N-r)/a)),d(this,Ue).set([x,w,o,l,u,h],6),!this.isEmpty()):(d(this,Ue).set([x,w,o,l,u,h],6),Math.abs(Math.atan2(w-l,x-o)-Math.atan2(v,b))<Math.PI/2?([o,l,u,h]=d(this,Ue).subarray(2,6),d(this,bi).push(NaN,NaN,NaN,NaN,((o+u)/2-n)/i,((l+h)/2-r)/a),[o,l,x,w]=d(this,Ue).subarray(14,18),d(this,Or).push(NaN,NaN,NaN,NaN,((x+o)/2-n)/i,((w+l)/2-r)/a),!0):([x,w,o,l,u,h]=d(this,Ue).subarray(0,6),d(this,bi).push(((x+5*o)/6-n)/i,((w+5*l)/6-r)/a,((5*o+u)/6-n)/i,((5*l+h)/6-r)/a,((o+u)/2-n)/i,((l+h)/2-r)/a),[u,h,o,l,x,w]=d(this,Ue).subarray(12,18),d(this,Or).push(((x+5*o)/6-n)/i,((w+5*l)/6-r)/a,((5*o+u)/6-n)/i,((5*l+h)/6-r)/a,((o+u)/2-n)/i,((l+h)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=d(this,bi),t=d(this,Or);if(isNaN(d(this,Ue)[6])&&!this.isEmpty())return k(this,is,qP).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);k(this,is,XP).call(this,n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return k(this,is,KP).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,r,i,a){return new ZP(e,t,n,r,i,a)}getOutlines(){var f;const e=d(this,bi),t=d(this,Or),n=d(this,Ue),[r,i,a,o]=d(this,On),l=new Float32Array((((f=d(this,Eo))==null?void 0:f.length)??0)+2);for(let p=0,m=l.length-2;p<m;p+=2)l[p]=(d(this,Eo)[p]-r)/a,l[p+1]=(d(this,Eo)[p+1]-i)/o;if(l[l.length-2]=(d(this,vc)-r)/a,l[l.length-1]=(d(this,xc)-i)/o,isNaN(n[6])&&!this.isEmpty())return k(this,is,YP).call(this,l);const u=new Float32Array(d(this,bi).length+24+d(this,Or).length);let h=e.length;for(let p=0;p<h;p+=2){if(isNaN(e[p])){u[p]=u[p+1]=NaN;continue}u[p]=e[p],u[p+1]=e[p+1]}h=k(this,is,QP).call(this,u,h);for(let p=t.length-6;p>=6;p-=6)for(let m=0;m<6;m+=2){if(isNaN(t[p+m])){u[h]=u[h+1]=NaN,h+=2;continue}u[h]=t[p+m],u[h+1]=t[p+m+1],h+=2}return k(this,is,JP).call(this,u,h),this.newFreeDrawOutline(u,l,d(this,On),d(this,Id),d(this,Dd),d(this,Md))}};On=new WeakMap,Or=new WeakMap,Dd=new WeakMap,Md=new WeakMap,bi=new WeakMap,Ue=new WeakMap,vc=new WeakMap,xc=new WeakMap,pm=new WeakMap,mm=new WeakMap,Id=new WeakMap,Od=new WeakMap,Eo=new WeakMap,gm=new WeakMap,Ly=new WeakMap,Dy=new WeakMap,is=new WeakSet,af=function(){const e=d(this,Ue).subarray(4,6),t=d(this,Ue).subarray(16,18),[n,r,i,a]=d(this,On);return[(d(this,vc)+(e[0]-t[0])/2-n)/i,(d(this,xc)+(e[1]-t[1])/2-r)/a,(d(this,vc)+(t[0]-e[0])/2-n)/i,(d(this,xc)+(t[1]-e[1])/2-r)/a]},qP=function(){const[e,t,n,r]=d(this,On),[i,a,o,l]=k(this,is,af).call(this);return`M${(d(this,Ue)[2]-e)/n} ${(d(this,Ue)[3]-t)/r} L${(d(this,Ue)[4]-e)/n} ${(d(this,Ue)[5]-t)/r} L${i} ${a} L${o} ${l} L${(d(this,Ue)[16]-e)/n} ${(d(this,Ue)[17]-t)/r} L${(d(this,Ue)[14]-e)/n} ${(d(this,Ue)[15]-t)/r} Z`},KP=function(e){const t=d(this,Or);e.push(`L${t[4]} ${t[5]} Z`)},XP=function(e){const[t,n,r,i]=d(this,On),a=d(this,Ue).subarray(4,6),o=d(this,Ue).subarray(16,18),[l,u,h,f]=k(this,is,af).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-n)/i} L${l} ${u} L${h} ${f} L${(o[0]-t)/r} ${(o[1]-n)/i}`)},YP=function(e){const t=d(this,Ue),[n,r,i,a]=d(this,On),[o,l,u,h]=k(this,is,af).call(this),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-n)/i,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-n)/i,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,(t[16]-n)/i,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-n)/i,(t[15]-r)/a],0),this.newFreeDrawOutline(f,e,d(this,On),d(this,Id),d(this,Dd),d(this,Md))},JP=function(e,t){const n=d(this,Or);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},QP=function(e,t){const n=d(this,Ue).subarray(4,6),r=d(this,Ue).subarray(16,18),[i,a,o,l]=d(this,On),[u,h,f,p]=k(this,is,af).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-i)/o,(n[1]-a)/l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(r[0]-i)/o,(r[1]-a)/l],t),t+=24},A(zi,gm,8),A(zi,Ly,2),A(zi,Dy,d(zi,gm)+d(zi,Ly));let py=zi;var Fd,wc,fa,ym,Fn,vm,Bt,My,eR;class ZP extends ce{constructor(t,n,r,i,a,o){super();A(this,My);A(this,Fd);A(this,wc,new Float32Array(4));A(this,fa);A(this,ym);A(this,Fn);A(this,vm);A(this,Bt);_(this,Bt,t),_(this,Fn,n),_(this,Fd,r),_(this,vm,i),_(this,fa,a),_(this,ym,o),this.lastPoint=[NaN,NaN],k(this,My,eR).call(this,o);const[l,u,h,f]=d(this,wc);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/h,t[p+1]=(t[p+1]-u)/f;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/h,n[p+1]=(n[p+1]-u)/f}toSVGPath(){const t=[`M${d(this,Bt)[4]} ${d(this,Bt)[5]}`];for(let n=6,r=d(this,Bt).length;n<r;n+=6){if(isNaN(d(this,Bt)[n])){t.push(`L${d(this,Bt)[n+4]} ${d(this,Bt)[n+5]}`);continue}t.push(`C${d(this,Bt)[n]} ${d(this,Bt)[n+1]} ${d(this,Bt)[n+2]} ${d(this,Bt)[n+3]} ${d(this,Bt)[n+4]} ${d(this,Bt)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,r,i],a){const o=r-t,l=i-n;let u,h;switch(a){case 0:u=ce._rescale(d(this,Bt),t,i,o,-l),h=ce._rescale(d(this,Fn),t,i,o,-l);break;case 90:u=ce._rescaleAndSwap(d(this,Bt),t,n,o,l),h=ce._rescaleAndSwap(d(this,Fn),t,n,o,l);break;case 180:u=ce._rescale(d(this,Bt),r,n,-o,l),h=ce._rescale(d(this,Fn),r,n,-o,l);break;case 270:u=ce._rescaleAndSwap(d(this,Bt),r,i,-o,-l),h=ce._rescaleAndSwap(d(this,Fn),r,i,-o,-l);break}return{outline:Array.from(u),points:[Array.from(h)]}}get box(){return d(this,wc)}newOutliner(t,n,r,i,a,o=0){return new py(t,n,r,i,a,o)}getNewOutline(t,n){const[r,i,a,o]=d(this,wc),[l,u,h,f]=d(this,Fd),p=a*h,m=o*f,g=r*h+l,y=i*f+u,b=this.newOutliner({x:d(this,Fn)[0]*p+g,y:d(this,Fn)[1]*m+y},d(this,Fd),d(this,vm),t,d(this,ym),n??d(this,fa));for(let v=2;v<d(this,Fn).length;v+=2)b.add({x:d(this,Fn)[v]*p+g,y:d(this,Fn)[v+1]*m+y});return b.getOutlines()}}Fd=new WeakMap,wc=new WeakMap,fa=new WeakMap,ym=new WeakMap,Fn=new WeakMap,vm=new WeakMap,Bt=new WeakMap,My=new WeakSet,eR=function(t){const n=d(this,Bt);let r=n[4],i=n[5];const a=[r,i,r,i];let o=r,l=i;const u=t?Math.max:Math.min;for(let f=6,p=n.length;f<p;f+=6){const m=n[f+4],g=n[f+5];if(isNaN(n[f]))xe.pointBoundingBox(m,g,a),l<g?(o=m,l=g):l===g&&(o=u(o,m));else{const y=[1/0,1/0,-1/0,-1/0];xe.bezierBoundingBox(r,i,...n.slice(f,f+6),y),xe.rectBoundingBox(...y,a),l<y[3]?(o=y[2],l=y[3]):l===y[3]&&(o=u(o,y[2]))}r=m,i=g}const h=d(this,wc);h[0]=a[0]-d(this,fa),h[1]=a[1]-d(this,fa),h[2]=a[2]-a[0]+2*d(this,fa),h[3]=a[3]-a[1]+2*d(this,fa),this.lastPoint=[o,l]};var xm,wm,Ao,Fr,rn,tR,y0,sR,nR,zb;class Vb{constructor(e,t=0,n=0,r=!0){A(this,rn);A(this,xm);A(this,wm);A(this,Ao,[]);A(this,Fr,[]);const i=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:m,y:g,width:y,height:b}of e){const v=Math.floor((m-t)/a)*a,x=Math.ceil((m+y+t)/a)*a,w=Math.floor((g-t)/a)*a,E=Math.ceil((g+b+t)/a)*a,T=[v,w,E,!0],C=[x,w,E,!1];d(this,Ao).push(T,C),xe.rectBoundingBox(v,w,x,E,i)}const o=i[2]-i[0]+2*n,l=i[3]-i[1]+2*n,u=i[0]-n,h=i[1]-n,f=d(this,Ao).at(r?-1:-2),p=[f[0],f[2]];for(const m of d(this,Ao)){const[g,y,b]=m;m[0]=(g-u)/o,m[1]=(y-h)/l,m[2]=(b-h)/l}_(this,xm,new Float32Array([u,h,o,l])),_(this,wm,p)}getOutlines(){d(this,Ao).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of d(this,Ao))t[3]?(e.push(...k(this,rn,zb).call(this,t)),k(this,rn,sR).call(this,t)):(k(this,rn,nR).call(this,t),e.push(...k(this,rn,zb).call(this,t)));return k(this,rn,tR).call(this,e)}}xm=new WeakMap,wm=new WeakMap,Ao=new WeakMap,Fr=new WeakMap,rn=new WeakSet,tR=function(e){const t=[],n=new Set;for(const a of e){const[o,l,u]=a;t.push([o,l,a],[o,u,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],u=t[a+1][2];l.push(u),u.push(l),n.add(l),n.add(u)}const r=[];let i;for(;n.size>0;){const a=n.values().next().value;let[o,l,u,h,f]=a;n.delete(a);let p=o,m=l;for(i=[o,u],r.push(i);;){let g;if(n.has(h))g=h;else if(n.has(f))g=f;else break;n.delete(g),[o,l,u,h,f]=g,p!==o&&(i.push(p,m,o,m===l?l:u),p=o),m=m===l?u:l}i.push(p,m)}return new U6(r,d(this,xm),d(this,wm))},y0=function(e){const t=d(this,Fr);let n=0,r=t.length-1;for(;n<=r;){const i=n+r>>1,a=t[i][0];if(a===e)return i;a<e?n=i+1:r=i-1}return r+1},sR=function([,e,t]){const n=k(this,rn,y0).call(this,e);d(this,Fr).splice(n,0,[e,t])},nR=function([,e,t]){const n=k(this,rn,y0).call(this,e);for(let r=n;r<d(this,Fr).length;r++){const[i,a]=d(this,Fr)[r];if(i!==e)break;if(i===e&&a===t){d(this,Fr).splice(r,1);return}}for(let r=n-1;r>=0;r--){const[i,a]=d(this,Fr)[r];if(i!==e)break;if(i===e&&a===t){d(this,Fr).splice(r,1);return}}},zb=function(e){const[t,n,r]=e,i=[[t,n,r]],a=k(this,rn,y0).call(this,r);for(let o=0;o<a;o++){const[l,u]=d(this,Fr)[o];for(let h=0,f=i.length;h<f;h++){const[,p,m]=i[h];if(!(u<=p||m<=l)){if(p>=l){if(m>u)i[h][1]=u;else{if(f===1)return[];i.splice(h,1),h--,f--}continue}i[h][2]=l,m>u&&i.push([t,u,m])}}}return i};var bm,$d;class U6 extends ce{constructor(t,n,r){super();A(this,bm);A(this,$d);_(this,$d,t),_(this,bm,n),this.lastPoint=r}toSVGPath(){const t=[];for(const n of d(this,$d)){let[r,i]=n;t.push(`M${r} ${i}`);for(let a=2;a<n.length;a+=2){const o=n[a],l=n[a+1];o===r?(t.push(`V${l}`),i=l):l===i&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,n,r,i],a){const o=[],l=r-t,u=i-n;for(const h of d(this,$d)){const f=new Array(h.length);for(let p=0;p<h.length;p+=2)f[p]=t+h[p]*l,f[p+1]=i-h[p+1]*u;o.push(f)}return o}get box(){return d(this,bm)}get classNamesForOutlining(){return["highlightOutline"]}}bm=new WeakMap,$d=new WeakMap;class Wb extends py{newFreeDrawOutline(e,t,n,r,i,a){return new B6(e,t,n,r,i,a)}}class B6 extends ZP{newOutliner(e,t,n,r,i,a=0){return new Wb(e,t,n,r,i,a)}}var $n,bc,Ud,ss,Sm,Bd,pa,_m,ko,$r,Hd,Em,lt,Gb,qb,Kb,Sl,rR,qa;const fn=class fn{constructor({editor:e=null,uiManager:t=null}){A(this,lt);A(this,$n,null);A(this,bc,null);A(this,Ud);A(this,ss,null);A(this,Sm,!1);A(this,Bd,!1);A(this,pa,null);A(this,_m);A(this,ko,null);A(this,$r,null);A(this,Hd);var n,r;e?(_(this,Bd,!1),_(this,Hd,We.HIGHLIGHT_COLOR),_(this,pa,e)):(_(this,Bd,!0),_(this,Hd,We.HIGHLIGHT_DEFAULT_COLOR)),_(this,$r,(e==null?void 0:e._uiManager)||t),_(this,_m,d(this,$r)._eventBus),_(this,Ud,((n=e==null?void 0:e.color)==null?void 0:n.toUpperCase())||((r=d(this,$r))==null?void 0:r.highlightColors.values().next().value)||"#FFFF98"),d(fn,Em)||_(fn,Em,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Ve(this,"_keyboardManager",new Zm([[["Escape","mac+Escape"],fn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],fn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],fn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],fn.prototype._moveToPrevious],[["Home","mac+Home"],fn.prototype._moveToBeginning],[["End","mac+End"],fn.prototype._moveToEnd]]))}renderButton(){const e=_(this,$n,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",d(this,pa)&&(e.ariaControls=`${d(this,pa).id}_colorpicker_dropdown`);const t=d(this,$r)._signal;e.addEventListener("click",k(this,lt,Sl).bind(this),{signal:t}),e.addEventListener("keydown",k(this,lt,Kb).bind(this),{signal:t});const n=_(this,bc,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=d(this,Ud),e.append(n),e}renderMainDropdown(){const e=_(this,ss,k(this,lt,Gb).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===d(this,$n)){k(this,lt,Sl).call(this,e);return}const t=e.target.getAttribute("data-color");t&&k(this,lt,qb).call(this,t,e)}_moveToNext(e){var t,n;if(!d(this,lt,qa)){k(this,lt,Sl).call(this,e);return}if(e.target===d(this,$n)){(t=d(this,ss).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=d(this,ss))==null?void 0:t.firstChild)||e.target===d(this,$n)){d(this,lt,qa)&&this._hideDropdownFromKeyboard();return}d(this,lt,qa)||k(this,lt,Sl).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!d(this,lt,qa)){k(this,lt,Sl).call(this,e);return}(t=d(this,ss).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!d(this,lt,qa)){k(this,lt,Sl).call(this,e);return}(t=d(this,ss).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=d(this,ss))==null||e.classList.add("hidden"),d(this,$n).ariaExpanded="false",(t=d(this,ko))==null||t.abort(),_(this,ko,null)}_hideDropdownFromKeyboard(){var e;if(!d(this,Bd)){if(!d(this,lt,qa)){(e=d(this,pa))==null||e.unselect();return}this.hideDropdown(),d(this,$n).focus({preventScroll:!0,focusVisible:d(this,Sm)})}}updateColor(e){if(d(this,bc)&&(d(this,bc).style.backgroundColor=e),!d(this,ss))return;const t=d(this,$r).highlightColors.values();for(const n of d(this,ss).children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=d(this,$n))==null||e.remove(),_(this,$n,null),_(this,bc,null),(t=d(this,ss))==null||t.remove(),_(this,ss,null)}};$n=new WeakMap,bc=new WeakMap,Ud=new WeakMap,ss=new WeakMap,Sm=new WeakMap,Bd=new WeakMap,pa=new WeakMap,_m=new WeakMap,ko=new WeakMap,$r=new WeakMap,Hd=new WeakMap,Em=new WeakMap,lt=new WeakSet,Gb=function(){const e=document.createElement("div"),t=d(this,$r)._signal;e.addEventListener("contextmenu",Ar,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),d(this,pa)&&(e.id=`${d(this,pa).id}_colorpicker_dropdown`);for(const[n,r]of d(this,$r).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",r),i.title=n,i.setAttribute("data-l10n-id",d(fn,Em)[n]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=r,i.ariaSelected=r===d(this,Ud),i.addEventListener("click",k(this,lt,qb).bind(this,r),{signal:t}),e.append(i)}return e.addEventListener("keydown",k(this,lt,Kb).bind(this),{signal:t}),e},qb=function(e,t){t.stopPropagation(),d(this,_m).dispatch("switchannotationeditorparams",{source:this,type:d(this,Hd),value:e})},Kb=function(e){fn._keyboardManager.exec(this,e)},Sl=function(e){if(d(this,lt,qa)){this.hideDropdown();return}if(_(this,Sm,e.detail===0),d(this,ko)||(_(this,ko,new AbortController),window.addEventListener("pointerdown",k(this,lt,rR).bind(this),{signal:d(this,$r).combinedSignal(d(this,ko))})),d(this,$n).ariaExpanded="true",d(this,ss)){d(this,ss).classList.remove("hidden");return}const t=_(this,ss,k(this,lt,Gb).call(this));d(this,$n).append(t)},rR=function(e){var t;(t=d(this,ss))!=null&&t.contains(e.target)||this.hideDropdown()},qa=function(){return d(this,ss)&&!d(this,ss).classList.contains("hidden")},A(fn,Em,null);let rp=fn;var Vd,Am,ma,Sc,km,gn,Tm,Cm,_c,fr,Un,ws,zd,ga,Fs,Wd,pr,Nm,Oe,Xb,v0,iR,aR,oR,Yb,_l,vr,wu,lR,x0,of,cR,uR,dR,hR,fR;const et=class et extends yt{constructor(t){super({...t,name:"highlightEditor"});A(this,Oe);A(this,Vd,null);A(this,Am,0);A(this,ma);A(this,Sc,null);A(this,km,null);A(this,gn,null);A(this,Tm,null);A(this,Cm,0);A(this,_c,null);A(this,fr,null);A(this,Un,null);A(this,ws,!1);A(this,zd,null);A(this,ga);A(this,Fs,null);A(this,Wd,"");A(this,pr);A(this,Nm,"");this.color=t.color||et._defaultColor,_(this,pr,t.thickness||et._defaultThickness),_(this,ga,t.opacity||et._defaultOpacity),_(this,ma,t.boxes||null),_(this,Nm,t.methodOfCreation||""),_(this,Wd,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(_(this,ws,!0),k(this,Oe,v0).call(this,t),k(this,Oe,_l).call(this)):d(this,ma)&&(_(this,Vd,t.anchorNode),_(this,Am,t.anchorOffset),_(this,Tm,t.focusNode),_(this,Cm,t.focusOffset),k(this,Oe,Xb).call(this),k(this,Oe,_l).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=et.prototype;return Ve(this,"_keyboardManager",new Zm([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:d(this,ws)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:d(this,pr),methodOfCreation:d(this,Nm)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var r;yt.initialize(t,n),et._defaultColor||(et._defaultColor=((r=n.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case We.HIGHLIGHT_DEFAULT_COLOR:et._defaultColor=n;break;case We.HIGHLIGHT_THICKNESS:et._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return d(this,zd)}updateParams(t,n){switch(t){case We.HIGHLIGHT_COLOR:k(this,Oe,iR).call(this,n);break;case We.HIGHLIGHT_THICKNESS:k(this,Oe,aR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[We.HIGHLIGHT_DEFAULT_COLOR,et._defaultColor],[We.HIGHLIGHT_THICKNESS,et._defaultThickness]]}get propertiesToUpdate(){return[[We.HIGHLIGHT_COLOR,this.color||et._defaultColor],[We.HIGHLIGHT_THICKNESS,d(this,pr)||et._defaultThickness],[We.HIGHLIGHT_FREE,d(this,ws)]]}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",_(this,km,new rp({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(k(this,Oe,of).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,k(this,Oe,of).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){k(this,Oe,Yb).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(k(this,Oe,_l).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?k(this,Oe,Yb).call(this):t&&(k(this,Oe,_l).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var i,a,o;const{drawLayer:n}=this.parent;let r;d(this,ws)?(t=(t-this.rotation+360)%360,r=k(i=et,vr,wu).call(i,d(this,fr).box,t)):r=k(a=et,vr,wu).call(a,[this.x,this.y,this.width,this.height],t),n.updateProperties(d(this,Un),{bbox:r,root:{"data-main-rotation":t}}),n.updateProperties(d(this,Fs),{bbox:k(o=et,vr,wu).call(o,d(this,gn).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();d(this,Wd)&&(t.setAttribute("aria-label",d(this,Wd)),t.setAttribute("role","mark")),d(this,ws)?t.classList.add("free"):this.div.addEventListener("keydown",k(this,Oe,lR).bind(this),{signal:this._uiManager._signal});const n=_(this,_c,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=d(this,Sc);const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),Rj(this,d(this,_c),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,Fs),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,Fs),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:k(this,Oe,x0).call(this,!0);break;case 1:case 3:k(this,Oe,x0).call(this,!1);break}}select(){var t;super.select(),d(this,Fs)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,Fs),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),d(this,Fs)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,Fs),{rootClass:{selected:!1}}),d(this,ws)||k(this,Oe,x0).call(this,!1))}get _mustFixPosition(){return!d(this,ws)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(d(this,Un),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(d(this,Fs),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:r,x:i,y:a}){const{x:o,y:l,width:u,height:h}=r.getBoundingClientRect(),f=new AbortController,p=t.combinedSignal(f),m=g=>{f.abort(),k(this,vr,hR).call(this,t,g)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",Ht,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Ar,{signal:p}),r.addEventListener("pointermove",k(this,vr,dR).bind(this,t),{signal:p}),this._freeHighlight=new Wb({x:i,y:a},[o,l,u,h],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,r){var y,b,v,x;let i=null;if(t instanceof UP){const{data:{quadPoints:w,rect:E,rotation:T,id:C,color:N,opacity:j,popupRef:R},parent:{page:{pageNumber:D}}}=t;i=t={annotationType:je.HIGHLIGHT,color:Array.from(N),opacity:j,quadPoints:w,boxes:null,pageIndex:D-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,popupRef:R}}else if(t instanceof Y_){const{data:{inkLists:w,rect:E,rotation:T,id:C,color:N,borderStyle:{rawWidth:j},popupRef:R},parent:{page:{pageNumber:D}}}=t;i=t={annotationType:je.HIGHLIGHT,color:Array.from(N),thickness:j,inkLists:w,boxes:null,pageIndex:D-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,popupRef:R}}const{color:a,quadPoints:o,inkLists:l,opacity:u}=t,h=await super.deserialize(t,n,r);h.color=xe.makeHexColor(...a),_(h,ga,u||1),l&&_(h,pr,t.thickness),h._initialData=i;const[f,p]=h.pageDimensions,[m,g]=h.pageTranslation;if(o){const w=_(h,ma,[]);for(let E=0;E<o.length;E+=8)w.push({x:(o[E]-m)/f,y:1-(o[E+1]-g)/p,width:(o[E+2]-o[E])/f,height:(o[E+1]-o[E+5])/p});k(y=h,Oe,Xb).call(y),k(b=h,Oe,_l).call(b),h.rotate(h.rotation)}else if(l){_(h,ws,!0);const w=l[0],E={x:w[0]-m,y:p-(w[1]-g)},T=new Wb(E,[0,0,f,p],1,d(h,pr)/2,!0,.001);for(let j=0,R=w.length;j<R;j+=2)E.x=w[j]-m,E.y=p-(w[j+1]-g),T.add(E);const{id:C,clipPathId:N}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:T.toSVGPath()}},!0,!0);k(v=h,Oe,v0).call(v,{highlightOutlines:T.getOutlines(),highlightId:C,clipPathId:N}),k(x=h,Oe,_l).call(x),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=this.getRect(0,0),r=yt._colorManager.convert(this.color),i={annotationType:je.HIGHLIGHT,color:r,opacity:d(this,ga),thickness:d(this,pr),quadPoints:k(this,Oe,cR).call(this),outlines:k(this,Oe,uR).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:k(this,Oe,of).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!k(this,Oe,fR).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Vd=new WeakMap,Am=new WeakMap,ma=new WeakMap,Sc=new WeakMap,km=new WeakMap,gn=new WeakMap,Tm=new WeakMap,Cm=new WeakMap,_c=new WeakMap,fr=new WeakMap,Un=new WeakMap,ws=new WeakMap,zd=new WeakMap,ga=new WeakMap,Fs=new WeakMap,Wd=new WeakMap,pr=new WeakMap,Nm=new WeakMap,Oe=new WeakSet,Xb=function(){const t=new Vb(d(this,ma),.001);_(this,fr,t.getOutlines()),[this.x,this.y,this.width,this.height]=d(this,fr).box;const n=new Vb(d(this,ma),.0025,.001,this._uiManager.direction==="ltr");_(this,gn,n.getOutlines());const{lastPoint:r}=d(this,gn);_(this,zd,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},v0=function({highlightOutlines:t,highlightId:n,clipPathId:r}){var f,p;if(_(this,fr,t),_(this,gn,t.getNewOutline(d(this,pr)/2+1.5,.0025)),n>=0)_(this,Un,n),_(this,Sc,r),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),_(this,Fs,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:d(this,gn).box,path:{d:d(this,gn).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(d(this,Un),{bbox:k(f=et,vr,wu).call(f,d(this,fr).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(d(this,Fs),{bbox:k(p=et,vr,wu).call(p,d(this,gn).box,m),path:{d:d(this,gn).toSVGPath()}})}const[a,o,l,u]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=u;break;case 90:{const[m,g]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*g/m,this.height=u*m/g;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=u;break;case 270:{const[m,g]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*g/m,this.height=u*m/g;break}}const{lastPoint:h}=d(this,gn);_(this,zd,[(h[0]-a)/l,(h[1]-o)/u])},iR=function(t){const n=(a,o)=>{var l,u;this.color=a,_(this,ga,o),(l=this.parent)==null||l.drawLayer.updateProperties(d(this,Un),{root:{fill:a,"fill-opacity":o}}),(u=d(this,km))==null||u.updateColor(a)},r=this.color,i=d(this,ga);this.addCommands({cmd:n.bind(this,t,et._defaultOpacity),undo:n.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},aR=function(t){const n=d(this,pr),r=i=>{_(this,pr,i),k(this,Oe,oR).call(this,i)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},oR=function(t){if(!d(this,ws))return;k(this,Oe,v0).call(this,{highlightOutlines:d(this,fr).getNewOutline(t/2)}),this.fixAndSetPosition();const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r)},Yb=function(){d(this,Un)===null||!this.parent||(this.parent.drawLayer.remove(d(this,Un)),_(this,Un,null),this.parent.drawLayer.remove(d(this,Fs)),_(this,Fs,null))},_l=function(t=this.parent){d(this,Un)===null&&({id:Ws(this,Un)._,clipPathId:Ws(this,Sc)._}=t.drawLayer.draw({bbox:d(this,fr).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":d(this,ga)},rootClass:{highlight:!0,free:d(this,ws)},path:{d:d(this,fr).toSVGPath()}},!1,!0),_(this,Fs,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:d(this,ws)},bbox:d(this,gn).box,path:{d:d(this,gn).toSVGPath()}},d(this,ws))),d(this,_c)&&(d(this,_c).style.clipPath=d(this,Sc)))},vr=new WeakSet,wu=function([t,n,r,i],a){switch(a){case 90:return[1-n-i,t,i,r];case 180:return[1-t-r,1-n-i,r,i];case 270:return[n,1-t-r,i,r]}return[t,n,r,i]},lR=function(t){et._keyboardManager.exec(this,t)},x0=function(t){if(!d(this,Vd))return;const n=window.getSelection();t?n.setPosition(d(this,Vd),d(this,Am)):n.setPosition(d(this,Tm),d(this,Cm))},of=function(){return d(this,ws)?this.rotation:0},cR=function(){if(d(this,ws))return null;const[t,n]=this.pageDimensions,[r,i]=this.pageTranslation,a=d(this,ma),o=new Float32Array(a.length*8);let l=0;for(const{x:u,y:h,width:f,height:p}of a){const m=u*t+r,g=(1-h)*n+i;o[l]=o[l+4]=m,o[l+1]=o[l+3]=g,o[l+2]=o[l+6]=m+f*t,o[l+5]=o[l+7]=g-p*n,l+=8}return o},uR=function(t){return d(this,fr).serialize(t,k(this,Oe,of).call(this))},dR=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},hR=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},fR=function(t){const{color:n}=this._initialData;return t.color.some((r,i)=>r!==n[i])},A(et,vr),re(et,"_defaultColor",null),re(et,"_defaultOpacity",1),re(et,"_defaultThickness",12),re(et,"_type","highlight"),re(et,"_editorType",je.HIGHLIGHT),re(et,"_freeHighlightId",-1),re(et,"_freeHighlight",null),re(et,"_freeHighlightClipId","");let my=et;var Ec;class pR{constructor(){A(this,Ec,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){d(this,Ec)[e]=t}toSVGProperties(){const e=d(this,Ec);return _(this,Ec,Object.create(null)),{root:e}}reset(){_(this,Ec,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ct("Not implemented")}}Ec=new WeakMap;var Bn,Gd,cs,Ac,kc,To,Co,No,Tc,Xe,Jb,Qb,Zb,lf,mR,w0,cf,bu;const he=class he extends yt{constructor(t){super(t);A(this,Xe);A(this,Bn,null);A(this,Gd);re(this,"_drawId",null);_(this,Gd,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(k(this,Xe,Jb).call(this,t),k(this,Xe,lf).call(this))}static _mergeSVGProperties(t,n){const r=new Set(Object.keys(t));for(const[i,a]of Object.entries(n))r.has(i)?Object.assign(t[i],a):t[i]=a;return t}static getDefaultDrawingOptions(t){ct("Not implemented")}static get typesMap(){ct("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,n),this._currentParent&&(d(he,cs).updateProperty(r,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[r,i]of this.typesMap)t.push([r,n[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[r,i]of this.constructor.typesMap)t.push([r,n[i]]);return t}_updateProperty(t,n,r){const i=this._drawingOptions,a=i[n],o=l=>{var h;i.updateProperty(n,l);const u=d(this,Bn).updateProperty(n,l);u&&k(this,Xe,cf).call(this,u),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,he._mergeSVGProperties(d(this,Bn).getPathResizingSVGProperties(k(this,Xe,w0).call(this)),{bbox:k(this,Xe,bu).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,he._mergeSVGProperties(d(this,Bn).getPathResizedSVGProperties(k(this,Xe,w0).call(this)),{bbox:k(this,Xe,bu).call(this)}))}_onTranslating(t,n){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:k(this,Xe,bu).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,he._mergeSVGProperties(d(this,Bn).getPathTranslatedSVGProperties(k(this,Xe,w0).call(this),this.parentDimensions),{bbox:k(this,Xe,bu).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,d(this,Gd)&&(_(this,Gd,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){k(this,Xe,Zb).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(k(this,Xe,lf).call(this),k(this,Xe,cf).call(this,d(this,Bn).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),k(this,Xe,Zb).call(this)):t&&(this._uiManager.addShouldRescale(this),k(this,Xe,lf).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,he._mergeSVGProperties({bbox:k(this,Xe,bu).call(this)},d(this,Bn).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&k(this,Xe,cf).call(this,d(this,Bn).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,n;this._isCopy&&(t=this.x,n=this.y);const r=super.render();r.classList.add("draw");const i=document.createElement("div");r.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,n),r}static createDrawerInstance(t,n,r,i,a){ct("Not implemented")}static startDrawing(t,n,r,i){var b;const{target:a,offsetX:o,offsetY:l,pointerId:u,pointerType:h}=i;if(d(he,Co)&&d(he,Co)!==h)return;const{viewport:{rotation:f}}=t,{width:p,height:m}=a.getBoundingClientRect(),g=_(he,Ac,new AbortController),y=t.combinedSignal(g);if(d(he,To)||_(he,To,u),d(he,Co)??_(he,Co,h),window.addEventListener("pointerup",v=>{var x;d(he,To)===v.pointerId?this._endDraw(v):(x=d(he,No))==null||x.delete(v.pointerId)},{signal:y}),window.addEventListener("pointercancel",v=>{var x;d(he,To)===v.pointerId?this._currentParent.endDrawingSession():(x=d(he,No))==null||x.delete(v.pointerId)},{signal:y}),window.addEventListener("pointerdown",v=>{d(he,Co)===v.pointerType&&((d(he,No)||_(he,No,new Set)).add(v.pointerId),d(he,cs).isCancellable()&&(d(he,cs).removeLastElement(),d(he,cs).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Ar,{signal:y}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),a.addEventListener("touchmove",v=>{v.timeStamp===d(he,Tc)&&Ht(v)},{signal:y}),t.toggleDrawing(),(b=n._editorUndoBar)==null||b.hide(),d(he,cs)){t.drawLayer.updateProperties(this._currentDrawId,d(he,cs).startNew(o,l,p,m,f));return}n.updateUIForDefaultProperties(this),_(he,cs,this.createDrawerInstance(o,l,p,m,f)),_(he,kc,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(d(he,kc).toSVGProperties(),d(he,cs).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(_(he,Tc,-1),!d(he,cs))return;const{offsetX:n,offsetY:r,pointerId:i}=t;if(d(he,To)===i){if(((a=d(he,No))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,d(he,cs).add(n,r)),_(he,Tc,t.timeStamp),Ht(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,_(he,cs,null),_(he,kc,null),_(he,Co,null),_(he,Tc,NaN)),d(he,Ac)&&(d(he,Ac).abort(),_(he,Ac,null),_(he,To,NaN),_(he,No,null))}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,d(he,cs).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=d(he,cs),i=this._currentDrawId,a=r.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(i,r.setLastElement(a))},undo:()=>{n.drawLayer.updateProperties(i,r.removeLastElement())},mustExec:!1,type:We.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(We.DRAW_STEP),!d(he,cs).isEmpty()){const{pageDimensions:[r,i],scale:a}=n,o=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:d(he,cs).getOutlines(r*a,i*a,a,this._INNER_MARGIN),drawingOptions:d(he,kc),mustBeCommitted:!t});return this._cleanup(!0),o}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,r,i,a,o){ct("Not implemented")}static async deserialize(t,n,r){var f,p;const{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}=n.viewport,u=this.deserializeDraw(o,l,i,a,this._INNER_MARGIN,t),h=await super.deserialize(t,n,r);return h.createDrawingOptions(t),k(f=h,Xe,Jb).call(f,{drawOutlines:u}),k(p=h,Xe,lf).call(p),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[n,r]=this.pageTranslation,[i,a]=this.pageDimensions;return d(this,Bn).serialize([n,r,i,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Bn=new WeakMap,Gd=new WeakMap,cs=new WeakMap,Ac=new WeakMap,kc=new WeakMap,To=new WeakMap,Co=new WeakMap,No=new WeakMap,Tc=new WeakMap,Xe=new WeakSet,Jb=function({drawOutlines:t,drawId:n,drawingOptions:r}){_(this,Bn,t),this._drawingOptions||(this._drawingOptions=r),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=k(this,Xe,Qb).call(this,t,this.parent),k(this,Xe,cf).call(this,t.box)},Qb=function(t,n){const{id:r}=n.drawLayer.draw(he._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},Zb=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},lf=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=k(this,Xe,Qb).call(this,d(this,Bn),t)}},mR=function([t,n,r,i]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[n,1-t,r*(o/a),i*(a/o)];case 180:return[1-t,1-n,r,i];case 270:return[1-n,t,r*(o/a),i*(a/o)];default:return[t,n,r,i]}},w0=function(){const{x:t,y:n,width:r,height:i,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-n,t,r*(a/o),i*(o/a)];case 180:return[1-t,1-n,r,i];case 270:return[n,1-t,r*(a/o),i*(o/a)];default:return[t,n,r,i]}},cf=function(t){if([this.x,this.y,this.width,this.height]=k(this,Xe,mR).call(this,t),this.div){this.fixAndSetPosition();const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r)}this._onResized()},bu=function(){const{x:t,y:n,width:r,height:i,rotation:a,parentRotation:o,parentDimensions:[l,u]}=this;switch((a*4+o)/90){case 1:return[1-n-i,t,i,r];case 2:return[1-t-r,1-n-i,r,i];case 3:return[n,1-t-r,i,r];case 4:return[t,n-r*(l/u),i*(u/l),r*(l/u)];case 5:return[1-n,t,r*(l/u),i*(u/l)];case 6:return[1-t-i*(u/l),1-n,i*(u/l),r*(l/u)];case 7:return[n-r*(l/u),1-t-i*(u/l),r*(l/u),i*(u/l)];case 8:return[t-r,n-i,r,i];case 9:return[1-n,t-r,i,r];case 10:return[1-t,1-n,r,i];case 11:return[n-i,1-t,i,r];case 12:return[t-i*(u/l),n,i*(u/l),r*(l/u)];case 13:return[1-n-r*(l/u),t-i*(u/l),r*(l/u),i*(u/l)];case 14:return[1-t,1-n-r*(l/u),i*(u/l),r*(l/u)];case 15:return[n,1-t,r*(l/u),i*(u/l)];default:return[t,n,r,i]}},re(he,"_currentDrawId",-1),re(he,"_currentParent",null),A(he,cs,null),A(he,Ac,null),A(he,kc,null),A(he,To,NaN),A(he,Co,null),A(he,No,null),A(he,Tc,NaN),re(he,"_INNER_MARGIN",3);let gy=he;var Si,us,ds,Cc,qd,Ks,bs,mr,Nc,jc,Pc,Kd,b0;class H6{constructor(e,t,n,r,i,a){A(this,Kd);A(this,Si,new Float64Array(6));A(this,us);A(this,ds);A(this,Cc);A(this,qd);A(this,Ks);A(this,bs,"");A(this,mr,0);A(this,Nc,new tg);A(this,jc);A(this,Pc);_(this,jc,n),_(this,Pc,r),_(this,Cc,i),_(this,qd,a),[e,t]=k(this,Kd,b0).call(this,e,t);const o=_(this,us,[NaN,NaN,NaN,NaN,e,t]);_(this,Ks,[e,t]),_(this,ds,[{line:o,points:d(this,Ks)}]),d(this,Si).set(o,0)}updateProperty(e,t){e==="stroke-width"&&_(this,qd,t)}isEmpty(){return!d(this,ds)||d(this,ds).length===0}isCancellable(){return d(this,Ks).length<=10}add(e,t){[e,t]=k(this,Kd,b0).call(this,e,t);const[n,r,i,a]=d(this,Si).subarray(2,6),o=e-i,l=t-a;return Math.hypot(d(this,jc)*o,d(this,Pc)*l)<=2?null:(d(this,Ks).push(e,t),isNaN(n)?(d(this,Si).set([i,a,e,t],2),d(this,us).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(d(this,Si)[0])&&d(this,us).splice(6,6),d(this,Si).set([n,r,i,a,e,t],0),d(this,us).push(...ce.createBezierPoints(n,r,i,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(d(this,Ks).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,i){_(this,jc,n),_(this,Pc,r),_(this,Cc,i),[e,t]=k(this,Kd,b0).call(this,e,t);const a=_(this,us,[NaN,NaN,NaN,NaN,e,t]);_(this,Ks,[e,t]);const o=d(this,ds).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),d(this,ds).push({line:a,points:d(this,Ks)}),d(this,Si).set(a,0),_(this,mr,0),this.toSVGPath(),null}getLastElement(){return d(this,ds).at(-1)}setLastElement(e){return d(this,ds)?(d(this,ds).push(e),_(this,us,e.line),_(this,Ks,e.points),_(this,mr,0),{path:{d:this.toSVGPath()}}):d(this,Nc).setLastElement(e)}removeLastElement(){if(!d(this,ds))return d(this,Nc).removeLastElement();d(this,ds).pop(),_(this,bs,"");for(let e=0,t=d(this,ds).length;e<t;e++){const{line:n,points:r}=d(this,ds)[e];_(this,us,n),_(this,Ks,r),_(this,mr,0),this.toSVGPath()}return{path:{d:d(this,bs)}}}toSVGPath(){const e=ce.svgRound(d(this,us)[4]),t=ce.svgRound(d(this,us)[5]);if(d(this,Ks).length===2)return _(this,bs,`${d(this,bs)} M ${e} ${t} Z`),d(this,bs);if(d(this,Ks).length<=6){const r=d(this,bs).lastIndexOf("M");_(this,bs,`${d(this,bs).slice(0,r)} M ${e} ${t}`),_(this,mr,6)}if(d(this,Ks).length===4){const r=ce.svgRound(d(this,us)[10]),i=ce.svgRound(d(this,us)[11]);return _(this,bs,`${d(this,bs)} L ${r} ${i}`),_(this,mr,12),d(this,bs)}const n=[];d(this,mr)===0&&(n.push(`M ${e} ${t}`),_(this,mr,6));for(let r=d(this,mr),i=d(this,us).length;r<i;r+=6){const[a,o,l,u,h,f]=d(this,us).slice(r,r+6).map(ce.svgRound);n.push(`C${a} ${o} ${l} ${u} ${h} ${f}`)}return _(this,bs,d(this,bs)+n.join(" ")),_(this,mr,d(this,us).length),d(this,bs)}getOutlines(e,t,n,r){const i=d(this,ds).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),d(this,Nc).build(d(this,ds),e,t,n,d(this,Cc),d(this,qd),r),_(this,Si,null),_(this,us,null),_(this,ds,null),_(this,bs,null),d(this,Nc)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Si=new WeakMap,us=new WeakMap,ds=new WeakMap,Cc=new WeakMap,qd=new WeakMap,Ks=new WeakMap,bs=new WeakMap,mr=new WeakMap,Nc=new WeakMap,jc=new WeakMap,Pc=new WeakMap,Kd=new WeakSet,b0=function(e,t){return ce._normalizePoint(e,t,d(this,jc),d(this,Pc),d(this,Cc))};var Xs,jm,Pm,Hn,_i,Ei,Xd,Yd,Rc,As,Ui,gR,yR,vR;class tg extends ce{constructor(){super(...arguments);A(this,As);A(this,Xs);A(this,jm,0);A(this,Pm);A(this,Hn);A(this,_i);A(this,Ei);A(this,Xd);A(this,Yd);A(this,Rc)}build(t,n,r,i,a,o,l){_(this,_i,n),_(this,Ei,r),_(this,Xd,i),_(this,Yd,a),_(this,Rc,o),_(this,Pm,l??0),_(this,Hn,t),k(this,As,yR).call(this)}get thickness(){return d(this,Rc)}setLastElement(t){return d(this,Hn).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return d(this,Hn).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of d(this,Hn)){if(t.push(`M${ce.svgRound(n[4])} ${ce.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12&&isNaN(n[6])){t.push(`L${ce.svgRound(n[10])} ${ce.svgRound(n[11])}`);continue}for(let r=6,i=n.length;r<i;r+=6){const[a,o,l,u,h,f]=n.subarray(r,r+6).map(ce.svgRound);t.push(`C${a} ${o} ${l} ${u} ${h} ${f}`)}}return t.join("")}serialize([t,n,r,i],a){const o=[],l=[],[u,h,f,p]=k(this,As,gR).call(this);let m,g,y,b,v,x,w,E,T;switch(d(this,Yd)){case 0:T=ce._rescale,m=t,g=n+i,y=r,b=-i,v=t+u*r,x=n+(1-h-p)*i,w=t+(u+f)*r,E=n+(1-h)*i;break;case 90:T=ce._rescaleAndSwap,m=t,g=n,y=r,b=i,v=t+h*r,x=n+u*i,w=t+(h+p)*r,E=n+(u+f)*i;break;case 180:T=ce._rescale,m=t+r,g=n,y=-r,b=i,v=t+(1-u-f)*r,x=n+h*i,w=t+(1-u)*r,E=n+(h+p)*i;break;case 270:T=ce._rescaleAndSwap,m=t+r,g=n+i,y=-r,b=-i,v=t+(1-h-p)*r,x=n+(1-u-f)*i,w=t+(1-h)*r,E=n+(1-u)*i;break}for(const{line:C,points:N}of d(this,Hn))o.push(T(C,m,g,y,b,a?new Array(C.length):null)),l.push(T(N,m,g,y,b,a?new Array(N.length):null));return{lines:o,points:l,rect:[v,x,w,E]}}static deserialize(t,n,r,i,a,{paths:{lines:o,points:l},rotation:u,thickness:h}){const f=[];let p,m,g,y,b;switch(u){case 0:b=ce._rescale,p=-t/r,m=n/i+1,g=1/r,y=-1/i;break;case 90:b=ce._rescaleAndSwap,p=-n/i,m=-t/r,g=1/i,y=1/r;break;case 180:b=ce._rescale,p=t/r+1,m=-n/i,g=-1/r,y=1/i;break;case 270:b=ce._rescaleAndSwap,p=n/i+1,m=t/r+1,g=-1/i,y=-1/r;break}if(!o){o=[];for(const x of l){const w=x.length;if(w===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1]]));continue}if(w===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1],NaN,NaN,NaN,NaN,x[2],x[3]]));continue}const E=new Float32Array(3*(w-2));o.push(E);let[T,C,N,j]=x.subarray(0,4);E.set([NaN,NaN,NaN,NaN,T,C],0);for(let R=4;R<w;R+=2){const D=x[R],z=x[R+1];E.set(ce.createBezierPoints(T,C,N,j,D,z),(R-2)*3),[T,C,N,j]=[N,j,D,z]}}}for(let x=0,w=o.length;x<w;x++)f.push({line:b(o[x].map(E=>E??NaN),p,m,g,y),points:b(l[x].map(E=>E??NaN),p,m,g,y)});const v=new this.prototype.constructor;return v.build(f,r,i,1,u,h,a),v}get box(){return d(this,Xs)}updateProperty(t,n){return t==="stroke-width"?k(this,As,vR).call(this,n):null}updateParentDimensions([t,n],r){const[i,a]=k(this,As,Ui).call(this);_(this,_i,t),_(this,Ei,n),_(this,Xd,r);const[o,l]=k(this,As,Ui).call(this),u=o-i,h=l-a,f=d(this,Xs);return f[0]-=u,f[1]-=h,f[2]+=2*u,f[3]+=2*h,f}updateRotation(t){return _(this,jm,t),{path:{transform:this.rotationTransform}}}get viewBox(){return d(this,Xs).map(ce.svgRound).join(" ")}get defaultProperties(){const[t,n]=d(this,Xs);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=d(this,Xs);let r=0,i=0,a=0,o=0,l=0,u=0;switch(d(this,jm)){case 90:i=n/t,a=-t/n,l=t;break;case 180:r=-1,o=-1,l=t,u=n;break;case 270:i=-n/t,a=t/n,u=n;break;default:return""}return`matrix(${r} ${i} ${a} ${o} ${ce.svgRound(l)} ${ce.svgRound(u)})`}getPathResizingSVGProperties([t,n,r,i]){const[a,o]=k(this,As,Ui).call(this),[l,u,h,f]=d(this,Xs);if(Math.abs(h-a)<=ce.PRECISION||Math.abs(f-o)<=ce.PRECISION){const b=t+r/2-(l+h/2),v=n+i/2-(u+f/2);return{path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`,transform:`${this.rotationTransform} translate(${b} ${v})`}}}const p=(r-2*a)/(h-2*a),m=(i-2*o)/(f-2*o),g=h/r,y=f/i;return{path:{"transform-origin":`${ce.svgRound(l)} ${ce.svgRound(u)}`,transform:`${this.rotationTransform} scale(${g} ${y}) translate(${ce.svgRound(a)} ${ce.svgRound(o)}) scale(${p} ${m}) translate(${ce.svgRound(-a)} ${ce.svgRound(-o)})`}}}getPathResizedSVGProperties([t,n,r,i]){const[a,o]=k(this,As,Ui).call(this),l=d(this,Xs),[u,h,f,p]=l;if(l[0]=t,l[1]=n,l[2]=r,l[3]=i,Math.abs(f-a)<=ce.PRECISION||Math.abs(p-o)<=ce.PRECISION){const v=t+r/2-(u+f/2),x=n+i/2-(h+p/2);for(const{line:w,points:E}of d(this,Hn))ce._translate(w,v,x,w),ce._translate(E,v,x,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(r-2*a)/(f-2*a),g=(i-2*o)/(p-2*o),y=-m*(u+a)+t+a,b=-g*(h+o)+n+o;if(m!==1||g!==1||y!==0||b!==0)for(const{line:v,points:x}of d(this,Hn))ce._rescale(v,y,b,m,g,v),ce._rescale(x,y,b,m,g,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],r){const[i,a]=r,o=d(this,Xs),l=t-o[0],u=n-o[1];if(d(this,_i)===i&&d(this,Ei)===a)for(const{line:h,points:f}of d(this,Hn))ce._translate(h,l,u,h),ce._translate(f,l,u,f);else{const h=d(this,_i)/i,f=d(this,Ei)/a;_(this,_i,i),_(this,Ei,a);for(const{line:p,points:m}of d(this,Hn))ce._rescale(p,l,u,h,f,p),ce._rescale(m,l,u,h,f,m);o[2]*=h,o[3]*=f}return o[0]=t,o[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${ce.svgRound(t)} ${ce.svgRound(n)}`}}}get defaultSVGProperties(){const t=d(this,Xs);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${ce.svgRound(t[0])} ${ce.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}Xs=new WeakMap,jm=new WeakMap,Pm=new WeakMap,Hn=new WeakMap,_i=new WeakMap,Ei=new WeakMap,Xd=new WeakMap,Yd=new WeakMap,Rc=new WeakMap,As=new WeakSet,Ui=function(t=d(this,Rc)){const n=d(this,Pm)+t/2*d(this,Xd);return d(this,Yd)%180===0?[n/d(this,_i),n/d(this,Ei)]:[n/d(this,Ei),n/d(this,_i)]},gR=function(){const[t,n,r,i]=d(this,Xs),[a,o]=k(this,As,Ui).call(this,0);return[t+a,n+o,r-2*a,i-2*o]},yR=function(){const t=_(this,Xs,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of d(this,Hn)){if(i.length<=12){for(let l=4,u=i.length;l<u;l+=6)xe.pointBoundingBox(i[l],i[l+1],t);continue}let a=i[4],o=i[5];for(let l=6,u=i.length;l<u;l+=6){const[h,f,p,m,g,y]=i.subarray(l,l+6);xe.bezierBoundingBox(a,o,h,f,p,m,g,y,t),a=g,o=y}}const[n,r]=k(this,As,Ui).call(this);t[0]=Us(t[0]-n,0,1),t[1]=Us(t[1]-r,0,1),t[2]=Us(t[2]+n,0,1),t[3]=Us(t[3]+r,0,1),t[2]-=t[0],t[3]-=t[1]},vR=function(t){const[n,r]=k(this,As,Ui).call(this);_(this,Rc,t);const[i,a]=k(this,As,Ui).call(this),[o,l]=[i-n,a-r],u=d(this,Xs);return u[0]-=o,u[1]-=l,u[2]+=2*o,u[3]+=2*l,u};class Sv extends pR{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:yt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Sv(this._viewParameters);return e.updateAll(this),e}}var Iy,xR;const Uu=class Uu extends gy{constructor(t){super({...t,name:"inkEditor"});A(this,Iy);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,n){yt.initialize(t,n),this._defaultDrawingOptions=new Sv(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ve(this,"typesMap",new Map([[We.INK_THICKNESS,"stroke-width"],[We.INK_COLOR,"stroke"],[We.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,r,i,a){return new H6(t,n,r,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,r,i,a,o){return tg.deserialize(t,n,r,i,a,o)}static async deserialize(t,n,r){let i=null;if(t instanceof Y_){const{data:{inkLists:o,rect:l,rotation:u,id:h,color:f,opacity:p,borderStyle:{rawWidth:m},popupRef:g},parent:{page:{pageNumber:y}}}=t;i=t={annotationType:je.INK,color:Array.from(f),thickness:m,opacity:p,paths:{points:o},boxes:null,pageIndex:y-1,rect:l.slice(0),rotation:u,annotationElementId:h,id:h,deleted:!1,popupRef:g}}const a=await super.deserialize(t,n,r);return a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:r}=this;n.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:r}){this._drawingOptions=Uu.getDefaultDrawingOptions({stroke:xe.makeHexColor(...t),"stroke-width":n,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,u={annotationType:je.INK,color:yt._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:n,points:r},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(u.isCopy=!0,u):this.annotationElementId&&!k(this,Iy,xR).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:n,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:n}),null}};Iy=new WeakSet,xR=function(t){const{color:n,thickness:r,opacity:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==n[l])||t.thickness!==r||t.opacity!==i||t.pageIndex!==a},re(Uu,"_type","ink"),re(Uu,"_editorType",je.INK),re(Uu,"_defaultDrawingOptions",null);let eS=Uu;class tS extends tg{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Og=8,Oh=3;var Lc,tt,sS,Ur,wR,bR,nS,S0,SR,_R,ER,rS,iS,AR;class ji{static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},i,a,o,l){let u=new OffscreenCanvas(1,1),h=u.getContext("2d",{alpha:!1});const f=200,p=h.font=`${n} ${r} ${f}px ${t}`,{actualBoundingBoxLeft:m,actualBoundingBoxRight:g,actualBoundingBoxAscent:y,actualBoundingBoxDescent:b,fontBoundingBoxAscent:v,fontBoundingBoxDescent:x,width:w}=h.measureText(e),E=1.5,T=Math.ceil(Math.max(Math.abs(m)+Math.abs(g)||0,w)*E),C=Math.ceil(Math.max(Math.abs(y)+Math.abs(b)||f,Math.abs(v)+Math.abs(x)||f)*E);u=new OffscreenCanvas(T,C),h=u.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=p,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,T,C),h.fillStyle="black",h.fillText(e,T*(E-1)/2,C*(3-E)/2);const N=k(this,tt,rS).call(this,h.getImageData(0,0,T,C).data),j=k(this,tt,ER).call(this,N),R=k(this,tt,iS).call(this,j),D=k(this,tt,nS).call(this,N,T,C,R);return this.processDrawnLines({lines:{curves:D,width:T,height:C},pageWidth:i,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,i){const[a,o,l]=k(this,tt,AR).call(this,e),[u,h]=k(this,tt,_R).call(this,a,o,l,Math.hypot(o,l)*d(this,Lc).sigmaSFactor,d(this,Lc).sigmaR,d(this,Lc).kernelSize),f=k(this,tt,iS).call(this,h),p=k(this,tt,nS).call(this,u,o,l,f);return this.processDrawnLines({lines:{curves:p,width:o,height:l},pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:a,areContours:o}){r%180!==0&&([t,n]=[n,t]);const{curves:l,width:u,height:h}=e,f=e.thickness??0,p=[],m=Math.min(t/u,n/h),g=m/t,y=m/n,b=[];for(const{points:x}of l){const w=a?k(this,tt,SR).call(this,x):x;if(!w)continue;b.push(w);const E=w.length,T=new Float32Array(E),C=new Float32Array(3*(E===2?2:E-2));if(p.push({line:C,points:T}),E===2){T[0]=w[0]*g,T[1]=w[1]*y,C.set([NaN,NaN,NaN,NaN,T[0],T[1]],0);continue}let[N,j,R,D]=w;N*=g,j*=y,R*=g,D*=y,T.set([N,j,R,D],0),C.set([NaN,NaN,NaN,NaN,N,j],0);for(let z=4;z<E;z+=2){const L=T[z]=w[z]*g,I=T[z+1]=w[z+1]*y;C.set(ce.createBezierPoints(N,j,R,D,L,I),(z-2)*3),[N,j,R,D]=[R,D,L,I]}}if(p.length===0)return null;const v=o?new tS:new tg;return v.build(p,t,n,1,r,o?0:f,i),{outline:v,newCurves:b,areContours:o,thickness:f,width:u,height:h}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:i}){let a=1/0,o=-1/0,l=0;for(const w of e){l+=w.length;for(let E=2,T=w.length;E<T;E++){const C=w[E]-w[E-2];a=Math.min(a,C),o=Math.max(o,C)}}let u;a>=-128&&o<=127?u=Int8Array:a>=-32768&&o<=32767?u=Int16Array:u=Int32Array;const h=e.length,f=Og+Oh*h,p=new Uint32Array(f);let m=0;p[m++]=f*Uint32Array.BYTES_PER_ELEMENT+(l-2*h)*u.BYTES_PER_ELEMENT,p[m++]=0,p[m++]=r,p[m++]=i,p[m++]=t?0:1,p[m++]=Math.max(0,Math.floor(n??0)),p[m++]=h,p[m++]=u.BYTES_PER_ELEMENT;for(const w of e)p[m++]=w.length-2,p[m++]=w[0],p[m++]=w[1];const g=new CompressionStream("deflate-raw"),y=g.writable.getWriter();await y.ready,y.write(p);const b=u.prototype.constructor;for(const w of e){const E=new b(w.length-2);for(let T=2,C=w.length;T<C;T++)E[T-2]=w[T]-w[T-2];y.write(E)}y.close();const v=await new Response(g.readable).arrayBuffer(),x=new Uint8Array(v);return Sj(x)}static async decompressSignature(e){try{const t=vB(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),i=r.getWriter();await i.ready,i.write(t).then(async()=>{await i.ready,await i.close()}).catch(()=>{});let a=null,o=0;for await(const w of n)a||(a=new Uint8Array(new Uint32Array(w.buffer,0,4)[0])),a.set(w,o),o+=w.length;const l=new Uint32Array(a.buffer,0,a.length>>2),u=l[1];if(u!==0)throw new Error(`Invalid version: ${u}`);const h=l[2],f=l[3],p=l[4]===0,m=l[5],g=l[6],y=l[7],b=[],v=(Og+Oh*g)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(y){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(a.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(a.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(a.buffer,v);break}o=0;for(let w=0;w<g;w++){const E=l[Oh*w+Og],T=new Float32Array(E+2);b.push(T);for(let C=0;C<Oh-1;C++)T[C]=l[Oh*w+Og+C+1];for(let C=0;C<E;C++)T[C+2]=T[C]+x[o++]}return{areContours:p,thickness:m,outlines:b,width:h,height:f}}catch(t){return Le(`decompressSignature: ${t}`),null}}}Lc=new WeakMap,tt=new WeakSet,sS=function(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r},Ur=new WeakMap,wR=function(e,t,n,r,i,a,o){const l=k(this,tt,sS).call(this,n,r,i,a);for(let u=0;u<8;u++){const h=(-u+l-o+16)%8,f=d(this,Ur)[2*h],p=d(this,Ur)[2*h+1];if(e[(n+f)*t+(r+p)]!==0)return h}return-1},bR=function(e,t,n,r,i,a,o){const l=k(this,tt,sS).call(this,n,r,i,a);for(let u=0;u<8;u++){const h=(u+l+o+16)%8,f=d(this,Ur)[2*h],p=d(this,Ur)[2*h+1];if(e[(n+f)*t+(r+p)]!==0)return h}return-1},nS=function(e,t,n,r){const i=e.length,a=new Int32Array(i);for(let h=0;h<i;h++)a[h]=e[h]<=r?1:0;for(let h=1;h<n-1;h++)a[h*t]=a[h*t+t-1]=0;for(let h=0;h<t;h++)a[h]=a[t*n-1-h]=0;let o=1,l;const u=[];for(let h=1;h<n-1;h++){l=1;for(let f=1;f<t-1;f++){const p=h*t+f,m=a[p];if(m===0)continue;let g=h,y=f;if(m===1&&a[p-1]===0)o+=1,y-=1;else if(m>=1&&a[p+1]===0)o+=1,y+=1,m>1&&(l=m);else{m!==1&&(l=Math.abs(m));continue}const b=[f,h],v=y===f+1,x={isHole:v,points:b,id:o,parent:0};u.push(x);let w;for(const z of u)if(z.id===l){w=z;break}w?w.isHole?x.parent=v?w.parent:l:x.parent=v?l:w.parent:x.parent=v?l:0;const E=k(this,tt,wR).call(this,a,t,h,f,g,y,0);if(E===-1){a[p]=-o,a[p]!==1&&(l=Math.abs(a[p]));continue}let T=d(this,Ur)[2*E],C=d(this,Ur)[2*E+1];const N=h+T,j=f+C;g=N,y=j;let R=h,D=f;for(;;){const z=k(this,tt,bR).call(this,a,t,R,D,g,y,1);T=d(this,Ur)[2*z],C=d(this,Ur)[2*z+1];const L=R+T,I=D+C;b.push(I,L);const O=R*t+D;if(a[O+1]===0?a[O]=-o:a[O]===1&&(a[O]=o),L===h&&I===f&&R===N&&D===j){a[p]!==1&&(l=Math.abs(a[p]));break}else g=R,y=D,R=L,D=I}}}return u},S0=function(e,t,n,r){if(n-t<=4){for(let N=t;N<n-2;N+=2)r.push(e[N],e[N+1]);return}const i=e[t],a=e[t+1],o=e[n-4]-i,l=e[n-3]-a,u=Math.hypot(o,l),h=o/u,f=l/u,p=h*a-f*i,m=l/o,g=1/u,y=Math.atan(m),b=Math.cos(y),v=Math.sin(y),x=g*(Math.abs(b)+Math.abs(v)),w=g*(1-x+x**2),E=Math.max(Math.atan(Math.abs(v+b)*w),Math.atan(Math.abs(v-b)*w));let T=0,C=t;for(let N=t+2;N<n-2;N+=2){const j=Math.abs(p-h*e[N+1]+f*e[N]);j>T&&(C=N,T=j)}T>(u*E)**2?(k(this,tt,S0).call(this,e,t,C+2,r),k(this,tt,S0).call(this,e,C,n,r)):r.push(i,a)},SR=function(e){const t=[],n=e.length;return k(this,tt,S0).call(this,e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t},_R=function(e,t,n,r,i,a){const o=new Float32Array(a**2),l=-2*r**2,u=a>>1;for(let y=0;y<a;y++){const b=(y-u)**2;for(let v=0;v<a;v++)o[y*a+v]=Math.exp((b+(v-u)**2)/l)}const h=new Float32Array(256),f=-2*i**2;for(let y=0;y<256;y++)h[y]=Math.exp(y**2/f);const p=e.length,m=new Uint8Array(p),g=new Uint32Array(256);for(let y=0;y<n;y++)for(let b=0;b<t;b++){const v=y*t+b,x=e[v];let w=0,E=0;for(let C=0;C<a;C++){const N=y+C-u;if(!(N<0||N>=n))for(let j=0;j<a;j++){const R=b+j-u;if(R<0||R>=t)continue;const D=e[N*t+R],z=o[C*a+j]*h[Math.abs(D-x)];w+=D*z,E+=z}}const T=m[v]=Math.round(w/E);g[T]++}return[m,g]},ER=function(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t},rS=function(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,i=1/0;for(let o=0,l=n.length;o<l;o++){if(e[(o<<2)+3]===0){r=n[o]=255;continue}const h=n[o]=e[o<<2];h>r&&(r=h),h<i&&(i=h)}const a=255/(r-i);for(let o=0;o<t;o++)n[o]=(n[o]-i)*a;return n},iS=function(e){let t,n=-1/0,r=-1/0;const i=e.findIndex(l=>l!==0);let a=i,o=i;for(t=i;t<256;t++){const l=e[t];l>n&&(t-a>r&&(r=t-a,o=t-1),n=l,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},AR=function(e){const t=e,{width:n,height:r}=e,{maxDim:i}=d(this,Lc);let a=n,o=r;if(n>i||r>i){let p=n,m=r,g=Math.log2(Math.max(n,r)/i);const y=Math.floor(g);g=g===y?y-1:y;for(let v=0;v<g;v++){a=Math.ceil(p/2),o=Math.ceil(m/2);const x=new OffscreenCanvas(a,o);x.getContext("2d").drawImage(e,0,0,p,m,0,0,a,o),p=a,m=o,e!==t&&e.close(),e=x.transferToImageBitmap()}const b=Math.min(i/a,i/o);a=Math.round(a*b),o=Math.round(o*b)}const u=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});u.filter="grayscale(1)",u.drawImage(e,0,0,e.width,e.height,0,0,a,o);const h=u.getImageData(0,0,a,o).data;return[k(this,tt,rS).call(this,h),a,o]},A(ji,tt),A(ji,Lc,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),A(ji,Ur,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Q_ extends pR{constructor(){super(),super.updateProperties({fill:yt._defaultLineColor,"stroke-width":0})}clone(){const e=new Q_;return e.updateAll(this),e}}class Z_ extends Sv{constructor(e){super(e),super.updateProperties({stroke:yt._defaultLineColor,"stroke-width":1})}clone(){const e=new Z_(this._viewParameters);return e.updateAll(this),e}}var jo,Ai,Po,Dc;const jn=class jn extends gy{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});A(this,jo,!1);A(this,Ai,null);A(this,Po,null);A(this,Dc,null);this._willKeepAspectRatio=!0,_(this,Po,t.signatureData||null),_(this,Ai,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,n){yt.initialize(t,n),this._defaultDrawingOptions=new Q_,this._defaultDrawnSignatureOptions=new Z_(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return Ve(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!d(this,Ai)}}static computeTelemetryFinalData(t){const n=t.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n;const{_isCopy:r}=this;if(r&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(d(this,Po)){const{lines:i,mustSmooth:a,areContours:o,description:l,uuid:u,heightInPage:h}=d(this,Po),{rawDims:{pageWidth:f,pageHeight:p},rotation:m}=this.parent.viewport,g=ji.processDrawnLines({lines:i,pageWidth:f,pageHeight:p,rotation:m,innerMargin:jn._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(g,h,l,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return r&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(t){_(this,Dc,t),this.addEditToolbar()}getUuid(){return d(this,Dc)}get description(){return d(this,Ai)}set description(t){_(this,Ai,t),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:n,thickness:r,width:i,height:a}=d(this,Po),o=Math.max(i,a),l=ji.processDrawnLines({lines:{curves:t.map(u=>({points:u})),thickness:r,width:i,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,r,i){const{x:a,y:o}=this,{outline:l}=_(this,Po,t);_(this,jo,l instanceof tS),this.description=r,this.div.setAttribute("data-l10n-args",JSON.stringify({description:r}));let u;d(this,jo)?u=jn.getDefaultDrawingOptions():(u=jn._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:u});const[h,f]=this.parentDimensions,[,p]=this.pageDimensions;let m=n/p;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(h*this.width,f*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return ji.process(t,n,r,i,jn._INNER_MARGIN)}getFromText(t,n){const{rawDims:{pageWidth:r,pageHeight:i},rotation:a}=this.parent.viewport;return ji.extractContoursFromText(t,n,r,i,a,jn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return ji.processDrawnLines({lines:t,pageWidth:n,pageHeight:r,rotation:i,innerMargin:jn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=jn.getDefaultDrawingOptions():(this._drawingOptions=jn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:n,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:je.SIGNATURE,isSignature:!0,areContours:d(this,jo),color:[0,0,0],thickness:d(this,jo)?0:a,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.paths={lines:n,points:r},o.uuid=d(this,Dc),o.isCopy=!0):o.lines=n,d(this,Ai)&&(o.accessibilityData={type:"Figure",alt:d(this,Ai)}),o}static deserializeDraw(t,n,r,i,a,o){return o.areContours?tS.deserialize(t,n,r,i,a,o):tg.deserialize(t,n,r,i,a,o)}static async deserialize(t,n,r){var a;const i=await super.deserialize(t,n,r);return _(i,jo,t.areContours),_(i,Ai,((a=t.accessibilityData)==null?void 0:a.alt)||""),_(i,Dc,t.uuid),i}};jo=new WeakMap,Ai=new WeakMap,Po=new WeakMap,Dc=new WeakMap,re(jn,"_type","signature"),re(jn,"_editorType",je.SIGNATURE),re(jn,"_defaultDrawingOptions",null);let aS=jn;var Et,hs,Ro,ya,Lo,Jd,va,Mc,ki,Vn,Qd,Ye,uf,df,_0,E0,A0,lS,k0,kR;class oS extends yt{constructor(t){super({...t,name:"stampEditor"});A(this,Ye);A(this,Et,null);A(this,hs,null);A(this,Ro,null);A(this,ya,null);A(this,Lo,null);A(this,Jd,"");A(this,va,null);A(this,Mc,!1);A(this,ki,null);A(this,Vn,!1);A(this,Qd,!1);_(this,ya,t.bitmapUrl),_(this,Lo,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,n){yt.initialize(t,n)}static isHandlingMimeForPasting(t){return hy.includes(t)}static paste(t,n){n.pasteEditor({mode:je.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await r.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),n&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;d(this,hs)&&(_(this,Et,null),this._uiManager.imageManager.deleteId(d(this,hs)),(t=d(this,va))==null||t.remove(),_(this,va,null),d(this,ki)&&(clearTimeout(d(this,ki)),_(this,ki,null))),super.remove()}rebuild(){if(!this.parent){d(this,hs)&&k(this,Ye,_0).call(this);return}super.rebuild(),this.div!==null&&(d(this,hs)&&d(this,va)===null&&k(this,Ye,_0).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(d(this,Ro)||d(this,Et)||d(this,ya)||d(this,Lo)||d(this,hs)||d(this,Mc))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;return this._isCopy&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),d(this,Mc)||(d(this,Et)?k(this,Ye,E0).call(this):k(this,Ye,_0).call(this)),this._isCopy&&this._moveAfterPaste(t,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,n){const{id:r,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,n);n.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(_(this,hs,r),i&&_(this,Et,i),_(this,Mc,!1),k(this,Ye,E0).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;d(this,ki)!==null&&clearTimeout(d(this,ki)),_(this,ki,setTimeout(()=>{_(this,ki,null),k(this,Ye,lS).call(this)},200))}copyCanvas(t,n,r=!1){var m;t||(t=224);const{width:i,height:a}=d(this,Et),o=new Jr;let l=d(this,Et),u=i,h=a,f=null;if(n){if(i>n||a>n){const j=Math.min(n/i,n/a);u=Math.floor(i*j),h=Math.floor(a*j)}f=document.createElement("canvas");const g=f.width=Math.ceil(u*o.sx),y=f.height=Math.ceil(h*o.sy);d(this,Vn)||(l=k(this,Ye,A0).call(this,g,y));const b=f.getContext("2d");b.filter=this._uiManager.hcmFilter;let v="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(v="#8f8f9d",x="#42414d");const w=15,E=w*o.sx,T=w*o.sy,C=new OffscreenCanvas(E*2,T*2),N=C.getContext("2d");N.fillStyle=v,N.fillRect(0,0,E*2,T*2),N.fillStyle=x,N.fillRect(0,0,E,T),N.fillRect(E,T,E,T),b.fillStyle=b.createPattern(C,"repeat"),b.fillRect(0,0,g,y),b.drawImage(l,0,0,l.width,l.height,0,0,g,y)}let p=null;if(r){let g,y;if(o.symmetric&&l.width<t&&l.height<t)g=l.width,y=l.height;else if(l=d(this,Et),i>t||a>t){const x=Math.min(t/i,t/a);g=Math.floor(i*x),y=Math.floor(a*x),d(this,Vn)||(l=k(this,Ye,A0).call(this,g,y))}const v=new OffscreenCanvas(g,y).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,g,y),p={width:g,height:y,data:v.getImageData(0,0,g,y).data}}return{canvas:f,width:u,height:h,imageData:p}}static async deserialize(t,n,r){var b;let i=null,a=!1;if(t instanceof BP){const{data:{rect:v,rotation:x,id:w,structParent:E,popupRef:T},container:C,parent:{page:{pageNumber:N}},canvas:j}=t;let R,D;j?(delete t.canvas,{id:R,bitmap:D}=r.imageManager.getFromCanvas(C.id,j),j.remove()):(a=!0,t._hasNoCanvas=!0);const z=((b=await n._structTree.getAriaAttributes(`${H_}${w}`))==null?void 0:b.get("aria-label"))||"";i=t={annotationType:je.STAMP,bitmapId:R,bitmap:D,pageIndex:N-1,rect:v.slice(0),rotation:x,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:z},isSvg:!1,structParent:E,popupRef:T}}const o=await super.deserialize(t,n,r),{rect:l,bitmap:u,bitmapUrl:h,bitmapId:f,isSvg:p,accessibilityData:m}=t;a?(r.addMissingCanvas(t.id,o),_(o,Mc,!0)):f&&r.imageManager.isValidId(f)?(_(o,hs,f),u&&_(o,Et,u)):_(o,ya,h),_(o,Vn,p);const[g,y]=o.pageDimensions;return o.width=(l[2]-l[0])/g,o.height=(l[3]-l[1])/y,m&&(o.altTextData=m),o._initialData=i,_(o,Qd,!!i),o}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:je.STAMP,bitmapId:d(this,hs),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:d(this,Vn),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=k(this,Ye,k0).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=k(this,Ye,kR).call(this,r);if(l.isSame)return null;l.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,n===null)return r;n.stamps||(n.stamps=new Map);const o=d(this,Vn)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!n.stamps.has(d(this,hs)))n.stamps.set(d(this,hs),{area:o,serialized:r}),r.bitmap=k(this,Ye,k0).call(this,!1);else if(d(this,Vn)){const l=n.stamps.get(d(this,hs));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=k(this,Ye,k0).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}Et=new WeakMap,hs=new WeakMap,Ro=new WeakMap,ya=new WeakMap,Lo=new WeakMap,Jd=new WeakMap,va=new WeakMap,Mc=new WeakMap,ki=new WeakMap,Vn=new WeakMap,Qd=new WeakMap,Ye=new WeakSet,uf=function(t,n=!1){if(!t){this.remove();return}_(this,Et,t.bitmap),n||(_(this,hs,t.id),_(this,Vn,t.isSvg)),t.file&&_(this,Jd,t.file.name),k(this,Ye,E0).call(this)},df=function(){if(_(this,Ro,null),this._uiManager.enableWaiting(!1),!!d(this,va)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Et)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Et)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},_0=function(){if(d(this,hs)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(d(this,hs)).then(r=>k(this,Ye,uf).call(this,r,!0)).finally(()=>k(this,Ye,df).call(this));return}if(d(this,ya)){const r=d(this,ya);_(this,ya,null),this._uiManager.enableWaiting(!0),_(this,Ro,this._uiManager.imageManager.getFromUrl(r).then(i=>k(this,Ye,uf).call(this,i)).finally(()=>k(this,Ye,df).call(this)));return}if(d(this,Lo)){const r=d(this,Lo);_(this,Lo,null),this._uiManager.enableWaiting(!0),_(this,Ro,this._uiManager.imageManager.getFromFile(r).then(i=>k(this,Ye,uf).call(this,i)).finally(()=>k(this,Ye,df).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=hy.join(",");const n=this._uiManager._signal;_(this,Ro,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),k(this,Ye,uf).call(this,i)}r()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:n})}).finally(()=>k(this,Ye,df).call(this))),t.click()},E0=function(){var f;const{div:t}=this;let{width:n,height:r}=d(this,Et);const[i,a]=this.pageDimensions,o=.75;if(this.width)n=this.width*i,r=this.height*a;else if(n>o*i||r>o*a){const p=Math.min(o*i/n,o*a/r);n*=p,r*=p}const[l,u]=this.parentDimensions;this.setDims(n*l/i,r*u/a),this._uiManager.enableWaiting(!1);const h=_(this,va,document.createElement("canvas"));h.setAttribute("role","img"),this.addContainer(h),this.width=n/i,this.height=r/a,(f=this._initialOptions)!=null&&f.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),k(this,Ye,lS).call(this),d(this,Qd)||(this.parent.addUndoableEditor(this),_(this,Qd,!0)),this._reportTelemetry({action:"inserted_image"}),d(this,Jd)&&this.div.setAttribute("aria-description",d(this,Jd)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},A0=function(t,n){const{width:r,height:i}=d(this,Et);let a=r,o=i,l=d(this,Et);for(;a>2*t||o>2*n;){const u=a,h=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*n&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const f=new OffscreenCanvas(a,o);f.getContext("2d").drawImage(l,0,0,u,h,0,0,a,o),l=f.transferToImageBitmap()}return l},lS=function(){const[t,n]=this.parentDimensions,{width:r,height:i}=this,a=new Jr,o=Math.ceil(r*t*a.sx),l=Math.ceil(i*n*a.sy),u=d(this,va);if(!u||u.width===o&&u.height===l)return;u.width=o,u.height=l;const h=d(this,Vn)?d(this,Et):k(this,Ye,A0).call(this,o,l),f=u.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(h,0,0,h.width,h.height,0,0,o,l)},k0=function(t){if(t){if(d(this,Vn)){const i=this._uiManager.imageManager.getSvgUrl(d(this,hs));if(i)return i}const n=document.createElement("canvas");return{width:n.width,height:n.height}=d(this,Et),n.getContext("2d").drawImage(d(this,Et),0,0),n.toDataURL()}if(d(this,Vn)){const[n,r]=this.pageDimensions,i=Math.round(this.width*n*Oa.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*Oa.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,a);return o.getContext("2d").drawImage(d(this,Et),0,0,d(this,Et).width,d(this,Et).height,0,0,i,a),o.transferToImageBitmap()}return structuredClone(d(this,Et))},kR=function(t){var o;const{pageIndex:n,accessibilityData:{altText:r}}=this._initialData,i=t.pageIndex===n,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},re(oS,"_type","stamp"),re(oS,"_editorType",je.STAMP);var Ic,Zd,Ti,Do,xa,zn,Mo,eh,Oc,Br,wa,fs,ba,Io,th,ye,Oo,At,TR,li,cS,uS,T0;const Nr=class Nr{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:i,annotationLayer:a,drawLayer:o,textLayer:l,viewport:u,l10n:h}){A(this,At);A(this,Ic);A(this,Zd,!1);A(this,Ti,null);A(this,Do,null);A(this,xa,null);A(this,zn,new Map);A(this,Mo,!1);A(this,eh,!1);A(this,Oc,!1);A(this,Br,null);A(this,wa,null);A(this,fs,null);A(this,ba,null);A(this,Io,null);A(this,th,-1);A(this,ye);const f=[...d(Nr,Oo).values()];if(!Nr._initialized){Nr._initialized=!0;for(const p of f)p.initialize(h,e)}e.registerEditorTypes(f),_(this,ye,e),this.pageIndex=t,this.div=n,_(this,Ic,i),_(this,Ti,a),this.viewport=u,_(this,fs,l),this.drawLayer=o,this._structTree=r,d(this,ye).addLayer(this)}get isEmpty(){return d(this,zn).size===0}get isInvisible(){return this.isEmpty&&d(this,ye).getMode()===je.NONE}updateToolbar(e){d(this,ye).updateToolbar(e)}updateMode(e=d(this,ye).getMode()){switch(k(this,At,T0).call(this),e){case je.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case je.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case je.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const n of d(Nr,Oo).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=d(this,fs))==null?void 0:t.div)}setEditingState(e){d(this,ye).setEditingState(e)}addCommands(e){d(this,ye).addCommands(e)}cleanUndoStack(e){d(this,ye).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=d(this,Ti))==null||t.div.classList.toggle("disabled",!e)}async enable(){var n;_(this,Oc,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),(n=d(this,Io))==null||n.abort(),_(this,Io,null);const e=new Set;for(const r of d(this,zn).values())r.enableEditing(),r.show(!0),r.annotationElementId&&(d(this,ye).removeChangedExistingAnnotation(r),e.add(r.annotationElementId));if(!d(this,Ti)){_(this,Oc,!1);return}const t=d(this,Ti).getEditableAnnotations();for(const r of t){if(r.hide(),d(this,ye).isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;const i=await this.deserialize(r);i&&(this.addOrRebuild(i),i.enableEditing())}_(this,Oc,!1)}disable(){var r;if(_(this,eh,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),d(this,fs)&&!d(this,Io)){_(this,Io,new AbortController);const i=d(this,ye).combinedSignal(d(this,Io));d(this,fs).div.addEventListener("pointerdown",a=>{const{clientX:l,clientY:u,timeStamp:h}=a,f=d(this,th);if(h-f>500){_(this,th,h);return}_(this,th,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const m=document.elementsFromPoint(l,u);if(p.toggle("getElements",!1),!this.div.contains(m[0]))return;let g;const y=new RegExp(`^${yj}[0-9]+$`);for(const v of m)if(y.test(v.id)){g=v.id;break}if(!g)return;const b=d(this,zn).get(g);(b==null?void 0:b.annotationElementId)===null&&(a.stopPropagation(),a.preventDefault(),b.dblclick())},{signal:i,capture:!0})}const e=new Map,t=new Map;for(const i of d(this,zn).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);(r=this.getEditableAnnotation(i.annotationElementId))==null||r.show(),i.remove()}if(d(this,Ti)){const i=d(this,Ti).getEditableAnnotations();for(const a of i){const{id:o}=a.data;if(d(this,ye).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(d(this,ye).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}k(this,At,T0).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const i of d(Nr,Oo).values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),_(this,eh,!1)}getEditableAnnotation(e){var t;return((t=d(this,Ti))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){d(this,ye).getActive()!==e&&d(this,ye).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=d(this,fs))!=null&&e.div&&!d(this,ba)){_(this,ba,new AbortController);const t=d(this,ye).combinedSignal(d(this,ba));d(this,fs).div.addEventListener("pointerdown",k(this,At,TR).bind(this),{signal:t}),d(this,fs).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=d(this,fs))!=null&&e.div&&d(this,ba)&&(d(this,ba).abort(),_(this,ba,null),d(this,fs).div.classList.remove("highlighting"))}enableClick(){if(d(this,Do))return;_(this,Do,new AbortController);const e=d(this,ye).combinedSignal(d(this,Do));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=d(this,Do))==null||e.abort(),_(this,Do,null)}attach(e){d(this,zn).set(e.id,e);const{annotationElementId:t}=e;t&&d(this,ye).isDeletedAnnotationElement(t)&&d(this,ye).removeDeletedAnnotationElement(e)}detach(e){var t;d(this,zn).delete(e.id),(t=d(this,Ic))==null||t.removePointerInTextLayer(e.contentDiv),!d(this,eh)&&e.annotationElementId&&d(this,ye).addDeletedAnnotationElement(e)}remove(e){this.detach(e),d(this,ye).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(d(this,ye).addDeletedAnnotationElement(e.annotationElementId),yt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),d(this,ye).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!d(this,Oc)),d(this,ye).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!d(this,xa)&&(e._focusEventsAllowed=!1,_(this,xa,setTimeout(()=>{_(this,xa,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:d(this,ye)._signal}),t.focus())},0))),e._structTreeParentId=(n=d(this,Ic))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return d(this,ye).getId()}combinedSignal(e){return d(this,ye).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=d(this,At,li))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await d(this,ye).updateMode(e.mode);const{offsetX:n,offsetY:r}=k(this,At,uS).call(this),i=this.getNextId(),a=k(this,At,cS).call(this,{parent:this,id:i,x:n,y:r,uiManager:d(this,ye),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=d(Nr,Oo).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,d(this,ye)))||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),i=k(this,At,cS).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:d(this,ye),isCentered:t,...n});return i&&this.add(i),i}addNewEditor(e={}){this.createAndAddNewEditor(k(this,At,uS).call(this),!0,e)}setSelected(e){d(this,ye).setSelected(e)}toggleSelected(e){d(this,ye).toggleSelected(e)}unselect(e){d(this,ye).unselect(e)}pointerup(e){var r;const{isMac:t}=gs.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!d(this,Mo)||(_(this,Mo,!1),(r=d(this,At,li))!=null&&r.isDrawer&&d(this,At,li).supportMultipleDrawings))return;if(!d(this,Zd)){_(this,Zd,!0);return}const n=d(this,ye).getMode();if(n===je.STAMP||n===je.SIGNATURE){d(this,ye).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var r;if(d(this,ye).getMode()===je.HIGHLIGHT&&this.enableTextSelection(),d(this,Mo)){_(this,Mo,!1);return}const{isMac:t}=gs.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(_(this,Mo,!0),(r=d(this,At,li))!=null&&r.isDrawer){this.startDrawingSession(e);return}const n=d(this,ye).getActive();_(this,Zd,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),d(this,Br)){d(this,At,li).startDrawing(this,d(this,ye),!1,e);return}d(this,ye).setCurrentDrawingSession(this),_(this,Br,new AbortController);const t=d(this,ye).combinedSignal(d(this,Br));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(_(this,wa,null),this.commitOrRemove())},{signal:t}),d(this,At,li).startDrawing(this,d(this,ye),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&_(this,wa,t);return}d(this,wa)&&setTimeout(()=>{var t;(t=d(this,wa))==null||t.focus(),_(this,wa,null)},0)}endDrawingSession(e=!1){return d(this,Br)?(d(this,ye).setCurrentDrawingSession(null),d(this,Br).abort(),_(this,Br,null),_(this,wa,null),d(this,At,li).endDrawing(e)):null}findNewParent(e,t,n){const r=d(this,ye).findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return d(this,Br)?(this.endDrawingSession(),!0):!1}onScaleChanging(){d(this,Br)&&d(this,At,li).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=d(this,ye).getActive())==null?void 0:e.parent)===this&&(d(this,ye).commitOrRemove(),d(this,ye).setActiveEditor(null)),d(this,xa)&&(clearTimeout(d(this,xa)),_(this,xa,null));for(const n of d(this,zn).values())(t=d(this,Ic))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,d(this,zn).clear(),d(this,ye).removeLayer(this)}render({viewport:e}){this.viewport=e,el(this.div,e);for(const t of d(this,ye).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){d(this,ye).commitOrRemove(),k(this,At,T0).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,el(this.div,{rotation:n}),t!==n)for(const r of d(this,zn).values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return d(this,ye).viewParameters.realScale}};Ic=new WeakMap,Zd=new WeakMap,Ti=new WeakMap,Do=new WeakMap,xa=new WeakMap,zn=new WeakMap,Mo=new WeakMap,eh=new WeakMap,Oc=new WeakMap,Br=new WeakMap,wa=new WeakMap,fs=new WeakMap,ba=new WeakMap,Io=new WeakMap,th=new WeakMap,ye=new WeakMap,Oo=new WeakMap,At=new WeakSet,TR=function(e){d(this,ye).unselectAll();const{target:t}=e;if(t===d(this,fs).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&d(this,fs).div.contains(t)){const{isMac:n}=gs.platform;if(e.button!==0||e.ctrlKey&&n)return;d(this,ye).showAllEditors("highlight",!0,!0),d(this,fs).div.classList.add("free"),this.toggleDrawing(),my.startHighlighting(this,d(this,ye).direction==="ltr",{target:d(this,fs).div,x:e.x,y:e.y}),d(this,fs).div.addEventListener("pointerup",()=>{d(this,fs).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:d(this,ye)._signal}),e.preventDefault()}},li=function(){return d(Nr,Oo).get(d(this,ye).getMode())},cS=function(e){const t=d(this,At,li);return t?new t.prototype.constructor(e):null},uS=function(){const{x:e,y:t,width:n,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+r),u=(i+o)/2-e,h=(a+l)/2-t,[f,p]=this.viewport.rotation%180===0?[u,h]:[h,u];return{offsetX:f,offsetY:p}},T0=function(){for(const e of d(this,zn).values())e.isEmpty()&&e.remove()},re(Nr,"_initialized",!1),A(Nr,Oo,new Map([Bb,eS,oS,my,aS].map(e=>[e._editorType,e])));let yy=Nr;var Hr,Ys,Fc,Rm,Oy,CR,Di,dS,NR,hS;const es=class es{constructor({pageIndex:e}){A(this,Di);A(this,Hr,null);A(this,Ys,new Map);A(this,Fc,new Map);this.pageIndex=e}setParent(e){if(!d(this,Hr)){_(this,Hr,e);return}if(d(this,Hr)!==e){if(d(this,Ys).size>0)for(const t of d(this,Ys).values())t.remove(),e.append(t);_(this,Hr,e)}}static get _svgFactory(){return Ve(this,"_svgFactory",new np)}draw(e,t=!1,n=!1){const r=Ws(es,Rm)._++,i=k(this,Di,dS).call(this),a=es._svgFactory.createElement("defs");i.append(a);const o=es._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&d(this,Fc).set(r,o);const u=n?k(this,Di,NR).call(this,a,l):null,h=es._svgFactory.createElement("use");return i.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(i,e),d(this,Ys).set(r,i),{id:r,clipPathId:`url(#${u})`}}drawOutline(e,t){const n=Ws(es,Rm)._++,r=k(this,Di,dS).call(this),i=es._svgFactory.createElement("defs");r.append(i);const a=es._svgFactory.createElement("path");i.append(a);const o=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const f=es._svgFactory.createElement("mask");i.append(f),l=`mask_p${this.pageIndex}_${n}`,f.setAttribute("id",l),f.setAttribute("maskUnits","objectBoundingBox");const p=es._svgFactory.createElement("rect");f.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const m=es._svgFactory.createElement("use");f.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const u=es._svgFactory.createElement("use");r.append(u),u.setAttribute("href",`#${o}`),l&&u.setAttribute("mask",`url(#${l})`);const h=u.cloneNode();return r.append(h),u.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(r,e),d(this,Ys).set(n,r),n}finalizeDraw(e,t){d(this,Fc).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:n,bbox:r,rootClass:i,path:a}=t,o=typeof e=="number"?d(this,Ys).get(e):e;if(o){if(n&&k(this,Di,hS).call(this,o,n),r&&k(l=es,Oy,CR).call(l,o,r),i){const{classList:u}=o;for(const[h,f]of Object.entries(i))u.toggle(h,f)}if(a){const h=o.firstChild.firstChild;k(this,Di,hS).call(this,h,a)}}}updateParent(e,t){if(t===this)return;const n=d(this,Ys).get(e);n&&(d(t,Hr).append(n),d(this,Ys).delete(e),d(t,Ys).set(e,n))}remove(e){d(this,Fc).delete(e),d(this,Hr)!==null&&(d(this,Ys).get(e).remove(),d(this,Ys).delete(e))}destroy(){_(this,Hr,null);for(const e of d(this,Ys).values())e.remove();d(this,Ys).clear(),d(this,Fc).clear()}};Hr=new WeakMap,Ys=new WeakMap,Fc=new WeakMap,Rm=new WeakMap,Oy=new WeakSet,CR=function(e,[t,n,r,i]){const{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*i}%`},Di=new WeakSet,dS=function(){const e=es._svgFactory.create(1,1,!0);return d(this,Hr).append(e),e.setAttribute("aria-hidden",!0),e},NR=function(e,t){const n=es._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const i=es._svgFactory.createElement("use");return n.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),r},hS=function(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)},A(es,Oy),A(es,Rm,0);let vy=es;globalThis._pdfjsTestingUtils={HighlightOutliner:Vb};globalThis.pdfjsLib={AbortException:Ia,AnnotationEditorLayer:yy,AnnotationEditorParamsType:We,AnnotationEditorType:je,AnnotationEditorUIManager:tl,AnnotationLayer:J_,AnnotationMode:Ni,AnnotationType:$t,build:NP,ColorPicker:rp,createValidAbsoluteUrl:$_,DOMSVGFactory:np,DrawLayer:vy,FeatureTest:gs,fetchData:bh,getDocument:q_,getFilenameFromUrl:_j,getPdfFilenameFromUrl:Ej,getUuid:B_,getXfaPageViewport:Aj,GlobalWorkerOptions:Gr,ImageKind:Cf,InvalidPDFException:dy,isDataScheme:Qm,isPdfFile:xv,isValidExplicitDest:iP,MathClamp:Us,noContextMenu:Ar,normalizeUnicode:bj,OPS:Qf,OutputScale:Jr,PasswordResponses:xj,PDFDataRangeTransport:K_,PDFDateString:wv,PDFWorker:fh,PermissionFlag:vj,PixelsPerInch:Oa,RenderingCancelledException:vv,ResponseException:Zf,setLayerDimensions:el,shadow:Ve,SignatureExtractor:ji,stopEvent:Ht,SupportedImageMimeTypes:hy,TextLayer:tp,TouchManager:ep,updateUrlHash:U_,Util:xe,VerbosityLevel:Xm,version:CP,XfaLayer:X_};const V6=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Ia,AnnotationEditorLayer:yy,AnnotationEditorParamsType:We,AnnotationEditorType:je,AnnotationEditorUIManager:tl,AnnotationLayer:J_,AnnotationMode:Ni,AnnotationType:$t,ColorPicker:rp,DOMSVGFactory:np,DrawLayer:vy,FeatureTest:gs,GlobalWorkerOptions:Gr,ImageKind:Cf,InvalidPDFException:dy,MathClamp:Us,OPS:Qf,OutputScale:Jr,PDFDataRangeTransport:K_,PDFDateString:wv,PDFWorker:fh,PasswordResponses:xj,PermissionFlag:vj,PixelsPerInch:Oa,RenderingCancelledException:vv,ResponseException:Zf,SignatureExtractor:ji,SupportedImageMimeTypes:hy,TextLayer:tp,TouchManager:ep,Util:xe,VerbosityLevel:Xm,XfaLayer:X_,build:NP,createValidAbsoluteUrl:$_,fetchData:bh,getDocument:q_,getFilenameFromUrl:_j,getPdfFilenameFromUrl:Ej,getUuid:B_,getXfaPageViewport:Aj,isDataScheme:Qm,isPdfFile:xv,isValidExplicitDest:iP,noContextMenu:Ar,normalizeUnicode:bj,setLayerDimensions:el,shadow:Ve,stopEvent:Ht,updateUrlHash:U_,version:CP},Symbol.toStringTag,{value:"Module"}));function jR(s){var e,t,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(e=0;e<r;e++)s[e]&&(t=jR(s[e]))&&(n&&(n+=" "),n+=t)}else for(t in s)s[t]&&(n&&(n+=" "),n+=t);return n}function _v(){for(var s,e,t=0,n="",r=arguments.length;t<r;t++)(s=arguments[t])&&(e=jR(s))&&(n&&(n+=" "),n+=e);return n}var Ek=Object.prototype.hasOwnProperty;function Ak(s,e,t){for(t of s.keys())if(Ku(t,e))return t}function Ku(s,e){var t,n,r;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((n=s.length)===e.length)for(;n--&&Ku(s[n],e[n]););return n===-1}if(t===Set){if(s.size!==e.size)return!1;for(n of s)if(r=n,r&&typeof r=="object"&&(r=Ak(e,r),!r)||!e.has(r))return!1;return!0}if(t===Map){if(s.size!==e.size)return!1;for(n of s)if(r=n[0],r&&typeof r=="object"&&(r=Ak(e,r),!r)||!Ku(n[1],e.get(r)))return!1;return!0}if(t===ArrayBuffer)s=new Uint8Array(s),e=new Uint8Array(e);else if(t===DataView){if((n=s.byteLength)===e.byteLength)for(;n--&&s.getInt8(n)===e.getInt8(n););return n===-1}if(ArrayBuffer.isView(s)){if((n=s.byteLength)===e.byteLength)for(;n--&&s[n]===e[n];);return n===-1}if(!t||typeof s=="object"){n=0;for(t in s)if(Ek.call(s,t)&&++n&&!Ek.call(e,t)||!(t in e)||!Ku(s[t],e[t]))return!1;return Object.keys(e).length===n}}return s!==s&&e!==e}function sg(s){let e=!1;return{promise:new Promise((n,r)=>{s.then(i=>!e&&n(i)).catch(i=>!e&&r(i))}),cancel(){e=!0}}}const z6=["onCopy","onCut","onPaste"],W6=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],G6=["onFocus","onBlur"],q6=["onInput","onInvalid","onReset","onSubmit"],K6=["onLoad","onError"],X6=["onKeyDown","onKeyPress","onKeyUp"],Y6=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],J6=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],Q6=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],Z6=["onSelect"],eH=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],tH=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],sH=["onScroll"],nH=["onWheel"],rH=["onAnimationStart","onAnimationEnd","onAnimationIteration"],iH=["onTransitionEnd"],aH=["onToggle"],oH=["onChange"],lH=[...z6,...W6,...G6,...q6,...K6,...X6,...Y6,...J6,...Q6,...Z6,...eH,...tH,...sH,...nH,...rH,...iH,...oH,...aH];function PR(s,e){const t={};for(const n of lH){const r=s[n];r&&(e?t[n]=i=>r(i,e(n)):t[n]=r)}return t}var cH="Invariant failed";function ht(s,e){if(!s)throw new Error(cH)}var uH=function(){},dH=uH;const Hs=Ok(dH),RR=S.createContext(null),hH="noopener noreferrer nofollow";class fH{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return ht(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){ht(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}goToDestination(e){return new Promise(t=>{ht(this.pdfDocument),ht(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{ht(Array.isArray(t));const n=t[0];new Promise(r=>{ht(this.pdfDocument),n instanceof Object?this.pdfDocument.getPageIndex(n).then(i=>{r(i)}).catch(()=>{ht(!1)}):typeof n=="number"?r(n):ht(!1)}).then(r=>{const i=r+1;ht(this.pdfViewer),ht(i>=1&&i<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:r,pageNumber:i})})})}navigateTo(e){this.goToDestination(e)}goToPage(e){const t=e-1;ht(this.pdfViewer),ht(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}addLinkAttributes(e,t,n){e.href=t,e.rel=this.externalLinkRel||hH,e.target=n?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}function Xu({children:s,type:e}){return c.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:s})}const kk={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function pH(s,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return s}}function ph(){return S.useReducer(pH,{value:void 0,error:void 0})}const Ev=typeof window<"u",LR=Ev&&window.location.protocol==="file:";function mH(s){return typeof s<"u"}function pl(s){return mH(s)&&s!==null}function gH(s){return typeof s=="string"}function yH(s){return s instanceof ArrayBuffer}function vH(s){return ht(Ev),s instanceof Blob}function fS(s){return gH(s)&&/^data:/.test(s)}function Tk(s){ht(fS(s));const[e="",t=""]=s.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function xH(){return Ev&&window.devicePixelRatio||1}const DR="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Ck(){Hs(!LR,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${DR}`)}function wH(){Hs(!LR,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${DR}`)}function Yc(s){s!=null&&s.cancel&&s.cancel()}function pS(s,e){return Object.defineProperty(s,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(s,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(s,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(s,"originalHeight",{get(){return this.view[3]},configurable:!0}),s}function bH(s){return s.name==="RenderingCancelledException"}function SH(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{if(!n.result)return t(new Error("Error while reading a file."));e(n.result)},n.onerror=r=>{if(!r.target)return t(new Error("Error while reading a file."));const{error:i}=r.target;if(!i)return t(new Error("Error while reading a file."));switch(i.code){case i.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case i.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case i.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},n.readAsArrayBuffer(s)})}const{PDFDataRangeTransport:_H}=V6,EH=(s,e)=>{switch(e){case kk.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");s(t);break}case kk.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");s(t);break}}};function Nk(s){return typeof s=="object"&&s!==null&&("data"in s||"range"in s||"url"in s)}const AH=S.forwardRef(function({children:e,className:t,error:n="Failed to load PDF file.",externalLinkRel:r,externalLinkTarget:i,file:a,inputRef:o,imageResourcesPath:l,loading:u="Loading PDF…",noData:h="No PDF file specified.",onItemClick:f,onLoadError:p,onLoadProgress:m,onLoadSuccess:g,onPassword:y=EH,onSourceError:b,onSourceSuccess:v,options:x,renderMode:w,rotate:E,scale:T,...C},N){const[j,R]=ph(),{value:D,error:z}=j,[L,I]=ph(),{value:O,error:Y}=L,F=S.useRef(new fH),B=S.useRef([]),M=S.useRef(void 0),$=S.useRef(void 0);a&&a!==M.current&&Nk(a)&&(Hs(!Ku(a,M.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),M.current=a),x&&x!==$.current&&(Hs(!Ku(x,$.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),$.current=x);const K=S.useRef({scrollPageIntoView:fe=>{const{dest:He,pageNumber:ie,pageIndex:me=ie-1}=fe;if(f){f({dest:He,pageIndex:me,pageNumber:ie});return}const Je=B.current[me];if(Je){Je.scrollIntoView();return}Hs(!1,`An internal link leading to page ${ie} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});S.useImperativeHandle(N,()=>({linkService:F,pages:B,viewer:K}),[]);function J(){v&&v()}function Z(){z&&(Hs(!1,z.toString()),b&&b(z))}function pe(){R({type:"RESET"})}S.useEffect(pe,[a,R]);const Se=S.useCallback(async()=>{if(!a)return null;if(typeof a=="string")return fS(a)?{data:Tk(a)}:(Ck(),{url:a});if(a instanceof _H)return{range:a};if(yH(a))return{data:a};if(Ev&&vH(a))return{data:await SH(a)};if(ht(typeof a=="object"),ht(Nk(a)),"url"in a&&typeof a.url=="string"){if(fS(a.url)){const{url:fe,...He}=a;return{data:Tk(fe),...He}}Ck()}return a},[a]);S.useEffect(()=>{const fe=sg(Se());return fe.promise.then(He=>{R({type:"RESOLVE",value:He})}).catch(He=>{R({type:"REJECT",error:He})}),()=>{Yc(fe)}},[Se,R]),S.useEffect(()=>{if(!(typeof D>"u")){if(D===!1){Z();return}J()}},[D]);function Pe(){O&&(g&&g(O),B.current=new Array(O.numPages),F.current.setDocument(O))}function H(){Y&&(Hs(!1,Y.toString()),p&&p(Y))}S.useEffect(function(){I({type:"RESET"})},[I,D]),S.useEffect(function(){if(!D)return;const He=x?{...D,...x}:D,ie=q_(He);m&&(ie.onProgress=m),y&&(ie.onPassword=y);const me=ie,Je=me.promise.then(ft=>{I({type:"RESOLVE",value:ft})}).catch(ft=>{me.destroyed||I({type:"REJECT",error:ft})});return()=>{Je.finally(()=>me.destroy())}},[x,I,D]),S.useEffect(()=>{if(!(typeof O>"u")){if(O===!1){H();return}Pe()}},[O]),S.useEffect(function(){F.current.setViewer(K.current),F.current.setExternalLinkRel(r),F.current.setExternalLinkTarget(i)},[r,i]);const X=S.useCallback((fe,He)=>{B.current[fe]=He},[]),we=S.useCallback(fe=>{delete B.current[fe]},[]),Re=S.useMemo(()=>({imageResourcesPath:l,linkService:F.current,onItemClick:f,pdf:O,registerPage:X,renderMode:w,rotate:E,scale:T,unregisterPage:we}),[l,f,O,X,w,E,T,we]),Ee=S.useMemo(()=>PR(C,()=>O),[C,O]);function q(){function fe(ie){return!!(ie!=null&&ie.pdf)}if(!fe(Re))throw new Error("pdf is undefined");const He=typeof e=="function"?e(Re):e;return c.jsx(RR.Provider,{value:Re,children:He})}function oe(){return a?O==null?c.jsx(Xu,{type:"loading",children:typeof u=="function"?u():u}):O===!1?c.jsx(Xu,{type:"error",children:typeof n=="function"?n():n}):q():c.jsx(Xu,{type:"no-data",children:typeof h=="function"?h():h})}return c.jsx("div",{className:_v("react-pdf__Document",t),ref:o,...Ee,children:oe()})});function MR(){return S.useContext(RR)}function IR(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var t=s.filter(Boolean);if(t.length<=1){var n=t[0];return n||null}return function(i){for(var a=0,o=t;a<o.length;a++){var l=o[a];typeof l=="function"?l(i):l&&(l.current=i)}}}const OR=S.createContext(null);function Av(){return S.useContext(OR)}function kH(){const s=MR(),e=Av();ht(e);const t={...s,...e},{imageResourcesPath:n,linkService:r,onGetAnnotationsError:i,onGetAnnotationsSuccess:a,onRenderAnnotationLayerError:o,onRenderAnnotationLayerSuccess:l,page:u,pdf:h,renderForms:f,rotate:p,scale:m=1}=t;ht(h),ht(u),ht(r);const[g,y]=ph(),{value:b,error:v}=g,x=S.useRef(null);Hs(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function w(){b&&a&&a(b)}function E(){v&&(Hs(!1,v.toString()),i&&i(v))}S.useEffect(function(){y({type:"RESET"})},[y,u]),S.useEffect(function(){if(!u)return;const R=sg(u.getAnnotations()),D=R;return R.promise.then(z=>{y({type:"RESOLVE",value:z})}).catch(z=>{y({type:"REJECT",error:z})}),()=>{Yc(D)}},[y,u]),S.useEffect(()=>{if(b!==void 0){if(b===!1){E();return}w()}},[b]);function T(){l&&l()}function C(j){Hs(!1,`${j}`),o&&o(j)}const N=S.useMemo(()=>u.getViewport({scale:m,rotation:p}),[u,p,m]);return S.useEffect(function(){if(!h||!u||!r||!b)return;const{current:R}=x;if(!R)return;const D=N.clone({dontFlip:!0}),z={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:R,l10n:null,page:u,structTreeLayer:null,viewport:D},L={annotations:b,annotationStorage:h.annotationStorage,div:R,imageResourcesPath:n,linkService:r,page:u,renderForms:f,viewport:D};R.innerHTML="";try{new J_(z).render(L),T()}catch(I){C(I)}return()=>{}},[b,n,r,u,h,f,N]),c.jsx("div",{className:_v("react-pdf__Page__annotations","annotationLayer"),ref:x})}const FR={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},TH=/^H(\d+)$/;function CH(s){return s in FR}function kv(s){return"children"in s}function $R(s){return kv(s)?s.children.length===1&&0 in s.children&&"id"in s.children[0]:!1}function NH(s){const e={};if(kv(s)){const{role:t}=s,n=t.match(TH);if(n)e.role="heading",e["aria-level"]=Number(n[1]);else if(CH(t)){const r=FR[t];r&&(e.role=r)}}return e}function UR(s){const e={};if(kv(s)){if(s.alt!==void 0&&(e["aria-label"]=s.alt),s.lang!==void 0&&(e.lang=s.lang),$R(s)){const[t]=s.children;if(t){const n=UR(t);return{...e,...n}}}}else"id"in s&&(e["aria-owns"]=s.id);return e}function jH(s){return s?{...NH(s),...UR(s)}:null}function BR({className:s,node:e}){const t=S.useMemo(()=>jH(e),[e]),n=S.useMemo(()=>!kv(e)||$R(e)?null:e.children.map((r,i)=>c.jsx(BR,{node:r},i)),[e]);return c.jsx("span",{className:s,...t,children:n})}function PH(){const s=Av();ht(s);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=s,[n,r]=ph(),{value:i,error:a}=n,{customTextRenderer:o,page:l}=s;function u(){i&&t&&t(i)}function h(){a&&(Hs(!1,a.toString()),e&&e(a))}return S.useEffect(function(){r({type:"RESET"})},[r,l]),S.useEffect(function(){if(o||!l)return;const p=sg(l.getStructTree()),m=p;return p.promise.then(g=>{r({type:"RESOLVE",value:g})}).catch(g=>{r({type:"REJECT",error:g})}),()=>Yc(m)},[o,l,r]),S.useEffect(()=>{if(i!==void 0){if(i===!1){h();return}u()}},[i]),i?c.jsx(BR,{className:"react-pdf__Page__structTree structTree",node:i}):null}const jk=Ni;function RH(s){const e=Av();ht(e);const t={...e,...s},{_className:n,canvasBackground:r,devicePixelRatio:i=xH(),onRenderError:a,onRenderSuccess:o,page:l,renderForms:u,renderTextLayer:h,rotate:f,scale:p}=t,{canvasRef:m}=s;ht(l);const g=S.useRef(null);function y(){l&&o&&o(pS(l,p))}function b(E){bH(E)||(Hs(!1,E.toString()),a&&a(E))}const v=S.useMemo(()=>l.getViewport({scale:p*i,rotation:f}),[i,l,f,p]),x=S.useMemo(()=>l.getViewport({scale:p,rotation:f}),[l,f,p]);S.useEffect(function(){if(!l)return;l.cleanup();const{current:T}=g;if(!T)return;T.width=v.width,T.height=v.height,T.style.width=`${Math.floor(x.width)}px`,T.style.height=`${Math.floor(x.height)}px`,T.style.visibility="hidden";const C={annotationMode:u?jk.ENABLE_FORMS:jk.ENABLE,canvasContext:T.getContext("2d",{alpha:!1}),viewport:v};r&&(C.background=r);const N=l.render(C),j=N;return N.promise.then(()=>{T.style.visibility="",y()}).catch(b),()=>Yc(j)},[r,l,u,v,x]);const w=S.useCallback(()=>{const{current:E}=g;E&&(E.width=0,E.height=0)},[]);return S.useEffect(()=>w,[w]),c.jsx("canvas",{className:`${n}__canvas`,dir:"ltr",ref:IR(m,g),style:{display:"block",userSelect:"none"},children:h?c.jsx(PH,{}):null})}function LH(s){return"str"in s}function DH(){const s=Av();ht(s);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:n,onRenderTextLayerError:r,onRenderTextLayerSuccess:i,page:a,pageIndex:o,pageNumber:l,rotate:u,scale:h}=s;ht(a);const[f,p]=ph(),{value:m,error:g}=f,y=S.useRef(null);Hs(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function b(){m&&n&&n(m)}function v(){g&&(Hs(!1,g.toString()),t&&t(g))}S.useEffect(function(){p({type:"RESET"})},[a,p]),S.useEffect(function(){if(!a)return;const j=sg(a.getTextContent()),R=j;return j.promise.then(D=>{p({type:"RESOLVE",value:D})}).catch(D=>{p({type:"REJECT",error:D})}),()=>Yc(R)},[a,p]),S.useEffect(()=>{if(m!==void 0){if(m===!1){v();return}b()}},[m]);const x=S.useCallback(()=>{i&&i()},[i]),w=S.useCallback(N=>{Hs(!1,N.toString()),r&&r(N)},[r]);function E(){const N=y.current;N&&N.classList.add("selecting")}function T(){const N=y.current;N&&N.classList.remove("selecting")}const C=S.useMemo(()=>a.getViewport({scale:h,rotation:u}),[a,u,h]);return S.useLayoutEffect(function(){if(!a||!m)return;const{current:j}=y;if(!j)return;j.innerHTML="";const R=a.streamTextContent({includeMarkedContent:!0}),D={container:j,textContentSource:R,viewport:C},z=new tp(D),L=z;return z.render().then(()=>{const I=document.createElement("div");I.className="endOfContent",j.append(I);const O=j.querySelectorAll('[role="presentation"]');if(e){let Y=0;m.items.forEach((F,B)=>{if(!LH(F))return;const M=O[Y];if(!M)return;const $=e({pageIndex:o,pageNumber:l,itemIndex:B,...F});M.innerHTML=$,Y+=F.str&&F.hasEOL?2:1})}x()}).catch(w),()=>Yc(L)},[e,w,x,a,o,l,m,C]),c.jsx("div",{className:_v("react-pdf__Page__textContent","textLayer"),onMouseUp:T,onMouseDown:E,ref:y})}const Pk=1;function MH(s){const t={...MR(),...s},{_className:n="react-pdf__Page",_enableRegisterUnregisterPage:r=!0,canvasBackground:i,canvasRef:a,children:o,className:l,customRenderer:u,customTextRenderer:h,devicePixelRatio:f,error:p="Failed to load the page.",height:m,inputRef:g,loading:y="Loading page…",noData:b="No page specified.",onGetAnnotationsError:v,onGetAnnotationsSuccess:x,onGetStructTreeError:w,onGetStructTreeSuccess:E,onGetTextError:T,onGetTextSuccess:C,onLoadError:N,onLoadSuccess:j,onRenderAnnotationLayerError:R,onRenderAnnotationLayerSuccess:D,onRenderError:z,onRenderSuccess:L,onRenderTextLayerError:I,onRenderTextLayerSuccess:O,pageIndex:Y,pageNumber:F,pdf:B,registerPage:M,renderAnnotationLayer:$=!0,renderForms:K=!1,renderMode:J="canvas",renderTextLayer:Z=!0,rotate:pe,scale:Se=Pk,unregisterPage:Pe,width:H,...X}=t,[we,Re]=ph(),{value:Ee,error:q}=we,oe=S.useRef(null);ht(B);const fe=pl(F)?F-1:Y??null,He=F??(pl(Y)?Y+1:null),ie=pe??(Ee?Ee.rotate:null),me=S.useMemo(()=>{if(!Ee)return null;let dt=1;const js=Se??Pk;if(H||m){const as=Ee.getViewport({scale:1,rotation:ie});H?dt=H/as.width:m&&(dt=m/as.height)}return js*dt},[m,Ee,ie,Se,H]);S.useEffect(function(){return()=>{pl(fe)&&r&&Pe&&Pe(fe)}},[r,B,fe,Pe]);function Je(){if(j){if(!Ee||!me)return;j(pS(Ee,me))}if(r&&M){if(!pl(fe)||!oe.current)return;M(fe,oe.current)}}function ft(){q&&(Hs(!1,q.toString()),N&&N(q))}S.useEffect(function(){Re({type:"RESET"})},[Re,B,fe]),S.useEffect(function(){if(!B||!He)return;const js=sg(B.getPage(He)),as=js;return js.promise.then(cn=>{Re({type:"RESOLVE",value:cn})}).catch(cn=>{Re({type:"REJECT",error:cn})}),()=>Yc(as)},[Re,B,He]),S.useEffect(()=>{if(Ee!==void 0){if(Ee===!1){ft();return}Je()}},[Ee,me]);const ln=S.useMemo(()=>pl(fe)&&He&&pl(ie)&&pl(me)?{_className:n,canvasBackground:i,customTextRenderer:h,devicePixelRatio:f,onGetAnnotationsError:v,onGetAnnotationsSuccess:x,onGetStructTreeError:w,onGetStructTreeSuccess:E,onGetTextError:T,onGetTextSuccess:C,onRenderAnnotationLayerError:R,onRenderAnnotationLayerSuccess:D,onRenderError:z,onRenderSuccess:L,onRenderTextLayerError:I,onRenderTextLayerSuccess:O,page:Ee,pageIndex:fe,pageNumber:He,renderForms:K,renderTextLayer:Z,rotate:ie,scale:me}:null,[n,i,h,f,v,x,w,E,T,C,R,D,z,L,I,O,Ee,fe,He,K,Z,ie,me]),Zr=S.useMemo(()=>PR(X,()=>Ee&&(me?pS(Ee,me):void 0)),[X,Ee,me]),An=`${fe}@${me}/${ie}`;function Ns(){switch(J){case"custom":return ht(u),c.jsx(u,{},`${An}_custom`);case"none":return null;case"canvas":default:return c.jsx(RH,{canvasRef:a},`${An}_canvas`)}}function kn(){return Z?c.jsx(DH,{},`${An}_text`):null}function Ot(){return $?c.jsx(kH,{},`${An}_annotations`):null}function kr(){function dt(as){return!!(as!=null&&as.page)}if(!dt(ln))throw new Error("page is undefined");const js=typeof o=="function"?o(ln):o;return c.jsxs(OR.Provider,{value:ln,children:[Ns(),kn(),Ot(),js]})}function sr(){return He?B===null||Ee===void 0||Ee===null?c.jsx(Xu,{type:"loading",children:typeof y=="function"?y():y}):B===!1||Ee===!1?c.jsx(Xu,{type:"error",children:typeof p=="function"?p():p}):kr():c.jsx(Xu,{type:"no-data",children:typeof b=="function"?b():b})}return c.jsx("div",{className:_v(n,l),"data-page-number":He,ref:IR(g,oe),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${me}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:i||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...Zr,children:sr()})}wH();Gr.workerSrc="pdf.worker.mjs";function IH({file:s,onClose:e}){var b;console.log("🔍 [PDF_VIEWER] Received file:",s),console.log("🔍 [PDF_VIEWER] File URL:",s.url),console.log("🔍 [PDF_VIEWER] File URL type:",typeof s.url),console.log("🔍 [PDF_VIEWER] File URL length:",(b=s.url)==null?void 0:b.length);const[t,n]=S.useState(null),[r,i]=S.useState(1),[a,o]=S.useState(1),[l,u]=S.useState(!0),[h,f]=S.useState(null),[p,m]=S.useState(!1);Dm.useEffect(()=>{if(l&&!p){const v=setTimeout(()=>{console.log("⏰ [PDF_VIEWER] PDF.js taking too long, switching to iframe"),m(!0),u(!1),f(null)},3e3);return()=>clearTimeout(v)}},[l,p]);const g=({numPages:v})=>{n(v),u(!1)},y=v=>{v.message.includes("worker")||v.message.includes("fake worker")||v.message.includes("pdf.worker.mjs")||v.message.includes("module specifier")?(console.log("🔄 [PDF_VIEWER] PDF.js worker failed, switching to iframe (this is normal)"),m(!0),f(null),u(!1)):(console.error("❌ [PDF_VIEWER] Non-worker error:",v.message),f(`Failed to load PDF: ${v.message}`),u(!1))};return s.url?p?(console.log("🔄 [PDF_VIEWER] Rendering iframe fallback"),c.jsxs("div",{className:"pdf-viewer-container",children:[c.jsxs("div",{className:"pdf-controls bg-gray-100 p-2 flex items-center justify-between",children:[c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("span",{className:"text-sm text-gray-600",children:"PDF Viewer"})}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"btn-primary text-sm",children:"Open in New Tab"})})]}),c.jsx("div",{className:"pdf-content bg-white",style:{height:"70vh"},children:c.jsx("iframe",{src:s.url,width:"100%",height:"100%",style:{border:"none"},title:`PDF: ${s.display_name}`,onError:()=>{console.error("❌ [PDF_VIEWER] Iframe also failed to load"),f("Failed to load PDF in both PDF.js and iframe")}})})]})):h?c.jsx("div",{className:"pdf-viewer-container p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-red-600 mb-4",children:h}),c.jsxs("div",{className:"space-x-2",children:[c.jsx("button",{onClick:()=>m(!0),className:"btn-secondary",children:"Try iframe"}),c.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"btn-primary",children:"Download PDF"})]})]})}):c.jsxs("div",{className:"pdf-viewer-container",children:[c.jsxs("div",{className:"pdf-controls bg-gray-100 p-2 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>i(v=>Math.max(1,v-1)),disabled:r<=1,className:"btn-secondary text-sm",children:"Previous"}),c.jsxs("span",{className:"text-sm text-gray-600",children:[r," of ",t||"?"]}),c.jsx("button",{onClick:()=>i(v=>Math.min(t||1,v+1)),disabled:r>=(t||1),className:"btn-secondary text-sm",children:"Next"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>o(v=>Math.max(.5,v-.1)),className:"btn-secondary text-sm",children:"Zoom Out"}),c.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(a*100),"%"]}),c.jsx("button",{onClick:()=>o(v=>Math.min(2,v+.1)),className:"btn-secondary text-sm",children:"Zoom In"})]})]}),c.jsx("div",{className:"pdf-content bg-white p-4 overflow-auto",style:{maxHeight:"70vh"},children:c.jsx(AH,{file:s.url,onLoadSuccess:g,onLoadError:y,loading:c.jsx("div",{className:"text-center p-8",children:"Loading PDF..."}),children:c.jsx(MH,{pageNumber:r,scale:a,renderTextLayer:!0,renderAnnotationLayer:!0})})})]}):(console.error("❌ [PDF_VIEWER] No file URL provided"),c.jsx("div",{className:"pdf-viewer-container p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-red-600 mb-4",children:"No file URL provided"}),c.jsx("button",{onClick:e,className:"btn-primary",children:"Close"})]})}))}function OH({file:s,onClose:e}){const[t,n]=S.useState(!1),[r,i]=S.useState(!1),a=`https://docs.google.com/gview?url=${encodeURIComponent(s.url)}&embedded=true`;return c.jsx("div",{className:"word-viewer-container",children:!t&&!r?c.jsx("div",{className:"relative",children:c.jsx("iframe",{src:a,width:"100%",height:"600px",style:{border:"none"},onError:()=>n(!0),onLoad:()=>{setTimeout(()=>{t||i(!0)},1e4)},title:`Preview of ${s.display_name}`})}):c.jsxs("div",{className:"fallback-viewer p-8 text-center",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),c.jsx("p",{className:"text-gray-600 mb-4",children:"Document preview not available"}),c.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Please download the document to view it"}),c.jsx("button",{onClick:async()=>{try{const o=await fetch(s.url);if(!o.ok)throw new Error(`Download failed: ${o.status}`);const l=await o.blob(),u=URL.createObjectURL(l),h=document.createElement("a");h.href=u,h.download=s.display_name||s.original_name,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u)}catch(o){console.error("Download failed:",o),alert("Download failed: "+o.message)}},className:"btn-primary",children:"Download Document"})]})})}const FH=({isOpen:s,onClose:e,title:t,children:n,size:r="md",showCloseButton:i=!0})=>{const a={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-6xl"};return s?c.jsx(Cs,{children:c.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e,children:c.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:`bg-white rounded-lg shadow-xl w-full ${a[r]} max-h-[90vh] overflow-y-auto`,onClick:o=>o.stopPropagation(),children:[(t||i)&&c.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[t&&c.jsx("h3",{className:"text-lg font-semibold text-neutral-800",children:t}),i&&c.jsx("button",{onClick:e,className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"p-6",children:n})]})})}):null};function HR({file:s,isOpen:e,onClose:t}){const n=a=>{var o;return((o=a.split(".").pop())==null?void 0:o.toLowerCase())||""},r=()=>s.url?s.url:s.cloudinary_url?s.cloudinary_url:"",i=()=>{const a=n(s.original_name||s.display_name),o=r(),l={...s,url:o};switch(a){case"pdf":return c.jsx(IH,{file:l,onClose:t});case"docx":case"doc":return c.jsx(OH,{file:l,onClose:t});case"jpg":case"jpeg":case"png":case"gif":case"webp":return c.jsx("div",{className:"image-viewer text-center",children:c.jsx("img",{src:o,alt:s.display_name,className:"max-w-full max-h-96 mx-auto",style:{maxHeight:"70vh"}})});case"mp3":case"wav":case"ogg":return c.jsx("div",{className:"audio-viewer text-center p-8",children:c.jsxs("audio",{controls:!0,className:"w-full max-w-md mx-auto",children:[c.jsx("source",{src:o,type:`audio/${a}`}),"Your browser does not support the audio element."]})});default:return c.jsxs("div",{className:"unsupported-file text-center p-8",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),c.jsx("p",{className:"text-gray-600 mb-4",children:"File type not supported for preview"}),c.jsx("button",{onClick:async()=>{try{const u=await fetch(o);if(!u.ok)throw new Error(`Download failed: ${u.status}`);const h=await u.blob(),f=URL.createObjectURL(h),p=document.createElement("a");p.href=f,p.download=s.display_name||s.original_name,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(f)}catch(u){console.error("Download failed:",u),alert("Download failed: "+u.message)}},className:"btn-primary",children:"Download File"})]})}};return e?c.jsx(FH,{isOpen:e,onClose:t,title:s.display_name,size:"xl",children:i()}):null}const $H=()=>{const[s,e]=S.useState("files"),[t,n]=S.useState([]),[r,i]=S.useState([]),[a,o]=S.useState(null),[l,u]=S.useState(null),[h,f]=S.useState(!0),[p,m]=S.useState(""),[g,y]=S.useState(""),[b,v]=S.useState(null),[x,w]=S.useState(!1);S.useEffect(()=>{E()},[]);const E=async()=>{try{f(!0);const[M,$]=await Promise.all([te.getFolders(),te.getFiles()]);M.success&&n(M.folders),$.success&&i($.files)}catch(M){console.error("Error fetching file data:",M)}finally{f(!1)}},T=async M=>{console.log("📁 [FILE_SHARING] Folder selected:",M),o(M),await C(M)},C=async M=>{try{const $=await te.getFiles({folder_id:M});console.log("📁 [FILE_SHARING] Files response for folder",M,":",$),$.success&&(i($.files),console.log("📁 [FILE_SHARING] Files updated:",$.files))}catch($){console.error("Error fetching folder files:",$)}},N=async M=>{console.log("📁 [FILE_SHARING] Current folder changed to:",M),o(M),u(M),await C(M)},j=async()=>{try{const M={};p&&(M.search=p),g&&(M.file_type=g),a&&(M.folder_id=a);const $=await te.getFiles(M);$.success&&i($.files)}catch(M){console.error("Error searching files:",M)}},R=M=>{console.log("🔄 [FILE_SHARING] Adding new file to list:",M),i($=>{const K=[M,...$];return console.log("🔄 [FILE_SHARING] Updated file list:",K),K})},D=async M=>{console.log("📁 [FILE_SHARING] File selected for viewing:",M),console.log("📁 [FILE_SHARING] File cloudinary_url:",M.cloudinary_url),console.log("📁 [FILE_SHARING] File supabase_path:",M.supabase_path);try{if(M.supabase_path){console.log("📁 [FILE_SHARING] Getting signed URL for Supabase file");const $=await te.getFileViewUrl(M.id);if(console.log("📁 [FILE_SHARING] API response:",$),$.success){const K={...M,url:$.viewUrl,display_name:$.fileName,original_name:$.fileName};console.log("📁 [FILE_SHARING] Setting selectedFile with signed URL:",K),v(K)}else console.error("Failed to get file view URL:",$.error),alert("Failed to load file preview: "+$.error),v(null)}else console.log("📁 [FILE_SHARING] Using Cloudinary URL for file"),v(M)}catch($){console.error("Failed to get file URL:",$),alert("Failed to load file preview: "+$.message),v(null)}};S.useEffect(()=>{console.log("📁 [FILE_SHARING] Files state updated:",r)},[r]),S.useEffect(()=>{console.log("📁 [FILE_SHARING] selectedFile state updated:",b)},[b]);const z=M=>{i($=>$.map(K=>K.id===M.id?M:K))},L=async M=>{try{console.log("🗑️ [FILE_SHARING] Deleting file:",M);const $=await te.deleteFile(M.id);$.success?(console.log("✅ [FILE_SHARING] File deleted successfully"),i(K=>K.filter(J=>J.id!==M.id))):(console.error("❌ [FILE_SHARING] Failed to delete file:",$.error),alert("Failed to delete file: "+($.error||"Unknown error")))}catch($){console.error("❌ [FILE_SHARING] Error deleting file:",$),alert("Error deleting file: "+$.message)}},I=async M=>{try{console.log("📁 [FILE_SHARING] Moving file:",M);const $=await O(M);if($!==null&&$!==M.folder_id){const K=await te.updateFile(M.id,{folder_id:$});K.success?(console.log("✅ [FILE_SHARING] File moved successfully"),i(J=>J.map(Z=>Z.id===M.id?{...Z,folder_id:$}:Z))):(console.error("❌ [FILE_SHARING] Failed to move file:",K.error),alert("Failed to move file: "+(K.error||"Unknown error")))}}catch($){console.error("❌ [FILE_SHARING] Error moving file:",$),alert("Error moving file: "+$.message)}},O=M=>new Promise($=>{const K=document.createElement("div");K.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",K.innerHTML=`
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
          <h3 class="text-lg font-semibold mb-4">Move "${M.display_name}" to:</h3>
          <div class="space-y-2 mb-4 max-h-60 overflow-y-auto">
            <button class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded border-2 border-dashed border-gray-300" data-folder-id="null">
              📁 Root Folder
            </button>
            ${t.map(J=>`
              <button class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded" data-folder-id="${J.id}">
                📁 ${J.name}
              </button>
            `).join("")}
          </div>
          <div class="flex justify-end space-x-2">
            <button id="cancel-move" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">
              Cancel
            </button>
          </div>
        </div>
      `,document.body.appendChild(K),K.addEventListener("click",J=>{if(J.target.dataset.folderId!==void 0){const Z=J.target.dataset.folderId==="null"?null:parseInt(J.target.dataset.folderId);document.body.removeChild(K),$(Z)}else J.target.id==="cancel-move"&&(document.body.removeChild(K),$(null))})}),Y=M=>{n($=>$.map(K=>K.id===M.id?M:K))},F=M=>{n($=>$.filter(K=>K.id!==M)),a===M&&(o(null),E())},B=M=>{n($=>[M,...$])};return h?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-full overflow-hidden h-[calc(100vh-8rem)] flex flex-col",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center p-3 border-b border-gray-200",children:[c.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-800",children:"File Sharing"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>w(!x),className:"lg:hidden p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),c.jsxs("div",{className:"flex space-x-1 overflow-x-auto",children:[c.jsx("button",{onClick:()=>e("files"),className:`px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200 whitespace-nowrap ${s==="files"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Files"}),c.jsx("button",{onClick:()=>e("folders"),className:`px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200 whitespace-nowrap ${s==="folders"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Folders"})]})]})]}),s==="files"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:`
            ${x?"translate-x-0":"-translate-x-full lg:translate-x-0"}
            fixed lg:relative inset-y-0 left-0 z-40
            w-64 lg:w-64 flex-shrink-0 border-r border-gray-200 bg-white
            transition-transform duration-300 ease-in-out
            lg:transition-none
          `,children:c.jsx(sk,{folders:t,files:r,selectedFolder:a,onFolderSelect:T,onFolderCreate:B,onFolderUpdate:Y,onFolderDelete:F,onSubfolderCreate:B,onCurrentFolderChange:N,onFileUpdate:z,onFileDelete:L,onFileMove:I,onFileSelect:D,onFileUpload:R})}),x&&c.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>w(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[c.jsx("div",{className:"p-2 sm:p-3 border-b border-gray-200 bg-gray-50",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[c.jsx("div",{className:"flex-1 min-w-0",children:c.jsx("input",{type:"text",placeholder:"Search files...",value:p,onChange:M=>m(M.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",onKeyPress:M=>M.key==="Enter"&&j()})}),c.jsx("div",{className:"w-full sm:w-32 md:w-40",children:c.jsxs("select",{value:g,onChange:M=>y(M.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",children:[c.jsx("option",{value:"",children:"All types"}),c.jsxs("optgroup",{label:"Documents",children:[c.jsx("option",{value:"pdf",children:"PDF"}),c.jsx("option",{value:"doc",children:"DOC"}),c.jsx("option",{value:"docx",children:"DOCX"}),c.jsx("option",{value:"txt",children:"TXT"}),c.jsx("option",{value:"xls",children:"XLS"}),c.jsx("option",{value:"xlsx",children:"XLSX"}),c.jsx("option",{value:"ppt",children:"PPT"}),c.jsx("option",{value:"pptx",children:"PPTX"})]}),c.jsxs("optgroup",{label:"Images",children:[c.jsx("option",{value:"jpg",children:"JPG"}),c.jsx("option",{value:"png",children:"PNG"}),c.jsx("option",{value:"gif",children:"GIF"}),c.jsx("option",{value:"webp",children:"WEBP"}),c.jsx("option",{value:"svg",children:"SVG"})]}),c.jsxs("optgroup",{label:"Audio",children:[c.jsx("option",{value:"mp3",children:"MP3"}),c.jsx("option",{value:"wav",children:"WAV"}),c.jsx("option",{value:"ogg",children:"OGG"}),c.jsx("option",{value:"m4a",children:"M4A"}),c.jsx("option",{value:"aac",children:"AAC"}),c.jsx("option",{value:"flac",children:"FLAC"})]}),c.jsxs("optgroup",{label:"Archives",children:[c.jsx("option",{value:"zip",children:"ZIP"}),c.jsx("option",{value:"rar",children:"RAR"})]})]})}),c.jsx("button",{onClick:j,className:"px-3 sm:px-4 py-1 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200 text-xs sm:text-sm whitespace-nowrap",children:"Search"})]})}),c.jsx("div",{className:"flex-1 overflow-hidden p-2 sm:p-4",children:(console.log("📁 [FILE_SHARING] Rendering preview area, selectedFile:",b),b?c.jsx("div",{className:"h-full",children:c.jsx(HR,{file:b,isOpen:!0,onClose:()=>v(null),showAsInline:!0})}):c.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:c.jsxs("div",{className:"text-center px-4",children:[c.jsx("div",{className:"text-4xl sm:text-6xl mb-4",children:"📁"}),c.jsx("div",{className:"text-base sm:text-lg font-medium",children:"File Preview Area"}),c.jsx("div",{className:"text-xs sm:text-sm",children:"Click on a file in the folder tree to preview it here"})]})}))})]})]}),s==="folders"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 overflow-hidden",children:c.jsx(sk,{folders:t,selectedFolder:a,onFolderSelect:T,onFolderCreate:B,onFolderUpdate:Y,onFileUpdate:z,onFileDelete:L,onFileMove:I,onFolderDelete:F,onSubfolderCreate:B,onFileSelect:D})})]})},UH=()=>{const{user:s,logout:e}=Bm(),[t,n]=S.useState(null),[r,i]=S.useState(null),[a,o]=S.useState(()=>{const j=Vc();return console.log("🔍 [AdminPage] Initial currentWeek:",j),j}),[l,u]=S.useState("schedule"),[h,f]=S.useState(!1),[p,m]=S.useState(null),[g,y]=S.useState(!1),b=j=>{n(j)},v=j=>{i(j)},x=j=>{console.log("🔍 [AdminPage] handleWeekChange called with:",j),console.log("🔍 [AdminPage] Previous currentWeek:",a),o(j),console.log("🔍 [AdminPage] New currentWeek set to:",j)},w=j=>{_s.hasUnsavedChanges()?(m(j),f(!0)):u(j)},E=async()=>{console.log("🔍 [ADMIN_SAVE] Save button clicked, processing draft...");try{y(!0);const j=_s.getDraftChanges();if(console.log("🔍 [ADMIN_SAVE] Draft data:",j),!j)return;console.log("🔍 [ADMIN_SAVE] Processing additions:",j.additions.length);for(const R of j.additions)console.log("🔍 [ADMIN_SAVE] Addition weekStart:",R.weekStart),console.log("🔍 [ADMIN_SAVE] Calling createSchedule with:",{student_id:R.studentId,teacher_id:R.teacherId,day_of_week:R.dayOfWeek,time_slot:R.timeSlot,week_start_date:R.weekStart}),await te.createSchedule({student_id:R.studentId,teacher_id:R.teacherId,day_of_week:R.dayOfWeek,time_slot:R.timeSlot,week_start_date:R.weekStart}),console.log("✅ [ADMIN_SAVE] createSchedule completed for addition");for(const R of j.deletions)await te.deleteSchedule(R.scheduleId);_s.clearDraftChanges(),console.log("✅ [ADMIN_PAGE] Changes saved successfully")}catch(j){console.error("❌ [ADMIN_PAGE] Failed to save changes:",j),alert("Failed to save changes. Please try again.")}finally{y(!1)}},T=()=>{_s.clearDraftChanges(),console.log("🗑️ [ADMIN_PAGE] Changes discarded")},C=j=>{j==="save"?E().then(()=>{u(p),m(null)}):j==="discard"&&(T(),u(p),m(null)),f(!1)},N=j=>{if(l==="schedule"&&!t&&j.length>0){const R=j[0];n(R),console.log("✅ [ADMIN_PAGE] Auto-selected first teacher:",R.name)}};return c.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-neutral-200",children:c.jsx("div",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8",children:c.jsxs("div",{className:"flex justify-between items-center h-16",children:[c.jsx("div",{className:"flex items-center",children:c.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-neutral-800",children:"RioTalk Admin Page"})}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("span",{className:"text-xs sm:text-sm text-neutral-600",children:["Welcome, ",(s==null?void 0:s.teacher_name)||(s==null?void 0:s.username),". Let's talk!"]}),c.jsx("button",{onClick:e,className:"btn-secondary text-xs sm:text-sm",children:"Logout"})]})]})})}),c.jsxs("main",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8",children:[c.jsx("div",{className:"flex space-x-1 sm:space-x-2 mb-3 sm:mb-4 md:mb-6",children:[{id:"schedule",label:"Schedule Management",shortLabel:"Schedule"},{id:"teachers",label:"Teachers",shortLabel:"Teachers"},{id:"students",label:"Students",shortLabel:"Students"},{id:"content",label:"Content Management",shortLabel:"Content"},{id:"files",label:"File Sharing",shortLabel:"Files"}].map(j=>c.jsxs("button",{onClick:()=>w(j.id),className:`flex-1 sm:flex-none px-1 sm:px-3 md:px-4 py-1 sm:py-1.5 md:py-2 rounded text-xs sm:text-sm md:text-base font-medium transition-colors duration-200 whitespace-nowrap ${l===j.id?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[c.jsx("span",{className:"sm:hidden",children:j.shortLabel}),c.jsx("span",{className:"hidden sm:inline",children:j.label})]},j.id))}),l==="schedule"&&c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[c.jsx(a$,{onTeacherSelect:b,selectedTeacher:t,onTeachersLoaded:N}),c.jsx(E$,{teacherId:t==null?void 0:t.id,weekStart:a,onWeekChange:x})]}),l==="teachers"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(D$,{onTeacherSelect:b,selectedTeacher:t})}),l==="students"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(R$,{onStudentSelect:v,selectedStudent:r})}),l==="content"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(O$,{})}),l==="files"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx($H,{})})]}),c.jsx(H2,{isOpen:h,onClose:()=>f(!1),onSave:()=>C("save"),onDiscard:()=>C("discard"),pendingAction:p?`Switch to ${p} tab`:null,changesSummary:_s.getChangesSummary()})]})},BH=({folders:s,selectedFolder:e,onFolderSelect:t})=>{const[n,r]=S.useState(new Set),i=u=>{r(h=>{const f=new Set(h);return f.has(u)?f.delete(u):f.add(u),f})},a=()=>s.filter(u=>!u.parent_id),o=u=>s.filter(h=>h.parent_id===u),l=(u,h=0)=>{const f=n.has(u.id),p=o(u.id),m=p.length>0;return c.jsxs("div",{className:"select-none",children:[c.jsxs("div",{className:`flex items-center py-2 px-3 sm:py-1 sm:px-2 hover:bg-gray-100 rounded cursor-pointer text-base sm:text-sm ${e===u.id?"bg-blue-100 text-blue-700":"text-gray-700"}`,style:{paddingLeft:`${h*16+8}px`},onClick:()=>t(u.id),children:[m?c.jsx("button",{onClick:g=>{g.stopPropagation(),i(u.id)},className:"mr-1 w-5 h-5 sm:w-4 sm:h-4 flex items-center justify-center",children:c.jsx(Q.svg,{className:"w-4 h-4 sm:w-3 sm:h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:{rotate:f?90:0},transition:{duration:.2},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):c.jsx("div",{className:"w-5 h-5 sm:w-4 sm:h-4 mr-1"}),c.jsx("svg",{className:"w-5 h-5 sm:w-4 sm:h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1 truncate",children:u.name})]}),c.jsx(Cs,{children:f&&m&&c.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:p.map(g=>l(g,h+1))})})]},u.id)};return c.jsxs("div",{className:"h-full flex flex-col bg-gray-50 border-r border-gray-200",children:[c.jsx("div",{className:"p-3 border-b border-gray-200",children:c.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"File Library"})}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[c.jsxs("div",{className:`flex items-center py-1 px-2 hover:bg-gray-100 rounded cursor-pointer text-sm ${e===null?"bg-blue-100 text-blue-700":"text-gray-700"}`,onClick:()=>t(null),children:[c.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),c.jsx("span",{className:"flex-1",children:"All Files"})]}),a().map(u=>l(u))]})]})},HH=()=>{const[s,e]=S.useState([]),[t,n]=S.useState([]),[r,i]=S.useState(!0),[a,o]=S.useState(""),[l,u]=S.useState(""),[h,f]=S.useState(null),[p,m]=S.useState("name"),[g,y]=S.useState(null),[b,v]=S.useState(!1),[x,w]=S.useState(!1);S.useEffect(()=>{E()},[]);const E=async()=>{try{i(!0);const[L,I]=await Promise.all([te.getPublicFiles(),te.getFolders()]);L.success&&e(L.files),I.success&&n(I.folders)}catch(L){console.error("Error fetching data:",L)}finally{i(!1)}},T=()=>{},C=L=>new Date(L).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),N=L=>[...L].sort((I,O)=>{switch(p){case"name":return I.display_name.localeCompare(O.display_name);case"date":return new Date(O.created_at)-new Date(I.created_at);case"size":return O.file_size-I.file_size;case"downloads":return(O.download_count||0)-(I.download_count||0);default:return 0}}),j=async L=>{try{console.log("📁 [FILE_LIBRARY] Starting download for file:",L.id);let I,O;if(L.supabase_path){console.log("📁 [FILE_LIBRARY] Getting signed URL for Supabase file");const $=await te.downloadFilePublic(L.id);if(!$.success)throw new Error($.error||"Failed to get download URL");I=$.downloadUrl,O=$.fileName,console.log("📁 [FILE_LIBRARY] Got signed URL:",I.substring(0,50)+"...")}else I=L.cloudinary_url,O=L.display_name||L.original_name,console.log("📁 [FILE_LIBRARY] Using Cloudinary URL:",I.substring(0,50)+"...");console.log("📁 [FILE_LIBRARY] Fetching file content from URL");const Y=await fetch(I);if(!Y.ok)throw new Error(`Download failed: ${Y.status} ${Y.statusText}`);const F=await Y.blob();if(console.log("📁 [FILE_LIBRARY] File blob size:",F.size,"bytes"),F.size===0)throw new Error("Downloaded file is empty");const B=URL.createObjectURL(F),M=document.createElement("a");M.href=B,M.download=O,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(B),console.log("✅ [FILE_LIBRARY] Download initiated")}catch(I){console.error("Error downloading file:",I),alert("Failed to download file: "+I.message)}},R=async L=>{console.log("📁 [FILE_LIBRARY] File selected for viewing:",L),console.log("📁 [FILE_LIBRARY] File cloudinary_url:",L.cloudinary_url),console.log("📁 [FILE_LIBRARY] File supabase_path:",L.supabase_path);try{if(L.supabase_path){console.log("📁 [FILE_LIBRARY] Getting signed URL for Supabase file");const I=await te.getFileViewUrlPublic(L.id);if(console.log("📁 [FILE_LIBRARY] API response:",I),I.success){const O={...L,url:I.viewUrl,display_name:I.fileName,original_name:I.fileName};console.log("📁 [FILE_LIBRARY] Setting previewFile with signed URL:",O),y(O),v(!0)}else console.error("Failed to get file view URL:",I.error),alert("Failed to load file preview: "+I.error)}else console.log("📁 [FILE_LIBRARY] Using Cloudinary URL for file"),y(L),v(!0)}catch(I){console.error("Failed to get file URL:",I),alert("Failed to load file preview: "+I.message)}},D=s.filter(L=>{const I=L.display_name.toLowerCase().includes(a.toLowerCase()),O=!l||L.file_type===l,Y=h===null||L.folder_id===h;return I&&O&&Y}),z=N(D);return r?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):c.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-full overflow-hidden h-[600px] flex flex-col",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center p-3 border-b border-gray-200",children:[c.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-800",children:"File Library"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>w(!x),className:"lg:hidden p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),c.jsxs("div",{className:"text-xs sm:text-sm text-gray-500",children:[s.length," file",s.length!==1?"s":""," available"]})]})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:`
          ${x?"translate-x-0":"-translate-x-full lg:translate-x-0"}
          fixed lg:relative inset-y-0 left-0 z-40
          w-64 lg:w-64 flex-shrink-0 border-r border-gray-200 bg-white
          transition-transform duration-300 ease-in-out
          lg:transition-none
        `,children:c.jsx(BH,{folders:t,selectedFolder:h,onFolderSelect:f})}),x&&c.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>w(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[c.jsx("div",{className:"p-2 sm:p-3 border-b border-gray-200 bg-gray-50",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[c.jsx("div",{className:"flex-1 min-w-0",children:c.jsx("input",{type:"text",placeholder:"Search files...",value:a,onChange:L=>o(L.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",onKeyPress:L=>L.key==="Enter"&&T()})}),c.jsx("div",{className:"w-full sm:w-32 md:w-40",children:c.jsxs("select",{value:l,onChange:L=>u(L.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",children:[c.jsx("option",{value:"",children:"All file types"}),c.jsxs("optgroup",{label:"Documents",children:[c.jsx("option",{value:"pdf",children:"PDF"}),c.jsx("option",{value:"doc",children:"DOC"}),c.jsx("option",{value:"docx",children:"DOCX"}),c.jsx("option",{value:"txt",children:"TXT"}),c.jsx("option",{value:"xls",children:"XLS"}),c.jsx("option",{value:"xlsx",children:"XLSX"}),c.jsx("option",{value:"ppt",children:"PPT"}),c.jsx("option",{value:"pptx",children:"PPTX"})]}),c.jsxs("optgroup",{label:"Images",children:[c.jsx("option",{value:"jpg",children:"JPG"}),c.jsx("option",{value:"png",children:"PNG"}),c.jsx("option",{value:"gif",children:"GIF"}),c.jsx("option",{value:"webp",children:"WEBP"}),c.jsx("option",{value:"svg",children:"SVG"})]}),c.jsxs("optgroup",{label:"Audio",children:[c.jsx("option",{value:"mp3",children:"MP3"}),c.jsx("option",{value:"wav",children:"WAV"}),c.jsx("option",{value:"ogg",children:"OGG"}),c.jsx("option",{value:"m4a",children:"M4A"}),c.jsx("option",{value:"aac",children:"AAC"}),c.jsx("option",{value:"flac",children:"FLAC"})]}),c.jsxs("optgroup",{label:"Archives",children:[c.jsx("option",{value:"zip",children:"ZIP"}),c.jsx("option",{value:"rar",children:"RAR"})]})]})}),c.jsx("div",{className:"w-full sm:w-32 md:w-40",children:c.jsxs("select",{value:p,onChange:L=>m(L.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-xs sm:text-sm",children:[c.jsx("option",{value:"name",children:"Sort by Name"}),c.jsx("option",{value:"date",children:"Sort by Date"}),c.jsx("option",{value:"size",children:"Sort by Size"}),c.jsx("option",{value:"downloads",children:"Sort by Downloads"})]})})]})}),c.jsx("div",{className:"flex-1 overflow-hidden",children:c.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden h-full",children:[c.jsx("div",{className:"hidden sm:block bg-gray-50 border-b border-gray-200 px-4 py-2",children:c.jsxs("div",{className:"grid grid-cols-12 gap-4 text-xs font-medium text-gray-500 uppercase tracking-wider",children:[c.jsx("div",{className:"col-span-6",children:"Name"}),c.jsx("div",{className:"col-span-2",children:"Size"}),c.jsx("div",{className:"col-span-2",children:"Modified"}),c.jsx("div",{className:"col-span-2",children:"Actions"})]})}),c.jsx("div",{className:"divide-y divide-gray-200 overflow-y-auto h-full",children:z.map(L=>c.jsxs(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center px-2 sm:px-4 py-2 sm:py-3 hover:bg-gray-50 transition-colors",children:[c.jsx("div",{className:"sm:hidden flex-1 min-w-0",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"flex-shrink-0",children:uy(L.file_type)}),c.jsxs("div",{className:"min-w-0 flex-1",children:[c.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",title:L.display_name,children:L.display_name}),c.jsxs("div",{className:"text-xs text-gray-500",children:[L.folder_name||"Root"," • ",L.file_type.toUpperCase()]}),c.jsxs("div",{className:"flex items-center justify-between mt-1",children:[c.jsxs("div",{className:"text-xs text-gray-500",children:[tk(L.file_size)," • ",C(L.created_at)]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>R(L),className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Preview",children:c.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),c.jsx("button",{onClick:()=>j(L),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Download",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})]})]})]})}),c.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 sm:gap-4 sm:w-full",children:[c.jsxs("div",{className:"col-span-6 flex items-center space-x-3 min-w-0",children:[c.jsx("span",{children:uy(L.file_type)}),c.jsxs("div",{className:"min-w-0 flex-1",children:[c.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",title:L.display_name,children:L.display_name}),c.jsxs("div",{className:"text-xs text-gray-500",children:[L.folder_name||"Root"," • ",L.file_type.toUpperCase()]})]})]}),c.jsx("div",{className:"col-span-2 text-sm text-gray-500",children:tk(L.file_size)}),c.jsx("div",{className:"col-span-2 text-sm text-gray-500",children:C(L.created_at)}),c.jsxs("div",{className:"col-span-2 flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>R(L),className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Preview",children:c.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),c.jsx("button",{onClick:()=>j(L),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Download",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})]})]},L.id))}),z.length===0&&c.jsxs("div",{className:"text-center py-8 text-gray-500",children:[c.jsx("div",{className:"text-4xl mb-2",children:"📁"}),c.jsx("p",{children:"No files found."})]})]})})]})]}),c.jsx(HR,{file:g,isOpen:b,onClose:()=>{v(!1),y(null)}})]})},VH=({teacherId:s})=>{const[e,t]=S.useState([]),[n,r]=S.useState(!0),[i,a]=S.useState(""),[o,l]=S.useState(null),[u,h]=S.useState(!1),[f,p]=S.useState({type:"success",title:"",message:""}),[m,g]=S.useState(!1),[y,b]=S.useState({studentId:null,newLevel:"",studentName:""}),v=[{value:"",label:"No Level Assigned"},{value:"A1",label:"A1 – Beginner"},{value:"A1+",label:"A1+ – High Beginner / Pre-A2"},{value:"A2",label:"A2 – Pre-Intermediate"},{value:"B1",label:"B1 – Intermediate"},{value:"B2",label:"B2 – Upper-Intermediate"},{value:"C1",label:"C1 – Advanced"},{value:"C2",label:"C2 – Proficient"}];S.useEffect(()=>{x()},[s]);const x=async()=>{try{r(!0),a("");const T=await te.getCurrentStudents(s);T.success?t(T.students||[]):a(T.error||"Failed to load students")}catch(T){console.error("Error fetching students:",T),a("Failed to load students")}finally{r(!1)}},w=(T,C,N)=>{b({studentId:T,newLevel:C,studentName:N}),g(!0)},E=async()=>{try{l(y.studentId);const T=await te.updateStudentLevel(y.studentId,y.newLevel);T.success?(t(C=>C.map(N=>N.id===y.studentId?{...N,student_level:y.newLevel}:N)),p({type:"success",title:"Success",message:`Student level updated to ${y.newLevel||"No level"}`}),h(!0)):(p({type:"error",title:"Error",message:T.error||"Failed to update student level"}),h(!0))}catch(T){console.error("Error updating student level:",T),p({type:"error",title:"Error",message:"Failed to update student level"}),h(!0)}finally{l(null),g(!1),b({studentId:null,newLevel:"",studentName:""})}};return n?c.jsx("div",{className:"flex justify-center items-center py-8",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i?c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-red-600 mb-4",children:i}),c.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Retry"})]}):c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["My Students (",e.length,")"]}),c.jsx("button",{onClick:x,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Refresh"})]}),e.length===0?c.jsxs("div",{className:"text-center py-8 text-gray-500",children:[c.jsx("div",{className:"mb-4",children:c.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),c.jsx("p",{className:"text-lg font-medium mb-2",children:"No students assigned"}),c.jsx("p",{className:"text-sm",children:"You don't have any students assigned to you yet."})]}):c.jsx("div",{className:"grid gap-4",children:e.map(T=>c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:T.name}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsxs("span",{className:"text-sm text-gray-500",children:["Assigned: ",new Date(T.assigned_date).toLocaleDateString()]}),T.student_level&&c.jsx(dh,{level:T.student_level})]})]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Level:"}),c.jsx("select",{value:T.student_level||"",onChange:C=>w(T.id,C.target.value,T.name),disabled:o===T.id,className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:v.map(C=>c.jsx("option",{value:C.value,children:C.label},C.value))})]}),o===T.id&&c.jsx("div",{className:"flex items-center",children:c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]})]})},T.id))}),c.jsx(su,{isVisible:u,onClose:()=>h(!1),type:f.type,title:f.title,message:f.message}),o&&c.jsx(Ca,{isOpen:!!o,message:"Updating student level..."}),m&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Confirm Level Change"}),c.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to change ",c.jsx("strong",{children:y.studentName}),"'s level to ",c.jsx("strong",{children:y.newLevel||"No Level"}),"?"]}),c.jsxs("div",{className:"flex justify-center space-x-3",children:[c.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{onClick:E,disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Saving...":"Confirm"})]})]})})})]})};function Rk(s){const e=new Date(s),t=e.getDay(),n=t===0?-6:1-t;return e.setDate(e.getDate()+n),e.setHours(0,0,0,0),e}function Mx(s){return s.toISOString().split("T")[0]}function Lk(s){if(!s)return!1;const e=Rk(new Date),t=new Date(e);t.setDate(t.getDate()-7);const n=new Date(s),r=Mx(Rk(n)),i=Mx(e),a=Mx(t);return r===i||r===a}const zH=()=>{var Ha,U,se;const{user:s,logout:e}=Bm(),[t,n]=S.useState(Vc()),[r,i]=S.useState([]),[a,o]=S.useState(!0),[l,u]=S.useState(!1),[h,f]=S.useState(null),[p,m]=S.useState(""),[g,y]=S.useState(null),[b,v]=S.useState(""),[x,w]=S.useState({completed:0,absent:0,warned:0}),[E,T]=S.useState(new Set),[C,N]=S.useState(!1),[j,R]=S.useState(null),[D,z]=S.useState(!1),[L,I]=S.useState(null),[O,Y]=S.useState(!1),[F,B]=S.useState(new Set),[M,$]=S.useState(null),[K,J]=S.useState(!1),[Z,pe]=S.useState([]),[Se,Pe]=S.useState("schedule"),[H,X]=S.useState(!1),[we,Re]=S.useState(!1),[Ee,q]=S.useState({visible:!1,type:"success",title:"",message:"",duration:4e3}),oe=(W,de,ve,_e=4e3)=>{q({visible:!0,type:W,title:de,message:ve,duration:_e})};S.useEffect(()=>{console.log("🔍 [TEACHER_PAGE] useEffect triggered with user:",s),console.log("🔍 [TEACHER_PAGE] user.teacherId:",s==null?void 0:s.teacherId),s&&s.teacherId?(console.log("✅ [TEACHER_PAGE] User and teacherId available, making API calls"),fe(),He(),ie()):console.log("❌ [TEACHER_PAGE] User or teacherId not available:",{user:!!s,teacherId:s==null?void 0:s.teacherId})},[t,s]);const fe=async()=>{try{if(o(!0),console.log("🔍 [TEACHER_PAGE] fetchSchedule called with user:",s),console.log("🔍 [TEACHER_PAGE] user.teacherId:",s.teacherId,"currentWeek:",t),console.log("🔍 [TEACHER_PAGE] user object keys:",Object.keys(s||{})),!s.teacherId){console.error("❌ [TEACHER_PAGE] teacherId is undefined, cannot fetch schedule");return}const W=await te.getTeacherSchedule(s.teacherId,t);console.log("🔍 [TEACHER_PAGE] Schedule API response:",W),W.success&&(console.log("🔍 [TEACHER_PAGE] Setting schedule:",W.schedules),i(W.schedules||[]))}catch(W){console.error("Error fetching schedule:",W)}finally{o(!1)}},He=async()=>{try{console.log("🔍 [TEACHER_PAGE] fetchAttendanceStats called with user:",s),console.log("🔍 [TEACHER_PAGE] user.teacherId:",s.teacherId,"period:",`${t},${me(t)}`);const W=await te.getTeacherStats(s.teacherId,{week_start:t});W.success&&w({completed:W.stats.completed_lessons||0,absent:W.stats.absent_lessons||0,warned:0})}catch(W){console.error("Error fetching attendance stats:",W)}},ie=async()=>{try{console.log("🔍 [TEACHER_PAGE] fetchExistingReports called");const W=await te.getReports({teacher_id:s.teacherId,date_from:t,date_to:me(t)});if(console.log("🔍 [TEACHER_PAGE] Reports API response:",W),W.success&&W.reports){const de=W.reports.filter(_e=>{const Ne=new Date(_e.lesson_date),Qe=Ne.getFullYear()+"-"+String(Ne.getMonth()+1).padStart(2,"0")+"-"+String(Ne.getDate()).padStart(2,"0");return MA(Qe)===t}),ve=de.map(_e=>{const Ne=new Date(_e.lesson_date),Qe=Ne.getFullYear()+"-"+String(Ne.getMonth()+1).padStart(2,"0")+"-"+String(Ne.getDate()).padStart(2,"0"),un=`${_e.student_id}-${Qe}-${_e.time_slot}`;return console.log("🔍 [TEACHER_PAGE] Generated report key:",un,"from report:",_e),un});T(new Set(ve)),pe(de),console.log("🔍 [TEACHER_PAGE] Loaded existing reports for current week:",ve)}else console.log("🔍 [TEACHER_PAGE] No reports found or API failed")}catch(W){console.error("Error fetching existing reports:",W)}},me=W=>{const de=new Date(W);return de.setDate(de.getDate()+6),de.toISOString().split("T")[0]},Je=async()=>{if(!O){Y(!0);const W=$2(t,7);n(W),setTimeout(()=>Y(!1),300)}},ft=async()=>{if(!O){Y(!0);const W=F2(t,7);n(W),setTimeout(()=>Y(!1),300)}},ln=async()=>{if(!O){Y(!0);const de=MA(new Date);n(de),setTimeout(()=>Y(!1),300)}},Zr=async(W,de)=>{try{(await te.markAttendance(W,de)).success&&(fe(),He())}catch(ve){console.error("Error marking attendance:",ve),alert("Failed to mark attendance")}},An=(W,de,ve,_e)=>{if(!Lk(_e)){oe("warning","Action not allowed","Sorry, you are only allowed to edit current week or previous week.");return}I({scheduleId:W,status:de,studentName:ve}),z(!0)},Ns=async()=>{if(L)try{X(!0),await Zr(L.scheduleId,L.status),await fe(),z(!1),I(null)}finally{X(!1)}},kn=(W,de,ve,_e)=>{if(!Lk(ve==null?void 0:ve.week_start_date)){oe("warning","Action not allowed","Sorry, you are only allowed to edit current week or previous week.");return}console.log("🔍 [HANDLE_STUDENT_CLICK] Called with:",{student:W,timeSlot:de,scheduleItem:ve,dayIndex:_e});const Ne=new Date(ve.week_start_date);Ne.setDate(Ne.getDate()+ve.day_of_week);const Qe=`${Ne.getFullYear()}-${String(Ne.getMonth()+1).padStart(2,"0")}-${String(Ne.getDate()).padStart(2,"0")}`,un=`${W.id}-${Qe}-${de}`;if(console.log("🔍 [HANDLE_STUDENT_CLICK] Checking lesson key:",un),console.log("🔍 [HANDLE_STUDENT_CLICK] Current reports set:",Array.from(E)),console.log("🔍 [HANDLE_STUDENT_CLICK] Has report?",E.has(un)),E.has(un)){console.log("🔍 [HANDLE_STUDENT_CLICK] Report already exists, showing alert"),oe("info","Already submitted","Report already submitted for this lesson.");return}console.log("🔍 [HANDLE_STUDENT_CLICK] Setting up report modal with:",{student:W,timeSlot:de,dayIndex:_e}),f(W),m(de),y(_e),u(!0),console.log("🔍 [HANDLE_STUDENT_CLICK] Report modal should now be visible")},Ot=()=>{if(!b.trim()){alert("Please enter a comment");return}const W=r.find(_e=>_e.student_id===h.id&&_e.time_slot===p&&_e.day_of_week===g);if(!W){alert("Schedule item not found for this day and time slot");return}const de=new Date(W.week_start_date);de.setDate(de.getDate()+W.day_of_week);const ve=de.getFullYear()+"-"+String(de.getMonth()+1).padStart(2,"0")+"-"+String(de.getDate()).padStart(2,"0");R({student_id:h.id,lesson_date:ve,time_slot:p,comment:b}),N(!0)},kr=async()=>{try{Re(!0);const W=r.find(ve=>ve.student_id===j.student_id&&ve.time_slot===j.time_slot&&ve.day_of_week===g);if(W&&!(await te.markAttendance(W.id,"completed",new Date().toISOString().split("T")[0])).success){alert("Failed to mark attendance");return}if((await te.createReport(j)).success){const ve=`${j.student_id}-${j.lesson_date}-${j.time_slot}`;console.log("🔍 [CONFIRM_SUBMIT] Adding lesson key to reports set:",ve),T(_e=>{const Ne=new Set([..._e,ve]);return console.log("🔍 [CONFIRM_SUBMIT] Updated reports set:",Array.from(Ne)),Ne}),B(_e=>new Set([..._e,ve])),setTimeout(()=>{B(_e=>{const Ne=new Set(_e);return Ne.delete(ve),Ne})},2e3),await fe(),u(!1),N(!1),v(""),f(null),m(""),y(null),R(null),oe("success","Success","Report submitted successfully!")}}catch(W){console.error("Error submitting report:",W),alert("Failed to submit report")}finally{Re(!1)}},sr=W=>W.attendance_status==="completed"?"completed":W.attendance_status==="absent"?"absent":W.attendance_status==="absent_warned"?"absent_warned":"scheduled",dt=W=>{switch(W){case"completed":return"bg-green-100 text-green-800";case"absent":return"bg-red-100 text-red-800";case"absent_warned":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},js={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},as=["8:00-8:30","8:30-9:00","9:00-9:30","9:30-10:00","10:00-10:30","10:30-11:00","11:00-11:30","11:30-12:00","12:00-12:30","12:30-13:00","13:00-13:30","13:30-14:00","14:00-14:30","14:30-15:00","15:00-15:30","15:30-16:00","16:00-16:30","16:30-17:00","17:00-17:30","17:30-18:00","18:00-18:30","18:30-19:00","19:00-19:30","19:30-20:00","20:00-20:30","20:30-21:00","21:00-21:30","21:30-22:00"],cn=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Tn=t?L_(t):[],ei=U2(),zs={};Tn.forEach(W=>{const de=`${W.getFullYear()}-${W.getMonth()+1}`;zs[de]=(zs[de]||0)+1});const Ps=Object.keys(zs).reduce((W,de)=>zs[W]>zs[de]?W:de,Object.keys(zs)[0]),[Lt,Ua]=Ps?Ps.split("-").map(Number):[ei.year,ei.month],Cn=t?cv(t,Ua,Lt):null,bt=t?B2(t,Ua,Lt):null,Ba=Tn.length>0?Tn[0].toLocaleDateString("en-US",{month:"long",year:"numeric"}):ei.name+" "+ei.year;return console.log("🔍 [TEACHER_PAGE] Render - schedule state:",r,"type:",typeof r,"isArray:",Array.isArray(r)),console.log("🔍 [TEACHER_PAGE] Render - modal states:",{showReportModal:l,selectedStudent:!!h,showConfirmModal:C,pendingReport:!!j}),a?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your schedule..."})]})}):c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b",children:c.jsx("div",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8",children:c.jsxs("div",{className:"flex justify-between items-center h-16",children:[c.jsx("div",{className:"flex items-center",children:c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Teacher Dashboard"})}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("span",{className:"text-sm text-gray-700",children:["Welcome, ",(s==null?void 0:s.teacher_name)||(s==null?void 0:s.username),". Let's talk!"]}),c.jsx("button",{onClick:e,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Logout"})]})]})})}),c.jsxs("main",{className:"w-full px-2 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8",children:[c.jsx("div",{className:"flex space-x-1 sm:space-x-2 mb-3 sm:mb-4 md:mb-6 overflow-x-auto",children:[{id:"schedule",label:"Schedule",shortLabel:"Schedule"},{id:"students",label:"Students",shortLabel:"Students"},{id:"files",label:"Folder",shortLabel:"Folder"}].map(W=>c.jsxs("button",{onClick:()=>Pe(W.id),className:`px-3 sm:px-3 md:px-4 py-2 sm:py-1.5 md:py-2 rounded text-sm sm:text-sm md:text-base font-medium transition-colors duration-200 whitespace-nowrap ${Se===W.id?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[c.jsx("span",{className:"sm:hidden",children:W.shortLabel}),c.jsx("span",{className:"hidden sm:inline",children:W.label})]},W.id))}),Se==="schedule"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 md:gap-6 mb-4 sm:mb-6 md:mb-8",children:[c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow p-3 sm:p-4 md:p-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"p-1 sm:p-2 bg-green-100 rounded-lg",children:c.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-green-600 text-xs sm:text-sm md:text-base",children:"✓"})}),c.jsxs("div",{className:"ml-2 sm:ml-3 md:ml-4",children:[c.jsx("p",{className:"text-2xs sm:text-xs md:text-sm font-medium text-gray-600",children:"Completed"}),c.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:x.completed})]})]})}),c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg shadow p-3 sm:p-4 md:p-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"p-1 sm:p-2 bg-red-100 rounded-lg",children:c.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-red-600 text-xs sm:text-sm md:text-base",children:"✗"})}),c.jsxs("div",{className:"ml-2 sm:ml-3 md:ml-4",children:[c.jsx("p",{className:"text-2xs sm:text-xs md:text-sm font-medium text-gray-600",children:"UI"}),c.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:x.absent})]})]})}),c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg shadow p-3 sm:p-4 md:p-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"p-1 sm:p-2 bg-blue-100 rounded-lg",children:c.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-blue-600 text-xs sm:text-sm md:text-base",children:"📊"})}),c.jsxs("div",{className:"ml-2 sm:ml-3 md:ml-4",children:[c.jsx("p",{className:"text-2xs sm:text-xs md:text-sm font-medium text-gray-600",children:"Total"}),c.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:Number(x.completed)+Number(x.absent)})]})]})})]}),c.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[c.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 border-b border-gray-200",children:c.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:c.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[c.jsx("h2",{className:"text-sm sm:text-base md:text-lg font-semibold text-gray-900",children:"Weekly Schedule"}),c.jsxs(Q.div,{className:"flex items-center justify-center sm:justify-end space-x-1 sm:space-x-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:[c.jsx(Q.button,{onClick:Je,disabled:O,className:"p-1.5 sm:p-2 rounded border border-gray-300 hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:O?{x:[-2,2,-2]}:{x:0},transition:{duration:.1,repeat:O?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsx(Q.button,{onClick:ln,disabled:O,className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${bt!=null&&bt.isCurrentWeek?"bg-blue-500 text-white":"text-gray-700 bg-gray-100 hover:bg-gray-200"}`,title:(bt==null?void 0:bt.weekLabel)||"Current Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:(bt==null?void 0:bt.weekLabel)||"Week 1"},(bt==null?void 0:bt.weekLabel)||"Week 1")}),c.jsx(Q.button,{onClick:ft,disabled:O,className:"p-1.5 sm:p-2 rounded border border-gray-300 hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Week",whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(Q.svg,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",animate:O?{x:[2,-2,2]}:{x:0},transition:{duration:.1,repeat:O?1/0:0},children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})})}),c.jsx("div",{className:"overflow-x-auto",children:c.jsx(Cs,{mode:"wait",children:c.jsx(Q.div,{variants:js,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.3,ease:"easeInOut"},children:c.jsxs("table",{className:"w-full table-fixed",children:[c.jsxs("thead",{className:"bg-neutral-50",children:[c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-xs sm:text-sm font-semibold text-neutral-800 w-12 sm:w-16 md:w-24"}),c.jsx("th",{colSpan:"7",className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center text-sm sm:text-base md:text-lg font-bold text-neutral-800",children:c.jsx(Q.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:Ba},Ba)})]}),c.jsxs("tr",{children:[c.jsx("th",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-left text-2xs sm:text-xs md:text-sm font-medium text-neutral-700 w-10 sm:w-12 md:w-16",children:"Time"}),cn.map((W,de)=>{var Ne;const ve=(Ne=Cn==null?void 0:Cn.days)==null?void 0:Ne[de],_e=(ve==null?void 0:ve.isCurrentMonth)??!0;return ve==null||ve.isEditable,c.jsx(Q.th,{className:`px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center font-medium min-w-0 ${_e?"text-neutral-700":"text-neutral-400 bg-neutral-100"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:de*.05},children:c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("div",{className:`font-semibold text-2xs sm:text-xs md:text-sm truncate ${_e?"":"opacity-50"}`,children:W}),Tn.length>de&&c.jsx(Q.div,{className:`text-2xs sm:text-xs mt-0.5 sm:mt-1 truncate ${_e?"text-neutral-500":"text-neutral-400"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.1+de*.05},children:O2(Tn[de],"short")})]})},`${W}-${t}`)})]})]}),c.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:as.map((W,de)=>c.jsxs(Q.tr,{className:"border-b border-neutral-100",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:de*.02},children:[c.jsx("td",{className:"px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-2xs sm:text-xs md:text-sm text-neutral-600 font-medium",children:W}),cn.map((ve,_e)=>{var ti;const Ne=(r||[]).filter(st=>st.day_of_week===_e&&st.time_slot===W),Qe=(ti=Cn==null?void 0:Cn.days)==null?void 0:ti[_e],un=(Qe==null?void 0:Qe.isCurrentMonth)??!0;return Qe==null||Qe.isEditable,c.jsx(Q.td,{className:`px-1 sm:px-2 py-1 h-10 sm:h-12 md:h-14 relative ${un?"":"bg-neutral-50"}`,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2,delay:de*.02+_e*.01},children:c.jsx(Cs,{mode:"wait",children:Ne.length>0?Ne.map(st=>{const G=sr(st),ge=new Date(st.week_start_date);ge.setDate(ge.getDate()+st.day_of_week);const $e=ge.getFullYear()+"-"+String(ge.getMonth()+1).padStart(2,"0")+"-"+String(ge.getDate()).padStart(2,"0"),at=`${st.student_id}-${$e}-${W}`,Ge=E.has(at),Ze=F.has(at),De=Ge||G==="completed"||G==="absent"||G==="absent_warned";return c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:De?.7:1,scale:Ze?1.05:1,boxShadow:Ze?"0 0 20px rgba(34, 197, 94, 0.4)":void 0},transition:{duration:.3,ease:"easeOut",scale:{duration:.6,ease:"easeInOut"}},className:`p-1 rounded-lg text-2xs font-medium text-center transition-all duration-200 ${De?"cursor-pointer border-2 border-green-200 hover:bg-gray-200":"cursor-pointer hover:shadow-lg hover:scale-105"} ${Ze?"ring-2 ring-green-400 ring-opacity-50":""} ${dt(G)}`,onClick:()=>{if(De){const Ft=Z.find(Nn=>{const Mi=new Date(Nn.lesson_date),si=Mi.getFullYear()+"-"+String(Mi.getMonth()+1).padStart(2,"0")+"-"+String(Mi.getDate()).padStart(2,"0");return`${Nn.student_id}-${si}-${Nn.time_slot}`===at});Ft&&($(Ft),J(!0))}else kn({id:st.student_id,name:st.student_name},W,st,_e)},children:[c.jsxs("div",{className:"font-medium text-2xs sm:text-xs flex items-center justify-between",children:[c.jsx("span",{className:`truncate ${De?"text-gray-500":""}`,children:st.student_name}),De&&c.jsx(Q.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:Ze?[1,1.1,1]:1,backgroundColor:G==="completed"?"#10b981":G==="absent"?"#ef4444":G==="absent_warned"?"#eab308":"#3b82f6"},transition:{delay:.2,duration:.3,scale:Ze?{duration:.8,repeat:2,ease:"easeInOut"}:{duration:.3}},className:`text-2xs sm:text-xs text-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full font-semibold shadow-sm ${G==="completed"?"bg-green-500":G==="absent"?"bg-red-500":G==="absent_warned"?"bg-yellow-500":"bg-blue-500"} ${Ze?"animate-pulse":""}`,children:G==="completed"?c.jsx("span",{className:"text-xs",children:"✓"}):G==="absent"?c.jsx("span",{className:"text-xs",children:"✗"}):G==="absent_warned"?c.jsx("span",{className:"text-xs",children:"⚠"}):c.jsx("span",{className:"text-xs",style:{fontSize:"10px"},children:"✓"})})]}),c.jsxs("div",{className:"flex flex-col md:flex-row space-y-0.5 md:space-y-0 md:space-x-1 mt-0.5",children:[c.jsxs("div",{className:"flex space-x-0.5",children:[c.jsx(Q.button,{whileHover:De?{}:{scale:1.05},whileTap:De?{}:{scale:.95},onClick:Ft=>{De||(Ft.stopPropagation(),kn({id:st.student_id,name:st.student_name},W,st,_e))},disabled:De,className:`px-0.5 py-0.5 md:px-2 md:py-1 rounded text-xs transition-all duration-200 ${De?"bg-gray-200 text-gray-400 cursor-not-allowed":G==="completed"?"bg-green-200 text-green-800 hover:bg-green-300":"bg-gray-200 text-gray-600 hover:bg-green-200 hover:text-green-800"}`,children:c.jsx("span",{className:"text-xs md:text-sm",style:{fontSize:"10px"},children:"✓"})}),c.jsx(Q.button,{whileHover:De?{}:{scale:1.05},whileTap:De?{}:{scale:.95},onClick:Ft=>{if(console.log("🔍 [ABSENT_BUTTON_CLICK] Button clicked! isMarked:",De,"scheduleId:",st.id),De){console.log("🔍 [ABSENT_BUTTON_CLICK] Returning early because isMarked=true");return}Ft.stopPropagation(),console.log("🔍 [ABSENT_BUTTON_CLICK] Calling handleAttendanceClick"),An(st.id,"absent",st.student_name,st.week_start_date)},disabled:De,className:`px-0.5 py-0.5 md:px-2 md:py-1 rounded text-xs transition-all duration-200 ${De?"bg-gray-200 text-gray-400 cursor-not-allowed":G==="absent"?"bg-red-200 text-red-800 hover:bg-red-300":"bg-gray-200 text-gray-600 hover:bg-red-200 hover:text-red-800"}`,children:c.jsx("span",{className:"text-xs md:text-sm",style:{fontSize:"10px"},children:"✗"})})]}),c.jsx(Q.button,{whileHover:De?{}:{scale:1.05},whileTap:De?{}:{scale:.95},onClick:Ft=>{De||(Ft.stopPropagation(),An(st.id,"absent_warned",st.student_name,st.week_start_date))},disabled:De,className:`px-0.5 py-0.5 md:px-2 md:py-1 rounded text-xs transition-all duration-200 ${De?"bg-gray-200 text-gray-400 cursor-not-allowed":G==="absent_warned"?"bg-yellow-200 text-yellow-800 hover:bg-yellow-300":"bg-gray-200 text-gray-600 hover:bg-yellow-200 hover:text-yellow-800"}`,children:c.jsx("span",{className:"text-xs md:text-sm",style:{fontSize:"10px"},children:"⚠"})})]})]},st.id)}):c.jsx("div",{className:"w-full h-full flex items-center justify-center text-neutral-300 hover:text-neutral-400 transition-colors duration-200",children:c.jsx("span",{className:"text-2xs sm:text-xs font-light",children:"—"})})})},`${ve}-${W}`)})]},W))})]})},t)})})]})]}),Se==="students"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(VH,{teacherId:s.teacherId})}),Se==="files"&&c.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:c.jsx(HH,{})}),console.log("🔍 [RENDER] Report modal check:",{showReportModal:l,selectedStudent:!!h}),l&&h&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs(Q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Complete Lesson - ",h==null?void 0:h.name,(h==null?void 0:h.student_level)&&c.jsx("div",{className:"mt-2",children:c.jsx(dh,{level:h.student_level,size:"sm"})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Slot"}),c.jsx("input",{type:"text",value:p,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comment"}),c.jsx("textarea",{value:b,onChange:W=>v(W.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your lesson report comment..."})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[c.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),c.jsx("button",{onClick:Ot,className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:"Submit Report"})]})]})}),c.jsxs(Ca,{isOpen:C,onClose:()=>{N(!1),R(null)},title:"Confirm Lesson Completion",loading:we,loadingText:"Submitting...",confirmText:"Complete Lesson",confirmButtonColor:"bg-green-600 hover:bg-green-700",onConfirm:kr,children:[c.jsx("p",{className:"text-gray-700",children:"Are you sure you want to complete this lesson and submit the report? This will mark the lesson as completed and save the report."}),c.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Student:"})," ",h==null?void 0:h.name]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Time Slot:"})," ",j==null?void 0:j.time_slot]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Date:"})," ",j==null?void 0:j.lesson_date]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Comment:"})," ",j==null?void 0:j.comment]})]})]}),console.log("🔍 [MODAL_RENDER] showAttendanceConfirmModal:",D,"pendingAttendance:",L),c.jsxs(Ca,{isOpen:D,onClose:()=>{z(!1),I(null)},title:"Confirm Attendance Marking",loading:H,loadingText:"Marking...",confirmText:`Mark as ${(L==null?void 0:L.status)==="absent"?"UI":(L==null?void 0:L.status)==="absent_warned"?"I":(Ha=L==null?void 0:L.status)==null?void 0:Ha.replace("_"," ").toUpperCase()}`,confirmButtonColor:(L==null?void 0:L.status)==="absent"?"bg-red-600 hover:bg-red-700":"bg-yellow-600 hover:bg-yellow-700",onConfirm:Ns,children:[c.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to mark this lesson as ",c.jsx("strong",{children:(L==null?void 0:L.status)==="absent"?"UI":(L==null?void 0:L.status)==="absent_warned"?"I":(U=L==null?void 0:L.status)==null?void 0:U.replace("_"," ").toUpperCase()}),"?"]}),c.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Student:"})," ",L==null?void 0:L.studentName]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Status:"})," ",(L==null?void 0:L.status)==="absent"?"UI":(L==null?void 0:L.status)==="absent_warned"?"I":(se=L==null?void 0:L.status)==null?void 0:se.replace("_"," ").toUpperCase()]})]})]}),K&&M&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:c.jsx(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsx("h3",{className:"text-xl font-semibold text-neutral-800",children:"Your Lesson Report"}),c.jsx("button",{onClick:()=>J(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Student"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("p",{className:"text-lg font-semibold text-neutral-800",children:M.student_name}),M.student_level&&c.jsx(dh,{level:M.student_level})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Time Slot"}),c.jsx("p",{className:"text-lg font-semibold text-neutral-800",children:M.time_slot})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Lesson Date"}),c.jsx("p",{className:"text-neutral-800",children:new Date(M.lesson_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Submitted At"}),c.jsx("p",{className:"text-neutral-800",children:new Date(M.created_at).toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]}),M.comment&&c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Your Comment"}),c.jsx("div",{className:"mt-2 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:c.jsx("p",{className:"text-neutral-800 whitespace-pre-wrap",children:M.comment})})]}),!M.comment&&c.jsx("div",{className:"text-center py-8 text-gray-500",children:c.jsx("p",{children:"No comment provided for this lesson."})})]}),c.jsx("div",{className:"mt-6 flex justify-end",children:c.jsx("button",{onClick:()=>J(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Close"})})]})})})]}),c.jsx(su,{isVisible:Ee.visible,onClose:()=>q(W=>({...W,visible:!1})),title:Ee.title,message:Ee.message,type:Ee.type,duration:Ee.duration})]})},WH=()=>c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-neutral-50",children:c.jsxs(Q.div,{className:"flex flex-col items-center space-y-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[c.jsx(Q.div,{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-500 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),c.jsx("p",{className:"text-neutral-600 text-sm",children:"Loading..."})]})}),Dk=({children:s,role:e})=>{const{user:t,loading:n,isAuthenticated:r}=Bm();return n?c.jsx(WH,{}):r?e&&(t==null?void 0:t.role)!==e?(t==null?void 0:t.role)==="admin"?c.jsx(Hh,{to:"/admin",replace:!0}):(t==null?void 0:t.role)==="teacher"?c.jsx(Hh,{to:"/teacher",replace:!0}):c.jsx(Hh,{to:"/",replace:!0}):s:c.jsx(Hh,{to:"/",replace:!0})};function GH(){return c.jsx(RI,{children:c.jsx(LI,{children:c.jsx(EI,{children:c.jsxs("div",{className:"min-h-screen",children:[c.jsx(DI,{}),c.jsxs(bI,{children:[c.jsx(Vh,{path:"/",element:c.jsx(e$,{})}),c.jsx(Vh,{path:"/admin",element:c.jsx(Dk,{role:"admin",children:c.jsx(UH,{})})}),c.jsx(Vh,{path:"/teacher",element:c.jsx(Dk,{role:"teacher",children:c.jsx(zH,{})})}),c.jsx(Vh,{path:"*",element:c.jsx(Hh,{to:"/",replace:!0})})]}),!1]})})})})}JC(document.getElementById("root")).render(c.jsx(S.StrictMode,{children:c.jsx(GH,{})}));
